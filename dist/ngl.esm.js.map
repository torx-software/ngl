{"version":3,"file":"ngl.esm.js","sources":["../src/utils.ts","../src/utils/registry.ts","../src/math/math-utils.ts","../src/color/colormaker.ts","../src/selection/selection-constants.ts","../src/selection/selection-test.ts","../src/selection/selection.ts","../src/selection/selection-parser.ts","../src/color/selection-colormaker.ts","../src/color/colormaker-registry.ts","../src/worker/worker-utils.ts","../src/globals.ts","../src/worker/worker-registry.ts","../src/parser/parser-registry.ts","../src/streamer/streamer.ts","../src/streamer/file-streamer.ts","../src/streamer/network-streamer.ts","../src/loader/loader.ts","../src/loader/parser-loader.ts","../src/script.ts","../src/loader/script-loader.ts","../src/loader/loader-utils.ts","../src/writer/writer.ts","../src/writer/pdb-writer.ts","../src/writer/sdf-writer.ts","../src/utils/io-buffer.ts","../src/writer/stl-writer.ts","../src/utils/counter.ts","../src/viewer/stats.ts","../src/shader/shader-utils.ts","../src/viewer/viewer-constants.ts","../src/viewer/tiled-renderer.ts","../src/math/math-constants.ts","../src/math/array-utils.ts","../src/viewer/viewer-utils.ts","../src/viewer/gl-utils.ts","../src/viewer/viewer.ts","../src/constants.ts","../src/stage/mouse-observer.ts","../src/controls/trackball-controls.ts","../src/controls/picking-proxy.ts","../src/controls/picking-controls.ts","../src/controls/viewer-controls.ts","../src/animation/animation.ts","../src/controls/animation-controls.ts","../src/utils/queue.ts","../src/representation/representation.ts","../src/worker/worker.ts","../src/worker/worker-pool.ts","../src/math/vector-utils.ts","../src/geometry/dash.ts","../src/geometry/primitive.ts","../src/geometry/spatial-hash.ts","../src/store/store.ts","../src/store/contact-store.ts","../src/utils/bitarray.ts","../src/utils/adjacency-list.ts","../src/chemistry/interactions/features.ts","../src/structure/structure-constants.ts","../src/chemistry/geometry.ts","../src/chemistry/valence-model.ts","../src/structure/data.ts","../src/chemistry/functional-groups.ts","../src/chemistry/interactions/charged.ts","../src/chemistry/interactions/hydrogen-bonds.ts","../src/chemistry/interactions/metal-binding.ts","../src/chemistry/interactions/halogen-bonds.ts","../src/chemistry/interactions/refine-contacts.ts","../src/chemistry/interactions/contact.ts","../src/chemistry/interactions/hydrophobic.ts","../src/utils/picker.ts","../src/surface/marching-cubes.ts","../src/math/matrix-utils.ts","../src/surface/surface-utils.ts","../src/surface/surface.ts","../src/surface/volume.ts","../src/buffer/buffer.ts","../src/buffer/mesh-buffer.ts","../src/buffer/surface-buffer.ts","../src/buffer/doublesided-buffer.ts","../src/buffer/contour-buffer.ts","../src/representation/surface-representation.ts","../src/controls/mouse-actions.ts","../src/controls/mouse-controls.ts","../src/controls/key-actions.ts","../src/controls/key-controls.ts","../src/stage/picking-behavior.ts","../src/stage/mouse-behavior.ts","../src/stage/animation-behavior.ts","../src/stage/key-behavior.ts","../src/component/annotation.ts","../src/controls/component-controls.ts","../src/utils/radius-factory.ts","../src/math/principal-axes.ts","../src/surface/filtered-volume.ts","../src/store/bond-hash.ts","../src/store/bond-store.ts","../src/store/atom-store.ts","../src/store/residue-store.ts","../src/store/chain-store.ts","../src/store/model-store.ts","../src/geometry/helixorient.ts","../src/geometry/helixbundle.ts","../src/utils/binary-heap.ts","../src/utils/kdtree.ts","../src/proxy/atom-proxy.ts","../src/geometry/kdtree.ts","../src/symmetry/symmetry-constants.ts","../src/symmetry/symmetry-utils.ts","../src/symmetry/assembly.ts","../src/structure/structure-builder.ts","../src/structure/structure-utils.ts","../src/store/atom-type.ts","../src/store/atom-map.ts","../src/store/residue-type.ts","../src/store/residue-map.ts","../src/proxy/bond-proxy.ts","../src/proxy/residue-proxy.ts","../src/proxy/polymer.ts","../src/proxy/chain-proxy.ts","../src/proxy/model-proxy.ts","../src/structure/structure.ts","../src/geometry/shape.ts","../src/representation/buffer-representation.ts","../src/buffer/geometry-buffer.ts","../src/buffer/spheregeometry-buffer.ts","../src/buffer/mapped-buffer.ts","../src/buffer/mappedquad-buffer.ts","../src/buffer/sphereimpostor-buffer.ts","../src/buffer/sphere-buffer.ts","../src/buffer/point-buffer.ts","../src/representation/dot-representation.ts","../src/buffer/image-buffer.ts","../src/surface/volume-slice.ts","../src/representation/slice-representation.ts","../src/representation/representation-utils.ts","../src/component/element.ts","../src/component/representation-element.ts","../src/component/component.ts","../src/component/collection.ts","../src/component/representation-collection.ts","../src/component/trajectory-element.ts","../src/trajectory/frames.ts","../src/align/superposition.ts","../src/trajectory/trajectory-player.ts","../src/trajectory/trajectory.ts","../src/trajectory/frames-trajectory.ts","../src/trajectory/structure-trajectory.ts","../src/trajectory/remote-trajectory.ts","../src/trajectory/callback-trajectory.ts","../src/structure/structure-view.ts","../src/align/alignment.ts","../src/align/align-utils.ts","../src/component/structure-component.ts","../src/trajectory/trajectory-utils.ts","../src/component/surface-component.ts","../src/component/volume-component.ts","../src/component/component-collection.ts","../src/stage/stage.ts","../src/component/shape-component.ts","../node_modules/tslib/tslib.es6.js","../src/color/atomindex-colormaker.ts","../src/color/bfactor-colormaker.ts","../src/color/chainid-colormaker.ts","../src/color/chainindex-colormaker.ts","../src/color/chainname-colormaker.ts","../src/color/densityfit-colormaker.ts","../src/color/electrostatic-colormaker.ts","../src/color/element-colormaker.ts","../src/color/entityindex-colormaker.ts","../src/color/entitytype-colormaker.ts","../src/color/geoquality-colormaker.ts","../src/color/hydrophobicity-colormaker.ts","../src/color/modelindex-colormaker.ts","../src/color/moleculetype-colormaker.ts","../src/color/occupancy-colormaker.ts","../src/color/partialcharge-colormaker.ts","../src/color/random-colormaker.ts","../src/color/randomcoilindex-colormaker.ts","../src/color/residueindex-colormaker.ts","../src/color/resname-colormaker.ts","../src/color/sstruc-colormaker.ts","../src/color/structuredata-colormaker.ts","../src/color/uniform-colormaker.ts","../src/color/value-colormaker.ts","../src/color/volume-colormaker.ts","../src/representation/structure-representation.ts","../src/representation/measurement-representation.ts","../src/utils/edt.ts","../src/buffer/text-buffer.ts","../src/buffer/wideline-buffer.ts","../src/representation/angle-representation.ts","../src/buffer/cylindergeometry-buffer.ts","../src/buffer/mappedalignedbox-buffer.ts","../src/buffer/cylinderimpostor-buffer.ts","../src/buffer/cylinder-buffer.ts","../src/representation/axes-representation.ts","../src/representation/ballandstick-representation.ts","../src/representation/backbone-representation.ts","../src/representation/base-representation.ts","../src/geometry/spline.ts","../src/buffer/tubemesh-buffer.ts","../src/representation/cartoon-representation.ts","../src/representation/contact-representation.ts","../src/representation/dihedral-representation.ts","../src/representation/dihedral-histogram-representation.ts","../src/representation/distance-representation.ts","../src/buffer/vector-buffer.ts","../src/representation/helixorient-representation.ts","../src/representation/licorice-representation.ts","../src/buffer/mappedbox-buffer.ts","../src/buffer/hyperballstickimpostor-buffer.ts","../src/buffer/hyperballstick-buffer.ts","../src/representation/hyperball-representation.ts","../src/utils/label-factory.ts","../src/representation/label-representation.ts","../src/representation/line-representation.ts","../src/geometry/grid.ts","../src/surface/edt-surface.ts","../src/surface/av-surface.ts","../src/surface/molecular-surface.ts","../src/representation/molecularsurface-representation.ts","../src/representation/point-representation.ts","../src/buffer/ribbon-buffer.ts","../src/representation/ribbon-representation.ts","../src/representation/rocket-representation.ts","../src/representation/rope-representation.ts","../src/representation/spacefill-representation.ts","../src/buffer/trace-buffer.ts","../src/representation/trace-representation.ts","../src/representation/tube-representation.ts","../src/representation/unitcell-representation.ts","../src/representation/validation-representation.ts","../src/buffer/cone-buffer.ts","../src/viewer/geometry-group.ts","../src/buffer/arrow-buffer.ts","../src/buffer/box-buffer.ts","../src/buffer/ellipsoid-buffer.ts","../src/buffer/icosahedron-buffer.ts","../src/buffer/octahedron-buffer.ts","../src/buffer/tetrahedron-buffer.ts","../src/buffer/torus-buffer.ts","../node_modules/molstar/lib/mol-data/db/column-helpers.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/common.js","../node_modules/molstar/lib/mol-math/interpolate.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/vec3.js","../node_modules/molstar/lib/mol-math/misc.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/mat4.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/mat3.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/vec2.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/vec4.js","../node_modules/molstar/lib/mol-util/type-helpers.js","../node_modules/molstar/lib/mol-math/linear-algebra/3d/quat.js","../node_modules/molstar/lib/mol-math/linear-algebra/tensor.js","../node_modules/molstar/lib/mol-data/db/column.js","../node_modules/molstar/lib/mol-util/bit-flags.js","../node_modules/molstar/lib/mol-util/string-builder.js","../node_modules/molstar/lib/mol-io/reader/common/text/number-parser.js","../node_modules/molstar/lib/mol-data/util/sort.js","../node_modules/molstar/lib/mol-util/now.js","../node_modules/molstar/lib/mol-util/uuid.js","../node_modules/molstar/lib/mol-util/mask.js","../node_modules/molstar/lib/mol-util/value-cell.js","../node_modules/molstar/lib/mol-util/id-factory.js","../node_modules/molstar/lib/mol-data/db/table.js","../node_modules/molstar/lib/mol-data/db/database.js","../node_modules/molstar/lib/mol-io/reader/cif/data-model.js","../node_modules/molstar/lib/mol-io/reader/common/text/column/token.js","../node_modules/molstar/lib/mol-task/util/scheduler.js","../node_modules/molstar/lib/mol-util/debug.js","../node_modules/molstar/lib/mol-task/util/user-timing.js","../node_modules/molstar/lib/mol-task/execution/observable.js","../node_modules/molstar/lib/mol-task/execution/synchronous.js","../node_modules/molstar/lib/mol-task/task.js","../node_modules/molstar/lib/mol-task/execution/runtime-context.js","../node_modules/molstar/lib/mol-task/execution/progress.js","../node_modules/molstar/lib/mol-io/reader/common/text/tokenizer.js","../node_modules/molstar/lib/mol-io/reader/result.js","../node_modules/molstar/lib/mol-io/common/binary-cif/encoding.js","../node_modules/molstar/lib/mol-task/util/chunked.js","../node_modules/molstar/lib/mol-io/reader/cif/text/parser.js","../node_modules/molstar/lib/mol-io/common/binary.js","../node_modules/molstar/lib/mol-io/common/binary-cif/decoder.js","../node_modules/molstar/lib/mol-data/util/chunked-array.js","../node_modules/molstar/lib/mol-io/common/binary-cif/classifier.js","../node_modules/molstar/lib/mol-io/common/binary-cif/array-encoder.js","../node_modules/molstar/lib/mol-util/number.js","../node_modules/molstar/lib/mol-io/common/utf8.js","../node_modules/molstar/lib/mol-io/common/msgpack/decode.js","../node_modules/molstar/lib/mol-io/reader/cif/binary/parser.js","../node_modules/molstar/lib/mol-io/reader/cif/binary/field.js","../node_modules/molstar/lib/mol-io/reader/cif/schema.js","../node_modules/molstar/lib/mol-util/index.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/mmcif.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/ccd.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/bird.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/dic.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/density-server.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/cif-core.js","../node_modules/molstar/lib/mol-io/reader/cif/schema/segmentation.js","../node_modules/molstar/lib/mol-io/reader/cif.js","../src/parser/parser.ts","../src/parser/structure-parser.ts","../src/structure/entity.ts","../src/symmetry/unitcell.ts","../src/parser/pdb-parser.ts","../src/store/chemcomp-map.ts","../src/parser/cif-parser.ts","../src/parser/gro-parser.ts","../lib/mmtf.es6.js","../src/parser/mmtf-parser.ts","../src/parser/mol2-parser.ts","../src/parser/pdbqt-parser.ts","../src/parser/pqr-parser.ts","../src/parser/sdf-parser.ts","../src/parser/prmtop-parser.ts","../src/parser/psf-parser.ts","../src/parser/top-parser.ts","../src/parser/trajectory-parser.ts","../src/utils/netcdf-reader.ts","../src/parser/dcd-parser.ts","../src/parser/nctraj-parser.ts","../src/parser/trr-parser.ts","../src/parser/xtc-parser.ts","../src/parser/volume-parser.ts","../src/parser/cube-parser.ts","../src/parser/dsn6-parser.ts","../src/parser/dx-parser.ts","../src/parser/dxbin-parser.ts","../src/parser/mrc-parser.ts","../src/parser/xplor-parser.ts","../src/parser/kin-parser.ts","../src/parser/surface-parser.ts","../src/parser/obj-parser.ts","../src/parser/csv-parser.ts","../src/parser/json-parser.ts","../src/parser/msgpack-parser.ts","../src/parser/netcdf-parser.ts","../src/parser/text-parser.ts","../src/utils/parse-xml.ts","../src/parser/xml-parser.ts","../src/structure/validation.ts","../lib/pako_inflate.es6.js","../src/parser/validation-parser.ts","../src/utils/gzip-decompressor.ts","../src/datasource/datasource.ts","../src/datasource/rcsb-datasource.ts","../src/datasource/pdbe-datasource.ts","../src/datasource/pubchem-datasource.ts","../src/datasource/passthrough-datasource.ts","../src/datasource/alphafold-datasource.ts","../src/datasource/static-datasource.ts","../src/datasource/mdsrv-datasource.ts","../src/ui/parameters.ts","../src/version.ts"],"sourcesContent":["/**\n * @file Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3, Matrix4, Quaternion } from 'three'\n\nexport function getQuery (id: string) {\n  if (typeof window === 'undefined') return undefined\n\n  const a = new RegExp(`${id}=([^&#=]*)`)\n  const m = a.exec(window.location.search)\n\n  if (m) {\n    return decodeURIComponent(m[1])\n  } else {\n    return undefined\n  }\n}\n\nexport function boolean (value: any) {\n  if (!value) {\n    return false\n  }\n\n  if (typeof value === 'string') {\n    return /^1|true|t|yes|y$/i.test(value)\n  }\n\n  return true\n}\n\nexport function defaults (value: any, defaultValue: any) {\n  return value !== undefined ? value : defaultValue\n}\n\nexport function createParams<T> (params: {[k in keyof T]?: any}, defaultParams: T) {\n  const o: any = Object.assign({}, params)\n  for (const k in defaultParams) {\n    const value = params[k]\n    if (value === undefined) o[k] = defaultParams[k]\n  }\n  return o as T\n}\n\nexport function updateParams<T> (params: T, newParams: {[k in keyof T]?: any}) {\n  for (const k in newParams) {\n    const value = newParams[k]\n    if (value !== undefined) params[k] = value\n  }\n  return params as T\n}\n\nexport function pick (object: { [index: string]: any }) {\n  const properties = [].slice.call(arguments, 1)\n  return properties.reduce((a: { [index: string]: any }, e: any) => {\n    a[ e ] = object[ e ]\n    return a\n  }, {})\n}\n\nexport function flatten (array: any[], ret: any[]) {\n  ret = defaults(ret, [])\n  for (let i = 0; i < array.length; i++) {\n    if (Array.isArray(array[i])) {\n      flatten(array[i], ret)\n    } else {\n      ret.push(array[i])\n    }\n  }\n  return ret\n}\n\nexport function getProtocol () {\n  const protocol = window.location.protocol\n  return protocol.match(/http(s)?:/gi) === null ? 'http:' : protocol\n}\n\nexport function getBrowser () {\n  if (typeof window === 'undefined') return false\n\n  const ua = window.navigator.userAgent\n\n  if (/Opera|OPR/.test(ua)) {\n    return 'Opera'\n  } else if (/Chrome/i.test(ua)) {\n    return 'Chrome'\n  } else if (/Firefox/i.test(ua)) {\n    return 'Firefox'\n  } else if (/Mobile(\\/.*)? Safari/i.test(ua)) {\n    return 'Mobile Safari'\n  } else if (/MSIE/i.test(ua)) {\n    return 'Internet Explorer'\n  } else if (/Safari/i.test(ua)) {\n    return 'Safari'\n  }\n\n  return false\n}\n\nexport function getAbsolutePath (relativePath: string) {\n  const loc = window.location\n  const pn = loc.pathname\n  const basePath = pn.substring(0, pn.lastIndexOf('/') + 1)\n\n  return loc.origin + basePath + relativePath\n}\n\nexport function deepCopy (src: any) {\n  if (typeof src !== 'object') {\n    return src\n  }\n\n  const dst: { [index: string]: any } = Array.isArray(src) ? [] : {}\n\n  for (let key in src) {\n    dst[ key ] = deepCopy(src[ key ])\n  }\n\n  return dst\n}\n\nexport function deepEqual(a: any, b: any) {\n  // from https://github.com/epoberezkin/fast-deep-equal MIT\n  if (a === b) return true;\n\n  const arrA = Array.isArray(a)\n  const arrB = Array.isArray(b)\n\n  if (arrA && arrB) {\n    if (a.length !== b.length) return false\n    for (let i = 0; i < a.length; i++) {\n      if (!deepEqual(a[i], b[i])) return false\n    }\n    return true\n  }\n\n  if (arrA !== arrB) return false\n\n  if (a && b && typeof a === 'object' && typeof b === 'object') {\n    const keys = Object.keys(a)\n    if (keys.length !== Object.keys(b).length) return false;\n\n    const dateA = a instanceof Date\n    const dateB = b instanceof Date\n    if (dateA && dateB) return a.getTime() === b.getTime()\n    if (dateA !== dateB) return false\n\n    const regexpA = a instanceof RegExp\n    const regexpB = b instanceof RegExp\n    if (regexpA && regexpB) return a.toString() === b.toString()\n    if (regexpA !== regexpB) return false\n\n    for (let i = 0; i < keys.length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false\n    }\n\n    for (let i = 0; i < keys.length; i++) {\n      if(!deepEqual(a[keys[i]], b[keys[i]])) return false\n    }\n\n    return true\n  }\n\n  return false\n}\n\nfunction openUrl (url: string) {\n  const opened = window.open(url, '_blank')\n  if (!opened) {\n    window.location.href = url\n  }\n}\n\nexport function download (data: Blob|string, downloadName = 'download') {\n  // using ideas from https://github.com/eligrey/FileSaver.js/blob/master/FileSaver.js\n\n  if (!data) return\n\n  const isSafari = getBrowser() === 'Safari'\n  const isChromeIos = /CriOS\\/[\\d]+/.test(window.navigator.userAgent)\n\n  const a = document.createElement('a')\n\n  function open (str: string) {\n    openUrl(isChromeIos ? str : str.replace(/^data:[^;]*;/, 'data:attachment/file;'))\n  }\n\n  if (typeof navigator !== 'undefined' && (navigator as any).msSaveOrOpenBlob) {\n    // native saveAs in IE 10+\n    (navigator as any).msSaveOrOpenBlob(data, downloadName)\n  } else if ((isSafari || isChromeIos) && FileReader) {\n    if (data instanceof Blob) {\n      // no downloading of blob urls in Safari\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        open(reader.result as string)\n      }\n      reader.readAsDataURL(data)\n    } else {\n      open(data)\n    }\n  } else {\n    let objectUrlCreated = false\n    if (data instanceof Blob) {\n      data = URL.createObjectURL(data)\n      objectUrlCreated = true\n    }\n\n    if ('download' in a) {\n      // download link available\n      a.style.display = 'hidden'\n      document.body.appendChild(a)\n      a.href = data\n      a.download = downloadName\n      a.target = '_blank'\n      a.click()\n      document.body.removeChild(a)\n    } else {\n      openUrl(data)\n    }\n\n    if (objectUrlCreated) {\n      window.URL.revokeObjectURL(data)\n    }\n  }\n}\n\nexport function submit (url: string, data: FormData, callback: Function, onerror: Function) {\n  const xhr = new XMLHttpRequest()\n  xhr.open('POST', url)\n\n  xhr.addEventListener('load', function () {\n    if (xhr.status === 200 || xhr.status === 304) {\n      callback(xhr.response)\n    } else {\n      if (typeof onerror === 'function') {\n        onerror(xhr.status)\n      }\n    }\n  }, false)\n\n  xhr.send(data)\n}\n\ninterface HTMLInputEvent extends Event {\n  target: HTMLInputElement & EventTarget\n}\n\nexport function open (callback: Function, extensionList = ['*']) {\n  const fileInput = document.createElement('input')\n  fileInput.type = 'file'\n  fileInput.multiple = true\n  fileInput.style.display = 'hidden'\n  document.body.appendChild(fileInput)\n  fileInput.accept = '.' + extensionList.join(',.')\n  fileInput.addEventListener('change', function (e: HTMLInputEvent) {\n    callback(e.target.files)\n  }, false)\n\n  fileInput.click()\n}\n\nexport function throttle (func: Function, wait: number, options: { leading?: boolean, trailing?: boolean }) {\n  // from http://underscorejs.org/docs/underscore.html\n\n  let context: any\n  let args: any\n  let result: any\n  let timeout: any = null\n  let previous = 0\n\n  if (!options) options = {}\n\n  function later () {\n    previous = options.leading === false ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n\n  return function throttle (this: any) {\n    var now = Date.now()\n    if (!previous && options.leading === false) previous = now\n    var remaining = wait - (now - previous)\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n\n    return result\n  }\n}\n\nexport function lexicographicCompare<T> (elm1: T, elm2: T) {\n  if (elm1 < elm2) return -1\n  if (elm1 > elm2) return 1\n  return 0\n}\n\n/**\n * Does a binary search to get the index of an element in the input array\n * @function\n * @example\n * var array = [ 1, 2, 3, 4, 5, 6 ];\n * var element = 4;\n * binarySearchIndexOf( array, element );  // returns 3\n *\n * @param {Array} array - sorted array\n * @param {Anything} element - element to search for in the array\n * @param {Function} [compareFunction] - compare function\n * @return {Number} the index of the element or -1 if not in the array\n */\nexport function binarySearchIndexOf<T> (array: T[], element: T, compareFunction = lexicographicCompare) {\n  let low = 0\n  let high = array.length - 1\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    const cmp = compareFunction(element, array[ mid ])\n    if (cmp > 0) {\n      low = mid + 1\n    } else if (cmp < 0) {\n      high = mid - 1\n    } else {\n      return mid\n    }\n  }\n  return -low - 1\n}\n\nexport function binarySearchForLeftRange (array: number[], leftRange: number) {\n  let high = array.length - 1\n  if (array[ high ] < leftRange) return -1\n  let low = 0\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    if (array[ mid ] >= leftRange) {\n      high = mid - 1\n    } else {\n      low = mid + 1\n    }\n  }\n  return high + 1\n}\n\nexport function binarySearchForRightRange (array: number[], rightRange: number) {\n  if (array[ 0 ] > rightRange) return -1\n  let low = 0\n  let high = array.length - 1\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    if (array[ mid ] > rightRange) {\n      high = mid - 1\n    } else {\n      low = mid + 1\n    }\n  }\n  return low - 1\n}\n\nexport function rangeInSortedArray (array: number[], min: number, max: number) {\n  const indexLeft = binarySearchForLeftRange(array, min)\n  const indexRight = binarySearchForRightRange(array, max)\n  if (indexLeft === -1 || indexRight === -1 || indexLeft > indexRight) {\n    return 0\n  } else {\n    return indexRight - indexLeft + 1\n  }\n}\n\nexport function dataURItoImage (dataURI: string) {\n  const img = document.createElement('img')\n  img.src = dataURI\n  return img\n}\n\nexport function uniqueArray (array: any[]) {\n  return array.sort().filter(function (value, index, sorted) {\n    return (index === 0) || (value !== sorted[ index - 1 ])\n  })\n}\n\n// String/arraybuffer conversion\n\nexport function uint8ToString (u8a: Uint8Array) {\n  const chunkSize = 0x7000\n\n  if (u8a.length > chunkSize) {\n    const c = []\n\n    for (let i = 0; i < u8a.length; i += chunkSize) {\n      c.push(String.fromCharCode.apply(\n        null, u8a.subarray(i, i + chunkSize)\n      ))\n    }\n\n    return c.join('')\n  } else {\n    return String.fromCharCode.apply(null, u8a)\n  }\n}\n\nexport function uint8ToLines (u8a: Uint8Array, chunkSize = 1024 * 1024 * 10, newline = '\\n') {\n  let partialLine = ''\n  let lines: string[] = []\n\n  for (let i = 0; i < u8a.length; i += chunkSize) {\n    const str = uint8ToString(u8a.subarray(i, i + chunkSize))\n    const idx = str.lastIndexOf(newline)\n\n    if (idx === -1) {\n      partialLine += str\n    } else {\n      const str2 = partialLine + str.substr(0, idx)\n      lines = lines.concat(str2.split(newline))\n\n      if (idx === str.length - newline.length) {\n        partialLine = ''\n      } else {\n        partialLine = str.substr(idx + newline.length)\n      }\n    }\n  }\n\n  if (partialLine !== '') {\n    lines.push(partialLine)\n  }\n\n  return lines\n}\n\nexport type TypedArrayString = 'int8'|'int16'|'int32'|'uint8'|'uint16'|'uint32'|'float32'\nexport function getTypedArray (arrayType: TypedArrayString, arraySize: number) {\n  switch (arrayType) {\n    case 'int8':\n      return new Int8Array(arraySize)\n    case 'int16':\n      return new Int16Array(arraySize)\n    case 'int32':\n      return new Int32Array(arraySize)\n    case 'uint8':\n      return new Uint8Array(arraySize)\n    case 'uint16':\n      return new Uint16Array(arraySize)\n    case 'uint32':\n      return new Uint32Array(arraySize)\n    case 'float32':\n      return new Float32Array(arraySize)\n    default:\n      throw new Error('arrayType unknown: ' + arrayType)\n  }\n}\n\nexport function getUintArray (sizeOrArray: any, maxUint: number) {  // TODO\n  const TypedArray = maxUint > 65535 ? Uint32Array : Uint16Array\n  return new TypedArray(sizeOrArray)\n}\n\nexport function ensureArray (value: any) {\n  return Array.isArray(value) ? value : [value]\n}\n\nexport function ensureBuffer (a: any) {  // TODO\n  return (a.buffer && a.buffer instanceof ArrayBuffer) ? a.buffer : a\n}\n\nfunction _ensureClassFromArg (arg: any, constructor: { new (arg: any): any }) {\n  return arg instanceof constructor ? arg : new constructor(arg)\n}\n\nfunction _ensureClassFromArray (array: any, constructor: { new (): any }) {\n  if (array === undefined) {\n    array = new constructor()\n  } else if (Array.isArray(array)) {\n    array = new constructor().fromArray(array)\n  }\n  return array\n}\n\nexport function ensureVector2 (v?: number[]|Vector2) {\n  return _ensureClassFromArray(v, Vector2)\n}\n\nexport function ensureVector3 (v?: number[]|Vector3) {\n  return _ensureClassFromArray(v, Vector3)\n}\n\nexport function ensureMatrix4 (m?: number[]|Matrix4) {\n  return _ensureClassFromArray(m, Matrix4)\n}\n\nexport function ensureQuaternion (q?: number[]|Quaternion) {\n  return _ensureClassFromArray(q, Quaternion)\n}\n\nexport function ensureFloat32Array (a?: number[]|Float32Array) {\n  return _ensureClassFromArg(a, Float32Array)\n}\n\nexport interface RingBuffer<T> {\n  has: (value: T) => boolean\n  get: (value: number) => T\n  push: (value: T) => void\n  count: number\n  data: T[]\n  clear: () => void\n}\n\nexport function createRingBuffer<T> (length: number): RingBuffer<T> {\n  let pointer = 0\n  let count = 0\n  const buffer: T[] = []\n\n  return {\n    has: function (value: any) { return buffer.indexOf(value) !== -1 },\n    get: function (idx: number) { return buffer[idx] },\n    push: function (item: any) {\n      buffer[pointer] = item\n      pointer = (length + pointer + 1) % length\n      ++count\n    },\n    get count () { return count },\n    get data () { return buffer.slice(0, Math.min(count, length)) },\n    clear: function () {\n      count = 0\n      pointer = 0\n      buffer.length = 0\n    }\n  }\n}\n\nexport interface SimpleDict<K, V> {\n  has: (k: K) => boolean\n  add: (k: K, v: V) => void\n  del: (k: K) => void\n  values: V[]\n}\n\nexport function createSimpleDict<K, V> (): SimpleDict<K, V> {\n  const set: { [k: string]: V } = {}\n\n  return {\n    has: function (k: K) { return set[JSON.stringify(k)] !== undefined },\n    add: function (k: K, v: V) { set[JSON.stringify(k)] = v },\n    del: function (k: K) { delete set[JSON.stringify(k)] },\n    get values () { return Object.keys(set).map(k => set[k]) }\n  }\n}\n\nexport interface SimpleSet<T> {\n  has: (value: T) => boolean\n  add: (value: T) => void\n  del: (value: T) => void\n  list: T[]\n}\n\nexport function createSimpleSet<T> (): SimpleSet<T> {\n  const set: { [k: string]: T } = {}\n\n  return {\n    has: function (v: T) { return set[JSON.stringify(v)] !== undefined },\n    add: function (v: T) { set[JSON.stringify(v)] = v },\n    del: function (v: T) { delete set[JSON.stringify(v)] },\n    get list () { return Object.keys(set).map(k => set[k]) },\n  }\n}\n","/**\n * @file Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\n\nfunction toLowerCaseString (value: string) {\n  return defaults(value, '').toString().toLowerCase()\n}\n\nexport default class Registry {\n  name: string\n  private _dict: {[k: string]: any}\n\n  constructor (name: string) {\n    this.name = name\n    this._dict = {}\n  }\n\n  add (key: string, value: any) {\n    this._dict[ toLowerCaseString(key) ] = value\n  }\n\n  get (key: string) {\n    return this._dict[ toLowerCaseString(key) ]\n  }\n\n  get names () {\n    return Object.keys(this._dict)\n  }\n}","/**\n * @file Math Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport function degToRad (deg: number) {\n  return deg * 0.01745  // deg * Math.PI / 180\n}\n\nexport function radToDeg (rad: number) {\n  return rad * 57.29578  // rad * 180 / Math.PI\n}\n\n// http://www.broofa.com/Tools/Math.uuid.htm\nconst chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('')\nconst uuid = new Array(36)\n\nexport function generateUUID () {\n  let rnd = 0\n  let r\n\n  for (let i = 0; i < 36; i++) {\n    if (i === 8 || i === 13 || i === 18 || i === 23) {\n      uuid[ i ] = '-'\n    } else if (i === 14) {\n      uuid[ i ] = '4'\n    } else {\n      if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0\n      r = rnd & 0xf\n      rnd = rnd >> 4\n      uuid[ i ] = chars[ (i === 19) ? (r & 0x3) | 0x8 : r ]\n    }\n  }\n\n  return uuid.join('')\n}\n\nexport function countSetBits (i: number) {\n  i = i - ((i >> 1) & 0x55555555)\n  i = (i & 0x33333333) + ((i >> 2) & 0x33333333)\n  return (((i + (i >> 4)) & 0x0F0F0F0F) * 0x01010101) >> 24\n}\n\nexport function normalize (value: number, min: number, max: number) {\n  return (value - min) / (max - min)\n}\n\nexport function clamp (value: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, value))\n}\n\nexport function pclamp (value: number) {\n  return clamp(value, 0, 100)\n}\n\nexport function saturate (value: number) {\n  return clamp(value, 0, 1)\n}\n\nexport function lerp (start: number, stop: number, alpha: number) {\n  return start + (stop - start) * alpha\n}\n\nexport function spline (p0: number, p1: number, p2: number, p3: number, t: number, tension: number) {\n  const v0 = (p2 - p0) * tension\n  const v1 = (p3 - p1) * tension\n  const t2 = t * t\n  const t3 = t * t2\n  return (2 * p1 - 2 * p2 + v0 + v1) * t3 +\n         (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 +\n         v0 * t + p1\n}\n\nexport function smoothstep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return x * x * (3 - 2 * x)\n}\n\nexport function smootherstep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return x * x * x * (x * (x * 6 - 15) + 10)\n}\n\nexport function smootheststep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return (\n    -20 * Math.pow(x, 7) +\n     70 * Math.pow(x, 6) -\n     84 * Math.pow(x, 5) +\n     35 * Math.pow(x, 4)\n  )\n}\n\nexport function almostIdentity (value: number, start: number, stop: number) {\n  if (value > start) return value\n  const a = 2 * stop - start\n  const b = 2 * start - 3 * stop\n  const t = value / start\n  return (a * t + b) * t * t + stop\n}","/**\n * @file Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color } from 'three'\nimport * as chroma from 'chroma-js'\n\nimport { createParams } from '../utils'\nimport { NumberArray } from '../types'\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\nexport type ColorMode = 'rgb'|'hsv'|'hsl'|'hsi'|'lab'|'hcl'\nexport type ColorSpace = 'sRGB' | 'linear'\n\n/**\n * Internal color space for all colors (global).\n * Colors are always specified as sRGB; if this is set to\n * 'linear' then colors get linearized when used internally\n * as vertex or texture colors.\n * @see setColorSpace/getColorSpace.\n */\nvar colorSpace: ColorSpace = 'sRGB' // default: don't linearize\n\n/** Set the global internal color space for colormakers */\nexport function setColorSpace(space: ColorSpace) {\n  colorSpace = space\n}\n\n/** Get the global internal color space for colormakers */\nexport function getColorSpace() {\n  return colorSpace\n}\n\nexport const ScaleDefaultParameters = {\n  scale: 'uniform' as string|string[],\n  mode: 'hcl' as ColorMode,\n  domain: [ 0, 1 ] as number[],\n  value: 0xFFFFFF,\n  reverse: false,\n}\nexport type ScaleParameters = typeof ScaleDefaultParameters\n\nexport interface ColorData {\n  atomData?: number[],\n  bondData?: number[]\n}\n\nexport interface ColormakerParameters extends ScaleParameters {\n  structure?: Structure\n  volume?: Volume\n  surface?: Surface\n  data?: ColorData\n}\n\nexport type StuctureColormakerParams = { structure: Structure } & Partial<ColormakerParameters>\nexport type VolumeColormakerParams = { volume: Volume } & Partial<ColormakerParameters>\nexport type ColormakerScale = (v: number) => number\nexport type ColormakerConstructor = new (...p: ConstructorParameters<typeof Colormaker>) => Colormaker\n\nconst tmpColor = new Color()\n\n/** Decorator for optionally linearizing a numeric color */\ntype colorFuncType = (value: any, fromTo?: boolean) => number // decorator applies to functions with this shape\nexport function manageColor<T extends {parameters: ColormakerParameters}>\n  (_target: Object,\n   _name: string | symbol,\n   descriptor: TypedPropertyDescriptor<colorFuncType>): PropertyDescriptor {\n    const originalMethod = descriptor.value\n    const linearize: colorFuncType = function (this: T, value: any, fromTo?: boolean) {\n      let result = originalMethod!.bind(this, value, fromTo)()\n      if (colorSpace == 'linear') {\n        tmpColor.set(result)\n        tmpColor.convertSRGBToLinear()\n        return tmpColor.getHex()\n      } else {\n        return result\n      }\n    }\n    descriptor.value = linearize\n    return descriptor\n  }\n\n/**\n * Class for making colors.\n * @interface\n */\nabstract class Colormaker {\n  parameters: ColormakerParameters\n  atomProxy?: AtomProxy\n\n  /**\n   * Create a colormaker instance\n   * @param  {ColormakerParameters} params - colormaker parameter\n   */\n  constructor (params: Partial<ColormakerParameters> = {}) {\n    this.parameters = createParams(params, ScaleDefaultParameters)\n\n    if (typeof this.parameters.value === 'string') {\n      this.parameters.value = tmpColor.set(this.parameters.value).getHex()\n    }\n\n    if (this.parameters.structure) {\n      this.atomProxy = this.parameters.structure.getAtomProxy()\n    }\n  }\n\n  getScale (params: Partial<ScaleParameters> = {}) {\n    const p = createParams(params, this.parameters)\n\n    if (p.scale === 'rainbow') {\n      p.scale = [ 'red', 'orange', 'yellow', 'green', 'blue' ]\n    } else if (p.scale === 'rwb') {\n      p.scale = [ 'red', 'white', 'blue' ]\n    }\n\n    if (p.reverse) {\n      p.domain = p.domain.slice().reverse()\n    }\n    return chroma\n      .scale(p.scale as any)  // TODO\n      .mode(p.mode)\n      .domain(p.domain)\n      .out('num' as any)  // returns RGB color as numeric (not string \"#ffffff\")\n  }\n\n  /**\n   * save a color to an array\n   * @param  {Integer} color - hex color value\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  colorToArray (color: number, array: NumberArray = [], offset = 0) {\n    array[ offset ] = (color >> 16 & 255) / 255\n    array[ offset + 1 ] = (color >> 8 & 255) / 255\n    array[ offset + 2 ] = (color & 255) / 255\n\n    return array\n  }\n\n  atomColor? (atom: AtomProxy): number\n\n  /**\n   * save an atom color to an array\n   * @param  {AtomProxy} atom - atom to get color for\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  atomColorToArray (atom: AtomProxy, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.atomColor ? this.atomColor(atom) : 0x000000, array, offset\n    )\n  }\n\n  /**\n   * return the color for an bond\n   * @param  {BondProxy} bond - bond to get color for\n   * @param  {Boolean} fromTo - whether to use the first or second atom of the bond\n   * @return {Integer} hex bond color\n   */\n  bondColor (bond: BondProxy, fromTo: boolean) {\n    if (this.atomProxy && this.atomColor) {\n      this.atomProxy.index = fromTo ? bond.atomIndex1 : bond.atomIndex2\n      return this.atomColor(this.atomProxy)\n    } else {\n      return 0x000000\n    }\n  }\n\n  /**\n   * safe a bond color to an array\n   * @param  {BondProxy} bond - bond to get color for\n   * @param  {Boolean} fromTo - whether to use the first or second atom of the bond\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  bondColorToArray (bond: BondProxy, fromTo: boolean, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.bondColor(bond, fromTo), array, offset\n    )\n  }\n\n  volumeColor? (index: number): number\n\n  /**\n   * safe a volume cell color to an array\n   * @param  {Integer} index - volume cell index\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  volumeColorToArray (index: number, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.volumeColor ? this.volumeColor(index) : 0x000000, array, offset\n    )\n  }\n\n  positionColor? (position: Vector3): number\n\n  /**\n   * safe a color for coordinates in space to an array\n   * @param  {Vector3} coords - xyz coordinates\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  positionColorToArray (coords: Vector3, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.positionColor ? this.positionColor(coords) : 0x000000, array, offset\n    )\n  }\n}\n\nexport default Colormaker\n","/**\n * @file Selection Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport enum kwd {\n  PROTEIN = 1,\n  NUCLEIC = 2,\n  RNA = 3,\n  DNA = 4,\n  POLYMER = 5,\n  WATER = 6,\n  HELIX = 7,\n  SHEET = 8,\n  TURN = 9,\n  BACKBONE = 10,\n  SIDECHAIN = 11,\n  ALL = 12,\n  HETERO = 13,\n  ION = 14,\n  SACCHARIDE = 15,\n  SUGAR = 15,\n  BONDED = 16,\n  RING = 17,\n  AROMATICRING = 18,\n  METAL = 19,\n  POLARH = 20,\n  NONE = 21\n}\n\nexport const SelectAllKeyword = [ '*', '', 'ALL' ]\nexport const SelectNoneKeyword = [ 'NONE' ]\n\nexport const AtomOnlyKeywords = [\n  kwd.BACKBONE, kwd.SIDECHAIN, kwd.BONDED, kwd.RING, kwd.AROMATICRING, kwd.METAL, kwd.POLARH\n]\n\nexport const ChainKeywords = [\n  kwd.POLYMER, kwd.WATER\n]\n\nexport const SmallResname = [ 'ALA', 'GLY', 'SER' ]\nexport const NucleophilicResname = [ 'CYS', 'SER', 'THR' ]\nexport const HydrophobicResname = [ 'ALA', 'ILE', 'LEU', 'MET', 'PHE', 'PRO', 'TRP', 'VAL' ]\nexport const AromaticResname = [ 'PHE', 'TRP', 'TYR', 'HIS' ]\nexport const AmideResname = [ 'ASN', 'GLN' ]\nexport const AcidicResname = [ 'ASP', 'GLU' ]\nexport const BasicResname = [ 'ARG', 'HIS', 'LYS' ]\nexport const ChargedResname = [ 'ARG', 'ASP', 'GLU', 'HIS', 'LYS' ]\nexport const PolarResname = [ 'ASN', 'ARG', 'ASP', 'CYS', 'GLY', 'GLN', 'GLU', 'HIS', 'LYS', 'SER', 'THR', 'TYR' ]\nexport const NonpolarResname = [ 'ALA', 'ILE', 'LEU', 'MET', 'PHE', 'PRO', 'TRP', 'VAL' ]\nexport const CyclicResname = [ 'HIS', 'PHE', 'PRO', 'TRP', 'TYR' ]\nexport const AliphaticResname = [ 'ALA', 'GLY', 'ILE', 'LEU', 'VAL' ]\n","/**\n * @file Selection Test\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { binarySearchIndexOf, rangeInSortedArray } from '../utils'\nimport { kwd, AtomOnlyKeywords, ChainKeywords } from './selection-constants'\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ProxyEntity = AtomProxy|ResidueProxy|ChainProxy|ModelProxy\ntype TestEntityFn = (e: ProxyEntity, s: SelectionRule) => boolean|-1\ntype FilterFn = (s: SelectionRule) => boolean\nexport type SelectionTest = false|((e: ProxyEntity) => boolean|-1)\n\nexport type SelectionOperator = 'AND'|'OR'\nexport interface SelectionRule {\n  keyword?: any\n  atomname?: string\n  element?: string\n  atomindex?: number[]\n  altloc?: string\n  inscode?: string\n  resname?: string|string[]\n  sstruc?: string\n  resno?: number|[number, number]\n  chainname?: string\n  model?: number\n\n  error?: string\n  rules?: SelectionRule[]\n  negate?: boolean\n  operator?: SelectionOperator\n}\n\nfunction atomTestFn (a: AtomProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.atomname === undefined && s.element === undefined &&\n    s.altloc === undefined && s.atomindex === undefined &&\n    s.keyword === undefined && s.inscode === undefined &&\n    s.resname === undefined && s.sstruc === undefined &&\n    s.resno === undefined && s.chainname === undefined &&\n    s.model === undefined\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.BACKBONE && !a.isBackbone()) return false\n    if (s.keyword === kwd.SIDECHAIN && !a.isSidechain()) return false\n    if (s.keyword === kwd.BONDED && !a.isBonded()) return false\n    if (s.keyword === kwd.RING && !a.isRing()) return false\n    if (s.keyword === kwd.AROMATICRING && !a.isAromatic()) return false\n\n    if (s.keyword === kwd.HETERO && !a.isHetero()) return false\n    if (s.keyword === kwd.PROTEIN && !a.isProtein()) return false\n    if (s.keyword === kwd.NUCLEIC && !a.isNucleic()) return false\n    if (s.keyword === kwd.RNA && !a.isRna()) return false\n    if (s.keyword === kwd.DNA && !a.isDna()) return false\n    if (s.keyword === kwd.POLYMER && !a.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !a.isWater()) return false\n    if (s.keyword === kwd.HELIX && !a.isHelix()) return false\n    if (s.keyword === kwd.SHEET && !a.isSheet()) return false\n    if (s.keyword === kwd.TURN && !a.isTurn()) return false\n    if (s.keyword === kwd.ION && !a.isIon()) return false\n    if (s.keyword === kwd.SACCHARIDE && !a.isSaccharide()) return false\n    if (s.keyword === kwd.METAL && !a.isMetal()) return false\n    if (s.keyword === kwd.POLARH && !a.isPolarHydrogen()) return false\n  }\n\n  if (s.atomname !== undefined && s.atomname !== a.atomname) return false\n  if (s.element !== undefined && s.element !== a.element) return false\n  if (s.altloc !== undefined && s.altloc !== a.altloc) return false\n\n  if (s.atomindex !== undefined &&\n      binarySearchIndexOf(s.atomindex, a.index) < 0\n  ) return false\n\n  if (s.resname !== undefined) {\n    if (Array.isArray(s.resname)) {\n      if (!s.resname.includes(a.resname)) return false\n    } else {\n      if (s.resname !== a.resname) return false\n    }\n  }\n  if (s.sstruc !== undefined && s.sstruc !== a.sstruc) return false\n  if (s.resno !== undefined) {\n    if (Array.isArray(s.resno) && s.resno.length === 2) {\n      if (s.resno[0] > a.resno || s.resno[1] < a.resno) return false\n    } else {\n      if (s.resno !== a.resno) return false\n    }\n  }\n  if (s.inscode !== undefined && s.inscode !== a.inscode) return false\n\n  if (s.chainname !== undefined && s.chainname !== a.chainname) return false\n  if (s.model !== undefined && s.model !== a.modelIndex) return false\n\n  return true\n}\n\nfunction residueTestFn (r: ResidueProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.resname === undefined && s.resno === undefined && s.inscode === undefined &&\n      s.sstruc === undefined && s.model === undefined && s.chainname === undefined &&\n      s.atomindex === undefined &&\n      (s.keyword === undefined || AtomOnlyKeywords.includes(s.keyword))\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.HETERO && !r.isHetero()) return false\n    if (s.keyword === kwd.PROTEIN && !r.isProtein()) return false\n    if (s.keyword === kwd.NUCLEIC && !r.isNucleic()) return false\n    if (s.keyword === kwd.RNA && !r.isRna()) return false\n    if (s.keyword === kwd.DNA && !r.isDna()) return false\n    if (s.keyword === kwd.POLYMER && !r.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !r.isWater()) return false\n    if (s.keyword === kwd.HELIX && !r.isHelix()) return false\n    if (s.keyword === kwd.SHEET && !r.isSheet()) return false\n    if (s.keyword === kwd.TURN && !r.isTurn()) return false\n    if (s.keyword === kwd.ION && !r.isIon()) return false\n    if (s.keyword === kwd.SACCHARIDE && !r.isSaccharide()) return false\n  }\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, r.atomOffset, r.atomEnd) === 0\n  ) return false\n\n  if (s.resname !== undefined) {\n    if (Array.isArray(s.resname)) {\n      if (!s.resname.includes(r.resname)) return false\n    } else {\n      if (s.resname !== r.resname) return false\n    }\n  }\n  if (s.sstruc !== undefined && s.sstruc !== r.sstruc) return false\n  if (s.resno !== undefined) {\n    if (Array.isArray(s.resno) && s.resno.length === 2) {\n      if (s.resno[0] > r.resno || s.resno[1] < r.resno) return false\n    } else {\n      if (s.resno !== r.resno) return false\n    }\n  }\n  if (s.inscode !== undefined && s.inscode !== r.inscode) return false\n\n  if (s.chainname !== undefined && s.chainname !== r.chainname) return false\n  if (s.model !== undefined && s.model !== r.modelIndex) return false\n\n  return true\n}\n\nfunction chainTestFn (c: ChainProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.chainname === undefined && s.model === undefined && s.atomindex === undefined &&\n      (s.keyword === undefined || !ChainKeywords.includes(s.keyword) || !c.entity)\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.POLYMER && !c.entity.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !c.entity.isWater()) return false\n  }\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, c.atomOffset, c.atomEnd) === 0\n  ) return false\n\n  if (s.chainname !== undefined && s.chainname !== c.chainname) return false\n\n  if (s.model !== undefined && s.model !== c.modelIndex) return false\n\n  return true\n}\n\nfunction modelTestFn (m: ModelProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.model === undefined && s.atomindex === undefined) return -1\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, m.atomOffset, m.atomEnd) === 0\n  ) return false\n\n  if (s.model !== undefined && s.model !== m.index) return false\n\n  return true\n}\n\nfunction makeTest (selection: SelectionRule|null, fn: TestEntityFn) {\n  if (selection === null) return false\n  if (selection.error) return false\n  if (!selection.rules || selection.rules.length === 0) return false\n\n  const n = selection.rules.length\n\n  const t = !selection.negate\n  const f = !!selection.negate\n\n  const subTests: SelectionTest[] = []\n  for (let i = 0; i < n; ++i) {\n    const s = selection.rules[ i ]\n    if (s.hasOwnProperty('operator')) {\n      subTests[ i ] = makeTest(s, fn) as SelectionTest  // TODO\n    }\n  }\n\n  // ( x and y ) can short circuit on false\n  // ( x or y ) can short circuit on true\n  // not ( x and y )\n\n  return function test (entity: ProxyEntity) {\n    const and = selection.operator === 'AND'\n    let na = false\n\n    for (let i = 0; i < n; ++i) {\n      const s = selection.rules![ i ]  // TODO\n      let ret\n\n      if (s.hasOwnProperty('operator')) {\n        const test = subTests[ i ]\n        if (test !== false) {\n          ret = test(entity)\n        } else {\n          ret = -1\n        }\n\n        if (ret === -1) {\n          na = true\n          continue\n        } else if (ret === true) {\n          if (and) { continue } else { return t }\n        } else {\n          if (and) { return f } else { continue }\n        }\n      } else {\n        if (s.keyword === kwd.ALL) {\n          if (and) { continue } else { return t }\n        } else if (s.keyword === kwd.NONE) {\n          if (and) { continue } else { return f }\n        }\n\n        ret = fn(entity, s)\n\n        // console.log( entity.qualifiedName(), ret, s, selection.negate, \"t\", t, \"f\", f )\n\n        if (ret === -1) {\n          na = true\n          continue\n        } else if (ret === true) {\n          if (and) { continue } else { return t }\n        } else {\n          if (and) { return f } else { continue }\n        }\n      }\n    }\n\n    if (na) {\n      return -1\n    } else {\n      if (and) { return t } else { return f }\n    }\n  } as SelectionTest\n}\n\nfunction filter (selection: SelectionRule, fn: FilterFn) {\n  if (selection.error) return selection\n    if (!selection.rules || selection.rules.length === 0) return selection\n\n  const n = selection.rules.length\n\n  const filtered: SelectionRule = {\n    operator: selection.operator,\n    rules: []\n  }\n  if (selection.hasOwnProperty('negate')) {\n    filtered.negate = selection.negate\n  }\n\n  for (let i = 0; i < n; ++i) {\n    const s = selection.rules[ i ]\n    if (s.hasOwnProperty('operator')) {\n      const fs = filter(s, fn)\n      if (fs !== null) filtered.rules!.push(fs)  // TODO\n    } else if (!fn(s)) {\n      filtered.rules!.push(s)  // TODO\n    }\n  }\n\n  if (filtered.rules!.length > 0) {  // TODO\n    // TODO maybe the filtered rules could be returned\n    // in some case, but the way how tests are applied\n    // e.g. when traversing a structure would also need\n    // to change\n    return selection\n    // return filtered;\n  } else {\n    return null\n  }\n}\n\nfunction makeAtomTest (selection: SelectionRule, atomOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (atomOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && !AtomOnlyKeywords.includes(s.keyword)) return true\n      if (s.model !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, atomTestFn)\n}\n\nfunction makeResidueTest (selection: SelectionRule, residueOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (residueOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && AtomOnlyKeywords.includes(s.keyword)) return true\n      if (s.model !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, residueTestFn)\n}\n\nfunction makeChainTest (selection: SelectionRule, chainOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (chainOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && !ChainKeywords.includes(s.keyword)) return true\n      // if( s.model!==undefined ) return true;\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      if (s.inscode !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, chainTestFn)\n}\n\nfunction makeModelTest (selection: SelectionRule, modelOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (modelOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      if (s.inscode !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, modelTestFn)\n}\n\nexport {\n  makeAtomTest,\n  makeResidueTest,\n  makeChainTest,\n  makeModelTest\n}\n","/**\n * @file Selection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { parseSele } from './selection-parser'\nimport {\n  SelectionTest, SelectionRule,\n  makeAtomTest, makeResidueTest, makeChainTest, makeModelTest\n} from './selection-test'\nimport { SelectAllKeyword, SelectNoneKeyword } from './selection-constants'\n\nexport type SelectionSignals = {\n  stringChanged: Signal\n}\n\n/**\n * Selection\n */\nclass Selection {\n  signals: SelectionSignals\n  string: string\n  selection: SelectionRule\n\n  test: SelectionTest\n  residueTest: SelectionTest\n  chainTest: SelectionTest\n  modelTest: SelectionTest\n\n  atomOnlyTest: SelectionTest\n  residueOnlyTest: SelectionTest\n  chainOnlyTest: SelectionTest\n  modelOnlyTest: SelectionTest\n\n  /**\n   * Create Selection\n   * @param {String} string - selection string, see {@tutorial selection-language}\n   */\n  constructor (string?: string) {\n    this.signals = {\n      stringChanged: new Signal()\n    }\n\n    this.setString(string)\n  }\n\n  get type () { return 'selection' }\n\n  setString (string?: string, silent?: boolean) {\n    if (string === undefined) string = this.string || ''\n    if (string === this.string) return\n\n    try {\n      this.selection = parseSele(string)\n    } catch (e) {\n      // Log.error( e.stack );\n      this.selection = { 'error': e.message }\n    }\n    const selection = this.selection\n\n    this.string = string\n\n    this.test = makeAtomTest(selection)\n    this.residueTest = makeResidueTest(selection)\n    this.chainTest = makeChainTest(selection)\n    this.modelTest = makeModelTest(selection)\n\n    this.atomOnlyTest = makeAtomTest(selection, true)\n    this.residueOnlyTest = makeResidueTest(selection, true)\n    this.chainOnlyTest = makeChainTest(selection, true)\n    this.modelOnlyTest = makeModelTest(selection, true)\n\n    if (!silent) {\n      this.signals.stringChanged.dispatch(this.string)\n    }\n  }\n\n  isAllSelection () {\n    return SelectAllKeyword.includes(this.string.toUpperCase())\n  }\n\n  isNoneSelection () {\n    return SelectNoneKeyword.includes(this.string.toUpperCase())\n  }\n}\n\nexport default Selection\n","/**\n * @file Selection Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { SelectionRule, SelectionOperator } from './selection-test'\nimport {\n  kwd, SelectAllKeyword,\n  SmallResname, NucleophilicResname, HydrophobicResname, AromaticResname,\n  AmideResname, AcidicResname, BasicResname, ChargedResname,\n  PolarResname, NonpolarResname, CyclicResname, AliphaticResname\n} from './selection-constants'\n\nfunction parseSele (string: string) {\n  let retSelection: SelectionRule = {\n    operator: undefined,\n    rules: []\n  }\n\n  if (!string) {\n    return retSelection\n  }\n\n  let selection = retSelection\n  let newSelection: SelectionRule\n  let oldSelection: SelectionRule\n  const selectionStack: SelectionRule[] = []\n\n  string = string.replace(/\\(/g, ' ( ').replace(/\\)/g, ' ) ').trim()\n  if (string.charAt(0) === '(' && string.substr(-1) === ')') {\n    string = string.slice(1, -1).trim()\n  }\n  const chunks = string.split(/\\s+/)\n\n  // Log.log( string, chunks )\n\n  const createNewContext = (operator?: SelectionOperator) => {\n    newSelection = {\n      operator,\n      rules: []\n    }\n    if (selection === undefined) {\n      selection = newSelection\n      retSelection = newSelection\n    } else {\n      selection.rules!.push(newSelection)\n      selectionStack.push(selection)\n      selection = newSelection\n    }\n  }\n\n  const getPrevContext = function (operator?: SelectionOperator) {\n    oldSelection = selection\n    selection = selectionStack.pop()!\n    if (selection === undefined) {\n      createNewContext(operator)\n      pushRule(oldSelection)\n    }\n  }\n\n  const pushRule = function (rule: SelectionRule) {\n    selection.rules!.push(rule)\n  }\n\n  let not: false|0|1|2 = false\n\n  for (let i = 0; i < chunks.length; ++i) {\n    const c = chunks[ i ]\n    const cu = c.toUpperCase()\n\n    // handle parens\n\n    if (c === '(') {\n      // Log.log( \"(\" );\n      not = false\n      createNewContext()\n      continue\n    } else if (c === ')') {\n      // Log.log( \")\" );\n      getPrevContext()\n      if (selection.negate) {\n        getPrevContext()\n      }\n      continue\n    }\n\n    // leave 'not' context\n\n    if (not > 0) {\n      if (cu === 'NOT') {\n        not = 1\n      } else if (not === 1) {\n        not = 2\n      } else if (not === 2) {\n        not = false\n        getPrevContext()\n      } else {\n        throw new Error(\"something went wrong with 'not'\")\n      }\n    }\n\n    // handle logic operators\n\n    if (cu === 'AND') {\n      // Log.log( \"AND\" );\n      if (selection.operator === 'OR') {\n        const lastRule = selection.rules!.pop()!\n        createNewContext('AND')\n        pushRule(lastRule)\n      } else {\n        selection.operator = 'AND'\n      }\n      continue\n    } else if (cu === 'OR') {\n      // Log.log( \"OR\" );\n      if (selection.operator === 'AND') {\n        getPrevContext('OR')\n      } else {\n        selection.operator = 'OR'\n      }\n      continue\n    } else if (c.toUpperCase() === 'NOT') {\n      // Log.log( \"NOT\", j );\n      not = 1\n      createNewContext()\n      selection.negate = true\n      continue\n    } else {\n      // Log.log( \"chunk\", c, j, selection );\n    }\n\n    // handle keyword attributes\n\n    // ensure `cu` is not a number before testing if it is in the\n    // kwd enum dictionary which includes the enum numbers as well...\n    if (+cu !== +cu) {\n      const keyword = (kwd as any)[ cu ]\n      if (keyword !== undefined) {\n        pushRule({ keyword })\n        continue\n      }\n    }\n\n    if (cu === 'HYDROGEN') {\n      pushRule({\n        operator: 'OR',\n        rules: [\n          { element: 'H' },\n          { element: 'D' }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'SMALL') {\n      pushRule({ resname: SmallResname })\n      continue\n    }\n\n    if (cu === 'NUCLEOPHILIC') {\n      pushRule({ resname: NucleophilicResname })\n      continue\n    }\n\n    if (cu === 'HYDROPHOBIC') {\n      pushRule({ resname: HydrophobicResname })\n      continue\n    }\n\n    if (cu === 'AROMATIC') {\n      pushRule({ resname: AromaticResname })\n      continue\n    }\n\n    if (cu === 'AMIDE') {\n      pushRule({ resname: AmideResname })\n      continue\n    }\n\n    if (cu === 'ACIDIC') {\n      pushRule({ resname: AcidicResname })\n      continue\n    }\n\n    if (cu === 'BASIC') {\n      pushRule({ resname: BasicResname })\n      continue\n    }\n\n    if (cu === 'CHARGED') {\n      pushRule({ resname: ChargedResname })\n      continue\n    }\n\n    if (cu === 'POLAR') {\n      pushRule({ resname: PolarResname })\n      continue\n    }\n\n    if (cu === 'NONPOLAR') {\n      pushRule({ resname: NonpolarResname })\n      continue\n    }\n\n    if (cu === 'CYCLIC') {\n      pushRule({ resname: CyclicResname })\n      continue\n    }\n\n    if (cu === 'ALIPHATIC') {\n      pushRule({ resname: AliphaticResname })\n      continue\n    }\n\n    if (cu === 'SIDECHAINATTACHED') {\n      pushRule({\n        operator: 'OR',\n        rules: [\n          { keyword: kwd.SIDECHAIN },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { keyword: kwd.PROTEIN },\n              {\n                operator: 'OR',\n                negate: false,\n                rules: [\n                  { atomname: 'CA' },\n                  { atomname: 'BB' }\n                ]\n              }\n            ]\n          },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { resname: 'PRO' },\n              { atomname: 'N' }\n            ]\n          },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { keyword: kwd.NUCLEIC },\n              {\n                operator: 'OR',\n                negate: true,\n                rules: [\n                  { atomname: 'P' },\n                  { atomname: 'OP1' },\n                  { atomname: 'OP2' },\n                  { atomname: \"O3'\" },\n                  { atomname: 'O3*' },\n                  { atomname: \"HO3'\"},\n                  { atomname: \"O5'\" },\n                  { atomname: 'O5*' },\n                  { atomname: \"HO5'\"},\n                  { atomname: \"C5'\" },\n                  { atomname: 'C5*' },\n                  { atomname: \"H5'\" },\n                  { atomname: \"H5''\"}\n                ]\n              }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'APOLARH') {\n      pushRule({\n        operator: 'AND',\n        negate: false,\n        rules: [\n          { element: 'H' },\n          {\n            negate: true,\n            operator: undefined,\n            rules: [\n              { keyword: kwd.POLARH }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'LIGAND') {\n      pushRule({\n        operator: 'AND',\n        rules: [\n          {\n            operator: 'OR',\n            rules: [\n              {\n                operator: 'AND',\n                rules: [\n                  { keyword: kwd.HETERO },\n                  {\n                    negate: true,\n                    operator: undefined,\n                    rules: [\n                      { keyword: kwd.POLYMER }\n                    ]\n                  }\n                ]\n              },\n              {\n                negate: true,\n                operator: undefined,\n                rules: [\n                  { keyword: kwd.POLYMER }\n                ]\n              }\n            ]\n          },\n          {\n            negate: true,\n            operator: undefined,\n            rules: [\n              {\n                operator: 'OR',\n                rules: [\n                  { keyword: kwd.WATER },\n                  { keyword: kwd.ION }\n                ]\n              }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (SelectAllKeyword.indexOf(cu) !== -1) {\n      pushRule({ keyword: kwd.ALL })\n      continue\n    }\n\n    // handle atom expressions\n\n    if (c.charAt(0) === '@') {\n      const indexList = c.substr(1).split(',').map(x => parseInt(x))\n      indexList.sort(function (a, b) { return a - b })\n      pushRule({ atomindex: indexList })\n      continue\n    }\n\n    if (c.charAt(0) === '#') {\n      console.error('# for element selection deprecated, use _')\n      pushRule({ element: cu.substr(1) })\n      continue\n    }\n    if (c.charAt(0) === '_') {\n      pushRule({ element: cu.substr(1) })\n      continue\n    }\n\n    if (c[0] === '[' && c[c.length - 1] === ']') {\n      const resnameList = cu.substr(1, c.length - 2).split(',')\n      const resname = resnameList.length > 1 ? resnameList : resnameList[ 0 ]\n      pushRule({ resname: resname })\n      continue\n    } else if (\n      (c.length >= 1 && c.length <= 4) &&\n      c[0] !== '^' && c[0] !== ':' && c[0] !== '.' && c[0] !== '%' && c[0] !== '/' &&\n      isNaN(parseInt(c))\n    ) {\n      pushRule({ resname: cu })\n      continue\n    }\n\n    // there must be only one constraint per rule\n    // otherwise a test quickly becomes not applicable\n    // e.g. chainTest for chainname when resno is present too\n\n    const sele: SelectionRule = {\n      operator: 'AND',\n      rules: []\n    }\n\n    const model = c.split('/')\n    if (model.length > 1 && model[1]) {\n      if (isNaN(parseInt(model[1]))) {\n        throw new Error('model must be an integer')\n      }\n      sele.rules!.push({\n        model: parseInt(model[1])\n      })\n    }\n\n    const altloc = model[0].split('%')\n    if (altloc.length > 1) {\n      sele.rules!.push({\n        altloc: altloc[1]\n      })\n    }\n\n    const atomname = altloc[0].split('.')\n    if (atomname.length > 1 && atomname[1]) {\n      if (atomname[1].length > 4) {\n        throw new Error('atomname must be one to four characters')\n      }\n      sele.rules!.push({\n        atomname: atomname[1].substring(0, 4).toUpperCase()\n      })\n    }\n\n    const chain = atomname[0].split(':')\n    if (chain.length > 1 && chain[1]) {\n      sele.rules!.push({\n        chainname: chain[1]\n      })\n    }\n\n    const inscode = chain[0].split('^')\n    if (inscode.length > 1) {\n      sele.rules!.push({\n        inscode: inscode[1]\n      })\n    }\n\n    if (inscode[0]) {\n      let negate, negate2\n      if (inscode[0][0] === '-') {\n        inscode[0] = inscode[0].substr(1)\n        negate = true\n      }\n      if (inscode[0].includes('--')) {\n        inscode[0] = inscode[0].replace('--', '-')\n        negate2 = true\n      }\n      let resi = inscode[0].split('-')\n      if (resi.length === 1) {\n        let resiSingle = parseInt(resi[0])\n        if (isNaN(resiSingle)) {\n          throw new Error('resi must be an integer')\n        }\n        if (negate) resiSingle *= -1\n        sele.rules!.push({\n          resno: resiSingle\n        })\n      } else if (resi.length === 2) {\n        const resiRange = resi.map(x => parseInt(x))\n        if (negate) resiRange[0] *= -1\n        if (negate2) resiRange[1] *= -1\n        sele.rules!.push({\n          resno: [resiRange[0], resiRange[1]]\n        })\n      } else {\n        throw new Error(\"resi range must contain one '-'\")\n      }\n    }\n\n    // round up\n\n    if (sele.rules!.length === 1) {\n      pushRule(sele.rules![ 0 ])\n    } else if (sele.rules!.length > 1) {\n      pushRule(sele)\n    } else {\n      throw new Error('empty selection chunk')\n    }\n  }\n\n  // cleanup\n\n  if (\n    retSelection.operator === undefined &&\n    retSelection.rules!.length === 1 &&\n    retSelection.rules![ 0 ].hasOwnProperty('operator')\n  ) {\n    retSelection = retSelection.rules![ 0 ]\n  }\n\n  return retSelection\n}\n\nexport {\n  parseSele\n}\n","/**\n * @file Selection Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport Selection from '../selection/selection'\nimport Colormaker, { ColormakerParameters } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Structure from '../structure/structure'\n\nexport type SelectionSchemeData = [ string, string, ColormakerParameters|undefined ]\n\n/**\n * Color based on {@link Selection}\n */\nclass SelectionColormaker extends Colormaker {\n  colormakerList: any[] = []  // TODO\n  selectionList: Selection[] = []\n\n  constructor (params: { structure: Structure, dataList: SelectionSchemeData[] } & Partial<ColormakerParameters>) {\n    super(params)\n\n    const dataList = params.dataList || []\n\n    dataList.forEach((data: SelectionSchemeData) => {\n      const [ scheme, sele, params = {} ] = data\n\n      if (ColormakerRegistry.hasScheme(scheme)) {\n        Object.assign(params, {\n          scheme: scheme,\n          structure: this.parameters.structure\n        })\n      } else {\n        Object.assign(params, {\n          scheme: 'uniform',\n          value: new Color(scheme).getHex()\n        })\n      }\n\n      this.colormakerList.push(ColormakerRegistry.getScheme(params as { scheme: string } & ColormakerParameters))\n      this.selectionList.push(new Selection(sele))\n    })\n  }\n\n  // NOT NEEDED @manageColor\n  atomColor (a: AtomProxy) {\n    for (let i = 0, n = this.selectionList.length; i < n; ++i) {\n      const test = this.selectionList[ i ].test\n      if (test && test(a)) {\n        return this.colormakerList[ i ].atomColor(a)\n      }\n    }\n\n    return 0xFFFFFF\n  }\n}\n\nexport default SelectionColormaker\n","/**\n * @file Colormaker Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { generateUUID } from '../math/math-utils'\nimport Colormaker, { ColormakerConstructor, ColormakerParameters } from './colormaker'\nimport SelectionColormaker, { SelectionSchemeData } from './selection-colormaker'\nimport Structure from '../structure/structure'\n\ntype ColormakerDefinitionFunction = ((this: Colormaker, param?: ColormakerParameters) => void)\n\nconst ColormakerScales = {\n  '': '',\n\n    // Sequential\n  OrRd: '[S] Orange-Red',\n  PuBu: '[S] Purple-Blue',\n  BuPu: '[S] Blue-Purple',\n  Oranges: '[S] Oranges',\n  BuGn: '[S] Blue-Green',\n  YlOrBr: '[S] Yellow-Orange-Brown',\n  YlGn: '[S] Yellow-Green',\n  Reds: '[S] Reds',\n  RdPu: '[S] Red-Purple',\n  Greens: '[S] Greens',\n  YlGnBu: '[S] Yellow-Green-Blue',\n  Purples: '[S] Purples',\n  GnBu: '[S] Green-Blue',\n  Greys: '[S] Greys',\n  YlOrRd: '[S] Yellow-Orange-Red',\n  PuRd: '[S] Purple-Red',\n  Blues: '[S] Blues',\n  PuBuGn: '[S] Purple-Blue-Green',\n\n    // Diverging\n  Viridis: '[D] Viridis',\n  Spectral: '[D] Spectral',\n  RdYlGn: '[D] Red-Yellow-Green',\n  RdBu: '[D] Red-Blue',\n  PiYG: '[D] Pink-Yellowgreen',\n  PRGn: '[D] Purplered-Green',\n  RdYlBu: '[D] Red-Yellow-Blue',\n  BrBG: '[D] Brown-Bluegreen',\n  RdGy: '[D] Red-Grey',\n  PuOr: '[D] Purple-Orange',\n\n    // Qualitative\n  Set1: '[Q] Set1',\n  Set2: '[Q] Set2',\n  Set3: '[Q] Set3',\n  Dark2: '[Q] Dark2',\n  Paired: '[Q] Paired',\n  Pastel1: '[Q] Pastel1',\n  Pastel2: '[Q] Pastel2',\n  Accent: '[Q] Accent',\n\n    // Other\n  rainbow: '[?] Rainbow',\n  rwb: '[?] Red-White-Blue'\n}\n\nconst ColormakerModes = {\n  '': '',\n\n  rgb: 'Red Green Blue',\n  hsv: 'Hue Saturation Value',\n  hsl: 'Hue Saturation Lightness',\n  hsi: 'Hue Saturation Intensity',\n  lab: 'CIE L*a*b*',\n  hcl: 'Hue Chroma Lightness'\n}\n\n/**\n * Class for registering {@link Colormaker}s. Generally use the\n * global {@link src/globals.js~ColormakerRegistry} instance.\n */\nclass ColormakerRegistry {\n  schemes: { [k: string]: ColormakerConstructor }\n  userSchemes: { [k: string]: ColormakerConstructor }\n\n  constructor () {\n    this.schemes = {}\n    this.userSchemes = {}\n  }\n\n  getScheme (params: Partial<{ scheme: string } & ColormakerParameters>) {\n    const p = params || {}\n    const id = (p.scheme || '').toLowerCase()\n\n    let SchemeClass: ColormakerConstructor\n\n    if (id in this.schemes) {\n      SchemeClass = this.schemes[ id ]\n    } else if (id in this.userSchemes) {\n      SchemeClass = this.userSchemes[ id ]\n    } else {\n      //@ts-expect-error  abstract class used as a constructor\n      SchemeClass = Colormaker\n    }\n\n    return new SchemeClass(params)\n  }\n\n  /**\n   * Get an description of available schemes as an\n   * object with id-label as key-value pairs\n   * @return {Object} available schemes\n   */\n  getSchemes () {\n    const types: { [k: string]: string } = {}\n\n    Object.keys(this.schemes).forEach(function (k) {\n      types[ k ] = k\n    })\n\n    Object.keys(this.userSchemes).forEach(function (k) {\n      types[ k ] = k.split('|')[ 1 ]\n    })\n\n    return types\n  }\n\n  /**\n   * Get an description of available scales as an\n   * object with id-label as key-value pairs\n   * @return {Object} available scales\n   */\n  getScales () {\n    return ColormakerScales\n  }\n\n  getModes () {\n    return ColormakerModes\n  }\n\n  /**\n   * Add a scheme with a hardcoded id\n   * @param {String} id - the id\n   * @param {Colormaker} scheme - the colormaker\n   * @return {undefined}\n   */\n  add (id: string, scheme: ColormakerConstructor) {\n    id = id.toLowerCase()\n    this.schemes[ id ] = scheme\n  }\n\n  /**\n   * Register a custom scheme\n   *\n   * @example\n   * // Create a class with a `atomColor` method that returns a hex color.\n   * var schemeId = NGL.ColormakerRegistry.addScheme( function( params ){\n   *     this.atomColor = function( atom ){\n   *         if( atom.serial < 1000 ){\n   *             return 0x0000FF;  // blue\n   *         }else if( atom.serial > 2000 ){\n   *             return 0xFF0000;  // red\n   *         }else{\n   *             return 0x00FF00;  // green\n   *         }\n   *     };\n   * } );\n   *\n   * stage.loadFile( \"rcsb://3dqb.pdb\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\", { color: schemeId } );  // pass schemeId here\n   *     o.autoView();\n   * } );\n   *\n   * @param {Function|Colormaker} scheme - constructor or {@link Colormaker} instance\n   * @param {String} label - scheme label\n   * @return {String} id to refer to the registered scheme\n   */\n  addScheme (scheme: ColormakerConstructor|ColormakerDefinitionFunction, label?: string) {\n    if (!(isColormakerSubClass(scheme))) {\n      scheme = this._createScheme(scheme)\n    }\n\n    return this._addUserScheme(scheme, label)\n  }\n\n  /**\n   * Add a user-defined scheme\n   * @param {Colormaker} scheme - the user-defined scheme\n   * @param {String} [label] - scheme label\n   * @return {String} id to refer to the registered scheme\n   */\n  _addUserScheme (scheme: ColormakerConstructor, label?: string) {\n    label = label || ''\n    const id = `${generateUUID()}|${label}`.toLowerCase()\n    this.userSchemes[ id ] = scheme\n\n    return id\n  }\n\n  /**\n   * Remove the scheme with the given id\n   * @param  {String} id - scheme to remove\n   * @return {undefined}\n   */\n  removeScheme (id: string) {\n    id = id.toLowerCase()\n    delete this.userSchemes[ id ]\n  }\n\n  _createScheme (constructor: ColormakerDefinitionFunction): ColormakerConstructor {\n    class _Colormaker extends Colormaker {\n      constructor (params: ColormakerParameters) {\n        super(params)\n        constructor.call(this, params)\n      }\n    }\n    return _Colormaker\n  }\n\n  /**\n   * Create and a selection-based coloring scheme. Supply a list with pairs\n   * of colorname and selection for coloring by selections. Use the last\n   * entry as a default (catch all) coloring definition.\n   *\n   * @example\n   * var schemeId = NGL.ColormakerRegistry.addSelectionScheme( [\n   *     [ \"red\", \"64-74 or 134-154 or 222-254 or 310-310 or 322-326\" ],\n   *     [ \"green\", \"311-322\" ],\n   *     [ \"yellow\", \"40-63 or 75-95 or 112-133 or 155-173 or 202-221 or 255-277 or 289-309\" ],\n   *     [ \"blue\", \"1-39 or 96-112 or 174-201 or 278-288\" ],\n   *     [ \"white\", \"*\" ]\n   * ], \"Transmembrane 3dqb\" );\n   *\n   * stage.loadFile( \"rcsb://3dqb.pdb\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\", { color: schemeId } );  // pass schemeId here\n   *     o.autoView();\n   * } );\n   *\n   * @param {Array} dataList - cloror-selection pairs\n   * @param {String} label - scheme name\n   * @return {String} id to refer to the registered scheme\n   */\n  addSelectionScheme (dataList: SelectionSchemeData[], label?: string) {\n    class MySelectionColormaker extends SelectionColormaker {\n      constructor (params: { structure: Structure } & ColormakerParameters) {\n        super(Object.assign({ dataList }, params))\n      }\n    }\n\n    return this._addUserScheme(MySelectionColormaker, label)\n  }\n\n  /**\n   * Check if a scheme with the given id exists\n   * @param  {String}  id - the id to check\n   * @return {Boolean} flag indicating if the scheme exists\n   */\n  hasScheme (id: string) {\n    id = id.toLowerCase()\n    return id in this.schemes || id in this.userSchemes\n  }\n}\n\nfunction isColormakerSubClass (\n  scheme: ColormakerConstructor|((this: Colormaker, param?: ColormakerParameters) => void)\n): scheme is ColormakerConstructor {\n  return (scheme instanceof Colormaker)\n}\n\nexport default ColormakerRegistry\n","/**\n * @file Worker Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { uniqueArray } from '../utils'\n\nexport type FunctionWithDeps = { __deps?: Function[] } & Function\nexport interface WorkerEvent {\n  data: {\n    __name: string\n    __postId: string\n  }\n}\n\nfunction getWorkerDeps (vars: FunctionWithDeps[]) {\n  const deps = vars\n  vars.forEach(function (sym) {\n    if (sym.__deps) {\n      Array.prototype.push.apply(deps, getWorkerDeps(sym.__deps))\n    }\n  })\n  return deps\n}\n\nfunction makeWorkerString (vars: any) {\n  const deps = uniqueArray(getWorkerDeps(vars))\n  return deps.map(function (sym) {\n    return sym.toString()\n  }).join('\\n\\n\\n')\n}\n\nfunction onmessage (e: WorkerEvent) {\n  const name = e.data.__name\n  const postId = e.data.__postId\n\n  /* global self */\n  if (name === undefined) {\n    console.error('message __name undefined')\n  } else if ((self as any).func === undefined) {\n    console.error('worker func undefined', name)\n  } else {\n    const callback = function (aMessage: any, transferList: any[]) {\n      aMessage = aMessage || {}\n      if (postId !== undefined) aMessage.__postId = postId\n\n      try {\n        (self as any).postMessage(aMessage, transferList)\n      } catch (error) {\n        console.error('self.postMessage:', error);\n        (self as any).postMessage(aMessage)\n      }\n    };\n    (self as any).func(e, callback)\n  }\n}\n\nexport function makeWorkerBlob (func: Function, deps: Function[]) {\n  let str = \"'use strict';\\n\\n\" + makeWorkerString(deps)\n  str += '\\n\\n\\nself.func = ' + func.toString() + ';'\n  str += '\\n\\n\\nself.onmessage = ' + onmessage.toString() + ';'\n    // console.log(str);\n  return new Blob([ str ], { type: 'application/javascript' })\n}\n","/**\n * @file Globals\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getBrowser, getQuery, boolean } from './utils'\nimport Registry from './utils/registry'\nimport _ColormakerRegistry from './color/colormaker-registry'\nimport _ParserRegistry from './parser/parser-registry'\nimport _WorkerRegistry from './worker/worker-registry'\nimport { MeasurementRepresentationParameters } from './representation/measurement-representation';\n\n/**\n * The browser name: \"Opera\", \"Chrome\", \"Firefox\", \"Mobile Safari\",\n * \"Internet Explorer\", \"Safari\" or false.\n */\nexport const Browser = getBrowser()\n\n/**\n * Flag indicating support for the 'passive' option for event handler\n */\nexport let SupportsPassiveEventHandler = false\ntry {\n  // Test via a getter in the options object to see if the passive property is accessed\n  const opts = Object.defineProperty({}, 'passive', {\n    get: function () {\n      SupportsPassiveEventHandler = true\n    }\n  })\n  window.addEventListener('test', e => {}, opts)\n} catch (e) {}\n\n/**\n * Flag indicating a mobile browser\n */\nexport const Mobile = typeof window !== 'undefined' ? typeof window.orientation !== 'undefined' : false\n\nexport let SupportsReadPixelsFloat = false\nexport function setSupportsReadPixelsFloat (value: boolean) {\n  SupportsReadPixelsFloat = value\n}\n\n/**\n * Flag indicating support for the `EXT_frag_depth` WebGL extension\n * (Always present in WebGL2)\n */\nexport let ExtensionFragDepth = false\nexport function setExtensionFragDepth (value: boolean) {\n  ExtensionFragDepth = value\n}\n\nexport const Log = {\n  log: Function.prototype.bind.call(console.log, console),\n  info: Function.prototype.bind.call(console.info, console),\n  warn: Function.prototype.bind.call(console.warn, console),\n  error: Function.prototype.bind.call(console.error, console),\n  time: Function.prototype.bind.call(console.time, console),\n  timeEnd: Function.prototype.bind.call(console.timeEnd, console)\n}\n\nexport let MeasurementDefaultParams: Partial<MeasurementRepresentationParameters> = {\n  color: 'green',\n  labelColor: 0x808080,\n  labelAttachment: 'bottom-center',\n  labelSize: 0.7,\n  labelZOffset: 0.5,\n  labelYOffset: 0.1,\n  labelBorder: true,\n  labelBorderColor: 0xd3d3d3,\n  labelBorderWidth: 0.25,\n  lineOpacity: 0.8,\n  linewidth: 5.0,\n  opacity: 0.6,\n\n  labelUnit: 'angstrom',\n  arcVisible: true,\n  planeVisible: false\n}\nexport function setMeasurementDefaultParams (params = {}) {\n  Object.assign(MeasurementDefaultParams, params)\n}\n\nexport let Debug = boolean(getQuery('debug'))\nexport function setDebug (value: boolean) {\n  Debug = value\n}\n\nexport const WebglErrorMessage = '<div style=\"display:flex;align-items:center;justify-content:center;height:100%;\"><p style=\"padding:15px;text-align:center;\">Your browser/graphics card does not seem to support <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/WebGL\">WebGL</a>.<br/><br/>Find out how to get it <a target=\"_blank\" href=\"http://get.webgl.org/\">here</a>.</p></div>'\n\n/**\n * List of file extensions to be recognized as scripts\n */\nexport const ScriptExtensions = [ 'ngl', 'js' ]\n\nexport const WorkerRegistry = new _WorkerRegistry()\nexport const ColormakerRegistry = new _ColormakerRegistry()\nexport const DatasourceRegistry = new Registry('datasource')\nexport const RepresentationRegistry = new Registry('representatation')\nexport const ParserRegistry = new _ParserRegistry()\nexport const ShaderRegistry = new Registry('shader')\nexport const DecompressorRegistry = new Registry('decompressor')\nexport const ComponentRegistry = new Registry('component')\nexport const BufferRegistry = new Registry('buffer')\nexport const PickerRegistry = new Registry('picker')\n\nexport let ListingDatasource: any\nexport function setListingDatasource (value: any) {\n  ListingDatasource = value\n}\n\nexport let TrajectoryDatasource: any  // TODO should accept mdsrvDatasource\nexport function setTrajectoryDatasource (value: any) {\n  TrajectoryDatasource = value\n}\n","/**\n * @file Worker Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { makeWorkerBlob } from './worker-utils'\n\nclass WorkerRegistry {\n  activeWorkerCount = 0\n\n  private _funcDict: { [k: string]: Function } = {}\n  private _depsDict: { [k: string]: Function[] } = {}\n  private _blobDict: { [k: string]: Blob } = {}\n\n  add (name: string, func: Function, deps: Function[]) {\n    this._funcDict[ name ] = func\n    this._depsDict[ name ] = deps\n  }\n\n  get (name: string) {\n    if (!this._blobDict[ name ]) {\n      this._blobDict[ name ] = makeWorkerBlob(\n        this._funcDict[ name ], this._depsDict[ name ]\n      )\n    }\n    return this._blobDict[ name ]\n  }\n}\n\nexport default WorkerRegistry\n","/**\n * @file Parser Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Registry from '../utils/registry'\n\nclass ParserRegistry extends Registry {\n  constructor () {\n    super('parser')\n  }\n\n  __hasObjName (key: string, objName: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.__objName === objName\n  }\n\n  isTrajectory (key: string) {\n    return this.__hasObjName(key, 'frames')\n  }\n\n  isStructure (key: string) {\n    return this.__hasObjName(key, 'structure')\n  }\n\n  isVolume (key: string) {\n    return this.__hasObjName(key, 'volume')\n  }\n\n  isSurface (key: string) {\n    return this.__hasObjName(key, 'surface')\n  }\n\n  isBinary (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isBinary\n  }\n\n  isXml (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isXml\n  }\n\n  isJson (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isJson\n  }\n\n  getTrajectoryExtensions () {\n    return this.names.filter(name => this.isTrajectory(name))\n  }\n\n  getStructureExtensions () {\n    return this.names.filter(name => this.isStructure(name))\n  }\n\n  getVolumeExtensions () {\n    return this.names.filter(name => this.isVolume(name))\n  }\n\n  getSurfaceExtensions () {\n    return this.names.filter(name => this.isSurface(name))\n  }\n}\n\nexport default ParserRegistry\n","/**\n * @file Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { DecompressorRegistry } from '../globals'\nimport { uint8ToString, defaults } from '../utils'\n\nexport interface StreamerParams {\n  compressed?: string|false\n  binary?: boolean\n  json?: boolean\n  xml?: boolean\n}\n\nabstract class Streamer {\n  src: any\n  data: any\n\n  compressed: string|false\n  binary: boolean\n  json: boolean\n  xml: boolean\n\n  chunkSize = 1024 * 1024 * 10\n  newline = '\\n'\n\n  protected __pointer = 0\n  protected __partialLine = ''\n\n  constructor (src: any, params: StreamerParams = {}) {\n    this.compressed = defaults(params.compressed, false)\n    this.binary = defaults(params.binary, false)\n    this.json = defaults(params.json, false)\n    this.xml = defaults(params.xml, false)\n\n    this.src = src\n  }\n\n  isBinary () {\n    return this.binary || this.compressed\n  }\n\n  read () {\n    return this._read().then(data => {\n      const decompressFn = this.compressed ? DecompressorRegistry.get(this.compressed) : undefined\n\n      if (this.compressed && decompressFn) {\n        this.data = decompressFn(data)\n      } else {\n        if ((this.binary || this.compressed) && data instanceof ArrayBuffer) {\n          data = new Uint8Array(data)\n        }\n        this.data = data\n      }\n\n      return this.data\n    })\n  }\n\n  protected abstract _read (): Promise<any>\n\n  protected _chunk (start: number, end: number) {\n    end = Math.min(this.data.length, end)\n\n    if (start === 0 && this.data.length === end) {\n      return this.data\n    } else {\n      if (this.isBinary()) {\n        return this.data.subarray(start, end)\n      } else {\n        return this.data.substring(start, end)\n      }\n    }\n  }\n\n  chunk (start: number) {\n    const end = start + this.chunkSize\n\n    return this._chunk(start, end)\n  }\n\n  peekLines (m: number) {\n    const data = this.data\n    const n = data.length\n\n    // FIXME does not work for multi-char newline\n    const newline = this.isBinary() ? this.newline.charCodeAt(0) : this.newline\n\n    let i\n    let count = 0\n    for (i = 0; i < n; ++i) {\n      if (data[ i ] === newline) ++count\n      if (count === m) break\n    }\n\n    const chunk = this._chunk(0, i + 1)\n    const d = this.chunkToLines(chunk, '', i > n)\n\n    return d.lines\n  }\n\n  chunkCount () {\n    return Math.floor(this.data.length / this.chunkSize) + 1\n  }\n\n  asText () {\n    return this.isBinary() ? uint8ToString(this.data) : this.data\n  }\n\n  chunkToLines (chunk: string|Uint8Array, partialLine: string, isLast: boolean) {\n    const newline = this.newline\n\n    if (!this.isBinary() && chunk.length === this.data.length) {\n      return {\n        lines: (chunk as string).split(newline),\n        partialLine: ''\n      }\n    }\n\n    let lines: string[] = []\n    const str = this.isBinary() ? uint8ToString(chunk as Uint8Array) : chunk\n    const idx = str.lastIndexOf(newline)\n\n    if (idx === -1) {\n      partialLine += str\n    } else {\n      const str2 = partialLine + str.substr(0, idx)\n      lines = lines.concat(str2.split(newline))\n\n      if (idx === str.length - newline.length) {\n        partialLine = ''\n      } else {\n        partialLine = str.substr(idx + newline.length)\n      }\n    }\n\n    if (isLast && partialLine !== '') {\n      lines.push(partialLine)\n    }\n\n    return {\n      lines: lines,\n      partialLine: partialLine\n    }\n  }\n\n  nextChunk () {\n    const start = this.__pointer\n\n    if (start > this.data.length) {\n      return undefined\n    }\n\n    this.__pointer += this.chunkSize\n    return this.chunk(start)\n  }\n\n  nextChunkOfLines () {\n    const chunk = this.nextChunk()\n\n    if (chunk === undefined) {\n      return undefined\n    }\n\n    const isLast = this.__pointer > this.data.length\n    const d = this.chunkToLines(chunk, this.__partialLine, isLast)\n\n    this.__partialLine = d.partialLine\n\n    return d.lines\n  }\n\n  eachChunk (callback: (chunk: string|Uint8Array, chunkNo: number, chunkCount: number) => void) {\n    const chunkSize = this.chunkSize\n    const n = this.data.length\n    const chunkCount = this.chunkCount()\n\n    for (let i = 0; i < n; i += chunkSize) {\n      const chunk = this.chunk(i)\n      const chunkNo = Math.round(i / chunkSize)\n\n      callback(chunk, chunkNo, chunkCount)\n    }\n  }\n\n  eachChunkOfLines (callback: (chunk: string[], chunkNo: number, chunkCount: number) => void) {\n    this.eachChunk((chunk, chunkNo, chunkCount) => {\n      const isLast = chunkNo === chunkCount + 1\n      const d = this.chunkToLines(chunk, this.__partialLine, isLast)\n\n      this.__partialLine = d.partialLine\n\n      callback(d.lines, chunkNo, chunkCount)\n    })\n  }\n\n  dispose () {\n    delete this.src\n  }\n}\n\nexport default Streamer\n","/**\n * @file File Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Streamer from './streamer'\n\ninterface FileReaderEventTarget extends EventTarget {\n    result:string | ArrayBuffer | null\n}\n\ninterface FileReaderEvent extends ProgressEvent {\n    target: FileReaderEventTarget | null;\n}\n\nclass FileStreamer extends Streamer {\n  _read () {\n    return new Promise((resolve, reject) => {\n      const file = this.src\n      const reader = new FileReader()\n\n      reader.onload = (event: FileReaderEvent) => {\n        if(event.target) resolve(event.target.result)\n      }\n\n      // if (typeof this.onprogress === 'function') {\n      //   reader.onprogress = event => this.onprogress(event)\n      // }\n\n      reader.onerror = event => reject(event)\n\n      if (this.binary || this.compressed) {\n        reader.readAsArrayBuffer(file)\n      } else {\n        reader.readAsText(file)\n      }\n    })\n  }\n}\n\nexport default FileStreamer\n","/**\n * @file Network Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Streamer from './streamer'\n\nclass NetworkStreamer extends Streamer {\n  _read () {\n    return new Promise((resolve, reject) => {\n      const url = this.src\n      const xhr = new XMLHttpRequest()\n\n      xhr.open('GET', url, true)\n\n      xhr.addEventListener('load', () => {\n        if (xhr.status === 200 || xhr.status === 304 ||\n            // when requesting from local file system\n            // the status in Google Chrome/Chromium is 0\n            xhr.status === 0\n        ) {\n          try {\n            resolve(xhr.response)\n          } catch (e) {\n            reject(e)\n          }\n        } else {\n          reject(xhr.statusText)\n        }\n      }, false)\n\n      // if (typeof this.onprogress === 'function') {\n      //   xhr.addEventListener('progress', event => this.onprogress(event), false);\n      // }\n\n      xhr.addEventListener('error', event => reject('network error'), false)\n\n      if (this.isBinary()) {\n        xhr.responseType = 'arraybuffer'\n      } else if (this.json) {\n        xhr.responseType = 'json'\n      } else if (this.xml) {\n        xhr.responseType = 'document'\n      } else {\n        xhr.responseType = 'text'\n      }\n      // xhr.crossOrigin = true;\n\n      xhr.send()\n    })\n  }\n}\n\nexport default NetworkStreamer\n","/**\n * @file Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport { createParams } from '../utils'\nimport FileStreamer from '../streamer/file-streamer'\nimport NetworkStreamer from '../streamer/network-streamer'\nimport { LoaderParameters, LoaderInput } from './loader-utils'\n\n/**\n * Loader parameter object.\n * @typedef {Object} LoaderParameters - loader parameters\n * @property {String} ext - file extension, determines file type\n * @property {Boolean} compressed - flag data as compressed\n * @property {Boolean} binary - flag data as binary\n * @property {String} name - set data name\n */\n\n/**\n * Loader base class\n */\nabstract class Loader {\n  parameters: LoaderParameters\n  streamer: FileStreamer | NetworkStreamer\n\n  /**\n   * Construct a loader object\n   * @param  {String|File|Blob} src - data source, string is interpreted as an URL\n   * @param  {LoaderParameters} params - parameters object\n   */\n  constructor (src: LoaderInput, params: Partial<LoaderParameters> = {}) {\n    this.parameters = createParams(params, {\n      ext: '',\n      compressed: false,\n      binary: ParserRegistry.isBinary(params.ext || ''),\n      name: '',\n\n      dir: '',\n      path: '',\n      protocol: ''\n    } as LoaderParameters)\n\n    const streamerParams = {\n      compressed: this.parameters.compressed as string|false,\n      binary: this.parameters.binary,\n      json: ParserRegistry.isJson(this.parameters.ext),\n      xml: ParserRegistry.isXml(this.parameters.ext)\n    }\n\n    if ((typeof File !== 'undefined' && src instanceof File) ||\n        (typeof Blob !== 'undefined' && src instanceof Blob)\n    ) {\n      this.streamer = new FileStreamer(src, streamerParams)\n    } else {\n      this.streamer = new NetworkStreamer(src, streamerParams)\n    }\n  }\n\n  /**\n   * Load data\n   * @abstract\n   * @return {Promise} resolves to the loaded data {@link Object}\n   */\n  abstract load (): Promise<any>\n}\n\nexport default Loader\n","/**\n * @file Parser Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport type { InferBondsOptions } from '../structure/structure-utils'\nimport Loader from './loader'\nimport { LoaderParameters, LoaderInput } from './loader-utils'\n\nexport interface ParserParams {\n  voxelSize?: number\n  firstModelOnly?: boolean\n  asTrajectory?: boolean\n  cAlphaOnly?: boolean\n  name?: string\n  path?: string\n  delimiter?: string\n  comment?: string\n  columnNames?: string\n  inferBonds?: InferBondsOptions\n}\n\n/**\n * Parser loader class\n * @extends Loader\n */\nclass ParserLoader extends Loader {\n  parserParams: ParserParams\n\n  constructor (src: LoaderInput, params: Partial<LoaderParameters> & ParserParams = {}) {\n    super(src, params)\n    this.parserParams = {\n      voxelSize: params.voxelSize,\n      firstModelOnly: params.firstModelOnly,\n      asTrajectory: params.asTrajectory,\n      cAlphaOnly: params.cAlphaOnly,\n      delimiter: params.delimiter,\n      comment: params.comment,\n      columnNames: params.columnNames,\n      inferBonds: params.inferBonds,\n      name: this.parameters.name,\n      path: this.parameters.path\n    }\n  }\n\n  /**\n   * Load parsed object\n   * @return {Promise} resolves to the loaded & parsed {@link Structure},\n   *                   {@link Volume}, {@link Surface} or data object\n   */\n  load () {\n    var ParserClass = ParserRegistry.get(this.parameters.ext)\n    var parser = new ParserClass(this.streamer, this.parserParams)\n\n    return parser.parse()\n  }\n}\n\nexport default ParserLoader\n","/**\n * @file Script\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { Log } from './globals'\nimport Stage from './stage/stage'\n\nexport interface ScriptSignals {\n  elementAdded: Signal\n  elementRemoved: Signal\n  nameChanged: Signal\n}\n\n/**\n * Script class\n */\nclass Script {\n  readonly signals: ScriptSignals = {\n    elementAdded: new Signal(),\n    elementRemoved: new Signal(),\n    nameChanged: new Signal()\n  }\n\n  readonly dir: string\n  readonly fn: Function\n\n  readonly type = 'Script'\n\n  /**\n   * Create a script instance\n   * @param {String} functionBody - the function source\n   * @param {String} name - name of the script\n   * @param {String} path - path of the script\n   */\n  constructor (functionBody: string, readonly name: string, readonly path: string) {\n    this.dir = path.substring(0, path.lastIndexOf('/') + 1)\n\n    try {\n      /* eslint-disable no-new-func */\n      this.fn = new Function('stage', '__name', '__path', '__dir', functionBody)\n    } catch (e) {\n      Log.error('Script compilation failed', e)\n      this.fn = function () {}\n    }\n  }\n\n  /**\n   * Execute the script\n   * @param  {Stage} stage - the stage context\n   * @return {Promise} - resolve when script finished running\n   */\n  run (stage: Stage): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        this.fn.apply(null, [ stage, this.name, this.path, this.dir ])\n        resolve()\n      } catch (e) {\n        Log.error('Script.fn', e)\n        reject(e)\n      }\n    })\n  }\n}\n\nexport default Script\n","/**\n * @file Script Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Loader from './loader'\nimport Script from '../script'\n\n/**\n * Script loader class\n * @extends Loader\n */\nclass ScriptLoader extends Loader {\n  /**\n   * Load script\n   * @return {Promise} resolves to the loaded {@link Script}\n   */\n  load () {\n    return this.streamer.read().then(() => {\n      return new Script(\n        this.streamer.asText(), this.parameters.name, this.parameters.path\n      )\n    })\n  }\n}\n\nexport default ScriptLoader\n","/**\n * @file Loader Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  DatasourceRegistry, DecompressorRegistry, ParserRegistry, ScriptExtensions\n} from '../globals'\nimport ParserLoader, { ParserParams } from './parser-loader'\nimport ScriptLoader from './script-loader'\n\nexport interface LoaderParameters {\n ext: string  // file extension, determines file type\n compressed: string|false  // flag data as compressed\n binary: boolean  // flag data as binary\n name: string  // set data name\n\n dir: string\n path: string\n protocol: string\n}\n\nexport type LoaderInput = File|Blob|string\n\nexport function getFileInfo (file: LoaderInput) {\n  const compressedExtList = DecompressorRegistry.names\n\n  let path: string\n  let compressed: string|false\n  let protocol = ''\n\n  if (file instanceof File) {\n    path = file.name\n  } else if (file instanceof Blob) {\n    path = ''\n  } else {\n    path = file\n  }\n  const queryIndex = path.lastIndexOf('?')\n  const query = queryIndex !== -1 ? path.substring(queryIndex) : ''\n  path = path.substring(0, queryIndex === -1 ? path.length : queryIndex)\n\n  const name = path.replace(/^.*[\\\\/]/, '')\n  let base = name.substring(0, name.lastIndexOf('.'))\n\n  const nameSplit = name.split('.')\n  let ext = nameSplit.length > 1 ? (nameSplit.pop() || '').toLowerCase() : ''\n\n  const protocolMatch = path.match(/^(.+):\\/\\/(.+)$/)\n  if (protocolMatch) {\n    protocol = protocolMatch[ 1 ].toLowerCase()\n    path = protocolMatch[ 2 ] || ''\n  }\n\n  const dir = path.substring(0, path.lastIndexOf('/') + 1)\n\n  if (compressedExtList.includes(ext)) {\n    compressed = ext\n    const n = path.length - ext.length - 1\n    ext = (path.substr(0, n).split('.').pop() || '').toLowerCase()\n    const m = base.length - ext.length - 1\n    base = base.substr(0, m)\n  } else {\n    compressed = false\n  }\n\n  return { path, name, ext, base, dir, compressed, protocol, query, 'src': file }\n}\n\nexport function getDataInfo (src: LoaderInput) {\n  let info = getFileInfo(src)\n  const datasource = DatasourceRegistry.get(info.protocol)\n  if (datasource) {\n    info = getFileInfo(datasource.getUrl(info.src))\n    if (!info.ext && datasource.getExt) {\n      info.ext = datasource.getExt(src)\n    }\n  }\n  return info\n}\n\n/**\n * Load a file\n *\n * @example\n * // load from URL\n * NGL.autoLoad( \"http://files.rcsb.org/download/5IOS.cif\" );\n *\n * @example\n * // load binary data in CCP4 format via a Blob\n * var binaryBlob = new Blob( [ ccp4Data ], { type: 'application/octet-binary'} );\n * NGL.autoLoad( binaryBlob, { ext: \"ccp4\" } );\n *\n * @example\n * // load string data in PDB format via a Blob\n * var stringBlob = new Blob( [ pdbData ], { type: 'text/plain'} );\n * NGL.autoLoad( stringBlob, { ext: \"pdb\" } );\n *\n * @example\n * // load a File object\n * NGL.autoLoad( file );\n *\n * @param  {String|File|Blob} file - either a URL or an object containing the file data\n * @param  {LoaderParameters} params - loading parameters\n * @return {Promise} Promise resolves to the loaded data\n */\nexport function autoLoad (file: LoaderInput, params: Partial<LoaderParameters & ParserParams> = {}) {\n  const p = Object.assign(getDataInfo(file), params)\n\n  let loader\n  if (ParserRegistry.names.includes(p.ext)) {\n    loader = new ParserLoader(p.src, p)\n  } else if (ScriptExtensions.includes(p.ext)) {\n    loader = new ScriptLoader(p.src, p)\n  }\n\n  if (loader) {\n    return loader.load()\n  } else {\n    return Promise.reject(new Error(`autoLoad: ext '${p.ext}' unknown`))\n  }\n}\n","/**\n * @file Writer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults, download } from '../utils'\n\n/**\n * Base class for writers\n * @interface\n */\nabstract class Writer {\n  readonly mimeType: string\n  readonly defaultName: string\n  readonly defaultExt: string\n\n  /**\n   * @abstract\n   * @return {Anything} the data to be written\n   */\n  abstract getData (): any\n\n  /**\n   * Get a blob with the written data\n   * @return {Blob} the blob\n   */\n  getBlob () {\n    return new Blob([ this.getData() ], { type: this.mimeType })\n  }\n\n  /**\n   * Trigger a download of the\n   * @param  {[type]} name [description]\n   * @param  {[type]} ext  [description]\n   * @return {[type]}      [description]\n   */\n  download (name?: string, ext?: string) {\n    name = defaults(name, this.defaultName)\n    ext = defaults(ext, this.defaultExt)\n\n    download(this.getBlob(), `${name}.${ext}`)\n  }\n}\n\nexport default Writer","/**\n * @file Pdb Writer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { sprintf } from 'sprintf-js'\n\nimport Writer from './writer'\nimport { defaults, ensureArray } from '../utils'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// http://www.wwpdb.org/documentation/file-format\n\n// Sample PDB line, the coords X,Y,Z are fields 5,6,7 on each line.\n// ATOM      1  N   ARG     1      29.292  13.212 -12.751  1.00 33.78      1BPT 108\n\nconst AtomFormat =\n  'ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s'\n\nconst HetatmFormat =\n  'HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s'\n\nexport interface PdbWriterParams {\n  renumberSerial: boolean\n  remarks: string[]\n}\n\n/**\n * Create a PDB file from a Structure object\n */\nexport default class PdbWriter extends Writer {\n  readonly mimeType = 'text/plain'\n  readonly defaultName = 'structure'\n  readonly defaultExt = 'pdb'\n\n  renumberSerial: boolean\n  remarks: string[]\n\n  structure: Structure\n  private _records: string[]\n\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Object} params - parameters]\n   */\n  constructor (structure: Structure, params?: PdbWriterParams) {\n    super()\n\n    const p = Object.assign({}, params)\n\n    this.renumberSerial = defaults(p.renumberSerial, true)\n    this.remarks = ensureArray(defaults(p.remarks, []))\n\n    this.structure = structure\n    this._records = []\n  }\n\n  private _writeRecords () {\n    this._records.length = 0\n\n    this._writeTitle()\n    this._writeRemarks()\n    this._writeAtoms()\n  }\n\n  private _writeTitle () {\n    // FIXME multiline if title line longer than 80 chars\n    this._records.push(sprintf('TITLE %-74s', this.structure.name))\n  }\n\n  private _writeRemarks () {\n    this.remarks.forEach(str => {\n      this._records.push(sprintf('REMARK %-73s', str))\n    })\n\n    if (this.structure.trajectory) {\n      this._records.push(sprintf(\n        'REMARK %-73s',\n        \"Trajectory '\" + this.structure.trajectory.name + \"'\"\n      ))\n      this._records.push(sprintf(\n        'REMARK %-73s',\n        `Frame ${(this.structure.trajectory as any).frame}`  // TODO\n      ))\n    }\n  }\n\n  private _writeAtoms () {\n    let ia = 1\n    let im = 1\n    let charge = \" \"\n    let chargeSign = \" \"\n    const hasModels = this.structure.modelStore.count > 1\n\n    this.structure.eachModel(m => {\n      if (hasModels) this._records.push(sprintf('MODEL     %4d%-66s', im++, ''))\n\n      m.eachAtom((a: AtomProxy) => {\n        const formatString = a.hetero ? HetatmFormat : AtomFormat\n        const serial = this.renumberSerial ? ia : a.serial\n\n        // Formal PDB spec\n        // Alignment of one-letter atom name such as C starts at column 14,\n        // while two-letter atom name such as FE starts at column 13.\n\n        // This, however, leaves Calcium and C-alpha ambiguous\n        // The convention (from earlier versions of the spec, see 1992, and also: \n        // https://www.cgl.ucsf.edu/chimera/docs/UsersGuide/tutorials/pdbintro.html#misalignment)\n        // is that element is right-justified in 13-14, modifiers are left justified in columns 15-16\n        // A single-character element symmbol should not appear in column 13 unless the atom name has four characters\n        let atomname = a.atomname\n\n        if (atomname.length === 1) {\n          // Simple case\n          atomname = ' ' + atomname\n        } else if (atomname.length < 4) {\n          // 2 or 3-letter name, if element symbol is single char and matches name, add a space\n          if (a.element.length === 1 && atomname[0] === a.element) {\n            atomname = ' ' + atomname\n          }\n        }\n\n        if (a.formalCharge) { // Skip nulls and zeros\n          charge = Math.abs(a.formalCharge).toPrecision(1)\n          chargeSign = (a.formalCharge > 0) ? \"+\" : \"-\"\n        } else {\n          charge = \" \"\n          chargeSign = \" \"\n        }\n\n        this._records.push(sprintf(\n          formatString,\n\n          serial,\n          atomname,\n          a.resname,\n          defaults(a.chainname, ' '),\n          a.resno,\n          a.x, a.y, a.z,\n          defaults(a.occupancy, 1.0),\n          defaults(a.bfactor, 0.0),\n          '',  // segid\n          defaults(a.element, ''),\n          charge,\n          chargeSign\n        ))\n        ia += 1\n      }, this.structure.getSelection())\n\n      if (hasModels) this._records.push(sprintf('%-80s', 'ENDMDL'))\n    })\n\n    this._records.push(sprintf('%-80s', 'END'))\n  }\n\n  getString () {\n    console.warn('PdbWriter.getString() is deprecated, use .getData instead')\n    return this.getData()\n  }\n\n  /**\n   * Get string containing the PDB file data\n   * @return {String} PDB file\n   */\n  getData () {\n    this._writeRecords()\n    return this._records.join('\\n')\n  }\n}\n","/**\n * Writer class for sdf/mol files.\n */\n\nimport { sprintf } from 'sprintf-js'\n\nimport Writer from './writer'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\n// Hard-coded chiral as false as we don't specify it any atoms\nconst CountFormat = '%3i%3i  0  0  0  0  0  0  0  0999 V2000'\nconst AtomLine = '%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0'\nconst BondFormat = '%3i%3i%3i  0  0  0'\n\nclass SdfWriter extends Writer {\n  readonly mimeType = 'text/plain'\n  readonly defaultName = 'structure'\n  readonly defaultExt = 'sdf'\n\n  structure: Structure\n  private _records: string[]\n\n  /**\n   * @param {Structure} structure - structure to write\n   * @param {Object} params - parameters\n   */\n  constructor (structure: Structure) {\n    super()\n\n    this.structure = structure\n    // Follow the pdb-writer example:\n    this._records = []\n  }\n\n  get idString () {\n    return this.structure.id\n  }\n\n  get titleString () {\n    return '  ' + this.structure.title\n  }\n\n  get countsString () {\n    return sprintf(\n      CountFormat,\n      this.structure.atomCount,\n      this.structure.bondCount\n      )\n  }\n\n  get chargeLines () {\n    const pairs: [number, number][] = []\n    this.structure.eachAtom(ap => {\n      if (ap.formalCharge != null && ap.formalCharge !== 0) {\n        pairs.push([ap.index, ap.formalCharge])\n      }\n    })\n    const lines = []\n    for (let i = 0; i < pairs.length; i += 8) {\n      const nCharges = Math.min(8, pairs.length - i)\n      let s = sprintf('M  CHG%3i', nCharges)\n      for (let j = i; j < i + nCharges; j++) {\n        s += sprintf(' %3i %3i', pairs[j][0] + 1, pairs[j][1])\n      }\n      lines.push(s)\n    }\n    return lines\n  }\n\n  formatAtom (ap: AtomProxy) {\n    let charge = 0\n    if (ap.formalCharge != null && ap.formalCharge !== 0) {\n      charge = 4 - ap.formalCharge\n    }\n    const line = sprintf(\n      AtomLine, ap.x, ap.y, ap.z, ap.element, charge\n    )\n    if (line.length !== 48) { throw new Error('Incompatible atom for sdf format') }\n\n    return line\n  }\n\n  formatBond (bp: BondProxy) {\n    return sprintf(\n      BondFormat,\n      bp.atomIndex1 + 1,\n      bp.atomIndex2 + 1,\n      bp.bondOrder)\n  }\n\n  _writeRecords () {\n    this._records.length = 0\n    this._writeHeader()\n    this._writeCTab()\n    this._writeFooter()\n  }\n\n  _writeHeader () {\n    this._records.push(this.idString, this.titleString, '')\n  }\n\n  _writeCTab () {\n    this._records.push(this.countsString)\n    this.structure.eachAtom(ap => {\n      this._records.push(this.formatAtom(ap))\n    })\n    this.structure.eachBond(bp => {\n      this._records.push(this.formatBond(bp))\n    })\n    this.chargeLines.forEach(line => {\n      this._records.push(line)\n    })\n    this._records.push('M  END')\n  }\n\n  _writeFooter () {\n    this._records.push('$$$$')\n  }\n\n  getData () {\n    this._writeRecords()\n    return this._records.join('\\n')\n  }\n}\n\nexport default SdfWriter\n","/**\n * @file IO Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n *\n * Adapted and converted to TypeScript from https://github.com/image-js/iobuffer\n * MIT License, Copyright (c) 2015 Michal Zasso\n */\n\nimport { TypedArray } from '../types'\n\nconst defaultByteLength = 1024 * 8\nconst charArray: string[] = []\n\nexport interface IOBufferParameters {\n  offset?: number  // Ignore the first n bytes of the ArrayBuffer\n}\n\n/**\n * Class for writing and reading binary data\n */\nclass IOBuffer {\n  private _lastWrittenByte: number\n  private _mark = 0\n  private _marks: number[] = []\n  private _data: DataView\n\n  offset = 0  // The current offset of the buffer's pointer\n  littleEndian = true\n  buffer: ArrayBuffer  // Reference to the internal ArrayBuffer object\n  length: number  // Byte length of the internal ArrayBuffer\n  byteLength: number  // Byte length of the internal ArrayBuffer\n  byteOffset: number  // Byte offset of the internal ArrayBuffer\n\n  /**\n   * If it's a number, it will initialize the buffer with the number as\n   * the buffer's length. If it's undefined, it will initialize the buffer\n   * with a default length of 8 Kb. If its an ArrayBuffer, a TypedArray,\n   * it will create a view over the underlying ArrayBuffer.\n   */\n  constructor (data: number|ArrayBuffer|TypedArray, params: IOBufferParameters = {}) {\n    let dataIsGiven = false\n    if (data === undefined) {\n      data = defaultByteLength\n    }\n    if (typeof data === 'number') {\n      data = new ArrayBuffer(data)\n    } else {\n      dataIsGiven = true\n    }\n\n    const offset = params.offset ? params.offset >>> 0 : 0\n    let byteLength = data.byteLength - offset\n    let dvOffset = offset\n    if (!(data instanceof ArrayBuffer)) {\n      if (data.byteLength !== data.buffer.byteLength) {\n        dvOffset = data.byteOffset + offset\n      }\n      data = data.buffer\n    }\n    if (dataIsGiven) {\n      this._lastWrittenByte = byteLength\n    } else {\n      this._lastWrittenByte = 0\n    }\n\n    this.buffer = data\n    this.length = byteLength\n    this.byteLength = byteLength\n    this.byteOffset = dvOffset\n\n    this._data = new DataView(this.buffer, dvOffset, byteLength)\n  }\n\n  /**\n   * Checks if the memory allocated to the buffer is sufficient to store more bytes after the offset\n   * @param {number} [byteLength=1] The needed memory in bytes\n   * @return {boolean} Returns true if there is sufficient space and false otherwise\n   */\n  available (byteLength: number) {\n    if (byteLength === undefined) byteLength = 1\n    return (this.offset + byteLength) <= this.length\n  }\n\n  /**\n   * Check if little-endian mode is used for reading and writing multi-byte values\n   * @return {boolean} Returns true if little-endian mode is used, false otherwise\n   */\n  isLittleEndian () {\n    return this.littleEndian\n  }\n\n  /**\n   * Set little-endian mode for reading and writing multi-byte values\n   * @return {IOBuffer}\n   */\n  setLittleEndian () {\n    this.littleEndian = true\n    return this\n  }\n\n  /**\n   * Check if big-endian mode is used for reading and writing multi-byte values\n   * @return {boolean} Returns true if big-endian mode is used, false otherwise\n   */\n  isBigEndian () {\n    return !this.littleEndian\n  }\n\n  /**\n   * Switches to big-endian mode for reading and writing multi-byte values\n   * @return {IOBuffer}\n   */\n  setBigEndian () {\n    this.littleEndian = false\n    return this\n  }\n\n  /**\n   * Move the pointer n bytes forward\n   * @param {number} n\n   * @return {IOBuffer}\n   */\n  skip (n: number) {\n    if (n === undefined) n = 1\n    this.offset += n\n    return this\n  }\n\n  /**\n   * Move the pointer to the given offset\n   * @param {number} offset\n   * @return {IOBuffer}\n   */\n  seek (offset: number) {\n    this.offset = offset\n    return this\n  }\n\n  /**\n   * Store the current pointer offset.\n   * @see {@link IOBuffer#reset}\n   * @return {IOBuffer}\n   */\n  mark () {\n    this._mark = this.offset\n    return this\n  }\n\n  /**\n   * Move the pointer back to the last pointer offset set by mark\n   * @see {@link IOBuffer#mark}\n   * @return {IOBuffer}\n   */\n  reset () {\n    this.offset = this._mark\n    return this\n  }\n\n  /**\n   * Push the current pointer offset to the mark stack\n   * @see {@link IOBuffer#popMark}\n   * @return {IOBuffer}\n   */\n  pushMark () {\n    this._marks.push(this.offset)\n    return this\n  }\n\n  /**\n   * Pop the last pointer offset from the mark stack, and set the current pointer offset to the popped value\n   * @see {@link IOBuffer#pushMark}\n   * @return {IOBuffer}\n   */\n  popMark () {\n    const offset = this._marks.pop()\n    if (offset === undefined) throw new Error('Mark stack empty')\n    this.seek(offset)\n    return this\n  }\n\n  /**\n   * Move the pointer offset back to 0\n   * @return {IOBuffer}\n   */\n  rewind () {\n    this.offset = 0\n    return this\n  }\n\n  /**\n   * Make sure the buffer has sufficient memory to write a given byteLength at the current pointer offset\n   * If the buffer's memory is insufficient, this method will create a new buffer (a copy) with a length\n   * that is twice (byteLength + current offset)\n   * @param {number} [byteLength = 1]\n   * @return {IOBuffer}\n   */\n  ensureAvailable (byteLength: number) {\n    if (byteLength === undefined) byteLength = 1\n    if (!this.available(byteLength)) {\n      const lengthNeeded = this.offset + byteLength\n      const newLength = lengthNeeded * 2\n      const newArray = new Uint8Array(newLength)\n      newArray.set(new Uint8Array(this.buffer))\n      this.buffer = newArray.buffer\n      this.length = this.byteLength = newLength\n      this._data = new DataView(this.buffer)\n    }\n    return this\n  }\n\n  /**\n   * Read a byte and return false if the byte's value is 0, or true otherwise\n   * Moves pointer forward\n   * @return {boolean}\n   */\n  readBoolean () {\n    return this.readUint8() !== 0\n  }\n\n  /**\n   * Read a signed 8-bit integer and move pointer forward\n   * @return {number}\n   */\n  readInt8 () {\n    return this._data.getInt8(this.offset++)\n  }\n\n  /**\n   * Read an unsigned 8-bit integer and move pointer forward\n   * @return {number}\n   */\n  readUint8 () {\n    return this._data.getUint8(this.offset++)\n  }\n\n  /**\n   * Alias for {@link IOBuffer#readUint8}\n   * @return {number}\n   */\n  readByte () {\n    return this.readUint8()\n  }\n\n  /**\n   * Read n bytes and move pointer forward.\n   * @param {number} n\n   * @return {Uint8Array}\n   */\n  readBytes (n: number) {\n    if (n === undefined) n = 1\n    var bytes = new Uint8Array(n)\n    for (var i = 0; i < n; i++) {\n      bytes[i] = this.readByte()\n    }\n    return bytes\n  }\n\n  /**\n   * Read a 16-bit signed integer and move pointer forward\n   * @return {number}\n   */\n  readInt16 () {\n    var value = this._data.getInt16(this.offset, this.littleEndian)\n    this.offset += 2\n    return value\n  }\n\n  /**\n   * Read a 16-bit unsigned integer and move pointer forward\n   * @return {number}\n   */\n  readUint16 () {\n    var value = this._data.getUint16(this.offset, this.littleEndian)\n    this.offset += 2\n    return value\n  }\n\n  /**\n   * Read a 32-bit signed integer and move pointer forward\n   * @return {number}\n   */\n  readInt32 () {\n    var value = this._data.getInt32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 32-bit unsigned integer and move pointer forward\n   * @return {number}\n   */\n  readUint32 () {\n    var value = this._data.getUint32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 32-bit floating number and move pointer forward\n   * @return {number}\n   */\n  readFloat32 () {\n    var value = this._data.getFloat32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 64-bit floating number and move pointer forward\n   * @return {number}\n   */\n  readFloat64 () {\n    var value = this._data.getFloat64(this.offset, this.littleEndian)\n    this.offset += 8\n    return value\n  }\n\n  /**\n   * Read 1-byte ascii character and move pointer forward\n   * @return {string}\n   */\n  readChar () {\n    return String.fromCharCode(this.readInt8())\n  }\n\n  /**\n   * Read n 1-byte ascii characters and move pointer forward\n   * @param {number} n\n   * @return {string}\n   */\n  readChars (n = 1) {\n    charArray.length = n\n    for (var i = 0; i < n; i++) {\n      charArray[i] = this.readChar()\n    }\n    return charArray.join('')\n  }\n\n  /**\n   * Write 0xff if the passed value is truthy, 0x00 otherwise\n   * @param {any} value\n   * @return {IOBuffer}\n   */\n  writeBoolean (value = false) {\n    this.writeUint8(value ? 0xff : 0x00)\n    return this\n  }\n\n  /**\n   * Write value as an 8-bit signed integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt8 (value: number) {\n    this.ensureAvailable(1)\n    this._data.setInt8(this.offset++, value)\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as a 8-bit unsigned integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeUint8 (value: number) {\n    this.ensureAvailable(1)\n    this._data.setUint8(this.offset++, value)\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * An alias for {@link IOBuffer#writeUint8}\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeByte (value: number) {\n    return this.writeUint8(value)\n  }\n\n  /**\n   * Write bytes\n   * @param {Array|Uint8Array} bytes\n   * @return {IOBuffer}\n   */\n  writeBytes (bytes: number[]|Uint8Array) {\n    this.ensureAvailable(bytes.length)\n    for (var i = 0; i < bytes.length; i++) {\n      this._data.setUint8(this.offset++, bytes[i])\n    }\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as an 16-bit signed integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt16 (value: number) {\n    this.ensureAvailable(2)\n    this._data.setInt16(this.offset, value, this.littleEndian)\n    this.offset += 2\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as a 16-bit unsigned integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeUint16 (value: number) {\n    this.ensureAvailable(2)\n    this._data.setUint16(this.offset, value, this.littleEndian)\n    this.offset += 2\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit signed integer at the current pointer offset\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setInt32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit unsigned integer at the current pointer offset\n   * @param {number} value - The value to set\n   * @return {IOBuffer}\n   */\n  writeUint32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setUint32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit floating number at the current pointer offset\n   * @param {number} value - The value to set\n   * @return {IOBuffer}\n   */\n  writeFloat32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setFloat32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 64-bit floating number at the current pointer offset\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeFloat64 (value: number) {\n    this.ensureAvailable(8)\n    this._data.setFloat64(this.offset, value, this.littleEndian)\n    this.offset += 8\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write the charCode of the passed string's first character to the current pointer offset\n   * @param {string} str - The character to set\n   * @return {IOBuffer}\n   */\n  writeChar (str: string) {\n    return this.writeUint8(str.charCodeAt(0))\n  }\n\n  /**\n   * Write the charCodes of the passed string's characters to the current pointer offset\n   * @param {string} str\n   * @return {IOBuffer}\n   */\n  writeChars (str: string) {\n    for (var i = 0; i < str.length; i++) {\n      this.writeUint8(str.charCodeAt(i))\n    }\n    return this\n  }\n\n  /**\n   * Export a Uint8Array view of the internal buffer.\n   * The view starts at the byte offset and its length\n   * is calculated to stop at the last written byte or the original length.\n   * @return {Uint8Array}\n   */\n  toArray () {\n    return new Uint8Array(this.buffer, this.byteOffset, this._lastWrittenByte)\n  }\n\n  /**\n   * Update the last written byte offset\n   * @private\n   */\n  _updateLastWrittenByte () {\n    if (this.offset > this._lastWrittenByte) {\n      this._lastWrittenByte = this.offset\n    }\n  }\n}\n\nexport default IOBuffer\n","/**\n * @file STL Writer\n * @author Paul Pillot <paul.pillot@cimf.ca>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport Writer from './writer'\nimport IOBuffer from '../utils/io-buffer'\nimport Surface from '../surface/surface'\n\n// https://en.wikipedia.org/wiki/STL_(file_format)#ASCII_STL\n\n/**\n * Create an STL File from a surface Object (e.g. for 3D printing)\n *\n * @example\n * molsurf = new MolecularSurface(structure)\n * surf = molsurf.getSurface({type: 'av', probeRadius: 1.4})\n * stl = new StlWriter(surf)\n * stl.download('myFileName')\n */\nexport default class StlWriter extends Writer {\n  readonly mimeType = 'application/vnd.ms-pki.stl'\n  readonly defaultName = 'surface'\n  readonly defaultExt = 'stl'\n\n  surface: any  // TODO\n\n  /**\n   * @param {Surface} surface - the surface to write out\n   */\n  constructor (surface: Surface) {\n    super()\n\n    this.surface = surface\n  }\n\n  /*\n   * Get STL Binary data\n   *\n   * Adapted from: https://github.com/mrdoob/three.js/blob/master/examples/js/exporters/STLBinaryExporter.js\n   * see https://en.wikipedia.org/wiki/STL_(file_format)#Binary_STL for the file format description\n   *\n   * @return {DataView} the data\n   */\n  getData () {\n    const triangles = this.surface.index.length / 3\n    const bufferLength = triangles * 2 + triangles * 3 * 4 * 4 + 80 + 4\n    const output = new IOBuffer(bufferLength)\n\n    output.skip(80)  // skip header\n    output.writeUint32(triangles)\n\n    const vector = new Vector3()\n    const vectorNorm1 = new Vector3()\n    const vectorNorm2 = new Vector3()\n    const vectorNorm3 = new Vector3()\n\n    // traversing vertices\n    for (let i = 0; i < triangles; i++) {\n      const indices = [\n        this.surface.index[i * 3],\n        this.surface.index[i * 3 + 1],\n        this.surface.index[i * 3 + 2]\n      ]\n\n      vectorNorm1.fromArray(this.surface.normal, indices[0] * 3)\n      vectorNorm2.fromArray(this.surface.normal, indices[1] * 3)\n      vectorNorm3.fromArray(this.surface.normal, indices[2] * 3)\n\n      vector.addVectors(vectorNorm1, vectorNorm2).add(vectorNorm3).normalize()\n\n      output.writeFloat32(vector.x)\n      output.writeFloat32(vector.y)\n      output.writeFloat32(vector.z)\n\n      for (let j = 0; j < 3; j++) {\n        vector.fromArray(this.surface.position, indices[j] * 3)\n\n        output.writeFloat32(vector.x)  // vertices\n        output.writeFloat32(vector.y)\n        output.writeFloat32(vector.z)\n      }\n\n      output.writeUint16(0)  // attribute byte count\n    }\n\n    return new DataView(output.buffer)\n  }\n}","/**\n * @file Counter\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log } from '../globals'\n\nimport * as signalsWrapper from 'signals'\n\n/**\n * {@link Signal}, dispatched when the `count` changes\n * @example\n * counter.signals.countChanged.add( function( delta ){ ... } );\n * @event Counter#countChanged\n * @type {Integer}\n */\n\nexport interface CounterSignals {\n  countChanged: signalsWrapper.Signal\n}\n\n/**\n * Counter class for keeping track of counts\n */\nclass Counter {\n  count = 0\n\n  signals: CounterSignals = {\n    countChanged: new signalsWrapper.Signal()\n  }\n\n  /**\n   * Set the `count` to zero\n   * @return {undefined}\n   */\n  clear () {\n    this.change(-this.count)\n  }\n\n  /**\n   * Change the `count`\n   * @fires Counter#countChanged\n   * @param {Integer} delta - count change\n   * @return {undefined}\n   */\n  change (delta: number) {\n    this.count += delta\n    this.signals.countChanged.dispatch(delta, this.count)\n\n    if (this.count < 0) {\n      Log.warn('Counter.count below zero', this.count)\n    }\n  }\n\n  /**\n   * Increments the `count` by one.\n   * @return {undefined}\n   */\n  increment () {\n    this.change(1)\n  }\n\n  /**\n   * Decrements the `count` by one.\n   * @return {undefined}\n   */\n  decrement () {\n    this.change(-1)\n  }\n\n  /**\n   * Listen to another counter object and change this `count` by the\n   * same amount\n   * @param  {Counter} counter - the counter object to listen to\n   * @return {undefined}\n   */\n  listen (counter: Counter) {\n    this.change(counter.count)\n    counter.signals.countChanged.add(this.change, this)\n  }\n\n  /**\n   * Stop listening to the other counter object\n   * @param  {Counter} counter - the counter object to stop listening to\n   * @return {undefined}\n   */\n  unlisten (counter: Counter) {\n    const countChanged = counter.signals.countChanged\n    if (countChanged.has(this.change, this)) {\n      countChanged.remove(this.change, this)\n    }\n  }\n\n  /**\n   * Invole the callback function once, when the `count` becomes zero\n   * @param  {Function} callback - the callback function\n   * @param  {Object}   context - the context for the callback function\n   * @return {undefined}\n   */\n  onZeroOnce (callback: () => void, context?: any) {\n    if (this.count === 0) {\n      callback.call(context)\n    } else {\n      const fn = () => {\n        if (this.count === 0) {\n          this.signals.countChanged.remove(fn, this)\n          callback.call(context)\n        }\n      }\n      this.signals.countChanged.add(fn, this)\n    }\n  }\n\n  dispose () {\n    this.clear()\n    this.signals.countChanged.dispose()\n  }\n}\n\nexport default Counter\n","/**\n * @file Stats\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport * as signalsWrapper from 'signals'\n\nexport default class Stats {\n  signals = {\n    updated: new signalsWrapper.Signal()\n  }\n\n  maxDuration = -Infinity\n  minDuration = Infinity\n  avgDuration = 14\n  lastDuration = Infinity\n\n  prevFpsTime = 0\n  lastFps = Infinity\n  lastFrames = 1\n  frames = 0\n  count = 0\n\n  startTime: number\n  currentTime: number\n\n  constructor () {\n    this.begin()\n  }\n\n  update () {\n    this.startTime = this.end()\n    this.currentTime = this.startTime\n    this.signals.updated.dispatch()\n  }\n\n  begin () {\n    this.startTime = window.performance.now()\n    this.lastFrames = this.frames\n  }\n\n  end () {\n    const time = window.performance.now()\n\n    this.count += 1\n    this.frames += 1\n\n    this.lastDuration = time - this.startTime\n    this.minDuration = Math.min(this.minDuration, this.lastDuration)\n    this.maxDuration = Math.max(this.maxDuration, this.lastDuration)\n    this.avgDuration -= this.avgDuration / 30\n    this.avgDuration += this.lastDuration / 30\n\n    if (time > this.prevFpsTime + 1000) {\n      this.lastFps = this.frames\n      this.prevFpsTime = time\n      this.frames = 0\n    }\n\n    return time\n  }\n}","/**\n * @file Shader Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ShaderChunk } from 'three'\n\nimport './chunk/fog_fragment.glsl'\nimport './chunk/interior_fragment.glsl'\nimport './chunk/matrix_scale.glsl'\nimport './chunk/nearclip_vertex.glsl'\nimport './chunk/nearclip_fragment.glsl'\nimport './chunk/opaque_back_fragment.glsl'\nimport './chunk/radiusclip_vertex.glsl'\nimport './chunk/radiusclip_fragment.glsl'\nimport './chunk/unpack_color.glsl'\n\nimport { ShaderRegistry } from '../globals'\n\nexport type ShaderDefine = (\n  'NEAR_CLIP'|'RADIUS_CLIP'|'PICKING'|'NOLIGHT'|'FLAT_SHADED'|'OPAQUE_BACK'|\n  'DIFFUSE_INTERIOR'|'USE_INTERIOR_COLOR'|\n  'USE_SIZEATTENUATION'|'USE_MAP'|'USE_ALPHATEST'|'SDF'|'FIXED_SIZE'|\n  'CUBIC_INTERPOLATION'|'BSPLINE_FILTER'|'CATMULROM_FILTER'|'MITCHELL_FILTER'\n)\nexport type ShaderDefines = {\n  [k in ShaderDefine]?: number|string\n}\n\nfunction getDefines (defines: ShaderDefines) {\n  if (defines === undefined) return ''\n\n  const lines = []\n\n  for (const name in defines) {\n    const value = defines[ name as keyof ShaderDefines ]\n\n    if (!value) continue\n\n    lines.push(`#define ${name} ${value}`)\n  }\n\n  return lines.join('\\n') + '\\n'\n}\n\nconst reInclude = /^(?!\\/\\/)\\s*#include\\s+(\\S+)/gmi\nconst shaderCache: { [k: string]: string } = {}\n\nexport function getShader (name: string, defines: ShaderDefines = {}) {\n  let hash = name + '|'\n  for (const key in defines) {\n    hash += key + ':' + defines[ key as keyof ShaderDefines ]\n  }\n\n  if (!shaderCache[ hash ]) {\n    const definesText = getDefines(defines)\n\n    let shaderText = ShaderRegistry.get(`shader/${name}`) as string\n    if (!shaderText) {\n      throw new Error(`empty shader, '${name}'`)\n    }\n    shaderText = shaderText.replace(reInclude, function (match, p1: keyof typeof ShaderChunk) {\n      const path = `shader/chunk/${p1}.glsl`\n      const chunk = ShaderRegistry.get(path) || ShaderChunk[ p1 ]\n      if (!chunk) {\n        throw new Error(`empty chunk, '${p1}'`)\n      }\n      return chunk\n    })\n\n    shaderCache[ hash ] = definesText + shaderText\n  }\n\n  return shaderCache[ hash ]\n}\n","/**\n * @file Viewer Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug } from '../globals'\n\nif (typeof WebGLRenderingContext !== 'undefined') {\n  const wrcp = WebGLRenderingContext.prototype\n\n  // wrap WebGL debug function used by three.js and\n  // ignore calls to them when the debug flag is not set\n\n  const _getShaderParameter = wrcp.getShaderParameter\n  wrcp.getShaderParameter = function getShaderParameter (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getShaderParameter.apply(this, arguments)\n    } else {\n      return true\n    }\n  }\n\n  const _getShaderInfoLog = wrcp.getShaderInfoLog\n  wrcp.getShaderInfoLog = function getShaderInfoLog (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getShaderInfoLog.apply(this, arguments)\n    } else {\n      return ''\n    }\n  }\n\n  const _getProgramParameter = wrcp.getProgramParameter\n  wrcp.getProgramParameter = function getProgramParameter (this: WebGLRenderingContext, program, pname) {\n    if (Debug || pname !== wrcp.LINK_STATUS) {\n      return _getProgramParameter.apply(this, arguments)\n    } else {\n      return true\n    }\n  }\n\n  const _getProgramInfoLog = wrcp.getProgramInfoLog\n  wrcp.getProgramInfoLog = function getProgramInfoLog (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getProgramInfoLog.apply(this, arguments)\n    } else {\n      return ''\n    }\n  }\n}\n\nexport const JitterVectors = [\n  [\n    [ 0, 0 ]\n  ],\n  [\n    [ 4, 4 ], [ -4, -4 ]\n  ],\n  [\n    [ -2, -6 ], [ 6, -2 ], [ -6, 2 ], [ 2, 6 ]\n  ],\n  [\n    [ 1, -3 ], [ -1, 3 ], [ 5, 1 ], [ -3, -5 ],\n    [ -5, 5 ], [ -7, -1 ], [ 3, 7 ], [ 7, -7 ]\n  ],\n  [\n    [ 1, 1 ], [ -1, -3 ], [ -3, 2 ], [ 4, -1 ],\n    [ -5, -2 ], [ 2, 5 ], [ 5, 3 ], [ 3, -5 ],\n    [ -2, 6 ], [ 0, -7 ], [ -4, -6 ], [ -6, 4 ],\n    [ -8, 0 ], [ 7, -4 ], [ 6, 7 ], [ -7, -8 ]\n  ],\n  [\n    [ -4, -7 ], [ -7, -5 ], [ -3, -5 ], [ -5, -4 ],\n    [ -1, -4 ], [ -2, -2 ], [ -6, -1 ], [ -4, 0 ],\n    [ -7, 1 ], [ -1, 2 ], [ -6, 3 ], [ -3, 3 ],\n    [ -7, 6 ], [ -3, 6 ], [ -5, 7 ], [ -1, 7 ],\n    [ 5, -7 ], [ 1, -6 ], [ 6, -5 ], [ 4, -4 ],\n    [ 2, -3 ], [ 7, -2 ], [ 1, -1 ], [ 4, -1 ],\n    [ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],\n    [ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]\n  ]\n]\n\nJitterVectors.forEach(offsetList => {\n  offsetList.forEach(offset => {\n    // 0.0625 = 1 / 16\n    offset[ 0 ] *= 0.0625\n    offset[ 1 ] *= 0.0625\n  })\n})\n","/**\n * @file Tiled Renderer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { Camera, WebGLRenderer } from 'three'\nimport Viewer from './viewer'\n\nexport interface TiledRendererParams {\n  factor?: number\n  antialias?: boolean\n  onProgress?: Function\n  onFinish?: Function\n}\n\nclass TiledRenderer {\n  canvas = document.createElement('canvas')\n\n  private _width: number\n  private _height: number\n  private _n: number\n  private _factor: number\n  private _antialias: boolean\n  private _viewerSampleLevel: number\n\n  private _viewer: Viewer\n  private _onProgress?: Function\n  private _onFinish?: Function\n  private _ctx: CanvasRenderingContext2D\n\n  constructor(renderer: WebGLRenderer, camera: Camera, viewer: Viewer, params: TiledRendererParams) {\n    this._viewer = viewer\n\n    this._factor = defaults(params.factor, 2)\n    this._antialias = defaults(params.antialias, false)\n\n    this._onProgress = params.onProgress\n    this._onFinish = params.onFinish\n\n    if (this._antialias) this._factor *= 2\n    this._n = this._factor * this._factor\n\n    // canvas\n\n    this._width = this._viewer.width\n    this._height = this._viewer.height\n\n    if (this._antialias) {\n      this.canvas.width = this._width * this._factor / 2\n      this.canvas.height = this._height * this._factor / 2\n    } else {\n      this.canvas.width = this._width * this._factor\n      this.canvas.height = this._height * this._factor\n    }\n\n    this._ctx = this.canvas.getContext('2d')!\n\n    this._viewerSampleLevel = viewer.sampleLevel\n    this._viewer.setSampling(-1)\n  }\n\n  private _renderTile (i: number) {\n    const viewer = this._viewer\n    const width = this._width\n    const height = this._height\n    const factor = this._factor\n\n    const x = i % factor\n    const y = Math.floor(i / factor)\n\n    const offsetX = x * width\n    const offsetY = y * height\n\n    viewer.camera.setViewOffset(\n      width * factor,\n      height * factor,\n      offsetX,\n      offsetY,\n      width,\n      height\n    )\n\n    viewer.render()\n\n    if (this._antialias) {\n        const w = Math.round((offsetX + width) / 2) - Math.round (offsetX / 2);\n        const h = Math.round((offsetY + height) / 2) - Math.round (offsetY / 2);\n      this._ctx.drawImage(\n        viewer.renderer.domElement,\n        Math.round(offsetX / 2),\n        Math.round(offsetY / 2),\n        w,\n        h\n      )\n    } else {\n      this._ctx.drawImage(\n        viewer.renderer.domElement,\n        Math.floor(offsetX),\n        Math.floor(offsetY),\n        Math.ceil(width),\n        Math.ceil(height)\n      )\n    }\n\n    if (typeof this._onProgress === 'function') {\n      this._onProgress(i + 1, this._n, false)\n    }\n  }\n\n  private _finalize () {\n    this._viewer.setSampling(this._viewerSampleLevel)\n    this._viewer.camera.view = null!  // TODO\n\n    if (typeof this._onFinish === 'function') {\n      this._onFinish(this._n + 1, this._n, false)\n    }\n  }\n\n  render () {\n    for (let i = 0; i <= this._n; ++i) {\n      if (i === this._n) {\n        this._finalize()\n      } else {\n        this._renderTile(i)\n      }\n    }\n  }\n\n  renderAsync () {\n    let count = 0\n    const n = this._n\n\n    const fn = () => {\n      if (count === n) {\n        this._finalize()\n      } else {\n        this._renderTile(count)\n      }\n      count += 1\n    }\n\n    for (let i = 0; i <= n; ++i) {\n      setTimeout(fn, 0)\n    }\n  }\n}\n\nexport default TiledRenderer\n","/**\n * @file Math Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const EPS = 0.0000001\nexport const TwoPI = 2 * Math.PI\n\nexport const DEG2RAD = Math.PI / 180\nexport const RAD2DEG = 180 / Math.PI\n","/**\n * @file Array Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport { TwoPI } from './math-constants'\n\nexport function circularMean (array: NumberArray, max: number, stride = 1, offset = 0, indices?: NumberArray) {\n  // http://en.wikipedia.org/wiki/Center_of_mass#Systems_with_periodic_boundary_conditions\n\n  // Bai, Linge; Breen, David (2008). Calculating Center of Mass in an Unbounded 2D Environment. Journal of Graphics, GPU, and Game Tools 13 (4): 5360.\n\n  // http://stackoverflow.com/questions/18166507/using-fft-to-find-the-center-of-mass-under-periodic-boundary-conditions\n\n  const n = indices ? indices.length : array.length / stride\n\n  let cosMean = 0\n  let sinMean = 0\n\n  if (indices) {\n    for (let i = 0; i < n; ++i) {\n      const c = (array[ indices[ i ] * stride + offset ] + max) % max\n      const angle = (c / max) * TwoPI - Math.PI\n\n      cosMean += Math.cos(angle)\n      sinMean += Math.sin(angle)\n    }\n  } else {\n    for (let i = offset; i < n; i += stride) {\n      const c = (array[ i ] + max) % max\n      const angle = (c / max) * TwoPI - Math.PI\n\n      cosMean += Math.cos(angle)\n      sinMean += Math.sin(angle)\n    }\n  }\n\n  cosMean /= n\n  sinMean /= n\n\n  const meanAngle = Math.atan2(sinMean, cosMean)\n  const mean = (meanAngle + Math.PI) / TwoPI * max\n\n  return mean\n}\n\nexport function calculateCenterArray <T extends NumberArray = Float32Array>(array1: NumberArray, array2: NumberArray, center?: T, offset = 0): T {\n  const n = array1.length\n  const c = center || new Float32Array(n)\n\n  for (let i = 0; i < n; i += 3) {\n    c[ offset + i + 0 ] = (array1[ i + 0 ] + array2[ i + 0 ]) / 2.0\n    c[ offset + i + 1 ] = (array1[ i + 1 ] + array2[ i + 1 ]) / 2.0\n    c[ offset + i + 2 ] = (array1[ i + 2 ] + array2[ i + 2 ]) / 2.0\n  }\n\n  return c as T\n}\n\nexport function calculateDirectionArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const direction = new Float32Array(n)\n\n  for (let i = 0; i < n; i += 3) {\n    direction[ i + 0 ] = array2[ i + 0 ] - array1[ i + 0 ]\n    direction[ i + 1 ] = array2[ i + 1 ] - array1[ i + 1 ]\n    direction[ i + 2 ] = array2[ i + 2 ] - array1[ i + 2 ]\n  }\n\n  return direction\n}\n\nexport function uniformArray <T extends NumberArray = Float32Array>(n: number, a: number, optionalTarget?: T): T {\n  const array = optionalTarget || new Float32Array(n)\n\n  for (let i = 0; i < n; ++i) {\n    array[ i ] = a\n  }\n\n  return array as T\n}\n\nexport function uniformArray3 (n: number, a: number, b: number, c: number, optionalTarget?: NumberArray) {\n  const array = optionalTarget || new Float32Array(n * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const j = i * 3\n\n    array[ j + 0 ] = a\n    array[ j + 1 ] = b\n    array[ j + 2 ] = c\n  }\n\n  return array\n}\n\nexport function centerArray3 (array: NumberArray, center = new Vector3()) {\n  const n = array.length\n\n  for (let i = 0; i < n; i += 3) {\n    center.x += array[ i ]\n    center.y += array[ i + 1 ]\n    center.z += array[ i + 2 ]\n  }\n\n  center.divideScalar(n / 3)\n\n  return center\n}\n\nexport function serialArray (n: number) {\n  const array = new Float32Array(n)\n\n  for (let i = 0; i < n; ++i) {\n    array[ i ] = i\n  }\n\n  return array\n}\n\nexport function serialBlockArray (n: number, b: number, offset = 0, optionalTarget?: NumberArray) {\n  const array = optionalTarget || new Float32Array(n * b)\n\n  for (let i = 0; i < n; ++i) {\n    const k = offset + i * b\n\n    for (let j = 0; j < b; ++j) {\n      array[ k + j ] = i\n    }\n  }\n\n  return array\n}\n\nexport function randomColorArray (n: number) {\n  const array = new Float32Array(n * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const j = i * 3\n\n    array[ j + 0 ] = Math.random()\n    array[ j + 1 ] = Math.random()\n    array[ j + 2 ] = Math.random()\n  }\n\n  return array\n}\n\nexport function replicateArrayEntries (array: NumberArray, m: number) {\n  const n = array.length\n  const repArr = new Float32Array(n * m)\n\n  for (let i = 0; i < n; ++i) {\n    const k = i * m\n    const a = array[ i ]\n\n    for (let j = 0; j < m; ++j) {\n      repArr[ k + j ] = a\n    }\n  }\n\n  return repArr\n}\n\nexport function replicateArray3Entries (array: NumberArray, m: number) {\n  const n = array.length / 3\n  const repArr = new Float32Array(n * m * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const v = i * 3\n    const k = i * m * 3\n\n    const a = array[ v + 0 ]\n    const b = array[ v + 1 ]\n    const c = array[ v + 2 ]\n\n    for (let j = 0; j < m; ++j) {\n      const l = k + j * 3\n\n      repArr[ l + 0 ] = a\n      repArr[ l + 1 ] = b\n      repArr[ l + 2 ] = c\n    }\n  }\n\n  return repArr\n}\n\nexport function calculateMeanArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const mean = new Float32Array(n)\n\n  for (let i = 0; i < n; i++) {\n    mean[ i ] = (array1[ i ] + array2[ i ]) / 2.0\n  }\n\n  return mean\n}\n\nexport function calculateMinArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const min = new Float32Array(n)\n\n  for (let i = 0; i < n; i++) {\n    min[ i ] = Math.min(array1[ i ], array2[ i ])\n  }\n\n  return min\n}\n\nexport function copyArray<T extends any[]|NumberArray> (src: T, dst: T, srcOffset: number, dstOffset: number, length: number) {\n  for (let i = 0; i < length; ++i) {\n    dst[ dstOffset + i ] = src[ srcOffset + i ]\n  }\n}\n\nexport function copyWithin (array: NumberArray|any[], srcOffset: number, dstOffset: number, length: number) {\n  copyArray(array, array, srcOffset, dstOffset, length)\n}\n\nconst swap = new Float32Array(4)\nconst temp = new Float32Array(4)\n/**\n * quicksortIP\n * @function\n * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013\n * @author I4DS http://www.fhnw.ch/i4ds, 2013\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n * @description\n * In-place quicksort for typed arrays (e.g. for Float32Array)\n * provides fast sorting\n * useful e.g. for a custom shader and/or BufferGeometry\n * Complexity: http://bigocheatsheet.com/ see Quicksort\n *\n * @example\n * points: [x, y, z, x, y, z, x, y, z, ...]\n * eleSize: 3 //because of (x, y, z)\n * orderElement: 0 //order according to x\n *\n * @param {TypedArray} arr - array to be sorted\n * @param {Integer} eleSize - element size\n * @param {Integer} orderElement - index of element used for sorting, < eleSize\n * @param {Integer} [begin] - start index for range to be sorted\n * @param {Integer} [end] - end index for range to be sorted\n * @return {TypedArray} the input array\n */\nexport function quicksortIP (arr: NumberArray, eleSize: number, orderElement: number, begin = 0, end?: number) {\n  end = (end || (arr.length / eleSize)) - 1\n\n  const stack = []\n  let sp = -1\n  let left = begin\n  let right = end\n  let tmp = 0.0\n  let x = 0\n  let y = 0\n\n  const swapF = function (a: number, b: number) {\n    a *= eleSize; b *= eleSize\n    for (y = 0; y < eleSize; y++) {\n      tmp = arr[ a + y ]\n      arr[ a + y ] = arr[ b + y ]\n      arr[ b + y ] = tmp\n    }\n  }\n\n  let i, j\n\n  while (true) {\n    if (right - left <= 25) {\n      for (j = left + 1; j <= right; j++) {\n        for (x = 0; x < eleSize; x++) {\n          swap[ x ] = arr[ j * eleSize + x ]\n        }\n\n        i = j - 1\n\n        while (i >= left && arr[ i * eleSize + orderElement ] > swap[ orderElement ]) {\n          for (x = 0; x < eleSize; x++) {\n            arr[ (i + 1) * eleSize + x ] = arr[ i * eleSize + x ]\n          }\n          i--\n        }\n\n        for (x = 0; x < eleSize; x++) {\n          arr[ (i + 1) * eleSize + x ] = swap[ x ]\n        }\n      }\n\n      if (sp === -1) break\n\n      right = stack[ sp-- ] // ?\n      left = stack[ sp-- ]\n    } else {\n      const median = (left + right) >> 1\n\n      i = left + 1\n      j = right\n\n      swapF(median, i)\n\n      if (arr[ left * eleSize + orderElement ] > arr[ right * eleSize + orderElement ]) {\n        swapF(left, right)\n      }\n\n      if (arr[ i * eleSize + orderElement ] > arr[ right * eleSize + orderElement ]) {\n        swapF(i, right)\n      }\n\n      if (arr[ left * eleSize + orderElement ] > arr[ i * eleSize + orderElement ]) {\n        swapF(left, i)\n      }\n\n      for (x = 0; x < eleSize; x++) {\n        temp[ x ] = arr[ i * eleSize + x ]\n      }\n\n      while (true) {\n        do i++; while (arr[ i * eleSize + orderElement ] < temp[ orderElement ])\n        do j--; while (arr[ j * eleSize + orderElement ] > temp[ orderElement ])\n        if (j < i) break\n        swapF(i, j)\n      }\n\n      for (x = 0; x < eleSize; x++) {\n        arr[ (left + 1) * eleSize + x ] = arr[ j * eleSize + x ]\n        arr[ j * eleSize + x ] = temp[ x ]\n      }\n\n      if (right - i + 1 >= j - left) {\n        stack[ ++sp ] = i\n        stack[ ++sp ] = right\n        right = j - 1\n      } else {\n        stack[ ++sp ] = left\n        stack[ ++sp ] = j - 1\n        left = i\n      }\n    }\n  }\n\n  return arr\n}\n\nexport function quicksortCmp<T> (arr: NumberArray|T[], cmp?: (a: number|T, b: number|T) => number, begin = 0, end?: number) {\n  cmp = cmp || function cmp (a, b) {\n    if (a > b) return 1\n    if (a < b) return -1\n    return 0\n  }\n  end = (end || arr.length) - 1\n\n  const stack = []\n  let sp = -1\n  let left = begin\n  let right = end\n  let tmp: number|T\n\n  function swap (a: number, b: number) {\n    const tmp2 = arr[ a ]\n    arr[ a ] = arr[ b ]\n    arr[ b ] = tmp2\n  }\n\n  let i, j\n\n  while (true) {\n    if (right - left <= 25) {\n      for (let k = left + 1; k <= right; ++k) {\n        tmp = arr[ k ]\n        i = k - 1\n\n        while (i >= left && cmp(arr[ i ], tmp) > 0) {\n          arr[ i + 1 ] = arr[ i ]\n          --i\n        }\n\n        arr[ i + 1 ] = tmp\n      }\n\n      if (sp === -1) break\n\n      right = stack[ sp-- ] // ?\n      left = stack[ sp-- ]\n    } else {\n      const median = (left + right) >> 1\n\n      i = left + 1\n      j = right\n\n      swap(median, i)\n\n      if (cmp(arr[ left ], arr[ right ]) > 0) {\n        swap(left, right)\n      }\n\n      if (cmp(arr[ i ], arr[ right ]) > 0) {\n        swap(i, right)\n      }\n\n      if (cmp(arr[ left ], arr[ i ]) > 0) {\n        swap(left, i)\n      }\n\n      tmp = arr[ i ]\n\n      while (true) {\n        do i++; while (cmp(arr[ i ], tmp) < 0)\n        do j--; while (cmp(arr[ j ], tmp) > 0)\n        if (j < i) break\n        swap(i, j)\n      }\n\n      arr[ left + 1 ] = arr[ j ]\n      arr[ j ] = tmp\n\n      if (right - i + 1 >= j - left) {\n        stack[ ++sp ] = i\n        stack[ ++sp ] = right\n        right = j - 1\n      } else {\n        stack[ ++sp ] = left\n        stack[ ++sp ] = j - 1\n        left = i\n      }\n    }\n  }\n\n  return arr\n}\n\nexport function quickselectCmp<T> (arr: NumberArray|T[], n: number, cmp?: (a: number|T, b: number|T) => number, left = 0, right?: number) {\n  cmp = cmp || function cmp (a, b) {\n    if (a > b) return 1\n    if (a < b) return -1\n    return 0\n  }\n  right = (right || arr.length) - 1\n\n  let pivotIndex, pivotValue, storeIndex\n\n  function swap (a: number, b: number) {\n    const tmp = arr[ a ]\n    arr[ a ] = arr[ b ]\n    arr[ b ] = tmp\n  }\n\n  while (true) {\n    if (left === right) {\n      return arr[ left ]\n    }\n    pivotIndex = (left + right) >> 1\n    pivotValue = arr[ pivotIndex ]\n    swap(pivotIndex, right)\n    storeIndex = left\n    for (let i = left; i < right; ++i) {\n      if (cmp(arr[ i ], pivotValue) < 0) {\n        swap(storeIndex, i)\n        ++storeIndex\n      }\n    }\n    swap(right, storeIndex)\n    pivotIndex = storeIndex\n    if (n === pivotIndex) {\n      return arr[ n ]\n    } else if (n < pivotIndex) {\n      right = pivotIndex - 1\n    } else {\n      left = pivotIndex + 1\n    }\n  }\n}\n\nexport function arrayMax (array: NumberArray) {\n  let max = -Infinity\n  for (let i = 0, il = array.length; i < il; ++i) {\n    if (array[ i ] > max) max = array[ i ]\n  }\n  return max\n}\n\nexport function arrayMin (array: NumberArray) {\n  let min = Infinity\n  for (let i = 0, il = array.length; i < il; ++i) {\n    if (array[ i ] < min) min = array[ i ]\n  }\n  return min\n}\n\nexport function arraySum (array: NumberArray, stride = 1, offset = 0) {\n  const n = array.length\n  let sum = 0\n  for (let i = offset; i < n; i += stride) {\n    sum += array[ i ]\n  }\n  return sum\n}\n\nexport function arrayMean (array: NumberArray, stride = 1, offset = 0) {\n  return arraySum(array, stride, offset) / (array.length / stride)\n}\n\nexport function arrayRms (array: NumberArray) {\n  const n = array.length\n  let sumSq = 0\n  for (let i = 0; i < n; ++i) {\n    const di = array[ i ]\n    sumSq += di * di\n  }\n  return Math.sqrt(sumSq / n)\n}\n\nexport function arraySorted (array: NumberArray) {\n  for (let i = 1, il = array.length; i < il; ++i) {\n    if (array[ i - 1 ] > array[ i ]) return false\n  }\n  return true\n}\n\nexport function arraySortedCmp<T> (array: NumberArray|T[], cmp: (a: number|T, b: number|T) => number) {\n  for (let i = 1, il = array.length; i < il; ++i) {\n    if (cmp(array[ i - 1 ], array[ i ]) > 0) return false\n  }\n  return true\n}\n","/**\n * @file Viewer Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  Vector2, Vector3, Matrix4, Points, Scene, Camera,\n  Object3D, WebGLRenderer, Color\n} from 'three'\n\nimport { createParams } from '../utils'\nimport TiledRenderer from './tiled-renderer'\nimport { quicksortCmp } from '../math/array-utils'\nimport Viewer from './viewer'\n\nfunction _trimCanvas (canvas: HTMLCanvasElement, r: number, g: number, b: number, a: number) {\n  const canvasHeight = canvas.height\n  const canvasWidth = canvas.width\n\n  const ctx = canvas.getContext('2d')!\n  const pixels = ctx.getImageData(0, 0, canvasWidth, canvasHeight).data\n\n  let x, y, doBreak, off\n\n  doBreak = false\n  for (y = 0; y < canvasHeight; y++) {\n    for (x = 0; x < canvasWidth; x++) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const topY = y\n\n  doBreak = false\n  for (x = 0; x < canvasWidth; x++) {\n    for (y = 0; y < canvasHeight; y++) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const topX = x\n\n  doBreak = false\n  for (y = canvasHeight - 1; y >= 0; y--) {\n    for (x = canvasWidth - 1; x >= 0; x--) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const bottomY = y\n\n  doBreak = false\n  for (x = canvasWidth - 1; x >= 0; x--) {\n    for (y = canvasHeight - 1; y >= 0; y--) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const bottomX = x\n\n  const trimedCanvas = document.createElement('canvas')\n  trimedCanvas.width = bottomX - topX\n  trimedCanvas.height = bottomY - topY\n\n  const trimedCtx = trimedCanvas.getContext('2d')!\n  trimedCtx.drawImage(\n    canvas,\n    topX, topY,\n    trimedCanvas.width, trimedCanvas.height,\n    0, 0,\n    trimedCanvas.width, trimedCanvas.height\n  )\n\n  return trimedCanvas\n}\n\n/**\n * Image parameter object.\n * @typedef {Object} ImageParameters - image generation parameters\n * @property {Boolean} trim - trim the image\n * @property {Integer} factor - scaling factor to apply to the viewer canvas\n * @property {Boolean} antialias - antialias the image\n * @property {Boolean} transparent - transparent image background\n */\n\nexport const ImageDefaultParameters = {\n  trim: false,\n  factor: 1,\n  antialias: false,\n  transparent: false,\n  onProgress: undefined as Function|undefined\n}\nexport type ImageParameters = typeof ImageDefaultParameters\n\n/**\n * Make image from what is shown in a viewer canvas\n * @param  {Viewer} viewer - the viewer\n * @param  {ImageParameters} params - parameters object\n * @return {Promise} A Promise object that resolves to an image {@link Blob}.\n */\nexport function makeImage (viewer: Viewer, params: Partial<ImageParameters> = {}) {\n  const {trim, factor, antialias, transparent} = createParams(params, ImageDefaultParameters)\n\n  const renderer = viewer.renderer\n  const camera = viewer.camera\n\n  const originalClearAlpha = renderer.getClearAlpha()\n  const backgroundColor = renderer.getClearColor(new Color())\n\n  function setLineWidthAndPixelSize (invert = false) {\n    let _factor = factor\n    if (antialias) _factor *= 2\n    if (invert) _factor = 1 / _factor\n    viewer.scene.traverse(function (o: any) {  // TODO\n      const m = o.material\n      if (m && m.linewidth) {\n        m.linewidth *= _factor\n      }\n      if (m && m.uniforms && m.uniforms.size) {\n        if (m.uniforms.size.__seen === undefined) {\n          m.uniforms.size.value *= _factor\n          m.uniforms.size.__seen = true\n        }\n      }\n      if (m && m.uniforms && m.uniforms.linewidth) {\n        if (m.uniforms.linewidth.__seen === undefined) {\n          m.uniforms.linewidth.value *= _factor\n          m.uniforms.linewidth.__seen = true\n        }\n      }\n    })\n    viewer.scene.traverse(function (o: any) {  // TODO\n      const m = o.material\n      if (m && m.uniforms && m.uniforms.size) {\n        delete m.uniforms.size.__seen\n      }\n      if (m && m.uniforms && m.uniforms.linewidth) {\n        delete m.uniforms.linewidth.__seen\n      }\n    })\n  }\n\n  function trimCanvas (canvas: HTMLCanvasElement) {\n    if (trim) {\n      const bg = backgroundColor\n      const r = transparent ? 0 : bg.r * 255\n      const g = transparent ? 0 : bg.g * 255\n      const b = transparent ? 0 : bg.b * 255\n      const a = transparent ? 0 : 255\n      return _trimCanvas(canvas, r, g, b, a)\n    } else {\n      return canvas\n    }\n  }\n\n  function onProgress (i: number, n: number, finished: boolean) {\n    if (typeof params.onProgress === 'function') {\n      params.onProgress(i, n, finished)\n    }\n  }\n\n  return new Promise<Blob>(function (resolve, reject) {\n    const tiledRenderer = new TiledRenderer(\n      renderer, camera, viewer,\n      { factor, antialias, onProgress, onFinish }\n    )\n\n    renderer.setClearAlpha(transparent ? 0 : 1)\n    setLineWidthAndPixelSize()\n    tiledRenderer.renderAsync()\n\n    function onFinish (i: number, n: number) {\n      const canvas = trimCanvas(tiledRenderer.canvas)\n      canvas.toBlob(\n        function (blob) {\n          renderer.setClearAlpha(originalClearAlpha)\n          setLineWidthAndPixelSize(true)\n          viewer.requestRender()\n          onProgress(n, n, true)\n          if (blob) {\n            resolve(blob)\n          } else {\n            reject('error creating image')\n          }\n        },\n        'image/png'\n      )\n    }\n  })\n}\n\nconst vertex = new Vector3()\nconst matrix = new Matrix4()\nconst modelViewProjectionMatrix = new Matrix4()\n\nexport function sortProjectedPosition (scene: Scene, camera: Camera) {\n  // console.time( \"sort\" );\n\n  scene.traverseVisible(function (o) {\n    if (!(o instanceof Points) || !o.userData.buffer.parameters.sortParticles) {\n      return\n    }\n\n    const attributes = (o.geometry as any).attributes  // TODO\n    const n = attributes.position.count\n\n    if (n === 0) return\n\n    matrix.multiplyMatrices(\n      camera.matrixWorldInverse, o.matrixWorld\n    )\n    modelViewProjectionMatrix.multiplyMatrices(\n      camera.projectionMatrix, matrix\n    )\n\n    let sortData, sortArray, zArray: Float32Array, cmpFn\n\n    if (!o.userData.sortData) {\n      zArray = new Float32Array(n)\n      sortArray = new Uint32Array(n)\n      cmpFn = function (ai: number, bi: number) {\n        const a = zArray[ ai ]\n        const b = zArray[ bi ]\n        if (a > b) return 1\n        if (a < b) return -1\n        return 0\n      }\n\n      sortData = {\n        __zArray: zArray,\n        __sortArray: sortArray,\n        __cmpFn: cmpFn\n      }\n\n      o.userData.sortData = sortData\n    } else {\n      sortData = o.userData.sortData\n      zArray = sortData.__zArray\n      sortArray = sortData.__sortArray\n      cmpFn = sortData.__cmpFn\n    }\n\n    for (let i = 0; i < n; ++i) {\n      vertex.fromArray(attributes.position.array, i * 3)\n      vertex.applyMatrix4(modelViewProjectionMatrix)\n\n      // negate, so that sorting order is reversed\n      zArray[ i ] = -vertex.z\n      sortArray[ i ] = i\n    }\n\n    quicksortCmp(sortArray, cmpFn)\n\n    let index, indexSrc, indexDst, tmpTab\n\n    for (let name in attributes) {\n      const attr = attributes[ name ]\n      const array = attr.array\n      const itemSize = attr.itemSize\n\n      if (!sortData[ name ]) {\n        sortData[ name ] = new Float32Array(itemSize * n)\n      }\n\n      tmpTab = sortData[ name ]\n      sortData[ name ] = array\n\n      for (let i = 0; i < n; ++i) {\n        index = sortArray[ i ]\n\n        for (let j = 0; j < itemSize; ++j) {\n          indexSrc = index * itemSize + j\n          indexDst = i * itemSize + j\n          tmpTab[ indexDst ] = array[ indexSrc ]\n        }\n      }\n\n      attributes[ name ].array = tmpTab\n      attributes[ name ].needsUpdate = true\n    }\n  })\n\n    // console.timeEnd( \"sort\" );\n}\n\nconst resolution = new Vector2()\nconst projectionMatrixInverse = new Matrix4()\nconst projectionMatrixTranspose = new Matrix4()\n\nexport function updateMaterialUniforms (group: Object3D, camera: Camera, renderer: WebGLRenderer, cDist: number, bRadius: number) {\n  let size = new Vector2()\n  renderer.getSize(size)\n  const canvasHeight = size.height\n  const pixelRatio = renderer.getPixelRatio()\n  const ortho = camera.type === 'OrthographicCamera'\n\n  resolution.set(size.width, size.height)\n  projectionMatrixInverse.copy(camera.projectionMatrix).invert()\n  projectionMatrixTranspose.copy(camera.projectionMatrix).transpose()\n\n  group.traverse(function (o: any) {\n    const m = o.material\n    if (!m) return\n\n    const u = m.uniforms\n    if (!u) return\n\n    if (m.clipNear) {\n      const nearFactor = (50 - m.clipNear) / 50\n      const nearClip = cDist - (bRadius * nearFactor)\n      u.clipNear.value = nearClip\n    }\n\n    if (u.canvasHeight) {\n      u.canvasHeight.value = canvasHeight\n    }\n\n    if (u.resolution) {\n      u.resolution.value.copy(resolution)\n    }\n\n    if (u.pixelRatio) {\n      u.pixelRatio.value = pixelRatio\n    }\n\n    if (u.projectionMatrixInverse) {\n      u.projectionMatrixInverse.value.copy(projectionMatrixInverse)\n    }\n\n    if (u.projectionMatrixTranspose) {\n      u.projectionMatrixTranspose.value.copy(projectionMatrixTranspose)\n    }\n\n    if (u.ortho) {\n      u.ortho.value = ortho\n    }\n  })\n}\n\nexport function updateCameraUniforms (group: Object3D, camera: Camera) {\n  projectionMatrixInverse.copy(camera.projectionMatrix).invert()\n  projectionMatrixTranspose.copy(camera.projectionMatrix).transpose()\n\n  group.traverse(function (o: any) {\n    const m = o.material\n    if (!m) return\n\n    const u = m.uniforms\n    if (!u) return\n\n    if (u.projectionMatrixInverse) {\n      u.projectionMatrixInverse.value.copy(projectionMatrixInverse)\n    }\n\n    if (u.projectionMatrixTranspose) {\n      u.projectionMatrixTranspose.value.copy(projectionMatrixTranspose)\n    }\n  })\n}\n","/**\n * @file Viewer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// adapted from https://webglfundamentals.org/webgl/resources/webgl-utils.js\n// Copyright 2012, Gregg Tavares. Modified BSD License\n\nexport function createProgram(gl: WebGLRenderingContext, shaders: WebGLShader[], attribs?: string[], locations?: number[]) {\n  const program = gl.createProgram()\n  if (!program) {\n    console.log(`error creating WebGL program`)\n    return\n  }\n  shaders.forEach(shader => gl.attachShader(program, shader))\n  if (attribs) {\n    attribs.forEach((attrib, i) => {\n      gl.bindAttribLocation(program, locations ? locations[i] : i, attrib)\n    })\n  }\n  gl.linkProgram(program);\n\n  // Check the link status\n  const linked = gl.getProgramParameter(program, gl.LINK_STATUS)\n  if (!linked) {\n      console.log(`error linking program: ${gl.getProgramInfoLog(program)}`)\n      gl.deleteProgram(program)\n      return null\n  }\n  return program\n}\n\nexport function loadShader(gl: WebGLRenderingContext, shaderSource: string, shaderType: number) {\n  const shader = gl.createShader(shaderType)\n  if (!shader) {\n    console.log(`error creating WebGL shader ${shaderType}`)\n    return                      // can't create shader\n  }\n  gl.shaderSource(shader, shaderSource)\n  gl.compileShader(shader)\n\n  // Check the compile status\n  const compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS)\n  if (!compiled) {\n    console.log(`error compiling shader ${shader}: ${gl.getShaderInfoLog(shader)}`)\n    gl.deleteShader(shader)\n    return null\n  }\n\n  return shader\n}\n\n//\n\nexport function getErrorDescription(gl: WebGLRenderingContext, error: number) {\n  switch (error) {\n    case gl.NO_ERROR: return 'no error'\n    case gl.INVALID_ENUM: return 'invalid enum'\n    case gl.INVALID_VALUE: return 'invalid value'\n    case gl.INVALID_OPERATION: return 'invalid operation'\n    case gl.INVALID_FRAMEBUFFER_OPERATION: return 'invalid framebuffer operation'\n    case gl.OUT_OF_MEMORY: return 'out of memory'\n    case gl.CONTEXT_LOST_WEBGL: return 'context lost'\n  }\n  return 'unknown error'\n}\n\nexport function getExtension (gl: WebGLRenderingContext, name: string) {\n   const ext = gl.getExtension(name)\n   if (!ext) console.log(`extension '${name}' not available`)\n   return ext\n}\n\nconst TextureTestVertShader = `\nattribute vec4 a_position;\n\nvoid main() {\n  gl_Position = a_position;\n}`\n\nconst TextureTestFragShader = `\nprecision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}`\n\nconst TextureTestTexCoords = new Float32Array([\n  -1.0, -1.0, 1.0, -1.0, -1.0,  1.0, -1.0,  1.0, 1.0, -1.0, 1.0,  1.0\n])\n\nexport function testTextureSupport (type: number) {\n  // adapted from\n  // https://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\n\n  // Get A WebGL context\n  const canvas = document.createElement('canvas')\n  canvas.width = 16\n  canvas.height = 16\n  canvas.style.width = 16 + 'px'\n  canvas.style.height = 16 + 'px'\n  const gl = canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\n  if (!gl) {\n    console.log(`error creating webgl context for ${type}`)\n    return false\n  }\n  if (!(gl instanceof WebGLRenderingContext)) {\n    console.log(`Got unexpected type for WebGL rendering context`)\n    return false\n  }\n\n  getExtension(gl, 'OES_texture_float')\n  getExtension(gl, 'OES_texture_half_float')\n  getExtension(gl, 'WEBGL_color_buffer_float')\n\n  // setup shaders\n  const vertShader = loadShader(gl, TextureTestVertShader, gl.VERTEX_SHADER)\n  const fragShader = loadShader(gl, TextureTestFragShader, gl.FRAGMENT_SHADER)\n  if (!vertShader || !fragShader) return false\n\n  // setup program\n  const program = createProgram(gl, [ vertShader, fragShader ])\n  if (!program) {\n    console.log(`error creating WebGL program`)\n    return false\n  }\n  gl.useProgram(program);\n\n  // look up where the vertex data needs to go.\n  const positionLocation = gl.getAttribLocation(program, \"a_position\");\n  const colorLoc = gl.getUniformLocation(program, \"u_color\");\n  if (!colorLoc) {\n    console.log(`error getting 'u_color' uniform location`)\n    return false\n  }\n\n  // provide texture coordinates for the rectangle.\n  const positionBuffer = gl.createBuffer()\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, TextureTestTexCoords, gl.STATIC_DRAW)\n  gl.enableVertexAttribArray(positionLocation)\n  gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0)\n\n  const whiteTex = gl.createTexture()\n  const whiteData = new Uint8Array([255, 255, 255, 255])\n  gl.bindTexture(gl.TEXTURE_2D, whiteTex)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, whiteData)\n\n  const tex = gl.createTexture()\n  gl.bindTexture(gl.TEXTURE_2D, tex)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, type, null)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n\n  const fb = gl.createFramebuffer()\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb)\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, tex, 0)\n  const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\n  if (status !== gl.FRAMEBUFFER_COMPLETE) {\n    console.log(`error creating framebuffer for ${type}`)\n    return false\n  }\n\n  // Draw the rectangle.\n  gl.bindTexture(gl.TEXTURE_2D, whiteTex)\n  gl.uniform4fv(colorLoc, [0, 10, 20, 1])\n  gl.drawArrays(gl.TRIANGLES, 0, 6)\n\n  gl.bindTexture(gl.TEXTURE_2D, tex)\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null)\n  gl.clearColor(1, 0, 0, 1)\n  gl.clear(gl.COLOR_BUFFER_BIT)\n  gl.uniform4fv(colorLoc, [0, 1/10, 1/20, 1])\n  gl.drawArrays(gl.TRIANGLES, 0, 6)\n\n  // Check if rendered correctly\n  const pixel = new Uint8Array(4)\n  gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel)\n  if (pixel[0] !== 0 || pixel[1] < 248 || pixel[2] < 248 || pixel[3] < 254) {\n    console.log(`not able to actually render to ${type} texture`)\n    return false\n  }\n\n  // Check reading from float texture\n  if (type === gl.FLOAT) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb)\n    const floatPixel = new Float32Array(4)\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.FLOAT, floatPixel)\n    const error = gl.getError()\n    if (error) {\n      console.log(`error reading pixels as float: '${getErrorDescription(gl, error)}'`)\n      return false\n    }\n  }\n\n  return true\n}\n","/**\n * @file Viewer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\nimport {\n  PerspectiveCamera, OrthographicCamera, StereoCamera,\n  Vector2, Box3, Vector3, Matrix4, Color,\n  WebGLRenderer, WebGLRenderTarget,\n  NearestFilter, LinearFilter, AdditiveBlending,\n  RGBAFormat, FloatType, /*HalfFloatType, */UnsignedByteType,\n  ShaderMaterial,\n  PlaneGeometry,\n  Scene, Mesh, Group, Object3D, Uniform,\n  Fog, DirectionalLight, AmbientLight,\n  BufferGeometry, BufferAttribute,\n  LineSegments, ColorSpace,\n  HalfFloatType\n} from 'three'\nimport '../shader/BasicLine.vert'\nimport '../shader/BasicLine.frag'\nimport '../shader/Quad.vert'\nimport '../shader/Quad.frag'\n\nimport {\n  Debug, Log, WebglErrorMessage, Browser,\n  setExtensionFragDepth, SupportsReadPixelsFloat, setSupportsReadPixelsFloat\n} from '../globals'\nimport { degToRad } from '../math/math-utils'\nimport Stats from './stats'\nimport { getShader } from '../shader/shader-utils'\nimport { setColorSpace } from '../color/colormaker'\nimport { JitterVectors } from './viewer-constants'\nimport {\n  makeImage, ImageParameters,\n  sortProjectedPosition, updateMaterialUniforms, updateCameraUniforms\n} from './viewer-utils'\nimport { testTextureSupport } from './gl-utils'\n\nimport Buffer from '../buffer/buffer'\n\nconst pixelBufferFloat = new Float32Array(4 * 25)\nconst pixelBufferUint = new Uint8Array(4 * 25)\n\n// When picking, we read a 25 pixel (5x5) array (readRenderTargetPixels)\n// We read the pixels in the order below to find what was picked.\n// This starts at the center and tries successively further points.\n// (Many points will be at equal distance to the center, their order\n// is arbitrary).\nconst pixelOrder = [12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20]\n\n\nconst tmpMatrix = new Matrix4()\n\nfunction onBeforeRender (this: Object3D, renderer: WebGLRenderer, scene: Scene, camera: PerspectiveCamera|OrthographicCamera, geometry: BufferGeometry, material: ShaderMaterial/*, group */) {\n  const u = material.uniforms\n  const updateList = []\n\n  if (!u) return  // See #908 - some materials may not have uniforms, ignore these\n\n  if (u.objectId) {\n    u.objectId.value = SupportsReadPixelsFloat ? this.id : this.id / 255\n    updateList.push('objectId')\n  }\n\n  if (u.modelViewMatrixInverse || u.modelViewMatrixInverseTranspose ||\n      u.modelViewProjectionMatrix || u.modelViewProjectionMatrixInverse\n  ) {\n    this.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, this.matrixWorld)\n  }\n\n  if (u.modelViewMatrixInverse) {\n    u.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert()\n    updateList.push('modelViewMatrixInverse')\n  }\n\n  if (u.modelViewMatrixInverseTranspose) {\n    if (u.modelViewMatrixInverse) {\n      u.modelViewMatrixInverseTranspose.value.copy(\n        u.modelViewMatrixInverse.value\n      ).transpose()\n    } else {\n      u.modelViewMatrixInverseTranspose.value\n        .copy(this.modelViewMatrix).invert()\n        .transpose()\n    }\n    updateList.push('modelViewMatrixInverseTranspose')\n  }\n\n  if (u.modelViewProjectionMatrix) {\n    u.modelViewProjectionMatrix.value.multiplyMatrices(\n      camera.projectionMatrix, this.modelViewMatrix\n    )\n    updateList.push('modelViewProjectionMatrix')\n  }\n\n  if (u.modelViewProjectionMatrixInverse) {\n    if (u.modelViewProjectionMatrix) {\n      tmpMatrix.copy(\n        u.modelViewProjectionMatrix.value\n      )\n      u.modelViewProjectionMatrixInverse.value.copy(\n        tmpMatrix.invert()\n      )\n    } else {\n      tmpMatrix.multiplyMatrices(\n        camera.projectionMatrix, this.modelViewMatrix\n      )\n      u.modelViewProjectionMatrixInverse.value.copy(\n        tmpMatrix.invert()\n      )\n    }\n    updateList.push('modelViewProjectionMatrixInverse')\n  }\n\n  if (updateList.length) {\n    const materialProperties = renderer.properties.get(material)\n\n    if (materialProperties.program) {\n      const gl = renderer.getContext()\n      const p = materialProperties.program\n      gl.useProgram(p.program)\n      const pu = p.getUniforms()\n\n      updateList.forEach(function (name) {\n        pu.setValue(gl, name, u[ name ].value)\n      })\n    }\n  }\n}\n\nexport type CameraType = 'perspective'|'orthographic'|'stereo'\nexport type ColorWorkflow = 'linear' | 'sRGB'\n\nexport interface ViewerSignals {\n  ticked: Signal,\n  rendered: Signal\n}\n\nexport interface ViewerParameters {\n  fogColor: Color\n  fogNear: number\n  fogFar: number\n\n  backgroundColor: Color\n\n  cameraType: CameraType\n  cameraFov: number\n  cameraEyeSep: number\n  cameraZ: number\n\n  clipNear: number\n  clipFar: number\n  clipDist: number\n  clipMode: string               // \"scene\" or \"camera\"\n  clipScale: string              // \"relative\" or \"absolute\"\n\n  lightColor: Color\n  lightIntensity: number\n  ambientColor: Color\n  ambientIntensity: number\n\n  sampleLevel: number\n\n  outputColorSpace: ColorSpace // default is three.LinearEncoding; three.sRGBEncoding gives more correct results\n}\n\nexport interface BufferInstance {\n  matrix: Matrix4\n}\n\n/**\n * Viewer class\n * @class\n * @param {String|Element} [idOrElement] - dom id or element\n */\nexport default class Viewer {\n  signals: ViewerSignals\n\n  container: HTMLElement\n  wrapper: HTMLElement\n\n  private rendering: boolean\n  private renderPending: boolean\n  private lastRenderedPicking: boolean\n  private isStill: boolean\n  private frameRequest: number\n\n  sampleLevel: number\n  private cDist: number\n  private bRadius: number\n\n  private parameters: ViewerParameters\n  stats: Stats\n\n  perspectiveCamera: PerspectiveCamera\n  private orthographicCamera: OrthographicCamera\n  private stereoCamera: StereoCamera\n  camera: PerspectiveCamera|OrthographicCamera\n\n  width: number\n  height: number\n\n  scene: Scene\n  private directionalLight: DirectionalLight\n  private ambientLight: AmbientLight\n  rotationGroup: Group\n  translationGroup: Group\n  private modelGroup: Group\n  private pickingGroup: Group\n  private backgroundGroup: Group\n  private helperGroup: Group\n\n  renderer: WebGLRenderer\n  private supportsHalfFloat: boolean\n\n  private pickingTarget: WebGLRenderTarget\n  private sampleTarget: WebGLRenderTarget\n  private holdTarget: WebGLRenderTarget\n\n  private compositeUniforms: {\n    tForeground: Uniform\n    scale: Uniform\n  }\n  private compositeMaterial: ShaderMaterial\n  private compositeCamera: OrthographicCamera\n  private compositeScene: Scene\n\n  private boundingBoxMesh: LineSegments\n  boundingBox = new Box3()\n  private boundingBoxSize = new Vector3()\n  private boundingBoxLength = 0\n\n  private info = {\n    memory: {\n      programs: 0,\n      geometries: 0,\n      textures: 0\n    },\n    render: {\n      calls: 0,\n      vertices: 0,\n      faces: 0,\n      points: 0\n    }\n  }\n\n  private distVector = new Vector3()\n\n  constructor (idOrElement: string|HTMLElement) {\n    this.signals = {\n      ticked: new Signal(),\n      rendered: new Signal()\n    }\n\n    if (typeof idOrElement === 'string') {\n      const elm = document.getElementById(idOrElement)\n      if (elm === null) {\n        this.container = document.createElement('div')\n      }else {\n        this.container = elm\n      }\n    } else if (idOrElement instanceof HTMLElement) {\n      this.container = idOrElement\n    } else {\n      this.container = document.createElement('div')\n    }\n\n    if (this.container === document.body) {\n      this.width = window.innerWidth || 1\n      this.height = window.innerHeight || 1\n    } else {\n      const box = this.container.getBoundingClientRect()\n      this.width = box.width || 1\n      this.height = box.height || 1\n      this.container.style.overflow = 'hidden'\n    }\n\n    this.wrapper = document.createElement('div')\n    this.wrapper.style.position = 'relative'\n    this.container.appendChild(this.wrapper)\n\n    this._initParams()\n    this._initStats()\n    this._initCamera()\n    this._initScene()\n\n    if (this._initRenderer() === false) {\n      Log.error('Viewer: could not initialize renderer')\n      return\n    }\n\n    this._initHelper()\n\n    // fog & background\n    this.setBackground()\n    this.setFog()\n\n    this.animate = this.animate.bind(this)\n  }\n\n  private _initParams () {\n    this.parameters = {\n      fogColor: new Color(0x000000),\n      fogNear: 50,\n      fogFar: 100,\n\n      backgroundColor: new Color(0x000000),\n\n      cameraType: 'perspective',\n      cameraFov: 40,\n      cameraEyeSep: 0.3,\n      cameraZ: -80, // FIXME initial value should be automatically determined\n\n      clipNear: 0,\n      clipFar: 100,\n      clipDist: 10,\n      clipMode: 'scene',\n      clipScale: 'relative',\n\n      lightColor: new Color(0xdddddd),\n      lightIntensity: 1.2,\n      ambientColor: new Color(0xdddddd),\n      ambientIntensity: 0.3,\n\n      sampleLevel: 0,\n\n      // output encoding: use srgb for a linear internal workflow, srgb-linear for traditional sRGB workflow.\n      outputColorSpace: 'srgb-linear',\n    }\n  }\n\n  private _initCamera () {\n    const lookAt = new Vector3(0, 0, 0)\n    const {width, height} = this\n\n    this.perspectiveCamera = new PerspectiveCamera(\n      this.parameters.cameraFov, width / height\n    )\n    this.perspectiveCamera.position.z = this.parameters.cameraZ\n    this.perspectiveCamera.lookAt(lookAt)\n\n    this.orthographicCamera = new OrthographicCamera(\n      width / -2, width / 2, height / 2, height / -2\n    )\n    this.orthographicCamera.position.z = this.parameters.cameraZ\n    this.orthographicCamera.lookAt(lookAt)\n\n    this.stereoCamera = new StereoCamera()\n    this.stereoCamera.aspect = 0.5\n    this.stereoCamera.eyeSep = this.parameters.cameraEyeSep\n\n    const cameraType = this.parameters.cameraType\n    if (cameraType === 'orthographic') {\n      this.camera = this.orthographicCamera\n    } else if(cameraType === 'perspective' || cameraType === 'stereo') {\n      this.camera = this.perspectiveCamera\n    } else {\n      throw new Error(`Unknown cameraType '${cameraType}'`)\n    }\n    this.camera.updateProjectionMatrix()\n  }\n\n  private _initStats () {\n    this.stats = new Stats()\n  }\n\n  private _initScene () {\n    if (!this.scene) {\n      this.scene = new Scene()\n      this.scene.name = 'scene'\n    }\n\n    this.rotationGroup = new Group()\n    this.rotationGroup.name = 'rotationGroup'\n    this.scene.add(this.rotationGroup)\n\n    this.translationGroup = new Group()\n    this.translationGroup.name = 'translationGroup'\n    this.rotationGroup.add(this.translationGroup)\n\n    this.modelGroup = new Group()\n    this.modelGroup.name = 'modelGroup'\n    this.translationGroup.add(this.modelGroup)\n\n    this.pickingGroup = new Group()\n    this.pickingGroup.name = 'pickingGroup'\n    this.translationGroup.add(this.pickingGroup)\n\n    this.backgroundGroup = new Group()\n    this.backgroundGroup.name = 'backgroundGroup'\n    this.translationGroup.add(this.backgroundGroup)\n\n    this.helperGroup = new Group()\n    this.helperGroup.name = 'helperGroup'\n    this.translationGroup.add(this.helperGroup)\n\n    // fog\n\n    this.scene.fog = new Fog(this.parameters.fogColor.getHex())\n\n    // light\n\n    this.directionalLight = new DirectionalLight(\n      this.parameters.lightColor.getHex(), this.parameters.lightIntensity\n    )\n    this.scene.add(this.directionalLight)\n\n    this.ambientLight = new AmbientLight(\n      this.parameters.ambientColor.getHex(), this.parameters.ambientIntensity\n    )\n    this.scene.add(this.ambientLight)\n  }\n\n  private _initRenderer () {\n    const dpr = window.devicePixelRatio\n    const {width, height} = this\n\n    try {\n      this.renderer = new WebGLRenderer({\n        preserveDrawingBuffer: true,\n        alpha: true,\n        antialias: true\n      })\n    } catch (e) {\n      this.wrapper.innerHTML = WebglErrorMessage\n      return false\n    }\n    this.renderer.setPixelRatio(dpr)\n    this.renderer.setSize(width, height)\n    this.renderer.autoClear = false\n    this.renderer.sortObjects = true\n    this.renderer.outputColorSpace = this.parameters.outputColorSpace\n    this.renderer.useLegacyLights = true\n\n    const gl = this.renderer.getContext()\n    // console.log(gl.getContextAttributes().antialias)\n    // console.log(gl.getParameter(gl.SAMPLES))\n\n    // For WebGL1, extensions must be explicitly enabled.\n    // The following are builtin to WebGL2 (and don't appear as\n    // extensions)\n    // EXT_frag_depth, OES_element_index_uint, OES_texture_float\n    // OES_texture_half_float\n\n    // The WEBGL_color_buffer_float extension is replaced by\n    // EXT_color_buffer_float\n\n    // If not webgl2 context, explicitly check for these\n    if (!this.renderer.capabilities.isWebGL2) {\n      setExtensionFragDepth(this.renderer.extensions.get('EXT_frag_depth'))\n      this.renderer.extensions.get('OES_element_index_uint')\n\n      setSupportsReadPixelsFloat(\n        (this.renderer.extensions.get('OES_texture_float') &&\n          this.renderer.extensions.get('WEBGL_color_buffer_float')) ||\n        (this.renderer.extensions.get('OES_texture_float') &&\n          testTextureSupport(gl.FLOAT))\n      )\n      // picking texture\n\n      this.renderer.extensions.get('OES_texture_float')\n\n      this.supportsHalfFloat = (\n        this.renderer.extensions.get('OES_texture_half_float') &&\n        testTextureSupport(0x8D61)\n      )\n\n    } else {\n      setExtensionFragDepth(true)\n      setSupportsReadPixelsFloat(\n        this.renderer.extensions.get('EXT_color_buffer_float')\n      )\n      this.supportsHalfFloat = true\n    }\n\n    this.wrapper.appendChild(this.renderer.domElement)\n\n    const dprWidth = width * dpr\n    const dprHeight = height * dpr\n\n\n    if (Debug) {\n      console.log(JSON.stringify({\n        'Browser': Browser,\n        'OES_texture_float': !!this.renderer.extensions.get('OES_texture_float'),\n        'OES_texture_half_float': !!this.renderer.extensions.get('OES_texture_half_float'),\n        'WEBGL_color_buffer_float': !!this.renderer.extensions.get('WEBGL_color_buffer_float'),\n        'testTextureSupport Float': testTextureSupport(gl.FLOAT),\n        'testTextureSupport HalfFloat': testTextureSupport(0x8D61),\n        'this.supportsHalfFloat': this.supportsHalfFloat,\n        'SupportsReadPixelsFloat': SupportsReadPixelsFloat\n      }, null, 2))\n    }\n\n    this.pickingTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: NearestFilter,\n        magFilter: NearestFilter,\n        stencilBuffer: false,\n        format: RGBAFormat,\n        type: SupportsReadPixelsFloat ? FloatType : UnsignedByteType\n      }\n    )\n    this.pickingTarget.texture.generateMipmaps = false\n    this.pickingTarget.texture.colorSpace = this.parameters.outputColorSpace\n\n    // workaround to reset the gl state after using testTextureSupport\n    // fixes some bug where nothing is rendered to the canvas\n    // when animations are started on page load\n    this.renderer.setRenderTarget(this.pickingTarget)\n    this.renderer.clear()\n    this.renderer.setRenderTarget(null!)\n\n    // ssaa textures\n\n    this.sampleTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: LinearFilter,\n        magFilter: LinearFilter,\n        format: RGBAFormat,\n        type: this.supportsHalfFloat ? HalfFloatType : (\n          SupportsReadPixelsFloat ? FloatType : UnsignedByteType\n        )\n      }\n    )\n    this.sampleTarget.texture.colorSpace = this.parameters.outputColorSpace\n\n    this.holdTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: NearestFilter,\n        magFilter: NearestFilter,\n        format: RGBAFormat,\n        type: this.supportsHalfFloat ? HalfFloatType : (\n          SupportsReadPixelsFloat ? FloatType : UnsignedByteType\n        )\n      }\n    )\n    this.holdTarget.texture.colorSpace = this.parameters.outputColorSpace\n\n    this.compositeUniforms = {\n      'tForeground': new Uniform(this.sampleTarget.texture),\n      'scale': new Uniform(1.0)\n    }\n\n    this.compositeMaterial = new ShaderMaterial({\n      uniforms: this.compositeUniforms,\n      vertexShader: getShader('Quad.vert'),\n      fragmentShader: getShader('Quad.frag'),\n      premultipliedAlpha: true,\n      transparent: true,\n      blending: AdditiveBlending,\n      depthTest: false,\n      depthWrite: false\n    })\n\n    this.compositeCamera = new OrthographicCamera(-1, 1, 1, -1, 0, 1)\n    this.compositeScene = new Scene()\n    this.compositeScene.name = 'compositeScene'\n    this.compositeScene.add(new Mesh(\n      new PlaneGeometry(2, 2), this.compositeMaterial\n    ))\n  }\n\n  private _initHelper () {\n    const indices = new Uint16Array([\n      0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6,\n      6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7\n    ])\n    const positions = new Float32Array(8 * 3)\n\n    const bbGeometry = new BufferGeometry()\n    bbGeometry.setIndex(new BufferAttribute(indices, 1))\n    bbGeometry.setAttribute('position', new BufferAttribute(positions, 3))\n    const bbMaterial = new ShaderMaterial({\n      uniforms: { 'uColor': { value: new Color('skyblue') } },\n      vertexShader: getShader('BasicLine.vert'),\n      fragmentShader: getShader('BasicLine.frag')\n    })\n\n    this.boundingBoxMesh = new LineSegments(bbGeometry, bbMaterial)\n    this.helperGroup.add(this.boundingBoxMesh)\n  }\n\n  updateHelper () {\n    const position = ((this.boundingBoxMesh.geometry as BufferGeometry).attributes as any).position  // TODO\n    const array = position.array\n    const {min, max} = this.boundingBox\n\n    array[ 0 ] = max.x; array[ 1 ] = max.y; array[ 2 ] = max.z\n    array[ 3 ] = min.x; array[ 4 ] = max.y; array[ 5 ] = max.z\n    array[ 6 ] = min.x; array[ 7 ] = min.y; array[ 8 ] = max.z\n    array[ 9 ] = max.x; array[ 10 ] = min.y; array[ 11 ] = max.z\n    array[ 12 ] = max.x; array[ 13 ] = max.y; array[ 14 ] = min.z\n    array[ 15 ] = min.x; array[ 16 ] = max.y; array[ 17 ] = min.z\n    array[ 18 ] = min.x; array[ 19 ] = min.y; array[ 20 ] = min.z\n    array[ 21 ] = max.x; array[ 22 ] = min.y; array[ 23 ] = min.z\n\n    position.needsUpdate = true\n\n    if (!this.boundingBox.isEmpty()) {\n      this.boundingBoxMesh.geometry.computeBoundingSphere()\n    }\n  }\n\n  /** Distance from origin (lookAt point) */\n  get cameraDistance(): number {\n    return Math.abs(this.camera.position.z)\n  }\n\n  /** Set distance from origin (lookAt point); along the -z axis */\n  set cameraDistance(d: number) {\n    this.camera.position.z = -d\n  }\n\n  add (buffer: Buffer, instanceList?: BufferInstance[]) {\n    // Log.time( \"Viewer.add\" );\n\n    if (instanceList) {\n      instanceList.forEach(instance => this.addBuffer(buffer, instance))\n    } else {\n      this.addBuffer(buffer)\n    }\n\n    buffer.group.name = 'meshGroup'\n    buffer.wireframeGroup.name = 'wireframeGroup'\n    if (buffer.parameters.background) {\n      this.backgroundGroup.add(buffer.group)\n      this.backgroundGroup.add(buffer.wireframeGroup)\n    } else {\n      this.modelGroup.add(buffer.group)\n      this.modelGroup.add(buffer.wireframeGroup)\n    }\n\n    if (buffer.pickable) {\n      this.pickingGroup.add(buffer.pickingGroup)\n    }\n\n    if (Debug) this.updateHelper()\n\n    // Log.timeEnd( \"Viewer.add\" );\n  }\n\n  addBuffer (buffer: Buffer, instance?: BufferInstance) {\n    // Log.time( \"Viewer.addBuffer\" );\n\n    function setUserData (object: Object3D) {\n      if (object instanceof Group) {\n        object.children.forEach(setUserData)\n      } else {\n        object.userData.buffer = buffer\n        object.userData.instance = instance\n        object.onBeforeRender = onBeforeRender\n      }\n    }\n\n    const mesh = buffer.getMesh()\n    if (instance) {\n      mesh.applyMatrix4(instance.matrix)\n    }\n    setUserData(mesh)\n    buffer.group.add(mesh)\n\n    const wireframeMesh = buffer.getWireframeMesh()\n    if (instance) {\n      // wireframeMesh.applyMatrix( instance.matrix );\n      wireframeMesh.matrix.copy(mesh.matrix)\n      wireframeMesh.position.copy(mesh.position)\n      wireframeMesh.quaternion.copy(mesh.quaternion)\n      wireframeMesh.scale.copy(mesh.scale)\n    }\n    setUserData(wireframeMesh)\n    buffer.wireframeGroup.add(wireframeMesh)\n\n    if (buffer.pickable) {\n      const pickingMesh = buffer.getPickingMesh()\n      if (instance) {\n        // pickingMesh.applyMatrix( instance.matrix );\n        pickingMesh.matrix.copy(mesh.matrix)\n        pickingMesh.position.copy(mesh.position)\n        pickingMesh.quaternion.copy(mesh.quaternion)\n        pickingMesh.scale.copy(mesh.scale)\n      }\n      setUserData(pickingMesh)\n      buffer.pickingGroup.add(pickingMesh)\n    }\n\n    if (instance) {\n      this._updateBoundingBox(buffer.geometry, buffer.matrix, instance.matrix)\n    } else {\n      this._updateBoundingBox(buffer.geometry, buffer.matrix)\n    }\n\n    // Log.timeEnd( \"Viewer.addBuffer\" );\n  }\n\n  remove (buffer: Buffer) {\n    this.translationGroup.children.forEach(function (group) {\n      group.remove(buffer.group)\n      group.remove(buffer.wireframeGroup)\n    })\n\n    if (buffer.pickable) {\n      this.pickingGroup.remove(buffer.pickingGroup)\n    }\n\n    this.updateBoundingBox()\n    if (Debug) this.updateHelper()\n\n    // this.requestRender();\n  }\n\n  private _updateBoundingBox (geometry?: BufferGeometry, matrix?: Matrix4, instanceMatrix?: Matrix4) {\n    const boundingBox = this.boundingBox\n\n    function updateGeometry (geometry: BufferGeometry, matrix?: Matrix4, instanceMatrix?: Matrix4) {\n      if (geometry.boundingBox == null) {\n        geometry.computeBoundingBox()\n      }\n\n      const geoBoundingBox = (geometry.boundingBox as Box3).clone()\n\n      if (matrix) {\n        geoBoundingBox.applyMatrix4(matrix)\n      }\n      if (instanceMatrix) {\n        geoBoundingBox.applyMatrix4(instanceMatrix)\n      }\n\n      if (geoBoundingBox.min.equals(geoBoundingBox.max)) {\n        // mainly to give a single impostor geometry some volume\n        // as it is only expanded in the shader on the GPU\n        geoBoundingBox.expandByScalar(5)\n      }\n\n      boundingBox.union(geoBoundingBox)\n    }\n\n    function updateNode (node: Mesh) {\n      if (node.geometry !== undefined) {\n        let matrix, instanceMatrix\n        if (node.userData.buffer) {\n          matrix = node.userData.buffer.matrix\n        }\n        if (node.userData.instance) {\n          instanceMatrix = node.userData.instance.matrix\n        }\n        updateGeometry(node.geometry as BufferGeometry, matrix, instanceMatrix)  // TODO\n      }\n    }\n\n    if (geometry) {\n      updateGeometry(geometry, matrix, instanceMatrix)\n    } else {\n      boundingBox.makeEmpty()\n      this.modelGroup.traverse(updateNode)\n      this.backgroundGroup.traverse(updateNode)\n    }\n\n    boundingBox.getSize(this.boundingBoxSize)\n    this.boundingBoxLength = this.boundingBoxSize.length()\n  }\n\n  updateBoundingBox () {\n    this._updateBoundingBox()\n    if (Debug) this.updateHelper()\n  }\n\n  getPickingPixels () {\n    const {width, height} = this\n\n    const n = width * height * 4\n    const imgBuffer = SupportsReadPixelsFloat ? new Float32Array(n) : new Uint8Array(n)\n\n    this.render(true)\n    this.renderer.readRenderTargetPixels(\n      this.pickingTarget, 0, 0, width, height, imgBuffer\n    )\n\n    return imgBuffer\n  }\n\n  getImage (picking: boolean) {\n    return new Promise(resolve => {\n      if (picking) {\n        const {width, height} = this\n        const n = width * height * 4\n        let imgBuffer = this.getPickingPixels()\n\n        if (SupportsReadPixelsFloat) {\n          const imgBuffer2 = new Uint8Array(n)\n          for (let i = 0; i < n; ++i) {\n            imgBuffer2[ i ] = Math.round(imgBuffer[ i ] * 255)\n          }\n          imgBuffer = imgBuffer2\n        }\n\n        const canvas = document.createElement('canvas')\n        canvas.width = width\n        canvas.height = height\n        const ctx = canvas.getContext('2d')!  // TODO\n        const imgData = ctx.getImageData(0, 0, width, height)\n        imgData.data.set(imgBuffer as any)  // TODO\n        ctx.putImageData(imgData, 0, 0)\n        canvas.toBlob(resolve as any, 'image/png')  // TODO\n      } else {\n        this.renderer.domElement.toBlob(resolve as any, 'image/png')  // TODO\n      }\n    })\n  }\n\n  makeImage (params: Partial<ImageParameters> = {}) {\n    return makeImage(this, params)\n  }\n\n  setLight (color: Color|number|string, intensity: number, ambientColor: Color|number|string, ambientIntensity: number) {\n    const p = this.parameters\n\n    if (color !== undefined) p.lightColor.set(color as string)  // TODO\n    if (intensity !== undefined) p.lightIntensity = intensity\n    if (ambientColor !== undefined) p.ambientColor.set(ambientColor as string)  // TODO\n    if (ambientIntensity !== undefined) p.ambientIntensity = ambientIntensity\n\n    this.requestRender()\n  }\n\n  setFog (color?: Color|number|string, near?: number, far?: number) {\n    const p = this.parameters\n\n    if (color !== undefined) p.fogColor.set(color as string)  // TODO\n    if (near !== undefined) p.fogNear = near\n    if (far !== undefined) p.fogFar = far\n\n    this.requestRender()\n  }\n\n  setBackground (color?: Color|number|string) {\n    const p = this.parameters\n\n    if (color) p.backgroundColor.set(color as string)  // TODO\n\n    this.setFog(p.backgroundColor)\n    this.renderer.setClearColor(p.backgroundColor, 0)\n    this.renderer.domElement.style.backgroundColor = p.backgroundColor.getStyle()\n\n    this.requestRender()\n  }\n\n  setSampling (level: number) {\n    if (level !== undefined) {\n      this.parameters.sampleLevel = level\n      this.sampleLevel = level\n    }\n\n    this.requestRender()\n  }\n\n  /**\n   * Set the output color encoding, i.e. how the renderer translates\n   * colorspaces as it renders to the screen.\n\n   * The default is LinearEncoding, because the internals of NGL are\n   * already sRGB so no translation is needed to show sRGB colors.\n   * Set to sRGBEncoding to create a linear workflow, and also call\n   * `setColorEncoding(LinearEncoding)` to linearize colors on input.\n   * @see setColorEncoding\n   */\n  private setOutputEncoding (colorspace: ColorSpace) {\n    this.parameters.outputColorSpace = colorspace\n    this.renderer.outputColorSpace = colorspace\n    this.pickingTarget.texture.colorSpace = colorspace\n    this.sampleTarget.texture.colorSpace = colorspace\n    this.holdTarget.texture.colorSpace = colorspace\n  }\n\n  /**\n   * Set the internal color workflow, linear or sRGB.\n   * sRGB, the default, is more \"vibrant\" at the cost of accuracy.\n   * Linear gives more accurate results, especially for transparent objects.\n   * In all cases, the output is always sRGB; this just affects how colors are computed internally.\n   * Call this just after creating the viewer, before loading any models.\n   */\n  setColorWorkflow (colorspace: ColorSpace) {\n    if (colorspace != 'srgb-linear' && colorspace != 'srgb')\n      throw new Error(`setColorWorkflow: invalid color workflow ${colorspace}`)\n    setColorSpace(colorspace == 'srgb-linear' ? 'linear' : 'sRGB')\n    this.setOutputEncoding(colorspace == 'srgb-linear' ? 'srgb' : 'srgb-linear')\n    // Note: this doesn't rebuild models, so existing geometry will have\n    // the old color encoding.\n    this.requestRender()\n  }\n\n  setCamera (type: CameraType, fov?: number, eyeSep?: number) {\n    const p = this.parameters\n\n    if (type) p.cameraType = type\n    if (fov) p.cameraFov = fov\n    if (eyeSep) p.cameraEyeSep = eyeSep\n\n    if (p.cameraType === 'orthographic') {\n      if (this.camera !== this.orthographicCamera) {\n        this.camera = this.orthographicCamera\n        this.camera.position.copy(this.perspectiveCamera.position)\n        this.camera.up.copy(this.perspectiveCamera.up)\n        this.updateZoom()\n      }\n    } else if (p.cameraType === 'perspective' || p.cameraType === 'stereo') {\n      if (this.camera !== this.perspectiveCamera) {\n        this.camera = this.perspectiveCamera\n        this.camera.position.copy(this.orthographicCamera.position)\n        this.camera.up.copy(this.orthographicCamera.up)\n      }\n    } else {\n      throw new Error(`Unknown cameraType '${p.cameraType}'`)\n    }\n\n    this.perspectiveCamera.fov = p.cameraFov\n    this.stereoCamera.eyeSep = p.cameraEyeSep\n    this.camera.updateProjectionMatrix()\n\n    this.requestRender()\n  }\n\n  setClip (near: number, far: number, dist: number, clipMode?: string, clipScale?: string) {\n    const p = this.parameters\n\n    if (near !== undefined) p.clipNear = near\n    if (far !== undefined) p.clipFar = far\n    if (dist !== undefined) p.clipDist = dist\n    if (clipMode !== undefined) p.clipMode = clipMode\n    if (clipScale !== undefined) p.clipScale = clipScale\n\n    this.requestRender()\n  }\n\n  setSize (width: number, height: number) {\n    this.width = width || 1\n    this.height = height || 1\n\n    this.perspectiveCamera.aspect = this.width / this.height\n    this.orthographicCamera.left = -this.width / 2\n    this.orthographicCamera.right = this.width / 2\n    this.orthographicCamera.top = this.height / 2\n    this.orthographicCamera.bottom = -this.height / 2\n    this.camera.updateProjectionMatrix()\n\n    const dpr = window.devicePixelRatio\n\n    this.renderer.setPixelRatio(dpr)\n    this.renderer.setSize(width, height)\n\n    const dprWidth = this.width * dpr\n    const dprHeight = this.height * dpr\n\n    this.pickingTarget.setSize(dprWidth, dprHeight)\n    this.sampleTarget.setSize(dprWidth, dprHeight)\n    this.holdTarget.setSize(dprWidth, dprHeight)\n\n    this.requestRender()\n  }\n\n  handleResize () {\n    if (this.container === document.body) {\n      this.setSize(window.innerWidth, window.innerHeight)\n    } else {\n      const box = this.container.getBoundingClientRect()\n      this.setSize(box.width, box.height)\n    }\n  }\n\n  updateInfo (reset?: boolean) {\n    const { memory, render } = this.info\n\n    if (reset) {\n      memory.programs = 0\n      memory.geometries = 0\n      memory.textures = 0\n\n      render.calls = 0\n      render.vertices = 0\n      render.points = 0\n    } else {\n      const rInfo = this.renderer.info\n      const rMemory = rInfo.memory\n      const rRender = rInfo.render\n\n      memory.geometries = rMemory.geometries\n      memory.textures = rMemory.textures\n\n      render.calls += rRender.calls\n      render.faces += rRender.triangles\n      render.points += rRender.points\n    }\n  }\n\n  animate () {\n    this.signals.ticked.dispatch(this.stats)\n    const delta = window.performance.now() - this.stats.startTime\n\n    if (delta > 500 && !this.isStill && this.sampleLevel < 3 && this.sampleLevel !== -1) {\n      const currentSampleLevel = this.sampleLevel\n      this.sampleLevel = 3\n      this.renderPending = true\n      this.render()\n      this.isStill = true\n      this.sampleLevel = currentSampleLevel\n      if (Debug) Log.log('rendered still frame')\n    }\n\n    this.frameRequest = window.requestAnimationFrame(this.animate)\n  }\n\n  pick (x: number, y: number) {\n    if (this.parameters.cameraType === 'stereo') {\n      // TODO picking broken for stereo camera\n      return {\n        'pid': 0,\n        'instance': undefined,\n        'picker': undefined\n      }\n    }\n\n    x *= window.devicePixelRatio\n    y *= window.devicePixelRatio\n\n    x = Math.max(x - 2, 0)\n    y = Math.max(y - 2, 0)\n\n    let pid = 0, instance, picker\n    const pixelBuffer = SupportsReadPixelsFloat ? pixelBufferFloat : pixelBufferUint\n\n    this.render(true)\n    this.renderer.readRenderTargetPixels(\n      this.pickingTarget, x, y, 5, 5, pixelBuffer\n    )\n\n    for (let i = 0; i < pixelOrder.length; i++) {\n\n      const offset = pixelOrder[i] * 4\n\n      const oid = Math.round(pixelBuffer[ offset + 3 ])\n      const object = this.pickingGroup.getObjectById(oid)\n      if (object) {\n        instance = object.userData.instance\n        picker = object.userData.buffer.picking\n      } else {\n        continue\n      }\n\n      if (SupportsReadPixelsFloat) {\n        pid =\n          ((Math.round(pixelBuffer[offset] * 255) << 16) & 0xFF0000) |\n          ((Math.round(pixelBuffer[offset + 1] * 255) << 8) & 0x00FF00) |\n          ((Math.round(pixelBuffer[offset + 2] * 255)) & 0x0000FF)\n      } else {\n        pid =\n          (pixelBuffer[offset] << 16) |\n          (pixelBuffer[offset + 1] << 8) |\n          (pixelBuffer[offset + 2])\n      }\n    }\n    // if( Debug ){\n    //   const rgba = Array.apply( [], pixelBuffer );\n    //   Log.log( pixelBuffer );\n    //   Log.log(\n    //     \"picked color\",\n    //     rgba.map( c => { return c.toPrecision( 2 ) } )\n    //   );\n    //   Log.log( \"picked pid\", pid );\n    //   Log.log( \"picked oid\", oid );\n    //   Log.log( \"picked object\", object );\n    //   Log.log( \"picked instance\", instance );\n    //   Log.log( \"picked position\", x, y );\n    //   Log.log( \"devicePixelRatio\", window.devicePixelRatio );\n    // }\n\n    return { pid, instance, picker }\n  }\n\n  requestRender () {\n    if (this.renderPending) {\n      // Log.info(\"there is still a 'render' call pending\")\n      return\n    }\n\n    // start gathering stats anew after inactivity\n    if (window.performance.now() - this.stats.startTime > 22) {\n      this.stats.begin()\n      this.isStill = false\n    }\n\n    this.renderPending = true\n\n    window.requestAnimationFrame(() => {\n      this.render()\n      this.stats.update()\n    })\n  }\n\n  updateZoom () {\n    const fov = degToRad(this.perspectiveCamera.fov)\n    const height = 2 * Math.tan(fov / 2) * this.cameraDistance\n    this.orthographicCamera.zoom = this.height / height\n  }\n\n  /**\n   * Convert an absolute clip value to a relative one using bRadius.\n   *\n   * 0.0 -> 50.0\n   * bRadius -> 0.0\n   */\n  absoluteToRelative (d: number) :number {\n    return 50 * (1 - d / this.bRadius)\n  }\n\n  /**\n   * Convert a relative clip value to an absolute one using bRadius\n   *\n   * 0.0 -> bRadius\n   * 50.0 -> 0.0\n   */\n  relativeToAbsolute (d: number) : number {\n    return this.bRadius * (1 - d / 50)\n  }\n\n  /**\n   * Intepret clipMode, clipScale and set the camera and fog clipping.\n   * Also ensures bRadius and cDist are valid\n   */\n  private __updateClipping () {\n    const p = this.parameters\n\n    // bRadius must always be updated for material-based clipping\n    // and for focus calculations\n    this.bRadius = Math.max(10, this.boundingBoxLength * 0.5)\n\n    // FL: Removed below, but leaving commented as I don't understand intention\n    // this.bRadius += this.boundingBox.getCenter(this.distVector).length()\n\n    if (!isFinite(this.bRadius)) {\n      this.bRadius = 50\n    }\n\n    this.camera.getWorldPosition(this.distVector)\n    this.cDist = this.distVector.length()\n    if (!this.cDist) {\n      // recover from a broken (NaN) camera position\n      this.cameraDistance = Math.abs(p.cameraZ)\n      this.cDist = Math.abs(p.cameraZ)\n    }\n\n    // fog\n    const fog = this.scene.fog as Fog\n    fog.color.set(p.fogColor)\n\n    if (p.clipMode === 'camera') {\n      // Always interpret clipScale as absolute for clipMode camera\n\n      this.camera.near = p.clipNear\n      this.camera.far = p.clipFar\n      fog.near = p.fogNear\n      fog.far = p.fogFar\n\n    } else {\n      // scene mode\n\n      if (p.clipScale === 'absolute') {\n        // absolute scene mode; offset clip planes from scene center\n        // (note: positive values move near plane towards camera and rear plane away)\n\n        this.camera.near = this.cDist - p.clipNear\n        this.camera.far = this.cDist + p.clipFar\n        fog.near = this.cDist - p.fogNear\n        fog.far = this.cDist + p.fogFar\n\n      } else {\n        // relative scene mode (default): convert pecentages to Angstroms\n\n        const nearFactor = (50 - p.clipNear) / 50\n        const farFactor = -(50 - p.clipFar) / 50\n        this.camera.near = this.cDist - (this.bRadius * nearFactor)\n        this.camera.far = this.cDist + (this.bRadius * farFactor)\n\n        const fogNearFactor = (50 - p.fogNear) / 50\n        const fogFarFactor = -(50 - p.fogFar) / 50\n        fog.near = this.cDist - (this.bRadius * fogNearFactor)\n        fog.far = this.cDist + (this.bRadius * fogFarFactor)\n      }\n    }\n\n    if (p.clipMode !== 'camera') {\n\n      if (this.camera.type === 'PerspectiveCamera') {\n\n        this.camera.near = Math.max(0.1, p.clipDist, this.camera.near)\n        this.camera.far = Math.max(1, this.camera.far)\n        fog.near = Math.max(0.1, fog.near)\n        fog.far = Math.max(1, fog.far)\n      } else if (this.camera.type === 'OrthographicCamera') {\n\n        if (p.clipDist > 0) {\n          this.camera.near = Math.max(p.clipDist, this.camera.near)\n        }\n      }\n    }\n  }\n\n  private __updateCamera () {\n    const camera = this.camera\n    camera.updateMatrix()\n    camera.updateMatrixWorld(true)\n    camera.updateProjectionMatrix()\n\n    updateMaterialUniforms(this.scene, camera, this.renderer, this.cDist, this.bRadius)\n    sortProjectedPosition(this.scene, camera)\n  }\n\n  private __setVisibility (model: boolean, picking: boolean, background: boolean, helper: boolean) {\n    this.modelGroup.visible = model\n    this.pickingGroup.visible = picking\n    this.backgroundGroup.visible = background\n    this.helperGroup.visible = helper\n  }\n\n  private __updateLights () {\n    this.directionalLight.color.set(this.parameters.lightColor)\n    this.directionalLight.intensity = this.parameters.lightIntensity\n\n    this.distVector.copy(this.camera.position).setLength(this.boundingBoxLength * 100)\n    this.directionalLight.position.copy(this.camera.position).add(this.distVector)\n\n    this.ambientLight.color.set(this.parameters.ambientColor)\n    this.ambientLight.intensity = this.parameters.ambientIntensity\n  }\n\n  private __renderPickingGroup (camera: PerspectiveCamera|OrthographicCamera) {\n    this.renderer.setRenderTarget(this.pickingTarget || null)\n    this.renderer.clear()\n    this.__setVisibility(false, true, false, false)\n    this.renderer.render(this.scene, camera)\n    //  back to standard render target\n    this.renderer.setRenderTarget(null)\n    this.updateInfo()\n\n    // if (Debug) {\n    //   this.__setVisibility(false, true, false, true);\n\n    //   this.renderer.clear();\n    //   this.renderer.render(this.scene, camera);\n    // }\n  }\n\n  private __renderModelGroup (camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    this.renderer.setRenderTarget(renderTarget || null)\n    this.renderer.clear()\n    this.__setVisibility(false, false, true, false)\n    this.renderer.render(this.scene, camera)\n    this.renderer.clear(false, true, true)\n    this.updateInfo()\n\n    this.__setVisibility(true, false, false, Debug)\n    this.renderer.render(this.scene, camera)\n    this.renderer.setRenderTarget(null) // set back to default canvas\n    this.updateInfo()\n  }\n\n  private __renderSuperSample (camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    // based on the Supersample Anti-Aliasing Render Pass\n    // contributed to three.js by bhouston / http://clara.io/\n    //\n    // This manual approach to SSAA re-renders the scene ones for\n    // each sample with camera jitter and accumulates the results.\n    // References: https://en.wikipedia.org/wiki/Supersampling\n    const offsetList = JitterVectors[ Math.max(0, Math.min(this.sampleLevel, 5)) ]\n\n    const baseSampleWeight = 1.0 / offsetList.length\n    const roundingRange = 1 / 32\n\n    this.compositeUniforms.tForeground.value = this.sampleTarget.texture\n\n    let width = this.sampleTarget.width\n    const height = this.sampleTarget.height\n    if (this.parameters.cameraType === 'stereo') {\n      width /= 2\n    }\n\n    // render the scene multiple times, each slightly jitter offset\n    // from the last and accumulate the results.\n    for (let i = 0; i < offsetList.length; ++i) {\n      const offset = offsetList[ i ]\n      camera.setViewOffset(\n        width, height, offset[ 0 ], offset[ 1 ], width, height\n      )\n      camera.updateProjectionMatrix()\n      updateCameraUniforms(this.scene, camera)\n\n      let sampleWeight = baseSampleWeight\n      // the theory is that equal weights for each sample lead to an\n      // accumulation of rounding errors.\n      // The following equation varies the sampleWeight per sample\n      // so that it is uniformly distributed across a range of values\n      // whose rounding errors cancel each other out.\n      const uniformCenteredDistribution = -0.5 + (i + 0.5) / offsetList.length\n      sampleWeight += roundingRange * uniformCenteredDistribution\n      this.compositeUniforms.scale.value = sampleWeight\n\n      this.__renderModelGroup(camera, this.sampleTarget)\n      this.renderer.setRenderTarget(this.holdTarget)\n      if (i === 0)  {\n        this.renderer.clear()\n      }\n\n      this.renderer.render(this.compositeScene, this.compositeCamera)\n    }\n\n    this.compositeUniforms.scale.value = 1.0\n    this.compositeUniforms.tForeground.value = this.holdTarget.texture\n\n    camera.clearViewOffset()\n    this.renderer.setRenderTarget(renderTarget || null)\n    this.renderer.clear()\n    this.renderer.render(this.compositeScene, this.compositeCamera)\n  }\n\n  private __renderStereo (picking = false, _renderTarget?: WebGLRenderTarget) {\n    const stereoCamera = this.stereoCamera\n    stereoCamera.update(this.perspectiveCamera);\n\n    const renderer = this.renderer\n    let size = new Vector2()\n    renderer.getSize(size)\n\n    renderer.setScissorTest(true)\n\n    renderer.setScissor(0, 0, size.width / 2, size.height)\n    renderer.setViewport(0, 0, size.width / 2, size.height)\n    updateCameraUniforms(this.scene, stereoCamera.cameraL)\n    this.__render(picking, stereoCamera.cameraL)\n\n    renderer.setScissor(size.width / 2, 0, size.width / 2, size.height)\n    renderer.setViewport(size.width / 2, 0, size.width / 2, size.height)\n    updateCameraUniforms(this.scene, stereoCamera.cameraR)\n    this.__render(picking, stereoCamera.cameraR)\n\n    renderer.setScissorTest(false)\n    renderer.setViewport(0, 0, size.width, size.height)\n  }\n\n  private __render(picking = false, camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    if (picking) {\n      if (!this.lastRenderedPicking) this.__renderPickingGroup(camera)\n    } else if (this.sampleLevel > 0 && this.parameters.cameraType !== 'stereo') {\n      // TODO super sample broken for stereo camera\n      this.__renderSuperSample(camera, renderTarget)\n    } else {\n      this.__renderModelGroup(camera, renderTarget)\n    }\n  }\n\n  render (picking = false, renderTarget?: WebGLRenderTarget) {\n    if (this.rendering) {\n      Log.warn(\"'tried to call 'render' from within 'render'\")\n      return\n    }\n\n    // Log.time('Viewer.render')\n\n    this.rendering = true\n\n    try {\n      this.__updateClipping()\n      this.__updateCamera()\n      this.__updateLights()\n      this.updateInfo(true)\n\n      // render\n      if (this.parameters.cameraType === 'stereo') {\n        this.__renderStereo(picking, renderTarget)\n      } else {\n        this.__render(picking, this.camera, renderTarget)\n      }\n      this.lastRenderedPicking = picking\n    } finally {\n      this.rendering = false\n      this.renderPending = false\n    }\n    this.signals.rendered.dispatch()\n\n    // Log.timeEnd('Viewer.render')\n    // Log.log(this.info.memory, this.info.render)\n  }\n\n  clear () {\n    Log.log('scene cleared')\n    this.scene.remove(this.rotationGroup)\n    this._initScene()\n    this.renderer.clear()\n  }\n\n  dispose () {\n    this.renderer.dispose()\n    window.cancelAnimationFrame(this.frameRequest)\n  }\n}\n","/**\n * @file Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const LeftMouseButton = 1\nexport const MiddleMouseButton = 2\nexport const RightMouseButton = 3\n","/**\n * @file Mouse Observer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2 } from 'three'\nimport { Signal } from 'signals'\n\nimport { LeftMouseButton, RightMouseButton } from '../constants'\nimport { defaults } from '../utils'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\n/**\n * @example\n * mouseObserver.signals.scrolled.add( function( delta ){ ... } );\n *\n * @typedef {Object} MouseSignals\n * @property {Signal<Integer, Integer>} moved - on move: deltaX, deltaY\n * @property {Signal<Number>} scrolled - on scroll: delta\n * @property {Signal<Integer, Integer>} dragged - on drag: deltaX, deltaY\n * @property {Signal} dropped - on drop\n * @property {Signal} clicked - on click\n * @property {Signal} hovered - on hover\n */\n\nfunction getTouchDistance (event: TouchEvent) {\n  const dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX\n  const dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY\n  return Math.sqrt(dx * dx + dy * dy)\n}\n\nfunction getMouseButtons (event: MouseEvent) {\n    if (typeof event === 'object') {\n    if ('buttons' in event) {\n      return event.buttons\n    } else if ('which' in event as any) {\n      const b = (event as any).which\n      if (b === 2) {\n        return 4\n      } else if (b === 3) {\n        return 2\n      } else if (b > 0) {\n        return 1 << (b - 1)\n      }\n    } else if ('button' in event as any) {\n      const b = (event as any).button\n      if (b === 1) {\n        return 4\n      } else if (b === 2) {\n        return 2\n      } else if (b >= 0) {\n        return 1 << b\n      }\n    }\n  }\n  return 0\n}\n\nexport interface MouseSignals {\n  moved: Signal  // on move: deltaX, deltaY\n  scrolled: Signal  // on scroll: delta\n  dragged: Signal  // on drag: deltaX, deltaY\n  dropped: Signal  // on drop\n  clicked: Signal  // on click\n  hovered: Signal  // on hover\n  doubleClicked: Signal\n}\n\nexport interface MouseParams {\n  hoverTimeout?: number\n  handleScroll?:boolean\n  doubleClickSpeed?: number\n}\n\n/**\n * Mouse observer\n *\n * @example\n * // listen to mouse moving (and touch-moving) events\n * mouseObserver.moved.moved.add( function( deltaX, deltaY ){ ... } );\n *\n * @example\n * // listen to scrolling (and pinching) events\n * mouseObserver.signals.scrolled.add( function( delta ){ ... } );\n *\n * @example\n * // listen to dragging (and touch-dragging) events\n * mouseObserver.signals.dragged.add( function( deltaX, deltaY ){ ... } );\n *\n * @example\n * // listen to clicking (and tapping) events\n * mouseObserver.signals.clicked.add( function(){ ... } );\n *\n * @example\n * // listen to double clicking (and double tapping) events\n * mouseObserver.signals.doubleClicked.add( function(){ ... } );\n *\n * @example\n * // listen to hovering events\n * mouseObserver.signals.hovered.add( function(){ ... } );\n */\nclass MouseObserver {\n  signals: MouseSignals = {\n    moved: new Signal(),\n    scrolled: new Signal(),\n    dragged: new Signal(),\n    dropped: new Signal(),\n    clicked: new Signal(),\n    hovered: new Signal(),\n    doubleClicked: new Signal()\n  }\n\n  hoverTimeout: number\n  handleScroll:boolean\n  doubleClickSpeed: number\n\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n\n  position = new Vector2()  // Position on page\n  prevPosition = new Vector2()  // Previous position on page\n  down = new Vector2()  // Position on page when clicked\n  canvasPosition = new Vector2()  // Position on dom element\n  prevClickCP = new Vector2()\n\n  moving = false  // Flag indicating if the mouse is moving\n  hovering = true  // Flag indicating if the mouse is hovering\n  scrolled = false  // Flag indicating if there was a scolling event since the last mouse move\n  lastMoved = Infinity  // Timestamp of last mouse move\n  which? = 0  // 0: No button; 1: Left button; 2: Middle button; 3: Right button\n  buttons? = 0  // 0: No button; 1: Left button; 2: Right button; 4: Middle button\n  pressed? = false  // Flag indicating if the mouse is pressed down\n  altKey = false  // Flag indicating if the alt key is pressed\n  ctrlKey = false  // Flag indicating if the ctrl key is pressed\n  metaKey = false  // Flag indicating if the meta key is pressed\n  shiftKey = false  // Flag indicating if the shift key is pressed\n\n  doubleClickPending: boolean\n  lastClicked: number\n  overElement: boolean\n  lastTouchDistance: number\n  private frameRequest: number\n\n  /**\n   * @param  {Element} domElement - the dom element to observe mouse events in\n   * @param  {Object} params - parameters object\n   * @param  {Integer} params.hoverTimeout - timeout in ms until the {@link MouseSignals.hovered}\n   *                                         signal is fired, set to -1 to ignore hovering\n   * @param  {Boolean} params.handleScroll - whether or not to handle scroll events\n   * @param  {Integer} params.doubleClickSpeed - max time in ms to trigger double click\n   */\n  constructor (readonly domElement: HTMLCanvasElement, params: MouseParams = {}) {\n    this.domElement.style.touchAction = 'none'\n\n    this.hoverTimeout = defaults(params.hoverTimeout, 50)\n    this.handleScroll = defaults(params.handleScroll, true)\n    this.doubleClickSpeed = defaults(params.doubleClickSpeed, 500)\n\n    this._listen = this._listen.bind(this)\n    this._onMousewheel = this._onMousewheel.bind(this)\n    this._onMousemove = this._onMousemove.bind(this)\n    this._onMousedown = this._onMousedown.bind(this)\n    this._onMouseup = this._onMouseup.bind(this)\n    this._onContextmenu = this._onContextmenu.bind(this)\n    this._onTouchstart = this._onTouchstart.bind(this)\n    this._onTouchend = this._onTouchend.bind(this)\n    this._onTouchmove = this._onTouchmove.bind(this)\n\n    this._listen()\n\n    const opt = { passive: false } // treat as 'passive' so preventDefault can be called\n    document.addEventListener('mousewheel', this._onMousewheel, opt)\n    document.addEventListener('wheel', this._onMousewheel, opt)\n    document.addEventListener('MozMousePixelScroll', this._onMousewheel, opt)\n    document.addEventListener('mousemove', this._onMousemove, opt)\n    document.addEventListener('mousedown', this._onMousedown, opt)\n    document.addEventListener('mouseup', this._onMouseup, opt)\n    document.addEventListener('contextmenu', this._onContextmenu, opt)\n    document.addEventListener('touchstart', this._onTouchstart, opt)\n    document.addEventListener('touchend', this._onTouchend, opt)\n    document.addEventListener('touchmove', this._onTouchmove, opt)\n  }\n\n  get key () {\n    let key = 0\n    if (this.altKey) key += 1\n    if (this.ctrlKey) key += 2\n    if (this.metaKey) key += 4\n    if (this.shiftKey) key += 8\n    return key\n  }\n\n  setParameters (params: MouseParams = {}) {\n    this.hoverTimeout = defaults(params.hoverTimeout, this.hoverTimeout)\n  }\n\n  /**\n   * listen to mouse actions\n   * @emits {MouseSignals.clicked} when clicked\n   * @emits {MouseSignals.hovered} when hovered\n   * @return {undefined}\n   */\n  _listen () {\n    const now = window.performance.now()\n    const cp = this.canvasPosition\n    if (this.doubleClickPending && now - this.lastClicked > this.doubleClickSpeed) {\n      this.doubleClickPending = false\n    }\n    if (now - this.lastMoved > this.hoverTimeout) {\n      this.moving = false\n    }\n    if (this.scrolled || (!this.moving && !this.hovering)) {\n      this.scrolled = false\n      if (this.hoverTimeout !== -1 && this.overElement) {\n        this.hovering = true\n        this.signals.hovered.dispatch(cp.x, cp.y)\n      }\n    }\n    this.frameRequest = window.requestAnimationFrame(this._listen)\n  }\n\n  /**\n   * handle mouse scroll\n   * @emits {MouseSignals.scrolled} when scrolled\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMousewheel(event: Optional<WheelEvent, 'detail'> & { wheelDelta?: number, wheelDeltaY?: number }) {\n    if (event.target !== this.domElement || !this.handleScroll) {\n      return\n    }\n    event.preventDefault()\n    this._setKeys(event as any)\n\n    let delta = 0\n    // This has to be written in a particular way to handle old browsers that\n    // all send events with different properties set in different ways.\n    if ('deltaY' in event && 'deltaMode' in event &&\n      event.deltaY !== undefined && event.deltaMode !== undefined) {\n      // all modern browsers, using WheelEvent; deltaY + down (toward user)\n      if (event.deltaMode === WheelEvent.DOM_DELTA_PIXEL)\n        // everything except Firefox: normally 100 per wheel click\n        delta = -event.deltaY * (2.5 / 100.0)\n      else if (event.deltaMode === WheelEvent.DOM_DELTA_LINE)\n        // Firefox in line mode, normally 3 per wheel click\n        delta = -event.deltaY * (2.5 / 3.0)\n      else                      // page mode: 1 per wheel click\n        delta = -event.deltaY * 2.5\n    } else if ('deltaY' in event && !('detail' in event))  {\n      // Old Firefox or IE 11: deltaY but no deltaMode; treat as pixels\n      delta = -event.deltaY * (2.5 / 100.0)\n    } else if (event.wheelDelta !== undefined) {\n      delta = -event.wheelDelta * (2.5 / 100)\n    } else if (event.wheelDeltaY !== undefined) {\n      delta = -event.wheelDeltaY * (2.5 / 100)\n    } else if (event.detail !== undefined){\n      // Old Firefox, MouseWheelEvent\n      delta = -event.detail / 3\n    }\n    this.signals.scrolled.dispatch(delta)\n\n    setTimeout(() => {\n      this.scrolled = true\n    }, this.hoverTimeout)\n  }\n\n  /**\n   * handle mouse move\n   * @emits {MouseSignals.moved} when moved\n   * @emits {MouseSignals.dragged} when dragged\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMousemove (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n      this.overElement = true\n    } else {\n      this.overElement = false\n    }\n    this._setKeys(event)\n    this.moving = true\n    this.hovering = false\n    this.lastMoved = window.performance.now()\n    this.prevPosition.copy(this.position)\n    this.position.set(event.clientX, event.clientY)\n    this._setCanvasPosition(event)\n    const dx = this.prevPosition.x - this.position.x\n    const dy = this.prevPosition.y - this.position.y\n    this.signals.moved.dispatch(dx, dy)\n    if (this.pressed) {\n      this.signals.dragged.dispatch(dx, dy)\n    }\n  }\n\n  _onMousedown (event: MouseEvent) {\n    if (event.target !== this.domElement) {\n      return\n    }\n    event.preventDefault()\n    this._setKeys(event)\n    this.moving = false\n    this.hovering = false\n    this.down.set(event.clientX, event.clientY)\n    this.position.set(event.clientX, event.clientY)\n    this.which = event.which\n    this.buttons = getMouseButtons(event)\n    this.pressed = true\n    this._setCanvasPosition(event)\n  }\n\n  /**\n   * handle mouse up\n   * @emits {MouseSignals.doubleClicked} when double clicked\n   * @emits {MouseSignals.dropped} when dropped\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMouseup (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n    this._setKeys(event)\n    const cp = this.canvasPosition\n    if (this._distance() < 4) {\n      this.lastClicked = window.performance.now()\n      if (this.doubleClickPending && this.prevClickCP.distanceTo(cp) < 4) {\n        this.signals.doubleClicked.dispatch(cp.x, cp.y)\n        this.doubleClickPending = false\n      }\n      this.signals.clicked.dispatch(cp.x, cp.y)\n      this.doubleClickPending = true\n      this.prevClickCP.copy(cp)\n    }\n    this.which = undefined\n    this.buttons = undefined\n    this.pressed = undefined\n    // if (this._distance() > 3 || event.which === RightMouseButton) {\n    //   this.signals.dropped.dispatch();\n    // }\n  }\n\n  _onContextmenu (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n  }\n\n  _onTouchstart (event: TouchEvent) {\n    if (event.target !== this.domElement) {\n      return\n    }\n    event.preventDefault()\n    this.pressed = true\n    switch (event.touches.length) {\n      case 1: {\n        this.moving = false\n        this.hovering = false\n        this.down.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this.position.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this._setCanvasPosition(event.touches[ 0 ])\n        break\n      }\n\n      case 2: {\n        this.down.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        this.position.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        this.lastTouchDistance = getTouchDistance(event)\n      }\n    }\n  }\n\n  _onTouchend (event: TouchEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n    this.which = undefined\n    this.buttons = undefined\n    this.pressed = undefined\n  }\n\n  _onTouchmove (event: TouchEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n      this.overElement = true\n    } else {\n      this.overElement = false\n    }\n    switch (event.touches.length) {\n      case 1: {\n        this._setKeys(event)\n        this.which = LeftMouseButton\n        this.buttons = 1\n        this.moving = true\n        this.hovering = false\n        this.lastMoved = window.performance.now()\n        this.prevPosition.copy(this.position)\n        this.position.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this._setCanvasPosition(event.touches[ 0 ])\n        const dx = this.prevPosition.x - this.position.x\n        const dy = this.prevPosition.y - this.position.y\n        this.signals.moved.dispatch(dx, dy)\n        if (this.pressed) {\n          this.signals.dragged.dispatch(dx, dy)\n        }\n        break\n      }\n\n      case 2: {\n        const touchDistance = getTouchDistance(event)\n        const delta = touchDistance - this.lastTouchDistance\n        this.lastTouchDistance = touchDistance\n        this.prevPosition.copy(this.position)\n        this.position.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        if (Math.abs(delta) > 2 && this.handleScroll &&\n            this.position.distanceTo(this.prevPosition) < 2\n        ) {\n          this.which = 0\n          this.buttons = 0\n          this.signals.scrolled.dispatch(delta / 2)\n        } else {\n          this.which = RightMouseButton\n          this.buttons = 2\n          const dx = this.prevPosition.x - this.position.x\n          const dy = this.prevPosition.y - this.position.y\n          this.signals.moved.dispatch(dx, dy)\n          if (this.pressed) {\n            this.signals.dragged.dispatch(dx, dy)\n          }\n        }\n      }\n    }\n  }\n\n  _distance () {\n    return this.position.distanceTo(this.down)\n  }\n\n  _setCanvasPosition (event: any) {  // TODO\n    const box = this.domElement.getBoundingClientRect()\n    let offsetX, offsetY;\n    if ('clientX' in event && 'clientY' in event) {\n      offsetX = event.clientX - box.left\n      offsetY = event.clientY - box.top\n    } else {\n      offsetX = event.offsetX\n      offsetY = event.offsetY\n    }\n    this.canvasPosition.set(offsetX, box.height - offsetY)\n  }\n\n  _setKeys (event: MouseEvent|TouchEvent) {\n    this.altKey = event.altKey\n    this.ctrlKey = event.ctrlKey\n    this.metaKey = event.metaKey\n    this.shiftKey = event.shiftKey\n  }\n\n  dispose () {\n    document.removeEventListener('mousewheel', this._onMousewheel)\n    document.removeEventListener('wheel', this._onMousewheel)\n    document.removeEventListener('MozMousePixelScroll', this._onMousewheel)\n    document.removeEventListener('mousemove', this._onMousemove)\n    document.removeEventListener('mousedown', this._onMousedown)\n    document.removeEventListener('mouseup', this._onMouseup)\n    document.removeEventListener('contextmenu', this._onContextmenu)\n    document.removeEventListener('touchstart', this._onTouchstart)\n    document.removeEventListener('touchend', this._onTouchend)\n    document.removeEventListener('touchmove', this._onTouchmove)\n    window.cancelAnimationFrame(this.frameRequest)\n  }\n}\n\nexport default MouseObserver\n","/**\n * @file Trackball Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\n\nimport { defaults } from '../utils'\nimport Stage from '../stage/stage'\nimport MouseObserver from '../stage/mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport ViewerControls from './viewer-controls'\nimport AtomProxy from '../proxy/atom-proxy';\nimport Component from '../component/component';\n\nconst tmpRotateXMatrix = new Matrix4()\nconst tmpRotateYMatrix = new Matrix4()\nconst tmpRotateZMatrix = new Matrix4()\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateCameraMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpRotateQuaternion = new Quaternion()\nconst tmpRotateQuaternion2 = new Quaternion()\nconst tmpPanMatrix = new Matrix4()\nconst tmpPanVector = new Vector3()\nconst tmpAtomVector = new Vector3()\n\nexport interface TrackballControlsParams {\n  rotateSpeed?: number\n  zoomSpeed?: number\n  panSpeed?: number\n}\n\n/**\n * Trackball controls\n */\nclass TrackballControls {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: ViewerControls\n\n  rotateSpeed: number\n  zoomSpeed: number\n  panSpeed: number\n\n  constructor (readonly stage: Stage, params: TrackballControlsParams = {}) {\n    this.rotateSpeed = defaults(params.rotateSpeed, 2.0)\n    this.zoomSpeed = defaults(params.zoomSpeed, 1.2)\n    this.panSpeed = defaults(params.panSpeed, 1.0)\n\n    this.viewer = stage.viewer\n    this.mouse = stage.mouseObserver\n    this.controls = stage.viewerControls\n  }\n\n  get component (): Component|undefined {\n    return this.stage.transformComponent\n  }\n\n  get atom (): AtomProxy|undefined {\n    return this.stage.transformAtom\n  }\n\n  private _setPanVector (x: number, y: number, z = 0) {\n    const scaleFactor = this.controls.getCanvasScaleFactor(z)\n    tmpPanVector.set(x, y, 0)\n    tmpPanVector.multiplyScalar(this.panSpeed * scaleFactor)\n  }\n\n  private _getRotateXY (x: number, y: number) {\n    return [\n      this.rotateSpeed * -x * 0.01,\n      this.rotateSpeed * y * 0.01\n    ]\n  }\n\n  private _getCameraRotation(m: Matrix4) {\n    m.extractRotation(this.viewer.camera.matrixWorld)\n    m.multiply(tmpRotateYMatrix.makeRotationY(Math.PI))\n\n    return m\n  }\n\n  private _transformPanVector () {\n    if (!this.component) return\n\n    // Adjust for component and scene rotation\n    tmpPanMatrix.extractRotation(this.component.transform)\n    tmpPanMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpPanMatrix.invert()\n\n    // Adjust for camera rotation\n    tmpPanMatrix.multiply(this._getCameraRotation(tmpRotateMatrix))\n\n    tmpPanVector.applyMatrix4(tmpPanMatrix)\n  }\n\n  zoom (delta: number) {\n    this.controls.zoom(this.zoomSpeed * delta * 0.02)\n  }\n\n  pan (x: number, y: number) {\n    this._setPanVector(x, y)\n\n    // Adjust for scene rotation\n    tmpPanMatrix.copy(this.viewer.rotationGroup.matrix).invert()\n\n    // Adjust for camera rotation\n    tmpPanMatrix.multiply(this._getCameraRotation(tmpRotateMatrix))\n\n    tmpPanVector.applyMatrix4(tmpPanMatrix)\n    this.controls.translate(tmpPanVector)\n  }\n\n  panComponent (x: number, y: number) {\n    if (!this.component) return\n\n    this._setPanVector(x, y)\n    this._transformPanVector()\n\n    this.component.position.add(tmpPanVector)\n    this.component.updateMatrix()\n  }\n\n  panAtom (x: number, y: number) {\n    if (!this.atom || !this.component) return\n\n    this.atom.positionToVector3(tmpAtomVector)\n    tmpAtomVector.add(this.viewer.translationGroup.position)\n    tmpAtomVector.applyMatrix4(this.viewer.rotationGroup.matrix)\n\n    this._setPanVector(x, y, tmpAtomVector.z)\n    this._transformPanVector()\n\n    this.atom.positionAdd(tmpPanVector)\n    this.component.updateRepresentations({ 'position': true })\n  }\n\n  rotate (x: number, y: number) {\n    const [ dx, dy ] = this._getRotateXY(x, y)\n\n    // rotate around screen X then screen Y\n    this._getCameraRotation(tmpRotateMatrix)\n    tmpRotateVector.set(1, 0, 0) // X axis\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix) // screen X\n    tmpRotateQuaternion.setFromAxisAngle(tmpRotateVector, dy)\n\n    tmpRotateVector.set(0, 1, 0) // Y axis\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix) // screen Y\n    tmpRotateQuaternion2.setFromAxisAngle(tmpRotateVector, dx)\n\n    tmpRotateQuaternion.multiply(tmpRotateQuaternion2)\n    tmpRotateMatrix.makeRotationFromQuaternion(tmpRotateQuaternion)\n    this.controls.applyMatrix(tmpRotateMatrix)\n  }\n\n  zRotate (x: number, y: number) {\n    const dz = this.rotateSpeed * ((-x + y) / -2) * 0.01\n\n    tmpRotateZMatrix.makeRotationZ(dz)\n    this.controls.applyMatrix(tmpRotateZMatrix)\n  }\n\n  rotateComponent (x: number, y: number) {\n    if (!this.component) return\n\n    const [ dx, dy ] = this._getRotateXY(x, y)\n\n    this._getCameraRotation(tmpRotateCameraMatrix)\n\n    tmpRotateMatrix.extractRotation(this.component.transform)\n    tmpRotateMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpRotateMatrix.invert()\n    tmpRotateMatrix.premultiply(tmpRotateCameraMatrix)\n\n    tmpRotateVector.set(1, 0, 0)\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateXMatrix.makeRotationAxis(tmpRotateVector, dy)\n\n    tmpRotateVector.set(0, 1, 0)\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateYMatrix.makeRotationAxis(tmpRotateVector, dx)\n\n    tmpRotateXMatrix.multiply(tmpRotateYMatrix)\n    tmpRotateQuaternion.setFromRotationMatrix(tmpRotateXMatrix)\n    this.component.quaternion.premultiply(tmpRotateQuaternion)\n    this.component.quaternion.normalize()\n    this.component.updateMatrix()\n  }\n}\n\nexport default TrackballControls\n","/**\n * @file Picking Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Vector2 } from 'three'\n\nimport Stage from '../stage/stage'\nimport StructureComponent from '../component/structure-component'\nimport MouseObserver from '../stage/mouse-observer'\nimport { Picker } from '../utils/picker'\nimport ViewerControls from './viewer-controls'\nimport Shape from '../geometry/shape'\nimport Structure from '../structure/structure'\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Unitcell from '../symmetry/unitcell'\nimport Component from '../component/component';\n\nconst tmpVec = new Vector3()\n\nexport interface ShapePrimitive {\n  name: string\n  shape: Shape\n}\n\nfunction closer (x: Vector3, a: Vector3, b: Vector3) {\n  return x.distanceTo(a) < x.distanceTo(b)\n}\n\n/**\n * Picking data object.\n * @typedef {Object} PickingData - picking data\n * @property {Number} [pid] - picking id\n * @property {Object} [instance] - instance data\n * @property {Integer} instance.id - instance id\n * @property {String|Integer} instance.name - instance name\n * @property {Matrix4} instance.matrix - transformation matrix of the instance\n * @property {Picker} [picker] - picker object\n */\n\nexport interface InstanceData {\n  id: number\n  name: number|string\n  matrix: Matrix4\n}\n\nexport interface PickingData {\n  pid: number\n  instance: InstanceData\n  picker: Picker\n}\n\n/**\n * Picking proxy class.\n */\nclass PickingProxy {\n  pid: number\n  picker: Picker\n  instance: InstanceData\n  controls: ViewerControls\n  mouse: MouseObserver\n\n  /**\n   * Create picking proxy object\n   * @param  {PickingData} pickingData - picking data\n   * @param  {Stage} stage - stage object\n   */\n  constructor (pickingData: PickingData, readonly stage: Stage) {\n    this.pid = pickingData.pid\n    this.picker = pickingData.picker\n\n    /**\n     * @type {Object}\n     */\n    this.instance = pickingData.instance\n\n    /**\n     * @type {Stage}\n     */\n    this.stage = stage\n    /**\n     * @type {ViewerControls}\n     */\n    this.controls = stage.viewerControls\n    /**\n     * @type {MouseObserver}\n     */\n    this.mouse = stage.mouseObserver\n  }\n\n  /**\n   * Kind of the picked data\n   * @type {String}\n   */\n  get type () { return this.picker.type }\n\n  /**\n   * If the `alt` key was pressed\n   * @type {Boolean}\n   */\n  get altKey () { return this.mouse.altKey }\n  /**\n   * If the `ctrl` key was pressed\n   * @type {Boolean}\n   */\n  get ctrlKey () { return this.mouse.ctrlKey }\n  /**\n   * If the `meta` key was pressed\n   * @type {Boolean}\n   */\n  get metaKey () { return this.mouse.metaKey }\n  /**\n   * If the `shift` key was pressed\n   * @type {Boolean}\n   */\n  get shiftKey () { return this.mouse.shiftKey }\n\n  /**\n   * Position of the mouse on the canvas\n   * @type {Vector2}\n   */\n  get canvasPosition (): Vector2 { return this.mouse.canvasPosition }\n\n  /**\n   * The component the picked data is part of\n   * @type {Component}\n   */\n  get component (): Component {\n    return this.stage.getComponentsByObject(this.picker.data as any).list[ 0 ]  // TODO\n  }\n\n  /**\n   * The picked object data\n   * @type {Object}\n   */\n  get object () {\n    return this.picker.getObject(this.pid)\n  }\n\n  /**\n   * The 3d position in the scene of the picked object\n   * @type {Vector3}\n   */\n  get position () {\n    return this.picker.getPosition(this.pid, this.instance, this.component)\n  }\n\n  /**\n   * The atom of a picked bond that is closest to the mouse\n   * @type {AtomProxy}\n   */\n  get closestBondAtom (): AtomProxy|undefined {\n    if (this.type !== 'bond' || !this.bond) return undefined\n\n    const bond = this.bond\n    const controls = this.controls\n    const cp = this.canvasPosition\n\n    const v1 = bond.atom1.positionToVector3()\n    const v2 = bond.atom2.positionToVector3()\n\n    v1.applyMatrix4(this.component.matrix)\n    v2.applyMatrix4(this.component.matrix)\n\n    const acp1 = controls.getPositionOnCanvas(v1)\n    const acp2 = controls.getPositionOnCanvas(v2)\n\n    return closer(cp as any, acp1, acp2) ? bond.atom1 : bond.atom2\n  }\n\n  /**\n   * Close-by atom\n   * @type {AtomProxy}\n   */\n  get closeAtom (): AtomProxy|undefined {\n    const cp = this.canvasPosition\n    const ca = this.closestBondAtom\n    if (!ca) return undefined\n\n    const v = ca.positionToVector3().applyMatrix4(this.component.matrix)\n\n    const acp = this.controls.getPositionOnCanvas(v)\n\n    ca.positionToVector3(tmpVec)\n    if (this.instance) tmpVec.applyMatrix4(this.instance.matrix)\n    tmpVec.applyMatrix4(this.component.matrix)\n    const viewer = this.controls.viewer\n    tmpVec.add(viewer.translationGroup.position)\n    tmpVec.applyMatrix4(viewer.rotationGroup.matrix)\n\n    const scaleFactor = this.controls.getCanvasScaleFactor(tmpVec.z)\n    const sc = this.component as StructureComponent\n    const radius = sc.getMaxRepresentationRadius(ca.index)\n    //console.log(scaleFactor, cp.distanceTo(acp), radius/scaleFactor, radius)\n\n    if (cp.distanceTo(acp) <= radius/scaleFactor) {\n      return ca\n    } else {\n      return undefined\n    }\n  }\n\n  /**\n   * @type {Object}\n   */\n  get arrow () { return this._objectIfType('arrow') as ShapePrimitive }\n  /**\n   * @type {AtomProxy}\n   */\n  get atom () { return this._objectIfType('atom') as AtomProxy }\n  /**\n   * @type {Object}\n   */\n  get axes () { return this._objectIfType('axes') }\n  /**\n   * @type {BondProxy}\n   */\n  get bond () { return this._objectIfType('bond') as BondProxy }\n  /**\n   * @type {Object}\n   */\n  get box () { return this._objectIfType('box') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get cone () { return this._objectIfType('cone') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get clash () { return this._objectIfType('clash') as { clash: { sele1: string, sele2: string } } }\n  /**\n   * @type {BondProxy}\n   */\n  get contact () { return this._objectIfType('contact') as { type: string, atom1: AtomProxy, atom2: AtomProxy } }\n  /**\n   * @type {Object}\n   */\n  get cylinder () { return this._objectIfType('cylinder') as ShapePrimitive }\n  /**\n   * @type {BondProxy}\n   */\n  get distance () { return this._objectIfType('distance') as BondProxy }\n  /**\n   * @type {Object}\n   */\n  get ellipsoid () { return this._objectIfType('ellipsoid') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get icosahedron () { return this._objectIfType('icosahedron') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get octahedron () { return this._objectIfType('octahedron') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get point () { return this._objectIfType('point') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get mesh () { return this._objectIfType('mesh') as { name: string, shape: Shape, serial: number } }\n  /**\n   * @type {Object}\n   */\n  get slice () { return this._objectIfType('slice') as { volume: Volume, value: number } }\n  /**\n   * @type {Object}\n   */\n  get sphere () { return this._objectIfType('sphere') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get tetrahedron () { return this._objectIfType('tetrahedron') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get torus () { return this._objectIfType('torus') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get surface () { return this._objectIfType('surface') as { surface: Surface, index: number } }\n  /**\n   * @type {Object}\n   */\n  get unitcell () { return this._objectIfType('unitcell') as { unitcell: Unitcell, structure: Structure } }\n  /**\n   * @type {Object}\n   */\n  get unknown () { return this._objectIfType('unknown') }\n  /**\n   * @type {Object}\n   */\n  get volume () { return this._objectIfType('volume') as { volume: Volume, value: number } }\n  /**\n   * @type {Object}\n   */\n  get wideline () { return this._objectIfType('wideline') as ShapePrimitive }\n\n  _objectIfType (type: string) {\n    return this.type === type ? this.object : undefined\n  }\n\n  getLabel () {\n    const atom = this.atom || this.closeAtom\n    let msg = 'nothing'\n    if (this.arrow) {\n      msg = this.arrow.name\n    } else if (atom) {\n      msg = `atom: ${atom.qualifiedName()} (${atom.structure.name})`\n    } else if (this.axes) {\n      msg = 'axes'\n    } else if (this.bond) {\n      msg = `bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`\n    } else if (this.box) {\n      msg = this.box.name\n    } else if (this.cone) {\n      msg = this.cone.name\n    } else if (this.clash) {\n      msg = `clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`\n    } else if (this.contact) {\n      msg = `${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`\n    } else if (this.cylinder) {\n      msg = this.cylinder.name\n    } else if (this.distance) {\n      msg = `distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`\n    } else if (this.ellipsoid) {\n      msg = this.ellipsoid.name\n    } else if (this.icosahedron) {\n      msg = this.icosahedron.name\n    } else if (this.octahedron) {\n      msg = this.octahedron.name\n    } else if (this.point) {\n      msg = this.point.name\n    } else if (this.mesh) {\n      msg = `mesh: ${this.mesh.name || this.mesh.serial} (${this.mesh.shape.name})`\n    } else if (this.slice) {\n      msg = `slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`\n    } else if (this.sphere) {\n      msg = this.sphere.name\n    } else if (this.surface) {\n      msg = `surface: ${this.surface.surface.name}`\n    } else if (this.tetrahedron) {\n      msg = this.tetrahedron.name\n    } else if (this.torus) {\n      msg = this.torus.name\n    } else if (this.unitcell) {\n      msg = `unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`\n    } else if (this.unknown) {\n      msg = 'unknown'\n    } else if (this.volume) {\n      msg = `volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`\n    } else if (this.wideline) {\n      msg = this.wideline.name\n    }\n    return msg\n  }\n}\n\nexport default PickingProxy\n","/**\n * @file Picking Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport PickingProxy from './picking-proxy'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\n/**\n * Picking controls\n */\nclass PickingControls {\n  viewer: Viewer\n\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n  }\n\n  /**\n   * get picking data\n   * @param {Number} x - canvas x coordinate\n   * @param {Number} y - canvas y coordinate\n   * @return {PickingProxy|undefined} picking proxy\n   */\n  pick (x: number, y: number) {\n    const pickingData = this.viewer.pick(x, y)\n\n    if (pickingData.picker &&\n        pickingData.picker.type !== 'ignore' &&\n        pickingData.pid !== undefined\n    ) {\n      const pickerArray = pickingData.picker.array\n      if (pickerArray && pickingData.pid >= pickerArray.length) {\n        console.error('pid >= picker.array.length')\n      } else {\n        return new PickingProxy(pickingData, this.stage)\n      }\n    }\n  }\n}\n\nexport default PickingControls\n","/**\n * @file Viewer Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3, Matrix4, Quaternion, OrthographicCamera } from 'three'\nimport * as signalsWrapper from 'signals'\n\nimport {\n  ensureVector2, ensureVector3, ensureMatrix4, ensureQuaternion\n} from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\n/**\n * Orientation matrix, a 4x4 transformation matrix with rotation part\n * used for scene rotation, scale part for scene camera distance and\n * position part for scene translation\n * @typedef {Matrix4} OrientationMatrix - orientation matrix\n */\n\nconst tmpQ = new Quaternion()\nconst tmpP = new Vector3()\nconst tmpS = new Vector3()\n\nconst tmpCanvasVector = new Vector3()\nconst tmpScaleVector = new Vector3()\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpAlignMatrix = new Matrix4()\n\n/**\n * Viewer controls\n */\nclass ViewerControls {\n  signals = {\n    changed: new signalsWrapper.Signal()\n  }\n\n  viewer: Viewer\n\n  /**\n   * @param  {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n  }\n\n  /**\n   * scene center position\n   * @type {Vector3}\n   */\n  get position () {\n    return this.viewer.translationGroup.position\n  }\n\n  /**\n   * scene rotation\n   * @type {Quaternion}\n   */\n  get rotation () {\n    return this.viewer.rotationGroup.quaternion\n  }\n\n  /**\n   * Trigger render and emit changed event\n   * @param {boolean} skipDispatch - don't signal for a change\n   * @emits {ViewerControls.signals.changed}\n   * @return {undefined}\n   */\n  changed (skipDispatch: boolean = false) {\n    this.viewer.requestRender()\n    if (!skipDispatch) {\n      this.signals.changed.dispatch()\n    }\n  }\n\n  getPositionOnCanvas (position: Vector3, optionalTarget?: Vector2) {\n    const canvasPosition = ensureVector2(optionalTarget)\n    const viewer = this.viewer\n\n    tmpCanvasVector.copy(position)\n      .add(viewer.translationGroup.position)\n      .applyMatrix4(viewer.rotationGroup.matrix)\n      .project(viewer.camera)\n\n    return canvasPosition.set(\n      (tmpCanvasVector.x + 1) * viewer.width / 2,\n      (tmpCanvasVector.y + 1) * viewer.height / 2\n    )\n  }\n\n  getCanvasScaleFactor (z = 0) {\n    const camera = this.viewer.camera\n    if (camera instanceof OrthographicCamera) {\n      return 1 / camera.zoom\n    } else {\n      z = Math.abs(z)\n      z += this.getCameraDistance()\n      const fov = degToRad(camera.fov)\n      const unitHeight = 2.0 * z * Math.tan(fov / 2)\n      return unitHeight / this.viewer.height\n    }\n  }\n\n  /**\n   * get scene orientation\n   * @param {Matrix4} optionalTarget - pre-allocated target matrix\n   * @return {OrientationMatrix} scene orientation\n   */\n  getOrientation (optionalTarget?: Matrix4) {\n    const m = ensureMatrix4(optionalTarget)\n\n    m.copy(this.viewer.rotationGroup.matrix)\n    const z = this.getCameraDistance()\n    m.scale(tmpScaleVector.set(z, z, z))\n    m.setPosition(this.viewer.translationGroup.position)\n\n    return m\n  }\n\n  /**\n   * set scene orientation\n   * @param {OrientationMatrix|Array} orientation - scene orientation\n   * @param {boolean} skipDispatch - do not trigger a change signal when orienting\n   * @return {undefined}\n   */\n  orient (orientation?: Matrix4, skipDispatch?: boolean) {\n    ensureMatrix4(orientation).decompose(tmpP, tmpQ, tmpS)\n\n    const v = this.viewer\n    v.rotationGroup.setRotationFromQuaternion(tmpQ)\n    v.translationGroup.position.copy(tmpP)\n    v.cameraDistance = tmpS.z\n    v.updateZoom()\n    this.changed(skipDispatch)\n  }\n\n  /**\n   * translate scene\n   * @param  {Vector3|Array} vector - translation vector\n   * @return {undefined}\n   */\n  translate (vector: Vector3|number[]) {\n    this.viewer.translationGroup.position\n      .add(ensureVector3(vector))\n    this.changed()\n  }\n\n  /**\n   * center scene\n   * @param  {Vector3|Array} position - center position\n   * @return {undefined}\n   */\n  center (position: Vector3|number[]) {\n    this.viewer.translationGroup.position\n      .copy(ensureVector3(position)).negate()\n    this.changed()\n  }\n\n  /**\n   * \"zoom\" scene by moving camera closer to origin\n   * @param  {Number} delta - zoom change\n   * @return {undefined}\n   */\n  zoom (delta: number) {\n    this.distance(this.getCameraDistance() * (1 - delta))\n  }\n\n  /**\n   * get camera distance\n   */\n  getCameraDistance(): number {\n    return this.viewer.cameraDistance\n  }\n\n  /**\n   * camera distance\n   * @param  {Number} z - distance\n   * @return {undefined}\n   */\n  distance (distance: number) {\n    // Math.abs because distance used to be \"z\", normally negative.\n    // Math.max to prevent us from getting _too_ close.\n    this.viewer.cameraDistance = Math.max(Math.abs(distance), 0.2)\n    this.viewer.updateZoom()\n    this.changed()\n  }\n\n  /**\n   * spin scene on axis\n   * @param  {Vector3|Array} axis - rotation axis\n   * @param  {Number} angle - amount to spin\n   * @return {undefined}\n   */\n  spin (axis: Vector3|number[], angle: number) {\n    tmpRotateMatrix.copy(this.viewer.rotationGroup.matrix).invert()\n    tmpRotateVector\n      .copy(ensureVector3(axis)).applyMatrix4(tmpRotateMatrix)\n\n    this.viewer.rotationGroup.rotateOnAxis(tmpRotateVector, angle)\n    this.changed()\n  }\n\n  /**\n   * rotate scene\n   * @param  {Quaternion|Array} quaternion - rotation quaternion\n   * @return {undefined}\n   */\n  rotate (quaternion: Quaternion|number[]) {\n    this.viewer.rotationGroup\n      .setRotationFromQuaternion(ensureQuaternion(quaternion))\n    this.changed()\n  }\n\n  /**\n   * align scene to basis matrix\n   * @param  {Matrix4|Array} basis - basis matrix\n   * @return {undefined}\n   */\n  align (basis: Matrix4|number[]) {\n    tmpAlignMatrix.copy(ensureMatrix4(basis)).invert()\n\n    this.viewer.rotationGroup.setRotationFromMatrix(tmpAlignMatrix)\n    this.changed()\n  }\n\n  /**\n   * apply rotation matrix to scene\n   * @param  {Matrix4|Array} matrix - rotation matrix\n   * @return {undefined}\n   */\n  applyMatrix (matrix: Matrix4|number[]) {\n    this.viewer.rotationGroup.applyMatrix4(ensureMatrix4(matrix))\n    this.changed()\n  }\n}\n\nexport default ViewerControls\n","/**\n * @file Animation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion } from 'three'\n\nimport { defaults, ensureVector3, ensureQuaternion } from '../utils'\nimport { lerp, smoothstep } from '../math/math-utils'\nimport ViewerControls from '../controls/viewer-controls'\nimport Stats from '../viewer/stats'\n\n/**\n * Animation. Base animation class.\n * @interface\n */\nabstract class Animation {\n  duration: number\n  controls: ViewerControls\n\n  alpha: number\n  startTime: number\n\n  pausedTime = -1\n  elapsedDuration = 0\n  pausedDuration = 0\n  ignoreGlobalToggle = false\n\n  private _paused = false\n  private _resolveList: Function[] = []\n  private _hold: boolean\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    this.duration = defaults(duration, 1000)\n    this.controls = controls\n\n    this.startTime = window.performance.now()\n\n    this._init(...args)\n  }\n\n  /**\n   * True when animation has finished\n   */\n  get done () {\n    return this.alpha === 1\n  }\n\n  /**\n   * True when animation is paused\n   */\n  get paused () {\n    return this._paused\n  }\n\n  /**\n   * init animation\n   */\n  abstract _init (...args: any[]): void\n\n  /**\n   * called on every tick\n   */\n  abstract _tick (stats?: Stats): void\n\n  tick (stats: Stats) {\n    if (this._paused) return\n\n    this.elapsedDuration = stats.currentTime - this.startTime - this.pausedDuration\n\n    if (this.duration === 0) {\n      this.alpha = 1\n    } else {\n      this.alpha = smoothstep(0, 1, this.elapsedDuration / this.duration)\n    }\n\n    this._tick(stats)\n\n    if (this.done) {\n      this._resolveList.forEach(resolve => resolve())\n    }\n\n    return this.done\n  }\n\n  /**\n   * Pause animation\n   * @param {boolean} [hold] - put animation on a hold which\n   *                           must be release before it can be resumed\n   */\n  pause (hold?: boolean) {\n    if (hold) this._hold = true\n\n    if (this.pausedTime === -1) {\n      this.pausedTime = window.performance.now()\n    }\n    this._paused = true\n  }\n\n  /**\n   * Resume animation\n   * @param {Boolean} [releaseHold] - release a hold on the animation\n   */\n  resume (releaseHold?: boolean) {\n    if (!releaseHold && this._hold) return\n\n    this.pausedDuration += window.performance.now() - this.pausedTime\n    this._paused = false\n    this._hold = false\n    this.pausedTime = -1\n  }\n\n  /**\n   * Toggle animation\n   */\n  toggle () {\n    if (this._paused) {\n      this.resume()\n    } else {\n      this.pause()\n    }\n  }\n\n  /**\n   * Promise-like interface\n   */\n  then (callback: Function) {\n    let p: Promise<any>\n\n    if (this.done) {\n      p = Promise.resolve()\n    } else {\n      p = new Promise(resolve => this._resolveList.push(resolve))\n    }\n\n    return p.then(callback as any)\n  }\n}\n\nexport default Animation\n\n/**\n * Spin animation. Spin around an axis.\n */\nexport class SpinAnimation extends Animation {\n  axis: Vector3\n  angle: number\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    super(defaults(duration, Infinity), controls, ...args)\n  }\n\n  _init (axis: number[]|Vector3, angle: number) {\n    if (Array.isArray(axis)) {\n      this.axis = new Vector3().fromArray(axis)\n    } else {\n      this.axis = defaults(axis, new Vector3(0, 1, 0))\n    }\n    this.angle = defaults(angle, 0.01)\n  }\n\n  _tick (stats: Stats) {\n    if (!this.axis || !this.angle) return\n\n    this.controls.spin(\n      this.axis, this.angle * stats.lastDuration / 16\n    )\n  }\n}\n\n/**\n * Rock animation. Rock around an axis.\n */\nexport class RockAnimation extends Animation {\n  axis: Vector3\n  angleStep: number\n  angleEnd: number\n  angleSum = 0\n  direction = 1\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    super(defaults(duration, Infinity), controls, ...args)\n  }\n\n  _init (axis: number[]|Vector3, angleStep: number, angleEnd: number) {\n    if (Array.isArray(axis)) {\n      this.axis = new Vector3().fromArray(axis)\n    } else {\n      this.axis = defaults(axis, new Vector3(0, 1, 0))\n    }\n    this.angleStep = defaults(angleStep, 0.01)\n    this.angleEnd = defaults(angleEnd, 0.2)\n  }\n\n  _tick (stats: Stats) {\n    if (!this.axis || !this.angleStep || !this.angleEnd) return\n\n    const alpha = smoothstep(\n      0, 1, Math.abs(this.angleSum) / this.angleEnd\n    )\n    const angle = this.angleStep * this.direction * (1.1 - alpha)\n\n    this.controls.spin(\n      this.axis, angle * stats.lastDuration / 16\n    )\n\n    this.angleSum += this.angleStep\n\n    if (this.angleSum >= this.angleEnd) {\n      this.direction *= -1\n      this.angleSum = -this.angleEnd\n    }\n  }\n}\n\n/**\n * Move animation. Move from one position to another.\n */\nexport class MoveAnimation extends Animation {\n  moveFrom: Vector3\n  moveTo: Vector3\n\n  _init (moveFrom: number[]|Vector3, moveTo: number[]|Vector3) {\n    this.moveFrom = ensureVector3(defaults(moveFrom, new Vector3()))\n    this.moveTo = ensureVector3(defaults(moveTo, new Vector3()))\n  }\n\n  _tick (/* stats */) {\n    this.controls.position.lerpVectors(\n      this.moveFrom, this.moveTo, this.alpha\n    ).negate()\n    this.controls.changed()\n  }\n}\n\n/**\n * Zoom animation. Gradually change the zoom level.\n */\nexport class ZoomAnimation extends Animation {\n  zoomFrom: number\n  zoomTo: number\n\n  _init (zoomFrom: number, zoomTo: number) {\n    this.zoomFrom = zoomFrom\n    this.zoomTo = zoomTo\n  }\n\n  _tick () {\n    this.controls.distance(lerp(this.zoomFrom, this.zoomTo, this.alpha))\n  }\n}\n\n/**\n * Rotate animation. Rotate from one orientation to another.\n */\nexport class RotateAnimation extends Animation {\n  rotateFrom: Quaternion\n  rotateTo: Quaternion\n\n  private _currentRotation = new Quaternion()\n\n  _init (rotateFrom: number[]|Quaternion, rotateTo: number[]|Quaternion) {\n    this.rotateFrom = ensureQuaternion(rotateFrom)\n    this.rotateTo = ensureQuaternion(rotateTo)\n\n    this._currentRotation = new Quaternion()\n  }\n\n  _tick () {\n    this._currentRotation\n      .copy(this.rotateFrom)\n      .slerp(this.rotateTo, this.alpha)\n\n    this.controls.rotate(this._currentRotation)\n  }\n}\n\n/**\n * Value animation. Call callback with interpolated value.\n */\nexport class ValueAnimation extends Animation {\n  valueFrom: number\n  valueTo: number\n  callback: Function\n\n  _init (valueFrom: number, valueTo: number, callback: Function) {\n    this.valueFrom = valueFrom\n    this.valueTo = valueTo\n\n    this.callback = callback\n  }\n\n  _tick (/* stats */) {\n    this.callback(lerp(this.valueFrom, this.valueTo, this.alpha))\n  }\n}\n\n/**\n * Timeout animation. Call callback after duration.\n */\nexport class TimeoutAnimation extends Animation {\n  callback: Function\n\n  _init (callback: Function) {\n    this.callback = callback\n  }\n\n  _tick () {\n    if (this.alpha === 1) this.callback()\n  }\n}\n\n/**\n * Animation list.\n */\nexport class AnimationList {\n  _list: Animation[]\n  _resolveList: Function[] = []\n\n  constructor (list: Animation[] = []) {\n    this._list = list\n  }\n\n  /**\n   * True when all animations have finished\n   */\n  get done () {\n    return this._list.every(animation => {\n      return animation.done\n    })\n  }\n\n  /**\n   * Promise-like interface\n   */\n  then (callback: Function) {\n    let p: Promise<any>\n\n    if (this.done) {\n      p = Promise.resolve()\n    } else {\n      p = new Promise(resolve => {\n        this._resolveList.push(resolve)\n        this._list.forEach(animation => {\n          animation.then(() => {\n            this._resolveList.forEach(callback => {\n              callback()\n            })\n            this._resolveList.length = 0\n          })\n        })\n      })\n    }\n\n    return p.then(callback as any)\n  }\n}\n","/**\n * @file Animation Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion, Matrix4 } from 'three'\n\nimport { ensureMatrix4 } from '../utils'\nimport Animation, {\n    SpinAnimation, RockAnimation, MoveAnimation, ZoomAnimation,\n    RotateAnimation, ValueAnimation, TimeoutAnimation, AnimationList\n} from '../animation/animation'\nimport Stage from '../stage/stage'\nimport Component from '../component/component'\nimport Viewer from '../viewer/viewer'\nimport Stats from '../viewer/stats'\nimport ViewerControls from './viewer-controls'\n\n/**\n * Animation controls\n */\nclass AnimationControls {\n  viewer: Viewer\n  controls: ViewerControls\n\n  animationList: Animation[] = []\n  finishedList: Animation[] = []\n\n  /**\n   * Create animation controls\n   * @param  {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n    this.controls = stage.viewerControls\n  }\n\n  /**\n   * True when all animations are paused\n   * @type {Boolean}\n   */\n  get paused () {\n    return this.animationList.every((animation: Animation) => animation.paused)\n  }\n\n  /**\n   * Add an animation\n   */\n  add (animation: Animation) {\n    if (animation.duration === 0) {\n      animation.tick(this.viewer.stats)\n    } else {\n      this.animationList.push(animation)\n    }\n\n    return animation\n  }\n\n  /**\n   * Remove an animation\n   */\n  remove (animation: Animation) {\n    const list = this.animationList\n    const index = list.indexOf(animation)\n\n    if (index > -1) {\n      list.splice(index, 1)\n    }\n  }\n\n  /**\n   * Run all animations\n   */\n  run (stats: Stats) {\n    const finishedList = this.finishedList\n    const animationList = this.animationList\n\n    const n = animationList.length\n    for (let i = 0; i < n; ++i) {\n      const animation = animationList[ i ]\n      // tick returns true when finished\n      if (animation.tick(stats)) {\n        finishedList.push(animation)\n      }\n    }\n\n    const m = finishedList.length\n    if (m) {\n      for (let j = 0; j < m; ++j) {\n        this.remove(finishedList[ j ])\n      }\n      finishedList.length = 0\n    }\n  }\n\n  /**\n   * Add a spin animation\n   * @param  {Vector3} axis - axis to spin around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  spin (axis: Vector3|number[], angle?: number, duration?: number) {\n    return this.add(\n      new SpinAnimation(duration, this.controls, axis, angle)\n    )\n  }\n\n  /**\n   * Add a rock animation\n   * @param  {Vector3} axis - axis to rock around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} end - maximum extend of motion, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  rock (axis: Vector3|number[], angle?: number, end?: number, duration?: number) {\n    return this.add(\n      new RockAnimation(duration, this.controls, axis, angle, end)\n    )\n  }\n\n  /**\n   * Add a rotate animation\n   * @param  {Quaternion} rotateTo - target rotation\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {RotateAnimation} the animation\n   */\n  rotate (rotateTo: Quaternion|number[], duration?: number) {\n    const rotateFrom = this.viewer.rotationGroup.quaternion.clone()\n\n    return this.add(\n      new RotateAnimation(duration, this.controls, rotateFrom, rotateTo)\n    )\n  }\n\n  /**\n   * Add a move animation\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {MoveAnimation} the animation\n   */\n  move (moveTo: Vector3|number[], duration?: number) {\n    const moveFrom = this.controls.position.clone().negate()\n\n    return this.add(\n      new MoveAnimation(duration, this.controls, moveFrom, moveTo)\n    )\n  }\n\n  /**\n   * Add a zoom animation\n   * @param  {Number} zoomTo - target distance\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {ZoomAnimation} the animation\n   */\n  zoom (zoomTo: number, duration?: number) {\n    const zoomFrom = this.viewer.camera.position.z\n\n    return this.add(\n      new ZoomAnimation(duration, this.controls, zoomFrom, zoomTo)\n    )\n  }\n\n  /**\n   * Add a zoom and a move animation\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} zoomTo - target distance\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {Array} the animations\n   */\n  zoomMove (moveTo: Vector3, zoomTo: number, duration?: number) {\n    return new AnimationList([\n      this.move(moveTo, duration),\n      this.zoom(zoomTo, duration)\n    ])\n  }\n\n  /**\n   * Add an orient animation\n   * @param  {OrientationMatrix|Array} orientTo - target orientation\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {Array} the animations\n   */\n  orient (orientTo: Matrix4|number[], duration?: number) {\n    const p = new Vector3()\n    const q = new Quaternion()\n    const s = new Vector3()\n\n    ensureMatrix4(orientTo).decompose(p, q, s)\n\n    return new AnimationList([\n      this.move(p.negate(), duration),\n      this.rotate(q, duration),\n      this.zoom(-s.x, duration)\n    ])\n  }\n\n  /**\n   * Add a value animation\n   * @param  {Number} valueFrom - start value\n   * @param  {Number} valueTo - target value\n   * @param  {Function} callback - called on every tick\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {ValueAnimation} the animation\n   */\n  value (valueFrom: number, valueTo: number, callback: Function, duration?: number) {\n    return this.add(\n      new ValueAnimation(duration, this.controls, valueFrom, valueTo, callback)\n    )\n  }\n\n  /**\n   * Add a timeout animation\n   * @param  {Function} callback - called after duration\n   * @param  {Number} duration - timeout in milliseconds\n   * @return {TimeoutAnimation} the animation\n   */\n  timeout (callback: Function, duration?: number) {\n    return this.add(\n      new TimeoutAnimation(duration, this.controls, callback)\n    )\n  }\n\n  /**\n   * Add a component spin animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} axis - axis to spin around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  spinComponent (component: Component, axis?: Vector3|number[], angle?: number, duration?: number) {\n    return this.add(\n      // TODO\n      new SpinAnimation(duration, component.controls as any, axis, angle)\n    )\n  }\n\n  /**\n   * Add a component rock animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} axis - axis to rock around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} end - maximum extend of motion, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  rockComponent (component: Component, axis: Vector3|number[], angle?: number, end?: number, duration?: number) {\n    return this.add(\n       // TODO\n      new RockAnimation(duration, component.controls as any, axis, angle, end)\n    )\n  }\n\n  /**\n   * Add a component move animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {MoveAnimation} the animation\n   */\n  moveComponent (component: Component, moveTo: Vector3|number[], duration?: number) {\n    const moveFrom = component.controls.position.clone().negate()\n\n    return this.add(\n      // TODO\n      new MoveAnimation(duration, component.controls as any, moveFrom, moveTo)\n    )\n  }\n\n  /**\n   * Pause all animations\n   * @return {undefined}\n   */\n  pause () {\n    this.animationList.forEach(animation => animation.pause())\n  }\n\n  /**\n   * Resume all animations\n   * @return {undefined}\n   */\n  resume () {\n    this.animationList.forEach(animation => animation.resume())\n  }\n\n  /**\n   * Toggle all animations\n   * @return {undefined}\n   */\n  toggle () {\n    if (this.paused) {\n      this.resume()\n    } else {\n      this.pause()\n    }\n  }\n\n  /**\n   * Clear all animations\n   * @return {undefined}\n   */\n  clear () {\n    this.animationList.length = 0\n  }\n\n  dispose () {\n    this.clear()\n  }\n}\n\nexport default AnimationControls\n","/**\n * @file Queue\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nclass Queue<T> {\n  queue: T[] = []\n  pending = false\n\n  constructor(readonly fn: Function, argList?: T[]) {\n    this.next = this.next.bind(this)\n\n    if (argList) {\n      for (let i = 0, il = argList.length; i < il; ++i) {\n        this.queue.push(argList[ i ])\n      }\n      this.next()\n    }\n  }\n\n  private run (arg: any) {\n    this.fn(arg, this.next)\n  }\n\n  private next () {\n    const arg = this.queue.shift()\n    if (arg !== undefined) {\n      this.pending = true\n      setTimeout(() => this.run(arg))\n    } else {\n      this.pending = false\n    }\n  }\n\n  push (arg: T) {\n    this.queue.push(arg)\n    if (!this.pending) this.next()\n  }\n\n  kill () {\n    this.queue.length = 0\n  }\n\n  length () {\n    return this.queue.length\n  }\n}\n\nexport default Queue\n","/**\n * @file Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log, ColormakerRegistry, ExtensionFragDepth } from '../globals'\nimport { defaults } from '../utils'\nimport Queue from '../utils/queue'\nimport Counter from '../utils/counter'\nimport Viewer from '../viewer/viewer'\nimport { BufferParameters, BufferSide, default as Buffer } from '../buffer/buffer';\nimport { ColorData, ColormakerParameters, ColorMode } from '../color/colormaker';\nimport { GenericColor } from '../types'\n\nexport interface RepresentationParameters {\n  name: string\n  lazy: boolean,\n  clipNear: number,\n  clipRadius: number,\n  clipCenter: Vector3,\n  flatShaded: boolean,\n  opacity: number,\n  depthWrite: boolean,\n  side: BufferSide,\n  wireframe: boolean,\n  colorData: ColorData,\n  colorScheme: string,\n  colorScale: string | number[],\n  colorReverse: boolean,\n  colorValue: GenericColor,\n  colorDomain: number[],\n  colorMode: ColorMode,\n  colorSpace: 'sRGB' | 'linear',\n  roughness: number,\n  metalness: number,\n  diffuse: GenericColor,\n  diffuseInterior: boolean,\n  useInteriorColor: boolean,\n  interiorColor: GenericColor,\n  interiorDarkening: number,\n  disablePicking: boolean,\n  matrix: Matrix4\n  quality: string,\n  visible: boolean,\n  color: GenericColor,\n  sphereDetail: number,\n  radialSegments: number,\n  openEnded: boolean\n  disableImpostor: boolean\n  [key: string]: any//boolean | number | undefined | Color | string | Vector3 | Matrix4 | number[]\n}\n/**\n * Representation parameter object.\n * @typedef {Object} RepresentationParameters - representation parameters\n * @property {Boolean} [lazy] - only build & update the representation when visible\n *                            otherwise defer changes until set visible again\n * @property {Integer} [clipNear] - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Integer} [clipRadius] - radius of clipping sphere\n * @property {Vector3} [clipCenter] - position of for spherical clipping\n * @property {Boolean} [flatShaded] - render flat shaded\n * @property {Float} [opacity] - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {Boolean} [depthWrite] - depth write\n * @property {String} [side] - which triangle sides to render, \"front\" front-side,\n *                            \"back\" back-side, \"double\" front- and back-side\n * @property {Boolean} [wireframe] - render as wireframe\n * @property {ColorData} [colorData] - atom or bond indexed data for coloring\n * @property {String} [colorScheme] - color scheme\n * @property {String} [colorScale] - color scale, either a string for a\n *                                 predefined scale or an array of\n *                                 colors to be used as the scale\n * @property {Boolean} [colorReverse] - reverse color scale\n * @property {Color} [colorValue] - color value\n * @property {Integer[]} [colorDomain] - scale value range\n * @property {Integer} colorDomain.0 - min value\n * @property {Integer} colorDomain.1 - max value\n * @property {String} [colorMode] - color mode, one of rgb, hsv, hsl, hsi, lab, hcl\n * @property {Float} [roughness] - how rough the material is, between 0 and 1\n * @property {Float} [metalness] - how metallic the material is, between 0 and 1\n * @property {Color} [diffuse] - diffuse color for lighting\n * @property {Boolean} [diffuseInterior] - diffuse interior, i.e. ignore normal\n * @property {Boolean} [useInteriorColor] - use interior color\n * @property {Color} [interiorColor] - interior color\n * @property {Float} [interiorDarkening] - interior darkening: 0 no darking, 1 fully darkened\n * @property {Boolean} [disablePicking] - disable picking\n */\n\n/**\n * Representation object\n * @interface\n * @param {Object} object - the object to be represented\n * @param {Viewer} viewer - a viewer object\n * @param {RepresentationParameters} [params] - representation parameters\n */\nclass Representation {\n  parameters: any\n  type: string\n  viewer: Viewer\n  tasks: Counter\n  private queue: Queue<any>\n  bufferList: Buffer[]\n\n  lazy: boolean\n  lazyProps: { build: boolean, bufferParams: BufferParameters | {}, what: {}}\n  protected name: string\n  protected clipNear: number\n  protected clipRadius: number\n  protected clipCenter: Vector3\n  protected flatShaded: boolean\n  protected opacity: number\n  protected depthWrite: boolean\n  protected side: BufferSide\n  protected wireframe: boolean\n  protected colorData: ColorData\n  protected colorScheme: string\n  protected colorScale: string | string[]\n  protected colorReverse: boolean\n  protected colorValue: number\n  protected colorDomain: number[]\n  protected colorMode: ColorMode\n  protected roughness: number\n  protected metalness: number\n  protected diffuse: GenericColor\n  protected diffuseInterior?: boolean\n  protected useInteriorColor?: boolean\n  protected interiorColor: GenericColor\n  protected interiorDarkening: number\n  protected disablePicking: boolean\n  protected sphereDetail: number\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  protected disposed: boolean\n\n  protected matrix: Matrix4\n\n  private quality: string\n  visible: boolean\n\n  protected manualAttach: ()=> any\n\n  protected toBePrepared: boolean\n\n  [key: string]: any\n\n  constructor (object: any, viewer: Viewer, params: Partial<RepresentationParameters>) {\n    // eslint-disable-next-line no-unused-vars\n    // const p = params || {}\n\n    this.type = ''\n\n    this.parameters = {\n\n      lazy: {\n        type: 'boolean'\n      },\n\n      clipNear: {\n        type: 'range', step: 1, max: 100, min: 0, buffer: true\n      },\n      clipRadius: {\n        type: 'number', precision: 1, max: 1000, min: 0, buffer: true\n      },\n      clipCenter: {\n        type: 'vector3', precision: 1, buffer: true\n      },\n      flatShaded: {\n        type: 'boolean', buffer: true\n      },\n      opacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      depthWrite: {\n        type: 'boolean', buffer: true\n      },\n      side: {\n        type: 'select',\n        buffer: true,\n        options: { front: 'front', back: 'back', double: 'double' }\n      },\n      wireframe: {\n        type: 'boolean', buffer: true\n      },\n\n      colorData: {\n        type: 'hidden',\n        update: 'color',\n      },\n\n      colorScheme: {\n        type: 'select',\n        update: 'color',\n        options: {}\n      },\n      colorScale: {\n        type: 'select',\n        update: 'color',\n        options: ColormakerRegistry.getScales()\n      },\n      colorReverse: {\n        type: 'boolean', update: 'color'\n      },\n      colorValue: {\n        type: 'color', update: 'color'\n      },\n      colorDomain: {\n        type: 'hidden', update: 'color'\n      },\n      colorMode: {\n        type: 'select',\n        update: 'color',\n        options: ColormakerRegistry.getModes()\n      },\n\n      roughness: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      metalness: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      diffuse: {\n        type: 'color', buffer: true\n      },\n\n      diffuseInterior: {\n        type: 'boolean', buffer: true\n      },\n      useInteriorColor: {\n        type: 'boolean', buffer: true\n      },\n      interiorColor: {\n        type: 'color', buffer: true\n      },\n      interiorDarkening: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n\n      matrix: {\n        type: 'hidden', buffer: true\n      },\n\n      disablePicking: {\n        type: 'boolean', rebuild: true\n      }\n\n    }\n\n    /**\n     * @type {Viewer}\n     */\n    this.viewer = viewer\n\n    /**\n     * Counter that keeps track of tasks related to the creation of\n     * the representation, including surface calculations.\n     * @type {Counter}\n     */\n    this.tasks = new Counter()\n\n    /**\n     * @type {Queue}\n     * @private\n     */\n    this.queue = new Queue(this.make.bind(this))\n\n    /**\n     * @type {Array}\n     * @private\n     */\n    this.bufferList = []\n\n    if (this.parameters.colorScheme) {\n      this.parameters.colorScheme.options = ColormakerRegistry.getSchemes()\n    }\n\n    this.toBePrepared = false\n  }\n\n  init (params: Partial<RepresentationParameters>) {\n    const p = params || {}\n\n    this.clipNear = defaults(p.clipNear, 0)\n    this.clipRadius = defaults(p.clipRadius, 0)\n    this.clipCenter = defaults(p.clipCenter, new Vector3())\n    this.flatShaded = defaults(p.flatShaded, false)\n    this.side = defaults(p.side, 'double')\n    this.opacity = defaults(p.opacity, 1.0)\n    this.depthWrite = defaults(p.depthWrite, true)\n    this.wireframe = defaults(p.wireframe, false)\n\n    this.setColor(p.color, p)\n\n    this.colorData = defaults(p.colorData, undefined)\n    this.colorScheme = defaults(p.colorScheme, 'uniform')\n    this.colorScale = defaults(p.colorScale, '')\n    this.colorReverse = defaults(p.colorReverse, false)\n    this.colorValue = defaults(p.colorValue, 0x909090)\n    this.colorDomain = defaults(p.colorDomain, undefined)\n    this.colorMode = defaults(p.colorMode, 'hcl')\n\n    this.visible = defaults(p.visible, true)\n    this.quality = defaults(p.quality, undefined)\n\n    this.roughness = defaults(p.roughness, 0.4)\n    this.metalness = defaults(p.metalness, 0.0)\n    this.diffuse = defaults(p.diffuse, 0xffffff)\n\n    this.diffuseInterior = defaults(p.diffuseInterior, false)\n    this.useInteriorColor = defaults(p.useInteriorColor, false)\n    this.interiorColor = defaults(p.interiorColor, 0x222222)\n    this.interiorDarkening = defaults(p.interiorDarkening, 0)\n\n    this.lazy = defaults(p.lazy, false)\n    this.lazyProps = {\n      build: false,\n      bufferParams: {},\n      what: {}\n    }\n\n    this.matrix = defaults(p.matrix, new Matrix4())\n\n    this.disablePicking = defaults(p.disablePicking, false)\n\n    // handle common parameters when applicable\n\n    const tp = this.parameters\n\n    if (tp.sphereDetail === true) {\n      tp.sphereDetail = {\n        type: 'integer', max: 3, min: 0, rebuild: 'impostor'\n      }\n    }\n    if (tp.radialSegments === true) {\n      tp.radialSegments = {\n        type: 'integer', max: 25, min: 5, rebuild: 'impostor'\n      }\n    }\n    if (tp.openEnded === true) {\n      tp.openEnded = {\n        type: 'boolean', rebuild: 'impostor', buffer: true\n      }\n    }\n    if (tp.disableImpostor === true) {\n      tp.disableImpostor = {\n        type: 'boolean', rebuild: true\n      }\n    }\n\n    if (p.quality === 'low') {\n      if (tp.sphereDetail) this.sphereDetail = 0\n      if (tp.radialSegments) this.radialSegments = 5\n    } else if (p.quality === 'medium') {\n      if (tp.sphereDetail) this.sphereDetail = 1\n      if (tp.radialSegments) this.radialSegments = 10\n    } else if (p.quality === 'high') {\n      if (tp.sphereDetail) this.sphereDetail = 2\n      if (tp.radialSegments) this.radialSegments = 20\n    } else {\n      if (tp.sphereDetail) {\n        this.sphereDetail = defaults(p.sphereDetail, 1)\n      }\n      if (tp.radialSegments) {\n        this.radialSegments = defaults(p.radialSegments, 10)\n      }\n    }\n\n    if (tp.openEnded) {\n      this.openEnded = defaults(p.openEnded, true)\n    }\n\n    if (tp.disableImpostor) {\n      this.disableImpostor = defaults(p.disableImpostor, false)\n    }\n\n  }\n\n  getColorParams (p?: {[k: string]: any}): { scheme: string, [k: string]: any } & ColormakerParameters {\n    return Object.assign({\n\n      data: this.colorData,\n      scheme: this.colorScheme,\n      scale: this.colorScale,\n      reverse: this.colorReverse,\n      value: this.colorValue,\n      domain: this.colorDomain,\n      mode: this.colorMode,\n      colorSpace: this.colorSpace,\n\n    }, p)\n  }\n\n  getBufferParams (p: {[k: string]: any} = {}) {\n    return Object.assign({\n\n      clipNear: this.clipNear,\n      clipRadius: this.clipRadius,\n      clipCenter: this.clipCenter,\n      flatShaded: this.flatShaded,\n      opacity: this.opacity,\n      depthWrite: this.depthWrite,\n      side: this.side,\n      wireframe: this.wireframe,\n\n      roughness: this.roughness,\n      metalness: this.metalness,\n      diffuse: this.diffuse,\n\n      diffuseInterior: this.diffuseInterior,\n      useInteriorColor: this.useInteriorColor,\n      interiorColor: this.interiorColor,\n      interiorDarkening: this.interiorDarkening,\n\n      matrix: this.matrix,\n\n      disablePicking: this.disablePicking\n\n    }, p)\n  }\n\n  setColor (value: number | string | Color | undefined , p?: Partial<RepresentationParameters>) {\n    const types = Object.keys(ColormakerRegistry.getSchemes())\n\n    if (typeof value === 'string' && types.includes(value.toLowerCase())) {\n      if (p) {\n        p.colorScheme = value\n      } else {\n        this.setParameters({ colorScheme: value })\n      }\n    } else if (value !== undefined) {\n      let val = new Color(value as string).getHex() //TODO\n      if (p) {\n        p.colorScheme = 'uniform'\n        p.colorValue = val\n      } else {\n        this.setParameters({\n          colorScheme: 'uniform', colorValue: val\n        })\n      }\n    }\n\n    return this\n  }\n\n  // TODO\n  prepare (cb: ()=> void) {\n\n  }\n\n  create () {\n    // this.bufferList.length = 0;\n  }\n\n  update (what?: any) {\n    this.build()\n  }\n\n  build (updateWhat?: {[k: string]: boolean}) {\n    if (this.lazy && (!this.visible || !this.opacity)) {\n      this.lazyProps.build = true\n      return\n    }\n\n    if (!this.toBePrepared) {\n      this.tasks.increment()\n      this.make()\n      return\n    }\n\n    // don't let tasks accumulate\n    if (this.queue.length() > 0) {\n      this.tasks.change(1 - this.queue.length())\n      this.queue.kill()\n    } else {\n      this.tasks.increment()\n    }\n\n    this.queue.push(updateWhat || false)\n  }\n\n  make (updateWhat?: boolean, callback?: () => void) {\n    if (Debug) Log.time('Representation.make ' + this.type)\n\n    const _make = () => {\n      if (updateWhat) {\n        this.update(updateWhat)\n        this.viewer.requestRender()\n        this.tasks.decrement()\n        if (callback) callback()\n      } else {\n        this.clear()\n        this.create()\n        if (!this.manualAttach && !this.disposed) {\n          if (Debug) Log.time('Representation.attach ' + this.type)\n          this.attach(() => {\n            if (Debug) Log.timeEnd('Representation.attach ' + this.type)\n            this.tasks.decrement()\n            if (callback) callback()\n          })\n        }\n      }\n\n      if (Debug) Log.timeEnd('Representation.make ' + this.type)\n    }\n\n    if (this.toBePrepared) {\n      this.prepare(_make)\n    } else {\n      _make()\n    }\n  }\n\n  attach (callback: () => void) {\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  /**\n   * Set the visibility of the representation\n   * @param {Boolean} value - visibility flag\n   * @param {Boolean} [noRenderRequest] - whether or not to request a re-render from the viewer\n   * @return {Representation} this object\n   */\n  setVisibility (value: boolean, noRenderRequest?: boolean): Representation {\n    this.visible = value\n\n    if (this.visible && this.opacity) {\n      const lazyProps = this.lazyProps\n      const bufferParams = lazyProps.bufferParams\n      const what = lazyProps.what\n\n      if (lazyProps.build) {\n        lazyProps.build = false\n        this.build()\n        return this\n      } else if (Object.keys(bufferParams).length || Object.keys(what).length) {\n        lazyProps.bufferParams = {}\n        lazyProps.what = {}\n        this.updateParameters(bufferParams, what)\n      }\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setVisibility(value)\n    })\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n\n  /**\n   * Set the visibility of the representation\n   * @param {RepresentationParameters} params - parameters object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {Representation} this object\n   */\n  setParameters (params: Partial<RepresentationParameters>, what:{[propName: string]: any} = {}, rebuild = false) {\n    const p = params || {}\n    const tp = this.parameters\n    const bufferParams: BufferParameters = <any>{}\n\n    if (!this.opacity && p.opacity !== undefined) {\n      if (this.lazyProps.build) {\n        this.lazyProps.build = false\n        rebuild = true\n      } else {\n        Object.assign(bufferParams, this.lazyProps.bufferParams)\n        Object.assign(what, this.lazyProps.what)\n        this.lazyProps.bufferParams = {}\n        this.lazyProps.what = {}\n      }\n    }\n\n    this.setColor(p.color, p)\n\n    for (let name in p) {\n      if (p[ name ] === undefined) continue\n      if (tp[ name ] == undefined ) continue // Skip nulls as well as undefined\n\n      if (tp[ name ].int) p[ name ] = parseInt(p[ name ] as string)\n      if (tp[ name ].float) p[ name ] = parseFloat(p[ name ] as string)\n\n      // no value change\n      if (p[ name ] === this[ name ] && (\n        !p[ name ].equals || p[ name ].equals(this[ name ])\n      )) continue\n\n      if (this[ name ] && this[ name ].copy && p[ name ].copy) {\n        this[ name ].copy(p[ name ])\n      } else if (this[ name ] && this[ name ].set) {\n        this[ name ].set(p[ name ])\n      } else {\n        this[ name ] = p[ name ]\n      }\n\n      // buffer param\n      if (tp[ name ].buffer) {\n        if (tp[ name ].buffer === true) {\n          (bufferParams[ name as keyof BufferParameters ] as any) = p[ name ]\n        } else {\n          let key: (keyof BufferParameters) = tp[ name ].buffer;\n          (bufferParams[ key ] as any) = p[ name ]\n        }\n      }\n\n      // mark for update\n      if (tp[ name ].update) {\n        what[ tp[ name ].update ] = true\n      }\n\n      // mark for rebuild\n      if (tp[ name ].rebuild &&\n          !(tp[ name ].rebuild === 'impostor' &&\n            ExtensionFragDepth && !this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    //\n\n    if (rebuild) {\n      this.build()\n    } else {\n      this.updateParameters(bufferParams, what)\n    }\n\n    return this\n  }\n\n  updateParameters (bufferParams: BufferParameters | {} = {}, what?: any) {\n    if (this.lazy && (!this.visible || !this.opacity) && bufferParams.hasOwnProperty('opacity') === false) {\n      Object.assign(this.lazyProps.bufferParams, bufferParams)\n      Object.assign(this.lazyProps.what, what)\n      return\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setParameters(bufferParams)\n    })\n\n    if (Object.keys(what).length) {\n      this.update(what) // update buffer attribute\n    }\n\n    this.viewer.requestRender()\n  }\n\n  getParameters () {\n    const params: Partial<RepresentationParameters> = {\n      lazy: this.lazy,\n      visible: this.visible,\n      quality: this.quality\n    }\n\n    Object.keys(this.parameters).forEach(name => {\n      if (this.parameters[ name ] !== null) {\n        params[ name ] = this[ name ]\n      }\n    })\n\n    return params\n  }\n\n  clear () {\n    this.bufferList.forEach(buffer => {\n      this.viewer.remove(buffer)\n      buffer.dispose()\n    })\n    this.bufferList.length = 0\n\n    this.viewer.requestRender()\n  }\n\n  dispose () {\n    this.disposed = true\n    this.queue.kill()\n    this.tasks.dispose()\n    this.clear()\n  }\n}\n\nexport default Representation\n","/**\n * @file Worker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, Debug, WorkerRegistry } from '../globals'\n\nexport default class _Worker {\n\n  pending = 0\n  postCount = 0\n  onmessageDict: { [k: number]: Function|undefined } = {}\n  onerrorDict: { [k: number]: Function|undefined } = {}\n\n  name: string\n  blobUrl: string\n  worker: Worker\n\n  constructor (name: string) {\n\n    this.name = name\n    this.blobUrl = window.URL.createObjectURL(WorkerRegistry.get(name))\n    this.worker = new Worker(this.blobUrl)\n\n    WorkerRegistry.activeWorkerCount += 1\n\n    this.worker.onmessage = (event: any) => {\n      this.pending -= 1\n      const postId = event.data.__postId\n\n      if (Debug) Log.timeEnd('Worker.postMessage ' + name + ' #' + postId)\n\n      const onmessage = this.onmessageDict[ postId ]\n      if (onmessage) {\n        onmessage.call(this.worker, event)\n      } else {\n        // Log.debug('No onmessage', postId, name)\n      }\n\n      delete this.onmessageDict[ postId ]\n      delete this.onerrorDict[ postId ]\n    }\n\n    this.worker.onerror = (event: any) => {\n      this.pending -= 1\n      if (event.data) {\n        const postId = event.data.__postId\n\n        const onerror = this.onerrorDict[ postId ]\n        if (onerror) {\n          onerror.call(this.worker, event)\n        } else {\n          Log.error('Worker.onerror', postId, name, event)\n        }\n\n        delete this.onmessageDict[ postId ]\n        delete this.onerrorDict[ postId ]\n      } else {\n        Log.error('Worker.onerror', name, event)\n      }\n    }\n  }\n\n  post (aMessage: any = {}, transferList?: any, onmessage?: Function, onerror?: Function) {\n    this.onmessageDict[ this.postCount ] = onmessage\n    this.onerrorDict[ this.postCount ] = onerror\n\n    aMessage.__name = this.name\n    aMessage.__postId = this.postCount\n    aMessage.__debug = Debug\n\n    if (Debug) Log.time(`Worker.postMessage ${this.name} #${this.postCount}`)\n\n    try {\n      this.worker.postMessage(aMessage, transferList)\n    } catch (error) {\n      Log.error('worker.post:', error)\n      this.worker.postMessage(aMessage)\n    }\n\n    this.pending += 1\n    this.postCount += 1\n\n    return this\n  }\n\n  terminate () {\n    if (this.worker) {\n      this.worker.terminate()\n      window.URL.revokeObjectURL(this.blobUrl)\n      WorkerRegistry.activeWorkerCount -= 1\n    } else {\n      Log.log('no worker to terminate')\n    }\n  }\n}\n","/**\n * @file Worker Pool\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Worker from './worker'\n\nclass WorkerPool {\n  maxCount: number\n  pool: Worker[] = []\n  count = 0\n  name: string\n\n  constructor (name: string, maxCount = 2) {\n    this.maxCount = Math.min(8, maxCount)\n    this.name = name\n  }\n\n  post (aMessage: any = {}, transferList?: any, onmessage?: Function, onerror?: Function) {\n    const worker = this.getNextWorker()\n    if (worker) {\n      worker.post(aMessage, transferList, onmessage, onerror)\n    } else {\n      console.error('unable to get worker from pool')\n    }\n\n    return this\n  }\n\n  terminate () {\n    this.pool.forEach(function (worker) {\n      worker.terminate()\n    })\n  }\n\n  getNextWorker () {\n    let nextWorker\n    let minPending = Infinity\n\n    for (let i = 0; i < this.maxCount; ++i) {\n      if (i >= this.count) {\n        nextWorker = new Worker(this.name)\n        this.pool.push(nextWorker)\n        this.count += 1\n        break\n      }\n\n      const worker = this.pool[ i ]\n\n      if (worker.pending === 0) {\n        nextWorker = worker\n        break\n      } else if (worker.pending < minPending) {\n        minPending = worker.pending\n        nextWorker = worker\n      }\n    }\n\n    return nextWorker\n  }\n}\n\nWorkerPool.prototype.constructor = WorkerPool\n\nexport default WorkerPool\n","/**\n * @file Vector Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport { EPS } from './math-constants'\n\n/**\n * Calculate the two intersection points\n * Converted to JavaScript from\n * {@link http://paulbourke.net/geometry/pointlineplane/lineline.c}\n */\nexport function lineLineIntersect (p1: Vector3, p2: Vector3, p3: Vector3, p4: Vector3) {\n  const p13 = new Vector3()\n  const p43 = new Vector3()\n  const p21 = new Vector3()\n  let d1343, d4321, d1321, d4343, d2121\n  let denom, numer\n\n  p13.x = p1.x - p3.x\n  p13.y = p1.y - p3.y\n  p13.z = p1.z - p3.z\n  p43.x = p4.x - p3.x\n  p43.y = p4.y - p3.y\n  p43.z = p4.z - p3.z\n  if (Math.abs(p43.x) < EPS && Math.abs(p43.y) < EPS && Math.abs(p43.z) < EPS) { return null }\n\n  p21.x = p2.x - p1.x\n  p21.y = p2.y - p1.y\n  p21.z = p2.z - p1.z\n  if (Math.abs(p21.x) < EPS && Math.abs(p21.y) < EPS && Math.abs(p21.z) < EPS) { return null }\n\n  d1343 = p13.x * p43.x + p13.y * p43.y + p13.z * p43.z\n  d4321 = p43.x * p21.x + p43.y * p21.y + p43.z * p21.z\n  d1321 = p13.x * p21.x + p13.y * p21.y + p13.z * p21.z\n  d4343 = p43.x * p43.x + p43.y * p43.y + p43.z * p43.z\n  d2121 = p21.x * p21.x + p21.y * p21.y + p21.z * p21.z\n\n  denom = d2121 * d4343 - d4321 * d4321\n  if (Math.abs(denom) < EPS) { return null }\n  numer = d1343 * d4321 - d1321 * d4343\n\n  const mua = numer / denom\n  const mub = (d1343 + d4321 * mua) / d4343\n\n  const pa = new Vector3(\n    p1.x + mua * p21.x,\n    p1.y + mua * p21.y,\n    p1.z + mua * p21.z\n  )\n  const pb = new Vector3(\n    p3.x + mub * p43.x,\n    p3.y + mub * p43.y,\n    p3.z + mub * p43.z\n  )\n\n  return [ pa, pb ]\n}\n\nexport function calculateMeanVector3 (array: NumberArray) {\n  const n = array.length\n  const m = n / 3\n\n  let x = 0\n  let y = 0\n  let z = 0\n\n  for (let i = 0; i < n; i += 3) {\n    x += array[ i + 0 ]\n    y += array[ i + 1 ]\n    z += array[ i + 2 ]\n  }\n\n  return new Vector3(x / m, y / m, z / m)\n}\n\nexport function isPointOnSegment (p: Vector3, l1: Vector3, l2: Vector3) {\n  const len = l1.distanceTo(l2)\n\n  return p.distanceTo(l1) <= len && p.distanceTo(l2) <= len\n}\n\nexport function projectPointOnVector (point: Vector3, vector: Vector3, origin?: Vector3) {\n  if (origin) {\n    point.sub(origin).projectOnVector(vector).add(origin)\n  } else {\n    point.projectOnVector(vector)\n  }\n\n  return point\n}\n\nexport function computeBoundingBox (array: NumberArray) {\n  let minX = +Infinity\n  let minY = +Infinity\n  let minZ = +Infinity\n  let maxX = -Infinity\n  let maxY = -Infinity\n  let maxZ = -Infinity\n  for (let i = 0, l = array.length; i < l; i += 3) {\n    const x = array[ i ]\n    const y = array[ i + 1 ]\n    const z = array[ i + 2 ]\n    if (x < minX) minX = x\n    if (y < minY) minY = y\n    if (z < minZ) minZ = z\n    if (x > maxX) maxX = x\n    if (y > maxY) maxY = y\n    if (z > maxZ) maxZ = z\n  }\n  return [\n    v3new([ minX, minY, minZ ]),\n    v3new([ maxX, maxY, maxZ ])\n  ]\n}\n(computeBoundingBox as any).__deps = [ v3new ]\n\nexport function applyMatrix4toVector3array (m: Float32Array, a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    a[ i ] = m[ 0 ] * x + m[ 4 ] * y + m[ 8 ] * z + m[ 12 ]\n    a[ i + 1 ] = m[ 1 ] * x + m[ 5 ] * y + m[ 9 ] * z + m[ 13 ]\n    a[ i + 2 ] = m[ 2 ] * x + m[ 6 ] * y + m[ 10 ] * z + m[ 14 ]\n  }\n}\n\nexport function applyMatrix3toVector3array (m: Float32Array, a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    a[ i ] = m[ 0 ] * x + m[ 3 ] * y + m[ 6 ] * z\n    a[ i + 1 ] = m[ 1 ] * x + m[ 4 ] * y + m[ 7 ] * z\n    a[ i + 2 ] = m[ 2 ] * x + m[ 5 ] * y + m[ 8 ] * z\n  }\n}\n\nexport function normalizeVector3array (a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    const len2 = x * x + y * y + z * z\n    if (len2 > 0) {             // avoid divide by zero\n      const s = 1 / Math.sqrt(len2)\n      a[ i ] = x * s\n      a[ i + 1 ] = y * s\n      a[ i + 2 ] = z * s\n    }\n    // else leave as all zeros\n  }\n}\n\nexport function v3new (array?: NumberArray) {\n  return new Float32Array(array as any || 3)  // TODO\n}\n\nexport function v3cross (out: Float32Array, a: Float32Array, b: Float32Array) {\n  const ax = a[0]\n  const ay = a[1]\n  const az = a[2]\n  const bx = b[0]\n  const by = b[1]\n  const bz = b[2]\n  out[0] = ay * bz - az * by\n  out[1] = az * bx - ax * bz\n  out[2] = ax * by - ay * bx\n}\n\nexport function v3dot (a: Float32Array, b: Float32Array) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]\n}\n\nexport function v3sub (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] - b[0]\n  out[1] = a[1] - b[1]\n  out[2] = a[2] - b[2]\n}\n\nexport function v3add (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] + b[0]\n  out[1] = a[1] + b[1]\n  out[2] = a[2] + b[2]\n}\n\nexport function v3fromArray (out: Float32Array, array: Float32Array, offset = 0) {\n  out[0] = array[offset]\n  out[1] = array[offset + 1]\n  out[2] = array[offset + 2]\n}\n\nexport function v3toArray (input: Float32Array, array: Float32Array, offset = 0) {\n  array[offset] = input[0]\n  array[offset + 1] = input[1]\n  array[offset + 2] = input[2]\n}\n\nexport function v3forEach (array: Float32Array, fn: (i: Float32Array, j: Float32Array, k: Float32Array) => void, b: Float32Array) {\n  const a = v3new()\n  for (let i = 0, n = array.length; i < n; i += 3) {\n    v3fromArray(a, array, i)\n    fn(a, a, b)\n    v3toArray(a, array, i)\n  }\n}\n(v3forEach as any).__deps = [ v3new, v3fromArray, v3toArray ]\n\nexport function v3length2 (a: Float32Array) {\n  return a[0] * a[0] + a[1] * a[1] + a[2] * a[2]\n}\n\nexport function v3length (a: Float32Array) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2])\n}\n\nexport function v3divide (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] / b[0]\n  out[1] = a[1] / b[1]\n  out[2] = a[2] / b[2]\n}\n\nexport function v3multiply (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] * b[0]\n  out[1] = a[1] * b[1]\n  out[2] = a[2] * b[2]\n}\n\nexport function v3divideScalar (out: Float32Array, a: Float32Array, s: number) {\n  v3multiplyScalar(out, a, 1 / s)\n}\n(v3divideScalar as any).__deps = [ v3multiplyScalar ]\n\nexport function v3multiplyScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] * s\n  out[1] = a[1] * s\n  out[2] = a[2] * s\n}\n\nexport function v3normalize (out: Float32Array, a: Float32Array) {\n  const length2 = v3length2(a)\n  if (length2 == 0) {\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n  } else {\n    v3multiplyScalar(out, a, 1 / Math.sqrt(length2))\n  }\n}\n(v3normalize as any).__deps = [ v3multiplyScalar, v3length2 ]\n\nexport function v3subScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] - s\n  out[1] = a[1] - s\n  out[2] = a[2] - s\n}\n\nexport function v3addScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] + s\n  out[1] = a[1] + s\n  out[2] = a[2] + s\n}\n\nexport function v3floor (out: Float32Array, a: Float32Array) {\n  out[0] = Math.floor(a[0])\n  out[1] = Math.floor(a[1])\n  out[2] = Math.floor(a[2])\n}\n\nexport function v3ceil (out: Float32Array, a: Float32Array) {\n  out[0] = Math.ceil(a[0])\n  out[1] = Math.ceil(a[1])\n  out[2] = Math.ceil(a[2])\n}\n\nexport function v3round (out: Float32Array, a: Float32Array) {\n  out[0] = Math.round(a[0])\n  out[1] = Math.round(a[1])\n  out[2] = Math.round(a[2])\n}\n\nexport function v3negate (out: Float32Array, a: Float32Array) {\n  out[0] = -a[0]\n  out[1] = -a[1]\n  out[2] = -a[2]\n}\n\nexport function v3angle (a: Float32Array, b: Float32Array) {\n  const ax = a[0]\n  const ay = a[1]\n  const az = a[2]\n  const bx = b[0]\n  const by = b[1]\n  const bz = b[2]\n  const cx = ay * bz - az * by\n  const cy = az * bx - ax * bz\n  const cz = ax * by - ay * bx\n  const s = Math.sqrt(cx * cx + cy * cy + cz * cz)\n  const c = ax * bx + ay * by + az * bz\n  return Math.atan2(s, c)\n}\n","/**\n * @file Dash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { WideLineBufferData } from '../buffer/wideline-buffer'\nimport {\n  calculateDirectionArray, calculateCenterArray,\n  replicateArrayEntries, replicateArray3Entries\n} from '../math/array-utils'\n\nexport function getFixedCountDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentCount: number = 9) {\n\n  const s = Math.floor(segmentCount / 2)\n  const n = data.position1.length / 3\n  const sn = s * n\n  const sn3 = sn * 3\n  const step = 1 / segmentCount\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const position1 = new Float32Array(sn3)\n  const position2 = new Float32Array(sn3)\n\n  const v = new Vector3()\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    for (let j = 0; j < s; ++j) {\n      const j3 = s * i3 + j * 3\n\n      const f1 = step * (j * 2 + 1)\n      const f2 = step * (j * 2 + 2)\n\n      position1[ j3 ] = x + v.x * f1\n      position1[ j3 + 1 ] = y + v.y * f1\n      position1[ j3 + 2 ] = z + v.z * f1\n\n      position2[ j3 ] = x + v.x * f2\n      position2[ j3 + 1 ] = y + v.y * f2\n      position2[ j3 + 2 ] = z + v.z * f2\n    }\n  }\n\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = replicateArray3Entries(data.color!, s)  // TODO\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if ((data as any).radius) {  // TODO\n    d.radius = replicateArrayEntries((data as any).radius, s)  // TODO\n  }\n\n  if (data.picking && data.picking.array) {\n    data.picking.array = replicateArrayEntries(data.picking.array, s)\n    d.picking = data.picking\n  }\n  if (data.primitiveId) {\n    d.primitiveId = replicateArrayEntries(data.primitiveId, s)\n  }\n\n  return d as T\n}\n\nexport function getFixedLengthDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentLength: number = 0.1) {\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const pos1: number[] = []\n  const pos2: number[] = []\n  const col: number[] = []\n  const rad: number[]|undefined = (data as any).radius ? [] : undefined\n  const pick: number[]|undefined = (data as any).picking ? [] : undefined\n  const id: number[]|undefined = (data as any).primitiveId ? [] : undefined\n\n  const v = new Vector3()\n  const n = data.position1.length / 3\n\n  let k = 0\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n\n    const vl = v.length()\n    const segmentCount = vl / segmentLength\n    const s = Math.floor(segmentCount / 2)\n    const step = 1 / segmentCount\n\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    for (let j = 0; j < s; ++j) {\n      const j3 = k * 3 + j * 3\n\n      const f1 = step * (j * 2 + 1)\n      const f2 = step * (j * 2 + 2)\n\n      pos1[ j3 ] = x + v.x * f1\n      pos1[ j3 + 1 ] = y + v.y * f1\n      pos1[ j3 + 2 ] = z + v.z * f1\n\n      pos2[ j3 ] = x + v.x * f2\n      pos2[ j3 + 1 ] = y + v.y * f2\n      pos2[ j3 + 2 ] = z + v.z * f2\n\n      if (data.color) {\n        col[ j3 ] = data.color[ i3 ]\n        col[ j3 + 1 ] = data.color[ i3 + 1 ]\n        col[ j3 + 2 ] = data.color[ i3 + 2 ]\n      }\n\n      if (rad) rad[ k + j ] = (data as any).radius[ i ]\n      if (pick) {\n        if ((data as any).picking.array) {\n          pick[ k + j ] = (data as any).picking.array[ i ]\n        } else {\n          pick[ k + j ] = i\n        }\n      }\n      if (id) id[ k + j ] = (data as any).primitiveId[ i ]\n    }\n\n    k += s\n  }\n\n  const position1 = new Float32Array(pos1)\n  const position2 = new Float32Array(pos2)\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = new Float32Array(col)\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if (rad) d.radius = new Float32Array(rad)\n  if (pick && data.picking) {\n    data.picking.array = new Float32Array(pick)\n    d.picking = data.picking\n  }\n  if (id) d.primitiveId = new Float32Array(id)\n\n  return d as T\n}\n\nexport function getFixedLengthWrappedDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentLength: number = 0.1) {\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const pos1: number[] = []\n  const pos2: number[] = []\n  const col: number[] = []\n  const rad: number[]|undefined = (data as any).radius ? [] : undefined\n  const pick: number[]|undefined = (data as any).picking ? [] : undefined\n  const id: number[]|undefined = (data as any).primitiveId ? [] : undefined\n\n  const v = new Vector3()\n  const n = data.position1.length / 3\n\n  let remaining = segmentLength\n  let drawing = true\n\n  let k = 0\n  let k3 = 0\n  let kprev = 0\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n    const vl = v.length()\n\n    if (drawing) {\n      pos1[ k3 ] = x\n      pos1[ k3 + 1 ] = y\n      pos1[ k3 + 2 ] = z\n    }\n\n    let dist = remaining\n    const inv = 1 / vl\n    while (dist < vl) {\n      const a = drawing ? pos2 : pos1\n      a[ k3 ] = x + v.x * dist * inv\n      a[ k3 + 1 ] = y +         v.y * dist * inv\n      a[ k3 + 2 ] = z + v.z * dist * inv\n      if (drawing) {\n        k++\n        k3 = k * 3\n      }\n      drawing = !drawing\n      remaining = segmentLength\n      dist += segmentLength\n    }\n\n    if (drawing) {\n      pos2[ k3 ] = data.position2[ i3 ]\n      pos2[ k3 + 1 ] = data.position2[ i3 + 1 ]\n      pos2[ k3 + 2 ] = data.position2[ i3 + 2 ]\n      k++\n      k3 = k * 3\n    }\n\n    remaining = dist - vl\n\n    for (let j = kprev; j < k ; j++){\n      if (data.color) {\n        const j3 = j * 3\n        col[ j3 ] = data.color[ i3 ]\n        col[ j3 + 1 ] = data.color[ i3 + 1 ]\n        col[ j3 + 2 ] = data.color[ i3 + 2 ]\n      }\n\n      if (rad) rad[ j ] = (data as any).radius[ i ]\n      if (pick) {\n        if ((data as any).picking.array) {\n          pick[ j ] = (data as any).picking.array[ i ]\n        } else {\n          pick[ j ] = i\n        }\n      }\n      if (id) id[ j ] = (data as any).primitiveId[ i ]\n    }\n\n    kprev = k\n\n  }\n\n  if (!drawing && n > 0) {\n    const k3 = k * 3\n    pos2[ k3 ] = data.position2[ 3 * n - 3 ]\n    pos2[ k3 + 1 ] = data.position2[ 3 * n - 2 ]\n    pos2[ k3 + 1 ] = data.position2[ 3 * n - 1 ]\n  }\n\n  const position1 = new Float32Array(pos1)\n  const position2 = new Float32Array(pos2)\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = new Float32Array(col)\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if (rad) d.radius = new Float32Array(rad)\n  if (pick && data.picking) {\n    data.picking.array = new Float32Array(pick)\n    d.picking = data.picking\n  }\n  if (id) d.primitiveId = new Float32Array(id)\n\n  return d as T\n}\n","/**\n * @file Primitive\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color, Box3 } from 'three'\n\nimport { BufferRegistry, PickerRegistry } from '../globals'\nimport Shape from './shape'\nimport { getFixedLengthDashData } from './dash'\n\nfunction addElement (elm: any, array: any[]) {\n  if (elm.toArray !== undefined) {\n    elm = elm.toArray()\n  } else if (elm.x !== undefined) {\n    elm = [ elm.x, elm.y, elm.z ]\n  } else if (elm.r !== undefined) {\n    elm = [ elm.r, elm.g, elm.b ]\n  }\n  array.push.apply(array, elm)\n}\n\nconst tmpVec = new Vector3()\n\nexport type PrimitiveFields = { [k: string]: string }\n\n/**\n * Base class for geometry primitives\n * @interface\n */\nexport abstract class Primitive {\n  static type = ''\n  static fields: PrimitiveFields = {}\n\n  static get Picker () { return PickerRegistry.get(this.type) }\n  static get Buffer () { return BufferRegistry.get(this.type) }\n\n  static getShapeKey (name: string) {\n    return this.type + name[0].toUpperCase() + name.substr(1)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {}\n\n  static valueToShape (shape: Shape, name: string, value: any) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 'v3':\n      case 'c':\n        addElement(value, data)\n        break\n      default:\n        data.push(value)\n    }\n  }\n\n  static objectToShape (shape: Shape, data: any) {\n    Object.keys(this.fields).forEach(name => {\n      this.valueToShape(shape, name, data[name])\n    })\n    this.valueToShape(shape, 'name', data.name)\n    this.expandBoundingBox(shape.boundingBox, data)\n  }\n\n  static valueFromShape (shape: Shape, pid: number, name: string) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 'v3':\n        return new Vector3().fromArray(data, 3 * pid)\n      case 'c':\n        return new Color().fromArray(data, 3 * pid)\n      default:\n        return data[pid]\n    }\n  }\n\n  static objectFromShape (shape: Shape, pid: number) {\n    let name = this.valueFromShape(shape, pid, 'name')\n    if (name === undefined) {\n      name = `${this.type}: ${pid} (${shape.name})`\n    }\n    const o: any = { shape, name }\n\n    Object.keys(this.fields).forEach(name => {\n      o[name] = this.valueFromShape(shape, pid, name)\n    })\n\n    return o\n  }\n\n  static arrayFromShape (shape: Shape, name: string) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 's':\n        return data\n      default:\n        return new Float32Array(data)\n    }\n  }\n\n  static dataFromShape (shape: Shape) {\n    const data: any = {}\n\n    if (this.Picker) {\n      data.picking = new this.Picker(shape)\n    }\n\n    Object.keys(this.fields).forEach(name => {\n      data[name] = this.arrayFromShape(shape, name)\n    })\n\n    return data\n  }\n\n  static bufferFromShape (shape: Shape, params: any) {\n    return new this.Buffer(this.dataFromShape(shape), params)\n  }\n}\n\n/**\n * Sphere geometry primitive\n */\nexport class SpherePrimitive extends Primitive {\n  static type = 'sphere'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    radius: 'f'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Box geometry primitive\n */\nexport class BoxPrimitive extends Primitive {\n  static type = 'box'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    size: 'f',\n    heightAxis: 'v3',\n    depthAxis: 'v3'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Octahedron geometry primitive\n */\nexport class OctahedronPrimitive extends BoxPrimitive {\n  static type = 'octahedron'\n}\n\n/**\n * Tetrahedron geometry primitive\n */\nexport class TetrahedronPrimitive extends BoxPrimitive {\n  static type = 'tetrahedron'\n}\n\n/**\n * Icosahedron geometry primitive\n */\nexport class IcosahedronPrimitive extends BoxPrimitive {\n  static type = 'icosahedron'\n}\n\n/**\n * Cylinder geometry primitive\n */\nexport class CylinderPrimitive extends Primitive {\n  static type = 'cylinder'\n\n  static fields = {\n    position1: 'v3',\n    position2: 'v3',\n    color: 'c',\n    radius: 'f'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    const p1 = this.valueFromShape(shape, pid, 'position1')\n    const p2 = this.valueFromShape(shape, pid, 'position2')\n    return p1.add(p2).multiplyScalar(0.5)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position1))\n    box.expandByPoint(tmpVec.fromArray(data.position2))\n  }\n\n  static bufferFromShape (shape: Shape, params: any = {}) {\n    let data = this.dataFromShape(shape)\n    if (this.type === 'cylinder' && params.dashedCylinder) {\n      data = getFixedLengthDashData(data)\n    }\n    return new this.Buffer(data, params)\n  }\n}\n\n/**\n * Arrow geometry primitive\n */\nexport class ArrowPrimitive extends CylinderPrimitive {\n  static type = 'arrow'\n}\n\n/**\n * Cone geometry primitive\n */\nexport class ConePrimitive extends CylinderPrimitive {\n  static type = 'cone'\n}\n\n/**\n * Ellipsoid geometry primitive\n */\nexport class EllipsoidPrimitive extends SpherePrimitive {\n  static type = 'ellipsoid'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    radius: 'f',\n    majorAxis: 'v3',\n    minorAxis: 'v3'\n  }\n}\n\n/**\n * Torus geometry primitive\n */\nexport class TorusPrimitive extends EllipsoidPrimitive {\n  static type = 'torus'\n}\n\n/**\n * Text geometry primitive\n */\nexport class TextPrimitive extends Primitive {\n  static type = 'text'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    size: 'f',\n    text: 's'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Point primitive\n */\nexport class PointPrimitive extends Primitive {\n  static type = 'point'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Wideline geometry primitive\n */\nexport class WidelinePrimitive extends Primitive {\n  static type = 'wideline'\n\n  static fields = {\n    position1: 'v3',\n    position2: 'v3',\n    color: 'c'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    const p1 = this.valueFromShape(shape, pid, 'position1')\n    const p2 = this.valueFromShape(shape, pid, 'position2')\n    return p1.add(p2).multiplyScalar(0.5)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position1))\n    box.expandByPoint(tmpVec.fromArray(data.position2))\n  }\n}\n","/**\n * @file Spatial Hash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Box3 } from 'three'\n\nexport type Positions = {\n  x: ArrayLike<number>,\n  y: ArrayLike<number>,\n  z: ArrayLike<number>,\n  count?:number\n}\n\nfunction createBoundingBox(positions: Positions) {\n    const { x, y, z } = positions\n    const boundingBox = new Box3()\n    const count = x.length\n    const { min, max } = boundingBox\n\n    for (let i = 0; i < count; i++) {\n        min.x = Math.min(x[i], min.x)\n        min.y = Math.min(y[i], min.y)\n        min.z = Math.min(z[i], min.z)\n        max.x = Math.max(x[i], max.x)\n        max.y = Math.max(y[i], max.y)\n        max.z = Math.max(z[i], max.z)\n    }\n\n    return boundingBox\n}\n\nexport default class SpatialHash {\n  exp = 3\n\n  minX: number\n  minY: number\n  minZ: number\n\n  boundX: number\n  boundY: number\n  boundZ: number\n\n  grid: Uint32Array\n  bucketCount: Uint16Array\n  bucketOffset: Uint32Array\n  bucketArray: Int32Array\n\n  xArray: ArrayLike<number>\n  yArray: ArrayLike<number>\n  zArray: ArrayLike<number>\n\n  constructor(positions: Positions, boundingBox?: Box3) {\n    const bb = boundingBox || createBoundingBox(positions)\n    this.minX = bb.min.x\n    this.minY = bb.min.y\n    this.minZ = bb.min.z\n    this.boundX = ((bb.max.x - this.minX) >> this.exp) + 1\n    this.boundY = ((bb.max.y - this.minY) >> this.exp) + 1\n    this.boundZ = ((bb.max.z - this.minZ) >> this.exp) + 1\n\n    const n = this.boundX * this.boundY * this.boundZ\n    const an = (positions.count !== undefined) ? positions.count : positions.x.length\n\n    const xArray = positions.x\n    const yArray = positions.y\n    const zArray = positions.z\n\n    let count = 0\n    const grid = new Uint32Array(n)\n    const bucketIndex = new Int32Array(an)\n    for (let i = 0; i < an; ++i) {\n      const x = (xArray[ i ] - this.minX) >> this.exp\n      const y = (yArray[ i ] - this.minY) >> this.exp\n      const z = (zArray[ i ] - this.minZ) >> this.exp\n      const idx = (((x * this.boundY) + y) * this.boundZ) + z\n      if ((grid[ idx ] += 1) === 1) {\n        count += 1\n      }\n      bucketIndex[ i ] = idx\n    }\n\n    const bucketCount = new Uint16Array(count)\n    for (let i = 0, j = 0; i < n; ++i) {\n      const c = grid[ i ]\n      if (c > 0) {\n        grid[ i ] = j + 1\n        bucketCount[ j ] = c\n        j += 1\n      }\n    }\n\n    const bucketOffset = new Uint32Array(count)\n    for (let i = 1; i < count; ++i) {\n      bucketOffset[ i ] += bucketOffset[ i - 1 ] + bucketCount[ i - 1 ]\n    }\n\n    const bucketFill = new Uint16Array(count)\n    const bucketArray = new Int32Array(an)\n    for (let i = 0; i < an; ++i) {\n      const bucketIdx = grid[ bucketIndex[ i ] ]\n      if (bucketIdx > 0) {\n        const k = bucketIdx - 1\n        bucketArray[ bucketOffset[ k ] + bucketFill[ k ] ] = i\n        bucketFill[ k ] += 1\n      }\n    }\n\n    this.grid = grid\n    this.bucketCount = bucketCount\n    this.bucketOffset = bucketOffset\n    this.bucketArray = bucketArray\n\n    this.xArray = xArray\n    this.yArray = yArray\n    this.zArray = zArray\n  }\n\n  within (x: number, y: number, z: number, r: number) {\n    const result: number[] = []\n\n    this.eachWithin(x, y, z, r, atomIndex => result.push(atomIndex))\n\n    return result\n  }\n\n  eachWithin (x: number, y: number, z: number, r: number, callback: (atomIndex: number, dSq: number) => void) {\n    const rSq = r * r\n\n    const loX = Math.max(0, (x - r - this.minX) >> this.exp)\n    const loY = Math.max(0, (y - r - this.minY) >> this.exp)\n    const loZ = Math.max(0, (z - r - this.minZ) >> this.exp)\n\n    const hiX = Math.min(this.boundX, ((x + r - this.minX) >> this.exp) + 1)\n    const hiY = Math.min(this.boundY, ((y + r - this.minY) >> this.exp) + 1)\n    const hiZ = Math.min(this.boundZ, ((z + r - this.minZ) >> this.exp) + 1)\n\n    for (let ix = loX; ix < hiX; ++ix) {\n      for (let iy = loY; iy < hiY; ++iy) {\n        for (let iz = loZ; iz < hiZ; ++iz) {\n          const idx = (((ix * this.boundY) + iy) * this.boundZ) + iz\n          const bucketIdx = this.grid[ idx ]\n\n          if (bucketIdx > 0) {\n            const k = bucketIdx - 1\n            const offset = this.bucketOffset[ k ]\n            const count = this.bucketCount[ k ]\n            const end = offset + count\n\n            for (let i = offset; i < end; ++i) {\n              const atomIndex = this.bucketArray[ i ]\n              const dx = this.xArray[ atomIndex ] - x\n              const dy = this.yArray[ atomIndex ] - y\n              const dz = this.zArray[ atomIndex ] - z\n\n              const dSq = dx * dx + dy * dy + dz * dz\n              if (dSq <= rSq) callback(atomIndex, dSq)\n            }\n          }\n        }\n      }\n    }\n  }\n}","/**\n * @file Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log } from '../globals'\nimport { getTypedArray, TypedArrayString } from '../utils'\n\nexport type StoreField = [string, number, TypedArrayString]\n\n/**\n * Store base class\n * @interface\n */\nexport default class Store {\n  [k: string]: any\n\n  length: number\n  count: number\n\n  _fields: StoreField[]\n  get _defaultFields(): StoreField[] { return [] }\n\n  /**\n   * @param {Integer} [size] - initial size\n   */\n  constructor (size = 0) {\n    this._fields = this._defaultFields\n    this._init(0)\n  }\n\n  /**\n   * Initialize the store\n   * @param  {Integer} size - size to initialize\n   * @return {undefined}\n   */\n  _init (size: number) {\n    this.length = size\n    this.count = 0\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const [name, size, type]: StoreField = this._fields[ i ]\n      this._initField(name, size, type)\n    }\n  }\n\n  /**\n   * Initialize a field\n   * @param  {String} name - field name\n   * @param  {Integer} size - element size\n   * @param  {String} type - data type, one of int8, int16, int32,\n   *                         uint8, uint16, uint32, float32\n   * @return {undefined}\n   */\n  _initField (name: string, size: number, type: TypedArrayString) {\n    this[ name ] = getTypedArray(type, this.length * size)\n  }\n\n  /**\n   * Add a field\n   * @param  {String} name - field name\n   * @param  {Integer} size - element size\n   * @param  {String} type - data type, one of int8, int16, int32,\n   *                         uint8, uint16, uint32, float32\n   * @return {undefined}\n   */\n  addField (name: string, size: number, type: TypedArrayString) {\n    this._fields.push([name, size, type])\n    this._initField(name, size, type)\n  }\n\n  /**\n   * Resize the store to the new size\n   * @param  {Integer} size - new size\n   * @return {undefined}\n   */\n  resize (size?: number) {\n    // Log.time( \"Store.resize\" );\n\n    this.length = Math.round(size || 0)\n    this.count = Math.min(this.count, this.length)\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const arraySize = this.length * itemSize\n      const tmpArray = new this[ name ].constructor(arraySize)\n\n      if (this[ name ].length > arraySize) {\n        tmpArray.set(this[ name ].subarray(0, arraySize))\n      } else {\n        tmpArray.set(this[ name ])\n      }\n      this[ name ] = tmpArray\n    }\n\n    // Log.timeEnd( \"Store.resize\" );\n  }\n\n  /**\n   * Resize the store to 1.5 times its current size if full\n   * @return {undefined}\n   */\n  growIfFull () {\n    if (this.count >= this.length) {\n      const size = Math.round(this.length * 1.5)\n      this.resize(Math.max(256, size))\n    }\n  }\n\n  /**\n   * Copy data from one store to another\n   * @param  {Store} other - store to copy from\n   * @param  {Integer} thisOffset - offset to start copying to\n   * @param  {Integer} otherOffset - offset to start copying from\n   * @param  {Integer} length - number of entries to copy\n   * @return {undefined}\n   */\n  copyFrom (other: Store, thisOffset: number, otherOffset: number, length: number) {\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const thisField = this[ name ]\n      const otherField = other[ name ]\n\n      for (let j = 0; j < length; ++j) {\n        const thisIndex = itemSize * (thisOffset + j)\n        const otherIndex = itemSize * (otherOffset + j)\n        for (let k = 0; k < itemSize; ++k) {\n          thisField[ thisIndex + k ] = otherField[ otherIndex + k ]\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy data within this store\n   * @param  {Integer} thisOffset - offset to start copying to\n   * @param  {Integer} otherOffset - offset to start copying from\n   * @param  {Integer} length - number of entries to copy\n   * @return {undefined}\n   */\n  copyWithin (offsetTarget: number, offsetSource: number, length: number) {\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const thisField = this[ name ]\n\n      for (let j = 0; j < length; ++j) {\n        const targetIndex = itemSize * (offsetTarget + j)\n        const sourceIndex = itemSize * (offsetSource + j)\n        for (let k = 0; k < itemSize; ++k) {\n          thisField[ targetIndex + k ] = thisField[ sourceIndex + k ]\n        }\n      }\n    }\n  }\n\n  /**\n   * Sort entries in the store given the compare function\n   * @param  {[type]} compareFunction - function to sort by\n   * @return {undefined}\n   */\n  sort (compareFunction: (a: any, b: any) => number) {\n    Log.time('Store.sort')\n\n    const thisStore = this\n    const tmpStore = new (this.constructor as any)(1)\n\n    function swap (index1: number, index2: number) {\n      if (index1 === index2) return\n      tmpStore.copyFrom(thisStore, 0, index1, 1)\n      thisStore.copyWithin(index1, index2, 1)\n      thisStore.copyFrom(tmpStore, index2, 0, 1)\n    }\n\n    function quicksort (left: number, right: number) {\n      if (left < right) {\n        let pivot = Math.floor((left + right) / 2)\n        let leftNew = left\n        let rightNew = right\n        do {\n          while (compareFunction(leftNew, pivot) < 0) {\n            leftNew += 1\n          }\n          while (compareFunction(rightNew, pivot) > 0) {\n            rightNew -= 1\n          }\n          if (leftNew <= rightNew) {\n            if (leftNew === pivot) {\n              pivot = rightNew\n            } else if (rightNew === pivot) {\n              pivot = leftNew\n            }\n            swap(leftNew, rightNew)\n            leftNew += 1\n            rightNew -= 1\n          }\n        } while (leftNew <= rightNew)\n        quicksort(left, rightNew)\n        quicksort(leftNew, right)\n      }\n    }\n\n    quicksort(0, this.count - 1)\n\n    Log.timeEnd('Store.sort')\n  }\n\n  /**\n   * Empty the store\n   * @return {undefined}\n   */\n  clear () {\n    this.count = 0\n  }\n\n  /**\n   * Dispose of the store entries and fields\n   * @return {undefined}\n   */\n  dispose () {\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      delete this[ name ]\n    }\n  }\n}\n","/**\n * @file Contact Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Bond store\n */\nexport default class ContactStore extends Store {\n  index1: Uint32Array\n  index2: Uint32Array\n  type: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'index1', 1, 'int32' ],\n      [ 'index2', 1, 'int32' ],\n      [ 'type', 1, 'int8' ]\n    ] as StoreField[]\n  }\n\n  addContact (index1: number, index2: number, type?: number) {\n    this.growIfFull()\n\n    const i = this.count\n\n    if (index1 < index2) {\n      this.index1[ i ] = index1\n      this.index2[ i ] = index2\n    } else {\n      this.index2[ i ] = index1\n      this.index1[ i ] = index2\n    }\n    if (type) this.type[ i ] = type\n\n    this.count += 1\n  }\n}","/**\n * @file Bit array\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Paul Pillot <paulpillot@gmail.com>\n * @private\n */\n\n/**\n * Compute the Hamming weight of a 32-bit unsigned integer\n * @param  {Integer} v - a 32-bit unsigned integer\n * @return {Integer} the Hamming weight\n */\nfunction hammingWeight (v: number) {\n  // works with signed or unsigned shifts\n  v -= ((v >>> 1) & 0x55555555)\n  v = (v & 0x33333333) + ((v >>> 2) & 0x33333333)\n  return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24\n}\n\n/**\n * Bit array\n *\n * Based heavily on https://github.com/lemire/FastBitSet.js\n * which is licensed under the Apache License, Version 2.0.\n */\nexport default class BitArray {\n  private _words: Uint32Array\n  public length: number\n\n  /**\n   * @param  {Integer} length - array length\n   * @param  {Boolean} [setAll] - initialize with true\n   */\n  constructor (length: number, setAll?: boolean) {\n    this.length = length\n    this._words = new Uint32Array((length + 32) >>> 5)\n    if (setAll === true) {\n      this.setAll()\n    }\n  }\n\n  /**\n   * Get value at index\n   * @param  {Integer} index - the index\n   * @return {Boolean} value\n   */\n  get (index: number) {\n    return (this._words[ index >>> 5 ] & (1 << index)) !== 0\n  }\n\n  /**\n   * Set value at index to true\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  set (index: number) {\n    this._words[ index >>> 5 ] |= 1 << index\n  }\n\n  /**\n   * Set value at index to false\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  clear (index: number) {\n    this._words[ index >>> 5 ] &= ~(1 << index)\n  }\n\n  /**\n   * Flip value at index\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  flip (index: number) {\n    this._words[ index >>> 5 ] ^= 1 << index\n  }\n\n  _assignRange (start: number, end: number, value: boolean) {\n    if (end < start) return\n    const words = this._words\n    const wordValue = value === true ? 0xFFFFFFFF : 0\n    const wordStart = start >>> 5\n    const wordEnd = end >>> 5\n        // set complete words when applicable\n    for (let k = wordStart + 1; k < wordEnd; ++k) {\n      words[ k ] = wordValue\n    }\n        // set parts of the range not spanning complete words\n    const startWord = wordStart << 5\n    const endWord = wordEnd << 5\n    if (value === true) {\n      if (end - start < 32) {\n        for (let i = start, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n      } else {\n        for (let i = start, n = startWord + 32; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n        for (let i = endWord, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n      }\n    } else {\n      if (end - start < 32) {\n        for (let i = start, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n      } else {\n        for (let i = start, n = startWord + 32; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n        for (let i = endWord, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n      }\n    }\n    return this\n  }\n\n  /**\n   * Set bits of the given range\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  setRange (start: number, end: number) {\n    return this._assignRange(start, end, true)\n  }\n\n  /**\n   * Clear bits of the given range\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  clearRange (start: number, end: number) {\n    return this._assignRange(start, end, false)\n  }\n\n  /**\n   * Set bits at all given indices\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} this object\n   */\n  setBits (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      words[ index >>> 5 ] |= 1 << index\n    }\n    return this\n  }\n\n  /**\n   * Clear bits at all given indices\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} this object\n   */\n  clearBits (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      words[ index >>> 5 ] &= ~(1 << index)\n    }\n    return this\n  }\n\n  /**\n   * Set all bits of the array\n   * @return {BitArray} this object\n   */\n  setAll () {\n    return this._assignRange(0, this.length - 1, true)\n  }\n\n  /**\n   * Clear all bits of the array\n   * @return {BitArray} this object\n   */\n  clearAll () {\n    return this._assignRange(0, this.length - 1, false)\n  }\n\n  /**\n   * Flip all the values in the array\n   * @return {BitArray} this object\n   */\n  flipAll () {\n    const count = this._words.length\n    const words = this._words\n    const bs = 32 - this.length % 32\n    for (let k = 0; k < count - 1; ++k) {\n      words[k] = ~words[ k ]\n    }\n    words[ count - 1 ] = (~(words[ count - 1 ] << bs)) >>> bs\n    return this\n  }\n\n  _isRangeValue (start: number, end: number, value: boolean) {\n    if (end < start) return\n    const words = this._words\n    const wordValue = value === true ? 0xFFFFFFFF : 0\n    const wordStart = start >>> 5\n    const wordEnd = end >>> 5\n        // set complete words when applicable\n    for (let k = wordStart + 1; k < wordEnd; ++k) {\n      if (words[ k ] !== wordValue) return false\n    }\n        // set parts of the range not spanning complete words\n    if (end - start < 32) {\n      for (let i = start, n = end + 1; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n    } else {\n      const startWord = wordStart << 5\n      const endWord = wordEnd << 5\n      for (let i = start, n = startWord + 32; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n      for (let i = endWord, n = end + 1; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n    }\n    return true\n  }\n\n  /**\n   * Test if bits in given range are set\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  isRangeSet (start: number, end: number) {\n    return this._isRangeValue(start, end, true)\n  }\n\n  /**\n   * Test if bits in given range are clear\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  isRangeClear (start: number, end: number) {\n    return this._isRangeValue(start, end, false)\n  }\n\n  /**\n   * Test if all bits in the array are set\n   * @return {Boolean} test result\n   */\n  isAllSet () {\n    return this._isRangeValue(0, this.length - 1, true)\n  }\n\n  /**\n   * Test if all bits in the array are clear\n   * @return {Boolean} test result\n   */\n  isAllClear () {\n    return this._isRangeValue(0, this.length - 1, false)\n  }\n\n  /**\n   * Test if bits at all given indices are set\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} test result\n   */\n  isSet (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      if ((words[ index >>> 5 ] & (1 << index)) === 0) return false\n    }\n    return true\n  }\n\n  /**\n   * Test if bits at all given indices are clear\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} test result\n   */\n  isClear (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      if ((words[ index >>> 5 ] & (1 << index)) !== 0) return false\n    }\n    return true\n  }\n\n  /**\n   * Test if two BitArrays are identical in all their values\n   * @param {BitArray} otherBitarray - the other BitArray\n   * @return {Boolean} test result\n   */\n  isEqualTo (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      if (words1[ k ] !== words2[ k ]) {\n        return false\n      }\n    }\n    return true\n  }\n\n  /**\n   * How many set bits?\n   * @return {Integer} number of set bits\n   */\n  getSize () {\n    const count = this._words.length\n    const words = this._words\n    let size = 0\n    for (let i = 0; i < count; ++i) {\n      size += hammingWeight(words[ i ])\n    }\n    return size\n  }\n\n  /**\n   * Calculate difference betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  difference (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] = words1[ k ] & ~words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Calculate union betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  union (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] |= words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Calculate intersection betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  intersection (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] &= words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Test if there is any intersection betwen this and another bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {Boolean} test result\n   */\n  intersects (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      if ((words1[ k ] & words2[ k ]) !== 0) {\n        return true\n      }\n    }\n    return false\n  }\n\n  /**\n   * Calculate the number of bits in common betwen this and another bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {Integer} size\n   */\n  getIntersectionSize (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    let size = 0\n    for (let k = 0; k < count; ++k) {\n      size += hammingWeight(words1[ k ] & words2[ k ])\n    }\n    return size\n  }\n\n  /**\n   * Calculate intersection betwen this and another bit array.\n   * Store result in a new bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} the new bit array\n   */\n  makeIntersection (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    const wordsA = new Uint32Array(count)\n    const intersection = Object.create(BitArray.prototype)\n    intersection._words = wordsA\n    intersection.length = Math.min(this.length, otherBitarray.length)\n    for (let k = 0; k < count; ++k) {\n      wordsA[ k ] = words1[ k ] & words2[ k ]\n    }\n    return intersection\n  }\n\n  /**\n   * Iterate over all set bits in the array\n   * @param  {function( index: Integer, i: Integer )} callback - the callback\n   * @return {undefined}\n   */\n  forEach (callback: (index: number, i: number) => any) {\n    const count = this._words.length\n    const words = this._words\n    let i = 0\n    for (let k = 0; k < count; ++k) {\n      let w = words[ k ]\n      while (w !== 0) {\n        const t = w & -w\n        const index = (k << 5) + hammingWeight(t - 1)\n        callback(index, i)\n        w ^= t\n        ++i\n      }\n    }\n  }\n\n  /**\n   * Get an array with the set bits\n   * @return {Array} bit indices\n   */\n  toArray () {\n    const words = this._words\n    const answer = new Array(this.getSize())\n    const count = this._words.length\n    let pos = 0\n    for (let k = 0; k < count; ++k) {\n      let w = words[ k ]\n      while (w !== 0) {\n        const t = w & -w\n        answer[ pos++ ] = (k << 5) + hammingWeight(t - 1)\n        w ^= t\n      }\n    }\n    return answer\n  }\n\n  toString () {\n    return '{' + this.toArray().join(',') + '}'\n  }\n\n  toSeleString () {\n    const sele = this.toArray().join(',')\n    return sele ? '@' + sele : 'NONE'\n  }\n\n  /**\n   * Clone this object\n   * @return {BitArray} the cloned object\n   */\n  clone () {\n    const clone = Object.create(BitArray.prototype)\n    clone.length = this.length\n    clone._words = new Uint32Array(this._words)\n    return clone\n  }\n}","/**\n * @file Adjacency List\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport interface Edges {\n  nodeArray1: ArrayLike<number>\n  nodeArray2: ArrayLike<number>\n  edgeCount: number\n  nodeCount: number\n}\n\nexport interface AdjacencyList {\n  /* number of edges for each node */\n  countArray: Uint8Array\n  /* offset into indexArray for each node */\n  offsetArray: Int32Array\n  /* edge indices, grouped by nodes */\n  indexArray: Int32Array\n}\n\nexport function createAdjacencyList (edges: Edges): AdjacencyList {\n  const { edgeCount, nodeCount, nodeArray1, nodeArray2 } = edges\n\n  const countArray = new Uint8Array(nodeCount)\n  const offsetArray = new Int32Array(nodeCount)\n\n  // count edges per node\n  for (let i = 0; i < edgeCount; ++i) {\n    countArray[ nodeArray1[ i ] ] += 1\n    countArray[ nodeArray2[ i ] ] += 1\n  }\n\n  // get offsets to node edges\n  for (let i = 1; i < nodeCount; ++i) {\n    offsetArray[ i ] += offsetArray[ i - 1 ] + countArray[ i - 1 ]\n  }\n\n  // prepare index array\n  const bondCount2 = edgeCount * 2\n  const indexArray = new Int32Array(bondCount2)\n  for (let j = 0; j < bondCount2; ++j) {\n    indexArray[ j ] = -1\n  }\n\n  // build index array\n  for (let i = 0; i < edgeCount; ++i) {\n    const idx1 = nodeArray1[ i ]\n    const idx2 = nodeArray2[ i ]\n    let j1 = offsetArray[ idx1 ]\n    while (indexArray[ j1 ] !== -1 && j1 < bondCount2) {\n      j1 += 1\n    }\n    indexArray[ j1 ] = i\n    let j2 = offsetArray[ idx2 ]\n    while (indexArray[ j2 ] !== -1 && j2 < bondCount2) {\n      j2 += 1\n    }\n    indexArray[ j2 ] = i\n  }\n\n  return { countArray, offsetArray, indexArray }\n}\n","/**\n * @file Features\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport AtomProxy from '../../proxy/atom-proxy'\n\nexport interface Features {\n  types: FeatureType[]\n  groups: FeatureGroup[]\n  centers: { x: number[], y: number[], z: number[] }\n  atomSets: number[][]\n}\n\nexport const enum FeatureType {\n  Unknown = 0,\n  PositiveCharge = 1,\n  NegativeCharge = 2,\n  AromaticRing = 3,\n  HydrogenDonor = 4,\n  HydrogenAcceptor = 5,\n  HalogenDonor = 6,\n  HalogenAcceptor = 7,\n  Hydrophobic = 8,\n  WeakHydrogenDonor = 9,\n  IonicTypePartner = 10,\n  DativeBondPartner = 11,\n  TransitionMetal = 12,\n  IonicTypeMetal = 13\n}\n\nexport const enum FeatureGroup {\n  Unknown = 0,\n  QuaternaryAmine = 1,\n  TertiaryAmine = 2,\n  Sulfonium = 3,\n  SulfonicAcid = 4,\n  Sulfate = 5,\n  Phosphate = 6,\n  Halocarbon = 7,\n  Guanidine = 8,\n  Acetamidine = 9,\n  Carboxylate = 10\n}\n\nexport function createFeatures (): Features {\n  return {\n    types: [],\n    groups: [],\n    centers: { x: [], y: [], z: [] },\n    atomSets: []\n  }\n}\n\nexport interface FeatureState {\n  type: FeatureType\n  group: FeatureGroup\n  x: number\n  y: number\n  z: number\n  atomSet: number[]\n}\n\nexport function createFeatureState(type = FeatureType.Unknown, group = FeatureGroup.Unknown): FeatureState {\n  return { type, group, x: 0, y: 0, z: 0, atomSet: [] }\n}\n\nexport function addAtom (state: FeatureState, atom: AtomProxy) {\n  state.x += atom.x\n  state.y += atom.y\n  state.z += atom.z\n  state.atomSet.push(atom.index)\n}\n\nexport function addFeature (features: Features, state: FeatureState) {\n  const n = state.atomSet.length\n  if (n > 0) {\n    const { types, groups, centers, atomSets } = features\n    types.push(state.type)\n    groups.push(state.group)\n    centers.x.push(state.x / n)\n    centers.y.push(state.y / n)\n    centers.z.push(state.z / n)\n    atomSets.push(state.atomSet)\n  }\n}\n","/**\n * @file Structure Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// entity types\nexport const UnknownEntity = 0\nexport const PolymerEntity = 1\nexport const NonPolymerEntity = 2\nexport const MacrolideEntity = 3\nexport const WaterEntity = 4\n\n// molecule types\nexport const UnknownType = 0\nexport const WaterType = 1\nexport const IonType = 2\nexport const ProteinType = 3\nexport const RnaType = 4\nexport const DnaType = 5\nexport const SaccharideType = 6\n\n// backbone types\nexport const UnknownBackboneType = 0\nexport const ProteinBackboneType = 1\nexport const RnaBackboneType = 2\nexport const DnaBackboneType = 3\nexport const CgProteinBackboneType = 4\nexport const CgRnaBackboneType = 5\nexport const CgDnaBackboneType = 6\n\n// chemical component types\nexport const ChemCompProtein = [\n  'D-BETA-PEPTIDE, C-GAMMA LINKING', 'D-GAMMA-PEPTIDE, C-DELTA LINKING',\n  'D-PEPTIDE COOH CARBOXY TERMINUS', 'D-PEPTIDE NH3 AMINO TERMINUS', 'D-PEPTIDE LINKING',\n  'L-BETA-PEPTIDE, C-GAMMA LINKING', 'L-GAMMA-PEPTIDE, C-DELTA LINKING',\n  'L-PEPTIDE COOH CARBOXY TERMINUS', 'L-PEPTIDE NH3 AMINO TERMINUS', 'L-PEPTIDE LINKING',\n  'PEPTIDE LINKING', 'PEPTIDE-LIKE'\n]\nexport const ChemCompRna = [\n  'RNA OH 3 PRIME TERMINUS', 'RNA OH 5 PRIME TERMINUS', 'RNA LINKING'\n]\nexport const ChemCompDna = [\n  'DNA OH 3 PRIME TERMINUS', 'DNA OH 5 PRIME TERMINUS', 'DNA LINKING',\n  'L-DNA LINKING', 'L-RNA LINKING'\n]\nexport const ChemCompSaccharide = [\n  'D-SACCHARIDE', 'D-SACCHARIDE 1,4 AND 1,4 LINKING', 'D-SACCHARIDE 1,4 AND 1,6 LINKING',\n  'L-SACCHARIDE', 'L-SACCHARIDE 1,4 AND 1,4 LINKING', 'L-SACCHARIDE 1,4 AND 1,6 LINKING',\n  'SACCHARIDE'\n]\nexport const ChemCompOther = [\n  'OTHER'\n]\nexport const ChemCompNonPolymer = [\n  'NON-POLYMER'\n]\nexport const ChemCompHetero = ChemCompNonPolymer.concat(ChemCompOther, ChemCompSaccharide)\n\n// secondary structure\nexport const SecStrucHelix = [ 'h', 'g', 'i' ]\nexport const SecStrucSheet = [ 'e', 'b' ]\nexport const SecStrucTurn = [ 's', 't', 'l', '' ]\n\nexport const AtomicNumbers: { [e: string]: number | undefined } = {\n  'H': 1, 'D': 1, 'T': 1, 'HE': 2, 'LI': 3, 'BE': 4, 'B': 5, 'C': 6, 'N': 7, 'O': 8, 'F': 9, 'NE': 10, 'NA': 11, 'MG': 12, 'AL': 13, 'SI': 14, 'P': 15, 'S': 16, 'CL': 17, 'AR': 18, 'K': 19, 'CA': 20, 'SC': 21, 'TI': 22, 'V': 23, 'CR': 24, 'MN': 25, 'FE': 26, 'CO': 27, 'NI': 28, 'CU': 29, 'ZN': 30, 'GA': 31, 'GE': 32, 'AS': 33, 'SE': 34, 'BR': 35, 'KR': 36, 'RB': 37, 'SR': 38, 'Y': 39, 'ZR': 40, 'NB': 41, 'MO': 42, 'TC': 43, 'RU': 44, 'RH': 45, 'PD': 46, 'AG': 47, 'CD': 48, 'IN': 49, 'SN': 50, 'SB': 51, 'TE': 52, 'I': 53, 'XE': 54, 'CS': 55, 'BA': 56, 'LA': 57, 'CE': 58, 'PR': 59, 'ND': 60, 'PM': 61, 'SM': 62, 'EU': 63, 'GD': 64, 'TB': 65, 'DY': 66, 'HO': 67, 'ER': 68, 'TM': 69, 'YB': 70, 'LU': 71, 'HF': 72, 'TA': 73, 'W': 74, 'RE': 75, 'OS': 76, 'IR': 77, 'PT': 78, 'AU': 79, 'HG': 80, 'TL': 81, 'PB': 82, 'BI': 83, 'PO': 84, 'AT': 85, 'RN': 86, 'FR': 87, 'RA': 88, 'AC': 89, 'TH': 90, 'PA': 91, 'U': 92, 'NP': 93, 'PU': 94, 'AM': 95, 'CM': 96, 'BK': 97, 'CF': 98, 'ES': 99, 'FM': 100, 'MD': 101, 'NO': 102, 'LR': 103, 'RF': 104, 'DB': 105, 'SG': 106, 'BH': 107, 'HS': 108, 'MT': 109, 'DS': 110, 'RG': 111, 'CN': 112, 'NH': 113, 'FL': 114, 'MC': 115, 'LV': 116, 'TS': 117, 'OG': 118\n}\nexport const DefaultAtomicNumber = 0\n\n/**\n * Enum mapping element to atomic number\n */\nexport const enum Elements {\n  H = 1, D = 1, T = 1, HE = 2, LI = 3, BE = 4, B = 5, C = 6, N = 7, O = 8, F = 9, NE = 10, NA = 11, MG = 12, AL = 13, SI = 14, P = 15, S = 16, CL = 17, AR = 18, K = 19, CA = 20, SC = 21, TI = 22, V = 23, CR = 24, MN = 25, FE = 26, CO = 27, NI = 28, CU = 29, ZN = 30, GA = 31, GE = 32, AS = 33, SE = 34, BR = 35, KR = 36, RB = 37, SR = 38, Y = 39, ZR = 40, NB = 41, MO = 42, TC = 43, RU = 44, RH = 45, PD = 46, AG = 47, CD = 48, IN = 49, SN = 50, SB = 51, TE = 52, I = 53, XE = 54, CS = 55, BA = 56, LA = 57, CE = 58, PR = 59, ND = 60, PM = 61, SM = 62, EU = 63, GD = 64, TB = 65, DY = 66, HO = 67, ER = 68, TM = 69, YB = 70, LU = 71, HF = 72, TA = 73, W = 74, RE = 75, OS = 76, IR = 77, PT = 78, AU = 79, HG = 80, TL = 81, PB = 82, BI = 83, PO = 84, AT = 85, RN = 86, FR = 87, RA = 88, AC = 89, TH = 90, PA = 91, U = 92, NP = 93, PU = 94, AM = 95, CM = 96, BK = 97, CF = 98, ES = 99, FM = 100, MD = 101, NO = 102, LR = 103, RF = 104, DB = 105, SG = 106, BH = 107, HS = 108, MT = 109, DS = 110, RG = 111, CN = 112, NH = 113, FL = 114, MC = 115, LV = 116, TS = 117, OG = 118\n}\n\n// https://doi.org/10.1515/pac-2015-0305 (table 2, 3, and 4)\nexport const AtomWeights: { [e: number]: number | undefined } = {\n  1: 1.008, 2: 4.0026, 3: 6.94, 4: 9.0122, 5: 10.81, 6: 10.81, 7: 14.007, 8: 15.999, 9: 18.998, 10: 20.180, 11: 22.990, 12: 24.305, 13: 26.982, 14: 28.085, 15: 30.974, 16: 32.06, 17: 35.45, 18: 39.948, 19: 39.098, 20: 40.078, 21: 44.956, 22: 47.867, 23: 50.942, 24: 51.996, 25: 54.938, 26: 55.845, 27: 58.933, 28: 58.693, 29: 63.546, 30: 65.38, 31: 69.723, 32: 72.630, 33: 74.922, 34: 78.971, 35: 79.904, 36: 83.798, 37: 85.468, 38: 87.62, 39: 88.906, 40: 91.224, 41: 92.906, 42: 95.95, 43: 96.906, 44: 101.07, 45: 102.91, 46: 106.42, 47: 107.87, 48: 112.41, 49: 114.82, 50: 118.71, 51: 121.76, 52: 127.60, 53: 127.60, 54: 131.29, 55: 132.91, 56: 137.33, 57: 138.91, 58: 140.12, 59: 140.91, 60: 144.24, 61: 144.912, 62: 150.36, 63: 151.96, 64: 157.25, 65: 158.93, 66: 162.50, 67: 164.93, 68: 167.26, 69: 168.93, 70: 173.05, 71: 174.97, 72: 178.49, 73: 180.95, 74: 183.84, 75: 186.21, 76: 190.23, 77: 192.22, 78: 195.08, 79: 196.97, 80: 200.59, 81: 204.38, 82: 207.2, 83: 208.98, 84: 1.97, 85: 2.02, 86: 2.2, 87: 3.48, 88: 2.83, 89: 2.0, 90: 232.04, 91: 231.04, 92: 238.03, 93: 237.048, 94: 244.064, 95: 243.061, 96: 247.070, 97: 247.070, 98: 251.079, 99: 252.083, 100: 257.095, 101: 258.098, 102: 259.101, 103: 262.110, 104: 267.122, 105: 270.131, 106: 271.134, 107: 270.133, 108: 270.134, 109: 278.156, 110: 281.165, 111: 281.166, 112: 285.177, 113: 286.182, 114: 289.190, 115: 289.194, 116: 293.204, 117: 293.208, 118: 294.214\n}\nexport const DefaultAtomWeight = 10.81  // C\n\n// http://dx.doi.org/10.1021/jp8111556 (or 2.0)\nexport const VdwRadii: { [e: number]: number | undefined } = {\n  1: 1.1, 2: 1.4, 3: 1.81, 4: 1.53, 5: 1.92, 6: 1.7, 7: 1.55, 8: 1.52, 9: 1.47, 10: 1.54, 11: 2.27, 12: 1.73, 13: 1.84, 14: 2.1, 15: 1.8, 16: 1.8, 17: 1.75, 18: 1.88, 19: 2.75, 20: 2.31, 21: 2.3, 22: 2.15, 23: 2.05, 24: 2.05, 25: 2.05, 26: 2.05, 27: 2.0, 28: 2.0, 29: 2.0, 30: 2.1, 31: 1.87, 32: 2.11, 33: 1.85, 34: 1.9, 35: 1.83, 36: 2.02, 37: 3.03, 38: 2.49, 39: 2.4, 40: 2.3, 41: 2.15, 42: 2.1, 43: 2.05, 44: 2.05, 45: 2.0, 46: 2.05, 47: 2.1, 48: 2.2, 49: 2.2, 50: 1.93, 51: 2.17, 52: 2.06, 53: 1.98, 54: 2.16, 55: 3.43, 56: 2.68, 57: 2.5, 58: 2.48, 59: 2.47, 60: 2.45, 61: 2.43, 62: 2.42, 63: 2.4, 64: 2.38, 65: 2.37, 66: 2.35, 67: 2.33, 68: 2.32, 69: 2.3, 70: 2.28, 71: 2.27, 72: 2.25, 73: 2.2, 74: 2.1, 75: 2.05, 76: 2.0, 77: 2.0, 78: 2.05, 79: 2.1, 80: 2.05, 81: 1.96, 82: 2.02, 83: 2.07, 84: 1.97, 85: 2.02, 86: 2.2, 87: 3.48, 88: 2.83, 89: 2.0, 90: 2.4, 91: 2.0, 92: 2.3, 93: 2.0, 94: 2.0, 95: 2.0, 96: 2.0, 97: 2.0, 98: 2.0, 99: 2.0, 100: 2.0, 101: 2.0, 102: 2.0, 103: 2.0, 104: 2.0, 105: 2.0, 106: 2.0, 107: 2.0, 108: 2.0, 109: 2.0, 110: 2.0, 111: 2.0, 112: 2.0, 113: 2.0, 114: 2.0, 115: 2.0, 116: 2.0, 117: 2.0, 118: 2.0\n}\nexport const DefaultVdwRadius = 2.0  // C\n\n// Peter Rose (peter.rose@rcsb.org), private communication, average accross PDB\nexport const ResidueRadii: { [k: string]: number } = {\n  '2QY': 6.58,\n  'CY0': 11.98,\n  '2QZ': 2.52,\n  'CY1': 6.59,\n  'HHK': 5.11,\n  'CXM': 4.69,\n  'HHI': 4.58,\n  'CY4': 4.57,\n  'S12': 18.57,\n  'CY3': 2.79,\n  'C5C': 5.35,\n  'PFX': 11.84,\n  '2R3': 6.94,\n  '2R1': 3.78,\n  'ILX': 4.99,\n  '32S': 5.68,\n  'BTK': 8.59,\n  '32T': 5.72,\n  'FAK': 9.8,\n  'B27': 2.78,\n  'ILM': 3.84,\n  'C4R': 5.63,\n  '32L': 6.75,\n  'SYS': 3.01,\n  '1MH': 5.04,\n  'ILE': 3.65,\n  'YNM': 6.39,\n  '2RX': 4.91,\n  'B3A': 2.48,\n  'GEE': 4.76,\n  '7MN': 7.34,\n  'B3E': 5.4,\n  'ARG': 6.33,\n  '200': 6.89,\n  'HIP': 5.47,\n  'HIA': 4.64,\n  'B3K': 5.89,\n  'HIC': 5.76,\n  'B3L': 4.96,\n  'B3M': 5.07,\n  'ARM': 6.86,\n  'ARO': 7.35,\n  'AR4': 8.42,\n  'PG1': 10.67,\n  'YOF': 6.44,\n  'IML': 3.74,\n  'SXE': 6.65,\n  'HIQ': 7.98,\n  'PFF': 6.31,\n  'HIS': 4.52,\n  '0TD': 3.62,\n  'C3Y': 5.24,\n  '1OP': 11.55,\n  '02Y': 4.77,\n  '02V': 4.83,\n  'ASB': 5.59,\n  '30V': 8.53,\n  'S2P': 4.81,\n  'ASP': 3.55,\n  'ASN': 3.54,\n  '2OR': 6.91,\n  'QMM': 6.13,\n  '2P0': 8.52,\n  'ASL': 5.36,\n  'HFA': 5.14,\n  '5PG': 5.69,\n  'B3X': 4.38,\n  'AS9': 4.1,\n  'ARV': 7.59,\n  'B3U': 6.06,\n  'S2C': 7.54,\n  'B3T': 3.34,\n  '175': 5.64,\n  'GFT': 8.18,\n  'HG7': 6.8,\n  'B3Q': 4.48,\n  'ASA': 3.64,\n  '02K': 2.94,\n  'B3Y': 7.45,\n  'PHD': 5.35,\n  'C6C': 6.42,\n  'BUC': 5.8,\n  'HGL': 8.07,\n  'PHE': 5.06,\n  '03Y': 2.6,\n  'PHA': 5.11,\n  'OCY': 5.0,\n  '4PH': 6.79,\n  '5OH': 4.7,\n  '31Q': 10.46,\n  'BTR': 7.98,\n  '3PX': 4.7,\n  '1PA': 8.07,\n  'ASX': 3.54,\n  'IOR': 7.23,\n  '03E': 3.38,\n  'PHL': 5.17,\n  'KWS': 5.09,\n  'PHI': 7.12,\n  'NAL': 7.22,\n  'S1H': 19.21,\n  '2ML': 3.86,\n  '2MR': 7.35,\n  'GHG': 4.83,\n  'TYY': 6.54,\n  '2MT': 3.67,\n  '56A': 13.01,\n  'SVA': 5.46,\n  'TYX': 8.31,\n  'TYS': 8.59,\n  'TYR': 6.38,\n  'TYQ': 6.43,\n  'HLU': 3.99,\n  'MYK': 19.47,\n  'TYO': 7.71,\n  'HLX': 4.98,\n  'TYN': 9.87,\n  'TYJ': 6.25,\n  'TYI': 6.49,\n  'LYH': 5.13,\n  'LYF': 12.19,\n  'SUN': 6.73,\n  'LYR': 18.28,\n  'TYB': 6.46,\n  '11W': 14.39,\n  'LYS': 5.54,\n  'LYN': 4.8,\n  '11Q': 4.85,\n  'LYO': 4.71,\n  'LYZ': 1.76,\n  'TXY': 6.44,\n  'MYN': 4.71,\n  'TY5': 10.6,\n  'HMR': 5.09,\n  '01W': 8.55,\n  'LYX': 13.36,\n  'TY8': 7.22,\n  'TY2': 6.49,\n  'KYN': 6.18,\n  'KYQ': 9.75,\n  'CZZ': 5.14,\n  'IIL': 3.81,\n  'HNC': 10.41,\n  'OIC': 4.62,\n  'LVN': 2.89,\n  'QIL': 3.84,\n  'JJL': 8.3,\n  'VAH': 3.88,\n  'JJJ': 7.5,\n  'JJK': 7.43,\n  'VAD': 2.56,\n  'CYW': 4.65,\n  '0QL': 5.72,\n  '143': 8.22,\n  'SVX': 7.04,\n  'CYJ': 11.64,\n  'SVY': 7.1,\n  'SVZ': 6.6,\n  'CYG': 8.03,\n  'CYF': 13.54,\n  'SVV': 5.09,\n  'GL3': 2.72,\n  '8SP': 14.26,\n  'CYS': 2.78,\n  '004': 4.33,\n  'CYR': 10.33,\n  'PLJ': 3.71,\n  'EXY': 7.37,\n  'HL2': 3.75,\n  'A5N': 5.21,\n  'CYQ': 5.67,\n  'CZ2': 5.16,\n  'LWY': 4.12,\n  'PM3': 8.78,\n  'OHS': 6.98,\n  'OHI': 5.35,\n  '3TY': 8.42,\n  'CYD': 8.55,\n  'DYS': 7.87,\n  'DAH': 6.47,\n  '4IK': 11.81,\n  '3EG': 3.66,\n  'AYA': 3.65,\n  '4IN': 6.31,\n  'DAB': 3.48,\n  '4HT': 6.03,\n  'RGL': 7.03,\n  'DAM': 2.49,\n  'NFA': 5.04,\n  'WFP': 6.07,\n  '2JC': 2.97,\n  'HAR': 7.55,\n  '2JG': 5.67,\n  'MH6': 1.72,\n  '2JF': 9.13,\n  '3FG': 4.96,\n  'MGN': 4.84,\n  'AZH': 5.36,\n  'AZK': 6.03,\n  'ZBZ': 7.79,\n  'TBG': 2.58,\n  'VAL': 2.51,\n  'MGG': 7.34,\n  'AZS': 5.61,\n  'FHL': 9.75,\n  '2JH': 4.56,\n  'IEL': 7.07,\n  'FHO': 6.75,\n  'DA2': 7.79,\n  'FH7': 6.99,\n  'ME0': 4.52,\n  '3GL': 4.84,\n  'MDO': 5.03,\n  'AZY': 7.37,\n  'A8E': 3.76,\n  'ZCL': 6.71,\n  'MDH': 2.58,\n  'LA2': 14.07,\n  '4FW': 6.1,\n  'YCM': 5.32,\n  'MDF': 4.95,\n  'YCP': 3.01,\n  'TEF': 8.63,\n  'FGP': 4.34,\n  'UF0': 19.72,\n  'XCN': 4.57,\n  'FGL': 2.56,\n  'MF3': 6.37,\n  'MEQ': 5.13,\n  'LAA': 3.23,\n  'IGL': 5.52,\n  'MET': 4.49,\n  'NIY': 6.81,\n  'QCS': 5.18,\n  'TCQ': 8.56,\n  'MEN': 4.33,\n  '4HL': 8.79,\n  'MEA': 4.95,\n  'EFC': 5.28,\n  'LAL': 2.41,\n  '2HF': 5.52,\n  'KBE': 5.64,\n  'OCS': 3.94,\n  'CAF': 5.46,\n  'NC1': 11.4,\n  'NBQ': 9.82,\n  'CAB': 4.19,\n  'MBQ': 9.55,\n  '193': 7.38,\n  '192': 2.44,\n  '0WZ': 7.61,\n  'CAS': 5.35,\n  'NB8': 11.98,\n  'OBS': 11.71,\n  '1AC': 2.42,\n  'PCA': 3.48,\n  'MCL': 9.73,\n  'LBY': 7.75,\n  'GAU': 4.67,\n  'PBF': 9.75,\n  'MCG': 6.46,\n  'DDE': 6.86,\n  '19W': 3.94,\n  'MD5': 9.33,\n  'MD6': 6.44,\n  'MD3': 8.41,\n  'MCS': 7.56,\n  'OBF': 3.64,\n  'UAL': 4.68,\n  'PAT': 6.05,\n  'IAM': 8.88,\n  'PAQ': 8.77,\n  'FDL': 9.49,\n  'NCB': 3.45,\n  'LCK': 9.81,\n  'DDZ': 2.52,\n  '2FM': 5.54,\n  'IAR': 6.77,\n  'OAS': 4.8,\n  'HBN': 8.8,\n  'TA4': 5.55,\n  '1C3': 7.43,\n  'ECX': 5.51,\n  'PF5': 6.28,\n  'RE3': 5.29,\n  'FCL': 6.25,\n  'ECC': 4.79,\n  'LDH': 7.06,\n  'NCY': 2.91,\n  'CCS': 4.58,\n  'PEC': 6.54,\n  '2CO': 4.45,\n  'LE1': 2.72,\n  'HCM': 5.53,\n  '07O': 8.05,\n  'HCL': 4.96,\n  'NEP': 6.94,\n  'PE1': 8.01,\n  'LEF': 4.37,\n  'FC0': 5.18,\n  'LED': 4.34,\n  'HCS': 4.09,\n  'DBU': 2.49,\n  'RE0': 5.53,\n  'LEN': 3.82,\n  '1E3': 8.71,\n  'BB9': 2.56,\n  'BB8': 5.14,\n  'PCS': 5.05,\n  'BB7': 4.56,\n  'BB6': 2.62,\n  'LEU': 3.83,\n  'DBZ': 7.08,\n  'LET': 11.29,\n  'DBY': 6.46,\n  'ICY': 7.76,\n  'MAA': 2.4,\n  'CGA': 7.91,\n  '5CS': 8.34,\n  'UGY': 3.7,\n  'LGY': 11.71,\n  'N10': 8.96,\n  'AAR': 6.39,\n  'FT6': 7.5,\n  'MOD': 12.62,\n  '5CW': 7.21,\n  'PVH': 4.58,\n  'BBC': 6.42,\n  'YYA': 7.3,\n  'O12': 14.08,\n  'NOT': 7.15,\n  'KGC': 9.88,\n  'MP4': 5.86,\n  '0CS': 4.07,\n  'MP8': 3.75,\n  'VLL': 2.54,\n  'VLM': 2.51,\n  'BCS': 8.03,\n  'MNL': 4.9,\n  'AA4': 4.47,\n  'SAC': 3.49,\n  'BCX': 2.99,\n  '3CF': 6.47,\n  'SAH': 11.7,\n  'NNH': 6.86,\n  'CGU': 4.71,\n  'SIB': 12.41,\n  'TLY': 8.78,\n  'SIC': 4.81,\n  'VMS': 8.82,\n  'TMD': 6.76,\n  'MMO': 6.53,\n  'PXU': 2.46,\n  '4AW': 6.22,\n  'OTH': 3.6,\n  'DLS': 6.84,\n  'MME': 4.99,\n  'DM0': 6.99,\n  '0FL': 2.76,\n  'SBL': 8.96,\n  'CDV': 3.72,\n  'OTY': 6.51,\n  'PYA': 7.75,\n  '2AS': 3.57,\n  'DMH': 4.92,\n  'ELY': 7.42,\n  'GVL': 9.6,\n  'FVA': 2.9,\n  'SAR': 2.48,\n  '4BF': 6.92,\n  'EME': 4.69,\n  'CDE': 2.51,\n  '3AR': 7.86,\n  '3AH': 9.11,\n  'AC5': 2.44,\n  'FTR': 6.08,\n  'MLL': 3.76,\n  'NPH': 11.66,\n  'NPI': 6.9,\n  'DMT': 6.67,\n  'PYX': 11.3,\n  'MLE': 3.87,\n  'PYL': 9.67,\n  'ZZU': 6.94,\n  'H5M': 3.61,\n  'SCH': 4.46,\n  'DMK': 3.52,\n  'FTY': 9.07,\n  '2AG': 3.7,\n  'ABA': 2.55,\n  'ZZJ': 2.44,\n  'MLZ': 6.8,\n  'MLY': 6.88,\n  'KCX': 7.28,\n  'ZZD': 8.16,\n  '3A5': 5.37,\n  'LHC': 7.75,\n  '9AT': 2.47,\n  'OZT': 3.4,\n  'THO': 2.62,\n  'THR': 2.5,\n  'DFI': 3.93,\n  'MKD': 6.42,\n  '4CY': 4.6,\n  'SDP': 6.07,\n  'DFO': 3.94,\n  '0A0': 3.45,\n  '4DB': 9.73,\n  'ML3': 6.26,\n  'BG1': 8.02,\n  'SD4': 4.57,\n  'THC': 3.8,\n  'SCS': 5.48,\n  'TH5': 4.65,\n  'BFD': 5.33,\n  'AEI': 6.34,\n  'TH6': 2.85,\n  'SCY': 4.53,\n  'TIS': 4.81,\n  'SEE': 4.53,\n  'BHD': 3.48,\n  'SEB': 8.18,\n  'SEC': 2.96,\n  'SEP': 4.8,\n  'CLH': 7.13,\n  'TIH': 5.02,\n  'CLG': 13.62,\n  'SEN': 6.43,\n  'XXA': 7.34,\n  'SEL': 2.46,\n  'SE7': 4.19,\n  '4CF': 7.72,\n  'G8M': 3.57,\n  'BH2': 3.51,\n  'UN2': 3.22,\n  'VR0': 10.51,\n  'MK8': 4.76,\n  'DHA': 2.32,\n  'LMQ': 4.69,\n  'SFE': 5.01,\n  'AHB': 3.47,\n  'OXX': 7.05,\n  'BIF': 9.63,\n  'IZO': 4.47,\n  'NMM': 8.25,\n  '0BN': 7.0,\n  'HZP': 3.12,\n  'NMC': 4.23,\n  'DHL': 2.69,\n  '9DS': 9.29,\n  'SER': 2.41,\n  'CHG': 4.2,\n  'MIR': 6.54,\n  'AGQ': 7.79,\n  'SET': 2.46,\n  'MIS': 6.32,\n  '4FB': 3.08,\n  '0AR': 8.46,\n  'LME': 3.99,\n  'FZN': 24.42,\n  'AGT': 9.04,\n  'IYR': 6.46,\n  '9DN': 9.31,\n  'CHP': 5.75,\n  'UNK': 1.64,\n  'XX1': 9.92,\n  'AGM': 6.57,\n  '0AH': 5.78,\n  'LLP': 10.22,\n  '0AF': 6.72,\n  '4DP': 9.28,\n  'HYP': 2.25,\n  'DIR': 5.8,\n  'LLY': 8.71,\n  '0AK': 6.11,\n  'NLE': 4.67,\n  'OYL': 6.42,\n  'WVL': 4.69,\n  '0A8': 8.1,\n  'NLY': 6.37,\n  'MHO': 4.89,\n  'VOL': 2.55,\n  '0A1': 7.1,\n  'MHL': 3.92,\n  'NLP': 4.81,\n  'NLQ': 4.65,\n  'MHW': 2.74,\n  'BIL': 4.7,\n  'NLO': 4.8,\n  'MHU': 7.51,\n  'XW1': 9.36,\n  'LLO': 10.13,\n  'SGB': 6.88,\n  'MHV': 3.6,\n  'MHS': 4.51,\n  '0A9': 5.17,\n  '0LF': 9.96,\n  'HT7': 6.82,\n  'X2W': 6.6,\n  'YPZ': 9.38,\n  'I58': 6.73,\n  'FLA': 2.4,\n  'M0H': 4.83,\n  'HSL': 2.46,\n  'FLE': 6.17,\n  'KOR': 10.1,\n  '1VR': 3.89,\n  'HSO': 4.56,\n  'TTS': 9.41,\n  'RVX': 7.01,\n  'TTQ': 7.71,\n  'H14': 5.27,\n  'HTI': 7.8,\n  'ONH': 6.14,\n  'LP6': 8.58,\n  'ONL': 4.83,\n  'AHH': 5.06,\n  'HS8': 7.4,\n  'HS9': 4.71,\n  'BL2': 5.82,\n  'AHP': 5.26,\n  '6HN': 7.34,\n  'HRP': 5.46,\n  'POM': 3.6,\n  'WPA': 5.11,\n  '2ZC': 4.29,\n  'CPC': 2.65,\n  'AIB': 2.4,\n  'XSN': 3.47,\n  'M2S': 5.28,\n  'GND': 6.67,\n  'GNC': 4.6,\n  'MVA': 2.56,\n  'OLZ': 5.32,\n  'M2L': 6.15,\n  'TRF': 6.69,\n  'NZH': 7.66,\n  'SRZ': 5.27,\n  'OLD': 10.47,\n  'CME': 5.86,\n  'CMH': 5.3,\n  'ALA': 2.38,\n  'TRQ': 7.36,\n  'PPN': 7.24,\n  'TRP': 6.07,\n  'TRO': 5.82,\n  'TRN': 5.95,\n  'NYS': 8.1,\n  'ALC': 5.26,\n  'U3X': 11.7,\n  'HVA': 2.58,\n  'TS9': 3.92,\n  'TRX': 7.27,\n  'TRW': 11.8,\n  'LPL': 7.51,\n  'GMA': 4.4,\n  'OMT': 5.07,\n  'CMT': 3.54,\n  'GME': 4.66,\n  'NYB': 6.07,\n  'PR3': 5.12,\n  'LPD': 2.48,\n  'GLU': 4.49,\n  '1X6': 6.84,\n  'LPG': 2.39,\n  'GLX': 4.52,\n  'PR4': 4.52,\n  'CML': 6.16,\n  'FME': 4.52,\n  'HTR': 6.48,\n  'PR7': 4.66,\n  'Z3E': 7.2,\n  'GLZ': 2.39,\n  'BMT': 6.37,\n  'WRP': 8.16,\n  'GLY': 2.37,\n  'OMY': 6.11,\n  'MTY': 5.46,\n  'OMX': 6.15,\n  'GLN': 4.46,\n  '2XA': 8.25,\n  '28X': 7.84,\n  '7JA': 9.46,\n  'FLT': 9.65,\n  'GLJ': 3.7,\n  'OMH': 5.26,\n  'TSY': 4.26,\n  'PRV': 4.28,\n  'CS4': 11.21,\n  'DOA': 12.33,\n  '23P': 5.42,\n  'CS3': 8.24,\n  '6CL': 6.47,\n  'PRR': 5.58,\n  'KST': 11.58,\n  'CS1': 7.23,\n  'PRS': 2.63,\n  'ZYJ': 11.4,\n  'IT1': 9.75,\n  'UU5': 4.98,\n  'ESB': 6.69,\n  'UU4': 2.49,\n  'ESC': 5.65,\n  'LSO': 10.58,\n  'ZYK': 11.45,\n  '9NV': 8.99,\n  '23F': 5.27,\n  'ORN': 4.25,\n  'HOX': 6.61,\n  'CSD': 3.95,\n  'FP9': 3.03,\n  'DO2': 4.44,\n  'SLL': 11.53,\n  'P3Q': 9.54,\n  'ORQ': 6.04,\n  'MSL': 5.21,\n  'DNP': 2.45,\n  'CSB': 3.51,\n  'WLU': 4.24,\n  'CSA': 5.7,\n  'MT2': 5.51,\n  'CSO': 3.53,\n  'TPO': 4.73,\n  'MSP': 13.11,\n  '23S': 6.09,\n  'MSO': 4.96,\n  'PRO': 2.41,\n  'TPL': 5.41,\n  'DNS': 8.79,\n  'CSK': 3.91,\n  'Z70': 7.4,\n  'CSJ': 7.51,\n  'DNW': 7.97,\n  'PRK': 9.15,\n  'GSU': 11.81,\n  'LTA': 6.57,\n  'HPE': 6.63,\n  'TPQ': 6.48,\n  'PRJ': 5.26,\n  'PSW': 4.65,\n  'L3O': 3.89,\n  'CSU': 4.89,\n  'ALY': 7.38,\n  'M3L': 7.12,\n  'CSW': 3.68,\n  'XPR': 7.68,\n  'D4P': 5.66,\n  'FOE': 8.17,\n  'SLZ': 5.69,\n  'CSP': 5.26,\n  'TQI': 7.68,\n  'ALT': 2.72,\n  'CSR': 5.42,\n  'CSS': 3.61,\n  'M3R': 7.18,\n  'ALO': 2.57,\n  'R4K': 4.67,\n  'SMF': 9.0,\n  'MSA': 2.73,\n  'SMC': 3.39,\n  'CSX': 3.47,\n  'SME': 4.8,\n  'ETA': 2.4,\n  'CSZ': 3.6,\n  '22G': 8.8,\n  'MSE': 4.62,\n  'ALN': 6.16,\n  'PSH': 7.26,\n  'CTE': 7.27,\n  'DON': 6.72,\n  'CTH': 3.45,\n  'U2X': 11.54,\n  '6CW': 7.56,\n  'TQZ': 6.97,\n  '3YM': 6.52,\n  'OSE': 4.49,\n  '2VA': 9.82,\n  'TQQ': 7.76,\n  'NRG': 8.35,\n  'BPE': 7.24,\n  'F2F': 6.25,\n  '1TQ': 8.58,\n  'I2M': 3.13,\n  'NVA': 3.76,\n  'R1A': 8.2,\n  'QPA': 6.95,\n  'C1X': 11.63,\n  'FRD': 5.05,\n  'HR7': 6.98,\n  'SNC': 3.93,\n  'QPH': 5.15,\n  '26B': 8.39,\n  'DPQ': 6.54,\n  'DPP': 2.51,\n  '2TY': 8.65,\n  'TNR': 6.88,\n  'PTH': 8.35,\n  'DPL': 3.58,\n  'APK': 8.79,\n  '1TY': 8.84,\n  'HRG': 7.36,\n  'PTM': 8.74,\n  '1U8': 3.62,\n  'PTR': 8.64,\n  'LVG': 3.01,\n  '6FL': 4.85,\n  'SOC': 4.05,\n  'KPI': 9.79,\n  'IPG': 2.91,\n  'P2Y': 2.51,\n  'N2C': 3.55,\n  'T0I': 7.34,\n  'MPH': 5.29,\n  'R2T': 4.71,\n  'TOX': 6.78,\n  'P2Q': 9.8,\n  'GPL': 10.77,\n  'MPJ': 5.07,\n  'F2Y': 6.2,\n  'T11': 8.58,\n  '9NR': 9.33,\n  'FPR': 8.85,\n  '9NF': 8.93,\n  'KPY': 10.17,\n  '9NE': 9.77,\n  'TOQ': 7.5,\n  'MPQ': 4.2,\n  'FPK': 3.08,\n  'HQA': 7.25,\n  'SOY': 10.94\n}\nexport const DefaultResidueRadius = 5.0\n\n// http://dx.doi.org/10.1039/b801115j (or 1.6)\nexport const CovalentRadii: { [e: number]: number | undefined } = {\n  1: 0.31, 2: 0.28, 3: 1.28, 4: 0.96, 5: 0.84, 6: 0.76, 7: 0.71, 8: 0.66, 9: 0.57, 10: 0.58, 11: 1.66, 12: 1.41, 13: 1.21, 14: 1.11, 15: 1.07, 16: 1.05, 17: 1.02, 18: 1.06, 19: 2.03, 20: 1.76, 21: 1.7, 22: 1.6, 23: 1.53, 24: 1.39, 25: 1.39, 26: 1.32, 27: 1.26, 28: 1.24, 29: 1.32, 30: 1.22, 31: 1.22, 32: 1.2, 33: 1.19, 34: 1.2, 35: 1.2, 36: 1.16, 37: 2.2, 38: 1.95, 39: 1.9, 40: 1.75, 41: 1.64, 42: 1.54, 43: 1.47, 44: 1.46, 45: 1.42, 46: 1.39, 47: 1.45, 48: 1.44, 49: 1.42, 50: 1.39, 51: 1.39, 52: 1.38, 53: 1.39, 54: 1.4, 55: 2.44, 56: 2.15, 57: 2.07, 58: 2.04, 59: 2.03, 60: 2.01, 61: 1.99, 62: 1.98, 63: 1.98, 64: 1.96, 65: 1.94, 66: 1.92, 67: 1.92, 68: 1.89, 69: 1.9, 70: 1.87, 71: 1.87, 72: 1.75, 73: 1.7, 74: 1.62, 75: 1.51, 76: 1.44, 77: 1.41, 78: 1.36, 79: 1.36, 80: 1.32, 81: 1.45, 82: 1.46, 83: 1.48, 84: 1.4, 85: 1.5, 86: 1.5, 87: 2.6, 88: 2.21, 89: 2.15, 90: 2.06, 91: 2.0, 92: 1.96, 93: 1.9, 94: 1.87, 95: 1.8, 96: 1.69, 97: 1.6, 98: 1.6, 99: 1.6, 100: 1.6, 101: 1.6, 102: 1.6, 103: 1.6, 104: 1.6, 105: 1.6, 106: 1.6, 107: 1.6, 108: 1.6, 109: 1.6, 110: 1.6, 111: 1.6, 112: 1.6, 113: 1.6, 114: 1.6, 115: 1.6, 116: 1.6, 117: 1.6, 118: 1.6\n}\nexport const DefaultCovalentRadius = 1.6\n\nexport const Valences: { [e: number]: number[] | undefined } = {\n  1: [ 1 ],\n  2: [ 0 ],\n  3: [ 1 ],\n  4: [ 2 ],\n  5: [ 3 ],\n  6: [ 4 ],\n  7: [ 3 ],\n  8: [ 2 ],\n  9: [ 1 ],\n  10: [ 0 ],\n  11: [ 1 ],\n  12: [ 2 ],\n  13: [ 6 ],\n  14: [ 6 ],\n  15: [ 3, 5, 7 ],\n  16: [ 2, 4, 6 ],\n  17: [ 1 ],\n  18: [ 0 ],\n  19: [ 1 ],\n  20: [ 2 ],\n\n  31: [ 3 ],\n  32: [ 4 ],\n  33: [ 3, 5 ],\n  34: [ 2, 4, 6 ],\n  35: [ 1 ],\n  36: [ 0 ],\n  37: [ 1 ],\n  38: [ 2 ],\n\n  49: [ 3 ],\n  50: [ 4 ],\n  51: [ 3, 5 ],\n  52: [ 2 ],\n  53: [ 1, 2, 5 ],\n  54: [ 0, 2 ],\n  55: [ 1 ],\n  56: [ 2 ],\n\n  81: [ 3 ],\n  82: [ 4 ],\n  83: [ 3 ],\n  84: [ 2 ],\n  85: [ 1 ],\n  86: [ 0 ],\n  87: [ 1 ],\n  88: [ 2 ]\n}\nexport const DefaultValence = -1\n\nexport const OuterShellElectronCounts: { [e: number]: number | undefined } = {\n1: 1, 2: 2, 3: 1, 4: 2, 5: 3, 6: 4, 7: 5, 8: 6, 9: 7, 10: 8, 11: 1, 12: 2, 13: 3, 14: 4, 15: 5, 16: 6, 17: 7, 18: 8, 19: 1, 20: 2, 21: 3, 22: 4, 23: 5, 24: 6, 25: 7, 26: 8, 27: 9, 28: 10, 29: 11, 30: 2, 31: 3, 32: 4, 33: 5, 34: 6, 35: 7, 36: 8, 37: 1, 38: 2, 39: 3, 40: 4, 41: 5, 42: 6, 43: 7, 44: 8, 45: 9, 46: 10, 47: 11, 48: 2, 49: 3, 50: 4, 51: 5, 52: 6, 53: 7, 54: 8, 55: 1, 56: 2, 57: 3, 58: 4, 59: 3, 60: 4, 61: 5, 62: 6, 63: 7, 64: 8, 65: 9, 66: 10, 67: 11, 68: 12, 69: 13, 70: 14, 71: 15, 72: 4, 73: 5, 74: 6, 75: 7, 76: 8, 77: 9, 78: 10, 79: 11, 80: 2, 81: 3, 82: 4, 83: 5, 84: 6, 85: 7, 86: 8, 87: 1, 88: 2, 89: 3, 90: 4, 91: 3, 92: 4, 93: 5, 94: 6, 95: 7, 96: 8, 97: 9, 98: 10, 99: 11, 100: 12, 101: 13, 102: 14, 103: 15, 104: 2, 105: 2, 106: 2, 107: 2, 108: 2, 109: 2, 110: 2, 111: 2, 112: 2, 113: 3, 114: 4, 115: 5, 116: 6, 117: 7, 118: 8\n}\nexport const DefaultOuterShellElectronCount = 2\n\n// http://blanco.biomol.uci.edu/Whole_residue_HFscales.txt\n// https://www.nature.com/articles/nsb1096-842\nexport const ResidueHydrophobicity: { [k: string]: [number, number, number] } = {\n  // AA  DGwif   DGwoct  Oct-IF\n  'ALA': [ 0.17, 0.50, 0.33 ],\n  'ARG': [ 0.81, 1.81, 1.00 ],\n  'ASN': [ 0.42, 0.85, 0.43 ],\n  'ASP': [ 1.23, 3.64, 2.41 ],\n  'ASH': [ -0.07, 0.43, 0.50 ],\n  'CYS': [ -0.24, -0.02, 0.22 ],\n  'GLN': [ 0.58, 0.77, 0.19 ],\n  'GLU': [ 2.02, 3.63, 1.61 ],\n  'GLH': [ -0.01, 0.11, 0.12 ],\n  'GLY': [ 0.01, 1.15, 1.14 ],\n  // \"His+\": [  0.96,  2.33,  1.37 ],\n  'HIS': [ 0.17, 0.11, -0.06 ],\n  'ILE': [ -0.31, -1.12, -0.81 ],\n  'LEU': [ -0.56, -1.25, -0.69 ],\n  'LYS': [ 0.99, 2.80, 1.81 ],\n  'MET': [ -0.23, -0.67, -0.44 ],\n  'PHE': [ -1.13, -1.71, -0.58 ],\n  'PRO': [ 0.45, 0.14, -0.31 ],\n  'SER': [ 0.13, 0.46, 0.33 ],\n  'THR': [ 0.14, 0.25, 0.11 ],\n  'TRP': [ -1.85, -2.09, -0.24 ],\n  'TYR': [ -0.94, -0.71, 0.23 ],\n  'VAL': [ 0.07, -0.46, -0.53 ]\n}\nexport const DefaultResidueHydrophobicity = [ 0.00, 0.00, 0.00 ]\n\nexport const AA1: { [k: string]: string } = {\n  'HIS': 'H',\n  'ARG': 'R',\n  'LYS': 'K',\n  'ILE': 'I',\n  'PHE': 'F',\n  'LEU': 'L',\n  'TRP': 'W',\n  'ALA': 'A',\n  'MET': 'M',\n  'PRO': 'P',\n  'CYS': 'C',\n  'ASN': 'N',\n  'VAL': 'V',\n  'GLY': 'G',\n  'SER': 'S',\n  'GLN': 'Q',\n  'TYR': 'Y',\n  'ASP': 'D',\n  'GLU': 'E',\n  'THR': 'T',\n\n  'SEC': 'U',  // as per IUPAC definition\n  'PYL': 'O',  // as per IUPAC definition\n}\n\nexport const AA3 = Object.keys(AA1)\n\nexport const RnaBases = [ 'A', 'C', 'T', 'G', 'U', 'I' ]\n\nexport const DnaBases = [ 'DA', 'DC', 'DT', 'DG', 'DU', 'DI' ]\n\nexport const PurinBases = [ 'A', 'G', 'I', 'DA', 'DG', 'DI' ]\n\nexport const Bases = RnaBases.concat(DnaBases)\n\nexport const WaterNames = [\n  'SOL', 'WAT', 'HOH', 'H2O', 'W', 'DOD', 'D3O', 'TIP3', 'TIP4', 'SPC'\n]\n\n// all chemical components with the word \"ion\" in their name, Sep 2016\n//\n// SET SESSION group_concat_max_len = 1000000;\n// SELECT GROUP_CONCAT(id_ ORDER BY id_ ASC SEPARATOR '\", \"') from\n// (\n//     SELECT count(obj_id) as c, id_\n//     FROM pdb.chem_comp WHERE name LIKE \"% ION%\"\n//     GROUP BY id_\n// ) AS t1;\nexport const IonNames = [\n  '118', '119', '1AL', '1CU', '2FK', '2HP', '2OF', '3CO',\n  '3MT', '3NI', '3OF', '3P8', '4MO', '4PU', '543', '6MO', 'ACT', 'AG', 'AL',\n  'ALF', 'AM', 'ATH', 'AU', 'AU3', 'AUC', 'AZI', 'BA', 'BCT', 'BEF', 'BF4', 'BO4',\n  'BR', 'BS3', 'BSY', 'CA', 'CAC', 'CD', 'CD1', 'CD3', 'CD5', 'CE', 'CHT', 'CL',\n  'CO', 'CO3', 'CO5', 'CON', 'CR', 'CS', 'CSB', 'CU', 'CU1', 'CU3', 'CUA', 'CUZ',\n  'CYN', 'DME', 'DMI', 'DSC', 'DTI', 'DY', 'E4N', 'EDR', 'EMC', 'ER3', 'EU',\n  'EU3', 'F', 'FE', 'FE2', 'FPO', 'GA', 'GD3', 'GEP', 'HAI', 'HG', 'HGC', 'IN',\n  'IOD', 'IR', 'IR3', 'IRI', 'IUM', 'K', 'KO4', 'LA', 'LCO', 'LCP', 'LI', 'LU',\n  'MAC', 'MG', 'MH2', 'MH3', 'MLI', 'MLT', 'MMC', 'MN', 'MN3', 'MN5', 'MN6',\n  'MO1', 'MO2', 'MO3', 'MO4', 'MO5', 'MO6', 'MOO', 'MOS', 'MOW', 'MW1', 'MW2',\n  'MW3', 'NA', 'NA2', 'NA5', 'NA6', 'NAO', 'NAW', 'NCO', 'NET', 'NH4', 'NI',\n  'NI1', 'NI2', 'NI3', 'NO2', 'NO3', 'NRU', 'O4M', 'OAA', 'OC1', 'OC2', 'OC3',\n  'OC4', 'OC5', 'OC6', 'OC7', 'OC8', 'OCL', 'OCM', 'OCN', 'OCO', 'OF1', 'OF2',\n  'OF3', 'OH', 'OS', 'OS4', 'OXL', 'PB', 'PBM', 'PD', 'PDV', 'PER', 'PI', 'PO3',\n  'PO4', 'PR', 'PT', 'PT4', 'PTN', 'RB', 'RH3', 'RHD', 'RU', 'SB', 'SCN', 'SE4',\n  'SEK', 'SM', 'SMO', 'SO3', 'SO4', 'SR', 'T1A', 'TB', 'TBA', 'TCN', 'TEA', 'TH',\n  'THE', 'TL', 'TMA', 'TRA', 'UNX', 'V', 'VN3', 'VO4', 'W', 'WO5', 'Y1', 'YB',\n  'YB2', 'YH', 'YT3', 'ZCM', 'ZN', 'ZN2', 'ZN3', 'ZNO', 'ZO3',\n    // additional ion names\n  'OHX'\n]\n\n// all chemical components with the word \"%saccharide%\" in their type, Sep 2016\n//\n// SET SESSION group_concat_max_len = 1000000;\n// select GROUP_CONCAT(id_ ORDER BY id_ ASC SEPARATOR '\", \"') from\n// (\n//     SELECT count(obj_id), id_\n//     FROM pdb.chem_comp WHERE type like \"%SACCHARIDE%\"\n//     GROUP BY id_\n// ) AS t1;\nexport const SaccharideNames = [\n  '045', '0AT', '0BD', '0MK', '0NZ', '0TS', '0V4', '0XY', '0YT', '10M',\n  '147', '149', '14T', '15L', '16G', '18T', '18Y', '1AR', '1BW', '1GL', '1GN',\n  '1JB', '1LL', '1NA', '1S3', '26M', '26Q', '26R', '26V', '26W', '26Y', '27C',\n  '289', '291', '293', '2DG', '2F8', '2FG', '2FL', '2FP', '2GL', '2M4', '2M5',\n  '32O', '34V', '3CM', '3DO', '3DY', '3FM', '3LR', '3MF', '3MG', '3SA', '3ZW',\n  '46D', '46M', '46Z', '48Z', '4CQ', '4GC', '4NN', '50A', '5DI', '5GF', '5MM',\n  '5RP', '5SA', '5SP', '64K', '6PG', '6SA', '7JZ', '7SA', 'A1Q', 'A2G', 'AAB',\n  'AAL', 'AAO', 'ABC', 'ABD', 'ABE', 'ABF', 'ABL', 'ACG', 'ACI', 'ACR', 'ACX',\n  'ADA', 'ADG', 'ADR', 'AF1', 'AFD', 'AFL', 'AFO', 'AFP', 'AFR', 'AGC', 'AGH',\n  'AGL', 'AHR', 'AIG', 'ALL', 'ALX', 'AMU', 'AOG', 'AOS', 'ARA', 'ARB', 'ARE',\n  'ARI', 'ASG', 'ASO', 'AXP', 'AXR', 'B0D', 'B16', 'B2G', 'B4G', 'B6D', 'B8D',\n  'B9D', 'BBK', 'BCD', 'BDG', 'BDP', 'BDR', 'BEM', 'BFP', 'BGC', 'BGL', 'BGP',\n  'BGS', 'BHG', 'BMA', 'BMX', 'BNG', 'BNX', 'BOG', 'BRI', 'BXF', 'BXP', 'BXX',\n  'BXY', 'C3X', 'C4X', 'C5X', 'CAP', 'CBI', 'CBK', 'CBS', 'CDR', 'CEG', 'CGF',\n  'CHO', 'CR1', 'CR6', 'CRA', 'CT3', 'CTO', 'CTR', 'CTT', 'D6G', 'DAF', 'DAG',\n  'DDA', 'DDB', 'DDL', 'DEL', 'DFR', 'DFX', 'DG0', 'DGC', 'DGD', 'DGM', 'DGS',\n  'DIG', 'DLF', 'DLG', 'DMU', 'DNO', 'DOM', 'DP5', 'DQQ', 'DQR', 'DR2', 'DR3',\n  'DR4', 'DRI', 'DSR', 'DT6', 'DVC', 'E4P', 'E5G', 'EAG', 'EBG', 'EBQ', 'EGA',\n  'EJT', 'EPG', 'ERE', 'ERI', 'F1P', 'F1X', 'F6P', 'FBP', 'FCA', 'FCB', 'FCT',\n  'FDP', 'FDQ', 'FFC', 'FIX', 'FMO', 'FRU', 'FSI', 'FU4', 'FUB', 'FUC', 'FUD',\n  'FUL', 'FXP', 'G16', 'G1P', 'G2F', 'G3I', 'G4D', 'G4S', 'G6D', 'G6P', 'G6S',\n  'GAC', 'GAD', 'GAL', 'GC1', 'GC4', 'GCD', 'GCN', 'GCO', 'GCS', 'GCT', 'GCU',\n  'GCV', 'GCW', 'GCX', 'GE1', 'GFG', 'GFP', 'GIV', 'GL0', 'GL2', 'GL5', 'GL6',\n  'GL7', 'GL9', 'GLA', 'GLB', 'GLC', 'GLD', 'GLF', 'GLG', 'GLO', 'GLP', 'GLS',\n  'GLT', 'GLW', 'GMH', 'GN1', 'GNX', 'GP1', 'GP4', 'GPH', 'GPM', 'GQ1', 'GQ2',\n  'GQ4', 'GS1', 'GS4', 'GSA', 'GSD', 'GTE', 'GTH', 'GTK', 'GTR', 'GTZ', 'GU0',\n  'GU1', 'GU2', 'GU3', 'GU4', 'GU5', 'GU6', 'GU8', 'GU9', 'GUF', 'GUP', 'GUZ',\n  'GYP', 'GYV', 'H2P', 'HDL', 'HMS', 'HS2', 'HSD', 'HSG', 'HSH', 'HSJ', 'HSQ',\n  'HSR', 'HSU', 'HSX', 'HSY', 'HSZ', 'IAB', 'IDG', 'IDR', 'IDS', 'IDT', 'IDU',\n  'IDX', 'IDY', 'IMK', 'IN1', 'IPT', 'ISL', 'KBG', 'KD2', 'KDA', 'KDM', 'KDO',\n  'KFN', 'KO1', 'KO2', 'KTU', 'L6S', 'LAG', 'LAI', 'LAK', 'LAO', 'LAT', 'LB2',\n  'LBT', 'LCN', 'LDY', 'LGC', 'LGU', 'LM2', 'LMT', 'LMU', 'LOG', 'LOX', 'LPK',\n  'LSM', 'LTM', 'LVZ', 'LXB', 'LXZ', 'M1F', 'M3M', 'M6P', 'M8C', 'MA1', 'MA2',\n  'MA3', 'MAB', 'MAG', 'MAL', 'MAN', 'MAT', 'MAV', 'MAW', 'MBG', 'MCU', 'MDA',\n  'MDM', 'MDP', 'MFA', 'MFB', 'MFU', 'MG5', 'MGA', 'MGL', 'MLB', 'MMA', 'MMN',\n  'MN0', 'MRP', 'MTT', 'MUG', 'MVP', 'MXY', 'N1L', 'N9S', 'NAA', 'NAG', 'NBG',\n  'NDG', 'NED', 'NG1', 'NG6', 'NGA', 'NGB', 'NGC', 'NGE', 'NGF', 'NGL', 'NGS',\n  'NGY', 'NHF', 'NM6', 'NM9', 'NTF', 'NTO', 'NTP', 'NXD', 'NYT', 'OPG', 'OPM',\n  'ORP', 'OX2', 'P3M', 'P53', 'P6P', 'PA5', 'PNA', 'PNG', 'PNW', 'PRP', 'PSJ',\n  'PSV', 'PTQ', 'QDK', 'QPS', 'QV4', 'R1P', 'R1X', 'R2B', 'R5P', 'RAA', 'RAE',\n  'RAF', 'RAM', 'RAO', 'RAT', 'RB5', 'RBL', 'RCD', 'RDP', 'REL', 'RER', 'RF5',\n  'RG1', 'RGG', 'RHA', 'RIB', 'RIP', 'RNS', 'RNT', 'ROB', 'ROR', 'RPA', 'RST',\n  'RUB', 'RUU', 'RZM', 'S6P', 'S7P', 'SA0', 'SCR', 'SDD', 'SF6', 'SF9', 'SG4',\n  'SG5', 'SG6', 'SG7', 'SGA', 'SGC', 'SGD', 'SGN', 'SGS', 'SHB', 'SHG', 'SI3',\n  'SIO', 'SOE', 'SOL', 'SSG', 'SUC', 'SUP', 'SUS', 'T6P', 'T6T', 'TAG', 'TCB',\n  'TDG', 'TGK', 'TGY', 'TH1', 'TIA', 'TM5', 'TM6', 'TM9', 'TMR', 'TMX', 'TOA',\n  'TOC', 'TRE', 'TYV', 'UCD', 'UDC', 'VG1', 'X0X', 'X1X', 'X2F', 'X4S', 'X5S',\n  'X6X', 'XBP', 'XDN', 'XDP', 'XIF', 'XIM', 'XLF', 'XLS', 'XMM', 'XUL', 'XXR',\n  'XYP', 'XYS', 'YO5', 'Z3Q', 'Z6J', 'Z9M', 'ZDC', 'ZDM'\n]\n\nexport const ProteinBackboneAtoms = [\n  'CA', 'C', 'N', 'O',\n  'O1', 'O2', 'OC1', 'OC2', 'OX1', 'OXT', 'OT1', 'OT2',\n  'H', 'H1', 'H2', 'H3', 'HA', 'HN',\n  'BB'\n]\n\nexport const NucleicBackboneAtoms = [\n  'P', 'OP1', 'OP2', 'HOP2', 'HOP3',\n  \"O2'\", \"O3'\", \"O4'\", \"O5'\", \"C1'\", \"C2'\", \"C3'\", \"C4'\", \"C5'\",\n  \"H1'\", \"H2'\", \"H2''\", \"HO2'\", \"H3'\", \"H4'\", \"H5'\", \"H5''\", \"HO3'\", \"HO5'\",\n  'O2*', 'O3*', 'O4*', 'O5*', 'C1*', 'C2*', 'C3*', 'C4*', 'C5*'\n]\n\nexport const ResidueTypeAtoms: { [k: number]: { [k: string]: string|string[] } } = {}\n\nResidueTypeAtoms[ ProteinBackboneType ] = {\n  trace: 'CA',\n  direction1: 'C',\n  direction2: [ 'O', 'OC1', 'O1', 'OX1', 'OXT', 'OT1', 'OT2' ],\n  backboneStart: 'N',\n  backboneEnd: 'C'\n}\n\nResidueTypeAtoms[ RnaBackboneType ] = {\n  trace: [ \"C4'\", 'C4*' ],\n  direction1: [ \"C1'\", 'C1*' ],\n  direction2: [ \"C3'\", 'C3*' ],\n  backboneStart: 'P',\n  backboneEnd: [ \"O3'\", 'O3*' ]\n}\n\nResidueTypeAtoms[ DnaBackboneType ] = {\n  trace: [ \"C3'\", 'C3*' ],\n  direction1: [ \"C2'\", 'C2*' ],\n  direction2: [ \"O4'\", 'O4*' ],\n  backboneStart: 'P',\n  backboneEnd: [ \"O3'\", 'O3*' ]\n}\n\nResidueTypeAtoms[ CgProteinBackboneType ] = {\n  trace: [ 'CA', 'BB' ],\n  backboneStart: [ 'CA', 'BB' ],\n  backboneEnd: [ 'CA', 'BB' ]\n}\n\nResidueTypeAtoms[ CgRnaBackboneType ] = {\n  trace: [ \"C4'\", 'C4*', 'P' ],\n  backboneStart: [ \"C4'\", 'C4*', 'P' ],\n  backboneEnd: [ \"C4'\", 'C4*', 'P' ]\n}\n\nResidueTypeAtoms[ CgDnaBackboneType ] = {\n  trace: [ \"C3'\", 'C3*', \"C2'\", 'P' ],  // C2' is used in martini ff\n  backboneStart: [ \"C3'\", 'C3*', \"C2'\", 'P' ],\n  backboneEnd: [ \"C3'\", 'C3*', \"C2'\", 'P' ]\n}\n\nResidueTypeAtoms[ UnknownBackboneType ] = {}\n\n// Mappings taken from Meeko: https://github.com/forlilab/Meeko/blob/develop/meeko/utils/autodock4_atom_types_elements.py\nexport const PDBQTSpecialElements = {\n  'HD':  'H',\n  'HS':  'H',\n  'A':   'C',\n  'NA':  'N',\n  'NS':  'N',\n  'OA':  'O',\n  'OS':  'O',\n  'SA':  'S',\n  'G0':  'C',\n  'G1':  'C',\n  'G2':  'C',\n  'G3':  'C',\n  'CG0': 'C',\n  'CG1': 'C',\n  'CG2': 'C',\n  'CG3': 'C',\n  'W':   'O'\n}","/**\n * @file Geometry\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { Vector3 } from 'three'\n\nimport { Elements } from '../structure/structure-constants'\nimport { degToRad } from '../math/math-utils'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// Changed numbering so they're mostly inline with coordination number\n// from VSEPR\nexport const enum AtomGeometry {\n  Spherical = 0,\n  Terminal = 1,\n  Linear = 2,\n  Trigonal = 3,\n  Tetrahedral = 4,\n  TrigonalBiPyramidal = 5,\n  Octahedral = 6,\n  SquarePlanar = 7, // Okay, it breaks down somewhere!\n  Unknown = 8\n}\n\nexport function assignGeometry (totalCoordination: number): AtomGeometry {\n  switch(totalCoordination){\n    case 0:\n      return AtomGeometry.Spherical\n    case 1:\n      return AtomGeometry.Terminal\n    case 2:\n      return AtomGeometry.Linear\n    case 3:\n      return AtomGeometry.Trigonal\n    case 4:\n      return AtomGeometry.Tetrahedral\n    default:\n      return AtomGeometry.Unknown\n  }\n}\n\nexport const Angles = new Map<AtomGeometry, number>([\n  [ AtomGeometry.Linear, degToRad(180) ],\n  [ AtomGeometry.Trigonal, degToRad(120) ],\n  [ AtomGeometry.Tetrahedral, degToRad(109.4721) ],\n  [ AtomGeometry.Octahedral, degToRad(90) ]\n])\n\n/**\n * Calculate the angles x-1-2 for all x where x is a heavy atom bonded to ap1.\n * @param  {AtomProxy} ap1 First atom (angle centre)\n * @param  {AtomProxy} ap2 Second atom\n * @return {number[]}        Angles in radians\n */\nexport function calcAngles (ap1: AtomProxy, ap2: AtomProxy): number[] {\n  let angles: number[] = []\n  const d1 = new Vector3()\n  const d2 = new Vector3()\n  d1.subVectors(ap2 as any, ap1 as any)\n  ap1.eachBondedAtom( x => {\n    if (x.number !== Elements.H) {\n      d2.subVectors(x as any, ap1 as any)\n      angles.push(d1.angleTo(d2))\n    }\n   })\n  return angles\n}\n\n/**\n * Find two neighbours of ap1 to define a plane (if possible) and\n * measure angle out of plane to ap2\n * @param  {AtomProxy} ap1 First atom (angle centre)\n * @param  {AtomProxy} ap2 Second atom (out-of-plane)\n * @return {number}        Angle from plane to second atom\n */\nexport function calcPlaneAngle (ap1: AtomProxy, ap2: AtomProxy): number | undefined {\n  const x1 = ap1.clone()\n\n  const v12 = new Vector3()\n  v12.subVectors(ap2 as any, ap1 as any)\n\n  const neighbours = [new Vector3(), new Vector3()]\n  let ni = 0\n  ap1.eachBondedAtom( x => {\n    if (ni > 1) { return }\n    if (x.number !== Elements.H) {\n      x1.index = x.index\n      neighbours[ni++].subVectors(x as any, ap1 as any)\n    }\n  })\n  if (ni === 1) {\n    x1.eachBondedAtom( x => {\n      if (ni > 1) { return }\n      if (x.number !== Elements.H && x.index !== ap1.index){\n        neighbours[ni++].subVectors(x as any, ap1 as any)\n      }\n    })\n  }\n  if (ni !== 2) {\n    return\n  }\n\n  const cp = neighbours[0].cross(neighbours[1])\n  return Math.abs((Math.PI / 2) - cp.angleTo(v12))\n}\n","/**\n * @file Valence Model\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * Reworked ValenceModel\n *\n * TODO:\n *   Ensure proper treatment of disorder/models. e.g. V257 N in 5vim\n *   Formal charge of 255 for SO4 anion (e.g. 5ghl)\n *   Have removed a lot of explicit features (as I think they're more\n *   generally captured by better VM).\n *     Could we instead have a \"delocalised negative/positive\" charge\n *     feature and flag these up?\n *\n */\nimport { Data } from '../structure/data'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { AtomGeometry, assignGeometry } from './geometry'\nimport { Elements } from '../structure/structure-constants'\n\n/**\n * Are we involved in some kind of pi system. Either explicitly forming\n * double bond or N, O next to a double bond, except:\n *\n *   N,O with degree 4 cannot be conjugated.\n *   N,O adjacent to P=O or S=O do not qualify (keeps sulfonamide N sp3 geom)\n */\nfunction isConjugated (a: AtomProxy) {\n  const _bp = a.structure.getBondProxy()\n  const atomicNumber = a.number\n  const hetero = atomicNumber === Elements.O || atomicNumber === Elements.N\n\n  if (hetero && a.bondCount === 4) {\n    return false\n  }\n\n  let flag = false\n\n  a.eachBond(b => {\n    if (b.bondOrder > 1) {\n      flag = true\n      return\n    }\n    if (hetero) {\n      const a2 = b.getOtherAtom(a)\n\n      a2.eachBond(b2 => {\n        if (b2.bondOrder > 1) {\n          const atomicNumber2 = a2.number\n          if (\n            (atomicNumber2 === Elements.P || atomicNumber2 === Elements.S) &&\n            b2.getOtherAtom(a2).number === Elements.O\n          ) {\n            return\n          }\n          flag = true\n        }\n      }, _bp) // Avoid reuse of structure._bp\n    }\n  })\n\n  return flag\n}\n\n/* function hasExplicitCharge(r: ResidueProxy) {\n  let flag = false\n  r.eachAtom(a => {\n    if (a.formalCharge != null && a.formalCharge !== 0) flag = true\n  })\n  return flag\n}\n\nfunction hasExplicitHydrogen(r: ResidueProxy) {\n  let flag = false\n  r.eachAtom(a => {\n    if (a.number === Elements.H) flag = true\n  })\n  return flag\n} */\n\nexport function explicitValence (a: AtomProxy) {\n  let v = 0\n  a.eachBond(b => v += b.bondOrder)\n  return v\n}\n\n/**\n * Attempts to produce a consistent charge and implicit\n * H-count for an atom.\n *\n * If both params.assignCharge and params.assignH, this\n * approximately followsthe rules described in\n * https://docs.eyesopen.com/toolkits/python/oechemtk/valence.html#openeye-hydrogen-count-model\n *\n * If only charge or hydrogens are to be assigned it takes\n * a much simpler view and deduces one from the other\n *\n * @param {AtomProxy}           a      Atom to analyze\n * @param {assignChargeHParams} params What to assign\n */\nexport function calculateHydrogensCharge (a: AtomProxy, params: ValenceModelParams) {\n  const hydrogenCount = a.bondToElementCount(Elements.H)\n  let charge = a.formalCharge || 0\n\n  const assignCharge = (params.assignCharge === 'always' ||\n    (params.assignCharge === 'auto' && charge === 0))\n  const assignH = (params.assignH === 'always' ||\n    (params.assignH === 'auto' && hydrogenCount === 0))\n\n  const degree = a.bondCount\n  const valence = explicitValence(a)\n\n  const conjugated = isConjugated(a)\n  const multiBond = (valence - degree > 0)\n\n\n  let implicitHCount = 0\n  let geom = AtomGeometry.Unknown\n\n  switch (a.number) {\n    case Elements.H:\n      if (assignCharge){\n        if (degree === 0){\n          charge = 1\n          geom = AtomGeometry.Spherical\n        } else if (degree === 1) {\n          charge = 0\n          geom = AtomGeometry.Terminal\n        }\n      }\n      break\n\n    case Elements.C:\n      // TODO: Isocyanide?\n      if (assignCharge) {\n        charge = 0 // Assume carbon always neutral\n      }\n      if (assignH) {\n        // Carbocation/carbanion are 3-valent\n        implicitHCount = Math.max(0, 4 - valence - Math.abs(charge))\n      }\n      // Carbocation is planar, carbanion is tetrahedral\n      geom = assignGeometry(degree + implicitHCount + Math.max(0, -charge))\n      break\n\n    case Elements.N:\n      if (assignCharge) {\n        if (!assignH) { // Trust input H explicitly:\n          charge = valence - 3\n        } else if (conjugated && valence < 4) {\n          // Neutral unless amidine/guanidine double-bonded N:\n          if (degree - hydrogenCount === 1 && valence - hydrogenCount === 2) {\n            charge = 1\n          } else {\n            charge = 0\n          }\n        } else {\n          // Sulfonamide nitrogen and classed as sp3 in conjugation model but\n          // they won't be charged\n          // Don't assign charge to nitrogens bound to metals\n          let flag = false\n          a.eachBondedAtom(ba => {\n            if (ba.number === Elements.S || ba.isMetal()) flag = true\n          })\n          if (flag) charge = 0\n          else charge = 1\n          // TODO: Planarity sanity check?\n        }\n\n      }\n\n      if (assignH) {\n        // NH4+ -> 4, 1' amide -> 2, nitro N/N+ depiction -> 0\n        implicitHCount = Math.max(0, 3 - valence + charge)\n      }\n\n      if (conjugated && !multiBond) {\n        // Amide, anilinic N etc. cannot consider lone-pair for geometry purposes\n        // Anilinic N geometry is depenent on ring electronics, for our purposes we\n        // assume it's trigonal!\n        geom = assignGeometry(degree + implicitHCount - charge)\n      } else {\n        // Everything else, pyridine, amine, nitrile, lp plays normal role:\n        geom = assignGeometry(degree + implicitHCount + 1 - charge)\n      }\n      break\n\n    case Elements.O:\n      if (assignCharge) {\n        if (!assignH) {\n          charge = valence - 2 //\n        }\n        if (valence === 1) {\n          a.eachBondedAtom(ba => {\n            ba.eachBond(b => {\n              const oa = b.getOtherAtom(ba)\n              if (oa.index !== a.index && oa.number === Elements.O && b.bondOrder === 2){\n                charge = -1\n              }\n            })\n          })\n        }\n      }\n      if (assignH) {\n        // ethanol -> 1, carboxylate -> -1\n        implicitHCount = Math.max(0, 2 - valence + charge)\n      }\n      if (conjugated && !multiBond){\n        // carboxylate OH, phenol OH, one lone-pair taken up with conjugation\n        geom = assignGeometry(degree + implicitHCount - charge + 1)\n      } else {\n        // Carbonyl (trigonal)\n        geom = assignGeometry(degree + implicitHCount - charge + 2)\n      }\n      break\n\n    // Only handles thiols/thiolates/thioether/sulfonium. Sulfoxides and higher\n    // oxidiation states are assumed neutral S (charge carried on O if required)\n    case Elements.S:\n      if (assignCharge) {\n        if (!assignH) {\n          if (valence <= 3 && !a.bondToElementCount(Elements.O)) {\n            charge = valence - 2 // e.g. explicitly deprotonated thiol\n          } else {\n            charge = 0\n          }\n        }\n      }\n      if (assignH){\n        if (valence < 2){\n          implicitHCount = Math.max(0, 2 - valence + charge)\n        }\n      }\n      if (valence <= 3){\n        // Thiol, thiolate, tioether -> tetrahedral\n        geom = assignGeometry(degree + implicitHCount - charge + 2)\n      }\n\n      break\n\n    case Elements.F:\n    case Elements.CL:\n    case Elements.BR:\n    case Elements.I:\n    case Elements.AT:\n      // Never implicitly protonate halides\n      if (assignCharge) {\n        charge = valence - 1\n      }\n      break\n\n    case Elements.LI:\n    case Elements.NA:\n    case Elements.K:\n    case Elements.RB:\n    case Elements.CS:\n    case Elements.FR:\n      if (assignCharge) {\n        charge = 1 - valence\n      }\n      break\n\n    case Elements.BE:\n    case Elements.MG:\n    case Elements.CA:\n    case Elements.SR:\n    case Elements.BA:\n    case Elements.RA:\n      if (assignCharge) {\n        charge = 2 - valence\n      }\n      break\n\n    default:\n      console.warn('Requested charge, protonation for an unhandled element', a.element)\n  }\n\n  return [ charge, implicitHCount, implicitHCount + hydrogenCount, geom ]\n}\n\n\nexport interface ValenceModel {\n  charge: Int8Array,\n  implicitH: Int8Array,\n  totalH: Int8Array,\n  idealGeometry: Int8Array\n}\n\nexport interface ValenceModelParams {\n  assignCharge: string,\n  assignH: string\n}\n\nexport function ValenceModel (data: Data, params: ValenceModelParams) {\n  const structure = data.structure\n  const n = structure.atomCount\n\n  const charge = new Int8Array(n)\n  const implicitH = new Int8Array(n)\n  const totalH = new Int8Array(n)\n  const idealGeometry = new Int8Array(n)\n\n  structure.eachAtom(a => {\n    const i = a.index\n    const [ chg, implH, totH, geom ] = calculateHydrogensCharge(a, params)\n    charge[ i ] = chg\n    implicitH[ i ] = implH\n    totalH[ i ] = totH\n    idealGeometry[ i ] = geom\n  })\n\n  return { charge, implicitH, totalH, idealGeometry }\n}","\nimport Structure from './structure'\nimport SpatialHash from '../geometry/spatial-hash'\nimport { ValenceModel } from '../chemistry/valence-model'\n\nexport interface Data {\n  structure: Structure\n  '@spatialLookup': SpatialHash | undefined\n  '@valenceModel': ValenceModel | undefined\n}\n\nexport function createData(structure: Structure): Data {\n  return {\n    structure,\n    '@spatialLookup': undefined,\n    '@valenceModel': undefined\n  }\n}\n\nexport function spatialLookup(data: Data): SpatialHash {\n  if (data['@spatialLookup']) return data['@spatialLookup']!\n  const lookup = new SpatialHash(data.structure.atomStore, data.structure.boundingBox)\n  data['@spatialLookup'] = lookup\n  return lookup\n}\n\nexport function valenceModel(data: Data): ValenceModel {\n  if (data['@valenceModel']) return data['@valenceModel']!\n  const valenceModel = ValenceModel(data, {assignCharge: 'auto', assignH: 'auto'})\n  data['@valenceModel'] = valenceModel\n  return valenceModel\n}\n","/**\n * @file Functional Groups\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport { Elements } from '../structure/structure-constants'\n\n/**\n * Nitrogen in a quaternary amine\n */\nexport function isQuaternaryAmine (a: AtomProxy) {\n  return (\n    a.number === 7 &&\n    a.bondCount === 4 &&\n    a.bondToElementCount(Elements.H) === 0\n  )\n}\n\n/**\n * Nitrogen in a tertiary amine\n */\nexport function isTertiaryAmine (a: AtomProxy, idealValence: number) {\n  return (\n    a.number === 7 &&\n    a.bondCount >= 3 &&\n    idealValence === 3\n  )\n}\n\n/**\n * Nitrogen in an imide\n */\nexport function isImide (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.N && (a.bondCount - a.bondToElementCount(Elements.H)) === 2) {\n    let carbonylCount = 0\n    a.eachBondedAtom(ba => {\n      if (isCarbonyl(ba)) ++carbonylCount\n    })\n    flag = carbonylCount === 2\n  }\n  return flag\n}\n\n/**\n * Nitrogen in an amide\n */\nexport function isAmide (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.N && (a.bondCount - a.bondToElementCount(Elements.H)) === 2) {\n    let carbonylCount = 0\n    a.eachBondedAtom(ba => {\n      if (isCarbonyl(ba)) ++carbonylCount\n    })\n    flag = carbonylCount === 1\n  }\n  return flag\n}\n\n/**\n * Sulfur in a sulfonium group\n */\nexport function isSulfonium (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.H) === 0\n  )\n}\n\n/**\n * Sulfur in a sulfonic acid or sulfonate group\n */\nexport function isSulfonicAcid (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondToElementCount(Elements.O) === 3\n  )\n}\n\n/**\n * Sulfur in a sulfate group\n */\nexport function isSulfate (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondToElementCount(Elements.O) === 4\n  )\n}\n\n/**\n * Phosphor in a phosphate group\n */\nexport function isPhosphate (a: AtomProxy) {\n  return (\n    a.number === 15 &&\n    a.bondToElementCount(Elements.O) === a.bondCount\n  )\n}\n\n/**\n * Halogen with one bond to a carbon\n */\nexport function isHalocarbon (a: AtomProxy) {\n  return (\n    a.isHalogen() &&\n    a.bondCount === 1 &&\n    a.bondToElementCount(Elements.C) === 1\n  )\n}\n\n/**\n * Carbon in a carbonyl/acyl group\n */\nexport function isCarbonyl (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.C) {\n    a.eachBond(b => {\n      if (b.bondOrder === 2 && b.getOtherAtom(a).number === Elements.O) {\n        flag = true\n      }\n    })\n  }\n  return flag\n}\n\n/**\n * Carbon in a carboxylate group\n */\nexport function isCarboxylate (a: AtomProxy) {\n  let terminalOxygenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondToElementCount(Elements.O) === 2 &&\n    a.bondToElementCount(Elements.C) === 1\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.number === 8 && ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalOxygenCount\n      }\n    })\n  }\n  return terminalOxygenCount === 2\n}\n\n/**\n * Carbon in a guanidine group\n */\nexport function isGuanidine (a: AtomProxy) {\n  let terminalNitrogenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.N) === 3\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalNitrogenCount\n      }\n    })\n  }\n  return terminalNitrogenCount === 2\n}\n\n/**\n * Carbon in a acetamidine group\n */\nexport function isAcetamidine (a: AtomProxy) {\n  let terminalNitrogenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.N) === 2 &&\n    a.bondToElementCount(Elements.C) === 1\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalNitrogenCount\n      }\n    })\n  }\n  return terminalNitrogenCount === 2\n}\n\nconst PolarElements = [\n  Elements.N, Elements.O, Elements.S,\n  Elements.F, Elements.CL, Elements.BR, Elements.I\n]\n\nexport function isPolar (a: AtomProxy) {\n  return PolarElements.includes(a.number)\n}\n\nexport function hasPolarNeighbour (a: AtomProxy) {\n  let flag = false\n  a.eachBondedAtom(ba => {\n    if (isPolar(ba)) flag = true\n  })\n  return flag\n}\n\nexport function hasAromaticNeighbour (a: AtomProxy) {\n  let flag = false\n  a.eachBondedAtom(function (bap) {\n    if (bap.aromatic) flag = true\n  })\n  return flag\n}\n","/**\n * @file Charged\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\n\nimport { Vector3 } from 'three'\n\nimport { defaults } from '../../utils'\nimport { radToDeg } from '../../math/math-utils'\nimport Structure from '../../structure/structure'\nimport { AA3, Bases, Elements } from '../../structure/structure-constants'\nimport { valenceModel } from '../../structure/data'\nimport {\n  isGuanidine, isAcetamidine, isSulfonicAcid, isPhosphate, isSulfate, isCarboxylate\n} from '../functional-groups'\nimport {\n  Features, FeatureType, FeatureGroup,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\nconst PositvelyCharged = [ 'ARG', 'HIS', 'LYS' ]\nconst NegativelyCharged = [ 'GLU', 'ASP' ]\n\nexport function addPositiveCharges (structure: Structure, features: Features) {\n  const { charge } = valenceModel(structure.data)\n  const atomInGroupDict: { [atomIndex: number]: true } = {}\n\n  structure.eachResidue(r => {\n    if (PositvelyCharged.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.PositiveCharge)\n      r.eachAtom(a => {\n        if (a.number === Elements.N && a.isSidechain()) {\n          addAtom(state, a)\n        }\n      })\n      addFeature(features, state)\n    } else if(!AA3.includes(r.resname) && !r.isNucleic()) {\n      r.eachAtom(a => {\n        let addGroup = false\n        const state = createFeatureState(FeatureType.PositiveCharge)\n        if (isGuanidine(a)) {\n          state.group = FeatureGroup.Guanidine\n          addGroup = true\n        } else if (isAcetamidine(a)) {\n          state.group = FeatureGroup.Acetamidine\n          addGroup = true\n        }\n        if (addGroup) {\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.N) {\n              atomInGroupDict[a.index] = true\n              addAtom(state, a)\n            }\n          })\n          addFeature(features, state)\n        }\n      })\n      r.eachAtom(a => {\n        const state = createFeatureState(FeatureType.PositiveCharge)\n        if (charge[a.index] > 0) {\n          if (!atomInGroupDict[a.index]) {\n            addAtom(state, a)\n            addFeature(features, state)\n          }\n        }\n      })\n    }\n  })\n}\n\nexport function addNegativeCharges (structure: Structure, features: Features) {\n  const { charge } = valenceModel(structure.data)\n  const atomInGroupDict: { [atomIndex: number]: true } = {}\n\n  structure.eachResidue(r => {\n    if (NegativelyCharged.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.NegativeCharge)\n      r.eachAtom(a => {\n        if (a.number === Elements.O && a.isSidechain()) {\n          addAtom(state, a)\n        }\n      })\n      addFeature(features, state)\n    } else if (Bases.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.NegativeCharge)\n      r.eachAtom(a => {\n        if (isPhosphate(a)) {\n          state.group = FeatureGroup.Phosphate\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.O) addAtom(state, a)\n          })\n          addFeature(features, state)\n        }\n      })\n    } else if(!AA3.includes(r.resname) && !Bases.includes(r.resname)) {\n      r.eachAtom(a => {\n        let addGroup = false\n        const state = createFeatureState(FeatureType.NegativeCharge)\n        if (isSulfonicAcid(a)) {\n          state.group = FeatureGroup.SulfonicAcid\n          addGroup = true\n        } else if (isPhosphate(a)) {\n          state.group = FeatureGroup.Phosphate\n          addGroup = true\n        } else if (isSulfate(a)) {\n          state.group = FeatureGroup.Sulfate\n          addGroup = true\n        } else if (isCarboxylate(a)) {\n          state.group = FeatureGroup.Carboxylate\n          addGroup = true\n        }\n        if (addGroup) {\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.O) {\n              atomInGroupDict[a.index] = true\n              addAtom(state, a)\n            }\n          })\n          addFeature(features, state)\n        }\n      })\n      r.eachAtom(a => {\n        const state = createFeatureState(FeatureType.NegativeCharge)\n        if (charge[a.index] < 0) {\n          if (!atomInGroupDict[a.index]) {\n            addAtom(state, a)\n            addFeature(features, state)\n          }\n        }\n      })\n    }\n  })\n}\n\nexport function addAromaticRings (structure: Structure, features: Features) {\n  const a = structure.getAtomProxy()\n  structure.eachResidue(r => {\n    const rings = r.getAromaticRings()\n    if (rings) {\n      const offset = r.atomOffset\n      rings.forEach(ring => {\n        const state = createFeatureState(FeatureType.AromaticRing)\n        ring.forEach(i => {\n          a.index = i + offset\n          addAtom(state, a)\n        })\n        addFeature(features, state)\n      })\n    }\n  })\n}\n\nfunction isIonicInteraction (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.NegativeCharge && tj === FeatureType.PositiveCharge) ||\n    (ti === FeatureType.PositiveCharge && tj === FeatureType.NegativeCharge)\n  )\n}\n\nfunction isPiStacking (ti: FeatureType, tj: FeatureType) {\n  return ti === FeatureType.AromaticRing && tj === FeatureType.AromaticRing\n}\n\nfunction isCationPi (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.AromaticRing && tj === FeatureType.PositiveCharge) ||\n    (ti === FeatureType.PositiveCharge && tj === FeatureType.AromaticRing)\n  )\n}\n\nexport interface ChargedContactsParams {\n  maxIonicDist?: number\n  maxPiStackingDist?: number\n  maxPiStackingOffset?: number\n  maxPiStackingAngle?: number\n  maxCationPiDist?: number\n  maxCationPiOffset?: number\n  masterModelIndex?: number\n}\n\nexport function addChargedContacts (structure: Structure, contacts: Contacts, params: ChargedContactsParams = {}) {\n  const maxIonicDist = defaults(params.maxIonicDist, ContactDefaultParams.maxIonicDist)\n  const maxPiStackingDist = defaults(params.maxPiStackingDist, ContactDefaultParams.maxPiStackingDist)\n  const maxPiStackingOffset = defaults(params.maxPiStackingOffset, ContactDefaultParams.maxPiStackingOffset)\n  const maxPiStackingAngle = defaults(params.maxPiStackingAngle, ContactDefaultParams.maxPiStackingAngle)\n  const maxCationPiDist = defaults(params.maxCationPiDist, ContactDefaultParams.maxCationPiDist)\n  const maxCationPiOffset = defaults(params.maxCationPiOffset, ContactDefaultParams.maxCationPiOffset)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const maxDistance = Math.max(maxIonicDist + 2, maxPiStackingDist, maxCationPiDist)\n  // const maxSaltBridgeDistSq = maxSaltBridgeDist * maxSaltBridgeDist\n  const maxPiStackingDistSq = maxPiStackingDist * maxPiStackingDist\n  const maxCationPiDistSq = maxCationPiDist * maxCationPiDist\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ax = structure.atomStore.x\n  const ay = structure.atomStore.y\n  const az = structure.atomStore.z\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  const areAtomSetsWithinDist = function (atomSet1: number[], atomSet2: number[], maxDist: number) {\n    const sn = atomSet1.length\n    const sm = atomSet2.length\n    for (let si = 0; si < sn; ++si) {\n      ap1.index = atomSet1[ si ]\n      for (let sj = 0; sj < sm; ++sj) {\n        ap2.index = atomSet2[ sj ]\n        if (ap1.distanceTo(ap2) <= maxDist) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  const v1 = new Vector3()\n  const v2 = new Vector3()\n  const v3 = new Vector3()\n  const d1 = new Vector3()\n  const d2 = new Vector3()\n  const n1 = new Vector3()\n  const n2 = new Vector3()\n\n  const getNormal = function (atoms: number[], normal: Vector3) {\n    v1.set(ax[ atoms[ 0 ] ], ay[ atoms[ 0 ] ], az[ atoms[ 0 ] ])\n    v2.set(ax[ atoms[ 1 ] ], ay[ atoms[ 1 ] ], az[ atoms[ 1 ] ])\n    v3.set(ax[ atoms[ 2 ] ], ay[ atoms[ 2 ] ], az[ atoms[ 2 ] ])\n    d1.subVectors(v1, v2)\n    d2.subVectors(v1, v3)\n    normal.crossVectors(d1, d2)\n  }\n\n  const getOffset = function (i: number, j: number, normal: Vector3) {\n    v1.set(x[ i ], y[ i ], z[ i ])\n    v2.set(x[ j ], y[ j ], z[ j ])\n    return v1.sub(v2).projectOnPlane(normal).add(v2).distanceTo(v2)\n  }\n\n  const add = function (i: number, j: number, ct: ContactType) {\n    featureSet.setBits(i, j)\n    contactStore.addContact(i, j, ct)\n  }\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxDistance, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n\n      const ti = types[ i ]\n      const tj = types[ j ]\n\n      if (isIonicInteraction(ti, tj)) {\n        if (areAtomSetsWithinDist(atomSets[ i ], atomSets[ j ], maxIonicDist)) {\n          add(i, j, ContactType.IonicInteraction)\n        }\n      } else if (isPiStacking(ti, tj)) {\n        if (dSq <= maxPiStackingDistSq) {\n          getNormal(atomSets[ i ], n1)\n          getNormal(atomSets[ j ], n2)\n\n          const angle = radToDeg(n1.angleTo(n2))\n          const offset = Math.min(getOffset(i, j, n2), getOffset(j, i, n1))\n          if (offset <= maxPiStackingOffset) {\n            if (angle <= maxPiStackingAngle || angle >= 180 - maxPiStackingAngle) {\n              add(i, j, ContactType.PiStacking)  // parallel\n            } else if (angle <= maxPiStackingAngle + 90 && angle >= 90 - maxPiStackingAngle) {\n              add(i, j, ContactType.PiStacking)  // t-shaped\n            }\n          }\n        }\n      } else if (isCationPi(ti, tj)) {\n        if (dSq <= maxCationPiDistSq) {\n          const [ l, k ] = ti === FeatureType.AromaticRing ? [ i, j ] : [ j, i ]\n\n          getNormal(atomSets[ l ], n1)\n          const offset = getOffset(k, l, n1)\n          if (offset <= maxCationPiOffset) {\n            add(l, k, ContactType.CationPi)\n          }\n        }\n      }\n    })\n  }\n}\n","/**\n * @file Hydrogen Bonds\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\nimport { defaults } from '../../utils'\nimport { degToRad } from '../../math/math-utils'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport { valenceModel } from '../../structure/data'\nimport { Elements } from '../../structure/structure-constants'\nimport { Angles, AtomGeometry, calcAngles, calcPlaneAngle } from '../geometry'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\n\n// Geometric characteristics of hydrogen bonds involving sulfur atoms in proteins\n// https://doi.org/10.1002/prot.22327\n\n// Satisfying Hydrogen Bonding Potential in Proteins (HBPLUS)\n// https://doi.org/10.1006/jmbi.1994.1334\n// http://www.csb.yale.edu/userguides/datamanip/hbplus/hbplus_descrip.html\n\n/**\n * Potential hydrogen donor\n */\nexport function addHydrogenDonors (structure: Structure, features: Features) {\n  const { totalH } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.HydrogenDonor)\n\n    const an = a.number\n    if (isHistidineNitrogen(a)) {\n      // include both nitrogen atoms in histidine due to\n      // their often ambiguous protonation assignment\n      addAtom(state, a)\n      addFeature(features, state)\n    } else if (\n      totalH[ a.index ] > 0 &&\n      (an === Elements.N || an === Elements.O || an === Elements.S)\n    ) {\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\n/**\n * Weak hydrogen donor.\n */\nexport function addWeakHydrogenDonors (structure: Structure, features: Features) {\n  const { totalH } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    if (\n      a.number === Elements.C &&\n      totalH[ a.index ] > 0 &&\n      (\n        a.bondToElementCount(Elements.N) > 0 ||\n        a.bondToElementCount(Elements.O) > 0 ||\n        inAromaticRingWithElectronNegativeElement(a)\n      )\n    ) {\n      const state = createFeatureState(FeatureType.WeakHydrogenDonor)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction inAromaticRingWithElectronNegativeElement (a: AtomProxy) {\n  if (!a.isAromatic()) return false\n\n  const ringData = a.residueType.getRings()\n  if (!ringData) return false\n\n  let hasElement = false\n  const rings = ringData.rings\n  rings.forEach(ring => {\n    if (hasElement) return  // already found one\n    if (ring.some(idx => (a.index - a.residueAtomOffset) === idx)) {  // in ring\n      hasElement = ring.some(idx => {\n        const atomTypeId = a.residueType.atomTypeIdList[ idx ]\n        const number = a.atomMap.get(atomTypeId).number\n        return number === Elements.N || number === Elements.O\n      })\n    }\n  })\n\n  return hasElement\n}\n\n/**\n * Potential hydrogen acceptor\n */\nexport function addHydrogenAcceptors (structure: Structure, features: Features) {\n  const { charge, implicitH, idealGeometry } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.HydrogenAcceptor)\n\n    const an = a.number\n    if (an === Elements.O) {\n      // Basically assume all oxygen atoms are acceptors!\n      addAtom(state, a)\n      addFeature(features, state)\n    }else if (an === Elements.N) {\n      if (isHistidineNitrogen(a)) {\n        // include both nitrogen atoms in histidine due to\n        // their often ambiguous protonation assignment\n        addAtom(state, a)\n        addFeature(features, state)\n      } else if (charge[ a.index ] < 1){\n        // Neutral nitrogen might be an acceptor\n        // It must have at least one lone pair not conjugated\n        const totalBonds = a.bondCount + implicitH[ a.index ]\n        const ig = idealGeometry[ a.index ]\n        if (\n          (ig === AtomGeometry.Tetrahedral && totalBonds < 4) ||\n          (ig === AtomGeometry.Trigonal && totalBonds < 3) ||\n          (ig === AtomGeometry.Linear && totalBonds < 2)\n        ) {\n          addAtom(state, a)\n          addFeature(features, state)\n        }\n      }\n    }else if (an === 16) {  // S\n      if (a.resname === 'CYS' || a.resname === 'MET' || a.formalCharge === -1) {\n        addAtom(state, a)\n        addFeature(features, state)\n      }\n    }\n  })\n}\n\n/**\n * Atom that is only bound to carbon or hydrogen\n */\n// function isHydrocarbon (atom: AtomProxy) {\n//   let flag = true\n//   atom.eachBondedAtom(ap => {\n//     const e = ap.element\n//     if (e !== 'C' && e !== 'H') flag = false\n//   })\n//   return flag\n// }\n\nfunction isHistidineNitrogen (ap: AtomProxy) {\n  return ap.resname === 'HIS' && ap.number == Elements.N && ap.isRing()\n}\n\nfunction isBackboneHydrogenBond (ap1: AtomProxy, ap2: AtomProxy) {\n  return ap1.isBackbone() && ap2.isBackbone()\n}\n\nfunction isWaterHydrogenBond (ap1: AtomProxy, ap2: AtomProxy) {\n  return ap1.isWater() && ap2.isWater()\n}\n\nfunction isHydrogenBond (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.HydrogenAcceptor && tj === FeatureType.HydrogenDonor) ||\n    (ti === FeatureType.HydrogenDonor && tj === FeatureType.HydrogenAcceptor)\n  )\n}\n\nfunction isWeakHydrogenBond (ti: FeatureType, tj: FeatureType){\n  return (\n    (ti === FeatureType.WeakHydrogenDonor && tj === FeatureType.HydrogenAcceptor) ||\n    (ti === FeatureType.HydrogenAcceptor && tj === FeatureType.WeakHydrogenDonor)\n  )\n}\n\nfunction getHydrogenBondType (ap1: AtomProxy, ap2: AtomProxy) {\n  if (isWaterHydrogenBond(ap1, ap2)) {\n    return ContactType.WaterHydrogenBond\n  } else if (isBackboneHydrogenBond(ap1, ap2)) {\n    return ContactType.BackboneHydrogenBond\n  } else {\n    return ContactType.HydrogenBond\n  }\n}\n\nexport interface HydrogenBondParams {\n  maxHbondDist?: number\n  maxHbondSulfurDist?: number\n  maxHbondAccAngle?: number\n  maxHbondDonAngle?: number\n  maxHbondAccPlaneAngle?: number\n  maxHbondDonPlaneAngle?: number\n  backboneHbond?: boolean\n  waterHbond?: boolean\n  masterModelIndex?: number\n}\n\n/**\n * All pairs of hydrogen donor and acceptor atoms\n */\nexport function addHydrogenBonds (structure: Structure, contacts: Contacts, params: HydrogenBondParams = {}) {\n  const maxHbondDist = defaults(params.maxHbondDist, ContactDefaultParams.maxHbondDist)\n  const maxHbondSulfurDist = defaults(params.maxHbondSulfurDist, ContactDefaultParams.maxHbondSulfurDist)\n  const maxHbondAccAngle = degToRad(defaults(params.maxHbondAccAngle, ContactDefaultParams.maxHbondAccAngle))\n  const maxHbondDonAngle = degToRad(defaults(params.maxHbondDonAngle, ContactDefaultParams.maxHbondDonAngle))\n  const maxHbondAccPlaneAngle = degToRad(defaults(params.maxHbondAccPlaneAngle, ContactDefaultParams.maxHbondAccPlaneAngle))\n  const maxHbondDonPlaneAngle = degToRad(defaults(params.maxHbondDonPlaneAngle, ContactDefaultParams.maxHbondDonPlaneAngle))\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const maxDist = Math.max(maxHbondDist, maxHbondSulfurDist)\n  const maxHbondDistSq = maxHbondDist * maxHbondDist\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const { idealGeometry } = valenceModel(structure.data)\n\n  const donor = structure.getAtomProxy()\n  const acceptor = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxDist, (j, dSq) => {\n      if (j <= i) return\n\n      const ti = types[ i ]\n      const tj = types[ j ]\n\n      const isWeak = isWeakHydrogenBond(ti, tj)\n      if (!isWeak && !isHydrogenBond(ti, tj)) return\n\n      const [ l, k ] = tj === FeatureType.HydrogenAcceptor ? [ i, j ] : [ j, i ]\n\n      donor.index = atomSets[ l ][ 0 ]\n      acceptor.index = atomSets[ k ][ 0 ]\n\n      if (acceptor.index === donor.index) return // DA to self\n\n      if (invalidAtomContact(donor, acceptor, masterIdx)) return\n      if (donor.number !== Elements.S && acceptor.number !== Elements.S && dSq > maxHbondDistSq) return\n      if (donor.connectedTo(acceptor)) return\n\n      const donorAngles = calcAngles(donor, acceptor)\n      const idealDonorAngle = Angles.get(idealGeometry[donor.index]) || degToRad(120)\n      if (donorAngles.some(donorAngle => {\n        return Math.abs(idealDonorAngle - donorAngle) > maxHbondDonAngle\n      })) return\n\n      if (idealGeometry[donor.index] === AtomGeometry.Trigonal){\n        const outOfPlane = calcPlaneAngle(donor, acceptor)\n        if (outOfPlane !== undefined && outOfPlane > maxHbondDonPlaneAngle) return\n      }\n\n      const acceptorAngles = calcAngles(acceptor, donor)\n      const idealAcceptorAngle = Angles.get(idealGeometry[acceptor.index]) || degToRad(120)\n      if (acceptorAngles.some(acceptorAngle => {\n        // Do not limit large acceptor angles\n        return idealAcceptorAngle - acceptorAngle > maxHbondAccAngle\n      })) return\n\n      if (idealGeometry[acceptor.index] === AtomGeometry.Trigonal){\n        const outOfPlane = calcPlaneAngle(acceptor, donor)\n        if (outOfPlane !== undefined && outOfPlane > maxHbondAccPlaneAngle) return\n      }\n\n      featureSet.setBits(l, k)\n      const bondType = isWeak ? ContactType.WeakHydrogenBond : getHydrogenBondType(donor, acceptor)\n      contactStore.addContact(l, k, bondType)\n    })\n  }\n}\n","/**\n * @file Metal Binding\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\n// import { valenceModel } from '../../structure/data'\nimport { Elements, AA3, Bases } from '../../structure/structure-constants'\n// import { hasAromaticNeighbour } from '../functional-groups'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\nconst IonicTypeMetals = [\n  Elements.LI, Elements.NA, Elements.K, Elements.RB, Elements.CS,\n  Elements.MG, Elements.CA, Elements.SR, Elements.BA, Elements.AL,\n  Elements.GA, Elements.IN, Elements.TL, Elements.SC, Elements.SN,\n  Elements.PB, Elements.BI, Elements.SB, Elements.HG\n]\n\n/**\n * Metal binding partners (dative bond or ionic-type interaction)\n */\nexport function addMetalBinding (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    let dative = false\n    let ionic = false\n\n    const isStandardAminoacid = AA3.includes(a.resname)\n    const isStandardBase = Bases.includes(a.resname)\n\n    if (!isStandardAminoacid && !isStandardBase) {\n      if (a.isHalogen() || a.number === Elements.O || a.number === Elements.S) {\n        dative = true\n        ionic = true\n      } else if (a.number === Elements.N) {\n        dative = true\n      }\n    } else if (isStandardAminoacid){\n      // main chain oxygen atom or oxygen, nitrogen and sulfur from specific amino acids\n      if (a.number === Elements.O) {\n        if(['ASP', 'GLU', 'SER', 'THR', 'TYR', 'ASN', 'GLN'].includes(a.resname) && a.isSidechain()) {\n          dative = true\n          ionic = true\n        } else if (a.isBackbone()) {\n          dative = true\n          ionic = true\n        }\n      } else if (a.number === Elements.S && 'CYS' === a.resname) {\n        dative = true\n        ionic = true\n      } else if (a.number === Elements.N) {\n        if(a.resname === 'HIS' && a.isSidechain()) {\n          dative = true\n        }\n      }\n    } else if (isStandardBase){\n      // http://pubs.acs.org/doi/pdf/10.1021/acs.accounts.6b00253\n      // http://onlinelibrary.wiley.com/doi/10.1002/anie.200900399/full\n      if (a.number === Elements.O && a.isBackbone()) {\n        dative = true\n        ionic = true\n      } else if(['N3', 'N4', 'N7'].includes(a.atomname)) {\n        dative = true\n      } else if(['O2', 'O4', 'O6'].includes(a.atomname)) {\n        dative = true\n        ionic = true\n      }\n    }\n    if (dative) {\n      const state = createFeatureState(FeatureType.DativeBondPartner)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n    if (ionic) {\n      const state = createFeatureState(FeatureType.IonicTypePartner)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\n/**\n * Metal Pi complexation partner\n */\n// export function addMetalPiPartners (structure: Structure, features: Features) {\n//   const { charge } = valenceModel(structure.data)\n\n//   structure.eachAtom(a => {\n//     const state = createFeatureState(FeatureType.MetalPiPartner)\n\n//     const resname = a.resname\n//     const element = a.element\n//     const atomname = a.atomname\n//     if (!a.isPolymer()) {\n//       // water oxygen, as well as oxygen from carboxylate, phosphoryl, phenolate, alcohol;\n//       // nitrogen from imidazole; sulfur from thiolate\n//       if (element === 'O') {\n//         // Water oxygen\n//         if (a.bondCount === 0 || a.isWater()) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Oxygen in alcohol (R-[O]-H)\n//         if (a.bondCount === 2 && charge[ a.index ] || a.hasBondToElement('H')) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Phenolate oxygen\n//         if (hasAromaticNeighbour(a) && !a.aromatic) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Carboxylic acid oxygen\n//         if (a.bondToElementCount('C') === 1) {\n//           let flag = false\n//           a.eachBondedAtom(ba => {\n//             if (ba.element === 'C' && ba.bondToElementCount('O') === 2 && ba.bondToElementCount('C') === 1) {\n//               flag = true\n//             }\n//           })\n//           if (flag) {\n//             addAtom(state, a)\n//             addFeature(features, state)\n//             return\n//           }\n//         }\n//         // Phosphoryl oxygen\n//         if (a.bondToElementCount('P') === 1) {\n//           let flag = false\n//           a.eachBondedAtom(ba => {\n//             if (ba.element === 'P' && ba.bondToElementCount('O') >= 3) {\n//               flag = true\n//             }\n//           })\n//           if (flag) {\n//             addAtom(state, a)\n//             addFeature(features, state)\n//             return\n//           }\n//         }\n//       } else if (element === 'N') {\n//         // Imidazole/pyrrole or similar\n//         if (a.bondToElementCount('C') === 2) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//       } else if (element === 'S') {\n//         // Thiolate\n//         if (hasAromaticNeighbour(a) && !a.aromatic) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Sulfur in Iron sulfur cluster\n//         const ironCount = a.bondToElementCount('FE')\n//         if (ironCount > 0 && ironCount === a.bondCount) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//       }\n//     }\n//   })\n// }\n\nexport function addMetals (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (a.isTransitionMetal() || a.number === Elements.ZN || a.number === Elements.CD) {\n      const state = createFeatureState(FeatureType.TransitionMetal)\n      addAtom(state, a)\n      addFeature(features, state)\n    } else if (IonicTypeMetals.includes(a.number)) {\n      const state = createFeatureState(FeatureType.IonicTypeMetal)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction isMetalComplex (ti: FeatureType, tj: FeatureType) {\n  if (ti === FeatureType.TransitionMetal) {\n    return (\n      tj === FeatureType.DativeBondPartner ||\n      tj === FeatureType.TransitionMetal\n    )\n  } else if (ti === FeatureType.IonicTypeMetal) {\n    return (\n      tj === FeatureType.IonicTypePartner\n    )\n  }\n}\n\nexport interface MetalComplexationParams {\n  maxMetalDist?: number\n  masterModelIndex?: number\n}\n\n/**\n * Metal complexes of metals and appropriate groups in protein and ligand, including water\n */\nexport function addMetalComplexation (structure: Structure, contacts: Contacts, params: MetalComplexationParams = {}) {\n  const maxMetalDist = defaults(params.maxMetalDist, ContactDefaultParams.maxMetalDist)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxMetalDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n\n      const m1 = ap1.isMetal()\n      const m2 = ap2.isMetal()\n      if (!m1 && !m2) return\n\n      const [ ti, tj ] = m1 ? [ types[ i ],types[ j ] ] : [ types[ j ],types[ i ] ]\n\n      if (isMetalComplex(ti, tj)) {\n        featureSet.setBits(i, j)\n        contactStore.addContact(i, j, ContactType.MetalCoordination)\n      }\n    })\n  }\n}\n","/**\n * @file Halogen Bonds\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport { Elements } from '../../structure/structure-constants'\nimport { degToRad } from '../../math/math-utils'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\nimport { calcAngles } from '../geometry'\n\nconst halBondElements = [17, 35, 53, 85]\n\n/**\n * Halogen bond donors (X-C, with X one of Cl, Br, I or At) not F!\n */\nexport function addHalogenDonors (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (halBondElements.includes(a.number) && a.bondToElementCount(Elements.C) === 1) {\n      const state = createFeatureState(FeatureType.HalogenDonor)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nconst X = [ Elements.N, Elements.O, Elements.S ]\nconst Y = [ Elements.C, Elements.N, Elements.P, Elements.S ]\n\n/**\n * Halogen bond acceptors (Y-{O|N|S}, with Y=C,P,N,S)\n */\nexport function addHalogenAcceptors (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (X.includes(a.number)) {\n      let flag = false\n      a.eachBondedAtom(ba => {\n        if (Y.includes(ba.number)) {\n          flag = true\n        }\n      })\n      if (flag) {\n        const state = createFeatureState(FeatureType.HalogenAcceptor)\n        addAtom(state, a)\n        addFeature(features, state)\n      }\n    }\n  })\n}\n\nfunction isHalogenBond (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.HalogenAcceptor && tj === FeatureType.HalogenDonor) ||\n    (ti === FeatureType.HalogenDonor && tj === FeatureType.HalogenAcceptor)\n  )\n}\n\nexport interface HalogenBondsParams {\n  maxHalogenBondDist?: number\n  maxHalogenBondAngle?: number\n  masterModelIndex?: number\n}\n\n// http://www.pnas.org/content/101/48/16789.full\nconst OptimalHalogenAngle = degToRad(180)  // adjusted from 165 to account for spherical statistics\nconst OptimalAcceptorAngle = degToRad(120)\n\n/**\n * All pairs of halogen donor and acceptor atoms\n */\nexport function addHalogenBonds (structure: Structure, contacts: Contacts, params: HalogenBondsParams = {}) {\n  const maxHalogenBondDist = defaults(params.maxHalogenBondDist, ContactDefaultParams.maxHalogenBondDist)\n  const maxHalogenBondAngle = degToRad(defaults(params.maxHalogenBondAngle, ContactDefaultParams.maxHalogenBondAngle))\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxHalogenBondDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n      if (!isHalogenBond(types[ i ], types[ j ])) return\n\n      const [ halogen, acceptor ] = types[ i ] === FeatureType.HalogenDonor ? [ ap1, ap2 ] : [ ap2, ap1 ]\n\n      const halogenAngles = calcAngles(halogen, acceptor)\n      // Singly bonded halogen only (not bromide ion for example)\n      if (halogenAngles.length !== 1) return\n      if (OptimalHalogenAngle - halogenAngles[0] > maxHalogenBondAngle) return\n\n      const acceptorAngles = calcAngles(acceptor, halogen)\n      // Angle must be defined. Excludes water as acceptor. Debatable\n      if (acceptorAngles.length === 0) return\n      if (acceptorAngles.some(acceptorAngle => {\n        return (OptimalAcceptorAngle - acceptorAngle > maxHalogenBondAngle)\n      })) return\n\n\n      featureSet.setBits(i, j)\n      contactStore.addContact(i, j, ContactType.HalogenBond)\n\n    })\n  }\n}\n","/**\n * @file Refine Contacts\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { Debug, Log } from '../../globals'\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport { Elements } from '../../structure/structure-constants'\nimport { FrozenContacts, ContactType, ContactDefaultParams, isMasterContact } from './contact'\nimport { FeatureType } from './features'\n\nexport interface LineOfSightParams {\n  lineOfSightDistFactor?: number\n  masterModelIndex?: number\n}\n\n// also allows intra-residue contacts\nexport function invalidAtomContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return !isMasterContact(ap1, ap2, masterIdx) && (\n    ap1.modelIndex !== ap2.modelIndex ||\n    (ap1.altloc && ap2.altloc && ap1.altloc !== ap2.altloc)\n  )\n}\n\nexport function refineLineOfSight (structure: Structure, contacts: FrozenContacts, params: LineOfSightParams = {}) {\n  if (Debug) Log.time('refineLineOfSight')\n\n  const lineOfSightDistFactor = defaults(params.lineOfSightDistFactor, ContactDefaultParams.lineOfSightDistFactor)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const spatialHash = structure.spatialHash!\n  const { contactSet, contactStore, features } = contacts\n  const { index1, index2 } = contactStore\n  const { centers, atomSets } = features\n  const { x, y, z } = centers\n\n  const ac1 = structure.getAtomProxy()\n  const ac2 = structure.getAtomProxy()\n  const aw = structure.getAtomProxy()\n\n  const c1 = new Vector3()\n  const c2 = new Vector3()\n\n  const lineOfSightDist = 3 * lineOfSightDistFactor\n  const lineOfSightDistFactorSq = lineOfSightDistFactor * lineOfSightDistFactor\n\n  contactSet.forEach(i => {\n    c1.set(x[index1[i]], y[index1[i]], z[index1[i]])\n    c2.set(x[index2[i]], y[index2[i]], z[index2[i]])\n\n    const cx = ( c1.x + c2.x ) / 2\n    const cy = ( c1.y + c2.y ) / 2\n    const cz = ( c1.z + c2.z ) / 2\n\n    const as1 = atomSets[ index1[ i ] ]\n    const as2 = atomSets[ index2[ i ] ]\n\n    ac1.index = as1[ 0 ]\n    ac2.index = as2[ 0 ]\n\n    spatialHash.eachWithin(cx, cy, cz, lineOfSightDist, (j, dSq) => {\n      aw.index = j\n      if (\n        aw.number !== Elements.H &&\n        (aw.vdw * aw.vdw * lineOfSightDistFactorSq) > dSq &&\n        !invalidAtomContact(ac1, aw, masterIdx) &&\n        !invalidAtomContact(ac2, aw, masterIdx) &&\n        !as1.includes(j) &&\n        !as2.includes(j) &&\n        // to ignore atoms in the center of functional groups\n        c1.distanceToSquared(aw as any) > 1 &&\n        c2.distanceToSquared(aw as any) > 1\n      ) {\n        contactSet.clear(i)\n        if (Debug) Log.log('removing', ac1.qualifiedName(), ac2.qualifiedName(), 'because', aw.qualifiedName())\n      }\n    })\n  })\n\n  if (Debug) Log.timeEnd('refineLineOfSight')\n}\n\n/**\n * For atoms interacting with several atoms in the same residue\n * only the one with the closest distance is kept.\n */\nexport function refineHydrophobicContacts (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  const residueContactDict: { [k: string]: number[] } = {}\n\n  /* keep only closest contact between residues */\n  const handleResidueContact = function (dist: number, i: number, key: string) {\n    const [ minDist, minIndex ] = residueContactDict[ key ] || [ Infinity, -1 ]\n    if (dist < minDist) {\n      if (minIndex !== -1) contactSet.clear(minIndex)\n      residueContactDict[ key ] = [ dist, i ]\n    } else {\n      contactSet.clear(i)\n    }\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.Hydrophobic) return\n\n    ap1.index = atomSets[ index1[ i ] ][ 0 ]\n    ap2.index = atomSets[ index2[ i ] ][ 0 ]\n\n    const dist = ap1.distanceTo(ap2)\n    handleResidueContact(dist, i, `${ap1.index}|${ap2.residueIndex}`)\n    handleResidueContact(dist, i, `${ap2.index}|${ap1.residueIndex}`)\n  })\n}\n\nfunction isHydrogenBondType (type: number) {\n  return (\n    type === ContactType.HydrogenBond ||\n    type === ContactType.WaterHydrogenBond ||\n    type === ContactType.BackboneHydrogenBond\n  )\n}\n\n/**\n * Remove weak hydrogen bonds when the acceptor is involved in\n * a normal/strong hydrogen bond\n */\nexport function refineWeakHydrogenBonds (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features, adjacencyList } = contacts\n  const { type, index1, index2 } = contactStore\n  const { types } = features\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.WeakHydrogenBond) return\n\n    let accFeat: number\n    if (types[ index1[ i ] ] === FeatureType.WeakHydrogenDonor) {\n      accFeat = index2[ i ]\n    } else {\n      accFeat = index1[ i ]\n    }\n\n    const n = adjacencyList.countArray[ accFeat ]\n    const offset = adjacencyList.offsetArray[ accFeat ]\n    for (let j = 0; j < n; ++j) {\n      const ci = adjacencyList.indexArray[ offset + j ]\n      if (isHydrogenBondType(type[ ci ])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove hydrogen bonds between groups that also form\n * a salt bridge between each other\n */\nexport function refineSaltBridges (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ionicInteractionDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!ionicInteractionDict[ idx ]) ionicInteractionDict[ idx ] = []\n    ionicInteractionDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.IonicInteraction) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (!isHydrogenBondType(type[ i ])) return\n\n    const iil1 = ionicInteractionDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const iil2 = ionicInteractionDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!iil1 || !iil2) return\n\n    const n = iil1.length\n    for (let j = 0; j < n; ++j) {\n      if (iil2.includes(iil1[j])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove hydrophobic and cation-pi interactions between groups that also form\n * a pi-stacking interaction between each other\n */\nexport function refinePiStacking (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const piStackingDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!piStackingDict[ idx ]) piStackingDict[ idx ] = []\n    piStackingDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.PiStacking) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (\n      type[ i ] !== ContactType.Hydrophobic &&\n      type[ i ] !== ContactType.CationPi\n    ) return\n\n    const pil1 = piStackingDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const pil2 = piStackingDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!pil1 || !pil2) return\n\n    const n = pil1.length\n    for (let j = 0; j < n; ++j) {\n      if (pil2.includes(pil1[j])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove ionic interactions between groups that also form\n * a metal coordination between each other\n */\nexport function refineMetalCoordination (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ionicInteractionDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!ionicInteractionDict[ idx ]) ionicInteractionDict[ idx ] = []\n    ionicInteractionDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.IonicInteraction) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.MetalCoordination) return\n\n    const iil1 = ionicInteractionDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const iil2 = ionicInteractionDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!iil1 || !iil2) return\n\n    const n = iil1.length\n    for (let j = 0; j < n; ++j) {\n      if (iil2.includes(iil1[j])) {\n        contactSet.clear(iil1[j])\n        return\n      }\n    }\n  })\n}\n\n// TODO: refactor refineSaltBridges, refinePiStacking and refineMetalCoordination to be DRY\n","/**\n * @file Contact\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { Color } from 'three'\n\nimport { Debug, Log } from '../../globals'\nimport { createParams } from '../../utils'\nimport { TextBufferData } from '../../buffer/text-buffer'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport SpatialHash from '../../geometry/spatial-hash'\nimport { calculateCenterArray, calculateDirectionArray, uniformArray } from '../../math/array-utils'\nimport ContactStore from '../../store/contact-store'\nimport BitArray from '../../utils/bitarray'\nimport Selection from '../../selection/selection'\nimport { ContactPicker } from '../../utils/picker'\nimport { createAdjacencyList, AdjacencyList } from '../../utils/adjacency-list'\nimport { createFeatures, Features } from './features'\nimport { addAromaticRings, addNegativeCharges, addPositiveCharges, addChargedContacts } from './charged'\nimport { addHydrogenAcceptors, addHydrogenDonors, addHydrogenBonds, addWeakHydrogenDonors } from './hydrogen-bonds'\nimport { addMetalBinding, addMetals, addMetalComplexation } from './metal-binding'\nimport { addHydrophobic, addHydrophobicContacts } from './hydrophobic'\nimport { addHalogenAcceptors, addHalogenDonors, addHalogenBonds } from './halogen-bonds'\nimport {\n  refineLineOfSight,\n  refineHydrophobicContacts, refineSaltBridges, refinePiStacking, refineMetalCoordination\n} from './refine-contacts'\n\nexport interface Contacts {\n  features: Features\n  spatialHash: SpatialHash\n  contactStore: ContactStore\n  featureSet: BitArray\n}\n\nexport interface FrozenContacts extends Contacts {\n  contactSet: BitArray\n  adjacencyList: AdjacencyList\n}\n\nexport const enum ContactType {\n  Unknown = 0,\n  IonicInteraction = 1,\n  CationPi = 2,\n  PiStacking = 3,\n  HydrogenBond = 4,\n  HalogenBond = 5,\n  Hydrophobic = 6,\n  MetalCoordination = 7,\n  WeakHydrogenBond = 8,\n  WaterHydrogenBond = 9,\n  BackboneHydrogenBond = 10\n}\n\nexport const ContactDefaultParams = {\n  maxHydrophobicDist: 4.0,\n  maxHbondDist: 3.5,\n  maxHbondSulfurDist: 4.1,\n  maxHbondAccAngle: 45,\n  maxHbondDonAngle: 45,\n  maxHbondAccPlaneAngle: 90,\n  maxHbondDonPlaneAngle: 30,\n  maxPiStackingDist: 5.5,\n  maxPiStackingOffset: 2.0,\n  maxPiStackingAngle: 30,\n  maxCationPiDist: 6.0,\n  maxCationPiOffset: 2.0,\n  maxIonicDist: 5.0,\n  maxHalogenBondDist: 4.0,\n  maxHalogenBondAngle: 30,\n  maxMetalDist: 3.0,\n  refineSaltBridges: true,\n  masterModelIndex: -1,\n  lineOfSightDistFactor: 1.0\n}\n\nexport function isMasterContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return (\n    (ap1.modelIndex === masterIdx && ap2.modelIndex !== masterIdx) ||\n    (ap2.modelIndex === masterIdx && ap1.modelIndex !== masterIdx)\n  )\n}\n\nexport function invalidAtomContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return !isMasterContact(ap1, ap2, masterIdx) && (\n    ap1.modelIndex !== ap2.modelIndex ||\n    ap1.residueIndex === ap2.residueIndex ||\n    (ap1.altloc && ap2.altloc && ap1.altloc !== ap2.altloc)\n  )\n}\n\nexport function createContacts (features: Features): Contacts {\n  const { types, centers } = features\n\n  const spatialHash = new SpatialHash(centers)\n  const contactStore = new ContactStore()\n  const featureSet = new BitArray(types.length, false)\n\n  return { features, spatialHash, contactStore, featureSet }\n}\n\nexport function createFrozenContacts (contacts: Contacts): FrozenContacts {\n  const { index1, index2, count } = contacts.contactStore\n\n  const adjacencyList = createAdjacencyList({\n    nodeArray1: index1,\n    nodeArray2: index2,\n    edgeCount: count,\n    nodeCount: contacts.featureSet.length\n  })\n  const contactSet = new BitArray(contacts.contactStore.count, true)\n\n  return Object.assign({ adjacencyList, contactSet }, contacts)\n}\n\nfunction calculateFeatures (structure: Structure) {\n  const features = createFeatures()\n\n  if (Debug) Log.time('calculateFeatures')\n\n  addPositiveCharges(structure, features)\n  addNegativeCharges(structure, features)\n  addAromaticRings(structure, features)\n\n  addHydrogenAcceptors(structure, features)\n  addHydrogenDonors(structure, features)\n  addWeakHydrogenDonors(structure, features)\n\n  addMetalBinding(structure, features)\n  addMetals(structure, features)\n\n  addHydrophobic(structure, features)\n\n  addHalogenAcceptors(structure, features)\n  addHalogenDonors(structure, features)\n\n  if (Debug) Log.timeEnd('calculateFeatures')\n\n  return features\n}\n\nexport function calculateContacts (structure: Structure, params = ContactDefaultParams) {\n  const features = calculateFeatures(structure)\n  const contacts = createContacts(features)\n\n  if (Debug) Log.time('calculateContacts')\n\n  addChargedContacts(structure, contacts, params)\n  addHydrogenBonds(structure, contacts, params)\n  addMetalComplexation(structure, contacts, params)\n  addHydrophobicContacts(structure, contacts, params)\n  addHalogenBonds(structure, contacts, params)\n\n  const frozenContacts = createFrozenContacts(contacts)\n\n  refineLineOfSight(structure, frozenContacts, params)\n  refineHydrophobicContacts(structure, frozenContacts)\n  if (params.refineSaltBridges) refineSaltBridges(structure, frozenContacts)\n  refinePiStacking(structure, frozenContacts)\n  refineMetalCoordination(structure, frozenContacts)\n\n  if (Debug) Log.timeEnd('calculateContacts')\n\n  return frozenContacts\n}\n\nexport function contactTypeName (type: ContactType) {\n  switch (type) {\n    case ContactType.HydrogenBond:\n    case ContactType.WaterHydrogenBond:\n    case ContactType.BackboneHydrogenBond:\n      return 'hydrogen bond'\n    case ContactType.Hydrophobic:\n      return 'hydrophobic contact'\n    case ContactType.HalogenBond:\n      return 'halogen bond'\n    case ContactType.IonicInteraction:\n      return 'ionic interaction'\n    case ContactType.MetalCoordination:\n      return 'metal coordination'\n    case ContactType.CationPi:\n      return 'cation-pi interaction'\n    case ContactType.PiStacking:\n      return 'pi-pi stacking'\n    case ContactType.WeakHydrogenBond:\n      return 'weak hydrogen bond'\n    default:\n      return 'unknown contact'\n  }\n}\n\nexport const ContactDataDefaultParams = {\n  hydrogenBond: true,\n  hydrophobic: true,\n  halogenBond: true,\n  ionicInteraction: true,\n  metalCoordination: true,\n  cationPi: true,\n  piStacking: true,\n  weakHydrogenBond: true,\n  waterHydrogenBond: true,\n  backboneHydrogenBond: true,\n  radius: 1,\n  filterSele: ''\n}\nexport type ContactDataParams = typeof ContactDataDefaultParams\n  | { filterSele: string|[string, string] }\n\nexport const ContactLabelDefaultParams = {\n  unit: '',\n  size: 2.0\n}\n\nexport type ContactLabelParams = typeof ContactLabelDefaultParams\n\nconst tmpColor = new Color()\nfunction contactColor (type: ContactType) {\n  switch (type) {\n    case ContactType.HydrogenBond:\n    case ContactType.WaterHydrogenBond:\n    case ContactType.BackboneHydrogenBond:\n      return tmpColor.setHex(0x2B83BA).toArray()\n    case ContactType.Hydrophobic:\n      return tmpColor.setHex(0x808080).toArray()\n    case ContactType.HalogenBond:\n      return tmpColor.setHex(0x40FFBF).toArray()\n    case ContactType.IonicInteraction:\n      return tmpColor.setHex(0xF0C814).toArray()\n    case ContactType.MetalCoordination:\n      return tmpColor.setHex(0x8C4099).toArray()\n    case ContactType.CationPi:\n      return tmpColor.setHex(0xFF8000).toArray()\n    case ContactType.PiStacking:\n      return tmpColor.setHex(0x8CB366).toArray()\n    case ContactType.WeakHydrogenBond:\n      return tmpColor.setHex(0xC5DDEC).toArray()\n    default:\n      return tmpColor.setHex(0xCCCCCC).toArray()\n  }\n}\n\nexport interface ContactData {\n  position1: Float32Array,\n  position2: Float32Array,\n  color: Float32Array,\n  color2: Float32Array,\n  radius: Float32Array,\n  picking: ContactPicker\n}\n\nexport function getContactData (contacts: FrozenContacts, structure: Structure, params: ContactDataParams): ContactData {\n  const p = createParams(params, ContactDataDefaultParams)\n  const types: ContactType[] = []\n  if (p.hydrogenBond) types.push(ContactType.HydrogenBond)\n  if (p.hydrophobic) types.push(ContactType.Hydrophobic)\n  if (p.halogenBond) types.push(ContactType.HalogenBond)\n  if (p.ionicInteraction) types.push(ContactType.IonicInteraction)\n  if (p.metalCoordination) types.push(ContactType.MetalCoordination)\n  if (p.cationPi) types.push(ContactType.CationPi)\n  if (p.piStacking) types.push(ContactType.PiStacking)\n  if (p.weakHydrogenBond) types.push(ContactType.WeakHydrogenBond)\n  if (p.waterHydrogenBond) types.push(ContactType.WaterHydrogenBond)\n  if (p.backboneHydrogenBond) types.push(ContactType.BackboneHydrogenBond)\n\n  const { features, contactSet, contactStore } = contacts\n  const { centers, atomSets } = features\n  const { x, y, z } = centers\n  const { index1, index2, type } = contactStore\n\n  const position1: number[] = []\n  const position2: number[] = []\n  const color: number[] = []\n  const radius: number[] = []\n  const picking: number[] = []\n\n  let filterSet: BitArray | BitArray[] | undefined\n  if (p.filterSele) {\n    if (Array.isArray(p.filterSele)) {\n      filterSet = p.filterSele.map(sele => {\n        return structure.getAtomSet(new Selection(sele))\n      })\n    } else {\n      filterSet = structure.getAtomSet(new Selection(p.filterSele))\n    }\n  }\n\n  contactSet.forEach(i => {\n    const ti = type[ i ]\n    if (!types.includes(ti)) return\n\n    if (filterSet) {\n      const idx1 = atomSets[index1[i]][0]\n      const idx2 = atomSets[index2[i]][0]\n\n      if (Array.isArray(filterSet)) {\n        if (!(filterSet[0].isSet(idx1) && filterSet[1].isSet(idx2) || (filterSet[1].isSet(idx1) && filterSet[0].isSet(idx2)))) return\n      } else {\n        if (!filterSet.isSet(idx1) && !filterSet.isSet(idx2)) return\n      }\n    }\n\n    const k = index1[i]\n    const l = index2[i]\n    position1.push(x[k], y[k], z[k])\n    position2.push(x[l], y[l], z[l])\n    color.push(...contactColor(ti))\n    radius.push(p.radius)\n    picking.push(i)\n  })\n\n  return {\n    position1: new Float32Array(position1),\n    position2: new Float32Array(position2),\n    color: new Float32Array(color),\n    color2: new Float32Array(color),\n    radius: new Float32Array(radius),\n    picking: new ContactPicker(picking, contacts, structure)\n  }\n}\n\nexport function getLabelData (contactData: ContactData, params: ContactLabelParams): TextBufferData {\n\n  const position = calculateCenterArray(contactData.position1, contactData.position2)\n  const text: string[] = []\n\n  const direction = calculateDirectionArray(contactData.position1, contactData.position2)\n\n  const n = direction.length / 3\n  for (let i=0; i<n; i++) {\n    const j = 3 * i\n    const d = Math.sqrt(direction[j]**2 + direction[j+1]**2 + direction[j+2]**2)\n    switch (params.unit) {\n        case 'angstrom':\n          text[ i ] = d.toFixed(2) + ' ' + String.fromCharCode(0x212B)\n          break\n        case 'nm':\n          text[ i ] = (d / 10).toFixed(2) + ' nm'\n          break\n        default:\n          text[ i ] = d.toFixed(2)\n          break\n      }\n  }\n  return {\n    position,\n    size: uniformArray(position.length / 3, params.size),\n    color: contactData.color,\n    text\n  }\n}\n","/**\n * @file Hydrophobic\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport { Elements } from '../../structure/structure-constants'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\n/**\n * Hydrophobic carbon (only bonded to carbon or hydrogen); fluorine\n */\nexport function addHydrophobic (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.Hydrophobic)\n    let flag = false\n    if (a.number === Elements.C) {\n      flag = true\n      a.eachBondedAtom(ap => {\n        const an = ap.number\n        if (an !== Elements.C && an !== Elements.H) flag = false\n      })\n    } else if (a.number === Elements.F) {\n      flag = true\n    }\n    if (flag) {\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction isHydrophobicContact (ti: FeatureType, tj: FeatureType) {\n  return ti === FeatureType.Hydrophobic && tj === FeatureType.Hydrophobic\n}\n\nexport interface HydrophobicContactsParams {\n  maxHydrophobicDist?: number\n  masterModelIndex?: number\n}\n\n/**\n * All hydrophobic contacts\n */\nexport function addHydrophobicContacts (structure: Structure, contacts: Contacts, params: HydrophobicContactsParams = {}) {\n  const maxHydrophobicDist = defaults(params.maxHydrophobicDist, ContactDefaultParams.maxHydrophobicDist)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxHydrophobicDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n      if (ap1.number === Elements.F && ap2.number === Elements.F) return\n      if (ap1.connectedTo(ap2)) return\n\n      if (isHydrophobicContact(types[ i ], types[ j ])) {\n        featureSet.setBits(i, j)\n        contactStore.addContact(i, j, ContactType.Hydrophobic)\n      }\n    })\n  }\n}\n","/**\n * @file Picker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { PickerRegistry } from '../globals'\nimport { calculateMeanVector3 } from '../math/vector-utils'\nimport Selection from '../selection/selection'\nimport {\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive,\n  EllipsoidPrimitive, OctahedronPrimitive, SpherePrimitive,\n  TetrahedronPrimitive, TorusPrimitive, PointPrimitive, WidelinePrimitive,\n  IcosahedronPrimitive\n} from '../geometry/primitive'\nimport { contactTypeName, Contacts } from '../chemistry/interactions/contact'\nimport { TypedArray } from '../types';\nimport Component from '../component/component';\nimport { Shape, Structure, Volume } from '../ngl';\nimport BondStore from '../store/bond-store';\nimport Validation from '../structure/validation';\nimport PrincipalAxes from '../math/principal-axes';\nimport Surface from '../surface/surface';\nimport Unitcell from '../symmetry/unitcell';\nimport BondProxy from '../proxy/bond-proxy';\nimport AtomProxy from '../proxy/atom-proxy';\n\n/**\n * Picker class\n * @interface\n */\nclass Picker {\n  array: number[]|TypedArray|undefined\n  /**\n   * @param  {Array|TypedArray} [array] - mapping\n   */\n  constructor (array?: number[]|TypedArray) {\n    this.array = array\n  }\n\n  get type () { return '' }\n  get data () { return {} }\n\n  /**\n   * Get the index for the given picking id\n   * @param  {Integer} pid - the picking id\n   * @return {Integer} the index\n   */\n  getIndex (pid: number) {\n    return this.array ? this.array[ pid ] : pid\n  }\n\n  /**\n   * Get object data\n   * @abstract\n   * @param  {Integer} pid - the picking id\n   * @return {Object} the object data\n   */\n  getObject (pid: number) {\n    return {}\n  }\n\n  _applyTransformations (vector: Vector3, instance: any, component: Component) {\n    if (instance) {\n      vector.applyMatrix4(instance.matrix)\n    }\n    if (component) {\n      vector.applyMatrix4(component.matrix)\n    }\n    return vector\n  }\n\n  /**\n   * Get object position\n   * @abstract\n   * @param  {Integer} pid - the picking id\n   * @return {Vector3} the object position\n   */\n  _getPosition (pid: number) {\n    return new Vector3()\n  }\n\n  /**\n   * Get position for the given picking id\n   * @param  {Integer} pid - the picking id\n   * @param  {Object} instance - the instance that should be applied\n   * @param  {Component} component - the component of the picked object\n   * @return {Vector3} the position\n   */\n  getPosition (pid: number, instance: any, component: Component) {\n    return this._applyTransformations(\n      this._getPosition(pid), instance, component\n    )\n  }\n}\n\n/**\n * Shape picker class\n * @interface\n */\nclass ShapePicker extends Picker {\n  shape: Shape\n  /**\n   * @param  {Shape} shape - shape object\n   */\n  constructor (shape: Shape) {\n    super()\n    this.shape = shape\n  }\n\n  get primitive (): any { return }\n\n  get data () { return this.shape }\n  get type () { return this.primitive.type }\n\n  getObject (pid: number) {\n    return this.primitive.objectFromShape(this.shape, this.getIndex(pid))\n  }\n\n  _getPosition (pid: number) {\n    return this.primitive.positionFromShape(this.shape, this.getIndex(pid))\n  }\n}\n\n//\n\nclass CylinderPicker extends ShapePicker {\n  get primitive () { return CylinderPrimitive }\n}\n\nclass ArrowPicker extends ShapePicker {\n  get primitive () { return ArrowPrimitive }\n}\n\nclass AtomPicker extends Picker {\n  structure: Structure\n  constructor (array: Float32Array, structure: Structure) {\n    super(array)\n    this.structure = structure\n  }\n\n  get type () { return 'atom' }\n  get data () { return this.structure }\n\n  getObject (pid: number): AtomProxy {\n    return this.structure.getAtomProxy(this.getIndex(pid))\n  }\n\n  _getPosition (pid: number) {\n    return new Vector3().copy(this.getObject(pid) as any)\n  }\n}\n\nclass AxesPicker extends Picker {\n  axes: PrincipalAxes\n  constructor (axes: PrincipalAxes) {\n    super()\n    this.axes = axes\n  }\n\n  get type () { return 'axes' }\n  get data () { return this.axes }\n\n  getObject (/* pid */) {\n    return {\n      axes: this.axes\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.axes.center.clone()\n  }\n}\n\nclass BondPicker extends Picker {\n  structure: Structure\n  bondStore: BondStore\n  constructor (array: number[]|TypedArray|undefined, structure: Structure, bondStore?: BondStore) {\n    super(array)\n    this.structure = structure\n    this.bondStore = bondStore || structure.bondStore\n  }\n\n  get type () { return 'bond' }\n  get data () { return this.structure }\n\n  getObject (pid: number): BondProxy {\n    const bp = this.structure.getBondProxy(this.getIndex(pid))\n    bp.bondStore = this.bondStore\n    return bp\n  }\n\n  _getPosition (pid: number) {\n    const b = this.getObject(pid)\n    return new Vector3()\n      .copy(b.atom1 as any)\n      .add(b.atom2 as any)\n      .multiplyScalar(0.5)\n  }\n}\n\nclass ContactPicker extends Picker {\n  contacts: Contacts\n  structure: Structure\n  constructor (array: number[]|TypedArray|undefined, contacts: Contacts, structure: Structure) {\n    super(array)\n    this.contacts = contacts\n    this.structure = structure\n  }\n\n  get type () { return 'contact' }\n  get data () { return this.contacts }\n\n  getObject (pid: number) {\n    const idx = this.getIndex(pid)\n    const { features, contactStore } = this.contacts\n    const { centers, atomSets } = features\n    const { x, y, z } = centers\n    const { index1, index2, type } = contactStore\n    const k = index1[idx]\n    const l = index2[idx]\n    return {\n      center1: new Vector3(x[k], y[k], z[k]),\n      center2: new Vector3(x[l], y[l], z[l]),\n      atom1: this.structure.getAtomProxy(atomSets[k][0]),\n      atom2: this.structure.getAtomProxy(atomSets[l][0]),\n      type: contactTypeName(type[idx])\n    }\n  }\n\n  _getPosition (pid: number) {\n    const { center1, center2 } = this.getObject(pid)\n    return new Vector3().addVectors(center1, center2).multiplyScalar(0.5)\n  }\n}\n\nclass ConePicker extends ShapePicker {\n  get primitive () { return ConePrimitive }\n}\n\nclass ClashPicker extends Picker {\n  validation: Validation\n  structure: Structure\n  constructor (array: number[]|TypedArray|undefined, validation: Validation, structure: Structure) {\n    super(array)\n    this.validation = validation\n    this.structure = structure\n  }\n\n  get type () { return 'clash' }\n  get data () { return this.validation }\n\n  getObject (pid: number) {\n    const val = this.validation\n    const idx = this.getIndex(pid)\n    return {\n      validation: val,\n      index: idx,\n      clash: val.clashArray[ idx ]\n    }\n  }\n\n  _getAtomProxyFromSele (sele: string) {\n    const selection = new Selection(sele)\n    const idx = this.structure.getAtomIndices(selection)![ 0 ]\n    return this.structure.getAtomProxy(idx)\n  }\n\n  _getPosition (pid: number) {\n    const clash = this.getObject(pid).clash\n    const ap1 = this._getAtomProxyFromSele(clash.sele1)\n    const ap2 = this._getAtomProxyFromSele(clash.sele2)\n    return new Vector3().copy(ap1 as any).add(ap2 as any).multiplyScalar(0.5)\n  }\n}\n\nclass DistancePicker extends BondPicker {\n  get type () { return 'distance' }\n}\n\nclass EllipsoidPicker extends ShapePicker {\n  get primitive () { return EllipsoidPrimitive }\n}\n\nclass IcosahedronPicker extends ShapePicker {\n  get primitive () { return IcosahedronPrimitive }\n}\n\nclass OctahedronPicker extends ShapePicker {\n  get primitive () { return OctahedronPrimitive }\n}\n\nclass BoxPicker extends ShapePicker {\n  get primitive () { return BoxPrimitive }\n}\n\nclass IgnorePicker extends Picker {\n  get type () { return 'ignore' }\n}\n\nexport interface MeshData {\n  name: string|undefined\n  serial: number\n  index: Uint32Array|Uint16Array|number[]\n  normal?: Float32Array|number[]\n  position: Float32Array|number[]\n  color: Float32Array|number[]\n}\nclass MeshPicker extends ShapePicker {\n  mesh: MeshData\n  __position: Vector3\n\n  constructor (shape: Shape, mesh: MeshData) {\n    super(shape)\n    this.mesh = mesh\n  }\n\n  get type () { return 'mesh' }\n\n  getObject (/* pid */) {\n    const m = this.mesh\n    return {\n      shape: this.shape,\n      name: m.name,\n      serial: m.serial\n    }\n  }\n\n  _getPosition (/* pid */) {\n    if (!this.__position) {\n      this.__position = calculateMeanVector3(this.mesh.position as any)\n    }\n    return this.__position\n  }\n}\n\nclass SpherePicker extends ShapePicker {\n  get primitive () { return SpherePrimitive }\n}\n\nclass SurfacePicker extends Picker {\n  surface: Surface\n  constructor (array: number[]|TypedArray|undefined, surface: Surface) {\n    super(array)\n    this.surface = surface\n  }\n\n  get type () { return 'surface' }\n  get data () { return this.surface }\n\n  getObject (pid: number) {\n    return {\n      surface: this.surface,\n      index: this.getIndex(pid)\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.surface.center.clone()\n  }\n}\n\nclass TetrahedronPicker extends ShapePicker {\n  get primitive () { return TetrahedronPrimitive }\n}\n\nclass TorusPicker extends ShapePicker {\n  get primitive () { return TorusPrimitive }\n}\n\nclass UnitcellPicker extends Picker {\n  unitcell: Unitcell\n  structure: Structure\n\n  constructor (unitcell: Unitcell, structure: Structure) {\n    super()\n    this.unitcell = unitcell\n    this.structure = structure\n  }\n\n  get type () { return 'unitcell' }\n  get data () { return this.unitcell }\n\n  getObject (/* pid */) {\n    return {\n      unitcell: this.unitcell,\n      structure: this.structure\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.unitcell.getCenter(this.structure)\n  }\n}\n\nclass UnknownPicker extends Picker {\n  get type () { return 'unknown' }\n}\n\nclass VolumePicker extends Picker {\n  volume: Volume\n  constructor (array: TypedArray, volume: Volume) {\n    super(array)\n    this.volume = volume\n  }\n\n  get type () { return 'volume' }\n  get data () { return this.volume }\n\n  getObject (pid: number) {\n    const vol = this.volume\n    const idx = this.getIndex(pid)\n    return {\n      volume: vol,\n      index: idx,\n      value: vol.data[ idx ]\n    }\n  }\n\n  _getPosition (pid: number) {\n    const dp = this.volume.position\n    const idx = this.getIndex(pid)\n    return new Vector3(\n      dp[ idx * 3 ],\n      dp[ idx * 3 + 1 ],\n      dp[ idx * 3 + 2 ]\n    )\n  }\n}\n\nclass SlicePicker extends VolumePicker {\n  get type () { return 'slice' }\n}\n\nclass PointPicker extends ShapePicker {\n  get primitive () { return PointPrimitive }\n}\n\nclass WidelinePicker extends ShapePicker {\n  get primitive () { return WidelinePrimitive }\n}\n\nPickerRegistry.add('arrow', ArrowPicker)\nPickerRegistry.add('box', BoxPicker)\nPickerRegistry.add('cone', ConePicker)\nPickerRegistry.add('cylinder', CylinderPicker)\nPickerRegistry.add('ellipsoid', EllipsoidPicker)\nPickerRegistry.add('icosahedron', IcosahedronPicker)\nPickerRegistry.add('octahedron', OctahedronPicker)\nPickerRegistry.add('sphere', SpherePicker)\nPickerRegistry.add('tetrahedron', TetrahedronPicker)\nPickerRegistry.add('torus', TorusPicker)\nPickerRegistry.add('point', PointPicker)\nPickerRegistry.add('wideline', WidelinePicker)\n\nexport {\n  Picker,\n  ShapePicker,\n  ArrowPicker,\n  AtomPicker,\n  AxesPicker,\n  BondPicker,\n  BoxPicker,\n  ConePicker,\n  ContactPicker,\n  CylinderPicker,\n  ClashPicker,\n  DistancePicker,\n  EllipsoidPicker,\n  IcosahedronPicker,\n  IgnorePicker,\n  OctahedronPicker,\n  MeshPicker,\n  SlicePicker,\n  SpherePicker,\n  SurfacePicker,\n  TetrahedronPicker,\n  TorusPicker,\n  UnitcellPicker,\n  UnknownPicker,\n  VolumePicker,\n  PointPicker,\n  WidelinePicker\n}\n","/**\n * @file Marching Cubes\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getUintArray } from '../utils'\n\nfunction getEdgeTable () {\n  return new Uint32Array([\n    0x0, 0x109, 0x203, 0x30a, 0x406, 0x50f, 0x605, 0x70c,\n    0x80c, 0x905, 0xa0f, 0xb06, 0xc0a, 0xd03, 0xe09, 0xf00,\n    0x190, 0x99, 0x393, 0x29a, 0x596, 0x49f, 0x795, 0x69c,\n    0x99c, 0x895, 0xb9f, 0xa96, 0xd9a, 0xc93, 0xf99, 0xe90,\n    0x230, 0x339, 0x33, 0x13a, 0x636, 0x73f, 0x435, 0x53c,\n    0xa3c, 0xb35, 0x83f, 0x936, 0xe3a, 0xf33, 0xc39, 0xd30,\n    0x3a0, 0x2a9, 0x1a3, 0xaa, 0x7a6, 0x6af, 0x5a5, 0x4ac,\n    0xbac, 0xaa5, 0x9af, 0x8a6, 0xfaa, 0xea3, 0xda9, 0xca0,\n    0x460, 0x569, 0x663, 0x76a, 0x66, 0x16f, 0x265, 0x36c,\n    0xc6c, 0xd65, 0xe6f, 0xf66, 0x86a, 0x963, 0xa69, 0xb60,\n    0x5f0, 0x4f9, 0x7f3, 0x6fa, 0x1f6, 0xff, 0x3f5, 0x2fc,\n    0xdfc, 0xcf5, 0xfff, 0xef6, 0x9fa, 0x8f3, 0xbf9, 0xaf0,\n    0x650, 0x759, 0x453, 0x55a, 0x256, 0x35f, 0x55, 0x15c,\n    0xe5c, 0xf55, 0xc5f, 0xd56, 0xa5a, 0xb53, 0x859, 0x950,\n    0x7c0, 0x6c9, 0x5c3, 0x4ca, 0x3c6, 0x2cf, 0x1c5, 0xcc,\n    0xfcc, 0xec5, 0xdcf, 0xcc6, 0xbca, 0xac3, 0x9c9, 0x8c0,\n    0x8c0, 0x9c9, 0xac3, 0xbca, 0xcc6, 0xdcf, 0xec5, 0xfcc,\n    0xcc, 0x1c5, 0x2cf, 0x3c6, 0x4ca, 0x5c3, 0x6c9, 0x7c0,\n    0x950, 0x859, 0xb53, 0xa5a, 0xd56, 0xc5f, 0xf55, 0xe5c,\n    0x15c, 0x55, 0x35f, 0x256, 0x55a, 0x453, 0x759, 0x650,\n    0xaf0, 0xbf9, 0x8f3, 0x9fa, 0xef6, 0xfff, 0xcf5, 0xdfc,\n    0x2fc, 0x3f5, 0xff, 0x1f6, 0x6fa, 0x7f3, 0x4f9, 0x5f0,\n    0xb60, 0xa69, 0x963, 0x86a, 0xf66, 0xe6f, 0xd65, 0xc6c,\n    0x36c, 0x265, 0x16f, 0x66, 0x76a, 0x663, 0x569, 0x460,\n    0xca0, 0xda9, 0xea3, 0xfaa, 0x8a6, 0x9af, 0xaa5, 0xbac,\n    0x4ac, 0x5a5, 0x6af, 0x7a6, 0xaa, 0x1a3, 0x2a9, 0x3a0,\n    0xd30, 0xc39, 0xf33, 0xe3a, 0x936, 0x83f, 0xb35, 0xa3c,\n    0x53c, 0x435, 0x73f, 0x636, 0x13a, 0x33, 0x339, 0x230,\n    0xe90, 0xf99, 0xc93, 0xd9a, 0xa96, 0xb9f, 0x895, 0x99c,\n    0x69c, 0x795, 0x49f, 0x596, 0x29a, 0x393, 0x99, 0x190,\n    0xf00, 0xe09, 0xd03, 0xc0a, 0xb06, 0xa0f, 0x905, 0x80c,\n    0x70c, 0x605, 0x50f, 0x406, 0x30a, 0x203, 0x109, 0x0\n  ])\n}\n\nfunction getTriTable (): Int32Array {\n  return new Int32Array([\n    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 8, 3, 9, 8, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 2, 10, 0, 2, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 8, 3, 2, 10, 8, 10, 9, 8, -1, -1, -1, -1, -1, -1, -1,\n    3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 11, 2, 8, 11, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 11, 2, 1, 9, 11, 9, 8, 11, -1, -1, -1, -1, -1, -1, -1,\n    3, 10, 1, 11, 10, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 10, 1, 0, 8, 10, 8, 11, 10, -1, -1, -1, -1, -1, -1, -1,\n    3, 9, 0, 3, 11, 9, 11, 10, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 3, 0, 7, 3, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 1, 9, 4, 7, 1, 7, 3, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 4, 7, 3, 0, 4, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1,\n    9, 2, 10, 9, 0, 2, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1,\n    2, 10, 9, 2, 9, 7, 2, 7, 3, 7, 9, 4, -1, -1, -1, -1,\n    8, 4, 7, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 4, 7, 11, 2, 4, 2, 0, 4, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 1, 8, 4, 7, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1,\n    4, 7, 11, 9, 4, 11, 9, 11, 2, 9, 2, 1, -1, -1, -1, -1,\n    3, 10, 1, 3, 11, 10, 7, 8, 4, -1, -1, -1, -1, -1, -1, -1,\n    1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 4, -1, -1, -1, -1,\n    4, 7, 8, 9, 0, 11, 9, 11, 10, 11, 0, 3, -1, -1, -1, -1,\n    4, 7, 11, 4, 11, 9, 9, 11, 10, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 5, 4, 1, 5, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 5, 4, 8, 3, 5, 3, 1, 5, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 1, 2, 10, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1,\n    5, 2, 10, 5, 4, 2, 4, 0, 2, -1, -1, -1, -1, -1, -1, -1,\n    2, 10, 5, 3, 2, 5, 3, 5, 4, 3, 4, 8, -1, -1, -1, -1,\n    9, 5, 4, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 11, 2, 0, 8, 11, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1,\n    0, 5, 4, 0, 1, 5, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1,\n    2, 1, 5, 2, 5, 8, 2, 8, 11, 4, 8, 5, -1, -1, -1, -1,\n    10, 3, 11, 10, 1, 3, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 5, 0, 8, 1, 8, 10, 1, 8, 11, 10, -1, -1, -1, -1,\n    5, 4, 0, 5, 0, 11, 5, 11, 10, 11, 0, 3, -1, -1, -1, -1,\n    5, 4, 8, 5, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1,\n    9, 7, 8, 5, 7, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 3, 0, 9, 5, 3, 5, 7, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 7, 8, 0, 1, 7, 1, 5, 7, -1, -1, -1, -1, -1, -1, -1,\n    1, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 7, 8, 9, 5, 7, 10, 1, 2, -1, -1, -1, -1, -1, -1, -1,\n    10, 1, 2, 9, 5, 0, 5, 3, 0, 5, 7, 3, -1, -1, -1, -1,\n    8, 0, 2, 8, 2, 5, 8, 5, 7, 10, 5, 2, -1, -1, -1, -1,\n    2, 10, 5, 2, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1,\n    7, 9, 5, 7, 8, 9, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 7, 9, 7, 2, 9, 2, 0, 2, 7, 11, -1, -1, -1, -1,\n    2, 3, 11, 0, 1, 8, 1, 7, 8, 1, 5, 7, -1, -1, -1, -1,\n    11, 2, 1, 11, 1, 7, 7, 1, 5, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 8, 8, 5, 7, 10, 1, 3, 10, 3, 11, -1, -1, -1, -1,\n    5, 7, 0, 5, 0, 9, 7, 11, 0, 1, 0, 10, 11, 10, 0, -1,\n    11, 10, 0, 11, 0, 3, 10, 5, 0, 8, 0, 7, 5, 7, 0, -1,\n    11, 10, 5, 7, 11, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 1, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 8, 3, 1, 9, 8, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 5, 2, 6, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 5, 1, 2, 6, 3, 0, 8, -1, -1, -1, -1, -1, -1, -1,\n    9, 6, 5, 9, 0, 6, 0, 2, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 9, 8, 5, 8, 2, 5, 2, 6, 3, 2, 8, -1, -1, -1, -1,\n    2, 3, 11, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 0, 8, 11, 2, 0, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 1, 9, 2, 9, 11, 2, 9, 8, 11, -1, -1, -1, -1,\n    6, 3, 11, 6, 5, 3, 5, 1, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 11, 0, 11, 5, 0, 5, 1, 5, 11, 6, -1, -1, -1, -1,\n    3, 11, 6, 0, 3, 6, 0, 6, 5, 0, 5, 9, -1, -1, -1, -1,\n    6, 5, 9, 6, 9, 11, 11, 9, 8, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 3, 0, 4, 7, 3, 6, 5, 10, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 5, 10, 6, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1,\n    10, 6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 4, -1, -1, -1, -1,\n    6, 1, 2, 6, 5, 1, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 5, 5, 2, 6, 3, 0, 4, 3, 4, 7, -1, -1, -1, -1,\n    8, 4, 7, 9, 0, 5, 0, 6, 5, 0, 2, 6, -1, -1, -1, -1,\n    7, 3, 9, 7, 9, 4, 3, 2, 9, 5, 9, 6, 2, 6, 9, -1,\n    3, 11, 2, 7, 8, 4, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 4, 7, 2, 4, 2, 0, 2, 7, 11, -1, -1, -1, -1,\n    0, 1, 9, 4, 7, 8, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1,\n    9, 2, 1, 9, 11, 2, 9, 4, 11, 7, 11, 4, 5, 10, 6, -1,\n    8, 4, 7, 3, 11, 5, 3, 5, 1, 5, 11, 6, -1, -1, -1, -1,\n    5, 1, 11, 5, 11, 6, 1, 0, 11, 7, 11, 4, 0, 4, 11, -1,\n    0, 5, 9, 0, 6, 5, 0, 3, 6, 11, 6, 3, 8, 4, 7, -1,\n    6, 5, 9, 6, 9, 11, 4, 7, 9, 7, 11, 9, -1, -1, -1, -1,\n    10, 4, 9, 6, 4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 10, 6, 4, 9, 10, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1,\n    10, 0, 1, 10, 6, 0, 6, 4, 0, -1, -1, -1, -1, -1, -1, -1,\n    8, 3, 1, 8, 1, 6, 8, 6, 4, 6, 1, 10, -1, -1, -1, -1,\n    1, 4, 9, 1, 2, 4, 2, 6, 4, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 1, 2, 9, 2, 4, 9, 2, 6, 4, -1, -1, -1, -1,\n    0, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 3, 2, 8, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1,\n    10, 4, 9, 10, 6, 4, 11, 2, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 2, 2, 8, 11, 4, 9, 10, 4, 10, 6, -1, -1, -1, -1,\n    3, 11, 2, 0, 1, 6, 0, 6, 4, 6, 1, 10, -1, -1, -1, -1,\n    6, 4, 1, 6, 1, 10, 4, 8, 1, 2, 1, 11, 8, 11, 1, -1,\n    9, 6, 4, 9, 3, 6, 9, 1, 3, 11, 6, 3, -1, -1, -1, -1,\n    8, 11, 1, 8, 1, 0, 11, 6, 1, 9, 1, 4, 6, 4, 1, -1,\n    3, 11, 6, 3, 6, 0, 0, 6, 4, -1, -1, -1, -1, -1, -1, -1,\n    6, 4, 8, 11, 6, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 10, 6, 7, 8, 10, 8, 9, 10, -1, -1, -1, -1, -1, -1, -1,\n    0, 7, 3, 0, 10, 7, 0, 9, 10, 6, 7, 10, -1, -1, -1, -1,\n    10, 6, 7, 1, 10, 7, 1, 7, 8, 1, 8, 0, -1, -1, -1, -1,\n    10, 6, 7, 10, 7, 1, 1, 7, 3, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 6, 1, 6, 8, 1, 8, 9, 8, 6, 7, -1, -1, -1, -1,\n    2, 6, 9, 2, 9, 1, 6, 7, 9, 0, 9, 3, 7, 3, 9, -1,\n    7, 8, 0, 7, 0, 6, 6, 0, 2, -1, -1, -1, -1, -1, -1, -1,\n    7, 3, 2, 6, 7, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 11, 10, 6, 8, 10, 8, 9, 8, 6, 7, -1, -1, -1, -1,\n    2, 0, 7, 2, 7, 11, 0, 9, 7, 6, 7, 10, 9, 10, 7, -1,\n    1, 8, 0, 1, 7, 8, 1, 10, 7, 6, 7, 10, 2, 3, 11, -1,\n    11, 2, 1, 11, 1, 7, 10, 6, 1, 6, 7, 1, -1, -1, -1, -1,\n    8, 9, 6, 8, 6, 7, 9, 1, 6, 11, 6, 3, 1, 3, 6, -1,\n    0, 9, 1, 11, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 8, 0, 7, 0, 6, 3, 11, 0, 11, 6, 0, -1, -1, -1, -1,\n    7, 11, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 1, 9, 8, 3, 1, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1,\n    10, 1, 2, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 3, 0, 8, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1,\n    2, 9, 0, 2, 10, 9, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1,\n    6, 11, 7, 2, 10, 3, 10, 8, 3, 10, 9, 8, -1, -1, -1, -1,\n    7, 2, 3, 6, 2, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 0, 8, 7, 6, 0, 6, 2, 0, -1, -1, -1, -1, -1, -1, -1,\n    2, 7, 6, 2, 3, 7, 0, 1, 9, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 2, 1, 8, 6, 1, 9, 8, 8, 7, 6, -1, -1, -1, -1,\n    10, 7, 6, 10, 1, 7, 1, 3, 7, -1, -1, -1, -1, -1, -1, -1,\n    10, 7, 6, 1, 7, 10, 1, 8, 7, 1, 0, 8, -1, -1, -1, -1,\n    0, 3, 7, 0, 7, 10, 0, 10, 9, 6, 10, 7, -1, -1, -1, -1,\n    7, 6, 10, 7, 10, 8, 8, 10, 9, -1, -1, -1, -1, -1, -1, -1,\n    6, 8, 4, 11, 8, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 6, 11, 3, 0, 6, 0, 4, 6, -1, -1, -1, -1, -1, -1, -1,\n    8, 6, 11, 8, 4, 6, 9, 0, 1, -1, -1, -1, -1, -1, -1, -1,\n    9, 4, 6, 9, 6, 3, 9, 3, 1, 11, 3, 6, -1, -1, -1, -1,\n    6, 8, 4, 6, 11, 8, 2, 10, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 3, 0, 11, 0, 6, 11, 0, 4, 6, -1, -1, -1, -1,\n    4, 11, 8, 4, 6, 11, 0, 2, 9, 2, 10, 9, -1, -1, -1, -1,\n    10, 9, 3, 10, 3, 2, 9, 4, 3, 11, 3, 6, 4, 6, 3, -1,\n    8, 2, 3, 8, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1,\n    0, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 2, 3, 4, 2, 4, 6, 4, 3, 8, -1, -1, -1, -1,\n    1, 9, 4, 1, 4, 2, 2, 4, 6, -1, -1, -1, -1, -1, -1, -1,\n    8, 1, 3, 8, 6, 1, 8, 4, 6, 6, 10, 1, -1, -1, -1, -1,\n    10, 1, 0, 10, 0, 6, 6, 0, 4, -1, -1, -1, -1, -1, -1, -1,\n    4, 6, 3, 4, 3, 8, 6, 10, 3, 0, 3, 9, 10, 9, 3, -1,\n    10, 9, 4, 6, 10, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 5, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 4, 9, 5, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 0, 1, 5, 4, 0, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1,\n    11, 7, 6, 8, 3, 4, 3, 5, 4, 3, 1, 5, -1, -1, -1, -1,\n    9, 5, 4, 10, 1, 2, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1,\n    6, 11, 7, 1, 2, 10, 0, 8, 3, 4, 9, 5, -1, -1, -1, -1,\n    7, 6, 11, 5, 4, 10, 4, 2, 10, 4, 0, 2, -1, -1, -1, -1,\n    3, 4, 8, 3, 5, 4, 3, 2, 5, 10, 5, 2, 11, 7, 6, -1,\n    7, 2, 3, 7, 6, 2, 5, 4, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, 0, 8, 6, 0, 6, 2, 6, 8, 7, -1, -1, -1, -1,\n    3, 6, 2, 3, 7, 6, 1, 5, 0, 5, 4, 0, -1, -1, -1, -1,\n    6, 2, 8, 6, 8, 7, 2, 1, 8, 4, 8, 5, 1, 5, 8, -1,\n    9, 5, 4, 10, 1, 6, 1, 7, 6, 1, 3, 7, -1, -1, -1, -1,\n    1, 6, 10, 1, 7, 6, 1, 0, 7, 8, 7, 0, 9, 5, 4, -1,\n    4, 0, 10, 4, 10, 5, 0, 3, 10, 6, 10, 7, 3, 7, 10, -1,\n    7, 6, 10, 7, 10, 8, 5, 4, 10, 4, 8, 10, -1, -1, -1, -1,\n    6, 9, 5, 6, 11, 9, 11, 8, 9, -1, -1, -1, -1, -1, -1, -1,\n    3, 6, 11, 0, 6, 3, 0, 5, 6, 0, 9, 5, -1, -1, -1, -1,\n    0, 11, 8, 0, 5, 11, 0, 1, 5, 5, 6, 11, -1, -1, -1, -1,\n    6, 11, 3, 6, 3, 5, 5, 3, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 9, 5, 11, 9, 11, 8, 11, 5, 6, -1, -1, -1, -1,\n    0, 11, 3, 0, 6, 11, 0, 9, 6, 5, 6, 9, 1, 2, 10, -1,\n    11, 8, 5, 11, 5, 6, 8, 0, 5, 10, 5, 2, 0, 2, 5, -1,\n    6, 11, 3, 6, 3, 5, 2, 10, 3, 10, 5, 3, -1, -1, -1, -1,\n    5, 8, 9, 5, 2, 8, 5, 6, 2, 3, 8, 2, -1, -1, -1, -1,\n    9, 5, 6, 9, 6, 0, 0, 6, 2, -1, -1, -1, -1, -1, -1, -1,\n    1, 5, 8, 1, 8, 0, 5, 6, 8, 3, 8, 2, 6, 2, 8, -1,\n    1, 5, 6, 2, 1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 3, 6, 1, 6, 10, 3, 8, 6, 5, 6, 9, 8, 9, 6, -1,\n    10, 1, 0, 10, 0, 6, 9, 5, 0, 5, 6, 0, -1, -1, -1, -1,\n    0, 3, 8, 5, 6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    10, 5, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 5, 10, 7, 5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 5, 10, 11, 7, 5, 8, 3, 0, -1, -1, -1, -1, -1, -1, -1,\n    5, 11, 7, 5, 10, 11, 1, 9, 0, -1, -1, -1, -1, -1, -1, -1,\n    10, 7, 5, 10, 11, 7, 9, 8, 1, 8, 3, 1, -1, -1, -1, -1,\n    11, 1, 2, 11, 7, 1, 7, 5, 1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 1, 2, 7, 1, 7, 5, 7, 2, 11, -1, -1, -1, -1,\n    9, 7, 5, 9, 2, 7, 9, 0, 2, 2, 11, 7, -1, -1, -1, -1,\n    7, 5, 2, 7, 2, 11, 5, 9, 2, 3, 2, 8, 9, 8, 2, -1,\n    2, 5, 10, 2, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1,\n    8, 2, 0, 8, 5, 2, 8, 7, 5, 10, 2, 5, -1, -1, -1, -1,\n    9, 0, 1, 5, 10, 3, 5, 3, 7, 3, 10, 2, -1, -1, -1, -1,\n    9, 8, 2, 9, 2, 1, 8, 7, 2, 10, 2, 5, 7, 5, 2, -1,\n    1, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 7, 0, 7, 1, 1, 7, 5, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 3, 9, 3, 5, 5, 3, 7, -1, -1, -1, -1, -1, -1, -1,\n    9, 8, 7, 5, 9, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    5, 8, 4, 5, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1,\n    5, 0, 4, 5, 11, 0, 5, 10, 11, 11, 3, 0, -1, -1, -1, -1,\n    0, 1, 9, 8, 4, 10, 8, 10, 11, 10, 4, 5, -1, -1, -1, -1,\n    10, 11, 4, 10, 4, 5, 11, 3, 4, 9, 4, 1, 3, 1, 4, -1,\n    2, 5, 1, 2, 8, 5, 2, 11, 8, 4, 5, 8, -1, -1, -1, -1,\n    0, 4, 11, 0, 11, 3, 4, 5, 11, 2, 11, 1, 5, 1, 11, -1,\n    0, 2, 5, 0, 5, 9, 2, 11, 5, 4, 5, 8, 11, 8, 5, -1,\n    9, 4, 5, 2, 11, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 5, 10, 3, 5, 2, 3, 4, 5, 3, 8, 4, -1, -1, -1, -1,\n    5, 10, 2, 5, 2, 4, 4, 2, 0, -1, -1, -1, -1, -1, -1, -1,\n    3, 10, 2, 3, 5, 10, 3, 8, 5, 4, 5, 8, 0, 1, 9, -1,\n    5, 10, 2, 5, 2, 4, 1, 9, 2, 9, 4, 2, -1, -1, -1, -1,\n    8, 4, 5, 8, 5, 3, 3, 5, 1, -1, -1, -1, -1, -1, -1, -1,\n    0, 4, 5, 1, 0, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 4, 5, 8, 5, 3, 9, 0, 5, 0, 3, 5, -1, -1, -1, -1,\n    9, 4, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 11, 7, 4, 9, 11, 9, 10, 11, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 4, 9, 7, 9, 11, 7, 9, 10, 11, -1, -1, -1, -1,\n    1, 10, 11, 1, 11, 4, 1, 4, 0, 7, 4, 11, -1, -1, -1, -1,\n    3, 1, 4, 3, 4, 8, 1, 10, 4, 7, 4, 11, 10, 11, 4, -1,\n    4, 11, 7, 9, 11, 4, 9, 2, 11, 9, 1, 2, -1, -1, -1, -1,\n    9, 7, 4, 9, 11, 7, 9, 1, 11, 2, 11, 1, 0, 8, 3, -1,\n    11, 7, 4, 11, 4, 2, 2, 4, 0, -1, -1, -1, -1, -1, -1, -1,\n    11, 7, 4, 11, 4, 2, 8, 3, 4, 3, 2, 4, -1, -1, -1, -1,\n    2, 9, 10, 2, 7, 9, 2, 3, 7, 7, 4, 9, -1, -1, -1, -1,\n    9, 10, 7, 9, 7, 4, 10, 2, 7, 8, 7, 0, 2, 0, 7, -1,\n    3, 7, 10, 3, 10, 2, 7, 4, 10, 1, 10, 0, 4, 0, 10, -1,\n    1, 10, 2, 8, 7, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 1, 4, 1, 7, 7, 1, 3, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 1, 4, 1, 7, 0, 8, 1, 8, 7, 1, -1, -1, -1, -1,\n    4, 0, 3, 7, 4, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 8, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 9, 3, 9, 11, 11, 9, 10, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 10, 0, 10, 8, 8, 10, 11, -1, -1, -1, -1, -1, -1, -1,\n    3, 1, 10, 11, 3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 11, 1, 11, 9, 9, 11, 8, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 9, 3, 9, 11, 1, 2, 9, 2, 11, 9, -1, -1, -1, -1,\n    0, 2, 11, 8, 0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 8, 2, 8, 10, 10, 8, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 10, 2, 0, 9, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 8, 2, 8, 10, 0, 1, 8, 1, 10, 8, -1, -1, -1, -1,\n    1, 10, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 3, 8, 9, 1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 9, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 3, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1\n  ])\n}\n\ninterface MarchingCubes {\n  new (field: number[], nx: number, ny: number, nz: number, atomindex: number[]): void\n  triangulate: (_isolevel: number, _noNormals: boolean, _box: number[][]|undefined, _contour: boolean, _wrap: boolean) => {\n    position: Float32Array\n    normal: undefined|Float32Array\n    index: Uint32Array|Uint16Array\n    atomindex: Int32Array|undefined\n    contour: boolean\n  }\n}\nfunction MarchingCubes (this: MarchingCubes, field: number[], nx: number, ny: number, nz: number, atomindex: number[]) {\n  // Based on alteredq / http://alteredqualia.com/\n  // port of greggman's ThreeD version of marching cubes to Three.js\n  // http://webglsamples.googlecode.com/hg/blob/blob.html\n  //\n  // Adapted for NGL by Alexander Rose\n\n  // Triangles are constructed between points on cube edges.\n  // allowedContours[edge1][edge1] indicates which lines from a given\n  // triangle should be shown in line mode.\n\n  // Values are bitmasks:\n  // In loop over cubes we keep another bitmask indicating whether our current\n  // cell is the first x-value (1),\n  // first y-value (2) or first z-value (4) of the current loop.\n  // We draw all lines on leading faces but only draw trailing face lines the first\n  // time through the loop\n  // A value of 8 below means the edge is always drawn (leading face)\n\n  // E.g. the first row, lines between edge0 and other edges in the bottom\n  // x-y plane are only drawn for the first value of z, edges in the\n  // x-z plane are only drawn for the first value of y. No other lines\n  // are drawn as they're redundant\n  // The line between edge 1 and 5 is always drawn as it's on the leading edge\n  var allowedContours = [\n\n    [ 0, 4, 4, 4, 2, 0, 0, 0, 2, 2, 0, 0 ], // 1 2 3 4 8 9\n    [ 4, 0, 4, 4, 0, 8, 0, 0, 0, 8, 8, 0 ], // 0 2 3 5 9 10\n    [ 4, 4, 0, 4, 0, 0, 8, 0, 0, 0, 8, 8 ], // 0 1 3 6 10 11\n    [ 4, 4, 4, 0, 0, 0, 0, 1, 1, 0, 0, 1 ], // 0 1 2 7 8 11\n    [ 2, 0, 0, 0, 0, 8, 8, 8, 2, 2, 0, 0 ], // 0 5 6 7 8 9\n    [ 0, 8, 0, 0, 8, 0, 8, 8, 0, 8, 8, 0 ], // And rotate it\n    [ 0, 0, 8, 0, 8, 8, 0, 8, 0, 0, 8, 8 ],\n    [ 0, 0, 0, 1, 8, 8, 8, 0, 1, 0, 0, 1 ],\n    [ 2, 0, 0, 1, 2, 0, 0, 1, 0, 2, 0, 1 ], // 0 3 4 7 9 11\n    [ 2, 8, 0, 0, 2, 8, 0, 0, 2, 0, 8, 0 ], // And rotate some more\n    [ 0, 8, 8, 0, 0, 8, 8, 0, 0, 8, 0, 8 ],\n    [ 0, 0, 8, 1, 0, 0, 8, 1, 1, 0, 8, 0 ]\n\n  ]\n\n  var isolevel = 0\n  var noNormals = false\n  var contour = false\n  var wrap = false\n  var isNegativeIso = false\n  var normalFactor = -1\n\n\n  var n = nx * ny * nz\n\n  // deltas\n  var yd = nx\n  var zd = nx * ny\n\n  var normalCache: Float32Array, vertexIndex: Int32Array\n  var count: number, icount: number\n\n  var ilist = new Int32Array(12)\n\n  var positionArray: number[] = []\n  var normalArray: number[] = []\n  var indexArray: number[] = []\n  var atomindexArray: number[] = []\n\n  var edgeTable = getEdgeTable()\n  var triTable = getTriTable()\n\n  var mx: number, my: number, mz: number\n\n  //\n\n  this.triangulate = function (_isolevel: number, _noNormals: boolean, _box: number[][]|undefined, _contour: boolean, _wrap: boolean) {\n    isolevel = _isolevel\n    isNegativeIso = isolevel < 0.0\n    contour = _contour\n    wrap = _wrap\n    // Normals currently disabled in contour mode for performance (unused)\n    noNormals = _noNormals || contour\n\n    if (!noNormals) {\n      normalFactor = isolevel > 0 ? -1.0 : 1.0\n      if (!normalCache) {\n        normalCache = new Float32Array(n * 3)\n      }  \n    }\n\n    var vIndexLength = n * 3\n\n    if (!vertexIndex || vertexIndex.length !== vIndexLength) {\n      vertexIndex = new Int32Array(vIndexLength)\n    }\n\n    count = 0\n    icount = 0\n\n    if (_box !== undefined) {\n      var min = _box[ 0 ].map(Math.round)\n      var max = _box[ 1 ].map(Math.round)\n\n      mx = nx * Math.ceil(Math.abs(min[ 0 ]) / nx)\n      my = ny * Math.ceil(Math.abs(min[ 1 ]) / ny)\n      mz = nz * Math.ceil(Math.abs(min[ 2 ]) / nz)\n\n      triangulate(\n        min[ 0 ], min[ 1 ], min[ 2 ],\n        max[ 0 ], max[ 1 ], max[ 2 ]\n      )\n    } else {\n      mx = my = mz = 0\n\n      triangulate()\n    }\n\n    positionArray.length = count * 3\n    if (!noNormals) normalArray.length = count * 3\n    indexArray.length = icount\n    if (atomindex) atomindexArray.length = count\n\n    return {\n      position: new Float32Array(positionArray),\n      normal: noNormals ? undefined : new Float32Array(normalArray),\n      index: getUintArray(indexArray, positionArray.length / 3),\n      atomindex: atomindex ? new Int32Array(atomindexArray) : undefined,\n      contour: contour\n    }\n  }\n\n  // polygonization\n\n  function lerp (a: number, b: number, t: number) { return a + (b - a) * t }\n\n  function index (x: number, y: number, z: number) {\n    x = (x + mx) % nx\n    y = (y + my) % ny\n    z = (z + mz) % nz\n    return ((zd * z) + yd * y) + x\n  }\n\n  function VIntX (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c ] = x + mu\n      positionArray[ c + 1 ] = y\n      positionArray[ c + 2 ] = z\n\n      if (!noNormals) {\n        var q3 = q * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q3 + 3 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q3 + 4 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q3 + 5 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function VIntY (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q + 1\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c ] = x\n      positionArray[ c + 1 ] = y + mu\n      positionArray[ c + 2 ] = z\n\n      if (!noNormals) {\n        var q3 = q * 3\n        var q6 = q3 + yd * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q6 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q6 + 1 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q6 + 2 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) * yd ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function VIntZ (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q + 2\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c ] = x\n      positionArray[ c + 1 ] = y\n      positionArray[ c + 2 ] = z + mu\n\n      if (!noNormals) {\n        var q3 = q * 3\n        var q6 = q3 + zd * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q6 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q6 + 1 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q6 + 2 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) * zd ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function compNorm (q: number) {\n    var q3 = q * 3\n\n    if (normalCache[ q3 ] === 0.0) {\n      normalCache[ q3 ] = field[ (q - 1 + n) % n ] - field[ (q + 1) % n ]\n      normalCache[ q3 + 1 ] = field[ (q - yd + n) % n ] - field[ (q + yd) % n ]\n      normalCache[ q3 + 2 ] = field[ (q - zd + n) % n ] - field[ (q + zd) % n ]\n    }\n  }\n\n  function polygonize (fx: number, fy: number, fz: number, q: number, edgeFilter: number) {\n    // cache indices\n    var q1\n    var qy\n    var qz\n    var q1y\n    var q1z\n    var qyz\n    var q1yz\n    if (wrap) {\n      q = index(fx, fy, fz)\n      q1 = index(fx + 1, fy, fz)\n      qy = index(fx, fy + 1, fz)\n      qz = index(fx, fy, fz + 1)\n      q1y = index(fx + 1, fy + 1, fz)\n      q1z = index(fx + 1, fy, fz + 1)\n      qyz = index(fx, fy + 1, fz + 1)\n      q1yz = index(fx + 1, fy + 1, fz + 1)\n    } else {\n      q1 = q + 1\n      qy = q + yd\n      qz = q + zd\n      q1y = qy + 1\n      q1z = qz + 1\n      qyz = qy + zd\n      q1yz = qyz + 1\n    }\n\n    var cubeindex = 0\n    var field0 = field[ q ]\n    var field1 = field[ q1 ]\n    var field2 = field[ qy ]\n    var field3 = field[ q1y ]\n    var field4 = field[ qz ]\n    var field5 = field[ q1z ]\n    var field6 = field[ qyz ]\n    var field7 = field[ q1yz ]\n\n    if (field0 < isolevel) cubeindex |= 1\n    if (field1 < isolevel) cubeindex |= 2\n    if (field2 < isolevel) cubeindex |= 8\n    if (field3 < isolevel) cubeindex |= 4\n    if (field4 < isolevel) cubeindex |= 16\n    if (field5 < isolevel) cubeindex |= 32\n    if (field6 < isolevel) cubeindex |= 128\n    if (field7 < isolevel) cubeindex |= 64\n\n    // if cube is entirely in/out of the surface - bail, nothing to draw\n\n    var bits = edgeTable[ cubeindex ]\n    if (bits === 0) return 0\n\n    var fx2 = fx + 1\n    var fy2 = fy + 1\n    var fz2 = fz + 1\n\n    // top of the cube\n\n    if (bits & 1) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(q1)\n      }\n      VIntX(q, 0, fx, fy, fz, field0, field1)\n    }\n\n    if (bits & 2) {\n      if (!noNormals) {\n        compNorm(q1)\n        compNorm(q1y)\n      }\n      VIntY(q1, 1, fx2, fy, fz, field1, field3)\n    }\n\n    if (bits & 4) {\n      if (!noNormals) {\n        compNorm(qy)\n        compNorm(q1y)\n      }\n      VIntX(qy, 2, fx, fy2, fz, field2, field3)\n    }\n\n    if (bits & 8) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(qy)\n      }\n      VIntY(q, 3, fx, fy, fz, field0, field2)\n    }\n\n    // bottom of the cube\n\n    if (bits & 16) {\n      if (!noNormals) {\n        compNorm(qz)\n        compNorm(q1z)\n      }\n      VIntX(qz, 4, fx, fy, fz2, field4, field5)\n    }\n\n    if (bits & 32) {\n      if (!noNormals) {\n        compNorm(q1z)\n        compNorm(q1yz)\n      }\n      VIntY(q1z, 5, fx2, fy, fz2, field5, field7)\n    }\n\n    if (bits & 64) {\n      if (!noNormals) {\n        compNorm(qyz)\n        compNorm(q1yz)\n      }\n      VIntX(qyz, 6, fx, fy2, fz2, field6, field7)\n    }\n\n    if (bits & 128) {\n      if (!noNormals) {\n        compNorm(qz)\n        compNorm(qyz)\n      }\n      VIntY(qz, 7, fx, fy, fz2, field4, field6)\n    }\n\n    // vertical lines of the cube\n\n    if (bits & 256) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(qz)\n      }\n      VIntZ(q, 8, fx, fy, fz, field0, field4)\n    }\n\n    if (bits & 512) {\n      if (!noNormals) {\n        compNorm(q1)\n        compNorm(q1z)\n      }\n      VIntZ(q1, 9, fx2, fy, fz, field1, field5)\n    }\n\n    if (bits & 1024) {\n      if (!noNormals) {\n        compNorm(q1y)\n        compNorm(q1yz)\n      }\n      VIntZ(q1y, 10, fx2, fy2, fz, field3, field7)\n    }\n\n    if (bits & 2048) {\n      if (!noNormals) {\n        compNorm(qy)\n        compNorm(qyz)\n      }\n      VIntZ(qy, 11, fx, fy2, fz, field2, field6)\n    }\n\n    var triIndex = cubeindex << 4 // re-purpose cubeindex into an offset into triTable\n\n    var e1\n    var e2\n    var e3\n    var i = 0\n\n    // here is where triangles are created\n\n    while (triTable[ triIndex + i ] !== -1) {\n      e1 = triTable[ triIndex + i ]\n      e2 = triTable[ triIndex + i + 1 ]\n      e3 = triTable[ triIndex + i + 2 ]\n\n      if (contour) {\n        if (allowedContours[ e1 ][ e2 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e1 ]\n          indexArray[ icount++ ] = ilist[ e2 ]\n        }\n        if (allowedContours[ e2 ][ e3 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e2 ]\n          indexArray[ icount++ ] = ilist[ e3 ]\n        }\n        if (allowedContours[ e1 ][ e3 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e1 ]\n          indexArray[ icount++ ] = ilist[ e3 ]\n        }\n      } else {\n        indexArray[ icount++ ] = ilist[ isNegativeIso ? e1 : e2 ]\n        indexArray[ icount++ ] = ilist[ isNegativeIso ? e2 : e1 ]\n        indexArray[ icount++ ] = ilist[ e3 ]\n      }\n\n      i += 3\n    }\n  }\n\n  function triangulate (xBeg?: number, yBeg?: number, zBeg?: number, xEnd?: number, yEnd?: number, zEnd?: number) {\n    let q\n    let q3\n    let x\n    let y\n    let z\n    let yOffset\n    let zOffset\n\n    xBeg = xBeg !== undefined ? xBeg : 0\n    yBeg = yBeg !== undefined ? yBeg : 0\n    zBeg = zBeg !== undefined ? zBeg : 0\n\n    xEnd = xEnd !== undefined ? xEnd : nx - 1\n    yEnd = yEnd !== undefined ? yEnd : ny - 1\n    zEnd = zEnd !== undefined ? zEnd : nz - 1\n\n    if (!wrap) {\n      if (noNormals) {\n        xBeg = Math.max(0, xBeg)\n        yBeg = Math.max(0, yBeg)\n        zBeg = Math.max(0, zBeg)\n\n        xEnd = Math.min(nx - 1, xEnd)\n        yEnd = Math.min(ny - 1, yEnd)\n        zEnd = Math.min(nz - 1, zEnd)\n      } else {\n        xBeg = Math.max(1, xBeg)\n        yBeg = Math.max(1, yBeg)\n        zBeg = Math.max(1, zBeg)\n\n        xEnd = Math.min(nx - 2, xEnd)\n        yEnd = Math.min(ny - 2, yEnd)\n        zEnd = Math.min(nz - 2, zEnd)\n      }\n    }\n\n    let xBeg2, yBeg2, zBeg2, xEnd2, yEnd2, zEnd2\n\n    if (!wrap) {\n      // init part of the vertexIndex\n      // (takes a significant amount of time to do for all)\n\n      xBeg2 = Math.max(0, xBeg - 2)\n      yBeg2 = Math.max(0, yBeg - 2)\n      zBeg2 = Math.max(0, zBeg - 2)\n\n      xEnd2 = Math.min(nx, xEnd + 2)\n      yEnd2 = Math.min(ny, yEnd + 2)\n      zEnd2 = Math.min(nz, zEnd + 2)\n\n      for (z = zBeg2; z < zEnd2; ++z) {\n        zOffset = zd * z\n        for (y = yBeg2; y < yEnd2; ++y) {\n          yOffset = zOffset + yd * y\n          for (x = xBeg2; x < xEnd2; ++x) {\n            q = 3 * (yOffset + x)\n            vertexIndex[ q ] = -1\n            vertexIndex[ q + 1 ] = -1\n            vertexIndex[ q + 2 ] = -1\n          }\n        }\n      }\n    } else {\n      xBeg2 = xBeg - 2\n      yBeg2 = yBeg - 2\n      zBeg2 = zBeg - 2\n\n      xEnd2 = xEnd + 2\n      yEnd2 = yEnd + 2\n      zEnd2 = zEnd + 2\n\n      for (z = zBeg2; z < zEnd2; ++z) {\n        for (y = yBeg2; y < yEnd2; ++y) {\n          for (x = xBeg2; x < xEnd2; ++x) {\n            q3 = index(x, y, z) * 3\n            vertexIndex[ q3 ] = -1\n            vertexIndex[ q3 + 1 ] = -1\n            vertexIndex[ q3 + 2 ] = -1\n          }\n        }\n      }\n    }\n\n    if (!wrap) {\n      // clip space where the isovalue is too low\n\n      var __break\n      var __xBeg = xBeg; var __yBeg = yBeg; var __zBeg = zBeg\n      var __xEnd = xEnd; var __yEnd = yEnd; var __zEnd = zEnd\n\n      __break = false\n      for (z = zBeg; z < zEnd; ++z) {\n        for (y = yBeg; y < yEnd; ++y) {\n          for (x = xBeg; x < xEnd; ++x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __zBeg = z\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (y = yBeg; y < yEnd; ++y) {\n        for (z = __zBeg; z < zEnd; ++z) {\n          for (x = xBeg; x < xEnd; ++x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __yBeg = y\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (x = xBeg; x < xEnd; ++x) {\n        for (y = __yBeg; y < yEnd; ++y) {\n          for (z = __zBeg; z < zEnd; ++z) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __xBeg = x\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (z = zEnd; z >= zBeg; --z) {\n        for (y = yEnd; y >= yBeg; --y) {\n          for (x = xEnd; x >= xBeg; --x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __zEnd = z\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (y = yEnd; y >= yBeg; --y) {\n        for (z = __zEnd; z >= zBeg; --z) {\n          for (x = xEnd; x >= xBeg; --x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __yEnd = y\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (x = xEnd; x >= xBeg; --x) {\n        for (y = __yEnd; y >= yBeg; --y) {\n          for (z = __zEnd; z >= zBeg; --z) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __xEnd = x\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      //\n\n      if (noNormals) {\n        xBeg = Math.max(0, __xBeg - 1)\n        yBeg = Math.max(0, __yBeg - 1)\n        zBeg = Math.max(0, __zBeg - 1)\n\n        xEnd = Math.min(nx - 1, __xEnd + 1)\n        yEnd = Math.min(ny - 1, __yEnd + 1)\n        zEnd = Math.min(nz - 1, __zEnd + 1)\n      } else {\n        xBeg = Math.max(1, __xBeg - 1)\n        yBeg = Math.max(1, __yBeg - 1)\n        zBeg = Math.max(1, __zBeg - 1)\n\n        xEnd = Math.min(nx - 2, __xEnd + 1)\n        yEnd = Math.min(ny - 2, __yEnd + 1)\n        zEnd = Math.min(nz - 2, __zEnd + 1)\n      }\n    }\n\n    // polygonize part of the grid\n    var edgeFilter = 15\n    for (z = zBeg; z < zEnd; ++z, edgeFilter &= ~4) {\n      zOffset = zd * z\n      edgeFilter |= 2\n      for (y = yBeg; y < yEnd; ++y, edgeFilter &= ~2) {\n        yOffset = zOffset + yd * y\n        edgeFilter |= 1\n        for (x = xBeg; x < xEnd; ++x, edgeFilter &= ~1) {\n          q = yOffset + x\n          polygonize(x, y, z, q, edgeFilter)\n        }\n      }\n    }\n  }\n}\nObject.assign(MarchingCubes, {__deps: [ getEdgeTable, getTriTable, getUintArray ]})\n\nexport default MarchingCubes\n","/**\n * @file Matrix Utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n *\n * svd methods from Eugene Zatepyakin / http://inspirit.github.io/jsfeat/\n */\n\nimport { NumberArray } from '../types'\nimport { v3new, v3cross } from './vector-utils'\n\nexport class Matrix {\n  size: number\n  data: Float32Array\n\n  constructor (readonly cols: number, readonly rows: number) {\n    this.size = this.cols * this.rows\n    this.data = new Float32Array(this.size)\n  }\n\n  copyTo (matrix: Matrix) {\n    matrix.data.set(this.data)\n  }\n}\n\nexport function transpose (At: Matrix, A: Matrix) {\n  let i = 0\n  let j = 0\n  const nrows = A.rows\n  const ncols = A.cols\n  let Ai = 0\n  let Ati = 0\n  let pAt = 0\n  const ad = A.data\n  const atd = At.data\n\n  for (; i < nrows; Ati += 1, Ai += ncols, i++) {\n    pAt = Ati\n    for (j = 0; j < ncols; pAt += nrows, j++) atd[pAt] = ad[Ai + j]\n  }\n}\n\n// C = A * B\nexport function multiply (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let _pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mcols = B.cols\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < nrows; Ap += ncols, i++) {\n    for (_pB = 0, j = 0; j < mcols; Cp++, _pB++, j++) {\n      pB = _pB\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < ncols; pA++, pB += mcols, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\n// C = A * B'\nexport function multiplyABt (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mrows = B.rows\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < nrows; Ap += ncols, i++) {\n    for (pB = 0, j = 0; j < mrows; Cp++, j++) {\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < ncols; pA++, pB++, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\n// C = A' * B\nexport function multiplyAtB (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let _pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mcols = B.cols\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < ncols; Ap++, i++) {\n    for (_pB = 0, j = 0; j < mcols; Cp++, _pB++, j++) {\n      pB = _pB\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < nrows; pA += ncols, pB += mcols, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\nexport function invert3x3 (from: Matrix, to: Matrix) {\n  const A = from.data\n  const invA = to.data\n  const t1 = A[4]\n  const t2 = A[8]\n  const t4 = A[5]\n  const t5 = A[7]\n  const t8 = A[0]\n\n  const t9 = t8 * t1\n  const t11 = t8 * t4\n  const t13 = A[3]\n  const t14 = A[1]\n  const t15 = t13 * t14\n  const t17 = A[2]\n  const t18 = t13 * t17\n  const t20 = A[6]\n  const t21 = t20 * t14\n  const t23 = t20 * t17\n  const t26 = 1.0 / (t9 * t2 - t11 * t5 - t15 * t2 + t18 * t5 + t21 * t4 - t23 * t1)\n  invA[0] = (t1 * t2 - t4 * t5) * t26\n  invA[1] = -(t14 * t2 - t17 * t5) * t26\n  invA[2] = -(-t14 * t4 + t17 * t1) * t26\n  invA[3] = -(t13 * t2 - t4 * t20) * t26\n  invA[4] = (t8 * t2 - t23) * t26\n  invA[5] = -(t11 - t18) * t26\n  invA[6] = -(-t13 * t5 + t1 * t20) * t26\n  invA[7] = -(t8 * t5 - t21) * t26\n  invA[8] = (t9 - t15) * t26\n}\n\nexport function mat3x3determinant (M: Matrix) {\n  const md = M.data\n  return md[0] * md[4] * md[8] -\n    md[0] * md[5] * md[7] -\n    md[3] * md[1] * md[8] +\n    md[3] * md[2] * md[7] +\n    md[6] * md[1] * md[5] -\n    md[6] * md[2] * md[4]\n}\n\n// C = A * B\nexport function multiply3x3 (C: Matrix, A: Matrix, B: Matrix) {\n  const Cd = C.data\n  const Ad = A.data\n  const Bd = B.data\n  const m10 = Ad[0]\n  const m11 = Ad[1]\n  const m12 = Ad[2]\n  const m13 = Ad[3]\n  const m14 = Ad[4]\n  const m15 = Ad[5]\n  const m16 = Ad[6]\n  const m17 = Ad[7]\n  const m18 = Ad[8]\n\n  const m20 = Bd[0]\n  const m21 = Bd[1]\n  const m22 = Bd[2]\n  const m23 = Bd[3]\n  const m24 = Bd[4]\n  const m25 = Bd[5]\n  const m26 = Bd[6]\n  const m27 = Bd[7]\n  const m28 = Bd[8]\n\n  Cd[0] = m10 * m20 + m11 * m23 + m12 * m26\n  Cd[1] = m10 * m21 + m11 * m24 + m12 * m27\n  Cd[2] = m10 * m22 + m11 * m25 + m12 * m28\n  Cd[3] = m13 * m20 + m14 * m23 + m15 * m26\n  Cd[4] = m13 * m21 + m14 * m24 + m15 * m27\n  Cd[5] = m13 * m22 + m14 * m25 + m15 * m28\n  Cd[6] = m16 * m20 + m17 * m23 + m18 * m26\n  Cd[7] = m16 * m21 + m17 * m24 + m18 * m27\n  Cd[8] = m16 * m22 + m17 * m25 + m18 * m28\n}\n\nexport function meanRows (A: Matrix) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n  const mean = new Array(ncols)\n\n  for (let j = 0; j < ncols; ++j) {\n    mean[ j ] = 0.0\n  }\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      mean[ j ] += Ad[ p ]\n    }\n  }\n\n  for (let j = 0; j < ncols; ++j) {\n    mean[ j ] /= nrows\n  }\n\n  return mean\n}\n\nexport function meanCols (A: Matrix) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n  const mean = new Array(nrows)\n\n  for (let j = 0; j < nrows; ++j) {\n    mean[ j ] = 0.0\n  }\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      mean[ j ] += Ad[ p ]\n    }\n  }\n\n  for (let j = 0; j < nrows; ++j) {\n    mean[ j ] /= ncols\n  }\n\n  return mean\n}\n\nexport function subRows (A: Matrix, row: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      Ad[ p ] -= row[ j ]\n    }\n  }\n}\n\nexport function subCols (A: Matrix, col: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      Ad[ p ] -= col[ j ]\n    }\n  }\n}\n\nexport function addRows (A: Matrix, row: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      Ad[ p ] += row[ j ]\n    }\n  }\n}\n\nexport function addCols (A: Matrix, col: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      Ad[ p ] += col[ j ]\n    }\n  }\n}\n\nexport function swap (A: NumberArray, i0: number, i1: number, t: number) {\n  t = A[i0]\n  A[i0] = A[i1]\n  A[i1] = t\n}\n\nexport function hypot (a: number, b: number) {\n  a = Math.abs(a)\n  b = Math.abs(b)\n  if (a > b) {\n    b /= a\n    return a * Math.sqrt(1.0 + b * b)\n  }\n  if (b > 0) {\n    a /= b\n    return b * Math.sqrt(1.0 + a * a)\n  }\n  return 0.0\n}\n\nconst EPSILON = 0.0000001192092896\nconst FLT_MIN = 1E-37\n\nexport function JacobiSVDImpl (At: NumberArray, astep: number, _W: NumberArray, Vt: NumberArray, vstep: number, m: number, n: number, n1: number) {\n  const eps = EPSILON * 2.0\n  const minval = FLT_MIN\n  let i = 0\n  let j = 0\n  let k = 0\n  let iter = 0\n  const maxIter = Math.max(m, 30)\n  let Ai = 0\n  let Aj = 0\n  let Vi = 0\n  let Vj = 0\n  let changed = 0\n  let c = 0.0\n  let s = 0.0\n  let t = 0.0\n  let t0 = 0.0\n  let t1 = 0.0\n  let sd = 0.0\n  let beta = 0.0\n  let gamma = 0.0\n  let delta = 0.0\n  let a = 0.0\n  let p = 0.0\n  let b = 0.0\n  let seed = 0x1234\n  let val = 0.0\n  let val0 = 0.0\n  let asum = 0.0\n\n  const W = new Float64Array(n << 3)\n\n  for (; i < n; i++) {\n    for (k = 0, sd = 0; k < m; k++) {\n      t = At[i * astep + k]\n      sd += t * t\n    }\n    W[i] = sd\n\n    if (Vt) {\n      for (k = 0; k < n; k++) {\n        Vt[i * vstep + k] = 0\n      }\n      Vt[i * vstep + i] = 1\n    }\n  }\n\n  for (; iter < maxIter; iter++) {\n    changed = 0\n\n    for (i = 0; i < n - 1; i++) {\n      for (j = i + 1; j < n; j++) {\n        Ai = (i * astep) | 0\n        Aj = (j * astep) | 0\n        a = W[i]\n        p = 0\n        b = W[j]\n\n        k = 2\n        p += At[Ai] * At[Aj]\n        p += At[Ai + 1] * At[Aj + 1]\n\n        for (; k < m; k++) { p += At[Ai + k] * At[Aj + k] }\n\n        if (Math.abs(p) <= eps * Math.sqrt(a * b)) continue\n\n        p *= 2.0\n        beta = a - b\n        gamma = hypot(p, beta)\n        if (beta < 0) {\n          delta = (gamma - beta) * 0.5\n          s = Math.sqrt(delta / gamma)\n          c = (p / (gamma * s * 2.0))\n        } else {\n          c = Math.sqrt((gamma + beta) / (gamma * 2.0))\n          s = (p / (gamma * c * 2.0))\n        }\n\n        a = 0.0\n        b = 0.0\n\n        k = 2 // unroll\n        t0 = c * At[Ai] + s * At[Aj]\n        t1 = -s * At[Ai] + c * At[Aj]\n        At[Ai] = t0; At[Aj] = t1\n        a += t0 * t0; b += t1 * t1\n\n        t0 = c * At[Ai + 1] + s * At[Aj + 1]\n        t1 = -s * At[Ai + 1] + c * At[Aj + 1]\n        At[Ai + 1] = t0; At[Aj + 1] = t1\n        a += t0 * t0; b += t1 * t1\n\n        for (; k < m; k++) {\n          t0 = c * At[Ai + k] + s * At[Aj + k]\n          t1 = -s * At[Ai + k] + c * At[Aj + k]\n          At[Ai + k] = t0; At[Aj + k] = t1\n\n          a += t0 * t0; b += t1 * t1\n        }\n\n        W[i] = a\n        W[j] = b\n\n        changed = 1\n\n        if (Vt) {\n          Vi = (i * vstep) | 0\n          Vj = (j * vstep) | 0\n\n          k = 2\n          t0 = c * Vt[Vi] + s * Vt[Vj]\n          t1 = -s * Vt[Vi] + c * Vt[Vj]\n          Vt[Vi] = t0; Vt[Vj] = t1\n\n          t0 = c * Vt[Vi + 1] + s * Vt[Vj + 1]\n          t1 = -s * Vt[Vi + 1] + c * Vt[Vj + 1]\n          Vt[Vi + 1] = t0; Vt[Vj + 1] = t1\n\n          for (; k < n; k++) {\n            t0 = c * Vt[Vi + k] + s * Vt[Vj + k]\n            t1 = -s * Vt[Vi + k] + c * Vt[Vj + k]\n            Vt[Vi + k] = t0; Vt[Vj + k] = t1\n          }\n        }\n      }\n    }\n    if (changed === 0) break\n  }\n\n  for (i = 0; i < n; i++) {\n    for (k = 0, sd = 0; k < m; k++) {\n      t = At[i * astep + k]\n      sd += t * t\n    }\n    W[i] = Math.sqrt(sd)\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    j = i\n    for (k = i + 1; k < n; k++) {\n      if (W[j] < W[k]) { j = k }\n    }\n    if (i !== j) {\n      swap(W, i, j, sd)\n      if (Vt) {\n        for (k = 0; k < m; k++) {\n          swap(At, i * astep + k, j * astep + k, t)\n        }\n\n        for (k = 0; k < n; k++) {\n          swap(Vt, i * vstep + k, j * vstep + k, t)\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    _W[i] = W[i]\n  }\n\n  if (!Vt) {\n    return\n  }\n\n  for (i = 0; i < n1; i++) {\n    sd = i < n ? W[i] : 0\n\n    while (sd <= minval) {\n      // if we got a zero singular value, then in order to get the corresponding left singular vector\n      // we generate a random vector, project it to the previously computed left singular vectors,\n      // subtract the projection and normalize the difference.\n      val0 = (1.0 / m)\n      for (k = 0; k < m; k++) {\n        seed = (seed * 214013 + 2531011)\n        val = (((seed >> 16) & 0x7fff) & 256) !== 0 ? val0 : -val0\n        At[i * astep + k] = val\n      }\n      for (iter = 0; iter < 2; iter++) {\n        for (j = 0; j < i; j++) {\n          sd = 0\n          for (k = 0; k < m; k++) {\n            sd += At[i * astep + k] * At[j * astep + k]\n          }\n          asum = 0.0\n          for (k = 0; k < m; k++) {\n            t = (At[i * astep + k] - sd * At[j * astep + k])\n            At[i * astep + k] = t\n            asum += Math.abs(t)\n          }\n          asum = asum ? 1.0 / asum : 0\n          for (k = 0; k < m; k++) {\n            At[i * astep + k] *= asum\n          }\n        }\n      }\n      sd = 0\n      for (k = 0; k < m; k++) {\n        t = At[i * astep + k]\n        sd += t * t\n      }\n      sd = Math.sqrt(sd)\n    }\n\n    s = (1.0 / sd)\n    for (k = 0; k < m; k++) {\n      At[i * astep + k] *= s\n    }\n  }\n}\n\nexport function svd (A: Matrix, W: Matrix, U: Matrix, V: Matrix) {\n  let at = 0\n  let i = 0\n  const _m = A.rows\n  const _n = A.cols\n  let m = _m\n  let n = _n\n\n  if (m < n) {\n    at = 1\n    i = m\n    m = n\n    n = i\n  }\n\n  const amt = new Matrix(m, m)\n  const wmt = new Matrix(1, n)\n  const vmt = new Matrix(n, n)\n\n  if (at === 0) {\n    transpose(amt, A)\n  } else {\n    for (i = 0; i < _n * _m; i++) {\n      amt.data[i] = A.data[i]\n    }\n    for (; i < n * m; i++) {\n      amt.data[i] = 0\n    }\n  }\n\n  JacobiSVDImpl(amt.data, m, wmt.data, vmt.data, n, m, n, m)\n\n  if (W) {\n    for (i = 0; i < n; i++) {\n      W.data[i] = wmt.data[i]\n    }\n    for (; i < _n; i++) {\n      W.data[i] = 0\n    }\n  }\n\n  if (at === 0) {\n    if (U) transpose(U, amt)\n    if (V) transpose(V, vmt)\n  } else {\n    if (U) transpose(U, vmt)\n    if (V) transpose(V, amt)\n  }\n}\n\n//\n\nexport function m4new () {\n  return new Float32Array([\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  ])\n}\n\nexport function m4set (out: Float32Array, n11: number, n12: number, n13: number, n14: number, n21: number, n22: number, n23: number, n24: number, n31: number, n32: number, n33: number, n34: number, n41: number, n42: number, n43: number, n44: number) {\n  out[ 0 ] = n11; out[ 4 ] = n12; out[ 8 ] = n13; out[ 12 ] = n14\n  out[ 1 ] = n21; out[ 5 ] = n22; out[ 9 ] = n23; out[ 13 ] = n24\n  out[ 2 ] = n31; out[ 6 ] = n32; out[ 10 ] = n33; out[ 14 ] = n34\n  out[ 3 ] = n41; out[ 7 ] = n42; out[ 11 ] = n43; out[ 15 ] = n44\n}\n\nexport function m4identity (out: Float32Array) {\n  m4set(out,\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  )\n}\n(m4identity as any).__deps = [ m4set ]\n\nexport function m4multiply (out: Float32Array, a: Float32Array, b: Float32Array) {\n  const a11 = a[ 0 ]\n  const a12 = a[ 4 ]\n  const a13 = a[ 8 ]\n  const a14 = a[ 12 ]\n  const a21 = a[ 1 ]\n  const a22 = a[ 5 ]\n  const a23 = a[ 9 ]\n  const a24 = a[ 13 ]\n  const a31 = a[ 2 ]\n  const a32 = a[ 6 ]\n  const a33 = a[ 10 ]\n  const a34 = a[ 14 ]\n  const a41 = a[ 3 ]\n  const a42 = a[ 7 ]\n  const a43 = a[ 11 ]\n  const a44 = a[ 15 ]\n\n  const b11 = b[ 0 ]\n  const b12 = b[ 4 ]\n  const b13 = b[ 8 ]\n  const b14 = b[ 12 ]\n  const b21 = b[ 1 ]\n  const b22 = b[ 5 ]\n  const b23 = b[ 9 ]\n  const b24 = b[ 13 ]\n  const b31 = b[ 2 ]\n  const b32 = b[ 6 ]\n  const b33 = b[ 10 ]\n  const b34 = b[ 14 ]\n  const b41 = b[ 3 ]\n  const b42 = b[ 7 ]\n  const b43 = b[ 11 ]\n  const b44 = b[ 15 ]\n\n  out[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41\n  out[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42\n  out[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43\n  out[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44\n\n  out[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41\n  out[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42\n  out[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43\n  out[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44\n\n  out[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41\n  out[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42\n  out[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43\n  out[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44\n\n  out[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41\n  out[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42\n  out[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43\n  out[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44\n}\n\nexport function m4makeScale (out: Float32Array, x: number, y: number, z: number) {\n  m4set(out,\n    x, 0, 0, 0,\n    0, y, 0, 0,\n    0, 0, z, 0,\n    0, 0, 0, 1\n  )\n}\n(m4makeScale as any).__deps = [ m4set ]\n\nexport function m4makeTranslation (out: Float32Array, x: number, y: number, z: number) {\n  m4set(out,\n    1, 0, 0, x,\n    0, 1, 0, y,\n    0, 0, 1, z,\n    0, 0, 0, 1\n  )\n}\n(m4makeTranslation as any).__deps = [ m4set ]\n\nexport function m4makeRotationY (out: Float32Array, theta: number) {\n  const c = Math.cos(theta)\n  const s = Math.sin(theta)\n  m4set(out,\n    c, 0, s, 0,\n    0, 1, 0, 0,\n    -s, 0, c, 0,\n    0, 0, 0, 1\n  )\n}\n(m4makeRotationY as any).__deps = [ m4set ]\n\n//\n\nexport function m3new () {\n  return new Float32Array([\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1\n  ])\n}\n\nexport function m3makeNormal (out: Float32Array, m4: Float32Array) {\n  const r0 = v3new([ m4[0], m4[1], m4[2] ])\n  const r1 = v3new([ m4[4], m4[5], m4[6] ])\n  const r2 = v3new([ m4[8], m4[9], m4[10] ])\n  const cp = v3new()\n  //        [ r0 ]       [ r1 x r2 ]\n  // M3x3 = [ r1 ]   N = [ r2 x r0 ]\n  //        [ r2 ]       [ r0 x r1 ]\n  v3cross(cp, r1, r2)\n  out[ 0 ] = cp[ 0 ]\n  out[ 1 ] = cp[ 1 ]\n  out[ 2 ] = cp[ 2 ]\n  v3cross(cp, r2, r0)\n  out[ 3 ] = cp[ 0 ]\n  out[ 4 ] = cp[ 1 ]\n  out[ 5 ] = cp[ 2 ]\n  v3cross(cp, r0, r1)\n  out[ 6 ] = cp[ 0 ]\n  out[ 7 ] = cp[ 1 ]\n  out[ 8 ] = cp[ 2 ]\n}\n(m3makeNormal as any).__deps = [ v3new, v3cross ]\n","/**\n * @file Surface Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { degToRad } from '../math/math-utils'\nimport {\n  m4new, m4multiply, m4makeTranslation, m4makeScale, m4makeRotationY\n} from '../math/matrix-utils'\nimport {\n  v3addScalar, v3subScalar, v3divideScalar, v3multiplyScalar,\n  v3floor, v3ceil, v3sub, v3negate,\n  v3cross, v3fromArray, normalizeVector3array\n} from '../math/vector-utils'\nimport { NumberArray } from '../types'\n\nfunction laplacianSmooth (verts: Float32Array, faces: Float32Array, numiter: number, inflate: boolean) {\n  // based on D. Xu, Y. Zhang (2009) Generating Triangulated Macromolecular\n  // Surfaces by Euclidean Distance Transform. PLoS ONE 4(12): e8140.\n  //\n  // Permission to use, copy, modify, and distribute this program for\n  // any purpose, with or without fee, is hereby granted, provided that\n  // the notices on the head, the reference information, and this\n  // copyright notice appear in all copies or substantial portions of\n  // the Software. It is provided \"as is\" without express or implied\n  // warranty.\n  //\n  // ported to JavaScript and adapted to NGL by Alexander Rose\n\n  numiter = numiter || 1\n  inflate = inflate || true\n\n  const nv = verts.length / 3\n  const nf = faces.length / 3\n  let norms: Float32Array | undefined = undefined\n\n  if (inflate) {\n    norms = new Float32Array(nv * 3)\n  }\n\n  const tps = new Float32Array(nv * 3)\n\n  let i\n  const ndeg = 20\n  const vertdeg = new Array(ndeg)\n\n  for (i = 0; i < ndeg; ++i) {\n    vertdeg[ i ] = new Uint32Array(nv)\n  }\n\n  for (i = 0; i < nv; ++i) {\n    vertdeg[ 0 ][ i ] = 0\n  }\n\n  let j, jl\n  let flagvert: boolean\n\n  // for each face\n\n  for (i = 0; i < nf; ++i) {\n    var ao = i * 3\n    var bo = i * 3 + 1\n    var co = i * 3 + 2\n\n    // vertex a\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ao] ]; j < jl; ++j) {\n      if (faces[ bo ] === vertdeg[ j + 1 ][ faces[ ao ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ ao ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ ao ] ] ][ faces[ ao ] ] = faces[ bo ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ ao ] ]; j < jl; ++j) {\n      if (faces[ co ] === vertdeg[ j + 1 ][ faces[ ao ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ ao ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ ao ] ] ][ faces[ ao ] ] = faces[ co ]\n    }\n\n    // vertex b\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ bo ] ]; j < jl; ++j) {\n      if (faces[ ao ] === vertdeg[ j + 1 ][ faces[ bo ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ bo ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ bo ] ] ][ faces[ bo ] ] = faces[ ao ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ bo ] ]; j < jl; ++j) {\n      if (faces[ co ] === vertdeg[ j + 1 ][ faces[ bo ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ bo ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ bo ] ] ][ faces[ bo ] ] = faces[ co ]\n    }\n\n    // vertex c\n\n    flagvert = true\n    for (j = 0; j < vertdeg[ 0 ][ faces[ co ] ]; ++j) {\n      if (faces[ ao ] === vertdeg[ j + 1 ][ faces[ co ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ co ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ co ] ] ][ faces[ co ] ] = faces[ ao ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ co ] ]; j < jl; ++j) {\n      if (faces[ bo ] === vertdeg[ j + 1 ][ faces[ co ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ co ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ co ] ] ][ faces[ co ] ] = faces[ bo ]\n    }\n  }\n\n  var wt = 1.0\n  var wt2 = 0.5\n  var i3, vi3, vdi, wtvi, wt2vi\n  var ssign = -1\n  var scaleFactor = 1\n  var outwt = 0.75 / (scaleFactor + 3.5) // area-preserving\n\n  // smoothing iterations\n\n  for (var k = 0; k < numiter; ++k) {\n    // for each vertex\n\n    for (i = 0; i < nv; ++i) {\n      i3 = i * 3\n      vdi = vertdeg[ 0 ][ i ]\n\n      if (vdi < 3) {\n        tps[ i3 ] = verts[ i3 ]\n        tps[ i3 + 1 ] = verts[ i3 + 1 ]\n        tps[ i3 + 2 ] = verts[ i3 + 2 ]\n      } else if (vdi === 3 || vdi === 4) {\n        tps[ i3 ] = 0\n        tps[ i3 + 1 ] = 0\n        tps[ i3 + 2 ] = 0\n\n        for (j = 0; j < vdi; ++j) {\n          vi3 = vertdeg[ j + 1 ][ i ] * 3\n          tps[ i3 ] += verts[ vi3 ]\n          tps[ i3 + 1 ] += verts[ vi3 + 1 ]\n          tps[ i3 + 2 ] += verts[ vi3 + 2 ]\n        }\n\n        tps[ i3 ] += wt2 * verts[ i3 ]\n        tps[ i3 + 1 ] += wt2 * verts[ i3 + 1 ]\n        tps[ i3 + 2 ] += wt2 * verts[ i3 + 2 ]\n\n        wt2vi = wt2 + vdi\n        tps[ i3 ] /= wt2vi\n        tps[ i3 + 1 ] /= wt2vi\n        tps[ i3 + 2 ] /= wt2vi\n      } else {\n        tps[ i3 ] = 0\n        tps[ i3 + 1 ] = 0\n        tps[ i3 + 2 ] = 0\n\n        for (j = 0; j < vdi; ++j) {\n          vi3 = vertdeg[ j + 1 ][ i ] * 3\n          tps[ i3 ] += verts[ vi3 ]\n          tps[ i3 + 1 ] += verts[ vi3 + 1 ]\n          tps[ i3 + 2 ] += verts[ vi3 + 2 ]\n        }\n\n        tps[ i3 ] += wt * verts[ i3 ]\n        tps[ i3 + 1 ] += wt * verts[ i3 + 1 ]\n        tps[ i3 + 2 ] += wt * verts[ i3 + 2 ]\n\n        wtvi = wt + vdi\n        tps[ i3 ] /= wtvi\n        tps[ i3 + 1 ] /= wtvi\n        tps[ i3 + 2 ] /= wtvi\n      }\n    }\n\n    verts.set(tps) // copy smoothed positions\n\n    if (inflate) {\n      computeVertexNormals(verts, faces, norms)\n      var nv3 = nv * 3\n\n      for (i3 = 0; i3 < nv3; i3 += 3) {\n        // if(verts[i].inout) ssign=1;\n        // else ssign=-1;\n\n        verts[ i3 ] += ssign * outwt * norms![ i3 ]\n        verts[ i3 + 1 ] += ssign * outwt * norms![ i3 + 1 ]\n        verts[ i3 + 2 ] += ssign * outwt * norms![ i3 + 2 ]\n      }\n    }\n  }\n}\nObject.assign(laplacianSmooth, {__deps: [ computeVertexNormals ]})\n\nfunction computeVertexNormals (position: Float32Array, index?: NumberArray, normal?: Float32Array) {\n  var i, il\n\n  if (normal === undefined) {\n    normal = new Float32Array(position.length)\n  } else {\n    // reset existing normals to zero\n    for (i = 0, il = normal.length; i < il; i++) {\n      normal[ i ] = 0\n    }\n  }\n\n  var a = new Float32Array(3)\n  var b = new Float32Array(3)\n  var c = new Float32Array(3)\n  var cb = new Float32Array(3)\n  var ab = new Float32Array(3)\n\n  if (index) {\n    // indexed elements\n    for (i = 0, il = index.length; i < il; i += 3) {\n      var ai = index[ i ] * 3\n      var bi = index[ i + 1 ] * 3\n      var ci = index[ i + 2 ] * 3\n\n      v3fromArray(a, position, ai)\n      v3fromArray(b, position, bi)\n      v3fromArray(c, position, ci)\n\n      v3sub(cb, c, b)\n      v3sub(ab, a, b)\n      v3cross(cb, cb, ab)\n\n      normal[ ai ] += cb[ 0 ]\n      normal[ ai + 1 ] += cb[ 1 ]\n      normal[ ai + 2 ] += cb[ 2 ]\n\n      normal[ bi ] += cb[ 0 ]\n      normal[ bi + 1 ] += cb[ 1 ]\n      normal[ bi + 2 ] += cb[ 2 ]\n\n      normal[ ci ] += cb[ 0 ]\n      normal[ ci + 1 ] += cb[ 1 ]\n      normal[ ci + 2 ] += cb[ 2 ]\n    }\n  } else {\n    // non-indexed elements (unconnected triangle soup)\n    for (i = 0, il = position.length; i < il; i += 9) {\n      v3fromArray(a, position, i)\n      v3fromArray(b, position, i + 3)\n      v3fromArray(c, position, i + 6)\n\n      v3sub(cb, c, b)\n      v3sub(ab, a, b)\n      v3cross(cb, cb, ab)\n\n      normal[ i ] = cb[ 0 ]\n      normal[ i + 1 ] = cb[ 1 ]\n      normal[ i + 2 ] = cb[ 2 ]\n\n      normal[ i + 3 ] = cb[ 0 ]\n      normal[ i + 4 ] = cb[ 1 ]\n      normal[ i + 5 ] = cb[ 2 ]\n\n      normal[ i + 6 ] = cb[ 0 ]\n      normal[ i + 7 ] = cb[ 1 ]\n      normal[ i + 8 ] = cb[ 2 ]\n    }\n  }\n\n  normalizeVector3array(normal)\n\n  return normal\n}\nObject.assign(computeVertexNormals, {__deps: [\n  v3sub, v3cross, v3fromArray, normalizeVector3array\n]})\n\nfunction getRadiusDict (radiusList: number[]) {\n  var radiusDict: {[k: number]: boolean} = {}\n  for (var i = 0, il = radiusList.length; i < il; ++i) {\n    radiusDict[ radiusList[ i ] ] = true\n  }\n  return radiusDict\n}\n\nfunction getSurfaceGrid (min: Float32Array, max: Float32Array, maxRadius: number, scaleFactor: number, extraMargin: number) {\n  // need margin to avoid boundary/round off effects\n  var margin = (1 / scaleFactor) * 3\n  margin += maxRadius\n\n  v3subScalar(min, min, extraMargin + margin)\n  v3addScalar(max, max, extraMargin + margin)\n\n  v3multiplyScalar(min, min, scaleFactor)\n  v3floor(min, min)\n  v3divideScalar(min, min, scaleFactor)\n\n  v3multiplyScalar(max, max, scaleFactor)\n  v3ceil(max, max)\n  v3divideScalar(max, max, scaleFactor)\n\n  var dim = new Float32Array(3)\n  v3sub(dim, max, min)\n  v3multiplyScalar(dim, dim, scaleFactor)\n  v3ceil(dim, dim)\n  v3addScalar(dim, dim, 1)\n\n  var maxSize = Math.pow(10, 6) * 256\n  var tmpSize = dim[ 0 ] * dim[ 1 ] * dim[ 2 ] * 3\n\n  if (maxSize <= tmpSize) {\n    scaleFactor *= Math.pow(maxSize / tmpSize, 1 / 3)\n\n    v3multiplyScalar(min, min, scaleFactor)\n    v3floor(min, min)\n    v3divideScalar(min, min, scaleFactor)\n\n    v3multiplyScalar(max, max, scaleFactor)\n    v3ceil(max, max)\n    v3divideScalar(max, max, scaleFactor)\n\n    v3sub(dim, max, min)\n    v3multiplyScalar(dim, dim, scaleFactor)\n    v3ceil(dim, dim)\n    v3addScalar(dim, dim, 1)\n  }\n\n  var tran = new Float32Array(min)\n  v3negate(tran, tran)\n\n  // coordinate transformation matrix\n  var matrix = m4new()\n  var mroty = m4new()\n  m4makeRotationY(mroty, degToRad(90))\n  m4multiply(matrix, matrix, mroty)\n\n  var mscale = m4new()\n  m4makeScale(\n    mscale,\n    -1 / scaleFactor,\n    1 / scaleFactor,\n    1 / scaleFactor\n  )\n  m4multiply(matrix, matrix, mscale)\n\n  var mtrans = m4new()\n  m4makeTranslation(\n    mtrans,\n    -scaleFactor * tran[2],\n    -scaleFactor * tran[1],\n    -scaleFactor * tran[0]\n  )\n  m4multiply(matrix, matrix, mtrans)\n\n  return {\n    dim: dim,\n    tran: tran,\n    matrix: matrix,\n    scaleFactor: scaleFactor\n  }\n}\nObject.assign(getSurfaceGrid, {__deps: [\n  degToRad,\n  v3subScalar, v3addScalar, v3divideScalar, v3multiplyScalar,\n  v3floor, v3ceil, v3sub, v3negate,\n  m4new, m4multiply, m4makeTranslation, m4makeScale, m4makeRotationY\n]})\n\nexport {\n  laplacianSmooth,\n  computeVertexNormals,\n  getRadiusDict,\n  getSurfaceGrid\n}\n","/**\n * @file Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3, BufferGeometry, Group, Color } from 'three'\n\nimport { Debug, Log, ColormakerRegistry } from '../globals'\nimport { getUintArray } from '../utils'\nimport { AtomPicker, SurfacePicker } from '../utils/picker'\nimport { uniformArray, uniformArray3, serialArray } from '../math/array-utils'\nimport Selection from '../selection/selection'\nimport { ColormakerParameters } from '../color/colormaker';\nimport { Structure, Volume } from '../ngl';\n\nexport interface SurfaceData {\n  position: Float32Array\n  index: Uint32Array|Uint16Array|undefined\n  normal: Float32Array\n  color: Float32Array\n  atomindex: Int32Array\n  contour: boolean\n}\n/**\n * Surface\n */\nclass Surface {\n  name: string\n  path: string\n  position: Float32Array\n  index: Uint32Array|Uint16Array|undefined\n  normal: Float32Array|undefined\n  color: Float32Array|undefined\n  atomindex: Int32Array|undefined\n  contour: boolean\n  center: Vector3\n  boundingBox: Box3\n  size: number\n  info: {\n    type?: string\n    probeRadius?: number\n    scaleFactor?: number\n    smooth?: number\n    cutoff?: number\n    isolevel?: number\n    volume?: Volume\n  }\n\n  /**\n   * @param {String} name - surface name\n   * @param {String} path - source path\n   * @param {Object} data - surface data\n   * @param {Float32Array} data.position - surface positions\n   * @param {Int32Array} data.index - surface indices\n   * @param {Float32Array} data.normal - surface normals\n   * @param {Float32Array} data.color - surface colors\n   * @param {Int32Array} data.atomindex - atom indices\n   * @param {boolean} data.contour - contour mode flag\n   */\n  constructor (name: string, path: string, data?: SurfaceData) {\n    this.name = name || ''\n    this.path = path || ''\n    this.info = {}\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    if (data instanceof BufferGeometry ||\n      data instanceof Group\n    ) {\n      // to be removed\n      this.fromGeometry(data)\n    } else if (data) {\n      this.set(\n        data.position,\n        data.index,\n        data.normal,\n        data.color,\n        data.atomindex,\n        data.contour\n      )\n\n      this.boundingBox.setFromArray(data.position)\n      this.boundingBox.getCenter(this.center)\n    }\n  }\n\n  get type () { return 'Surface' }\n\n  /**\n   * set surface data\n   * @param {Float32Array} position - surface positions\n   * @param {Int32Array} index - surface indices\n   * @param {Float32Array} normal - surface normals\n   * @param {Float32Array} color - surface colors\n   * @param {Int32Array} atomindex - atom indices\n   * @param {boolean} contour - contour mode flag\n   * @return {undefined}\n   */\n  set (position: Float32Array,\n      index: Uint32Array|Uint16Array|undefined,\n      normal: Float32Array|undefined,\n      color: Float32Array|undefined,\n      atomindex: Int32Array|undefined,\n      contour: boolean = false) {\n    /**\n     * @type {Float32Array}\n     */\n    this.position = position\n    /**\n     * @type {Uint32Array|Uint16Array|undefined}\n     */\n    this.index = index\n    /**\n     * @type {Float32Array|undefined}\n     */\n    this.normal = normal\n    /**\n     * @type {Float32Array|undefined}\n     */\n    this.color = color\n    /**\n     * @type {Int32Array|undefined}\n     */\n    this.atomindex = atomindex\n\n    this.size = position.length / 3\n    this.contour = contour\n  }\n\n  fromGeometry (geometry: BufferGeometry|Group) {\n    if (Debug) Log.time('GeometrySurface.fromGeometry')\n\n    let geo\n\n    if (geometry instanceof BufferGeometry) {\n      geo = geometry\n    } else {\n      geo = (geometry as any)[ 0 ]\n    }\n\n    if (!geo.boundingBox) geo.computeBoundingBox()\n\n    this.boundingBox.copy(geo.boundingBox)\n    this.boundingBox.getCenter(this.center)\n\n    let position, color, index, normal\n\n    if (geo instanceof BufferGeometry) {\n      const attr = geo.attributes\n      const an = (attr as any).normal ? (attr as any).normal.array : false\n\n      // assume there are no normals if the first is zero\n      if (!an || (an[ 0 ] === 0 && an[ 1 ] === 0 && an[ 2 ] === 0)) {\n        geo.computeVertexNormals()\n      }\n\n      position = (<any>attr).position.array\n      index = (<any>attr).index ? (<any>attr).index.array : null\n      normal = (<any>attr).normal.array\n    }\n\n    this.set(position, index, normal, color, undefined)\n\n    if (Debug) Log.timeEnd('GeometrySurface.setGeometry')\n  }\n\n  getPosition () {\n    return this.position\n  }\n\n  getColor (params: ColormakerParameters&{ scheme: string}) {\n    const p = params || {}\n    p.surface = this\n\n    const n = this.size\n    const array = new Float32Array(n * 3)\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    if (colormaker.volumeColor || p.scheme === 'random') {\n      for (let i = 0; i < n; ++i) {\n        colormaker.volumeColorToArray(i, array, i * 3)\n      }\n    } else if (colormaker.positionColor) {\n      const v = new Vector3()\n      const pos = this.position\n\n      for (let i = 0; i < n; ++i) {\n        var i3 = i * 3\n        v.set(pos[ i3 ], pos[ i3 + 1 ], pos[ i3 + 2 ])\n        colormaker.positionColorToArray(v, array, i3)\n      }\n    } else if (colormaker.atomColor && this.atomindex) {\n      const atomProxy = p.structure!.getAtomProxy()\n      const atomindex = this.atomindex\n\n      for (let i = 0; i < n; ++i) {\n        atomProxy.index = atomindex[ i ]\n        colormaker.atomColorToArray(atomProxy, array, i * 3)\n      }\n    } else {\n      const tc = new Color(p.value)\n      uniformArray3(n, tc.r, tc.g, tc.b, array)\n    }\n\n    return array\n  }\n\n  getPicking (structure?: Structure) {\n    if (this.atomindex && structure) {\n      return new AtomPicker(this.atomindex as any, structure)\n    } else {\n      return new SurfacePicker(serialArray(this.size), this)\n    }\n  }\n\n  getNormal () {\n    return this.normal\n  }\n\n  getSize (size: number, scale: number) {\n    return uniformArray(this.size, size * scale)\n  }\n\n  getIndex () {\n    return this.index\n  }\n\n  getFilteredIndex (sele: string, structure: Structure) {\n    if (sele && this.atomindex) {\n      const selection = new Selection(sele)\n      const atomSet = structure.getAtomSet(selection)\n      const filteredIndex = []\n\n      const atomindex = this.atomindex\n      const index = this.index\n      const n = index!.length\n      const elementSize = this.contour ? 2 : 3\n\n      let j = 0\n\n      for (let i = 0; i < n; i += elementSize) {\n        let include = true\n\n        for (let a = 0; a < elementSize; a++) {\n          const idx = index![ i + a ]\n          const ai = atomindex[ idx ]\n          if (!atomSet.get(ai)) {\n            include = false\n            break\n          }\n        }\n\n        if (!include) { continue }\n\n        for (let a = 0; a < elementSize; a++, j++) {\n          filteredIndex[ j ] = index![ i + a ]\n        }\n      }\n\n      return getUintArray(filteredIndex, this.position.length / 3)\n    } else {\n      return this.index\n    }\n  }\n\n  getAtomindex () {\n    return this.atomindex\n  }\n\n  dispose () {\n\n    //\n\n  }\n}\n\nexport default Surface\n","/**\n * @file Volume\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3, Matrix3, Matrix4 } from 'three'\n\nimport { WorkerRegistry, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport WorkerPool from '../worker/worker-pool'\nimport { VolumePicker } from '../utils/picker'\nimport {\n  uniformArray, serialArray,\n  arrayMin, arrayMax, arraySum, arrayMean, arrayRms\n} from '../math/array-utils'\nimport MarchingCubes from './marching-cubes'\nimport { laplacianSmooth, computeVertexNormals } from './surface-utils'\nimport {\n  applyMatrix4toVector3array, applyMatrix3toVector3array\n} from '../math/vector-utils'\nimport { m3new, m3makeNormal } from '../math/matrix-utils'\nimport Surface from './surface'\nimport { NumberArray } from '../types';\nimport { ColormakerParameters } from '../color/colormaker';\n\nexport interface VolumeSurface {\n  new (data: NumberArray, nx: number, ny: number, nz: number, atomindex: NumberArray): void\n  getSurface: (isolevel: number, smooth: boolean|number, box: number[][]|undefined, matrix: Float32Array, contour: boolean, wrap?: boolean) => {\n    position: Float32Array\n    normal: undefined|Float32Array\n    index: Uint32Array|Uint16Array\n    atomindex: Int32Array|undefined\n    contour: boolean\n  }\n}\nexport function VolumeSurface (this: VolumeSurface,data: NumberArray, nx: number, ny: number, nz: number, atomindex: NumberArray) {\n  var mc = new (MarchingCubes as any)(data, nx, ny, nz, atomindex) as MarchingCubes\n\n  function getSurface (isolevel: number, smooth: boolean|number, box: number[][]|undefined, matrix: Float32Array, contour: boolean, wrap: boolean = false) {\n    const sd = mc.triangulate(isolevel, smooth as boolean, box, contour, wrap)\n    if (smooth && !contour) {\n      laplacianSmooth(sd.position, sd.index as any, smooth as number, true)\n      sd.normal = computeVertexNormals(sd.position, sd.index as any)\n    }\n    if (matrix) {\n      applyMatrix4toVector3array(matrix, sd.position)\n      if (sd.normal) {\n        const normalMatrix = m3new()\n        m3makeNormal(normalMatrix, matrix)\n        applyMatrix3toVector3array(normalMatrix, sd.normal)\n      }\n    }\n    return sd\n  }\n\n  this.getSurface = getSurface\n}\nObject.assign(VolumeSurface, {__deps: [\n  laplacianSmooth, computeVertexNormals, MarchingCubes,\n  applyMatrix4toVector3array, applyMatrix3toVector3array,\n  m3new, m3makeNormal\n]})\n\nWorkerRegistry.add('surf', function func (e: any, callback: (data: any, transferList: any) => void) {\n  const a = e.data.args\n  const p = e.data.params\n  if (a) {\n    /* global self */\n    (self as any).volsurf = new (VolumeSurface as any)(a[0], a[1], a[2], a[3], a[4]) as VolumeSurface\n  }\n  if (p) {\n    const sd = ((self as any).volsurf as VolumeSurface).getSurface(\n      p.isolevel, p.smooth, p.box, p.matrix, p.contour, p.wrap\n    )\n    const transferList = [ sd.position.buffer, sd.index.buffer ]\n    if (sd.normal) transferList.push(sd.normal.buffer)\n    if (sd.atomindex) transferList.push(sd.atomindex.buffer)\n    const data = {\n      sd: sd,\n      p: p\n    }\n    callback(data, transferList)\n  }\n}, [ VolumeSurface ])\n\nexport type VolumeSize = 'value'|'abs-value'|'value-min'|'deviation'\n/**\n * Volume\n */\nclass Volume {\n  name: string\n  path: string\n\n  matrix: Matrix4\n  normalMatrix: Matrix3\n  inverseMatrix: Matrix4\n  center: Vector3\n  boundingBox: Box3\n\n  nx: number\n  ny: number\n  nz: number\n  data: Float32Array\n\n  worker: Worker\n  workerPool: WorkerPool\n  _position: Float32Array|undefined\n  _min: number|undefined\n  _max: number|undefined\n  _mean: number|undefined\n  _rms: number|undefined\n  _sum: number|undefined\n  __box: Box3|undefined\n\n  atomindex: Int32Array|undefined\n  volsurf: VolumeSurface|undefined\n  header: any\n  /**\n   * Make Volume instance\n   * @param {String} name - volume name\n   * @param {String} path - source path\n   * @param {Float32array} data - volume 3d grid\n   * @param {Integer} nx - x dimension of the 3d volume\n   * @param {Integer} ny - y dimension of the 3d volume\n   * @param {Integer} nz - z dimension of the 3d volume\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   */\n  constructor (name: string, path: string, data?: Float32Array, nx?: number, ny?: number, nz?: number, atomindex?: Int32Array) {\n    this.name = name\n    this.path = path\n\n    this.matrix = new Matrix4()\n    this.normalMatrix = new Matrix3()\n    this.inverseMatrix = new Matrix4()\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this.setData(data, nx, ny, nz, atomindex)\n  }\n\n  get type () { return 'Volume' }\n\n  /**\n   * set volume data\n   * @param {Float32array} data - volume 3d grid\n   * @param {Integer} nx - x dimension of the 3d volume\n   * @param {Integer} ny - y dimension of the 3d volume\n   * @param {Integer} nz - z dimension of the 3d volume\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   * @return {undefined}\n   */\n  setData (data?: Float32Array, nx?: number, ny?: number, nz?: number, atomindex?: Int32Array) {\n    this.nx = nx || 1\n    this.ny = ny || 1\n    this.nz = nz || 1\n\n    this.data = data || new Float32Array(1)\n    this.setAtomindex(atomindex)\n\n    delete this._position\n\n    delete this._min\n    delete this._max\n    delete this._mean\n    delete this._rms\n\n    if (this.worker) this.worker.terminate()\n  }\n\n  /**\n   * Set statistics, which can be different from the data in this volume,\n   * if this volume is a slice of a bigger volume\n   * @param {Number|undefined} min - minimum value of the whole data set\n   * @param {Number|undefined} max - maximum value of the whole data set\n   * @param {Number|undefined} mean - average value of the whole data set\n   * @param {Number|undefined} rms - sigma value of the whole data set\n   */\n  setStats (min: number|undefined, max: number|undefined, mean: number|undefined, rms: number|undefined) {\n    this._min = min\n    this._max = max\n    this._mean = mean\n    this._rms = rms\n  }\n\n  /**\n   * set transformation matrix\n   * @param {Matrix4} matrix - 4x4 transformation matrix\n   * @return {undefined}\n   */\n  setMatrix (matrix: Matrix4) {\n    this.matrix.copy(matrix)\n\n    const bb = this.boundingBox\n    const v = this.center // temporary re-purposing\n\n    const x = this.nx - 1\n    const y = this.ny - 1\n    const z = this.nz - 1\n\n    bb.makeEmpty()\n\n    bb.expandByPoint(v.set(x, y, z))\n    bb.expandByPoint(v.set(x, y, 0))\n    bb.expandByPoint(v.set(x, 0, z))\n    bb.expandByPoint(v.set(x, 0, 0))\n    bb.expandByPoint(v.set(0, y, z))\n    bb.expandByPoint(v.set(0, 0, z))\n    bb.expandByPoint(v.set(0, y, 0))\n    bb.expandByPoint(v.set(0, 0, 0))\n\n    bb.applyMatrix4(this.matrix)\n    bb.getCenter(this.center)\n\n    // make normal matrix\n\n    const me = this.matrix.elements\n    const r0 = new Vector3(me[0], me[1], me[2])\n    const r1 = new Vector3(me[4], me[5], me[6])\n    const r2 = new Vector3(me[8], me[9], me[10])\n    const cp = new Vector3()\n    //        [ r0 ]       [ r1 x r2 ]\n    // M3x3 = [ r1 ]   N = [ r2 x r0 ]\n    //        [ r2 ]       [ r0 x r1 ]\n    const ne = this.normalMatrix.elements\n    cp.crossVectors(r1, r2)\n    ne[ 0 ] = cp.x\n    ne[ 1 ] = cp.y\n    ne[ 2 ] = cp.z\n    cp.crossVectors(r2, r0)\n    ne[ 3 ] = cp.x\n    ne[ 4 ] = cp.y\n    ne[ 5 ] = cp.z\n    cp.crossVectors(r0, r1)\n    ne[ 6 ] = cp.x\n    ne[ 7 ] = cp.y\n    ne[ 8 ] = cp.z\n\n    this.inverseMatrix.copy(this.matrix).invert()\n  }\n\n  /**\n   * set atom indices\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   * @return {undefined}\n     */\n  setAtomindex (atomindex?: Int32Array) {\n    this.atomindex = atomindex\n  }\n\n  getBox (center: Vector3, size: number, target: Box3) {\n    if (!target) target = new Box3()\n\n    target.set(center, center)\n    target.expandByScalar(size)\n    target.applyMatrix4(this.inverseMatrix)\n\n    target.min.round()\n    target.max.round()\n\n    return target\n  }\n\n  _getBox (center: Vector3|undefined, size: number) {\n    if (!center || !size) return\n\n    if (!this.__box) this.__box = new Box3()\n    const box = this.getBox(center, size, this.__box)\n    return [ box.min.toArray(), box.max.toArray() ]\n  }\n\n  _makeSurface (sd: any, isolevel: number, smooth: number) {\n    const name = this.name + '@' + isolevel.toPrecision(2)\n    const surface = new Surface(name, '', sd)\n    surface.info.isolevel = isolevel\n    surface.info.smooth = smooth\n    surface.info.volume = this\n\n    return surface\n  }\n\n  getSurface (isolevel: number, smooth: number, center: Vector3, size: number, contour: boolean, wrap: boolean = false) {\n    isolevel = isNaN(isolevel) ? this.getValueForSigma(2) : isolevel\n    smooth = defaults(smooth, 0)\n\n    //\n\n    if (this.volsurf === undefined) {\n      this.volsurf = new (VolumeSurface as any)(\n        this.data, this.nx, this.ny, this.nz, this.atomindex\n      ) as VolumeSurface\n    }\n\n    const box = this._getBox(center, size)\n    const sd = this.volsurf.getSurface(\n      isolevel, smooth, box!, this.matrix.elements as unknown as Float32Array, contour, wrap\n    )\n\n    return this._makeSurface(sd, isolevel, smooth)\n  }\n\n  getSurfaceWorker (isolevel: number, smooth: number, center: Vector3, size: number, contour: boolean, wrap: boolean, callback: (s: Surface) => void) {\n    isolevel = isNaN(isolevel) ? this.getValueForSigma(2) : isolevel\n    smooth = smooth || 0\n\n    //\n\n    if (window.hasOwnProperty('Worker')) {\n      if (this.workerPool === undefined) {\n        this.workerPool = new WorkerPool('surf', 2)\n      }\n\n      const msg = {}\n      const worker = this.workerPool.getNextWorker()\n\n      if (worker!.postCount === 0) {\n        Object.assign(msg, {\n          args: [\n            this.data, this.nx, this.ny, this.nz, this.atomindex\n          ]\n        })\n      }\n\n      Object.assign(msg, {\n        params: {\n          isolevel: isolevel,\n          smooth: smooth,\n          box: this._getBox(center, size),\n          matrix: this.matrix.elements,\n          contour: contour,\n          wrap: wrap\n        }\n      })\n\n      worker!.post(msg, undefined,\n        (e: any) => {\n          const sd = e.data.sd\n          const p = e.data.p\n          callback(this._makeSurface(sd, p.isolevel, p.smooth))\n        },\n        (e : string) => {\n          console.warn(\n            'Volume.getSurfaceWorker error - trying without worker', e\n          )\n          const surface = this.getSurface(isolevel, smooth, center, size, contour, wrap)\n          callback(surface)\n        }\n      )\n    } else {\n      const surface = this.getSurface(isolevel, smooth, center, size, contour, wrap)\n      callback(surface)\n    }\n  }\n\n  getValueForSigma (sigma: number) {\n    return this.mean + defaults(sigma, 2) * this.rms\n  }\n\n  getSigmaForValue (value: number) {\n    return (defaults(value, 0) - this.mean) / this.rms\n  }\n\n  get position () {\n    if (!this._position) {\n      const nz = this.nz\n      const ny = this.ny\n      const nx = this.nx\n      const position = new Float32Array(nx * ny * nz * 3)\n\n      let p = 0\n      for (let z = 0; z < nz; ++z) {\n        for (let y = 0; y < ny; ++y) {\n          for (let x = 0; x < nx; ++x) {\n            position[ p + 0 ] = x\n            position[ p + 1 ] = y\n            position[ p + 2 ] = z\n            p += 3\n          }\n        }\n      }\n\n      applyMatrix4toVector3array(this.matrix.elements as unknown as Float32Array, position)\n      this._position = position\n    }\n\n    return this._position\n  }\n\n  getDataAtomindex () {\n    return this.atomindex\n  }\n\n  getDataPosition () {\n    return this.position\n  }\n\n  getDataColor (params: ColormakerParameters & {scheme: string}) {\n    const p = params || {}\n    p.volume = this\n    p.scale = p.scale || 'Spectral'\n    p.domain = p.domain || [ this.min, this.max ]\n\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    const n = this.position.length / 3\n    const array = new Float32Array(n * 3)\n\n    // var atoms = p.structure.atoms;\n    // var atomindex = this.atomindex;\n\n    for (let i = 0; i < n; ++i) {\n      colormaker.volumeColorToArray(i, array, i * 3)\n      // a = atoms[ atomindex[ i ] ];\n      // if( a ) colormaker.atomColorToArray( a, array, i * 3 );\n    }\n\n    return array\n  }\n\n  getDataPicking () {\n    const picking = serialArray(this.position.length / 3)\n    return new VolumePicker(picking, this)\n  }\n\n  getDataSize (size: VolumeSize|number, scale: number) {\n    const data = this.data\n    const n = this.position.length / 3\n    let array\n\n    switch (size) {\n      case 'value':\n        array = new Float32Array(data)\n        break\n\n      case 'abs-value':\n        array = new Float32Array(data)\n        for (let i = 0; i < n; ++i) {\n          array[ i ] = Math.abs(array[ i ])\n        }\n        break\n\n      case 'value-min': {\n        array = new Float32Array(data)\n        const min = this.min\n        for (let i = 0; i < n; ++i) {\n          array[ i ] -= min\n        }\n        break\n      }\n\n      case 'deviation':\n        array = new Float32Array(data)\n        break\n\n      default:\n        array = uniformArray(n, size)\n        break\n    }\n\n    if (scale !== 1.0) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ] *= scale\n      }\n    }\n\n    return array\n  }\n\n  get min () {\n    if (this._min === undefined) {\n      this._min = arrayMin(this.data)\n    }\n    return this._min\n  }\n\n  get max () {\n    if (this._max === undefined) {\n      this._max = arrayMax(this.data)\n    }\n    return this._max\n  }\n\n  get sum () {\n    if (this._sum === undefined) {\n      this._sum = arraySum(this.data)\n    }\n    return this._sum\n  }\n\n  get mean () {\n    if (this._mean === undefined) {\n      this._mean = arrayMean(this.data)\n    }\n    return this._mean\n  }\n\n  get rms () {\n    if (this._rms === undefined) {\n      this._rms = arrayRms(this.data)\n    }\n    return this._rms\n  }\n\n  clone () {\n    const vol = new Volume(\n      this.name,\n      this.path,\n\n      this.data,\n\n      this.nx,\n      this.ny,\n      this.nz,\n\n      this.atomindex\n    )\n\n    vol.matrix.copy(this.matrix)\n    vol.header = Object.assign({}, this.header)\n\n    return vol\n  }\n\n  dispose () {\n    if (this.workerPool) this.workerPool.terminate()\n  }\n}\n\nexport default Volume\n","/**\n * @file Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  Color, Vector3, Matrix4,\n  FrontSide, BackSide, DoubleSide,\n  // VertexColors,\n  NoBlending,\n  BufferGeometry, BufferAttribute,\n  UniformsUtils, UniformsLib, Uniform,\n  Group, LineSegments, Points, Mesh, Object3D,\n  ShaderMaterial,\n  DynamicDrawUsage,\n  StaticDrawUsage\n} from 'three'\n\nimport { Log } from '../globals'\nimport { createParams, getTypedArray, getUintArray } from '../utils'\nimport { GenericColor, TypedArray } from '../types'\nimport { getShader, ShaderDefines } from '../shader/shader-utils'\nimport { serialArray } from '../math/array-utils'\nimport { Picker } from '../utils/picker'\n\nexport type BufferSide = 'front'|'back'|'double'\n\nfunction getThreeSide (side: BufferSide) {\n  if (side === 'front') {\n    return FrontSide\n  } else if (side === 'back') {\n    return BackSide\n  } else if (side === 'double') {\n    return DoubleSide\n  } else {\n    return DoubleSide\n  }\n}\n\nconst itemSize = {\n  'f': 1, 'v2': 2, 'v3': 3, 'c': 3\n}\n\nfunction setObjectMatrix (object: Object3D, matrix: Matrix4) {\n  object.matrix.copy(matrix)\n  object.matrix.decompose(object.position, object.quaternion, object.scale)\n  object.matrixWorldNeedsUpdate = true\n}\n\nexport type BufferTypes = 'picking'|'background'\nexport type BufferMaterials = 'material'|'wireframeMaterial'|'pickingMaterial'\n\nexport interface _BufferAttribute {\n  type: 'f'|'v2'|'v3'|'c'\n  value?: TypedArray\n}\n\nexport type Uniforms = { [k: string]: Uniform|{ value: any } }\n\nexport const BufferDefaultParameters = {\n  opaqueBack: false,\n  side: 'double' as BufferSide,  // which triangle sides to render\n  opacity: 1.0,  // translucency: 1 is fully opaque, 0 is fully transparent\n  depthWrite: true,\n  clipNear: 0, // position of camera near/front clipping plane in percent of scene bounding box\n  clipRadius: 0,\n  clipCenter: new Vector3(),\n  flatShaded: false,  // render flat shaded\n  wireframe: false,  // render as wireframe\n  roughness: 0.4,  // how rough the material is, between 0 and 1\n  metalness: 0.0,  // how metallic the material is, between 0 and 1\n  diffuse: 0xffffff,  // diffuse color for lighting\n  diffuseInterior: false,\n  useInteriorColor: false,  // render back-side with interior color\n  interiorColor: 0xdddddd,  // interior color\n  interiorDarkening: 0,  // interior darkening factor\n  forceTransparent: false,  // force the material to allow transparency\n  matrix: new Matrix4(),  // additional transformation matrix\n  disablePicking: false,  // disable picking\n  sortParticles: false,\n  background: false\n}\nexport type BufferParameters = Omit<typeof BufferDefaultParameters, 'diffuse'|'interiorColor'> & { diffuse: GenericColor; interiorColor: GenericColor }\n\nexport const BufferParameterTypes = {\n  opaqueBack: { updateShader: true },\n  side: { updateShader: true, property: true },\n  opacity: { uniform: true },\n  depthWrite: { property: true },\n  clipNear: { updateShader: true, property: true },\n  clipRadius: { updateShader: true, uniform: true },\n  clipCenter: { uniform: true },\n  flatShaded: { updateShader: true },\n  background: { updateShader: true },\n  wireframe: { updateVisibility: true },\n  roughness: { uniform: true },\n  metalness: { uniform: true },\n  diffuse: { uniform: true },\n  diffuseInterior: { updateShader: true },\n  useInteriorColor: { updateShader: true },\n  interiorColor: { uniform: true },\n  interiorDarkening: { uniform: true },\n  matrix: {}\n}\n\nexport interface BufferData {\n  position?: Float32Array\n  position1?: Float32Array  // TODO\n  color?: Float32Array\n  index?: Uint32Array|Uint16Array\n  normal?: Float32Array\n\n  picking?: Picker\n  primitiveId?: Float32Array\n}\n\n/**\n * Buffer class. Base class for buffers.\n * @interface\n */\nclass Buffer {\n  parameterTypes = BufferParameterTypes\n  get defaultParameters() { return BufferDefaultParameters }\n  parameters: BufferParameters\n  uniforms: Uniforms\n  pickingUniforms: Uniforms\n\n  private _positionDataSize: number\n\n  geometry = new BufferGeometry()\n  indexVersion = 0\n  wireframeIndexVersion = -1\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  vertexShader = ''\n  fragmentShader = ''\n  isImpostor = false\n  isText = false\n  isSurface = false\n  isPoint = false\n  isLine = false\n  dynamic = true\n  visible = true\n\n  picking?: Picker\n\n  material: ShaderMaterial\n  wireframeMaterial: ShaderMaterial\n  pickingMaterial: ShaderMaterial\n\n  wireframeIndex?: Uint32Array|Uint16Array\n  wireframeIndexCount = 0\n  wireframeGeometry?: BufferGeometry\n\n  /**\n   * @param {Object} data - attribute object\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Uint32Array|Uint16Array} data.index - triangle indices\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} params - parameters object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n\n    this.uniforms = UniformsUtils.merge([\n      UniformsLib.common,\n      {\n        fogColor: { value: new Color(0x000000) },\n        fogNear: { value: 0.0 },\n        fogFar: { value: 0.0 },\n        opacity: { value: this.parameters.opacity },\n        clipNear: { value: 0.0 },\n        clipRadius: { value: this.parameters.clipRadius },\n        clipCenter: { value: this.parameters.clipCenter }\n      },\n      {\n        emissive: { value: new Color(0x000000) },\n        roughness: { value: this.parameters.roughness },\n        metalness: { value: this.parameters.metalness },\n        interiorColor: { value: new Color(this.parameters.interiorColor) },\n        interiorDarkening: { value: this.parameters.interiorDarkening },\n      },\n      UniformsLib.lights\n    ])\n\n    this.uniforms.diffuse.value.set(this.parameters.diffuse)\n\n    this.pickingUniforms = {\n      clipNear: { value: 0.0 },\n      objectId: { value: 0 },\n      opacity: { value: this.parameters.opacity }\n    }\n\n    //\n\n    const position = data.position || data.position1\n    this._positionDataSize = position ? position.length / 3 : 0\n\n    if (!data.primitiveId) {\n      data.primitiveId = serialArray(this._positionDataSize)\n    }\n\n    this.addAttributes({\n      position: { type: 'v3', value: data.position },\n      color: { type: 'c', value: data.color },\n      primitiveId: { type: 'f', value: data.primitiveId }\n    })\n\n    if (params.matrix) {\n      this.matrix = params.matrix\n    }\n\n    if (data.index) {\n      this.initIndex(data.index)\n    }\n    this.picking = data.picking\n\n    this.makeWireframeGeometry()\n  }\n\n  set matrix (m) {\n    this.setMatrix(m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get transparent () {\n    return this.parameters.opacity < 1 || this.parameters.forceTransparent\n  }\n\n  get size () {\n    return this._positionDataSize\n  }\n\n  get attributeSize () {\n    return this.size\n  }\n\n  get pickable () {\n    return !!this.picking && !this.parameters.disablePicking\n  }\n\n  setMatrix (m: Matrix4) {\n    setObjectMatrix(this.group, m)\n    setObjectMatrix(this.wireframeGroup, m)\n    setObjectMatrix(this.pickingGroup, m)\n  }\n\n  initIndex (index: Uint32Array|Uint16Array) {\n    this.geometry.setIndex(\n      new BufferAttribute(index, 1)\n    )\n    const nindex = this.geometry.getIndex();\n    if (!nindex) { Log.error('Index is null'); return; }\n    nindex.setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n  }\n\n  makeMaterial () {\n    const side = getThreeSide(this.parameters.side)\n\n    const m = new ShaderMaterial({\n      uniforms: this.uniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: this.transparent,\n      depthWrite: this.parameters.depthWrite,\n      lights: true,\n      fog: true,\n      side: side\n    })\n    m.vertexColors = true\n    m.extensions.derivatives = true\n    m.extensions.fragDepth = this.isImpostor\n\n    const wm = new ShaderMaterial({\n      uniforms: this.uniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: this.transparent,\n      depthWrite: this.parameters.depthWrite,\n      lights: false,\n      fog: true,\n      side: side\n    })\n    wm.vertexColors = true\n\n    const pm = new ShaderMaterial({\n      uniforms: this.pickingUniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: false,\n      depthWrite: this.parameters.depthWrite,\n      lights: false,\n      fog: false,\n      side: side,\n      blending: NoBlending\n    })\n    pm.vertexColors = true\n    pm.extensions.fragDepth = this.isImpostor\n\n    ;(m as any).clipNear = this.parameters.clipNear\n    ;(wm as any).clipNear = this.parameters.clipNear\n    ;(pm as any).clipNear = this.parameters.clipNear\n\n    this.material = m\n    this.wireframeMaterial = wm\n    this.pickingMaterial = pm\n\n    // also sets vertexShader/fragmentShader\n    this.updateShader()\n  }\n\n  makeWireframeGeometry () {\n    this.makeWireframeIndex()\n\n    const geometry = this.geometry\n    const wireframeIndex = this.wireframeIndex\n    const wireframeGeometry = new BufferGeometry()\n\n    wireframeGeometry.attributes = geometry.attributes\n    if (wireframeIndex) {\n      wireframeGeometry.setIndex(\n        new BufferAttribute(wireframeIndex, 1).setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n      )\n      wireframeGeometry.setDrawRange(0, this.wireframeIndexCount)\n    }\n\n    this.wireframeGeometry = wireframeGeometry\n  }\n\n  makeWireframeIndex () {\n    const edges: number[][] = []\n\n    function checkEdge (a: number, b: number) {\n      if (a > b) {\n        const tmp = a\n        a = b\n        b = tmp\n      }\n\n      const list = edges[ a ]\n\n      if (list === undefined) {\n        edges[ a ] = [ b ]\n        return true\n      } else if (!list.includes(b)) {\n        list.push(b)\n        return true\n      }\n\n      return false\n    }\n\n    const geometry = this.geometry\n    const index = geometry.index\n\n    if (!this.parameters.wireframe) {\n      this.wireframeIndex = new Uint16Array(0)\n      this.wireframeIndexCount = 0\n    } else if (index) {\n      const array = index.array\n      let n = array.length\n      if (geometry.drawRange.count !== Infinity) {\n        n = geometry.drawRange.count\n      }\n      let wireframeIndex\n      if (this.wireframeIndex && this.wireframeIndex.length > n * 2) {\n        wireframeIndex = this.wireframeIndex\n      } else {\n        const count = (geometry.attributes as any).position.count  // TODO\n        wireframeIndex = getUintArray(n * 2, count)\n      }\n\n      let j = 0\n      edges.length = 0\n\n      for (let i = 0; i < n; i += 3) {\n        const a = array[ i + 0 ]\n        const b = array[ i + 1 ]\n        const c = array[ i + 2 ]\n\n        if (checkEdge(a, b)) {\n          wireframeIndex[ j + 0 ] = a\n          wireframeIndex[ j + 1 ] = b\n          j += 2\n        }\n        if (checkEdge(b, c)) {\n          wireframeIndex[ j + 0 ] = b\n          wireframeIndex[ j + 1 ] = c\n          j += 2\n        }\n        if (checkEdge(c, a)) {\n          wireframeIndex[ j + 0 ] = c\n          wireframeIndex[ j + 1 ] = a\n          j += 2\n        }\n      }\n\n      this.wireframeIndex = wireframeIndex\n      this.wireframeIndexCount = j\n      this.wireframeIndexVersion = this.indexVersion\n    } else {\n      const n = (geometry.attributes as any).position.count  // TODO\n\n      let wireframeIndex\n      if (this.wireframeIndex && this.wireframeIndex.length > n * 2) {\n        wireframeIndex = this.wireframeIndex\n      } else {\n        wireframeIndex = getUintArray(n * 2, n)\n      }\n\n      for (let i = 0, j = 0; i < n; i += 3) {\n        wireframeIndex[ j + 0 ] = i\n        wireframeIndex[ j + 1 ] = i + 1\n        wireframeIndex[ j + 2 ] = i + 1\n        wireframeIndex[ j + 3 ] = i + 2\n        wireframeIndex[ j + 4 ] = i + 2\n        wireframeIndex[ j + 5 ] = i\n\n        j += 6\n      }\n\n      this.wireframeIndex = wireframeIndex\n      this.wireframeIndexCount = n * 2\n      this.wireframeIndexVersion = this.indexVersion\n    }\n  }\n\n  updateWireframeIndex () {\n    if (!this.wireframeGeometry || !this.wireframeIndex) return\n\n    this.wireframeGeometry.setDrawRange(0, Infinity)\n    if (this.wireframeIndexVersion < this.indexVersion) this.makeWireframeIndex()\n\n    if (this.wireframeGeometry.index &&\n        this.wireframeIndex.length > this.wireframeGeometry.index.array.length) {\n      this.wireframeGeometry.setIndex(\n        new BufferAttribute(this.wireframeIndex, 1).setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n      )\n    } else {\n      const index = this.wireframeGeometry.getIndex()\n      if (!index) { Log.error('Index is null'); return; }\n      index.set(this.wireframeIndex)\n      index.needsUpdate = this.wireframeIndexCount > 0\n      index.updateRange.count = this.wireframeIndexCount\n    }\n\n    this.wireframeGeometry.setDrawRange(0, this.wireframeIndexCount)\n  }\n\n  getRenderOrder () {\n    let renderOrder = 0\n\n    if (this.isText) {\n      renderOrder = 1\n    } else if (this.transparent) {\n      if (this.isSurface) {\n        renderOrder = 3\n      } else {\n        renderOrder = 2\n      }\n    }\n\n    return renderOrder\n  }\n\n  _getMesh (materialName: BufferMaterials) {\n    if (!this.material) this.makeMaterial()\n\n    const g = this.geometry\n    const m = this[ materialName ]\n\n    let mesh\n\n    if (this.isLine) {\n      mesh = new LineSegments(g, m)\n    } else if (this.isPoint) {\n      mesh = new Points(g, m)\n    } else {\n      mesh = new Mesh(g, m)\n    }\n\n    mesh.frustumCulled = false\n    mesh.renderOrder = this.getRenderOrder()\n\n    return mesh\n  }\n\n  getMesh () {\n    return this._getMesh('material')\n  }\n\n  getWireframeMesh () {\n    let mesh\n\n    if (!this.material) this.makeMaterial()\n    if (!this.wireframeGeometry) this.makeWireframeGeometry()\n\n    mesh = new LineSegments(\n      this.wireframeGeometry, this.wireframeMaterial\n    )\n\n    mesh.frustumCulled = false\n    mesh.renderOrder = this.getRenderOrder()\n\n    return mesh\n  }\n\n  getPickingMesh () {\n    return this._getMesh('pickingMaterial')\n  }\n\n  getShader (name: string, type?: BufferTypes) {\n    return getShader(name, this.getDefines(type))\n  }\n\n  getVertexShader (type?: BufferTypes) {\n    return this.getShader(this.vertexShader, type)\n  }\n\n  getFragmentShader (type?: BufferTypes) {\n    return this.getShader(this.fragmentShader, type)\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines: ShaderDefines = {}\n\n    if (this.parameters.clipNear) {\n      defines.NEAR_CLIP = 1\n    }\n\n    if (this.parameters.clipRadius) {\n      defines.RADIUS_CLIP = 1\n    }\n\n    if (type === 'picking') {\n      defines.PICKING = 1\n    } else {\n      if (type === 'background' || this.parameters.background) {\n        defines.NOLIGHT = 1\n      }\n      if (this.parameters.flatShaded) {\n        defines.FLAT_SHADED = 1\n      }\n      if (this.parameters.opaqueBack) {\n        defines.OPAQUE_BACK = 1\n      }\n      if (this.parameters.diffuseInterior) {\n        defines.DIFFUSE_INTERIOR = 1\n      }\n      if (this.parameters.useInteriorColor) {\n        defines.USE_INTERIOR_COLOR = 1\n      }\n    }\n\n    return defines\n  }\n\n  getParameters () {\n    return this.parameters\n  }\n\n  addUniforms (uniforms: Uniforms) {\n    this.uniforms = UniformsUtils.merge(\n      [ this.uniforms, uniforms ]\n    )\n\n    this.pickingUniforms = UniformsUtils.merge(\n      [ this.pickingUniforms, uniforms ]\n    )\n  }\n\n  addAttributes (attributes: { [k: string]: _BufferAttribute }) {\n    for (let name in attributes) {\n      let buf\n      const a = attributes[ name ]\n      const arraySize = this.attributeSize * itemSize[ a.type ]\n\n      if (a.value) {\n        if (arraySize !== a.value.length) {\n          Log.error('attribute value has wrong length', name)\n        }\n        buf = a.value\n      } else {\n        buf = getTypedArray('float32', arraySize)\n      }\n\n      this.geometry.setAttribute(\n        name,\n        new BufferAttribute(buf, itemSize[ a.type ]).setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n      )\n    }\n  }\n\n  updateRenderOrder () {\n    const renderOrder = this.getRenderOrder()\n    function setRenderOrder (mesh: Object3D) {\n      mesh.renderOrder = renderOrder\n    }\n\n    this.group.children.forEach(setRenderOrder)\n    if (this.pickingGroup) {\n      this.pickingGroup.children.forEach(setRenderOrder)\n    }\n  }\n\n  updateShader () {\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    m.vertexShader = this.getVertexShader()\n    m.fragmentShader = this.getFragmentShader()\n    m.needsUpdate = true\n\n    wm.vertexShader = this.getShader('Line.vert')\n    wm.fragmentShader = this.getShader('Line.frag')\n    wm.needsUpdate = true\n\n    pm.vertexShader = this.getVertexShader('picking')\n    pm.fragmentShader = this.getFragmentShader('picking')\n    pm.needsUpdate = true\n  }\n\n  /**\n   * Set buffer parameters\n   * @param {BufferParameters} params - buffer parameters object\n   * @return {undefined}\n   */\n  setParameters (params: Partial<BufferParameters>) {\n    const p = params as any\n    const pt = this.parameterTypes as any\n    const pv = this.parameters as any\n\n    const propertyData: { [k: string]: any } = {}\n    const uniformData: { [k: string]: any } = {}\n    let doShaderUpdate = false\n    let doVisibilityUpdate = false\n\n    for (const name in p) {\n      const value = p[ name ]\n\n      if (value === undefined) continue\n      pv[ name ] = value\n\n      if (pt[ name ] === undefined) continue\n\n      if (pt[ name ].property) {\n        if (pt[ name ].property !== true) {\n          propertyData[ pt[ name ].property as any ] = value\n        } else {\n          propertyData[ name ] = value\n        }\n      }\n\n      if (pt[ name ].uniform) {\n        if (pt[ name ].uniform !== true) {\n          uniformData[ pt[ name ].uniform as any ] = value\n        } else {\n          uniformData[ name ] = value\n        }\n      }\n\n      if (pt[ name ].updateShader) {\n        doShaderUpdate = true\n      }\n\n      if (pt[ name ].updateVisibility) {\n        doVisibilityUpdate = true\n      }\n\n      if (this.dynamic && name === 'wireframe' && value === true) {\n        this.updateWireframeIndex()\n      }\n\n      if (name === 'forceTransparent') {\n        propertyData.transparent = this.transparent\n      }\n\n      if (name === 'matrix') {\n        this.matrix = value\n      }\n    }\n\n    this.setProperties(propertyData)\n    this.setUniforms(uniformData)\n    if (doShaderUpdate) this.updateShader()\n    if (doVisibilityUpdate) this.setVisibility(this.visible)\n  }\n\n  /**\n   * Sets buffer attributes\n   * @param {Object} data - An object where the keys are the attribute names\n   *      and the values are the attribute data.\n   * @example\n   * var buffer = new Buffer();\n   * buffer.setAttributes({ attrName: attrData });\n   */\n  setAttributes (data: any) {  // TODO\n    const geometry = this.geometry\n    const attributes = geometry.attributes as any  // TODO\n\n    for (const name in data) {\n      if (name === 'picking') continue\n\n      const array = data[ name ]\n      const length = array.length\n\n      if (name === 'index') {\n        const index = geometry.getIndex()\n        if (!index) { Log.error('Index is null'); continue; }\n        geometry.setDrawRange(0, Infinity)\n\n        if (length > index.array.length) {\n          geometry.setIndex(\n            new BufferAttribute(array, 1)\n              .setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n          )\n        } else {\n          index.set(array)\n          index.needsUpdate = length > 0\n          index.updateRange.count = length\n          geometry.setDrawRange(0, length)\n        }\n\n        this.indexVersion++\n        if (this.parameters.wireframe) this.updateWireframeIndex()\n      } else {\n        const attribute = attributes[ name ]\n\n        if (length > attribute.array.length) {\n          geometry.setAttribute(\n            name,\n            new BufferAttribute(array, attribute.itemSize)\n              .setUsage(this.dynamic ? DynamicDrawUsage : StaticDrawUsage)\n          )\n        } else {\n          attributes[ name ].set(array)\n          attributes[ name ].needsUpdate = length > 0\n          attributes[ name ].updateRange.count = length\n        }\n      }\n    }\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (!data) return\n\n    const u = this.material.uniforms\n    const wu = this.wireframeMaterial.uniforms\n    const pu = this.pickingMaterial.uniforms\n\n    for (let name in data) {\n      if (name === 'opacity') {\n        this.setProperties({ transparent: this.transparent })\n      }\n\n      if (u[ name ] !== undefined) {\n        if (u[ name ].value.isVector3) {\n          u[ name ].value.copy(data[ name ])\n        } else if (u[ name ].value.set) {\n          u[ name ].value.set(data[ name ])\n        } else {\n          u[ name ].value = data[ name ]\n        }\n      }\n\n      if (wu[ name ] !== undefined) {\n        if (wu[ name ].value.isVector3) {\n          wu[ name ].value.copy(data[ name ])\n        } else if (wu[ name ].value.set) {\n          wu[ name ].value.set(data[ name ])\n        } else {\n          wu[ name ].value = data[ name ]\n        }\n      }\n\n      if (pu[ name ] !== undefined) {\n        if (pu[ name ].value.isVector3) {\n          pu[ name ].value.copy(data[ name ])\n        } else if (pu[ name ].value.set) {\n          pu[ name ].value.set(data[ name ])\n        } else {\n          pu[ name ].value = data[ name ]\n        }\n      }\n    }\n  }\n\n  setProperties (data: any) {  // TODO\n    if (!data) return\n\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    for (const _name in data) {\n      const name = _name as 'side'|'transparent'  // TODO\n\n      let value = data[ name ]\n\n      if (name === 'transparent') {\n        this.updateRenderOrder()\n      } else if (name === 'side') {\n        value = getThreeSide(value)\n      }\n\n      (m[ name ] as any) = value;\n      (wm[ name ] as any) = value;\n      (pm[ name ] as any) = value\n    }\n\n    m.needsUpdate = true\n    wm.needsUpdate = true\n    pm.needsUpdate = true\n  }\n\n  /**\n   * Set buffer visibility\n   * @param {Boolean} value - visibility value\n   * @return {undefined}\n   */\n  setVisibility (value: boolean) {\n    this.visible = value\n\n    if (this.parameters.wireframe) {\n      this.group.visible = false\n      this.wireframeGroup.visible = value\n      if (this.pickable) {\n        this.pickingGroup.visible = false\n      }\n    } else {\n      this.group.visible = value\n      this.wireframeGroup.visible = false\n      if (this.pickable) {\n        this.pickingGroup.visible = value\n      }\n    }\n  }\n\n  /**\n   * Free buffer resources\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.material) this.material.dispose()\n    if (this.wireframeMaterial) this.wireframeMaterial.dispose()\n    if (this.pickingMaterial) this.pickingMaterial.dispose()\n\n    this.geometry.dispose()\n    if (this.wireframeGeometry) this.wireframeGeometry.dispose()\n  }\n\n  /**\n   * Customize JSON serialization to avoid circular references\n   */\n  toJSON () {\n    var result: any = {};\n    for (var x in this) {\n      if (x !== \"group\" && x !== \"wireframeGroup\" && x != \"pickingGroup\"\n         && x !== \"picking\") {\n        result[x] = this[x];\n      }\n    }\n    return result;\n  }\n}\n\nexport default Buffer\n","/**\n * @file Mesh Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Mesh.vert'\nimport '../shader/Mesh.frag'\n\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\n/**\n * Mesh buffer. Draws a triangle mesh.\n *\n * @example\n * var meshBuffer = new MeshBuffer({\n *   position: new Float32Array(\n *     [ 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1 ]\n *   ),\n *   color: new Float32Array(\n *     [ 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0 ]\n *   )\n * });\n */\nclass MeshBuffer extends Buffer {\n  vertexShader = 'Mesh.vert'\n  fragmentShader = 'Mesh.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} [data.index] - triangle indices\n   * @param  {Float32Array} [data.normal] - radii\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.addAttributes({\n      'normal': { type: 'v3', value: data.normal }\n    })\n\n    if (data.normal === undefined) {\n      this.geometry.computeVertexNormals()\n    }\n  }\n}\n\nexport default MeshBuffer\n","/**\n * @file Surface Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport MeshBuffer from './mesh-buffer'\n\n/**\n * Surface buffer. Like a {@link MeshBuffer}, but with `.isSurface` set to `true`.\n */\nclass SurfaceBuffer extends MeshBuffer {\n  isSurface = true\n}\n\nexport default SurfaceBuffer\n","/**\n * @file Double Sided Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Group, BufferGeometry, Object3D, Mesh, LineSegments, Vector3, Matrix4 } from 'three'\n\nimport Buffer, { BufferSide } from './buffer'\nimport { Picker } from '../utils/picker'\n\nfunction setVisibilityTrue (m: Object3D) { m.visible = true }\nfunction setVisibilityFalse (m: Object3D) { m.visible = false }\n\n/**\n * A double-sided mesh buffer. Takes a buffer and renders the front and\n * the back as seperate objects to avoid some artifacts when rendering\n * transparent meshes. Also allows to render the back of a mesh opaque\n * while the front is transparent.\n * @implements {Buffer}\n *\n * @example\n * var sphereGeometryBuffer = new SphereGeometryBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n * var doubleSidedBuffer = new DoubleSidedBuffer(sphereGeometryBuffer);\n */\nclass DoubleSidedBuffer {\n  size: number\n  side: BufferSide\n  visible: boolean\n  wireframe: boolean\n  geometry: BufferGeometry\n\n  picking?: Picker\n\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  frontMeshes: (Mesh|LineSegments)[] = []\n  backMeshes: (Mesh|LineSegments)[] = []\n\n  buffer: Buffer\n  frontBuffer: Buffer\n  backBuffer: Buffer\n\n  /**\n   * Create a double sided buffer\n   * @param  {Buffer} buffer - the buffer to be rendered double-sided\n   */\n  constructor (buffer: Buffer) {\n    this.size = buffer.size\n    this.side = buffer.parameters.side\n    this.visible = buffer.visible\n    this.geometry = buffer.geometry\n    this.picking = buffer.picking\n\n    this.group = new Group()\n    this.wireframeGroup = new Group()\n    this.pickingGroup = new Group()\n\n    // requires Group objects to be present\n    this.matrix = buffer.matrix\n\n    const frontBuffer = buffer\n    const backBuffer = new (buffer as any).constructor({  // TODO\n      position: new Float32Array(0)\n    }) as Buffer\n\n    frontBuffer.makeMaterial()\n    backBuffer.makeMaterial()\n\n    backBuffer.picking = buffer.picking\n    backBuffer.geometry = buffer.geometry\n    backBuffer.wireframeGeometry = buffer.wireframeGeometry\n    backBuffer.setParameters(buffer.getParameters())\n    backBuffer.updateShader()\n\n    frontBuffer.setParameters({\n      side: 'front'\n    })\n    backBuffer.setParameters({\n      side: 'back',\n      opacity: backBuffer.parameters.opacity\n    })\n\n    this.buffer = buffer\n    this.frontBuffer = frontBuffer\n    this.backBuffer = backBuffer\n  }\n\n  set matrix (m) {\n    Buffer.prototype.setMatrix.call(this, m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get pickable () {\n    return !!this.picking && !this.parameters.disablePicking\n  }\n\n  get parameters () {\n    return this.buffer.parameters\n  }\n\n  getParameters () {\n    const p = Object.assign({}, this.buffer.parameters)\n    p.side = this.side\n    return p\n  }\n\n  getMesh (picking: boolean) {\n    let front, back\n\n    if (picking) {\n      back = this.backBuffer.getPickingMesh()\n      front = this.frontBuffer.getPickingMesh()\n    } else {\n      back = this.backBuffer.getMesh()\n      front = this.frontBuffer.getMesh()\n    }\n\n    this.frontMeshes.push(<LineSegments|Mesh>front)\n    this.backMeshes.push(<LineSegments|Mesh>back)\n\n    this.setParameters({ side: this.side })\n\n    return new Group().add(back, front)\n  }\n\n  getWireframeMesh () {\n    return this.buffer.getWireframeMesh()\n  }\n\n  getPickingMesh () {\n    return this.getMesh(true)\n  }\n\n  setAttributes (data: any) {  // TODO\n    this.buffer.setAttributes(data)\n  }\n\n  setParameters (data: any) {  // TODO\n    data = Object.assign({}, data)\n\n    if (data.side === 'front') {\n      this.frontMeshes.forEach(setVisibilityTrue)\n      this.backMeshes.forEach(setVisibilityFalse)\n    } else if (data.side === 'back') {\n      this.frontMeshes.forEach(setVisibilityFalse)\n      this.backMeshes.forEach(setVisibilityTrue)\n    } else if (data.side === 'double') {\n      this.frontMeshes.forEach(setVisibilityTrue)\n      this.backMeshes.forEach(setVisibilityTrue)\n    }\n\n    if (data.side !== undefined) {\n      this.side = data.side\n    }\n    delete data.side\n\n    if (data.matrix !== undefined) {\n      this.matrix = data.matrix\n    }\n    delete data.matrix\n\n    this.frontBuffer.setParameters(data)\n\n    if (data.wireframe !== undefined) {\n      this.wireframe = data.wireframe\n      this.setVisibility(this.visible)\n    }\n    delete data.wireframe\n\n    this.backBuffer.setParameters(data)\n  }\n\n  setVisibility (value: boolean) {\n    this.visible = value\n\n    if (this.parameters.wireframe) {\n      this.group.visible = false\n      this.wireframeGroup.visible = value\n      if (this.pickable) {\n        this.pickingGroup.visible = false\n      }\n    } else {\n      this.group.visible = value\n      this.wireframeGroup.visible = false\n      if (this.pickable) {\n        this.pickingGroup.visible = value\n      }\n    }\n  }\n\n  dispose () {\n    this.frontBuffer.dispose()\n    this.backBuffer.dispose()\n  }\n\n  /**\n   * Customize JSON serialization to avoid circular references.\n   * Only export simple params which could be useful.\n   */\n  toJSON () {\n    var result: any = {};\n    for (var x in this) {\n      if (['side', 'size', 'visible', 'matrix', 'parameters'].includes(x)) {\n        result[x] = this[x];\n      }\n    }\n    return result;\n  }\n}\n\nexport default DoubleSidedBuffer\n","/**\n * @file Contour Buffer\n * @author Fred ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport Buffer from './buffer'\n\n/**\n * Contour buffer. A buffer that draws lines (instead of triangle meshes).\n */\nclass ContourBuffer extends Buffer {\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n}\n\nexport default ContourBuffer\n","/**\n * @file Surface Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, Box3 } from 'three'\n\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport Volume from '../surface/volume'\nimport SurfaceBuffer from '../buffer/surface-buffer'\nimport DoubleSidedBuffer from '../buffer/doublesided-buffer'\nimport ContourBuffer from '../buffer/contour-buffer'\nimport Surface from '../surface/surface';\nimport Viewer from '../viewer/viewer';\nimport {SurfaceData} from '../surface/surface'\n// @ts-ignore: unused import ColormakerParameters required for declaration only\nimport { ColormakerParameters } from '../color/colormaker';\nexport type SurfaceDataFields = {position: boolean, color: boolean, index: boolean, normal: boolean, radius: boolean}\n\n/**\n * Surface representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} SurfaceRepresentationParameters - surface representation parameters\n *\n * @property {String} isolevelType - Meaning of the isolevel value. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Float} isolevel - The value at which to create the isosurface. For volume data only.\n * @property {Boolean} negateIsolevel - For volume data only.\n * @property {Boolean} isolevelScroll - For volume data only\n * @property {Integer} smooth - How many iterations of laplacian smoothing after surface triangulation. For volume data only.\n * @property {Boolean} background - Render the surface in the background, unlit.\n * @property {Boolean} opaqueBack - Render the back-faces (where normals point away from the camera) of the surface opaque, ignoring the transparency parameter.\n * @property {Integer} boxSize - Size of the box to triangulate volume data in. Set to zero to triangulate the whole volume. For volume data only.\n * @property {Boolean} useWorker - Weather or not to triangulate the volume asynchronously in a Web Worker. For volume data only.\n * @property {Boolean} wrap - Wrap volume data around the edges; use in conjuction with boxSize but not larger than the volume dimension. For volume data only.\n */\nexport interface SurfaceRepresentationParameters extends RepresentationParameters {\n  isolevelType: 'value'|'sigma'\n  isolevel: number\n  smooth: number\n  background: boolean\n  opaqueBack: boolean\n  boxSize: number\n  useWorker: boolean\n  wrap: boolean\n}\n/**\n * Surface representation\n */\n/**\n   * Create Surface representation object\n   * @param {Surface|Volume} surface - the surface or volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {SurfaceRepresentationParameters} params - surface representation parameters\n   */\nclass SurfaceRepresentation extends Representation {\n  protected surface: Surface|Volume|undefined\n  protected volume: Volume|undefined\n  protected boxCenter: Vector3\n  protected __boxCenter: Vector3\n  protected box: Box3\n  protected __box: Box3\n  protected _position: Vector3\n  protected isolevelType: 'value'|'sigma'\n  protected isolevel: number\n  protected negateIsolevel: boolean\n  protected isolevelScroll: boolean\n  protected smooth: number\n  protected background: boolean\n  protected opaqueBack: boolean\n  protected boxSize: number\n  protected inverseMatrix: Matrix4\n  protected colorVolume: Volume\n  protected contour: boolean\n  protected useWorker: boolean\n  protected wrap: boolean\n\n  protected __isolevel: number\n  protected __smooth: number\n  protected __contour: boolean\n  protected __wrap: boolean\n  protected __boxSize: number\n\n  setBox: () => void\n\n  constructor (surface: Surface, viewer: Viewer, params: Partial<SurfaceRepresentationParameters>) {\n    super(surface, viewer, params)\n\n    this.type = 'surface'\n\n    this.parameters = Object.assign({\n\n      isolevelType: {\n        type: 'select',\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      isolevel: {\n        type: 'number', precision: 2, max: 1000, min: -1000\n      },\n      negateIsolevel: {\n        type: 'boolean'\n      },\n      isolevelScroll: {\n        type: 'boolean'\n      },\n      smooth: {\n        type: 'integer', precision: 1, max: 10, min: 0\n      },\n      background: {\n        type: 'boolean', rebuild: true // FIXME\n      },\n      opaqueBack: {\n        type: 'boolean', buffer: true\n      },\n      boxSize: {\n        type: 'integer', precision: 1, max: 100, min: 0\n      },\n      colorVolume: {\n        type: 'hidden'\n      },\n      contour: {\n        type: 'boolean', rebuild: true\n      },\n      useWorker: {\n        type: 'boolean', rebuild: true\n      },\n      wrap: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters)\n\n    if (surface instanceof Volume) {\n      this.surface = undefined\n      this.volume = surface\n    } else {\n      this.surface = surface\n      this.volume = undefined\n    }\n\n    this.boxCenter = new Vector3()\n    this.__boxCenter = new Vector3()\n    this.box = new Box3()\n    this.__box = new Box3()\n\n    this._position = new Vector3()\n    this.inverseMatrix = new Matrix4()\n\n    this.setBox = function setBox () {\n      this._position.copy(viewer.translationGroup.position).negate()\n      this._position.applyMatrix4(this.inverseMatrix)\n      if (!this._position.equals(this.boxCenter)) {\n        this.setParameters({ 'boxCenter': this._position })\n      }\n    }\n\n    this.toBePrepared = true\n\n    this.viewer.signals.ticked.add(this.setBox, this)\n\n    this.init(params)\n  }\n\n  init (params: Partial<SurfaceRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n\n    this.isolevelType = defaults(p.isolevelType, 'sigma')\n    this.isolevel = defaults(p.isolevel, 2.0)\n    this.negateIsolevel = defaults(p.negateIsolevel, false)\n    this.isolevelScroll = defaults(p.isolevelScroll, false)\n    this.smooth = defaults(p.smooth, 0)\n    this.background = defaults(p.background, false)\n    this.opaqueBack = defaults(p.opaqueBack, true)\n    this.boxSize = defaults(p.boxSize, 0)\n    this.colorVolume = defaults(p.colorVolume, undefined)\n    this.contour = defaults(p.contour, false)\n    this.useWorker = defaults(p.useWorker, true)\n    this.wrap = defaults(p.wrap, false)\n\n    super.init(p)\n\n    this.inverseMatrix.copy(this.matrix).invert()\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  prepare (callback: () => void) {\n    if (this.volume) {\n      let isolevel\n\n      if (this.isolevelType === 'sigma') {\n        isolevel = this.volume.getValueForSigma(this.isolevel)\n      } else {\n        isolevel = this.isolevel\n      }\n      if (this.negateIsolevel) isolevel *= -1\n\n      if (!this.surface ||\n        this.__isolevel !== isolevel ||\n        this.__smooth !== this.smooth ||\n        this.__contour !== this.contour ||\n        this.__wrap !== this.wrap ||\n        this.__boxSize !== this.boxSize ||\n        (this.boxSize > 0 &&\n            !this.__boxCenter.equals(this.boxCenter))\n      ) {\n        this.__isolevel = isolevel\n        this.__smooth = this.smooth\n        this.__contour = this.contour\n        this.__wrap = this.wrap\n        this.__boxSize = this.boxSize\n        this.__boxCenter.copy(this.boxCenter)\n        this.__box.copy(this.box)\n\n        const onSurfaceFinish = (surface: Surface) => {\n          this.surface = surface\n          callback()\n        }\n\n        if (this.useWorker) {\n          this.volume.getSurfaceWorker(\n            isolevel, this.smooth, this.boxCenter, this.boxSize,\n            this.contour, this.wrap, onSurfaceFinish\n          )\n        } else {\n          onSurfaceFinish(\n            this.volume.getSurface(\n              isolevel, this.smooth, this.boxCenter, this.boxSize,\n              this.contour, this.wrap\n            )\n          )\n        }\n      } else {\n        callback()\n      }\n    } else {\n      callback()\n    }\n  }\n\n  create () {\n    const sd = {\n      position: (this.surface as Surface).getPosition(),\n      color: (this.surface as Surface).getColor(this.getColorParams()),\n      index: (this.surface as Surface).getIndex()\n    }\n\n    let buffer\n\n    if (this.contour) {\n      buffer = new ContourBuffer(\n        sd,\n        this.getBufferParams({ wireframe: false })\n      )\n    } else {\n      Object.assign(sd, {\n        normal: (this.surface as Surface).getNormal(),\n        picking: (this.surface as Surface).getPicking()\n      })\n\n      const surfaceBuffer = new SurfaceBuffer(\n        sd,\n        this.getBufferParams({\n          background: this.background,\n          opaqueBack: this.opaqueBack,\n          dullInterior: false\n        })\n      )\n\n      buffer = new DoubleSidedBuffer(surfaceBuffer)\n    }\n\n    this.bufferList.push(buffer as ContourBuffer)\n  }\n\n  update (what: SurfaceDataFields) {\n    if (this.bufferList.length === 0) return\n\n    what = what || {}\n\n    const surfaceData: Partial<SurfaceData> = {}\n\n    if (what.position) {\n      surfaceData.position = (this.surface as Surface).getPosition()\n    }\n\n    if (what.color) {\n      surfaceData.color = (this.surface as Surface).getColor(\n        this.getColorParams()\n      )\n    }\n\n    if (what.index) {\n      surfaceData.index = (this.surface as Surface).getIndex()\n    }\n\n    if (what.normal) {\n      surfaceData.normal = (this.surface as Surface).getNormal()\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setAttributes(surfaceData)\n    })\n  }\n\n  /**\n   * Set representation parameters\n   * @alias SurfaceRepresentation#setParameters\n   * @param {SurfaceRepresentationParameters} params - surface parameter object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {SurfaceRepresentation} this object\n   */\n  setParameters (params: Partial<SurfaceRepresentationParameters>, what?: SurfaceDataFields, rebuild?: boolean) {\n    if (params && params.isolevelType !== undefined &&\n      this.volume\n    ) {\n      if (this.isolevelType === 'value' &&\n        params.isolevelType === 'sigma'\n      ) {\n        this.isolevel = this.volume.getSigmaForValue(this.isolevel)\n      } else if (this.isolevelType === 'sigma' &&\n        params.isolevelType === 'value'\n      ) {\n        this.isolevel = this.volume.getValueForSigma(this.isolevel)\n      }\n\n      this.isolevelType = params.isolevelType\n    }\n\n    if (params && params.boxCenter) {\n      this.boxCenter.copy(params.boxCenter)\n      delete params.boxCenter\n    }\n\n    // Forbid wireframe && contour as in molsurface\n    if (params && params.wireframe && (\n      params.contour || (params.contour === undefined && this.contour)\n    )) {\n      params.wireframe = false\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    if (params.matrix) {\n      this.inverseMatrix.copy(params.matrix).invert()\n    }\n\n    if (this.volume) {\n      this.volume.getBox(this.boxCenter, this.boxSize, this.box)\n    }\n\n    if (params && params.colorVolume !== undefined) {\n      if (what) what.color = true\n    }\n\n    if (this.surface && (\n      params.isolevel !== undefined ||\n      params.negateIsolevel !== undefined ||\n      params.smooth !== undefined ||\n      params.wrap !== undefined ||\n      params.boxSize !== undefined ||\n      (this.boxSize > 0 &&\n        !this.__box.equals(this.box))\n    )) {\n      this.build({\n        'position': true,\n        'color': true,\n        'index': true,\n        'normal': !this.contour\n      })\n    }\n\n    return this\n  }\n\n  getColorParams () {\n    const p = super.getColorParams()\n\n    p.volume = this.colorVolume\n\n    return p\n  }\n\n  dispose () {\n    this.viewer.signals.ticked.remove(this.setBox, this)\n\n    super.dispose()\n  }\n}\n\nexport default SurfaceRepresentation\n","/**\n * @file Mouse Actions\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport PickingProxy from './picking-proxy'\nimport { almostIdentity } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport StructureComponent from '../component/structure-component'\nimport SurfaceRepresentation from '../representation/surface-representation'\n\nexport type ScrollCallback = (stage: Stage, delta: number) => void\nexport type DragCallback = (stage: Stage, dx: number, dy: number) => void\nexport type PickCallback = (stage: Stage, pickingProxy: PickingProxy) => void\nexport type MouseActionCallback = ScrollCallback | DragCallback | PickCallback\n\n/**\n * Mouse actions provided as static methods\n */\nclass MouseActions {\n  /**\n   * Zoom scene based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to zoom\n   * @return {undefined}\n   */\n  static zoomScroll (stage: Stage, delta: number) {\n    stage.trackballControls.zoom(delta)\n  }\n\n  /**\n   * Move near clipping plane based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to move clipping plane\n   * @return {undefined}\n   */\n  static clipNearScroll (stage: Stage, delta: number) {\n    const sp = stage.getParameters()\n    stage.setParameters({ clipNear: sp.clipNear + delta / 10 })\n  }\n\n  /**\n   * Move clipping planes based on scroll-delta.\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - direction to move planes\n   * @return {undefined}\n   */\n  static focusScroll (stage: Stage, delta: number) {\n    const focus = stage.getFocus()\n    const sign = Math.sign(delta)\n    const step = sign * almostIdentity((100 - focus) / 10, 5, 0.2)\n    stage.setFocus(focus + step)\n  }\n\n  /**\n   * Zoom scene based on scroll-delta and\n   * move focus planes based on camera position (zoom)\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to move focus planes and zoom\n   * @return {undefined}\n   */\n  static zoomFocusScroll (stage: Stage, delta: number) {\n    stage.trackballControls.zoom(delta)\n    const z = stage.viewer.camera.position.z\n    stage.setFocus(100 - Math.abs(z / 8))\n  }\n\n  /**\n   * Change isolevel of volume surfaces based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to change isolevel\n   * @return {undefined}\n   */\n  static isolevelScroll (stage: Stage, delta: number) {\n    const d = Math.sign(delta) / 10\n    stage.eachRepresentation((reprElem, comp) => {\n      if (reprElem.repr instanceof SurfaceRepresentation) {\n        const p = reprElem.getParameters() as any  // TODO\n        if (p.isolevelScroll) {\n          reprElem.setParameters({ isolevel: p.isolevel + d })\n        }\n      }\n    })\n  }\n\n  /**\n   * Pan scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.pan(dx, dy)\n  }\n\n  /**\n   * Rotate scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static rotateDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.rotate(dx, dy)\n  }\n\n  /**\n   * Rotate scene around z axis based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static zRotateDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zRotate(dx, dy)\n  }\n\n  /**\n   * Zoom scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to zoom\n   * @param {Number} dy - amount to zoom\n   * @return {undefined}\n   */\n  static zoomDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zoom((dx + dy) / -2)\n  }\n\n  /**\n   * Zoom scene based on mouse coordinate changes and\n   * move focus planes based on camera position (zoom)\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to zoom and focus\n   * @param {Number} dy - amount to zoom and focus\n   * @return {undefined}\n   */\n  static zoomFocusDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zoom((dx + dy) / -2)\n    const z = stage.viewer.camera.position.z\n    stage.setFocus(100 - Math.abs(z / 8))\n  }\n\n  /**\n   * Pan picked component based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panComponentDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.panComponent(dx, dy)\n  }\n\n  /**\n   * Pan picked atom based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panAtomDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.panAtom(dx, dy)\n  }\n\n  /**\n   * Rotate picked component based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static rotateComponentDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.rotateComponent(dx, dy)\n  }\n\n  /**\n   * Move picked element to the center of the screen\n   * @param {Stage} stage - the stage\n   * @param {PickingProxy} pickingProxy - the picking data object\n   * @return {undefined}\n   */\n  static movePick (stage: Stage, pickingProxy: PickingProxy) {\n    if (pickingProxy) {\n      stage.animationControls.move(pickingProxy.position.clone())\n    }\n  }\n\n  /**\n   * Show tooltip with information of picked element\n   * @param {Stage} stage - the stage\n   * @param {PickingProxy} pickingProxy - the picking data object\n   * @return {undefined}\n   */\n  static tooltipPick (stage: Stage, pickingProxy: PickingProxy) {\n    const tt = stage.tooltip\n    const sp = stage.getParameters() as any\n    if (sp.tooltip && pickingProxy) {\n      const mp = pickingProxy.mouse.position\n      tt.innerText = pickingProxy.getLabel()\n      tt.style.bottom = (window.innerHeight - mp.y + 3) + 'px'\n      tt.style.left = (mp.x + 3) + 'px'\n      tt.style.display = 'block'\n    } else {\n      tt.style.display = 'none'\n    }\n  }\n\n  static measurePick (stage: Stage, pickingProxy: PickingProxy) {\n    if (pickingProxy && (pickingProxy.atom || pickingProxy.bond)) {\n      const atom = pickingProxy.atom || pickingProxy.closestBondAtom\n      const sc = pickingProxy.component as StructureComponent\n      sc.measurePick(atom)\n    } else {\n      stage.measureClear()\n    }\n  }\n}\n\ntype MouseActionPreset = [ string, MouseActionCallback ][]\nexport const MouseActionPresets = {\n  default: [\n    [ 'scroll', MouseActions.zoomScroll ],\n    [ 'scroll-shift', MouseActions.focusScroll ],\n    [ 'scroll-ctrl', MouseActions.isolevelScroll ],\n    [ 'scroll-shift-ctrl', MouseActions.zoomFocusScroll ],\n\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-right', MouseActions.panDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-ctrl-right', MouseActions.zRotateDrag ],\n    [ 'drag-shift-left', MouseActions.zoomDrag ],\n    [ 'drag-middle', MouseActions.zoomFocusDrag ],\n\n    [ 'drag-ctrl-shift-right', MouseActions.panComponentDrag ],\n    [ 'drag-ctrl-shift-left', MouseActions.rotateComponentDrag ],\n\n    [ 'clickPick-right', MouseActions.measurePick ],\n    [ 'clickPick-ctrl-left', MouseActions.measurePick ],\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'clickPick-left', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  pymol: [\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-middle', MouseActions.panDrag ],\n    [ 'drag-right', MouseActions.zoomDrag ],\n    [ 'scroll', MouseActions.focusScroll ],\n    [ 'drag-shift-right', MouseActions.focusScroll ],\n\n    [ 'clickPick-ctrl+shift-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  coot: [\n    [ 'scroll', MouseActions.isolevelScroll ],\n\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-middle', MouseActions.panDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-right', MouseActions.zoomFocusDrag ],\n    [ 'drag-ctrl-right', MouseActions.focusScroll ],\n\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  astexviewer: [\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-shift-left', MouseActions.zoomDrag ],\n    [ 'scroll', MouseActions.focusScroll ],\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset\n}\n\nexport default MouseActions\n","/**\n * @file Mouse Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { MouseActionPresets, MouseActionCallback } from './mouse-actions'\nimport Stage from '../stage/stage'\nimport MouseObserver from '../stage/mouse-observer'\n\nexport type MouseControlPreset = keyof typeof MouseActionPresets\nexport interface MouseControlsParams {\n  preset?: MouseControlPreset\n  disabled?: boolean\n}\n\nexport type MouseActionType = ''|'scroll'|'drag'|'click'|'doubleClick'|'hover'|'clickPick'|'hoverPick'\nexport interface MouseAction {\n  type: MouseActionType\n  key: number\n  button: number\n  callback: MouseActionCallback\n}\n\n/**\n * Strings to describe mouse events (including optional keyboard modifiers).\n * Must contain an event type: \"scroll\", \"drag\", \"click\", \"doubleClick\",\n * \"hover\", \"clickPick\" or \"hoverPick\". Optionally contain one or more\n * (seperated by plus signs) keyboard modifiers: \"alt\", \"ctrl\", \"meta\" or\n * \"shift\". Can contain the mouse button performing the event: \"left\",\n * \"middle\" or \"right\". The type, key and button parts must be seperated by\n * dashes.\n *\n * @example\n * // triggered on scroll event (no key or button)\n * \"scroll\"\n *\n * @example\n * // triggered on scroll event while shift key is pressed\n * \"scroll-shift\"\n *\n * @example\n * // triggered on drag event with left mouse button\n * \"drag-left\"\n *\n * @example\n * // triggered on drag event with right mouse button\n * // while ctrl and shift keys are pressed\n * \"drag-right-ctrl+shift\"\n *\n * @typedef {String} TriggerString\n */\n\n/**\n * Get event type, key and button\n * @param  {TriggerString} str - input trigger string\n * @return {Array} event type, key and button\n */\nfunction triggerFromString (str: string) {\n  const tokens = str.split(/[-+]/)\n\n  let type = ''\n  if (tokens.includes('scroll')) type = 'scroll'\n  if (tokens.includes('drag')) type = 'drag'\n  if (tokens.includes('click')) type = 'click'\n  if (tokens.includes('doubleClick')) type = 'doubleClick'\n  if (tokens.includes('hover')) type = 'hover'\n  if (tokens.includes('clickPick')) type = 'clickPick'\n  if (tokens.includes('hoverPick')) type = 'hoverPick'\n\n  let key = 0\n  if (tokens.includes('alt')) key += 1\n  if (tokens.includes('ctrl')) key += 2\n  if (tokens.includes('meta')) key += 4\n  if (tokens.includes('shift')) key += 8\n\n  let button = 0\n  if (tokens.includes('left')) button += 1\n  if (tokens.includes('right')) button += 2\n  if (tokens.includes('middle')) button += 4\n\n  return [ type, key, button ] as [ MouseActionType, number, number ]\n}\n\n/**\n * Mouse controls\n */\nclass MouseControls {\n  actionList: MouseAction[] = []\n  mouse: MouseObserver\n\n  disabled: boolean  // Flag to disable all actions\n\n  /**\n   * @param {Stage} stage - the stage object\n   * @param {Object} [params] - the parameters\n   * @param {String} params.preset - one of \"default\", \"pymol\", \"coot\"\n   * @param {String} params.disabled - flag to disable all actions\n   */\n  constructor (readonly stage: Stage, params: MouseControlsParams = {}) {\n    this.mouse = stage.mouseObserver\n    this.disabled = params.disabled || false\n    this.preset(params.preset || 'default')\n  }\n\n  run (type: MouseActionType, ...args: any[]) {\n    if (this.disabled) return\n\n    const key = this.mouse.key || 0\n    const button = this.mouse.buttons || 0\n\n    this.actionList.forEach(a => {\n      if (a.type === type && a.key === key && a.button === button) {\n        (a.callback as any)(this.stage, ...args)  // TODO\n      }\n    })\n  }\n\n  /**\n   * Add a new mouse action triggered by an event, key and button combination.\n   * The {@link MouseActions} class provides a number of static methods for\n   * use as callback functions.\n   *\n   * @example\n   * // change ambient light intensity on mouse scroll\n   * // while the ctrl and shift keys are pressed\n   * stage.mouseControls.add( \"scroll-ctrl+shift\", function( stage, delta ){\n   *     var ai = stage.getParameters().ambientIntensity;\n   *     stage.setParameters( { ambientIntensity: Math.max( 0, ai + delta / 50 ) } );\n   * } );\n   *\n   * @example\n   * // Call the MouseActions.zoomDrag method on mouse drag events\n   * // with left and right mouse buttons simultaneous\n   * stage.mouseControls.add( \"drag-left+right\", MouseActions.zoomDrag );\n   *\n   * @param {TriggerString} triggerStr - the trigger for the action\n   * @param {function(stage: Stage, ...args: Any)} callback - the callback function for the action\n   * @return {undefined}\n   */\n  add (triggerStr: string, callback: MouseActionCallback) {\n    const [ type, key, button ] = triggerFromString(triggerStr)\n\n    this.actionList.push({ type, key, button, callback })\n  }\n\n  /**\n   * Remove a mouse action. The trigger string can contain an asterix (*)\n   * as a wildcard for any key or mouse button. When the callback function\n   * is given, only actions that call that function are removed.\n   *\n   * @example\n   * // remove actions triggered solely by a scroll event\n   * stage.mouseControls.remove( \"scroll\" );\n   *\n   * @example\n   * // remove actions triggered by a scroll event, including\n   * // those requiring a key pressed or mouse button used\n   * stage.mouseControls.remove( \"scroll-*\" );\n   *\n   * @example\n   * // remove actions triggered by a scroll event\n   * // while the shift key is pressed\n   * stage.mouseControls.remove( \"scroll-shift\" );\n   *\n   * @param {TriggerString} triggerStr - the trigger for the action\n   * @param {Function} [callback] - the callback function for the action\n   * @return {undefined}\n   */\n  remove (triggerStr: string, callback?: MouseActionCallback) {\n    const wildcard = triggerStr.includes('*')\n    const [ type, key, button ] = triggerFromString(triggerStr)\n\n    const actionList = this.actionList.filter(function (a) {\n      return !(\n        (a.type === type || (wildcard && type === '')) &&\n        (a.key === key || (wildcard && key === 0)) &&\n        (a.button === button || (wildcard && button === 0)) &&\n        (a.callback === callback || callback === undefined)\n      )\n    })\n\n    this.actionList = actionList\n  }\n\n  /**\n   * Set mouse action preset\n   * @param  {String} name - one of \"default\", \"pymol\", \"coot\"\n   * @return {undefined}\n   */\n  preset (name: MouseControlPreset) {\n    this.clear()\n\n    const list = MouseActionPresets[ name ] || []\n\n    list.forEach(action => this.add(action[0], action[1]))\n  }\n\n  /**\n   * Remove all mouse actions\n   * @return {undefined}\n   */\n  clear () {\n    this.actionList.length = 0\n  }\n}\n\nexport default MouseControls\n","/**\n * @file Key Actions\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from '../stage/stage'\n\nexport type KeyActionCallback = (stage: Stage) => void\n\n/**\n * Key actions provided as static methods\n */\nclass KeyActions {\n  /**\n   * Stage auto view\n   */\n  static autoView (stage: Stage) {\n    stage.autoView(1000)\n  }\n\n  /**\n   * Toggle stage animations\n   */\n  static toggleAnimations (stage: Stage) {\n    stage.animationControls.toggle()\n  }\n\n  /**\n   * Toggle stage rocking\n   */\n  static toggleRock (stage: Stage) {\n    stage.toggleRock()\n  }\n\n  /**\n   * Toggle stage spinning\n   */\n  static toggleSpin (stage: Stage) {\n    stage.toggleSpin()\n  }\n\n  /**\n   * Toggle anti-aliasing\n   */\n  static toggleAntialiasing (stage: Stage) {\n    const p = stage.getParameters()\n    stage.setParameters({ sampleLevel: p.sampleLevel === -1 ? 0 : -1 })\n  }\n}\n\ntype KeyActionPreset = [ string, KeyActionCallback ][]\nexport const KeyActionPresets = {\n  default: [\n    [ 'i', KeyActions.toggleSpin ],\n    [ 'k', KeyActions.toggleRock ],\n    [ 'p', KeyActions.toggleAnimations ],\n    [ 'a', KeyActions.toggleAntialiasing ],\n    [ 'r', KeyActions.autoView ]\n  ] as KeyActionPreset\n}\n\nexport default KeyActions\n","/**\n * @file Key Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { KeyActionPresets, KeyActionCallback } from './key-actions'\nimport Stage from '../stage/stage'\n\nexport type KeyControlPreset = keyof typeof KeyActionPresets\nexport interface KeyControlsParams {\n  preset?: KeyControlPreset\n  disabled?: boolean\n}\n\nexport interface KeyAction {\n  key: string,\n  callback: KeyActionCallback\n}\n\n/**\n * Mouse controls\n */\nclass KeyControls {\n  actionList: KeyAction[] = []\n\n  disabled: boolean  // Flag to disable all actions\n\n  /**\n   * @param {Stage} stage - the stage object\n   * @param {Object} [params] - the parameters\n   * @param {String} params.preset - one of \"default\"\n   * @param {String} params.disabled - flag to disable all actions\n   */\n  constructor (readonly stage: Stage, params: KeyControlsParams = {}) {\n    this.disabled = params.disabled || false\n    this.preset(params.preset || 'default')\n  }\n\n  run (key: string) {\n    if (this.disabled) return\n\n    this.actionList.forEach(a => {\n      if (a.key === key) {\n        a.callback(this.stage)\n      }\n    })\n  }\n\n  /**\n   * Add a key action triggered by pressing the given character.\n   * The {@link KeyActions} class provides a number of static methods for\n   * use as callback functions.\n   *\n   * @example\n   * // call KeyActions.toggleRock when \"k\" is pressed\n   * stage.keyControls.remove( \"k\", KeyActions.toggleRock );\n   *\n   * @param {Char} char - the key/character\n   * @param {Function} callback - the callback function for the action\n   * @return {undefined}\n   */\n  add (char: string, callback: KeyActionCallback) {\n    this.actionList.push({ key: char, callback })\n  }\n\n  /**\n   * Remove a key action. When the callback function\n   * is given, only actions that call that function are removed.\n   *\n   * @example\n   * // remove all actions triggered by pressing \"k\"\n   * stage.keyControls.remove( \"k\" );\n   *\n   * @example\n   * // remove action `toggleRock` triggered by pressing \"k\"\n   * stage.keyControls.remove( \"k\", toggleRock );\n   *\n   * @param {Char} char - the key/character\n   * @param {Function} [callback] - the callback function for the action\n   * @return {undefined}\n   */\n  remove (char: string, callback: KeyActionCallback) {\n\n    const actionList = this.actionList.filter(function (a) {\n      return !(\n        (a.key === char) &&\n        (a.callback === callback || callback === undefined)\n      )\n    })\n\n    this.actionList = actionList\n  }\n\n  /**\n   * Set key action preset\n   * @param  {String} name - one of \"default\"\n   * @return {undefined}\n   */\n  preset (name: KeyControlPreset) {\n    this.clear()\n\n    const list = KeyActionPresets[ name ] || []\n\n    list.forEach(action => this.add(action[0], action[1]))\n  }\n\n  /**\n   * Remove all key actions\n   * @return {undefined}\n   */\n  clear () {\n    this.actionList.length = 0\n  }\n}\n\nexport default KeyControls\n","/**\n * @file Picking Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport MouseObserver from './mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\nclass PickingBehavior {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.mouse = stage.mouseObserver\n    this.controls = stage.mouseControls\n\n    this.mouse.signals.clicked.add(this._onClick, this)\n    this.mouse.signals.hovered.add(this._onHover, this)\n  }\n\n  _onClick (x: number, y: number) {\n    const pickingProxy = this.stage.pickingControls.pick(x, y)\n    this.stage.signals.clicked.dispatch(pickingProxy)\n    this.controls.run('clickPick', pickingProxy)\n  }\n\n  _onHover (x: number, y: number) {\n    const pickingProxy = this.stage.pickingControls.pick(x, y)\n    if (pickingProxy && this.mouse.down.equals(this.mouse.position)) {\n      this.stage.transformComponent = pickingProxy.component\n      this.stage.transformAtom = pickingProxy.atom\n    }\n    this.stage.signals.hovered.dispatch(pickingProxy)\n    this.controls.run('hoverPick', pickingProxy)\n  }\n\n  dispose () {\n    this.mouse.signals.clicked.remove(this._onClick, this)\n    this.mouse.signals.hovered.remove(this._onHover, this)\n  }\n}\n\nexport default PickingBehavior\n","/**\n * @file Mouse Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport MouseObserver from './mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\nclass MouseBehavior {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n  domElement: HTMLCanvasElement\n\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.mouse = stage.mouseObserver\n    this.controls = stage.mouseControls\n\n    this.mouse.signals.moved.add(this._onMove, this)\n    this.mouse.signals.scrolled.add(this._onScroll, this)\n    this.mouse.signals.dragged.add(this._onDrag, this)\n    this.mouse.signals.clicked.add(this._onClick, this)\n    this.mouse.signals.hovered.add(this._onHover, this)\n    this.mouse.signals.doubleClicked.add(this._onDblclick, this)\n  }\n\n  _onMove (/* x, y */) {\n    this.stage.tooltip.style.display = 'none'\n  }\n\n  _onScroll (delta: number) {\n    this.controls.run('scroll', delta)\n  }\n\n  _onDrag (dx: number, dy: number) {\n    this.controls.run('drag', dx, dy)\n  }\n\n  _onClick (x: number, y: number) {\n    this.controls.run('click', x, y)\n  }\n\n  _onDblclick (x: number, y: number) {\n    this.controls.run('doubleClick', x, y)\n  }\n\n  _onHover (x: number, y: number) {\n    this.controls.run('hover', x, y)\n  }\n\n  dispose () {\n    this.mouse.signals.moved.remove(this._onMove, this)\n    this.mouse.signals.scrolled.remove(this._onScroll, this)\n    this.mouse.signals.dragged.remove(this._onDrag, this)\n    this.mouse.signals.clicked.remove(this._onClick, this)\n    this.mouse.signals.hovered.remove(this._onHover, this)\n  }\n}\n\nexport default MouseBehavior\n","/**\n * @file Animation Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport Viewer from '../viewer/viewer'\nimport Stats from '../viewer/stats'\nimport AnimationControls from '../controls/animation-controls'\n\nclass AnimationBehavior {\n  viewer: Viewer\n  animationControls: AnimationControls\n\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n    this.animationControls = stage.animationControls\n\n    this.viewer.signals.ticked.add(this._onTick, this)\n  }\n\n  _onTick (stats: Stats) {\n    this.animationControls.run(stats)\n  }\n\n  dispose () {\n    this.viewer.signals.ticked.remove(this._onTick, this)\n  }\n}\n\nexport default AnimationBehavior\n","/**\n * @file Key Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { SupportsPassiveEventHandler } from '../globals'\nimport Stage from './stage'\nimport Viewer from '../viewer/viewer'\nimport KeyControls from '../controls/key-controls'\n\nconst passive = SupportsPassiveEventHandler ? { passive: true } : false\n\nclass KeyBehavior {\n  viewer: Viewer\n  controls: KeyControls\n  domElement: HTMLCanvasElement\n\n  /**\n   * @param {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.controls = stage.keyControls\n    this.domElement = stage.viewer.renderer.domElement\n\n    // ensure the domElement is focusable\n    this.domElement.setAttribute('tabIndex', '-1')\n    this.domElement.style.outline = 'none'\n\n    this._focusDomElement = this._focusDomElement.bind(this)\n    this._onKeydown = this._onKeydown.bind(this)\n    this._onKeyup = this._onKeyup.bind(this)\n    this._onKeypress = this._onKeypress.bind(this)\n\n    this.domElement.addEventListener('mousedown', this._focusDomElement)\n    this.domElement.addEventListener('touchstart', this._focusDomElement, passive as any)  // TODO\n    this.domElement.addEventListener('keydown', this._onKeydown)\n    this.domElement.addEventListener('keyup', this._onKeyup)\n    this.domElement.addEventListener('keypress', this._onKeypress)\n  }\n\n  /**\n   * handle key down\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeydown (/* event */) {\n    // console.log( \"down\", event.keyCode, String.fromCharCode( event.keyCode ) );\n  }\n\n  /**\n   * handle key up\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeyup (/* event */) {\n    // console.log( \"up\", event.keyCode, String.fromCharCode( event.keyCode ) );\n  }\n\n  /**\n   * handle key press\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeypress (event: KeyboardEvent) {\n    // console.log( \"press\", event.keyCode, String.fromCharCode( event.keyCode ) );\n    let pressedKey: string;\n    if (\"key\" in KeyboardEvent.prototype) {\n      pressedKey = event.key;\n    // some mobile browsers don't support this attribute\n    } else {\n      pressedKey = String.fromCharCode(event.which || event.keyCode);\n    }\n    this.controls.run(pressedKey);\n  }\n\n  _focusDomElement () {\n    this.domElement.focus()\n  }\n\n  dispose () {\n    this.domElement.removeEventListener('mousedown', this._focusDomElement)\n    this.domElement.removeEventListener('touchstart', this._focusDomElement, passive as any)  // TODO\n    this.domElement.removeEventListener('keydown', this._onKeypress)\n    this.domElement.removeEventListener('keyup', this._onKeypress)\n    this.domElement.removeEventListener('keypress', this._onKeypress)\n  }\n}\n\nexport default KeyBehavior\n","/**\n * @file Annotation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3 } from 'three'\n\nimport { defaults } from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\nimport Component from './component'\n\nexport interface AnnotationParams {\n  offsetX?: number\n  offsetY?: number\n  visible?: boolean\n}\n\n/**\n * Annotation HTML element floating on top of a position rendered in 3d\n */\nexport default class Annotation {\n  offsetX: number\n  offsetY: number\n  visible: boolean\n\n  stage: Stage\n  viewer: Viewer\n  element: HTMLElement\n\n  private _viewerPosition: Vector3\n  private _canvasPosition: Vector2\n  private _cameraPosition: Vector3\n  private _clientRect: ClientRect\n\n  /**\n   * @param {Component} component - the associated component\n   * @param {Vector3} position - position in 3d\n   * @param {String|Element} content - HTML content\n   * @param {Object} [params] - parameters\n   * @param {Integer} params.offsetX - 2d offset in x direction\n   * @param {Integer} params.offsetY - 2d offset in y direction\n   * @param {Boolean} params.visible - visibility flag\n   */\n  constructor (readonly component: Component, readonly position: Vector3, content: string|HTMLElement, params: AnnotationParams = {}) {\n    this.offsetX = defaults(params.offsetX, 0)\n    this.offsetY = defaults(params.offsetY, 0)\n    this.visible = defaults(params.visible, true)\n\n    this.stage = component.stage\n    this.viewer = component.stage.viewer\n\n    this._viewerPosition = new Vector3()\n    this._updateViewerPosition()\n    this._canvasPosition = new Vector2()\n    this._cameraPosition = new Vector3()\n\n    this.element = document.createElement('div')\n    Object.assign(this.element.style, {\n      display: 'block',\n      position: 'absolute',\n      pointerEvents: 'none',\n      whiteSpace: 'nowrap',\n      left: '-10000px'\n    })\n\n    this.viewer.wrapper.appendChild(this.element)\n    this.setContent(content)\n    this.updateVisibility()\n    this.viewer.signals.rendered.add(this._update, this)\n    this.component.signals.matrixChanged.add(this._updateViewerPosition, this)\n  }\n\n  /**\n   * Set HTML content of the annotation\n   * @param {String|Element} value - HTML content\n   * @return {undefined}\n   */\n  setContent (value: string|HTMLElement) {\n    const displayValue = this.element.style.display\n    if (displayValue === 'none') {\n      this.element.style.left = '-10000px'\n      this.element.style.display = 'block'\n    }\n\n    if (value instanceof HTMLElement) {\n      this.element.appendChild(value)\n    } else {\n      const content = document.createElement('div')\n      content.innerText = value\n      Object.assign(content.style, {\n        backgroundColor: 'rgba( 0, 0, 0, 0.6 )',\n        color: 'lightgrey',\n        padding: '8px',\n        fontFamily: 'sans-serif',\n      })\n      this.element.appendChild(content)\n    }\n\n    this._clientRect = this.element.getBoundingClientRect()\n\n    if (displayValue === 'none') {\n      this.element.style.display = displayValue\n    }\n  }\n\n  /**\n   * Set visibility of the annotation\n   * @param {Boolean} value - visibility flag\n   * @return {undefined}\n   */\n  setVisibility (value: boolean) {\n    this.visible = value\n    this.updateVisibility()\n  }\n\n  getVisibility () {\n    return this.visible && this.component.parameters.visible\n  }\n\n  updateVisibility () {\n    this.element.style.display = this.getVisibility() ? 'block' : 'none'\n  }\n\n  _updateViewerPosition () {\n    this._viewerPosition\n      .copy(this.position)\n      .applyMatrix4(this.component.matrix)\n  }\n\n  _update () {\n    if (!this.getVisibility()) return\n\n    const s = this.element.style\n    const cp = this._canvasPosition\n    const vp = this._viewerPosition\n    const cr = this._clientRect\n\n    this._cameraPosition.copy(vp)\n      .add(this.viewer.translationGroup.position)\n      .applyMatrix4(this.viewer.rotationGroup.matrix)\n      .sub(this.viewer.camera.position)\n\n    if (this._cameraPosition.z < 0) {\n      s.display = 'none'\n      return\n    } else {\n      s.display = 'block'\n    }\n\n    const depth = this._cameraPosition.length()\n    const fog = this.viewer.scene.fog as any  // TODO\n\n    s.opacity = (1 - smoothstep(fog.near, fog.far, depth)).toString()\n    s.zIndex = (Math.round((fog.far - depth) * 100)).toString()\n\n    this.stage.viewerControls.getPositionOnCanvas(vp, cp)\n\n    s.bottom = (this.offsetX + cp.y + cr.height / 2) + 'px'\n    s.left = (this.offsetY + cp.x - cr.width / 2) + 'px'\n  }\n\n  /**\n   * Safely remove the annotation\n   * @return {undefined}\n   */\n  dispose () {\n    this.viewer.wrapper.removeChild(this.element)\n    this.viewer.signals.ticked.remove(this._update, this)\n    this.component.signals.matrixChanged.remove(this._updateViewerPosition, this)\n  }\n}","/**\n * @file Component Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\nimport * as signalsWrapper from 'signals'\n\nimport { ensureVector3 } from '../utils'\nimport Component from '../component/component'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpRotateQuaternion = new Quaternion()\n\n/**\n * Component controls\n */\nclass ComponentControls {\n  signals = {\n    changed: new signalsWrapper.Signal()\n  }\n\n  stage: Stage\n  viewer: Viewer\n\n  /**\n   * @param  {Component} component - the component object\n   */\n  constructor (readonly component: Component) {\n    this.stage = component.stage\n    this.viewer = component.stage.viewer\n  }\n\n  /**\n   * component center position\n   * @type {Vector3}\n   */\n  get position () {\n    return this.component.position\n  }\n\n  /**\n   * component rotation\n   * @type {Quaternion}\n   */\n  get rotation () {\n    return this.component.quaternion\n  }\n\n  /**\n   * Trigger render and emit changed event\n   * @emits {ComponentControls.signals.changed}\n   * @return {undefined}\n   */\n  changed () {\n    this.component.updateMatrix()\n    this.viewer.requestRender()\n    this.signals.changed.dispatch()\n  }\n\n  /**\n   * spin component on axis\n   * @param  {Vector3|Array} axis - rotation axis\n   * @param  {Number} angle - amount to spin\n   * @return {undefined}\n   */\n  spin (axis: Vector3, angle: number) {\n    tmpRotateMatrix.copy(this.viewer.rotationGroup.matrix).invert()\n    tmpRotateVector\n      .copy(ensureVector3(axis)).applyMatrix4(tmpRotateMatrix)\n\n    tmpRotateMatrix.extractRotation(this.component.transform)\n    tmpRotateMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpRotateMatrix.invert()\n\n    tmpRotateVector.copy(ensureVector3(axis))\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateMatrix.makeRotationAxis(tmpRotateVector, angle)\n    tmpRotateQuaternion.setFromRotationMatrix(tmpRotateMatrix)\n\n    this.component.quaternion.premultiply(tmpRotateQuaternion)\n    this.changed()\n  }\n}\n\nexport default ComponentControls\n","/**\n * @file Radius Factory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { NucleicBackboneAtoms } from '../structure/structure-constants'\nimport AtomProxy from '../proxy/atom-proxy'\n\nexport const RadiusFactoryTypes = {\n  '': '',\n  'vdw': 'by vdW radius',\n  'covalent': 'by covalent radius',\n  'sstruc': 'by secondary structure',\n  'bfactor': 'by bfactor',\n  'size': 'size',\n  'data': 'data',\n  'explicit' : 'explicit'\n}\nexport type RadiusType = keyof typeof RadiusFactoryTypes\n\nexport interface RadiusParams {\n  type?: RadiusType\n  scale?: number\n  size?: number\n  data?: { [k: number]: number }\n}\n\nclass RadiusFactory {\n  max = 10\n\n  static types = RadiusFactoryTypes\n\n  readonly type: RadiusType\n  readonly scale: number\n  readonly size: number\n  readonly data: { [k: number]: number }\n\n  constructor (params: RadiusParams = {}) {\n    this.type = defaults(params.type, 'size')\n    this.scale = defaults(params.scale, 1)\n    this.size = defaults(params.size, 1)\n    this.data = defaults(params.data, {})\n  }\n\n  atomRadius (a: AtomProxy) {\n    let r\n\n    switch (this.type) {\n      case 'vdw':\n        r = a.vdw\n        break\n\n      case 'covalent':\n        r = a.covalent\n        break\n\n      case 'bfactor':\n        r = a.bfactor || 1.0\n        break\n\n      case 'sstruc':\n        const sstruc = a.sstruc\n        if (sstruc === 'h') {\n          r = 0.25\n        } else if (sstruc === 'g') {\n          r = 0.25\n        } else if (sstruc === 'i') {\n          r = 0.25\n        } else if (sstruc === 'e') {\n          r = 0.25\n        } else if (sstruc === 'b') {\n          r = 0.25\n        } else if (NucleicBackboneAtoms.includes(a.atomname)) {\n          r = 0.4\n        } else {\n          r = 0.1\n        }\n        break\n\n      case 'data':\n        r = defaults(this.data[ a.index ], 1.0)\n        break\n\n      case 'explicit':\n        // defaults is inappropriate as AtomProxy.radius returns\n        // null for missing radii\n        r = a.radius\n        if (r === null) r = this.size\n        break\n\n      default:\n        r = this.size\n        break\n    }\n\n    return Math.min(r * this.scale, this.max)\n  }\n\n}\n\nexport default RadiusFactory\n","/**\n * @file Principal Axes\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\n\nimport {\n    Matrix, meanRows, subRows, transpose, multiplyABt, svd\n} from './matrix-utils'\nimport { projectPointOnVector } from './vector-utils'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\n\nconst negateVector = new Vector3(-1, -1, -1)\nconst tmpMatrix = new Matrix4()\n\n/**\n * Principal axes\n */\nclass PrincipalAxes {\n  begA: Vector3\n  endA: Vector3\n  begB: Vector3\n  endB: Vector3\n  begC: Vector3\n  endC: Vector3\n\n  center: Vector3\n\n  vecA: Vector3\n  vecB: Vector3\n  vecC: Vector3\n\n  normVecA: Vector3\n  normVecB: Vector3\n  normVecC: Vector3\n\n  /**\n   * @param  {Matrix} points - 3 by N matrix\n   */\n  constructor (points: Matrix) {\n    // console.time( \"PrincipalAxes\" );\n\n    const n = points.rows\n    const n3 = n / 3\n    const pointsT = new Matrix(n, 3)\n    const A = new Matrix(3, 3)\n    const W = new Matrix(1, 3)\n    const U = new Matrix(3, 3)\n    const V = new Matrix(3, 3)\n\n        // calculate\n    const mean = meanRows(points)\n    subRows(points, mean)\n    transpose(pointsT, points)\n    multiplyABt(A, pointsT, pointsT)\n    svd(A, W, U, V)\n\n    // console.log( points, pointsT, mean )\n    // console.log( n, A, W, U, V );\n\n    // center\n    const vm = new Vector3(mean[0], mean[1], mean[2])\n\n    // normalized\n    const van = new Vector3(U.data[0], U.data[3], U.data[6])\n    const vbn = new Vector3(U.data[1], U.data[4], U.data[7])\n    const vcn = new Vector3(U.data[2], U.data[5], U.data[8])\n\n    // scaled\n    const va = van.clone().multiplyScalar(Math.sqrt(W.data[0] / n3))\n    const vb = vbn.clone().multiplyScalar(Math.sqrt(W.data[1] / n3))\n    const vc = vcn.clone().multiplyScalar(Math.sqrt(W.data[2] / n3))\n\n    // points\n    this.begA = vm.clone().sub(va)\n    this.endA = vm.clone().add(va)\n    this.begB = vm.clone().sub(vb)\n    this.endB = vm.clone().add(vb)\n    this.begC = vm.clone().sub(vc)\n    this.endC = vm.clone().add(vc)\n\n    //\n\n    this.center = vm\n\n    this.vecA = va\n    this.vecB = vb\n    this.vecC = vc\n\n    this.normVecA = van\n    this.normVecB = vbn\n    this.normVecC = vcn\n\n    // console.timeEnd( \"PrincipalAxes\" );\n  }\n\n  /**\n   * Get the basis matrix descriping the axes\n   * @param  {Matrix4} [optionalTarget] - target object\n   * @return {Matrix4} the basis\n   */\n  getBasisMatrix (optionalTarget = new Matrix4()) {\n    const basis = optionalTarget\n\n    basis.makeBasis(this.normVecB, this.normVecA, this.normVecC)\n    if (basis.determinant() < 0) {\n      basis.scale(negateVector)\n    }\n\n    return basis\n  }\n\n  /**\n   * Get a quaternion descriping the axes rotation\n   * @param  {Quaternion} [optionalTarget] - target object\n   * @return {Quaternion} the rotation\n   */\n  getRotationQuaternion (optionalTarget = new Quaternion()) {\n    const q = optionalTarget\n    q.setFromRotationMatrix(this.getBasisMatrix(tmpMatrix))\n\n    return q.invert()\n  }\n\n  /**\n   * Get the scale/length for each dimension for a box around the axes\n   * to enclose the atoms of a structure\n   * @param  {Structure|StructureView} structure - the structure\n   * @return {{d1a: Number, d2a: Number, d3a: Number, d1b: Number, d2b: Number, d3b: Number}} scale\n   */\n  getProjectedScaleForAtoms (structure: Structure) {\n    let d1a = -Infinity\n    let d1b = -Infinity\n    let d2a = -Infinity\n    let d2b = -Infinity\n    let d3a = -Infinity\n    let d3b = -Infinity\n\n    const p = new Vector3()\n    const t = new Vector3()\n\n    const center = this.center\n    const ax1 = this.normVecA\n    const ax2 = this.normVecB\n    const ax3 = this.normVecC\n\n    structure.eachAtom(function (ap: AtomProxy) {\n      projectPointOnVector(p.copy(ap as any), ax1, center)  // TODO\n      const dp1 = t.subVectors(p, center).normalize().dot(ax1)\n      const dt1 = p.distanceTo(center)\n      if (dp1 > 0) {\n        if (dt1 > d1a) d1a = dt1\n      } else {\n        if (dt1 > d1b) d1b = dt1\n      }\n\n      projectPointOnVector(p.copy(ap as any), ax2, center)\n      const dp2 = t.subVectors(p, center).normalize().dot(ax2)\n      const dt2 = p.distanceTo(center)\n      if (dp2 > 0) {\n        if (dt2 > d2a) d2a = dt2\n      } else {\n        if (dt2 > d2b) d2b = dt2\n      }\n\n      projectPointOnVector(p.copy(ap as any), ax3, center)\n      const dp3 = t.subVectors(p, center).normalize().dot(ax3)\n      const dt3 = p.distanceTo(center)\n      if (dp3 > 0) {\n        if (dt3 > d3a) d3a = dt3\n      } else {\n        if (dt3 > d3b) d3b = dt3\n      }\n    })\n\n    return {\n      d1a: d1a,\n      d2a: d2a,\n      d3a: d3a,\n      d1b: -d1b,\n      d2b: -d2b,\n      d3b: -d3b\n    }\n  }\n}\n\nexport default PrincipalAxes\n","/**\n * @file Filtered Volume\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Volume from './volume'\nimport { Box3, Matrix4, Matrix3, Vector3 } from 'three';\n\nclass FilteredVolume {\n  volume: Volume\n  data: Float32Array\n  position: Float32Array\n  atomindex: Int32Array\n  _filterHash: string\n  _dataBuffer: ArrayBuffer\n  _positionBuffer: ArrayBuffer\n  _atomindexBuffer: ArrayBuffer\n  getValueForSigma: typeof Volume.prototype.getValueForSigma\n  getSigmaForValue: typeof Volume.prototype.getSigmaForValue\n  getDataAtomindex: typeof Volume.prototype.getDataAtomindex\n  getDataPosition: typeof Volume.prototype.getDataPosition\n  getDataColor: typeof Volume.prototype.getDataColor\n  getDataPicking: typeof Volume.prototype.getDataPicking\n  getDataSize: typeof Volume.prototype.getDataSize\n\n\n  constructor (volume: Volume, minValue?: number, maxValue?: number, outside?: boolean) {\n    this.volume = volume\n    this.setFilter(minValue, maxValue, outside)\n  }\n\n  get header () { return this.volume.header }\n  get matrix (): Matrix4 { return this.volume.matrix }\n  get normalMatrix (): Matrix3 { return this.volume.normalMatrix }\n  get inverseMatrix (): Matrix4 { return this.volume.inverseMatrix }\n  get center (): Vector3 { return this.volume.center }\n  get boundingBox (): Box3 { return this.volume.boundingBox }\n  get min () { return this.volume.min }\n  get max () { return this.volume.max }\n  get mean () { return this.volume.mean }\n  get rms () { return this.volume.rms }\n\n  _getFilterHash (minValue: number, maxValue: number, outside: boolean) {\n    return JSON.stringify([ minValue, maxValue, outside ])\n  }\n\n  setFilter (minValue: number|undefined, maxValue: number|undefined, outside: boolean|undefined) {\n    if (isNaN(<number>minValue) && this.header) {\n      minValue = this.header.DMEAN + 2.0 * this.header.ARMS\n    }\n\n    minValue = (minValue !== undefined && !isNaN(minValue)) ? minValue : -Infinity\n    maxValue = defaults(maxValue, Infinity) as number\n    outside = defaults(outside, false) as boolean\n\n    const data = this.volume.data\n    const position = this.volume.position\n    const atomindex = this.volume.atomindex\n\n    const filterHash = this._getFilterHash(minValue, maxValue, outside)\n\n    if (filterHash === this._filterHash) {\n      // already filtered\n      return\n    } else if (minValue === -Infinity && maxValue === Infinity) {\n      this.data = data\n      this.position = position\n      this.atomindex = atomindex!\n    } else {\n      const n = data.length\n\n      if (!this._dataBuffer) {\n        // ArrayBuffer for re-use as Float32Array backend\n\n        this._dataBuffer = new ArrayBuffer(n * 4)\n        this._positionBuffer = new ArrayBuffer(n * 3 * 4)\n        if (atomindex) this._atomindexBuffer = new ArrayBuffer(n * 4)\n      }\n\n      const filteredData = new Float32Array(this._dataBuffer)\n      const filteredPosition = new Float32Array(this._positionBuffer)\n      let filteredAtomindex\n      if (atomindex) filteredAtomindex = new Uint32Array(this._atomindexBuffer)\n\n      let j = 0\n\n      for (let i = 0; i < n; ++i) {\n        const i3 = i * 3\n        const v = data[ i ]\n\n        if ((!outside && v >= minValue && v <= maxValue) ||\n            (outside && (v < minValue || v > maxValue))\n        ) {\n          const j3 = j * 3\n\n          filteredData[ j ] = v\n\n          filteredPosition[ j3 + 0 ] = position[ i3 + 0 ]\n          filteredPosition[ j3 + 1 ] = position[ i3 + 1 ]\n          filteredPosition[ j3 + 2 ] = position[ i3 + 2 ]\n\n          if (atomindex && filteredAtomindex) filteredAtomindex[ j ] = atomindex[ i ]\n\n          j += 1\n        }\n      }\n\n      // set views\n\n      this.data = new Float32Array(this._dataBuffer, 0, j)\n      this.position = new Float32Array(this._positionBuffer, 0, j * 3)\n      if (atomindex) this.atomindex = new Int32Array(this._atomindexBuffer, 0, j)\n    }\n\n    this._filterHash = filterHash\n  }\n}\n\nFilteredVolume.prototype.getValueForSigma = Volume.prototype.getValueForSigma\nFilteredVolume.prototype.getSigmaForValue = Volume.prototype.getSigmaForValue\n\nFilteredVolume.prototype.getDataAtomindex = Volume.prototype.getDataAtomindex\nFilteredVolume.prototype.getDataPosition = Volume.prototype.getDataPosition\nFilteredVolume.prototype.getDataColor = Volume.prototype.getDataColor\nFilteredVolume.prototype.getDataPicking = Volume.prototype.getDataPicking\nFilteredVolume.prototype.getDataSize = Volume.prototype.getDataSize\n\nexport default FilteredVolume\n","/**\n * @file Bond Hash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport BondStore from './bond-store'\nimport { createAdjacencyList } from '../utils/adjacency-list'\n\nclass BondHash {\n  countArray: Uint8Array\n  offsetArray: Int32Array\n  indexArray: Int32Array\n\n  constructor (bondStore: BondStore, atomCount: number) {\n    const al = createAdjacencyList({\n      nodeArray1: bondStore.atomIndex1,\n      nodeArray2: bondStore.atomIndex2,\n      edgeCount: bondStore.count,\n      nodeCount: atomCount\n    })\n\n    this.countArray = al.countArray\n    this.offsetArray = al.offsetArray\n    this.indexArray = al.indexArray\n  }\n}\n\nexport default BondHash\n","/**\n * @file Bond Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Bond store\n */\nexport default class BondStore extends Store {\n  atomIndex1: Uint32Array\n  atomIndex2: Uint32Array\n  bondOrder: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'atomIndex1', 1, 'int32' ],\n      [ 'atomIndex2', 1, 'int32' ],\n      [ 'bondOrder', 1, 'int8' ]\n    ] as StoreField[]\n  }\n\n  addBond (atom1: AtomProxy, atom2: AtomProxy, bondOrder?: number) {\n    this.growIfFull()\n\n    const i = this.count\n    const ai1 = atom1.index\n    const ai2 = atom2.index\n\n    if (ai1 < ai2) {\n      this.atomIndex1[ i ] = ai1\n      this.atomIndex2[ i ] = ai2\n    } else {\n      this.atomIndex2[ i ] = ai1\n      this.atomIndex1[ i ] = ai2\n    }\n    if (bondOrder) this.bondOrder[ i ] = bondOrder\n\n    this.count += 1\n  }\n\n  addBondIfConnected (atom1: AtomProxy, atom2: AtomProxy, bondOrder?: number) {\n    if (atom1.connectedTo(atom2)) {\n      this.addBond(atom1, atom2, bondOrder)\n      return true\n    }\n\n    return false\n  }\n}","/**\n * @file Atom Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Atom store\n */\nexport default class AtomStore extends Store {\n  residueIndex: Uint32Array\n  atomTypeId: Uint16Array\n\n  x: Float32Array\n  y: Float32Array\n  z: Float32Array\n  serial: Int32Array\n  bfactor: Float32Array\n  altloc: Uint8Array\n  occupancy: Float32Array\n\n  partialCharge?: Float32Array\n  formalCharge?: Int8Array\n\n  get _defaultFields () {\n    return [\n      [ 'residueIndex', 1, 'uint32' ],\n      [ 'atomTypeId', 1, 'uint16' ],\n\n      [ 'x', 1, 'float32' ],\n      [ 'y', 1, 'float32' ],\n      [ 'z', 1, 'float32' ],\n      [ 'serial', 1, 'int32' ],\n      [ 'bfactor', 1, 'float32' ],\n      [ 'altloc', 1, 'uint8' ],\n      [ 'occupancy', 1, 'float32' ]\n    ] as StoreField[]\n  }\n\n  setAltloc (i: number, str: string) {\n    this.altloc[ i ] = str.charCodeAt(0)\n  }\n\n  getAltloc (i: number) {\n    const code = this.altloc[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n}","/**\n * @file Residue Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Residue store\n */\nexport default class ResidueStore extends Store {\n  chainIndex: Uint32Array\n  atomOffset: Uint32Array\n  atomCount: Uint32Array\n  residueTypeId: Uint16Array\n\n  resno: Uint32Array\n  sstruc: Uint8Array\n  inscode: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'chainIndex', 1, 'uint32' ],\n      [ 'atomOffset', 1, 'uint32' ],\n      [ 'atomCount', 1, 'uint32' ],\n      [ 'residueTypeId', 1, 'uint16' ],\n\n      [ 'resno', 1, 'int32' ],\n      [ 'sstruc', 1, 'uint8' ],\n      [ 'inscode', 1, 'uint8' ]\n    ] as StoreField[]\n  }\n\n  setSstruc (i: number, str: string) {\n    this.sstruc[ i ] = str.charCodeAt(0)\n  }\n\n  getSstruc (i: number) {\n    const code = this.sstruc[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n\n  setInscode (i: number, str: string) {\n    this.inscode[ i ] = str.charCodeAt(0)\n  }\n\n  getInscode (i: number) {\n    const code = this.inscode[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n}","/**\n * @file Chain Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Chain store\n */\nexport default class ChainStore extends Store {\n  entityIndex: Uint16Array\n  modelIndex: Uint16Array\n  residueOffset: Uint32Array\n  residueCount: Uint32Array\n\n  chainname: Uint8Array\n  chainid: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'entityIndex', 1, 'uint16' ],\n      [ 'modelIndex', 1, 'uint16' ],\n      [ 'residueOffset', 1, 'uint32' ],\n      [ 'residueCount', 1, 'uint32' ],\n\n      [ 'chainname', 4, 'uint8' ],\n      [ 'chainid', 4, 'uint8' ]\n    ] as StoreField[]\n  }\n\n  setChainname (i: number, str: string) {\n    const j = 4 * i\n    this.chainname[ j ] = str.charCodeAt(0)\n    this.chainname[ j + 1 ] = str.charCodeAt(1)\n    this.chainname[ j + 2 ] = str.charCodeAt(2)\n    this.chainname[ j + 3 ] = str.charCodeAt(3)\n  }\n\n  getChainname (i: number) {\n    let chainname = ''\n    for (let k = 0; k < 4; ++k) {\n      const code = this.chainname[ 4 * i + k ]\n      if (code) {\n        chainname += String.fromCharCode(code)\n      } else {\n        break\n      }\n    }\n    return chainname\n  }\n\n  setChainid (i: number, str: string) {\n    const j = 4 * i\n    this.chainid[ j ] = str.charCodeAt(0)\n    this.chainid[ j + 1 ] = str.charCodeAt(1)\n    this.chainid[ j + 2 ] = str.charCodeAt(2)\n    this.chainid[ j + 3 ] = str.charCodeAt(3)\n  }\n\n  getChainid (i: number) {\n    let chainid = ''\n    for (let k = 0; k < 4; ++k) {\n      const code = this.chainid[ 4 * i + k ]\n      if (code) {\n        chainid += String.fromCharCode(code)\n      } else {\n        break\n      }\n    }\n    return chainid\n  }\n}\n","/**\n * @file Model Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Model store\n */\nexport default class ModelStore extends Store {\n\tchainOffset: Uint32Array\n\tchainCount: Uint32Array\n\n  get _defaultFields () {\n    return [\n      [ 'chainOffset', 1, 'uint32' ],\n      [ 'chainCount', 1, 'uint32' ]\n    ] as StoreField[]\n  }\n}","/**\n * @file Helixorient\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { ColormakerParameters } from '../color/colormaker'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { copyArray } from '../math/array-utils'\nimport { projectPointOnVector } from '../math/vector-utils'\nimport Polymer from '../proxy/polymer'\n\nexport interface HelixIterator {\n  size: number\n  next: () => Vector3\n  get: (idx: number) => Vector3\n  reset: () => void\n}\n\nexport interface HelixPosition {\n  center: Float32Array\n  axis: Float32Array\n  bending: Float32Array\n  radius: Float32Array\n  rise: Float32Array\n  twist: Float32Array\n  resdir: Float32Array\n}\n\nclass Helixorient {\n  size: number\n\n  constructor (readonly polymer: Polymer) {\n    this.size = polymer.residueCount\n  }\n\n  getCenterIterator (smooth = 0): HelixIterator {\n    const center = this.getPosition().center\n    const size = center.length / 3\n\n    let i = 0\n    let j = -1\n\n    const cache = [\n      new Vector3(),\n      new Vector3(),\n      new Vector3(),\n      new Vector3()\n    ]\n\n    function next (this: HelixIterator) {\n      const vector = this.get(j)\n      j += 1\n      return vector\n    }\n\n    function get (idx: number) {\n      idx = Math.min(size - 1, Math.max(0, idx))\n      const v = cache[ i % 4 ]\n      const idx3 = 3 * idx\n      v.fromArray(center as any, idx3)  // TODO\n      if (smooth) {\n        const w = Math.min(smooth, idx, size - idx - 1)\n        for (let k = 1; k <= w; ++k) {\n          const l = k * 3\n          const t = (w + 1 - k) / (w + 1)\n          v.x += t * center[ idx3 - l + 0 ] + t * center[ idx3 + l + 0 ]\n          v.y += t * center[ idx3 - l + 1 ] + t * center[ idx3 + l + 1 ]\n          v.z += t * center[ idx3 - l + 2 ] + t * center[ idx3 + l + 2 ]\n        }\n        v.x /= w + 1\n        v.y /= w + 1\n        v.z /= w + 1\n      }\n      i += 1\n      return v\n    }\n\n    function reset () {\n      i = 0\n      j = -1\n    }\n\n    return { size, next, get, reset }\n  }\n\n  getColor (params: { scheme: string } & ColormakerParameters) {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const col = new Float32Array(n * 3)\n\n    const p = params || {}\n    p.structure = structure\n\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    const rp = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      ap.index = rp.traceAtomIndex\n\n      colormaker.atomColorToArray(ap, col, i * 3)\n    }\n\n    return {\n      'color': col\n    }\n  }\n\n  getPicking () {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const pick = new Float32Array(n)\n    const rp = structure.getResidueProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      pick[ i ] = rp.traceAtomIndex\n    }\n\n    return {\n      'picking': new AtomPicker(pick, structure)\n    }\n  }\n\n  getSize (params: RadiusParams) {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const size = new Float32Array(n)\n    const radiusFactory = new RadiusFactory(params)\n\n    const rp = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      ap.index = rp.traceAtomIndex\n      size[ i ] = radiusFactory.atomRadius(ap)\n    }\n\n    return { size }\n  }\n\n  getPosition (): HelixPosition {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const n3 = n - 3\n\n    const center = new Float32Array(3 * n)\n    const axis = new Float32Array(3 * n)\n    const diff = new Float32Array(n)\n    const radius = new Float32Array(n)\n    const rise = new Float32Array(n)\n    const twist = new Float32Array(n)\n    const resdir = new Float32Array(3 * n)\n\n    const r12 = new Vector3()\n    const r23 = new Vector3()\n    const r34 = new Vector3()\n\n    const diff13 = new Vector3()\n    const diff24 = new Vector3()\n\n    const v1 = new Vector3()\n    const v2 = new Vector3()\n    const vt = new Vector3()\n\n    const _axis = new Vector3()\n    const _prevAxis = new Vector3()\n\n    const _resdir = new Vector3()\n    const _center = new Vector3(0, 0, 0)\n\n    const type = 'trace'\n    const a1 = structure.getAtomProxy()\n    const a2 = structure.getAtomProxy(polymer.getAtomIndexByType(0, type))\n    const a3 = structure.getAtomProxy(polymer.getAtomIndexByType(1, type))\n    const a4 = structure.getAtomProxy(polymer.getAtomIndexByType(2, type))\n\n    for (let i = 0; i < n3; ++i) {\n      a1.index = a2.index\n      a2.index = a3.index\n      a3.index = a4.index\n      a4.index = polymer.getAtomIndexByType(i + 3, type)!  // TODO\n\n      const j = 3 * i\n\n      // ported from GROMACS src/tools/gmx_helixorient.c\n\n      r12.subVectors(a2 as any, a1 as any)  // TODO\n      r23.subVectors(a3 as any, a2 as any)  // TODO\n      r34.subVectors(a4 as any, a3 as any)  // TODO\n\n      diff13.subVectors(r12, r23)\n      diff24.subVectors(r23, r34)\n\n      _axis.crossVectors(diff13, diff24).normalize()\n      _axis.toArray(axis as any, j)  // TODO\n\n      if (i > 0) {\n        diff[ i ] = _axis.angleTo(_prevAxis)\n      }\n\n      const tmp = Math.cos(diff13.angleTo(diff24))\n      twist[ i ] = 180.0 / Math.PI * Math.acos(tmp)\n\n      const diff13Length = diff13.length()\n      const diff24Length = diff24.length()\n\n      radius[ i ] = (\n        Math.sqrt(diff24Length * diff13Length) /\n        // clamp, to avoid instabilities for when\n        // angle between diff13 and diff24 is near 0\n        Math.max(2.0, 2.0 * (1.0 - tmp))\n      )\n\n      rise[ i ] = Math.abs(r23.dot(_axis))\n\n      //\n\n      v1.copy(diff13).multiplyScalar(radius[ i ] / diff13Length)\n      v2.copy(diff24).multiplyScalar(radius[ i ] / diff24Length)\n\n      v1.subVectors(a2 as any, v1)  // TODO\n      v2.subVectors(a3 as any, v2)  // TODO\n\n      v1.toArray(center as any, j + 3)  // TODO\n      v2.toArray(center as any, j + 6)  // TODO\n\n      //\n\n      _resdir.subVectors(a1 as any, _center)  // TODO\n      _resdir.toArray(resdir as any, j)  // TODO\n\n      _prevAxis.copy(_axis)\n      _center.copy(v1)\n    }\n\n    //\n\n    // calc axis as dir of second and third center pos\n    // project first traceAtom onto axis to get first center pos\n    v1.fromArray(center as any, 3)  // TODO\n    v2.fromArray(center as any, 6)  // TODO\n    _axis.subVectors(v1, v2).normalize()\n      // _center.copy( res[ 0 ].getTraceAtom() );\n    a1.index = polymer.getAtomIndexByType(0, type)!  // TODO\n    _center.copy(a1 as any)  // TODO\n    vt.copy(a1 as any)  // TODO\n    projectPointOnVector(vt, _axis, v1)\n    vt.toArray(center as any, 0)  // TODO\n\n    // calc first resdir\n    _resdir.subVectors(_center, v1)\n    _resdir.toArray(resdir as any, 0)  // TODO\n\n    // calc axis as dir of n-1 and n-2 center pos\n    // project last traceAtom onto axis to get last center pos\n    v1.fromArray(center as any, 3 * n - 6)  // TODO\n    v2.fromArray(center as any, 3 * n - 9)  // TODO\n    _axis.subVectors(v1, v2).normalize()\n    // _center.copy( res[ n - 1 ].getTraceAtom() );\n    a1.index = polymer.getAtomIndexByType(n - 1, type)!  // TODO\n    _center.copy(a1 as any)  // TODO\n    vt.copy(a1 as any)  // TODO\n    projectPointOnVector(vt, _axis, v1)\n    vt.toArray(center as any, 3 * n - 3)  // TODO\n\n    // calc last three resdir\n    for (let i = n - 3; i < n; ++i) {\n      v1.fromArray(center as any, 3 * i)  // TODO\n      // _center.copy( res[ i ].getTraceAtom() );\n      a1.index = polymer.getAtomIndexByType(i, type)!  // TODO\n      _center.copy(a1 as any)  // TODO\n\n      _resdir.subVectors(_center, v1)\n      _resdir.toArray(resdir as any, 3 * i)  // TODO\n    }\n\n    // average measures to define them on the residues\n\n    const resRadius = new Float32Array(n)\n    const resTwist = new Float32Array(n)\n    const resRise = new Float32Array(n)\n    const resBending = new Float32Array(n)\n\n    resRadius[ 1 ] = radius[ 0 ]\n    resTwist[ 1 ] = twist[ 0 ]\n    resRise[ 1 ] = radius[ 0 ]\n\n    for (let i = 2; i < n - 2; ++i) {\n      resRadius[ i ] = 0.5 * (radius[ i - 2 ] + radius[ i - 1 ])\n      resTwist[ i ] = 0.5 * (twist[ i - 2 ] + twist[ i - 1 ])\n      resRise[ i ] = 0.5 * (rise[ i - 2 ] + rise[ i - 1 ])\n\n      v1.fromArray(axis as any, 3 * (i - 2))  // TODO\n      v2.fromArray(axis as any, 3 * (i - 1))  // TODO\n      resBending[ i ] = 180.0 / Math.PI * Math.acos(Math.cos(v1.angleTo(v2)))\n    }\n\n    resRadius[ n - 2 ] = radius[ n - 4 ]\n    resTwist[ n - 2 ] = twist[ n - 4 ]\n    resRise[ n - 2 ] = rise[ n - 4 ]\n\n    // average helix axes to define them on the residues\n\n    const resAxis = new Float32Array(3 * n)\n\n    copyArray(axis, resAxis, 0, 0, 3)\n    copyArray(axis, resAxis, 0, 3, 3)\n\n    for (let i = 2; i < n - 2; ++i) {\n      v1.fromArray(axis as any, 3 * (i - 2))  // TODO\n      v2.fromArray(axis as any, 3 * (i - 1))  // TODO\n\n      _axis.addVectors(v2, v1).multiplyScalar(0.5).normalize()\n      _axis.toArray(resAxis as any, 3 * i)  // TODO\n    }\n\n    copyArray(axis, resAxis, 3 * n - 12, 3 * n - 6, 3)\n    copyArray(axis, resAxis, 3 * n - 12, 3 * n - 3, 3)\n\n    return {\n      center,\n      axis: resAxis,\n      bending: resBending,\n      radius: resRadius,\n      rise: resRise,\n      twist: resTwist,\n      resdir: resdir\n    }\n  }\n\n}\n\nexport default Helixorient\n","/**\n * @file Helixbundle\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport Helixorient, { HelixPosition } from './helixorient'\nimport { calculateMeanVector3, projectPointOnVector } from '../math/vector-utils'\nimport Polymer from '../proxy/polymer'\nimport { ColormakerParameters } from '../color/colormaker';\n\nexport interface Axis {\n  axis: Float32Array\n  center: Float32Array\n  begin: Float32Array\n  end: Float32Array\n  color: Float32Array\n  picking: AtomPicker\n  size: Float32Array\n  residueOffset: number[]\n  residueCount: number[]\n}\n\nclass Helixbundle {\n  helixorient: Helixorient;\n  position: HelixPosition;\n\n  constructor (readonly polymer: Polymer) {\n\n    this.helixorient = new Helixorient(polymer)\n    this.position = this.helixorient.getPosition()\n  }\n\n  getAxis (localAngle: number, centerDist: number, ssBorder: boolean, colorParams: { scheme: string} & ColormakerParameters, radiusParams: RadiusParams): Axis {\n    localAngle = localAngle || 30\n    centerDist = centerDist || 2.5\n    ssBorder = ssBorder === undefined ? false : ssBorder\n\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const pos = this.position\n\n    const cp = colorParams || {}\n    cp.structure = structure\n\n    const colormaker = ColormakerRegistry.getScheme(cp)\n\n    const radiusFactory = new RadiusFactory(radiusParams)\n\n    let j = 0\n    let k = 0\n\n    const axis: number[] = []\n    const center: number[] = []\n    const beg: number[] = []\n    const end: number[] = []\n    const col: number[] = []\n    const pick = []\n    const size = []\n    const residueOffset = []\n    const residueCount = []\n\n    let tmpAxis = new Float32Array(n * 3)\n    let tmpCenter = new Float32Array(n * 3)\n\n    let _axis, _center\n    const _beg = new Vector3()\n    const _end = new Vector3()\n\n    const rp1 = structure.getResidueProxy()\n    const rp2 = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    const c1 = new Vector3()\n    const c2 = new Vector3()\n\n    let split = false\n\n    for (let i = 0; i < n; ++i) {\n      rp1.index = residueIndexStart + i\n      c1.fromArray(pos.center as any, i * 3)\n\n      if (i === n - 1) {\n        split = true\n      } else {\n        rp2.index = residueIndexStart + i + 1\n        c2.fromArray(pos.center as any, i * 3 + 3)\n\n        if (ssBorder && rp1.sstruc !== rp2.sstruc) {\n          split = true\n        } else if (c1.distanceTo(c2) > centerDist) {\n          split = true\n        } else if (pos.bending[ i ] > localAngle) {\n          split = true\n        }\n      }\n\n      if (split) {\n        if (i - j < 4) {\n          j = i\n          split = false\n          continue\n        }\n\n        ap.index = rp1.traceAtomIndex\n\n        // ignore first and last axis\n        tmpAxis = pos.axis.subarray(j * 3 + 3, i * 3)\n        tmpCenter = pos.center.subarray(j * 3, i * 3 + 3)\n\n        _axis = calculateMeanVector3(tmpAxis).normalize()\n        _center = calculateMeanVector3(tmpCenter)\n\n        _beg.fromArray(tmpCenter as any)\n        projectPointOnVector(_beg, _axis, _center)\n\n        _end.fromArray(tmpCenter as any, tmpCenter.length - 3)\n        projectPointOnVector(_end, _axis, _center)\n\n        _axis.subVectors(_end, _beg)\n\n        _axis.toArray(axis as any, k)\n        _center.toArray(center as any, k)\n        _beg.toArray(beg as any, k)\n        _end.toArray(end as any, k)\n\n        colormaker.atomColorToArray(ap, col, k)\n\n        pick.push(ap.index)\n\n        size.push(radiusFactory.atomRadius(ap))\n\n        residueOffset.push(residueIndexStart + j)\n        residueCount.push(residueIndexStart + i + 1 - j)\n\n        k += 3\n        j = i\n        split = false\n      }\n    }\n\n    const picking = new Float32Array(pick)\n\n    return {\n      axis: new Float32Array(axis),\n      center: new Float32Array(center),\n      begin: new Float32Array(beg),\n      end: new Float32Array(end),\n      color: new Float32Array(col),\n      picking: new AtomPicker(picking, structure),\n      size: new Float32Array(size),\n      residueOffset: residueOffset,\n      residueCount: residueCount\n    }\n  }\n}\n\nexport default Helixbundle\n","/**\n * @file Binary Heap\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n/**\n * Binary heap implementation\n * @class\n * @author http://eloquentjavascript.net/appendix2.htm\n * @param {Function} scoreFunction - the heap scoring function\n */\nclass BinaryHeap<T> {\n  content: T[] = []\n\n  constructor(readonly scoreFunction: (x: T) => number) {\n\n    this.scoreFunction = scoreFunction\n  }\n\n  push (element: T) {\n    // Add the new element to the end of the array.\n    this.content.push(element)\n\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1)\n  }\n\n  pop () {\n    // Store the first element so we can return it later.\n    const result = this.content[ 0 ]\n\n    // Get the element at the end of the array.\n    const end = this.content.pop()\n\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (end && this.content.length > 0) {\n      this.content[ 0 ] = end\n      this.sinkDown(0)\n    }\n\n    return result\n  }\n\n  peek () {\n    return this.content[ 0 ]\n  }\n\n  remove (element: T) {\n    const len = this.content.length\n\n    // To remove a value, we must search through the array to find it.\n    for (let i = 0; i < len; i++) {\n      if (this.content[ i ] === element) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop()\n\n        if (end && i !== len - 1) {\n          this.content[ i ] = end\n\n          if (this.scoreFunction(end) < this.scoreFunction(element)) {\n            this.bubbleUp(i)\n          } else {\n            this.sinkDown(i)\n          }\n        }\n\n        return\n      }\n    }\n\n    throw new Error('Node not found.')\n  }\n\n  size () {\n    return this.content.length\n  }\n\n  bubbleUp (n: number) {\n    // Fetch the element that has to be moved.\n    const element = this.content[ n ]\n\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      const parentN = Math.floor((n + 1) / 2) - 1\n      const parent = this.content[ parentN ]\n\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[ parentN ] = element\n        this.content[ n ] = parent\n\n        // Update 'n' to continue at the new position.\n        n = parentN\n      } else {\n        // Found a parent that is less, no need to move it further.\n        break\n      }\n    }\n  }\n\n  sinkDown (n: number) {\n    // Look up the target element and its score.\n    const length = this.content.length\n    const element = this.content[ n ]\n    const elemScore = this.scoreFunction(element)\n\n    let child1Score = 0\n    let child2Score = 0\n\n    while (true) {\n      // Compute the indices of the child elements.\n      const child2N = (n + 1) * 2\n      const child1N = child2N - 1\n\n      // This is used to store the new position of the element, if any.\n      let swap = null\n\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        const child1 = this.content[ child1N ]\n        child1Score = this.scoreFunction(child1)\n\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) swap = child1N\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        const child2 = this.content[ child2N ]\n        child2Score = this.scoreFunction(child2)\n\n        if (child2Score < (swap === null ? elemScore : child1Score)) swap = child2N\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap !== null) {\n        this.content[ n ] = this.content[ swap ]\n        this.content[ swap ] = element\n        n = swap\n      } else {\n        // Otherwise, we are done.\n        break\n      }\n    }\n  }\n\n}\n\nexport default BinaryHeap\n","/**\n * @file Kdtree\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\nimport BinaryHeap from './binary-heap'\n\n/**\n * Kdtree\n * @class\n * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016\n * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013\n * @author I4DS http://www.fhnw.ch/i4ds, 2013\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n * @description\n * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place\n * provides fast nearest neighbour search\n *\n * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs\n *\n * Further information (including mathematical properties)\n * http://en.wikipedia.org/wiki/Binary_tree\n * http://en.wikipedia.org/wiki/K-d_tree\n *\n * @example\n * points: [x, y, z, x, y, z, x, y, z, ...]\n * metric: function(a, b){\n *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);\n * }\n *\n * @param {Float32Array} points - points\n * @param {Function} metric - metric\n */\nclass Kdtree {\n  indices: Uint32Array\n  nodes: Int32Array\n  rootIndex: number\n\n  maxDepth = 0\n  currentNode = 0\n\n  constructor(readonly points: NumberArray, readonly metric: (a: NumberArray, b: NumberArray) => number) {\n    const n = points.length / 3\n\n    const indices = new Uint32Array(n)\n    for (let i = 0; i < n; ++i) {\n      indices[ i ] = i\n    }\n    this.indices = indices\n    this.nodes = new Int32Array(n * 4)\n    this.rootIndex = this.buildTree(0, -1, 0, n)\n  }\n\n  buildTree (depth: number, parent: number, arrBegin: number, arrEnd: number) {\n    if (depth > this.maxDepth) this.maxDepth = depth\n\n    const plength = arrEnd - arrBegin\n    if (plength === 0) {\n      return -1\n    }\n\n    const nodeIndex = this.currentNode * 4\n    const nodes = this.nodes\n\n    this.currentNode += 1\n    if (plength === 1) {\n      nodes[ nodeIndex ] = arrBegin\n      nodes[ nodeIndex + 1 ] = -1\n      nodes[ nodeIndex + 2 ] = -1\n      nodes[ nodeIndex + 3 ] = parent\n      return nodeIndex\n    }\n    // if(plength <= 32){\n    //   return nodeIndex;\n    // }\n\n    const indices = this.indices\n    const points = this.points\n\n    const arrMedian = arrBegin + Math.floor(plength / 2)\n    const currentDim = depth % 3\n\n    // inlined quickselect function\n    let j, tmp, pivotIndex, pivotValue, storeIndex\n    let left = arrBegin\n    let right = arrEnd - 1\n    while (right > left) {\n      pivotIndex = (left + right) >> 1\n      pivotValue = points[ indices[ pivotIndex ] * 3 + currentDim ]\n      // swap( pivotIndex, right );\n      tmp = indices[ pivotIndex ]\n      indices[ pivotIndex ] = indices[ right ]\n      indices[ right ] = tmp\n      storeIndex = left\n      for (j = left; j < right; ++j) {\n        if (points[ indices[ j ] * 3 + currentDim ] < pivotValue) {\n          // swap( storeIndex, j );\n          tmp = indices[ storeIndex ]\n          indices[ storeIndex ] = indices[ j ]\n          indices[ j ] = tmp\n          ++storeIndex\n        }\n      }\n      // swap( right, storeIndex );\n      tmp = indices[ right ]\n      indices[ right ] = indices[ storeIndex ]\n      indices[ storeIndex ] = tmp\n      pivotIndex = storeIndex\n      if (arrMedian === pivotIndex) {\n        break\n      } else if (arrMedian < pivotIndex) {\n        right = pivotIndex - 1\n      } else {\n        left = pivotIndex + 1\n      }\n    }\n\n    nodes[ nodeIndex ] = arrMedian\n    nodes[ nodeIndex + 1 ] = this.buildTree(depth + 1, nodeIndex, arrBegin, arrMedian)\n    nodes[ nodeIndex + 2 ] = this.buildTree(depth + 1, nodeIndex, arrMedian + 1, arrEnd)\n    nodes[ nodeIndex + 3 ] = parent\n\n    return nodeIndex\n  }\n\n  getNodeDepth (nodeIndex: number): number {\n    const parentIndex = this.nodes[ nodeIndex + 3 ]\n    return (parentIndex === -1) ? 0 : this.getNodeDepth(parentIndex) + 1\n  }\n\n  // TODO\n  // function getNodePos (node) {}\n\n  /**\n   * find nearest points\n   * @param {Array} point - array of size 3\n   * @param {Integer} maxNodes - max amount of nodes to return\n   * @param {Float} maxDistance - maximum distance of point to result nodes\n   * @return {Array} array of point, distance pairs\n   */\n  nearest (point: NumberArray, maxNodes: number, maxDistance: number) {\n    const bestNodes = new BinaryHeap<[number, number]>(e => -e[ 1 ])\n\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const nearestSearch = (nodeIndex: number) => {\n      let bestChild, otherChild\n      const dimension = this.getNodeDepth(nodeIndex) % 3\n      const pointIndex = indices[ nodes[ nodeIndex ] ] * 3\n      const ownPoint = [\n        points[ pointIndex + 0 ],\n        points[ pointIndex + 1 ],\n        points[ pointIndex + 2 ]\n      ]\n      const ownDistance = this.metric(point, ownPoint)\n\n      function saveNode (nodeIndex: number, distance: number) {\n        bestNodes.push([ nodeIndex, distance ])\n        if (bestNodes.size() > maxNodes) {\n          bestNodes.pop()\n        }\n      }\n\n      const leftIndex = nodes[ nodeIndex + 1 ]\n      const rightIndex = nodes[ nodeIndex + 2 ]\n\n      // if it's a leaf\n      if (rightIndex === -1 && leftIndex === -1) {\n        if ((bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[ 1 ]) &&\n          ownDistance <= maxDistance\n        ) {\n          saveNode(nodeIndex, ownDistance)\n        }\n        return\n      }\n\n      if (rightIndex === -1) {\n        bestChild = leftIndex\n      } else if (leftIndex === -1) {\n        bestChild = rightIndex\n      } else {\n        if (point[ dimension ] <= points[ pointIndex + dimension ]) {\n          bestChild = leftIndex\n        } else {\n          bestChild = rightIndex\n        }\n      }\n\n      // recursive search\n      nearestSearch(bestChild)\n\n      if ((bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[ 1 ]) &&\n        ownDistance <= maxDistance\n      ) {\n        saveNode(nodeIndex, ownDistance)\n      }\n\n      // if there's still room or the current distance is nearer than the best distance\n      const linearPoint = []\n      for (let i = 0; i < 3; i += 1) {\n        if (i === dimension) {\n          linearPoint[ i ] = point[ i ]\n        } else {\n          linearPoint[ i ] = points[ pointIndex + i ]\n        }\n      }\n      const linearDistance = this.metric(linearPoint, ownPoint)\n\n      if ((bestNodes.size() < maxNodes || Math.abs(linearDistance) < bestNodes.peek()[ 1 ]) &&\n        Math.abs(linearDistance) <= maxDistance\n      ) {\n        if (bestChild === leftIndex) {\n          otherChild = rightIndex\n        } else {\n          otherChild = leftIndex\n        }\n        if (otherChild !== -1) {\n          nearestSearch(otherChild)\n        }\n      }\n    }\n\n    nearestSearch(this.rootIndex)\n\n    const result = []\n    for (let i = 0, il = Math.min(bestNodes.size(), maxNodes); i < il; i += 1) {\n      result.push(bestNodes.content[ i ])\n    }\n\n    return result\n  }\n\n  verify (nodeIndex?: number, depth = 0) {\n    let count = 1\n\n    if (nodeIndex === undefined) {\n      nodeIndex = this.rootIndex\n    }\n\n    if (nodeIndex === -1) {\n      throw new Error('node is null')\n    }\n\n    const dim = depth % 3\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const leftIndex = nodes[ nodeIndex + 1 ]\n    const rightIndex = nodes[ nodeIndex + 2 ]\n\n    if (leftIndex !== -1) {\n      if (points[ indices[ nodes[ leftIndex ] ] * 3 + dim ] >\n        points[ indices[ nodes[ nodeIndex ] ] * 3 + dim ]\n      ) {\n        throw new Error('left child is > parent!')\n      }\n      count += this.verify(leftIndex, depth + 1)\n    }\n\n    if (rightIndex !== -1) {\n      if (points[ indices[ nodes[ rightIndex ] ] * 3 + dim ] <\n        points[ indices[ nodes[ nodeIndex ] ] * 3 + dim ]\n      ) {\n        throw new Error('right child is < parent!')\n      }\n      count += this.verify(rightIndex, depth + 1)\n    }\n\n    return count\n  }\n}\n\nexport default Kdtree\n","/**\n * @file Atom Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport {\n  Elements,\n  SecStrucHelix, SecStrucSheet, SecStrucTurn,\n  ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType,\n  CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType\n} from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomType from '../store/atom-type';\nimport ResidueType from '../store/residue-type';\nimport ResidueProxy from './residue-proxy';\nimport Entity from '../structure/entity';\nimport BondHash from '../store/bond-hash';\n\n/**\n * Atom proxy\n */\nclass AtomProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueMap: ResidueMap\n  atomMap: AtomMap\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n    this.residueMap = structure.residueMap\n    this.atomMap = structure.atomMap\n  }\n\n  /**\n   * @type {BondHash}\n   */\n  get bondHash (): BondHash|undefined { return this.structure.bondHash }\n\n  /**\n   * Molecular enity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.chainIndex ]\n  }\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.residueIndex ]\n  }\n  /**\n   * @type {ResidueProxy}\n   */\n  get residue (): ResidueProxy {\n    return this.structure.getResidueProxy(this.residueIndex)\n  }\n\n  get residueIndex () {\n    return this.atomStore.residueIndex[ this.index ]\n  }\n  set residueIndex (value) {\n    this.atomStore.residueIndex[ this.index ] = value\n  }\n\n  //\n\n  /**\n   * Secondary structure code\n   * @type {String}\n   */\n  get sstruc () {\n    return this.residueStore.getSstruc(this.residueIndex)\n  }\n  /**\n   * Insertion code\n   * @type {String}\n   */\n  get inscode () {\n    return this.residueStore.getInscode(this.residueIndex)\n  }\n  /**\n   * Residue number/label\n   * @type {Integer}\n   */\n  get resno () {\n    return this.residueStore.resno[ this.residueIndex ]\n  }\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * @type {ResidueType}\n   */\n  get residueType (): ResidueType {\n    return this.residueMap.get(this.residueStore.residueTypeId[ this.residueIndex ])\n  }\n  /**\n   * @type {AtomType}\n   */\n  get atomType (): AtomType {\n    return this.atomMap.get(this.atomStore.atomTypeId[ this.index ])\n  }\n  get residueAtomOffset () {\n    return this.residueStore.atomOffset[ this.residueIndex ]\n  }\n\n  //\n\n  /**\n   * Residue name\n   */\n  get resname () {\n    return this.residueType.resname\n  }\n  /**\n   * Hetero flag\n   */\n  get hetero () {\n    return this.residueType.hetero\n  }\n\n  //\n\n  /**\n   * Atom name\n   */\n  get atomname () {\n    return this.atomType.atomname\n  }\n  /**\n   * Atomic number\n   */\n  get number () {\n    return this.atomType.number\n  }\n  /**\n   * Element\n   */\n  get element () {\n    return this.atomType.element\n  }\n  /**\n   * Van-der-Waals radius\n   */\n  get vdw () {\n    return this.atomType.vdw\n  }\n  /**\n   * Covalent radius\n   */\n  get covalent () {\n    return this.atomType.covalent\n  }\n\n  //\n\n  /**\n   * X coordinate\n   */\n  get x () {\n    return this.atomStore.x[ this.index ]\n  }\n  set x (value) {\n    this.atomStore.x[ this.index ] = value\n  }\n\n  /**\n   * Y coordinate\n   */\n  get y () {\n    return this.atomStore.y[ this.index ]\n  }\n  set y (value) {\n    this.atomStore.y[ this.index ] = value\n  }\n\n  /**\n   * Z coordinate\n   */\n  get z () {\n    return this.atomStore.z[ this.index ]\n  }\n  set z (value) {\n    this.atomStore.z[ this.index ] = value\n  }\n\n  /**\n   * Serial number\n   */\n  get serial () {\n    return this.atomStore.serial[ this.index ]\n  }\n  set serial (value) {\n    this.atomStore.serial[ this.index ] = value\n  }\n\n  /**\n   * B-factor value\n   */\n  get bfactor () {\n    return this.atomStore.bfactor[ this.index ]\n  }\n  set bfactor (value) {\n    this.atomStore.bfactor[ this.index ] = value\n  }\n\n  /**\n   * Occupancy value\n   */\n  get occupancy () {\n    return this.atomStore.occupancy[ this.index ]\n  }\n  set occupancy (value) {\n    this.atomStore.occupancy[ this.index ] = value\n  }\n\n  /**\n   * Alternate location identifier\n   */\n  get altloc () {\n    return this.atomStore.getAltloc(this.index)\n  }\n  set altloc (value) {\n    this.atomStore.setAltloc(this.index, value)\n  }\n\n  /**\n   * Partial charge\n   */\n  get partialCharge () {\n    return this.atomStore.partialCharge ? this.atomStore.partialCharge[ this.index ] : null\n  }\n  set partialCharge (value) {\n    if (this.atomStore.partialCharge) {\n      this.atomStore.partialCharge[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Explicit radius\n   */\n  get radius () {\n    return this.atomStore.radius ? this.atomStore.radius[ this.index ] : null\n  }\n  set radius (value) {\n    if (this.atomStore.radius) {\n      this.atomStore.radius[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Formal charge\n   */\n  get formalCharge () {\n    return this.atomStore.formalCharge ? this.atomStore.formalCharge[ this.index ] : null\n  }\n  set formalCharge (value) {\n    if (this.atomStore.formalCharge) {\n      this.atomStore.formalCharge[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Aromaticity flag\n   */\n  get aromatic () {\n    if (this.atomStore.aromatic) {\n      return this.atomStore.aromatic[ this.index ] as number\n    } else {\n      return this.residueType.isAromatic(this) ? 1 : 0\n    }\n  }\n  set aromatic (value) {\n    if (this.atomStore.aromatic) {\n      this.atomStore.aromatic[ this.index ] = value as number\n    }\n  }\n\n  //\n\n  get bondCount () {\n    return this.bondHash!.countArray[ this.index ]  // TODO\n  }\n\n  //\n\n  /**\n   * Iterate over each bond\n   * @param  {function(bond: BondProxy)} callback - iterator callback function\n   * @param  {BondProxy} [bp] - optional target bond proxy for use in the callback\n   * @return {undefined}\n   */\n  eachBond (callback: (bp: BondProxy) => void, bp?: BondProxy) {\n    bp = bp || this.structure._bp\n    const idx = this.index\n    const bondHash = this.bondHash!  // TODO\n    const indexArray = bondHash.indexArray\n    const n = bondHash.countArray[ idx ]\n    const offset = bondHash.offsetArray[ idx ]\n\n    for (let i = 0; i < n; ++i) {\n      bp.index = indexArray[ offset + i ]\n      callback(bp)\n    }\n  }\n\n  /**\n   * Iterate over each bonded atom\n   * @param  {function(atom: AtomProxy)} callback - iterator callback function\n   * @param  {AtomProxy} [ap] - optional target atom proxy for use in the callback\n   * @return {undefined}\n   */\n  eachBondedAtom (callback: (ap: AtomProxy) => void, _ap?: AtomProxy) {\n    const ap = _ap ? _ap : this.structure._ap\n    const idx = this.index\n\n    this.eachBond(function (bp) {\n      ap.index = idx !== bp.atomIndex1 ? bp.atomIndex1 : bp.atomIndex2\n      callback(ap)\n    })\n    this.index = idx\n  }\n\n  /**\n   * Check if this atom is bonded to the given atom,\n   * assumes both atoms are from the same structure\n   * @param  {AtomProxy} ap - the given atom\n   * @return {Boolean} whether a bond exists or not\n   */\n  hasBondTo (ap: AtomProxy) {\n    let flag = false\n    this.eachBondedAtom(function (bap) {\n      if (ap.index === bap.index) flag = true\n    })\n    return flag\n  }\n\n  bondToElementCount (element: Elements) {\n    let count = 0\n    const idx = this.index // Avoid reentrancy problems\n    this.eachBondedAtom(function (bap) {\n      if (bap.number === element) count += 1\n    })\n    this.index = idx\n    return count\n  }\n\n  hasBondToElement (element: Elements) {\n    return this.bondToElementCount(element) > 0\n  }\n\n  //\n\n  /**\n   * If atom is part of a backbone\n   * @return {Boolean} flag\n   */\n  isBackbone () {\n    const backboneIndexList = this.residueType.backboneIndexList\n    if (backboneIndexList.length > 0) {\n      return backboneIndexList.includes(this.index - this.residueAtomOffset)\n    } else {\n      return false\n    }\n  }\n\n  /**\n   * If atom is part of a polymer\n   * @return {Boolean} flag\n   */\n  isPolymer () {\n    if (this.structure.entityList.length > 0) {\n      return this.entity.isPolymer()\n    } else {\n      const moleculeType = this.residueType.moleculeType\n      return (\n        moleculeType === ProteinType ||\n        moleculeType === RnaType ||\n        moleculeType === DnaType\n      )\n    }\n  }\n\n  /**\n   * If atom is part of a sidechin\n   * @return {Boolean} flag\n   */\n  isSidechain () {\n    return this.isPolymer() && !this.isBackbone()\n  }\n\n  /**\n   * If atom is part of a coarse-grain group\n   * @return {Boolean} flag\n   */\n  isCg () {\n    const backboneType = this.residueType.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  isTrace () {\n    return this.index === (this.residueType.traceAtomIndex + this.residueAtomOffset)\n  }\n\n  /**\n   * If atom is part of a hetero group\n   * @return {Boolean} flag\n   */\n  isHetero () {\n    return this.residueType.hetero === 1\n  }\n\n  /**\n   * If atom is part of a protein molecule\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    return this.residueType.moleculeType === ProteinType\n  }\n\n  /**\n   * If atom is part of a nucleic molecule\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    const moleculeType = this.residueType.moleculeType\n    return moleculeType === RnaType || moleculeType === DnaType\n  }\n\n  /**\n   * If atom is part of a rna\n   * @return {Boolean} flag\n   */\n  isRna () {\n    return this.residueType.moleculeType === RnaType\n  }\n\n  /**\n   * If atom is part of a dna\n   * @return {Boolean} flag\n   */\n  isDna () {\n    return this.residueType.moleculeType === DnaType\n  }\n\n  /**\n   * If atom is part of a water molecule\n   * @return {Boolean} flag\n   */\n  isWater () {\n    return this.residueType.moleculeType === WaterType\n  }\n\n  /**\n   * If atom is part of an ion\n   * @return {Boolean} flag\n   */\n  isIon () {\n    return this.residueType.moleculeType === IonType\n  }\n\n  /**\n   * If atom is part of a saccharide\n   * @return {Boolean} flag\n   */\n  isSaccharide () {\n    return this.residueType.moleculeType === SaccharideType\n  }\n\n  /**\n   * If atom is part of a helix\n   * @return {Boolean} flag\n   */\n  isHelix () {\n    return SecStrucHelix.includes(this.sstruc)\n  }\n\n  /**\n   * If atom is part of a sheet\n   * @return {Boolean} flag\n   */\n  isSheet () {\n    return SecStrucSheet.includes(this.sstruc)\n  }\n\n  /**\n   * If atom is part of a turn\n   * @return {Boolean} flag\n   */\n  isTurn () {\n    return SecStrucTurn.includes(this.sstruc) && this.isProtein()\n  }\n\n  isBonded () {\n    return this.bondHash!.countArray[ this.index ] !== 0   // TODO\n  }\n\n  /**\n   * If atom is part of a ring\n   * @return {Boolean} flag\n   */\n  isRing () {\n    const atomRings = this.residueType.getRings()!.atomRings  // TODO\n    return atomRings[ this.index - this.residueAtomOffset ] !== undefined\n  }\n\n  isAromatic () {\n    return this.aromatic === 1\n  }\n\n  isPolarHydrogen () {\n    let result = false\n\n    if (this.number !== 1) return result\n\n    result = !this.hasBondToElement(Elements.C)\n\n    return result\n  }\n\n  isMetal () { return this.atomType.isMetal() }\n  isNonmetal () { return this.atomType.isNonmetal() }\n  isMetalloid () { return this.atomType.isMetalloid() }\n  isHalogen () { return this.atomType.isHalogen() }\n  isDiatomicNonmetal () { return this.atomType.isDiatomicNonmetal() }\n  isPolyatomicNonmetal () { return this.atomType.isPolyatomicNonmetal() }\n  isAlkaliMetal () { return this.atomType.isAlkaliMetal() }\n  isAlkalineEarthMetal () { return this.atomType.isAlkalineEarthMetal() }\n  isNobleGas () { return this.atomType.isNobleGas() }\n  isTransitionMetal () { return this.atomType.isTransitionMetal() }\n  isPostTransitionMetal () { return this.atomType.isPostTransitionMetal() }\n  isLanthanide () { return this.atomType.isLanthanide() }\n  isActinide () { return this.atomType.isActinide() }\n\n  getDefaultValence () { return this.atomType.getDefaultValence() }\n  getValenceList () { return this.atomType.getValenceList() }\n  getOuterShellElectronCount () { return this.atomType.getOuterShellElectronCount() }\n\n  /**\n   * Distance to another atom\n   * @param  {AtomProxy} atom - the other atom\n   * @return {Number} the distance\n   */\n  distanceTo (atom: AtomProxy) {\n    const taa = this.atomStore\n    const aaa = atom.atomStore\n    const ti = this.index\n    const ai = atom.index\n    const x = taa.x[ ti ] - aaa.x[ ai ]\n    const y = taa.y[ ti ] - aaa.y[ ai ]\n    const z = taa.z[ ti ] - aaa.z[ ai ]\n    const distSquared = x * x + y * y + z * z\n    return Math.sqrt(distSquared)\n  }\n\n  /**\n   * If connected to another atom\n   * @param  {AtomProxy} atom - the other atom\n   * @return {Boolean} flag\n   */\n  connectedTo (atom: AtomProxy) {\n    const taa = this.atomStore\n    const aaa = atom.atomStore\n    const ti = this.index\n    const ai = atom.index\n\n    if (taa.altloc && aaa.altloc) {\n      const ta = taa.altloc[ ti ]  // use Uint8 value to compare\n      const aa = aaa.altloc[ ai ]  // no need to convert to char\n      // 0 is the Null character, 32 is the space character\n      if (!(ta === 0 || aa === 0 || ta === 32 || aa === 32 || (ta === aa))) return false\n    }\n\n    const x = taa.x[ ti ] - aaa.x[ ai ]\n    const y = taa.y[ ti ] - aaa.y[ ai ]\n    const z = taa.z[ ti ] - aaa.z[ ai ]\n\n    const distSquared = x * x + y * y + z * z\n\n    // if( this.isCg() ) console.log( this.qualifiedName(), Math.sqrt( distSquared ), distSquared )\n    if (distSquared < 48.0 && this.isCg()) return true\n\n    if (isNaN(distSquared)) return false\n\n    const d = this.covalent + atom.covalent\n    const d1 = d + 0.3\n    const d2 = d - 0.5\n\n    return distSquared < (d1 * d1) && distSquared > (d2 * d2)\n  }\n\n  /**\n   * Set atom position from array\n   * @param  {Array|TypedArray} array - input array\n   * @param  {Integer} [offset] - the offset\n   * @return {AtomProxy} this object\n   */\n  positionFromArray (array: NumberArray, offset = 0) {\n    this.x = array[ offset + 0 ]\n    this.y = array[ offset + 1 ]\n    this.z = array[ offset + 2 ]\n\n    return this\n  }\n\n  /**\n   * Write atom position to array\n   * @param  {Array|TypedArray} [array] - target array\n   * @param  {Integer} [offset] - the offset\n   * @return {Array|TypedArray} target array\n   */\n  positionToArray (array: NumberArray = [], offset = 0) {\n    const index = this.index\n    const atomStore = this.atomStore\n\n    array[ offset + 0 ] = atomStore.x[ index ]\n    array[ offset + 1 ] = atomStore.y[ index ]\n    array[ offset + 2 ] = atomStore.z[ index ]\n\n    return array\n  }\n\n  /**\n   * Write atom position to vector\n   * @param  {Vector3} [v] - target vector\n   * @return {Vector3} target vector\n   */\n  positionToVector3 (v?: Vector3) {\n    if (v === undefined) v = new Vector3()\n\n    v.x = this.x\n    v.y = this.y\n    v.z = this.z\n\n    return v\n  }\n\n  /**\n   * Set atom position from vector\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionFromVector3 (v: Vector3) {\n    this.x = v.x\n    this.y = v.y\n    this.z = v.z\n\n    return this\n  }\n\n  /**\n   * Add vector to atom position\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionAdd (v: Vector3|AtomProxy) {\n    this.x += v.x\n    this.y += v.y\n    this.z += v.z\n\n    return this\n  }\n\n  /**\n   * Subtract vector from atom position\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionSub (v: Vector3|AtomProxy) {\n    this.x -= v.x\n    this.y -= v.y\n    this.z -= v.z\n\n    return this\n  }\n\n  /**\n   * Get intra group/residue bonds\n   * @param  {Boolean} firstOnly - immediately return the first connected atomIndex\n   * @return {Integer[]|Integer|undefined} connected atomIndices\n   */\n  getResidueBonds (firstOnly = false) {\n    const residueAtomOffset = this.residueAtomOffset\n    const relativeIndex = this.index - this.residueAtomOffset\n    const bonds = this.residueType.getBonds()!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    let idx1, idx2, connectedAtomIndex\n    let connectedAtomIndices: number[]|undefined\n\n    if (!firstOnly) connectedAtomIndices = []\n\n    idx1 = atomIndices1.indexOf(relativeIndex)\n    while (idx1 !== -1) {\n      connectedAtomIndex = atomIndices2[ idx1 ] + residueAtomOffset\n      if (connectedAtomIndices) {\n        connectedAtomIndices.push(connectedAtomIndex)\n        idx1 = atomIndices1.indexOf(relativeIndex, idx1 + 1)\n      } else {\n        return connectedAtomIndex\n      }\n    }\n\n    idx2 = atomIndices2.indexOf(relativeIndex)\n    while (idx2 !== -1) {\n      connectedAtomIndex = atomIndices1[ idx2 ] + residueAtomOffset\n      if (connectedAtomIndices) {\n        connectedAtomIndices.push(connectedAtomIndex)\n        idx2 = atomIndices2.indexOf(relativeIndex, idx2 + 1)\n      } else {\n        return connectedAtomIndex\n      }\n    }\n\n    return connectedAtomIndices\n  }\n\n  //\n\n  qualifiedName (noResname = false) {\n    var name = ''\n    if (this.resname && !noResname) name += '[' + this.resname + ']'\n    if (this.resno !== undefined) name += this.resno\n    if (this.inscode) name += '^' + this.inscode\n    if (this.chainname) name += ':' + this.chainname\n    if (this.atomname) name += '.' + this.atomname\n    if (this.altloc) name += '%' + this.altloc\n    if (this.structure.modelStore.count > 1) name += '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {AtomProxy} cloned atom\n   */\n  clone () {\n    return new AtomProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      residueIndex: this.residueIndex,\n\n      resname: this.resname,\n      x: this.x,\n      y: this.y,\n      z: this.z,\n      element: this.element,\n      chainname: this.chainname,\n      resno: this.resno,\n      serial: this.serial,\n      vdw: this.vdw,\n      covalent: this.covalent,\n      hetero: this.hetero,\n      bfactor: this.bfactor,\n      altloc: this.altloc,\n      atomname: this.atomname,\n      modelIndex: this.modelIndex\n    }\n  }\n}\n\nexport default AtomProxy\n","/**\n * @file Kdtree\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport _Kdtree from '../utils/kdtree'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\n\nfunction euclideanDistSq(a: number[], b: number[]) {\n  const dx = a[0] - b[0]\n  const dy = a[1] - b[1]\n  const dz = a[2] - b[2]\n  return dx * dx + dy * dy + dz * dz\n}\n\nfunction euclideanDist(a: number[], b: number[]) {\n  return Math.sqrt(euclideanDistSq(a, b))\n}\n\nconst pointArray = new Float32Array(3)\n\nclass Kdtree {\n  points: Float32Array\n  atomIndices: Uint32Array\n  kdtree: _Kdtree\n\n  constructor(structure: Structure|ResidueProxy, useSquaredDist = false) {\n    if (Debug) Log.time('Kdtree build')\n\n    const metric = useSquaredDist ? euclideanDistSq : euclideanDist\n\n    const points = new Float32Array(structure.atomCount * 3)\n    const atomIndices = new Uint32Array(structure.atomCount)\n    let i = 0\n\n    structure.eachAtom(function (ap) {\n      points[ i + 0 ] = ap.x\n      points[ i + 1 ] = ap.y\n      points[ i + 2 ] = ap.z\n      atomIndices[ i / 3 ] = ap.index\n      i += 3\n    })\n\n    this.atomIndices = atomIndices\n    this.points = points\n    this.kdtree = new _Kdtree(points, metric)\n\n    if (Debug) Log.timeEnd('Kdtree build')\n\n      // console.log(\"this.kdtree.verify()\", this.kdtree.verify())\n  }\n\n  nearest (point: number[]|Vector3, maxNodes: number, maxDistance: number) {\n    // Log.time( \"Kdtree nearest\" );\n\n    if (point instanceof Vector3) {\n      point.toArray(pointArray as any)\n    } else if (point instanceof AtomProxy) {\n      point.positionToArray(pointArray)\n    }\n\n    const nodeList = this.kdtree.nearest(pointArray, maxNodes, maxDistance)\n\n    const indices = this.kdtree.indices\n    const nodes = this.kdtree.nodes\n    const atomIndices = this.atomIndices\n    const resultList = []\n\n    for (let i = 0, n = nodeList.length; i < n; ++i) {\n      const d = nodeList[ i ]\n      const nodeIndex = d[ 0 ]\n      const dist = d[ 1 ]\n\n      resultList.push({\n        index: atomIndices[ indices[ nodes[ nodeIndex ] ] ],\n        distance: dist\n      })\n    }\n\n    // Log.timeEnd( \"Kdtree nearest\" );\n\n    return resultList\n  }\n}\n\nexport default Kdtree\n","/**\n * @file Symmetry Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const SymOpCode: { [k: string]: string } = {\n  ' ': 'X',\n  '!': 'Y',\n  '#': 'Z',\n  '$': '-X',\n  '%': '-Y',\n  '&': '-Z',\n  \"'\": 'Y+1/2',\n  '(': '1/2+X',\n  ')': '1/2+Y',\n  '*': '1/2-X',\n  '+': '1/2+Z',\n  ',': '1/2-Y',\n  '-': '1/2-Z',\n  '.': 'X+1/2',\n  '/': 'Z+1/2',\n  '0': '-X+1/2',\n  '1': '-Y+1/2',\n  '2': '-Z+1/2',\n  '3': '1/4+X',\n  '4': '1/4-Y',\n  '5': '1/4+Z',\n  '6': '1/4-X',\n  '7': '1/4+Y',\n  '8': '3/4-Y',\n  '9': '3/4+Z',\n  ':': '3/4+Y',\n  ';': '3/4+X',\n  '<': '3/4-X',\n  '=': '1/4-Z',\n  '>': '3/4-Z',\n  '?': 'X-Y',\n  '@': 'Y-X',\n  'A': 'Z+1/3',\n  'B': 'Z+2/3',\n  'C': 'X+2/3',\n  'D': 'Y+1/3',\n  'E': '-Y+2/3',\n  'F': 'X-Y+1/3',\n  'G': 'Y-X+2/3',\n  'H': '-X+1/3',\n  'I': 'X+1/3',\n  'J': 'Y+2/3',\n  'K': '-Y+1/3',\n  'L': 'X-Y+2/3',\n  'M': 'Y-X+1/3',\n  'N': '-X+2/3',\n  'O': '2/3+X',\n  'P': '1/3+Y',\n  'Q': '1/3+Z',\n  'R': '2/3-Y',\n  'S': '1/3+X-Y',\n  'T': '2/3+Y-X',\n  'U': '1/3-X',\n  'V': '2/3-X',\n  'W': '1/3-Y',\n  'X': '1/3-Z',\n  'Y': '2/3+Y',\n  'Z': '1/3+Y-X',\n  '[': '2/3+X-Y',\n  ']': '1/3+X',\n  '^': '2/3+Z',\n  '_': '2/3-Z',\n  '`': '5/6+Z',\n  'a': '1/6+Z',\n  'b': '5/6-Z',\n  'c': '1/6-Z',\n  'd': 'Z+5/6',\n  'e': 'Z+1/6',\n  'f': 'Z+1/4',\n  'g': '+Y'\n}\n\n// encoded, originally from CCP4 symop.lib\nexport const EncodedSymOp: { [k: string]: string } = {\n  'P 1': ' !#',\n  'P -1': ' !#$%&',\n  'P 1 2 1': ' !#$!&',\n  'P 1 21 1': \" !#$'&\",\n  'C 1 2 1': ' !#$!&()#*)&',\n  'P 1 m 1': ' !# %#',\n  'P 1 c 1': ' !# %+',\n  'C 1 m 1': ' !# %#()#(,#',\n  'C 1 c 1': ' !# %+()#(,+',\n  'P 1 2/m 1': ' !# %#$!&$%&',\n  'P 1 21/m 1': ' !#$)&$%& ,#',\n  'C 1 2/m 1': ' !# %#$!&$%&()#(,#*)&*,&',\n  'P 1 2/c 1': ' !#$!-$%& %+',\n  'P 1 21/c 1': ' !#$%&$)- ,+',\n  'C 1 2/c 1': ' !#$!-$%& %+()#*)-*,&(,+',\n  'P 2 2 2': ' !#$%#$!& %&',\n  'P 2 2 21': ' !#$%+$!- %&',\n  'P 21 21 2': ' !#$%#*)&(,&',\n  'P 21 21 21': ' !#*%+$)-(,&',\n  'C 2 2 21': ' !#$%+$!- %&()#*,+*)-(,&',\n  'C 2 2 2': ' !#$%#$!& %&()#*,#*)&(,&',\n  'F 2 2 2': ' !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&',\n  'I 2 2 2': \" !#$%# %&$!&.'/01/.120'2\",\n  'I 21 21 21': ' !#*%+$)-(,&()+$,#*!& %-',\n  'P m m 2': ' !#$%# %#$!#',\n  'P m c 21': ' !#$%+ %+$!#',\n  'P c c 2': ' !#$%# %+$!+',\n  'P m a 2': ' !#$%#(%#*!#',\n  'P c a 21': ' !#$%+(%#*!+',\n  'P n c 2': ' !#$%# ,+$)+',\n  'P m n 21': ' !#*%+(%+$!#',\n  'P b a 2': ' !#$%#(,#*)#',\n  'P n a 21': ' !#$%+(,#*)+',\n  'P n n 2': ' !#$%#(,+*)+',\n  'C m m 2': ' !#$%# %#$!#()#*,#(,#*)#',\n  'C m c 21': ' !#$%+ %+$!#()#*,+(,+*)#',\n  'C c c 2': ' !#$%# %+$!+()#*,#(,+*)+',\n  'A m m 2': ' !#$%# %#$!# )+$,+ ,+$)+',\n  'A b m 2': ' !#$%# ,#$)# )+$,+ %+$!+',\n  'A m a 2': ' !#$%#(%#*!# )+$,+(,+*)+',\n  'A b a 2': ' !#$%#(,#*)# )+$,+(%+*!+',\n  'F m m 2': ' !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#',\n  'F d d 2': ' !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5',\n  'I m m 2': ' !#$%# %#$!#()+*,+(,+*)+',\n  'I b a 2': ' !#$%#(,#*)#()+*,+ %+$!+',\n  'I m a 2': ' !#$%#(%#*!#()+*,+ ,+$)+',\n  'P 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#',\n  'P 2/n 2/n 2/n': ' !#$%#$!& %&*,-()-(,+*)+',\n  'P 2/c 2/c 2/m': ' !#$%#$!- %-$%& !& %+$!+',\n  'P 2/b 2/a 2/n': ' !#$%#$!& %&*,&()&(,#*)#',\n  'P 21/m 2/m 2/a': ' !#*%#$!&(%&$%&(!& %#*!#',\n  'P 2/n 21/n 2/a': ' !#*%#*)- ,-$%&(!&(,+$)+',\n  'P 2/m 2/n 21/a': ' !#*%+*!- %&$%&(!-(%+$!#',\n  'P 21/c 2/c 2/a': ' !#*%#$!-(%-$%&(!& %+*!+',\n  'P 21/b 21/a 2/m': ' !#$%#*)&(,&$%& !&(,#*)#',\n  'P 21/c 21/c 2/n': ' !#*,#$)-(%-$%&()& ,+*!+',\n  'P 2/b 21/c 21/m': ' !#$%+$)- ,&$%& !- ,+$)#',\n  'P 21/n 21/n 2/m': ' !#$%#*)-(,-$%& !&(,+*)+',\n  'P 21/m 21/m 2/n': \" !#$%#*'&.,&*,&.'& %#$!#\",\n  'P 21/b 2/c 21/n': ' !#*,+$!-(,&$%&()- %+*)#',\n  'P 21/b 21/c 21/a': ' !#*%+$)-(,&$%&(!- ,+*)#',\n  'P 21/n 21/m 21/a': \" !#0%/$'&.12$%&.!2 1#0'/\",\n  'C 2/m 2/c 21/m': ' !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#',\n  'C 2/m 2/c 21/a': ' !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#',\n  'C 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#',\n  'C 2/c 2/c 2/m': ' !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+',\n  'C 2/m 2/m 2/a': ' !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#',\n  'C 2/c 2/c 2/a': ' !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+',\n  'F 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#',\n  'F 2/d 2/d 2/d': ' !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5',\n  'I 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+',\n  'I 2/b 2/a 2/m': ' !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+',\n  'I 21/b 21/c 21/a': ' !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+',\n  'I 21/m 21/m 21/a': ' !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+',\n  'P 4': ' !#$%#% #!$#',\n  'P 41': ' !#$%+% 5!$9',\n  'P 42': ' !#$%#% +!$+',\n  'P 43': ' !#$%+% 9!$5',\n  'I 4': ' !#$%#% #!$#()+*,+,(+)*+',\n  'I 41': ' !#*,+%(5)$9()+$%#, 9!*5',\n  'P -4': ' !#$%#!$&% &',\n  'I -4': ' !#$%#!$&% &()+*,+)*-,(-',\n  'P 4/m': ' !#$%#% #!$#$%& !&!$&% &',\n  'P 42/m': ' !#$%#% +!$+$%& !&!$-% -',\n  'P 4/n': ' !#$%#,(#)*#*,&()&!$&% &',\n  'P 42/n': ' !#$%#,(+)*+*,-()-!$&% &',\n  'I 4/m': ' !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-',\n  'I 41/a': ' !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &',\n  'P 4 2 2': ' !#$%#% #!$#$!& %&! &%$&',\n  'P 4 21 2': ' !#$%#,(#)*#*)&(,&! &%$&',\n  'P 41 2 2': ' !#$%+% 5!$9$!& %-! >%$=',\n  'P 41 21 2': ' !#$%+,(5)*9*)=(,>! &%$-',\n  'P 42 2 2': ' !#$%#% +!$+$!& %&! -%$-',\n  'P 42 21 2': ' !#$%#,(+)*+*)-(,-! &%$&',\n  'P 43 2 2': ' !#$%+% 9!$5$!& %-! =%$>',\n  'P 43 21 2': ' !#$%+,(9)*5*)>(,=! &%$-',\n  'I 4 2 2': ' !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-',\n  'I 41 2 2': ' !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-',\n  'P 4 m m': ' !#$%#% #!$# %#$!#%$#! #',\n  'P 4 b m': ' !#$%#% #!$#(,#*)#,*#)(#',\n  'P 42 c m': ' !#$%#% +!$+ %+$!+%$#! #',\n  'P 42 n m': ' !#$%#,(+)*+(,+*)+%$#! #',\n  'P 4 c c': ' !#$%#% #!$# %+$!+%$+! +',\n  'P 4 n c': ' !#$%#% #!$#(,+*)+,*+)(+',\n  'P 42 m c': ' !#$%#% +!$+ %#$!#%$+! +',\n  'P 42 b c': ' !#$%#% +!$+(,#*)#,*+)(+',\n  'I 4 m m': ' !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+',\n  'I 4 c m': ' !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#',\n  'I 41 m d': ' !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5',\n  'I 41 c d': ' !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9',\n  'P -4 2 m': ' !#$%#% &!$&$!& %&%$#! #',\n  'P -4 2 c': ' !#$%#% &!$&$!- %-%$+! +',\n  'P -4 21 m': ' !#$%#% &!$&*)&(,&,*#)(#',\n  'P -4 21 c': ' !#$%#% &!$&*)-(,-,*+)(+',\n  'P -4 m 2': ' !#$%#!$&% & %#$!#! &%$&',\n  'P -4 c 2': ' !#$%#% &!$& %+$!+! -%$-',\n  'P -4 b 2': ' !#$%#% &!$&(,#*)#)(&,*&',\n  'P -4 n 2': ' !#$%#% &!$&(,+*)+)(-,*-',\n  'I -4 m 2': ' !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-',\n  'I -4 c 2': ' !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&',\n  'I -4 2 m': ' !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+',\n  'I -4 2 d': ' !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5',\n  'P 4/m 2/m 2/m': ' !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #',\n  'P 4/m 2/c 2/c': ' !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +',\n  'P 4/n 2/b 2/m': ' !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#',\n  'P 4/n 2/n 2/c': ' !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+',\n  'P 4/m 21/b 2/m': ' !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#',\n  'P 4/m 21/n 2/c': ' !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+',\n  'P 4/n 21/m 2/m': ' !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#',\n  'P 4/n 2/c 2/c': ' !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+',\n  'P 42/m 2/m 2/c': ' !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +',\n  'P 42/m 2/c 2/m': ' !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #',\n  'P 42/n 2/b 2/c': ' !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +',\n  'P 42/n 2/n 2/m': ' !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #',\n  'P 42/m 21/b 2/c': ' !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+',\n  'P 42/m 21/n 2/m': \" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #\",\n  'P 42/n 21/m 2/c': ' !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+',\n  'P 42/n 21/c 2/m': ' !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#',\n  'I 4/m 2/m 2/m': ' !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+',\n  'I 4/m 2/c 2/m': ' !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#',\n  'I 41/a 2/m 2/d': ' !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9',\n  'I 41/a 2/c 2/d': ' !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5',\n  'P 3': ' !#%?#@$#',\n  'P 31': ' !#%?A@$B',\n  'P 32': ' !#%?B@$A',\n  'H 3': ' !#%?#@$#CDAEFAGHAIJBKLBMNB',\n  'R 3': ' !## !!# ',\n  'P -3': ' !#%?#@$#$%&!@&? &',\n  'H -3': ' !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_',\n  'R -3': ' !## !!# $%&&$%%&$',\n  'P 3 1 2': ' !#%?#@$#%$&@!& ?&',\n  'P 3 2 1': ' !#%?#@$#! &?%&$@&',\n  'P 31 1 2': ' !#%?Q@$^%$_@!X ?&',\n  'P 31 2 1': ' !#%?A@$B! &?%_$@X',\n  'P 32 1 2': ' !#%?^@$Q%$X@!_ ?&',\n  'P 32 2 1': ' !#%?B@$A! &?%X$@_',\n  'H 3 2': ' !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_',\n  'R 3 2': ' !## !!# %$&$&%&%$',\n  'P 3 m 1': ' !#%?#@$#%$#@!# ?#',\n  'P 3 1 m': ' !#%?#@$#! #?%#$@#',\n  'P 3 c 1': ' !#%?#@$#%$+@!+ ?+',\n  'P 3 1 c': ' !#%?#@$#! +?%+$@+',\n  'H 3 m': ' !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^',\n  'R 3 m': ' !## !!# ! # #!#! ',\n  'H 3 c': ' !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a',\n  'R 3 c': \" !## !!# '././'/'.\",\n  'P -3 1 2/m': ' !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#',\n  'P -3 1 2/c': ' !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+',\n  'P -3 2/m 1': ' !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#',\n  'P -3 2/c 1': ' !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+',\n  'H -3 2/m': ' !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^',\n  'R -3 2/m': ' !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ',\n  'H -3 2/c': ' !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a',\n  'R -3 2/c': \" !## !!# 102021210$%&&$%%&$'././'/'.\",\n  'P 6': ' !#%?#@$#$%#!@#? #',\n  'P 61': ' !#%?A@$B$%/!@d? e',\n  'P 65': ' !#%?B@$A$%/!@e? d',\n  'P 62': ' !#%?^@$Q$%#!@^? Q',\n  'P 64': ' !#%?Q@$^$%#!@Q? ^',\n  'P 63': ' !#%?#@$#$%+!@+? +',\n  'P -6': ' !#%?#@$# !&%?&@$&',\n  'P 6/m': ' !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&',\n  'P 63/m': ' !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-',\n  'P 6 2 2': ' !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&',\n  'P 61 2 2': ' !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c',\n  'P 65 2 2': ' !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b',\n  'P 62 2 2': ' !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X',\n  'P 64 2 2': ' !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_',\n  'P 63 2 2': ' !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-',\n  'P 6 m m': ' !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#',\n  'P 6 c c': ' !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+',\n  'P 63 c m': ' !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#',\n  'P 63 m c': ' !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+',\n  'P -6 m 2': ' !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&',\n  'P -6 c 2': ' !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&',\n  'P -6 2 m': ' !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#',\n  'P -6 2 c': ' !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+',\n  'P 6/m 2/m 2/m': ' !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#',\n  'P 6/m 2/c 2/c': ' !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+',\n  'P 63/m 2/c 2/m': ' !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#',\n  'P 63/m 2/m 2/c': ' !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+',\n  'P 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ',\n  'F 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ',\n  'I 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(',\n  'P 21 3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(',\n  'I 21 3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ',\n  'P 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$',\n  'P 2/n -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*',\n  'F 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$',\n  'F 2/d -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96',\n  'I 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*',\n  'P 21/a -3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*',\n  'I 21/a -3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$',\n  'P 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$',\n  'P 42 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*',\n  'F 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$',\n  'F 41 3 2': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86',\n  'I 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*',\n  'P 43 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46',\n  'P 41 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<',\n  'I 41 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46',\n  'P -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ',\n  'F -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ',\n  'I -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(',\n  'P -4 3 n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(',\n  'F -4 3 c': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(',\n  'I -4 3 d': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43',\n  'P 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ',\n  'P 4/n -3 2/n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'P 42/m -3 2/n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'P 42/n -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ',\n  'F 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ',\n  'F 4/m -3 2/c': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(',\n  'F 41/d -3 2/m': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ',\n  'F 41/d -3 2/c': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(',\n  'I 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'I 41/a -3 2/d': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;',\n  'P 1 1 2': ' !#$%#',\n  'P 1 1 21': ' !#$%+',\n  'B 1 1 2': ' !#$%#(g+*%+',\n  'A 1 2 1': ' !#$!& )+$)-',\n  'C 1 21 1': ' !#$)&()#*!&',\n  'I 1 2 1': \" !#$!&.'/0'2\",\n  'I 1 21 1': \" !#$)&.'/0!-\",\n  'P 1 1 m': ' !# !&',\n  'P 1 1 b': ' !# )&',\n  'B 1 1 m': ' !# !&(!+(!-',\n  'B 1 1 b': ' !# )&(!+()-',\n  'P 1 1 2/m': ' !# !&$%#$%&',\n  'P 1 1 21/m': ' !#$%+$%& !-',\n  'B 1 1 2/m': ' !# !&$%#$%&(!+(!-*%+*%-',\n  'P 1 1 2/b': ' !#$,#$%& )&',\n  'P 1 1 21/b': ' !#$%&$,+ )-',\n  'B 1 1 2/b': ' !#$,#$%& )&(!+*,+*%-()-',\n  'P 21 2 2': ' !#$!&(%&*%#',\n  'P 2 21 2': ' !# ,&$)&$%#',\n  'P 21 21 2 (a)': \" !#*,#.%&$'&\",\n  'P 21 2 21': ' !#$!&(%-*%+',\n  'P 2 21 21': ' !# %&$)-$,+',\n  'C 2 2 21a)': ' !#*%+(,&$)-()#$,+ %&*!-',\n  'C 2 2 2a': \" !#*,#.%&$'&()#$%# ,&*!&\",\n  'F 2 2 2a': \" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&\",\n  'I 2 2 2a': \" !#*,#.%&$'&()+$%+*!- ,-\",\n  'P 21/m 21/m 2/n a': \" !#*,#$)&(%&$%&.'& ,#*!#\",\n  'P 42 21 2a': \" !#*,#%.+'$+$'&.%&! -,*-\",\n  'I 2 3a': \" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,\"\n}\n","/**\n * @file Symmetry Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Log } from '../globals'\nimport { EncodedSymOp, SymOpCode } from './symmetry-constants'\n\nconst reInteger = /^[1-9]$/\n\nexport function getSymmetryOperations (spacegroup: string) {\n  const encodedSymopList = EncodedSymOp[ spacegroup ]\n  const matrixDict: { [k: string]: Matrix4 } = {}\n\n  if (encodedSymopList === undefined) {\n    console.warn(`spacegroup '${spacegroup}' not found in symop library`)\n    return matrixDict\n  }\n\n  const symopList = []\n  for (let i = 0, il = encodedSymopList.length; i < il; i += 3) {\n    const symop = []\n    for (let j = 0; j < 3; ++j) {\n      symop.push(SymOpCode[ encodedSymopList[ i + j ] ])\n    }\n    symopList.push(symop)\n  }\n\n  symopList.forEach(function (symop) {\n    let row = 0\n    const matrix = new Matrix4().set(\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 1\n    )\n    const me = matrix.elements\n\n    matrixDict[ symop.toString() ] = matrix\n\n    symop.forEach(function (elm) {\n      let negate = false\n      let denominator = false\n\n      for (let i = 0, n = elm.length; i < n; ++i) {\n        const c = elm[ i ]\n\n        if (c === '-') {\n          negate = true\n        } else if (c === '+') {\n          negate = false\n        } else if (c === '/') {\n          denominator = true\n        } else if (c === 'X') {\n          me[ 0 + row ] = negate ? -1 : 1\n        } else if (c === 'Y') {\n          me[ 4 + row ] = negate ? -1 : 1\n        } else if (c === 'Z') {\n          me[ 8 + row ] = negate ? -1 : 1\n        } else if (reInteger.test(c)) {\n          const integer = parseInt(c)\n          if (denominator) {\n            me[ 12 + row ] /= integer\n          } else {\n            me[ 12 + row ] = integer\n          }\n        } else {\n          Log.warn(`getSymmetryOperations: unknown token '${c}'`)\n        }\n      }\n\n      row += 1\n    })\n  })\n\n  return matrixDict\n}\n","/**\n * @file Assembly\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Box3, Vector3 } from 'three'\n\nimport { uniqueArray } from '../utils'\nimport Selection from '../selection/selection'\nimport Structure from '../structure/structure'\nimport StructureView from '../structure/structure-view';\n\nfunction selectionFromChains (chainList: string[]) {\n  let sele = ''\n  if (chainList.length > 0) {\n    sele = ':' + uniqueArray(chainList).join(' OR :')\n  }\n  return new Selection(sele)\n}\n\n/**\n * Assembly of transformed parts of a {@link Structure}\n */\nclass Assembly {\n  partList: AssemblyPart[] = []\n\n  /**\n   * @param {String} name - assembly name\n   */\n  constructor (readonly name = '') {}\n\n  get type () { return 'Assembly' }\n\n  /**\n   * Add transformed parts to the assembly\n   * @example\n   * var m1 = new NGL.Matrix4().set( ... );\n   * var m2 = new NGL.Matrix4().set( ... );\n   * var assembly = new NGL.Assembly( \"myAssembly\" );\n   * // add part that transforms chain 'A' and 'B' using matrices `m1` and `m2`\n   * assembly.addPart( [ m1, m2 ], [ \"A\", \"B\" ] )\n   *\n   * @param {Matrix4[]} matrixList - array of 4x4 transformation matrices\n   * @param {String[]} chainList - array of chain names\n   * @return {AssemblyPart} the added assembly part\n   */\n  addPart (matrixList?: Matrix4[], chainList?: string[]) {\n    const part = new AssemblyPart(matrixList, chainList)\n    this.partList.push(part)\n    return part\n  }\n\n  /**\n   * Get the number of atom for a given structure\n   * @param  {Structure} structure - the given structure\n   * @return {Integer} number of atoms in the assembly\n   */\n  getAtomCount (structure: Structure) {\n    return this.partList.reduce(\n      (count, part) => count + part.getAtomCount(structure), 0\n    )\n  }\n\n  /**\n   * Get the number of residues for a given structure\n   * @param  {Structure} structure - the given structure\n   * @return {Integer} number of residues in the assembly\n   */\n  getResidueCount (structure: Structure) {\n    return this.partList.reduce(\n      (count, part) => count + part.getResidueCount(structure), 0\n    )\n  }\n\n  /**\n   * Get number of instances the assembly will produce, i.e.\n   * the number of transformations performed by the assembly\n   * @return {Integer} number of instances\n   */\n  getInstanceCount () {\n    let instanceCount = 0\n\n    this.partList.forEach(function (part) {\n      instanceCount += part.matrixList.length\n    })\n\n    return instanceCount\n  }\n\n  /**\n   * Determine if the assembly is the full and untransformed structure\n   * @param  {Structure}  structure - the given structure\n   * @return {Boolean} whether the assembly is identical to the structure\n   */\n  isIdentity (structure: Structure) {\n    if (this.partList.length !== 1) return false\n\n    const part = this.partList[ 0 ]\n    if (part.matrixList.length !== 1) return false\n\n    const identityMatrix = new Matrix4()\n    if (!identityMatrix.equals(part.matrixList[ 0 ])) return false\n\n    let structureChainList: string[] = []\n    structure.eachChain(function (cp) {\n      structureChainList.push(cp.chainname)\n    })\n    structureChainList = uniqueArray(structureChainList)\n    if (part.chainList.length !== structureChainList.length) return false\n\n    return true\n  }\n\n  getBoundingBox (structure: Structure) {\n    const boundingBox = new Box3()\n\n    this.partList.forEach(function (part) {\n      const partBox = part.getBoundingBox(structure)\n      boundingBox.expandByPoint(partBox.min)\n      boundingBox.expandByPoint(partBox.max)\n    })\n\n    return boundingBox\n  }\n\n  getCenter (structure: Structure) {\n    return this.getBoundingBox(structure).getCenter(new Vector3())\n  }\n\n  getSelection () {\n    let chainList: string[] = []\n    this.partList.forEach(function (part) {\n      chainList = chainList.concat(part.chainList)\n    })\n    return selectionFromChains(chainList)\n  }\n}\n\nexport class AssemblyPart {\n  constructor (readonly matrixList: Matrix4[] = [], readonly chainList: string[] = []) {}\n\n  get type () { return 'AssemblyPart' }\n\n  _getCount (structure: Structure, propertyName: 'atomCount'|'residueCount') {\n    let count = 0\n\n    structure.eachChain(cp => {\n      if (this.chainList.length === 0 || this.chainList.includes(cp.chainname)) {\n        count += cp[ propertyName ]\n      }\n    })\n\n    return this.matrixList.length * count\n  }\n\n  getAtomCount (structure: Structure) {\n    return this._getCount(structure, 'atomCount')\n  }\n\n  getResidueCount (structure: Structure) {\n    return this._getCount(structure, 'residueCount')\n  }\n\n  getBoundingBox (structure: Structure) {\n    const partBox = new Box3()\n    const instanceBox = new Box3()\n\n    const selection = this.getSelection()\n    const structureBox = structure.getBoundingBox(selection)\n\n    this.matrixList.forEach(function (matrix) {\n      instanceBox.copy(structureBox).applyMatrix4(matrix)\n      partBox.expandByPoint(instanceBox.min)\n      partBox.expandByPoint(instanceBox.max)\n    })\n\n    return partBox\n  }\n\n  getSelection () {\n    return selectionFromChains(this.chainList)\n  }\n\n  getView (structure: Structure): Structure | StructureView {\n    const selection = this.getSelection()\n    if (selection) {\n      return structure.getView(selection)\n    } else {\n      return structure\n    }\n  }\n\n  getInstanceList () {\n    const instanceList = []\n    for (let j = 0, jl = this.matrixList.length; j < jl; ++j) {\n      instanceList.push({\n        id: j + 1,\n        name: j,\n        matrix: this.matrixList[ j ]\n      })\n    }\n    return instanceList\n  }\n}\n\nexport default Assembly\n","/**\n * @file Structure Builder\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from './structure'\n\nclass StructureBuilder {\n  currentModelindex: number|null = null\n  currentChainid: string|null = null\n  currentResname: string|null = null\n  currentResno: number|null = null\n  currentInscode: string|undefined = undefined\n  currentHetero: boolean|null = null\n\n  previousResname: string|null = ''\n  previousHetero: boolean|null = null\n\n  ai = -1\n  ri = -1\n  ci = -1\n  mi = -1\n\n  constructor(readonly structure: Structure) {}\n\n  addResidueType (ri: number) {\n    const atomStore = this.structure.atomStore\n    const residueStore = this.structure.residueStore\n    const residueMap = this.structure.residueMap\n    const cc = this.structure.chemCompMap?.dict[this.previousResname!]\n\n    const count = residueStore.atomCount[ ri ]\n    const offset = residueStore.atomOffset[ ri ]\n    const atomTypeIdList = new Array(count)\n    for (let i = 0; i < count; ++i) {\n      atomTypeIdList[ i ] = atomStore.atomTypeId[ offset + i ]\n    }\n    const chemCompType = cc?.chemCompType\n    const bonds = cc ? this.structure.chemCompMap?.getBonds(this.previousResname!, atomTypeIdList) : undefined\n    residueStore.residueTypeId[ ri ] = residueMap.add(\n      this.previousResname!, atomTypeIdList, this.previousHetero!, chemCompType, bonds\n    )\n  }\n\n  addAtom (modelindex: number, chainname: string, chainid: string, resname: string, resno: number, hetero: boolean, sstruc?: string|undefined, inscode?: string|undefined) {\n    const atomStore = this.structure.atomStore\n    const residueStore = this.structure.residueStore\n    const chainStore = this.structure.chainStore\n    const modelStore = this.structure.modelStore\n\n    let addModel = false\n    let addChain = false\n    let addResidue = false\n\n    if (this.currentModelindex !== modelindex) {\n      addModel = true\n      addChain = true\n      addResidue = true\n      this.mi += 1\n      this.ci += 1\n      this.ri += 1\n    } else if (this.currentChainid !== chainid) {\n      addChain = true\n      addResidue = true\n      this.ci += 1\n      this.ri += 1\n    } else if (this.currentResno !== resno || this.currentResname !== resname || this.currentInscode !== inscode) {\n      addResidue = true\n      this.ri += 1\n    }\n    this.ai += 1\n\n    if (addModel) {\n      modelStore.growIfFull()\n      modelStore.chainOffset[ this.mi ] = this.ci\n      modelStore.chainCount[ this.mi ] = 0\n      modelStore.count += 1\n      chainStore.modelIndex[ this.ci ] = this.mi\n    }\n\n    if (addChain) {\n      chainStore.growIfFull()\n      chainStore.setChainname(this.ci, chainname)\n      chainStore.setChainid(this.ci, chainid)\n      chainStore.residueOffset[ this.ci ] = this.ri\n      chainStore.residueCount[ this.ci ] = 0\n      chainStore.count += 1\n      chainStore.modelIndex[ this.ci ] = this.mi\n      modelStore.chainCount[ this.mi ] += 1\n      residueStore.chainIndex[ this.ri ] = this.ci\n    }\n\n    if (addResidue) {\n      this.previousResname = this.currentResname\n      this.previousHetero = this.currentHetero\n      if (this.ri > 0) this.addResidueType(this.ri - 1)\n      residueStore.growIfFull()\n      residueStore.resno[ this.ri ] = resno\n      if (sstruc !== undefined) {\n        residueStore.sstruc[ this.ri ] = sstruc.charCodeAt(0)\n      }\n      if (inscode !== undefined) {\n        residueStore.inscode[ this.ri ] = inscode.charCodeAt(0)\n      }\n      residueStore.atomOffset[ this.ri ] = this.ai\n      residueStore.atomCount[ this.ri ] = 0\n      residueStore.count += 1\n      residueStore.chainIndex[ this.ri ] = this.ci\n      chainStore.residueCount[ this.ci ] += 1\n    }\n\n    atomStore.count += 1\n    atomStore.residueIndex[ this.ai ] = this.ri\n    residueStore.atomCount[ this.ri ] += 1\n\n    this.currentModelindex = modelindex\n    this.currentChainid = chainid\n    this.currentResname = resname\n    this.currentResno = resno\n    this.currentInscode = inscode\n    this.currentHetero = hetero\n  }\n\n  finalize () {\n    this.previousResname = this.currentResname\n    this.previousHetero = this.currentHetero\n    if (this.ri > -1) this.addResidueType(this.ri)\n  }\n}\n\nexport default StructureBuilder\n","/**\n * @file Structure Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport { binarySearchIndexOf } from '../utils'\nimport Helixbundle from '../geometry/helixbundle'\nimport Kdtree from '../geometry/kdtree'\nimport { getSymmetryOperations } from '../symmetry/symmetry-utils'\nimport Assembly from '../symmetry/assembly'\nimport Structure from '../structure/structure'\nimport StructureBuilder from '../structure/structure-builder'\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\n\nimport { UnknownBackboneType, AA3, Bases, AtomicNumbers } from './structure-constants'\n\nexport function reorderAtoms (structure: Structure) {\n  if (Debug) Log.time('reorderAtoms')\n\n  var ap1 = structure.getAtomProxy()\n  var ap2 = structure.getAtomProxy()\n\n  function compareModelChainResno (index1: number, index2: number) {\n    ap1.index = index1\n    ap2.index = index2\n    if (ap1.modelIndex < ap2.modelIndex) {\n      return -1\n    } else if (ap1.modelIndex > ap2.modelIndex) {\n      return 1\n    } else {\n      if (ap1.chainname < ap2.chainname) {\n        return -1\n      } else if (ap1.chainname > ap2.chainname) {\n        return 1\n      } else {\n        if (ap1.resno < ap2.resno) {\n          return -1\n        } else if (ap1.resno > ap2.resno) {\n          return 1\n        } else {\n          return 0\n        }\n      }\n    }\n  }\n\n  structure.atomStore.sort(compareModelChainResno)\n\n  if (Debug) Log.timeEnd('reorderAtoms')\n}\n\nexport interface SecStruct {\n  helices: [string, number, string, string, number, string, number][]\n  sheets: [string, number, string, string, number, string][]\n}\n\nexport function assignSecondaryStructure (structure: Structure, secStruct: SecStruct) {\n  if (!secStruct) return\n\n  if (Debug) Log.time('assignSecondaryStructure')\n\n  const chainnames: string[] = []\n  structure.eachModel(function (mp) {\n    mp.eachChain(function (cp) {\n      chainnames.push(cp.chainname)\n    })\n  })\n\n  const chainnamesSorted = chainnames.slice().sort()\n  const chainnamesIndex: number[] = []\n  chainnamesSorted.forEach(function (c) {\n    chainnamesIndex.push(chainnames.indexOf(c))\n  })\n\n    // helix assignment\n\n  const helices = secStruct.helices.filter(function (h) {\n    return binarySearchIndexOf(chainnamesSorted, h[ 0 ]) >= 0\n  })\n\n  helices.sort(function (h1, h2) {\n    const c1 = h1[ 0 ]\n    const c2 = h2[ 0 ]\n    const r1 = h1[ 1 ]\n    const r2 = h2[ 1 ]\n\n    if (c1 === c2) {\n      if (r1 === r2) {\n        return 0\n      } else {\n        return r1 < r2 ? -1 : 1\n      }\n    } else {\n      const idx1 = binarySearchIndexOf(chainnamesSorted, c1)\n      const idx2 = binarySearchIndexOf(chainnamesSorted, c2)\n      return chainnamesIndex[ idx1 ] < chainnamesIndex[ idx2 ] ? -1 : 1\n    }\n  })\n\n  const residueStore = structure.residueStore\n\n  structure.eachModel(function (mp) {\n    let i = 0\n    const n = helices.length\n    if (n === 0) return\n    let helix = helices[ i ]\n    let helixRun = false\n    let done = false\n\n    mp.eachChain(function (cp) {\n      let chainChange = false\n\n      if (cp.chainname === helix[ 0 ]) {\n        const count = cp.residueCount\n        const offset = cp.residueOffset\n        const end = offset + count\n\n        for (let j = offset; j < end; ++j) {\n          if (residueStore.resno[ j ] === helix[ 1 ] &&  // resnoBeg\n              residueStore.getInscode(j) === helix[ 2 ]   // inscodeBeg\n          ) {\n            helixRun = true\n          }\n\n          if (helixRun) {\n            residueStore.sstruc[ j ] = helix[ 6 ]\n\n            if (residueStore.resno[ j ] === helix[ 4 ] &&  // resnoEnd\n                residueStore.getInscode(j) === helix[ 5 ]   // inscodeEnd\n            ) {\n              helixRun = false\n              i += 1\n\n              if (i < n) {\n                // must look at previous residues as\n                // residues may not be ordered by resno\n                j = offset - 1\n                helix = helices[ i ]\n                chainChange = cp.chainname !== helix[ 0 ]\n              } else {\n                done = true\n              }\n            }\n          }\n\n          if (chainChange || done) return\n        }\n      }\n    })\n  })\n\n    // sheet assignment\n\n  const sheets = secStruct.sheets.filter(function (s) {\n    return binarySearchIndexOf(chainnamesSorted, s[ 0 ]) >= 0\n  })\n\n  sheets.sort(function (s1, s2) {\n    const c1 = s1[ 0 ]\n    const c2 = s2[ 0 ]\n\n    if (c1 === c2) return 0\n    const idx1 = binarySearchIndexOf(chainnamesSorted, c1)\n    const idx2 = binarySearchIndexOf(chainnamesSorted, c2)\n    return chainnamesIndex[ idx1 ] < chainnamesIndex[ idx2 ] ? -1 : 1\n  })\n\n  const strandCharCode = 'e'.charCodeAt(0)\n  structure.eachModel(function (mp) {\n    let i = 0\n    const n = sheets.length\n    if (n === 0) return\n    let sheet = sheets[ i ]\n    let sheetRun = false\n    let done = false\n\n    mp.eachChain(function (cp) {\n      let chainChange = false\n\n      if (cp.chainname === sheet[ 0 ]) {\n        const count = cp.residueCount\n        const offset = cp.residueOffset\n        const end = offset + count\n\n        for (let j = offset; j < end; ++j) {\n          if (residueStore.resno[ j ] === sheet[ 1 ] &&  // resnoBeg\n              residueStore.getInscode(j) === sheet[ 2 ]   // inscodeBeg\n          ) {\n            sheetRun = true\n          }\n\n          if (sheetRun) {\n            residueStore.sstruc[ j ] = strandCharCode\n\n            if (residueStore.resno[ j ] === sheet[ 4 ] &&  // resnoEnd\n                residueStore.getInscode(j) === sheet[ 5 ]   // inscodeEnd\n            ) {\n              sheetRun = false\n              i += 1\n\n              if (i < n) {\n                // must look at previous residues as\n                // residues may not be ordered by resno\n                j = offset - 1\n                sheet = sheets[ i ]\n                chainChange = cp.chainname !== sheet[ 0 ]\n              } else {\n                done = true\n              }\n            }\n          }\n\n          if (chainChange || done) return\n        }\n      }\n    })\n  })\n\n  if (Debug) Log.timeEnd('assignSecondaryStructure')\n}\n\nexport const calculateSecondaryStructure = (function () {\n  // Implementation for proteins based on \"pv\"\n  //\n  // assigns secondary structure information based on a simple and very fast\n  // algorithm published by Zhang and Skolnick in their TM-align paper.\n  // Reference:\n  //\n  // TM-align: a protein structure alignment algorithm based on the Tm-score\n  // (2005) NAR, 33(7) 2302-2309\n\n  const zhangSkolnickSS = function (polymer: Polymer, i: number, distances: number[], delta: number) {\n    const structure = polymer.structure\n    const offset = polymer.residueIndexStart\n    const rp1 = structure.getResidueProxy()\n    const rp2 = structure.getResidueProxy()\n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n\n    for (let j = Math.max(0, i - 2); j <= i; ++j) {\n      for (let k = 2; k < 5; ++k) {\n        if (j + k >= polymer.residueCount) {\n          continue\n        }\n\n        rp1.index = offset + j\n        rp2.index = offset + j + k\n        ap1.index = rp1.traceAtomIndex\n        ap2.index = rp2.traceAtomIndex\n\n        const d = ap1.distanceTo(ap2)\n\n        if (Math.abs(d - distances[ k - 2 ]) > delta) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  const isHelical = function (polymer: Polymer, i: number) {\n    const helixDistances = [ 5.45, 5.18, 6.37 ]\n    const helixDelta = 2.1\n    return zhangSkolnickSS(polymer, i, helixDistances, helixDelta)\n  }\n\n  const isSheet = function (polymer: Polymer, i: number) {\n    const sheetDistances = [ 6.1, 10.4, 13.0 ]\n    const sheetDelta = 1.42\n    return zhangSkolnickSS(polymer, i, sheetDistances, sheetDelta)\n  }\n\n  const proteinPolymer = function (p: Polymer) {\n    const residueStore = p.residueStore\n    const offset = p.residueIndexStart\n    for (let i = 0, il = p.residueCount; i < il; ++i) {\n      let sstruc = 'c'\n      if (isHelical(p, i)) {\n        sstruc = 'h'\n      } else if (isSheet(p, i)) {\n        sstruc = 'e'\n      }\n      residueStore.sstruc[ offset + i ] = sstruc.charCodeAt(0)\n    }\n  }\n\n  const cgPolymer = function (p: Polymer) {\n    const localAngle = 20\n    const centerDist = 2.0\n\n    const residueStore = p.residueStore\n    const offset = p.residueIndexStart\n\n    const helixbundle = new Helixbundle(p)\n    const pos = helixbundle.position\n\n    const c1 = new Vector3()\n    const c2 = new Vector3()\n\n    for (let i = 0, il = p.residueCount; i < il; ++i) {\n      c1.fromArray(pos.center as any, i * 3)  // TODO\n      c2.fromArray(pos.center as any, i * 3 + 3)  // TODO\n      const d = c1.distanceTo(c2)\n\n      if (d < centerDist && d > 1.0 && pos.bending[ i ] < localAngle) {\n        residueStore.sstruc[ offset + i ] = 'h'.charCodeAt(0)\n        residueStore.sstruc[ offset + i + 1 ] = 'h'.charCodeAt(0)\n      }\n    }\n  }\n\n  return function calculateSecondaryStructure (structure: Structure) {\n    if (Debug) Log.time('calculateSecondaryStructure')\n\n    structure.eachPolymer(function (p) {\n      // assign secondary structure\n      if (p.residueCount < 4) return\n      if (p.isCg()) {\n        cgPolymer(p)\n      } else if (p.isProtein()) {\n        proteinPolymer(p)\n      } else {\n        return\n      }\n\n      // set lone secondary structure assignments to \"c\"\n      let prevSstruc: string\n      let sstrucCount = 0\n      p.eachResidue(function (r: ResidueProxy) {\n        if (r.sstruc === prevSstruc) {\n          sstrucCount += 1\n        } else {\n          if (sstrucCount === 1) {\n            r.index -= 1\n            r.sstruc = 'c'\n          }\n          sstrucCount = 1\n          prevSstruc = r.sstruc\n        }\n      })\n    })\n\n    if (Debug) Log.timeEnd('calculateSecondaryStructure')\n  }\n}())\n\n// const ChainnameAlphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n//                           \"abcdefghijklmnopqrstuvwxyz\" +\n//                           \"0123456789\";\nconst ChainnameAlphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\nexport function getChainname (index: number) {\n  const n = ChainnameAlphabet.length\n  let j = index\n  let k = 0\n  let chainname = ChainnameAlphabet[j % n]\n  while (j >= n) {\n    j = Math.floor(j / n)\n    chainname += ChainnameAlphabet[j % n]\n    k += 1\n  }\n  if (k >= 5) {\n    Log.warn('chainname overflow')\n  }\n  return chainname\n}\n\ninterface ChainData {\n  mIndex: number\n  chainname: string\n  rStart: number\n  rCount: number\n}\n\n/**\n * When no chain names are set for the given structure, calculates\n * chains based on:\n * - polymer connectivity: when adjacent residues are not bonded, a new chain is created.\n * - non polymer chemical type: adjacent residues which are not polymers but are of the same\n * chemical type (e.g. water molecules) are grouped into the same chain.\n **/\nexport function calculateChainnames (structure: Structure, useExistingBonds = false) {\n  if (Debug) Log.time('calculateChainnames')\n\n  let doAutoChainName = true\n  structure.eachChain(function (c) {\n    if (c.chainname) doAutoChainName = false\n  })\n\n  if (doAutoChainName) {\n    const modelStore = structure.modelStore\n    const chainStore = structure.chainStore\n    const residueStore = structure.residueStore\n\n    const addChain = function (mIndex: number, chainname: string, rOffset: number, rCount: number) {\n      const ci = chainStore.count\n      for (let i = 0; i < rCount; ++i) {\n        residueStore.chainIndex[ rOffset + i ] = ci\n      }\n      chainStore.growIfFull()\n      chainStore.modelIndex[ ci ] = mIndex\n      chainStore.setChainname(ci, chainname)\n      chainStore.setChainid(ci, chainname)\n      chainStore.residueOffset[ ci ] = rOffset\n      chainStore.residueCount[ ci ] = rCount\n      chainStore.count += 1\n      modelStore.chainCount[ mIndex ] += 1\n    }\n\n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n\n    let i = 0\n    let mi = 0\n    let rStart = 0\n    let rEnd = 0\n    const chainData: ChainData[] = []\n\n    if (residueStore.count === 1) {\n      chainData.push({\n        mIndex: 0,\n        chainname: 'A',\n        rStart: 0,\n        rCount: 1\n      })\n    } else {\n      structure.eachResidueN(2, function (rp1: ResidueProxy, rp2: ResidueProxy) {\n        let newChain = false\n\n        const bbType1 = rp1.backboneType\n        const bbType2 = rp2.backboneType\n        const bbTypeUnk = UnknownBackboneType\n\n        rEnd = rp1.index\n\n        if (rp1.modelIndex !== rp2.modelIndex) {\n          newChain = true\n        } else if (rp1.moleculeType !== rp2.moleculeType) {\n          newChain = true\n        } else if (bbType1 !== bbTypeUnk && bbType1 === bbType2) {\n          ap1.index = rp1.backboneEndAtomIndex\n          ap2.index = rp2.backboneStartAtomIndex\n          if (useExistingBonds) {\n            newChain = !ap1.hasBondTo(ap2)\n          } else {\n            newChain = !ap1.connectedTo(ap2)\n          }\n        }\n\n        // current chain goes to end of the structure\n        if (!newChain && rp2.index === residueStore.count - 1) {\n          newChain = true\n          rEnd = rp2.index\n        }\n\n        if (newChain) {\n          chainData.push({\n            mIndex: mi,\n            chainname: getChainname(i),\n            rStart: rStart,\n            rCount: rEnd - rStart + 1\n          })\n\n          i += 1\n\n          if (rp1.modelIndex !== rp2.modelIndex) {\n            i = 0\n            mi += 1\n          }\n\n          // new chain for the last residue of the structure\n          if (rp2.index === residueStore.count - 1 && rEnd !== rp2.index) {\n            chainData.push({\n              mIndex: mi,\n              chainname: getChainname(i),\n              rStart: residueStore.count - 1,\n              rCount: 1\n            })\n          }\n\n          rStart = rp2.index\n          rEnd = rp2.index\n        }\n      })\n    }\n\n    //\n\n    chainStore.count = 0\n    modelStore.chainCount.fill(0, 0, modelStore.count)\n    modelStore.chainOffset.fill(0, 0, modelStore.count)\n    chainData.forEach(function (d) {\n      addChain(d.mIndex, d.chainname, d.rStart, d.rCount)\n    })\n\n    let chainOffset = 0\n    structure.eachModel(function (mp) {\n      modelStore.chainOffset[ mp.index ] = chainOffset\n      chainOffset += modelStore.chainCount[ mp.index ]\n    })\n  }\n\n  if (Debug) Log.timeEnd('calculateChainnames')\n}\n\nexport function calculateBonds (structure: Structure, inferBonds: InferBondsOptions='all') {\n  if (inferBonds === 'none') return \n  if (Debug) Log.time('calculateBonds')\n\n  calculateBondsWithin(structure, false, inferBonds)\n  calculateBondsBetween(structure)\n\n  if (Debug) Log.timeEnd('calculateBonds')\n}\n\n/**\n * Should Bonds be inferred for `all` atoms, `none` or `auto`\n * If `auto`, any hetgroup residue with at least one CONECT record will \n * not have bonding inferred, and will rely on the CONECT records\n */\nexport type InferBondsOptions = 'all' | 'none' | 'auto'\n\nexport interface ResidueBonds {\n  atomIndices1: number[]\n  atomIndices2: number[]\n  bondOrders: number[]\n}\n\n\nconst BondOrderTable: { [k: string]: number } = {\n  'HIS|CD2|CG': 2,\n  'HIS|CE1|ND1': 2,\n  'ARG|CZ|NH2': 2,\n  'PHE|CE1|CZ': 2,\n  'PHE|CD2|CE2': 2,\n  'PHE|CD1|CG': 2,\n  'TRP|CD1|CG': 2,\n  'TRP|CD2|CE2': 2,\n  'TRP|CE3|CZ3': 2,\n  'TRP|CH2|CZ2': 2,\n  'ASN|CG|OD1': 2,\n  'GLN|CD|OE1': 2,\n  'TYR|CD1|CG': 2,\n  'TYR|CD2|CE2': 2,\n  'TYR|CE1|CZ': 2,\n  'ASP|CG|OD1': 2,\n  'GLU|CD|OE1': 2,\n\n  'G|C8|N7': 2,\n  'G|C4|C5': 2,\n  'G|C2|N3': 2,\n  'G|C6|O6': 2,\n  'C|C4|N3': 2,\n  'C|C5|C6': 2,\n  'C|C2|O2': 2,\n  'A|C2|N3': 2,\n  'A|C6|N1': 2,\n  'A|C4|C5': 2,\n  'A|C8|N7': 2,\n  'U|C5|C6': 2,\n  'U|C2|O2': 2,\n  'U|C4|O4': 2,\n\n  'DG|C8|N7': 2,\n  'DG|C4|C5': 2,\n  'DG|C2|N3': 2,\n  'DG|C6|O6': 2,\n  'DC|C4|N3': 2,\n  'DC|C5|C6': 2,\n  'DC|C2|O2': 2,\n  'DA|C2|N3': 2,\n  'DA|C6|N1': 2,\n  'DA|C4|C5': 2,\n  'DA|C8|N7': 2,\n  'DT|C5|C6': 2,\n  'DT|C2|O2': 2,\n  'DT|C4|O4': 2\n}\nfunction getBondOrderFromTable (resname: string, atomname1: string, atomname2: string) {\n  [ atomname1, atomname2 ] = atomname1 < atomname2 ? [ atomname1, atomname2 ] : [ atomname2, atomname1 ]\n  if (AA3.includes(resname) && atomname1 === 'C' && atomname2 === 'O') return 2\n  if (Bases.includes(resname) && atomname1 === 'OP1' && atomname2 === 'P') return 2\n  return BondOrderTable[ `${resname}|${atomname1}|${atomname2}` ] || 1\n}\n\nexport function calculateResidueBonds (r: ResidueProxy) {\n  const structure = r.structure\n  const a1 = structure.getAtomProxy()\n  const a2 = structure.getAtomProxy()\n\n  const count = r.atomCount\n  const offset = r.atomOffset\n  const end = offset + count\n  const end1 = end - 1\n\n  const atomIndices1 = []\n  const atomIndices2 = []\n  const bondOrders = []\n\n  if (count > 500) {\n    if (Debug) Log.warn('more than 500 atoms, skip residue for auto-bonding', r.qualifiedName())\n  } else {\n    if (count > 50) {\n      const kdtree = new Kdtree(r, true)\n      const radius = r.isCg() ? 1.2 : 2.3\n\n      for (let i = offset; i < end1; ++i) {\n        a1.index = i\n        const maxd = a1.covalent + radius + 0.3\n        const nearestAtoms = kdtree.nearest(a1 as any, Infinity, maxd * maxd)  // TODO\n        const m = nearestAtoms.length\n        for (let j = 0; j < m; ++j) {\n          a2.index = nearestAtoms[ j ].index\n          if (a1.index < a2.index) {\n            if (a1.connectedTo(a2)) {\n              atomIndices1.push(a1.index - offset)\n              atomIndices2.push(a2.index - offset)\n              bondOrders.push(getBondOrderFromTable(a1.resname, a1.atomname, a2.atomname))\n            }\n          }\n        }\n      }\n    } else {\n      for (let i = offset; i < end1; ++i) {\n        a1.index = i\n        for (let j = i + 1; j <= end1; ++j) {\n          a2.index = j\n          if (a1.connectedTo(a2)) {\n            atomIndices1.push(i - offset)\n            atomIndices2.push(j - offset)\n            bondOrders.push(getBondOrderFromTable(a1.resname, a1.atomname, a2.atomname))\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    atomIndices1: atomIndices1,\n    atomIndices2: atomIndices2,\n    bondOrders: bondOrders\n  }\n}\n\nexport function calculateAtomBondMap (structure: Structure) {\n  if (Debug) Log.time('calculateAtomBondMap')\n\n  var atomBondMap: number[][] = []\n\n  structure.eachBond(function (bp) {\n    var ai1 = bp.atomIndex1\n    var ai2 = bp.atomIndex2\n    if (atomBondMap[ ai1 ] === undefined) atomBondMap[ ai1 ] = []\n    atomBondMap[ ai1 ][ ai2 ] = bp.index\n  })\n\n  if (Debug) Log.timeEnd('calculateAtomBondMap')\n\n  return atomBondMap\n}\n\nexport function calculateBondsWithin (structure: Structure, onlyAddRung = false, inferBonds: InferBondsOptions='all') {\n  if (Debug) Log.time('calculateBondsWithin')\n\n  const bondStore = structure.bondStore\n  const rungBondStore = structure.rungBondStore\n  const rungAtomSet = structure.getAtomSet(false)\n  const a1 = structure.getAtomProxy()\n  const a2 = structure.getAtomProxy()\n  const bp = structure.getBondProxy()\n  const atomBondMap = onlyAddRung ? null : calculateAtomBondMap(structure)\n\n  let bondedAtoms: Set<number>\n  if (!onlyAddRung && inferBonds === 'auto') {\n    bondedAtoms = new Set()\n    atomBondMap!.forEach((a, i) => {\n      bondedAtoms.add(i)\n      a.forEach(j => {bondedAtoms.add(j)})\n    })\n  }\n\n  structure.eachResidue(function (r) {\n    if (!onlyAddRung && atomBondMap) {\n      const count = r.atomCount\n      const offset = r.atomOffset\n\n      if (count > 500) {\n        Log.warn('more than 500 atoms, skip residue for auto-bonding', r.qualifiedName())\n        return\n      }\n\n      if (inferBonds === 'auto' && r.hetero) {\n        // Are bonds present on this residue?\n        for (let rai=r.atomOffset; rai<r.atomEnd; rai++) {\n          if (bondedAtoms.has(rai)) return\n        }\n      }\n\n      const bonds = r.getBonds()\n      const atomIndices1 = bonds.atomIndices1\n      const atomIndices2 = bonds.atomIndices2\n      const bondOrders = bonds.bondOrders\n      const nn = atomIndices1.length\n\n      for (let i = 0; i < nn; ++i) {\n        const rai1 = atomIndices1[ i ]\n        const rai2 = atomIndices2[ i ]\n        const ai1 = rai1 + offset\n        const ai2 = rai2 + offset\n        const tmp = atomBondMap[ ai1 ]\n        if (tmp !== undefined && tmp[ ai2 ] !== undefined) {\n          bp.index = tmp[ ai2 ]\n          const residueTypeBondIndex = r.residueType.getBondIndex(rai1, rai2)!  // TODO\n          // overwrite residueType bondOrder with value from existing bond\n          bondOrders[ residueTypeBondIndex ] = bp.bondOrder\n        } else {\n          a1.index = ai1\n          a2.index = ai2\n          // only add bond if not already in bondStore\n          bondStore.addBond(a1, a2, bondOrders[ i ])\n        }\n      }\n    }\n\n    // get RNA/DNA rung pseudo bonds\n    const traceAtomIndex = r.residueType.traceAtomIndex\n    const rungEndAtomIndex = r.residueType.rungEndAtomIndex\n    if (traceAtomIndex !== -1 && rungEndAtomIndex !== -1) {\n      a1.index = r.traceAtomIndex\n      a2.index = r.rungEndAtomIndex\n      rungBondStore.addBond(a1, a2)\n      rungAtomSet.set(a1.index)\n      rungAtomSet.set(a2.index)\n    }\n  })\n\n  structure.atomSetDict.rung = rungAtomSet\n\n  if (Debug) Log.timeEnd('calculateBondsWithin')\n}\n\nexport function calculateBondsBetween (structure: Structure, onlyAddBackbone = false, useExistingBonds = false) {\n  if (Debug) Log.time('calculateBondsBetween')\n\n  const bondStore = structure.bondStore\n  const backboneBondStore = structure.backboneBondStore\n  const backboneAtomSet = structure.getAtomSet(false)\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  if (backboneBondStore.count === 0) {\n    backboneBondStore.resize(structure.residueStore.count)\n  }\n\n  function addBondIfConnected (rp1: ResidueProxy, rp2: ResidueProxy) {\n    const bbType1 = rp1.backboneType\n    const bbType2 = rp2.backboneType\n    if (bbType1 !== UnknownBackboneType && bbType1 === bbType2) {\n      ap1.index = rp1.backboneEndAtomIndex\n      ap2.index = rp2.backboneStartAtomIndex\n      let needsBond = false\n      let needsBackbone = false\n\n      if (useExistingBonds && ap1.hasBondTo(ap2)) {\n        needsBond = false\n        needsBackbone = true\n      } else if (ap1.connectedTo(ap2)) {\n        needsBond = !onlyAddBackbone\n        needsBackbone = true\n      }\n      if (needsBond) {bondStore.addBond(ap1, ap2, 1)}  // assume single bond\n      if (needsBackbone) {\n        ap1.index = rp1.traceAtomIndex\n        ap2.index = rp2.traceAtomIndex\n        backboneBondStore.addBond(ap1, ap2)\n        backboneAtomSet.set(ap1.index)\n        backboneAtomSet.set(ap2.index)\n      }\n    }\n  }\n\n  structure.eachResidueN(2, addBondIfConnected)\n\n  const rp1 = structure.getResidueProxy()\n  const rp2 = structure.getResidueProxy()\n\n  // check for cyclic chains\n  structure.eachChain(function (cp) {\n    if (cp.residueCount === 0) return\n    rp1.index = cp.residueOffset\n    rp2.index = cp.residueOffset + cp.residueCount - 1\n    addBondIfConnected(rp2, rp1)\n  })\n\n  structure.atomSetDict.backbone = backboneAtomSet\n\n  if (!onlyAddBackbone) {\n    if (Debug) Log.time('calculateBondsBetween inter')\n    const spatialHash = structure.spatialHash\n    structure.eachResidue(function (rp) {\n      if (rp.backboneType === UnknownBackboneType && !rp.isWater()) {\n        rp.eachAtom(function (ap) {\n          if (ap.isMetal()) return\n          spatialHash!.eachWithin(ap.x, ap.y, ap.z, 4, function (idx) {  // TODO\n            ap2.index = idx\n            if (ap.modelIndex === ap2.modelIndex &&\n                ap.residueIndex !== ap2.residueIndex &&\n                !ap2.isMetal()\n            ) {\n              bondStore.addBondIfConnected(ap, ap2, 1)  // assume single bond\n            }\n          })\n        })\n      }\n    })\n    if (Debug) Log.timeEnd('calculateBondsBetween inter')\n  }\n\n  if (Debug) Log.timeEnd('calculateBondsBetween')\n}\n\nexport function buildUnitcellAssembly (structure: Structure) {\n  if (!structure.unitcell) return\n\n  if (Debug) Log.time('buildUnitcellAssembly')\n\n  const uc = structure.unitcell\n\n  const structureCenterFrac = structure.center.clone().applyMatrix4(uc.cartToFrac)\n  const centerFrac = structureCenterFrac.clone().floor()\n  const symopDict: { [K: string]: Matrix4 } = getSymmetryOperations(uc.spacegroup)\n\n  const centerFracSymop = new Vector3()\n  const positionFracSymop = new Vector3()\n\n  function getMatrixList (shift?: Vector3) {\n    const matrixList: Matrix4[] = []\n\n    Object.keys(symopDict).forEach(function (name) {\n      const m = symopDict[ name ].clone()\n\n      centerFracSymop.copy(structureCenterFrac).applyMatrix4(m).floor()\n      positionFracSymop.setFromMatrixPosition(m)\n      positionFracSymop.sub(centerFracSymop)\n      positionFracSymop.add(centerFrac)\n\n      if (shift) positionFracSymop.add(shift)\n\n      m.setPosition(positionFracSymop)\n      m.multiplyMatrices(uc.fracToCart, m)\n      m.multiply(uc.cartToFrac)\n\n      matrixList.push(m)\n    })\n\n    return matrixList\n  }\n\n  const unitcellAssembly = new Assembly('UNITCELL')\n  const unitcellMatrixList = getMatrixList()\n  const ncsMatrixList: Matrix4[] = []\n  if (structure.biomolDict.NCS) {\n    ncsMatrixList.push(\n      new Matrix4(), ...structure.biomolDict.NCS.partList[ 0 ].matrixList\n    )\n    const ncsUnitcellMatrixList: Matrix4[] = []\n    unitcellMatrixList.forEach(sm => {\n      ncsMatrixList.forEach(nm => {\n        ncsUnitcellMatrixList.push(sm.clone().multiply(nm))\n      })\n    })\n    unitcellAssembly.addPart(ncsUnitcellMatrixList)\n  } else {\n    unitcellAssembly.addPart(unitcellMatrixList)\n  }\n\n  const vec = new Vector3()\n  const supercellAssembly = new Assembly('SUPERCELL')\n  const supercellMatrixList = Array.prototype.concat.call(\n    getMatrixList(vec.set(1, 0, 0)),  // 655\n    getMatrixList(vec.set(0, 1, 0)),  // 565\n    getMatrixList(vec.set(0, 0, 1)),  // 556\n\n    getMatrixList(vec.set(-1, 0, 0)),  // 455\n    getMatrixList(vec.set(0, -1, 0)),  // 545\n    getMatrixList(vec.set(0, 0, -1)),  // 554\n\n    getMatrixList(vec.set(1, 1, 0)),  // 665\n    getMatrixList(vec.set(1, 0, 1)),  // 656\n    getMatrixList(vec.set(0, 1, 1)),  // 566\n\n    getMatrixList(vec.set(-1, -1, 0)),  // 445\n    getMatrixList(vec.set(-1, 0, -1)),  // 454\n    getMatrixList(vec.set(0, -1, -1)),  // 544\n\n    getMatrixList(vec.set(1, -1, -1)),  // 644\n    getMatrixList(vec.set(1, 1, -1)),  // 664\n    getMatrixList(vec.set(1, -1, 1)),  // 646\n    getMatrixList(vec.set(-1, 1, 1)),  // 466\n    getMatrixList(vec.set(-1, -1, 1)),  // 446\n    getMatrixList(vec.set(-1, 1, -1)),  // 464\n\n    getMatrixList(vec.set(0, 1, -1)),  // 564\n    getMatrixList(vec.set(0, -1, 1)),  // 546\n    getMatrixList(vec.set(1, 0, -1)),  // 654\n    getMatrixList(vec.set(-1, 0, 1)),  // 456\n    getMatrixList(vec.set(1, -1, 0)),  // 645\n    getMatrixList(vec.set(-1, 1, 0)),  // 465\n\n    getMatrixList(),  // 555\n    getMatrixList(vec.set(1, 1, 1)),  // 666\n    getMatrixList(vec.set(-1, -1, -1))   // 444\n  )\n  if (structure.biomolDict.NCS) {\n    const ncsSupercellMatrixList: Matrix4[] = []\n    supercellMatrixList.forEach(function (sm: Matrix4) {\n      ncsMatrixList.forEach(function (nm) {\n        ncsSupercellMatrixList.push(sm.clone().multiply(nm))\n      })\n    })\n    supercellAssembly.addPart(ncsSupercellMatrixList)\n  } else {\n    supercellAssembly.addPart(supercellMatrixList)\n  }\n\n  structure.biomolDict.UNITCELL = unitcellAssembly\n  structure.biomolDict.SUPERCELL = supercellAssembly\n\n  if (Debug) Log.timeEnd('buildUnitcellAssembly')\n}\n\nconst elm1 = [ 'H', 'C', 'O', 'N', 'S', 'P' ]\nconst elm2 = [ 'NA', 'CL', 'FE' ]\n\nexport function guessElement (atomName: string) {\n  // Retain first group of letters in atomName\n  let at = atomName.toUpperCase()\n  let begin = 0, end = 0\n  for (let i = 0; i < at.length ; i++) {\n    if (at.charCodeAt(i) < 65) {\n      if (end > 0) break\n      ++begin\n    }\n    else end = i + 1\n  }\n  if (begin > 0 || end < at.length) at = at.substring(begin, end)\n  \n  const n = at.length\n\n  if (n === 0) return ''\n  if (n === 1) return at\n  if (n === 2) {\n    if (elm2.indexOf(at) !== -1) return at\n    if (elm1.indexOf(at[0]) !== -1) return at[0]\n    if (at in AtomicNumbers) return at\n  }\n  if (n >= 3) {\n    if (elm1.indexOf(at[0]) !== -1) return at[0]\n  }\n  return ''\n}\n\n/**\n * Assigns ResidueType bonds.\n * @param {Structure} structure - the structure object\n * @return {undefined}\n */\nexport function assignResidueTypeBonds (structure: Structure) {\n  // if( Debug ) Log.time( \"assignResidueTypeBonds\" )\n\n  const bondHash = structure.bondHash!  // TODO\n  const countArray = bondHash.countArray\n  const offsetArray = bondHash.offsetArray\n  const indexArray = bondHash.indexArray\n  const bp = structure.getBondProxy()\n\n  structure.eachResidue(function (rp) {\n    const residueType = rp.residueType\n    if (residueType.bonds !== undefined) return\n\n    var atomOffset = rp.atomOffset\n    var atomIndices1: number[] = []\n    var atomIndices2: number[] = []\n    var bondOrders: number[] = []\n    var bondDict: { [k: string]: boolean } = {}\n\n    const nextAtomOffset = atomOffset + rp.atomCount\n\n    rp.eachAtom(function (ap) {\n      const index = ap.index\n      const offset = offsetArray[ index ]\n      const count = countArray[ index ]\n      for (let i = 0, il = count; i < il; ++i) {\n        bp.index = indexArray[ offset + i ]\n        let idx1 = bp.atomIndex1\n        if (idx1 < atomOffset || idx1 >= nextAtomOffset) {\n          // Don't add bonds outside of this resiude\n          continue\n        }\n        let idx2 = bp.atomIndex2\n        if (idx2 < atomOffset || idx2 >= nextAtomOffset) {\n          continue\n        }\n\n        if (idx1 > idx2) {\n          const tmp = idx2\n          idx2 = idx1\n          idx1 = tmp\n        }\n        const hash = idx1 + '|' + idx2\n        if (bondDict[ hash ] === undefined) {\n          bondDict[ hash ] = true\n          atomIndices1.push(idx1 - atomOffset)\n          atomIndices2.push(idx2 - atomOffset)\n          bondOrders.push(bp.bondOrder)\n        }\n      }\n    })\n\n    residueType.bonds = {\n      atomIndices1: atomIndices1,\n      atomIndices2: atomIndices2,\n      bondOrders: bondOrders\n    }\n  })\n\n  // if( Debug ) Log.timeEnd( \"assignResidueTypeBonds\" )\n}\n\nexport function concatStructures (name: string, ...structures: Structure[]) {\n  if( Debug ) Log.time( \"concatStructures\" )\n\n  const s = new Structure(name, '')\n  const sb = new StructureBuilder(s)\n\n  const atomStore = s.atomStore as any\n  const atomMap = s.atomMap\n  atomStore.addField('formalCharge', 1, 'int8')\n  atomStore.addField('partialCharge', 1, 'float32')\n\n  const atomIndexDict: { [k: number]: number } = {}\n\n  let idx = 0\n  let atomCount = 0\n  let modelCount = 0\n  structures.forEach(structure => {\n    structure.eachAtom(a => {\n      atomStore.growIfFull()\n      atomStore.atomTypeId[ idx ] = atomMap.add(a.atomname, a.element)\n\n      atomStore.x[ idx ] = a.x\n      atomStore.y[ idx ] = a.y\n      atomStore.z[ idx ] = a.z\n      atomStore.serial[ idx ] = a.serial\n      atomStore.formalCharge[ idx ] = a.formalCharge\n      atomStore.partialCharge[ idx ] = a.partialCharge\n      atomStore.altloc[ idx ] = a.altloc\n      atomStore.occupancy[ idx ] = a.occupancy\n      atomStore.bfactor[ idx ] = a.bfactor\n\n      sb.addAtom(\n        a.modelIndex + modelCount,\n        a.chainname,\n        a.chainid,\n        a.resname,\n        a.resno,\n        a.hetero === 1,\n        a.sstruc,\n        a.inscode\n      )\n\n      atomIndexDict[a.index + atomCount] = idx\n      idx += 1\n    })\n    atomCount += structure.atomStore.count\n    modelCount += structure.modelStore.count\n  })\n\n  const bondStore = s.bondStore\n  const a1 = s.getAtomProxy()\n  const a2 = s.getAtomProxy()\n\n  atomCount = 0\n  structures.forEach(structure => {\n    structure.eachBond(b => {\n      a1.index = atomIndexDict[ b.atomIndex1 + atomCount ]\n      a2.index = atomIndexDict[ b.atomIndex2 + atomCount ]\n      bondStore.addBond(a1, a2, b.bondOrder)\n    })\n    atomCount += structure.atomStore.count\n  })\n\n  sb.finalize()\n\n  calculateBondsBetween(s, true)  // calculate backbone bonds\n  calculateBondsWithin(s, true)  // calculate rung bonds\n\n  s.finalizeAtoms()\n  s.finalizeBonds()\n  assignResidueTypeBonds(s)\n\n  if( Debug ) Log.timeEnd( \"concatStructures\" )\n\n  return s\n}\n","/**\n * @file Atom Type\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { guessElement } from '../structure/structure-utils'\nimport {\n  AtomicNumbers, DefaultAtomicNumber,\n  VdwRadii, DefaultVdwRadius,\n  CovalentRadii, DefaultCovalentRadius,\n  Valences, DefaultValence,\n  OuterShellElectronCounts, DefaultOuterShellElectronCount\n} from '../structure/structure-constants'\nimport Structure from '../structure/structure'\n\n// Li, Na, K, Rb, Cs Fr\nconst AlkaliMetals = [ 3, 11, 19, 37, 55, 87 ]\n\n// Be, Mg, Ca, Sr, Ba, Ra\nconst AlkalineEarthMetals = [ 4, 12, 20, 38, 56, 88 ]\n\n// C, P, S, Se\nconst PolyatomicNonmetals = [ 6, 15, 16, 34, ]\n\n// H, N, O, F, Cl, Br, I\nconst DiatomicNonmetals = [ 1, 7, 8, 9, 17, 35, 53 ]\n\n// He, Ne, Ar, Kr, Xe, Rn\nconst NobleGases = [ 2, 10, 18, 36, 54, 86 ]\n\n// Zn, Ga, Cd, In, Sn, Hg, Ti, Pb, Bi, Po, Cn\nconst PostTransitionMetals = [ 13, 30, 31, 48, 49, 50, 80, 81, 82, 83, 84, 85, 112 ]\n\n// B, Si, Ge, As, Sb, Te, At\nconst Metalloids = [ 5, 14, 32, 33, 51, 52, 85 ]\n\n// F, Cl, Br, I, At\nconst Halogens = [ 9, 17, 35, 53, 85 ]\n\n/**\n * Atom type\n */\nclass AtomType {\n  element: string\n  number: number\n  vdw: number\n  covalent: number\n\n  /**\n   * @param {Structure} structure - the structure object\n   * @param {String} atomname - the name of the atom\n   * @param {String} element - the chemical element\n   */\n  constructor (readonly structure: Structure, readonly atomname: string, element?: string) {\n    element = element || guessElement(atomname)\n\n    this.element = element\n    this.number = AtomicNumbers[ element ] || DefaultAtomicNumber\n    this.vdw = VdwRadii[ this.number ] || DefaultVdwRadius\n    this.covalent = CovalentRadii[ this.number ] || DefaultCovalentRadius\n  }\n\n  getDefaultValence() {\n    const vl = Valences[ this.number ]\n    return vl ? vl[ 0 ] : DefaultValence\n  }\n\n  getValenceList () {\n    return Valences[ this.number ] || []\n  }\n\n  getOuterShellElectronCount () {\n    return OuterShellElectronCounts[ this.number ] || DefaultOuterShellElectronCount\n  }\n\n  isMetal () {\n    return (\n      this.isAlkaliMetal() ||\n      this.isAlkalineEarthMetal() ||\n      this.isLanthanide() ||\n      this.isActinide() ||\n      this.isTransitionMetal() ||\n      this.isPostTransitionMetal()\n    )\n  }\n\n  isNonmetal () {\n    return (\n      this.isDiatomicNonmetal() ||\n      this.isPolyatomicNonmetal() ||\n      this.isNobleGas()\n    )\n  }\n\n  isMetalloid () {\n    return Metalloids.includes(this.number)\n  }\n\n  isHalogen () {\n    return Halogens.includes(this.number)\n  }\n\n  isDiatomicNonmetal () {\n    return DiatomicNonmetals.includes(this.number)\n  }\n\n  isPolyatomicNonmetal () {\n    return PolyatomicNonmetals.includes(this.number)\n  }\n\n  isAlkaliMetal () {\n    return AlkaliMetals.includes(this.number)\n  }\n\n  isAlkalineEarthMetal () {\n    return AlkalineEarthMetals.includes(this.number)\n  }\n\n  isNobleGas () {\n    return NobleGases.includes(this.number)\n  }\n\n  isTransitionMetal () {\n    const no = this.number\n    return (\n      (no >= 21 && no <= 29) ||\n      (no >= 39 && no <= 47) ||\n      (no >= 72 && no <= 79) ||\n      (no >= 104 && no <= 108)\n    )\n  }\n\n  isPostTransitionMetal () {\n    return PostTransitionMetals.includes(this.number)\n  }\n\n  isLanthanide () {\n    return this.number >= 57 && this.number <= 71\n  }\n\n  isActinide () {\n    return this.number >= 89 && this.number <= 103\n  }\n\n}\n\nexport default AtomType","/**\n * @file Atom Map\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport AtomType from './atom-type'\nimport { guessElement } from '../structure/structure-utils'\nimport Structure from '../structure/structure'\n\nfunction getHash (atomname: string, element: string) {\n  return atomname + '|' + element\n}\n\nclass AtomMap {\n  dict: { [k: string]: number } = {}\n  list: AtomType[] = []\n\n  constructor (readonly structure: Structure) {\n    this.structure = structure\n  }\n\n  add (atomname: string, element?: string) {\n    atomname = atomname.toUpperCase()\n    if (!element) {\n      element = guessElement(atomname)\n    } else {\n      element = element.toUpperCase()\n    }\n    const hash = getHash(atomname, element)\n    let id = this.dict[ hash ]\n    if (id === undefined) {\n      const atomType = new AtomType(this.structure, atomname, element)\n      id = this.list.length\n      this.dict[ hash ] = id\n      this.list.push(atomType)\n    }\n    return id\n  }\n\n  get (id: number) {\n    return this.list[ id ]\n  }\n}\n\nexport default AtomMap\n","/**\n * @file Residue Type\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow\n * @private\n */\n\nimport { defaults } from '../utils'\nimport PrincipalAxes from '../math/principal-axes'\nimport { Matrix } from '../math/matrix-utils'\nimport { calculateResidueBonds, ResidueBonds } from '../structure/structure-utils'\nimport {\n  Elements,\n  ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType, UnknownType,\n  ProteinBackboneType, RnaBackboneType, DnaBackboneType, UnknownBackboneType,\n  CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType,\n  ChemCompProtein, ChemCompRna, ChemCompDna, ChemCompSaccharide,\n  AA3, PurinBases, RnaBases, DnaBases, Bases, IonNames, WaterNames, SaccharideNames,\n  ProteinBackboneAtoms, NucleicBackboneAtoms, ResidueTypeAtoms\n} from '../structure/structure-constants'\nimport Structure from '../structure/structure'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\nexport interface BondGraph {\n  [k: number]: number[]\n}\n\nexport interface RingData {\n  atomRings: number[][]  // sparse array:\n                         // atomRings[atomIdx] -> array of ring indices\n  rings: number[][]  // rings as arrays of indices\n}\n\n/**\n * Residue type\n */\nexport default class ResidueType {\n  resname: string\n  atomTypeIdList: number[]\n  hetero: number\n  chemCompType: string\n  bonds?: ResidueBonds\n  rings?: RingData\n  bondGraph?: BondGraph\n  aromaticAtoms?: Uint8Array\n  aromaticRings?: number[][]\n\n  atomCount: number\n\n  moleculeType: number\n  backboneType: number\n  backboneEndType: number\n  backboneStartType: number\n  backboneIndexList: number[]\n\n  traceAtomIndex: number\n  direction1AtomIndex: number\n  direction2AtomIndex: number\n  backboneStartAtomIndex: number\n  backboneEndAtomIndex: number\n  rungEndAtomIndex: number\n\n  // Sparse array containing the reference atom index for each bond.\n  bondReferenceAtomIndices: number[] = []\n\n  /**\n   * @param {Structure} structure - the structure object\n   * @param {String} resname - name of the residue\n   * @param {Array} atomTypeIdList - list of IDs of {@link AtomType}s corresponding\n   *                                 to the atoms of the residue\n   * @param {Boolean} hetero - hetero flag\n   * @param {String} chemCompType - chemical component type\n   * @param {Object} [bonds] - TODO\n   */\n  constructor (readonly structure: Structure, resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType: string, bonds?: ResidueBonds) {\n    this.resname = resname\n    this.atomTypeIdList = atomTypeIdList\n    this.hetero = hetero ? 1 : 0\n    this.chemCompType = chemCompType\n    this.bonds = bonds\n    this.atomCount = atomTypeIdList.length\n\n    this.moleculeType = this.getMoleculeType()\n    this.backboneType = this.getBackboneType(0)\n    this.backboneEndType = this.getBackboneType(-1)\n    this.backboneStartType = this.getBackboneType(1)\n    this.backboneIndexList = this.getBackboneIndexList()\n\n    const atomnames = ResidueTypeAtoms[ this.backboneType ]\n    const atomnamesStart = ResidueTypeAtoms[ this.backboneStartType ]\n    const atomnamesEnd = ResidueTypeAtoms[ this.backboneEndType ]\n\n    const traceIndex = this.getAtomIndexByName(atomnames.trace)\n    this.traceAtomIndex = defaults(traceIndex, -1)\n\n    const dir1Index = this.getAtomIndexByName(atomnames.direction1)\n    this.direction1AtomIndex = defaults(dir1Index, -1)\n\n    const dir2Index = this.getAtomIndexByName(atomnames.direction2)\n    this.direction2AtomIndex = defaults(dir2Index, -1)\n\n    const bbStartIndex = this.getAtomIndexByName(atomnamesStart.backboneStart)\n    this.backboneStartAtomIndex = defaults(bbStartIndex, -1)\n\n    const bbEndIndex = this.getAtomIndexByName(atomnamesEnd.backboneEnd)\n    this.backboneEndAtomIndex = defaults(bbEndIndex, -1)\n\n    let rungEndIndex\n    if (PurinBases.includes(resname)) {\n      rungEndIndex = this.getAtomIndexByName('N1')\n    } else {\n      rungEndIndex = this.getAtomIndexByName('N3')\n    }\n    this.rungEndAtomIndex = defaults(rungEndIndex, -1)\n  }\n\n  getBackboneIndexList () {\n    const backboneIndexList: number[] = []\n    let atomnameList\n    switch (this.moleculeType) {\n      case ProteinType:\n        atomnameList = ProteinBackboneAtoms\n        break\n      case RnaType:\n      case DnaType:\n        atomnameList = NucleicBackboneAtoms\n        break\n      default:\n        return backboneIndexList\n    }\n    const atomMap = this.structure.atomMap\n    const atomTypeIdList = this.atomTypeIdList\n    for (let i = 0, il = this.atomCount; i < il; ++i) {\n      const atomType = atomMap.get(atomTypeIdList[ i ])\n      if (atomnameList.includes(atomType.atomname)) {\n        backboneIndexList.push(i)\n      }\n    }\n    return backboneIndexList\n  }\n\n  getMoleculeType () {\n    if (this.isProtein()) {\n      return ProteinType\n    } else if (this.isRna()) {\n      return RnaType\n    } else if (this.isDna()) {\n      return DnaType\n    } else if (this.isWater()) {\n      return WaterType\n    } else if (this.isIon()) {\n      return IonType\n    } else if (this.isSaccharide()) {\n      return SaccharideType\n    } else {\n      return UnknownType\n    }\n  }\n\n  getBackboneType (position: number) {\n    if (this.hasProteinBackbone(position)) {\n      return ProteinBackboneType\n    } else if (this.hasRnaBackbone(position)) {\n      return RnaBackboneType\n    } else if (this.hasDnaBackbone(position)) {\n      return DnaBackboneType\n    } else if (this.hasCgProteinBackbone(position)) {\n      return CgProteinBackboneType\n    } else if (this.hasCgRnaBackbone(position)) {\n      return CgRnaBackboneType\n    } else if (this.hasCgDnaBackbone(position)) {\n      return CgDnaBackboneType\n    } else {\n      return UnknownBackboneType\n    }\n  }\n\n  isProtein () {\n    if (this.chemCompType) {\n      return ChemCompProtein.includes(this.chemCompType)\n    } else {\n      return (\n        this.hasAtomWithName('CA', 'C', 'N') ||\n        AA3.includes(this.resname)\n      )\n    }\n  }\n\n  isCg () {\n    const backboneType = this.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  isNucleic () {\n    return this.isRna() || this.isDna()\n  }\n\n  isRna () {\n    if (this.chemCompType) {\n      return ChemCompRna.includes(this.chemCompType)\n    } else if (this.hetero === 1) {\n      return false\n    } else {\n      return (\n        this.hasAtomWithName(\n          [ 'P', \"O3'\", 'O3*' ], [ \"C4'\", 'C4*' ], [ \"O2'\", 'O2*', \"F2'\", 'F2*' ]\n        ) ||\n        (RnaBases.includes(this.resname) &&\n          (this.hasAtomWithName([ \"O2'\", 'O2*', \"F2'\", 'F2*' ])))\n      )\n    }\n  }\n\n  isDna () {\n    if (this.chemCompType) {\n      return ChemCompDna.includes(this.chemCompType)\n    } else if (this.hetero === 1) {\n      return false\n    } else {\n      return (\n        (this.hasAtomWithName([ 'P', \"O3'\", 'O3*' ], [ \"C3'\", 'C3*' ]) &&\n          !this.hasAtomWithName([ \"O2'\", 'O2*', \"F2'\", 'F2*' ])) ||\n        DnaBases.includes(this.resname)\n      )\n    }\n  }\n\n  isHetero () {\n    return this.hetero === 1\n  }\n\n  isIon () {\n    return IonNames.includes(this.resname)\n  }\n\n  isWater () {\n    return WaterNames.includes(this.resname)\n  }\n\n  isSaccharide () {\n    if (this.chemCompType) {\n      return ChemCompSaccharide.includes(this.chemCompType)\n    } else {\n      return SaccharideNames.includes(this.resname)\n    }\n  }\n\n  isStandardAminoacid () {\n    return AA3.includes(this.resname)\n  }\n\n  isStandardBase () {\n    return Bases.includes(this.resname)\n  }\n\n  hasBackboneAtoms (position: number, type: number) {\n    const atomnames = ResidueTypeAtoms[ type ]\n    if (position === -1) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneEnd,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else if (position === 0) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else if (position === 1) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneStart,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneStart,\n        atomnames.backboneEnd,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    }\n  }\n\n  hasProteinBackbone (position: number) {\n    return (\n      this.isProtein() &&\n      this.hasBackboneAtoms(position, ProteinBackboneType)\n    )\n  }\n\n  hasRnaBackbone (position: number) {\n    return (\n      this.isRna() &&\n      this.hasBackboneAtoms(position, RnaBackboneType)\n    )\n  }\n\n  hasDnaBackbone (position: number) {\n    return (\n      this.isDna() &&\n      this.hasBackboneAtoms(position, DnaBackboneType)\n    )\n  }\n\n  hasCgProteinBackbone (position: number) {\n    return (\n      this.atomCount < 7 &&\n      this.isProtein() &&\n      this.hasBackboneAtoms(position, CgProteinBackboneType)\n    )\n  }\n\n  hasCgRnaBackbone (position: number) {\n    return (\n      this.atomCount < 11 &&\n      this.isRna() &&\n      this.hasBackboneAtoms(position, CgRnaBackboneType)\n    )\n  }\n\n  hasCgDnaBackbone (position: number) {\n    return (\n      this.atomCount < 11 &&\n      this.isDna() &&\n      this.hasBackboneAtoms(position, CgDnaBackboneType)\n    )\n  }\n\n  hasBackbone (position: number) {\n    return (\n      this.hasProteinBackbone(position) ||\n      this.hasRnaBackbone(position) ||\n      this.hasDnaBackbone(position) ||\n      this.hasCgProteinBackbone(position) ||\n      this.hasCgRnaBackbone(position) ||\n      this.hasCgDnaBackbone(position)\n    )\n  }\n\n  getAtomIndexByName (atomname: string|string[]) {\n    const n = this.atomCount\n    const atomMap = this.structure.atomMap\n    const atomTypeIdList = this.atomTypeIdList\n    if (Array.isArray(atomname)) {\n      for (let i = 0; i < n; ++i) {\n        const index = atomTypeIdList[ i ]\n        if (atomname.includes(atomMap.get(index).atomname)) {\n          return i\n        }\n      }\n    } else {\n      for (let i = 0; i < n; ++i) {\n        const index = atomTypeIdList[ i ]\n        if (atomname === atomMap.get(index).atomname) {\n          return i\n        }\n      }\n    }\n    return undefined\n  }\n\n  hasAtomWithName (...atomnames: (string|string[])[]) {\n    const n = atomnames.length\n    for (let i = 0; i < n; ++i) {\n      if (atomnames[ i ] === undefined) continue\n      if (this.getAtomIndexByName(atomnames[ i ]) === undefined) {\n        return false\n      }\n    }\n    return true\n  }\n\n  getBonds (r?: ResidueProxy) {\n    if (this.bonds === undefined) {\n      this.bonds = calculateResidueBonds(r!)  // TODO\n    }\n    return this.bonds\n  }\n\n  getRings () {\n    if (this.rings === undefined) {\n      this.calculateRings()\n    }\n    return this.rings\n  }\n\n  getBondGraph () {\n    if (this.bondGraph === undefined) {\n      this.calculateBondGraph()\n    }\n    return this.bondGraph\n  }\n\n  getAromatic (a?: AtomProxy) {\n    if (this.aromaticAtoms === undefined) {\n      this.calculateAromatic(this.structure.getResidueProxy((a!).residueIndex))  // TODO\n    }\n    return this.aromaticAtoms\n  }\n\n  getAromaticRings (r?: ResidueProxy) {\n    if (this.aromaticRings === undefined) {\n      this.calculateAromatic(r!)  // TODO\n    }\n    return this.aromaticRings\n  }\n\n  /**\n   * @return {Object} bondGraph - represents the bonding in this\n   *   residue: { ai1: [ ai2, ai3, ...], ...}\n   */\n  calculateBondGraph () {\n    const bondGraph: BondGraph = this.bondGraph = {}\n    const bonds = this.getBonds()\n    const nb = bonds.atomIndices1.length\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n\n    for (let i = 0; i < nb; ++i) {\n      const ai1 = atomIndices1[i]\n      const ai2 = atomIndices2[i]\n\n      const a1 = bondGraph[ ai1 ] = bondGraph[ ai1 ] || []\n      a1.push(ai2)\n\n      const a2 = bondGraph[ ai2 ] = bondGraph[ ai2 ] || []\n      a2.push(ai1)\n    }\n  }\n\n  /**\n   * Find all rings up to 2 * RingFinderMaxDepth\n   */\n  calculateRings () {\n    const bondGraph = this.getBondGraph()!  // TODO\n    const state = RingFinderState(bondGraph, this.atomCount)\n\n    for (let i = 0; i < state.count; i++) {\n      if (state.visited[i] >= 0) continue\n      findRings(state, i)\n    }\n\n    this.rings = { atomRings: state.atomRings, rings: state.rings }\n  }\n\n  isAromatic (atom: AtomProxy) {\n    this.aromaticAtoms = this.getAromatic(atom)!  // TODO\n    return this.aromaticAtoms[atom.index - atom.residueAtomOffset] === 1\n  }\n\n  calculateAromatic (r: ResidueProxy) {\n    const aromaticAtoms = this.aromaticAtoms = new Uint8Array(this.atomCount)\n    const rings = this.getRings()!.rings\n\n    const aromaticRingFlags = rings.map(ring => {\n      return isRingAromatic(ring.map(idx => {\n        return this.structure.getAtomProxy(idx + r.atomOffset)\n      }))\n    })\n\n    const aromaticRings: number[][] = this.aromaticRings = []\n    rings.forEach((ring, i) => {\n      if (aromaticRingFlags[i]) {\n        aromaticRings.push(ring)\n        ring.forEach(idx => aromaticAtoms[idx] = 1)\n      }\n    })\n  }\n\n  /**\n   * For bonds with order > 1, pick a reference atom\n   * @return {undefined}\n   */\n  assignBondReferenceAtomIndices () {\n    const bondGraph = this.getBondGraph()!  // TODO\n    const rings = this.getRings()!  // TODO\n    const atomRings = rings.atomRings\n    const ringData = rings.rings\n\n    const bonds = this.bonds!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    const bondOrders = bonds.bondOrders\n    const bondReferenceAtomIndices = this.bondReferenceAtomIndices\n\n    const nb = bonds.atomIndices1.length\n\n    bondReferenceAtomIndices.length = 0  // reset array\n\n    for (let i = 0; i < nb; ++i) {\n      // Not required for single bonds\n      if (bondOrders[i] <= 1) continue\n\n      let refRing\n\n      const ai1 = atomIndices1[i]\n      const ai2 = atomIndices2[i]\n\n      const rings1 = atomRings[ ai1 ]\n      const rings2 = atomRings[ ai2 ]\n      // Are both atoms in a ring?\n      if (rings1 && rings2) {\n        // Are they in the same ring? (If not, ignore ring info)\n        for (let ri1 = 0; ri1 < rings1.length; ri1++){\n          if (rings2.indexOf(rings1[ ri1 ]) !== -1) {\n            refRing = ringData[ rings1[ ri1 ] ]\n            break\n          }\n        }\n      }\n\n      // Find the first neighbour.\n      if (bondGraph[ ai1 ].length > 1) {\n        for (let j = 0; j < bondGraph[ ai1 ].length; ++j) {\n          const ai3 = bondGraph[ ai1 ][ j ]\n          if (ai3 !== ai2) {\n            if (refRing === undefined || refRing.indexOf(ai3) !== -1){\n              bondReferenceAtomIndices[i] = ai3\n              break\n            }\n          }\n        }\n      } else if (bondGraph[ ai2 ].length > 1) {\n        for (let j = 0; j < bondGraph[ ai2 ].length; ++j) {\n          const ai3 = bondGraph[ ai2 ][ j ]\n          if (ai3 !== ai1) {\n            if (refRing === undefined || refRing.indexOf(ai3) !== -1){\n              bondReferenceAtomIndices[i] = ai3\n              break\n            }\n          }\n        }\n      } // No reference atom could be found (e.g. diatomic molecule/fragment)\n    }\n  }\n\n  getBondIndex (atomIndex1: number, atomIndex2: number) {\n    const bonds = this.bonds!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    let idx1 = atomIndices1.indexOf(atomIndex1)\n    let idx2 = atomIndices2.indexOf(atomIndex2)\n    const _idx2 = idx2\n    while (idx1 !== -1) {\n      while (idx2 !== -1) {\n        if (idx1 === idx2) return idx1\n        idx2 = atomIndices2.indexOf(atomIndex2, idx2 + 1)\n      }\n      idx1 = atomIndices1.indexOf(atomIndex1, idx1 + 1)\n      idx2 = _idx2\n    }\n    // returns undefined when no bond is found\n  }\n\n  getBondReferenceAtomIndex (atomIndex1: number, atomIndex2: number) {\n    const bondIndex = this.getBondIndex(atomIndex1, atomIndex2)\n    if (bondIndex === undefined) return undefined\n    if (this.bondReferenceAtomIndices.length === 0) {\n      this.assignBondReferenceAtomIndices()\n    }\n    return this.bondReferenceAtomIndices[ bondIndex ]\n  }\n}\n\n//\n\nconst AromaticRingElements = [\n  Elements.B, Elements.C, Elements.N, Elements.O,\n  Elements.SI, Elements.P, Elements.S,\n  Elements.GE, Elements.AS,\n  Elements.SN, Elements.SB,\n  Elements.BI\n]\nconst AromaticRingPlanarityThreshold = 0.05\n\nfunction isRingAromatic (ring: AtomProxy[]) {\n  if (ring.some(a => !AromaticRingElements.includes(a.number))) return false\n\n  let i = 0\n  const coords = new Matrix(3, ring.length)\n  const cd = coords.data\n\n  ring.forEach(a => {\n    cd[ i + 0 ] = a.x\n    cd[ i + 1 ] = a.y\n    cd[ i + 2 ] = a.z\n    i += 3\n  })\n\n  const pa = new PrincipalAxes(coords)\n\n  return pa.vecC.length() < AromaticRingPlanarityThreshold\n}\n\n//\n\n/**\n * Ring finding code below adapted from MolQL\n * Copyright (c) 2017 MolQL contributors, licensed under MIT\n * @author David Sehnal <david.sehnal@gmail.com>\n */\n\nfunction addRing(state: RingFinderState, a: number, b: number) {\n  // only \"monotonous\" rings\n  if (b < a) return\n\n  const { pred, color, left, right } = state\n  const nc = ++state.currentColor\n\n  let current = a\n\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    color[current] = nc\n    current = pred[current]\n    if (current < 0) break\n  }\n\n  let leftOffset = 0\n  let rightOffset = 0\n\n  let found = false\n  let target = 0\n  current = b\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    if (color[current] === nc) {\n      target = current\n      found = true\n      break\n    }\n    right[rightOffset++] = current\n    current = pred[current]\n    if (current < 0) break\n  }\n  if (!found) return\n\n  current = a\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    left[leftOffset++] = current\n    if (target === current) break\n    current = pred[current]\n    if (current < 0) break\n  }\n\n  const rn = leftOffset + rightOffset\n  const ring: number[] = new Array(rn)\n  let ringOffset = 0;\n  for (let t = 0; t < leftOffset; t++) {\n    ring[ringOffset++] = left[t]\n  }\n  for (let t = rightOffset - 1; t >= 0; t--) {\n    ring[ringOffset++] = right[t]\n  }\n\n  const ri = state.rings.length\n  // set atomRing indices:\n  for (let i = 0; i < rn; ++i) {\n    const ai = ring[i]\n    if (state.atomRings[ai]) {\n      state.atomRings[ai].push(ri)\n    } else {\n      state.atomRings[ai] = [ri]\n    }\n  }\n\n  state.rings.push(ring)\n}\n\nfunction findRings(state: RingFinderState, from: number) {\n  const { bonds, visited, queue, pred } = state\n\n  visited[from] = 1\n  queue[0] = from\n\n  let head = 0\n  let size = 1\n\n  while (head < size) {\n    const top = queue[head++]\n    const start = 0\n    if (bonds[top] === undefined) {\n      continue\n    }\n    const end = bonds[top].length\n\n    for (let i = start; i < end; i++) {\n      const other = bonds[top][i]\n\n      if (visited[other] > 0) {\n        if (pred[other] !== top && pred[top] !== other) {\n          addRing(state, top, other)\n        }\n        continue\n      }\n\n      visited[other] = 1\n      queue[size++] = other\n      pred[other] = top\n    }\n  }\n}\n\nconst RingFinderMaxDepth = 4\n\ninterface RingFinderState {\n  count: number,\n  visited: Int32Array,\n  queue: Int32Array,\n  color: Int32Array,\n  pred: Int32Array,\n\n  left: Int32Array,\n  right: Int32Array,\n\n  currentColor: number,\n\n  rings: number[][],\n  atomRings: number[][],\n\n  bonds: BondGraph\n}\n\nfunction RingFinderState(bonds: BondGraph, capacity: number): RingFinderState {\n  const state = {\n    count: capacity,\n    visited: new Int32Array(capacity),\n    queue: new Int32Array(capacity),\n    pred: new Int32Array(capacity),\n    left: new Int32Array(RingFinderMaxDepth),\n    right: new Int32Array(RingFinderMaxDepth),\n    color: new Int32Array(capacity),\n    currentColor: 0,\n    rings: [],\n    atomRings: [],\n    bonds\n  }\n  for (let i = 0; i < capacity; i++) {\n    state.visited[i] = -1\n    state.pred[i] = -1\n  }\n  return state\n}\n","/**\n * @file Residue Map\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport { ResidueBonds } from '../structure/structure-utils'\nimport ResidueType from './residue-type'\n\nfunction getHash (resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType = '') {\n  return (\n    resname + '|' +\n    atomTypeIdList.join(',') + '|' +\n    (hetero ? 1 : 0) + '|' +\n    chemCompType\n  )\n}\n\nclass ResidueMap {\n  dict: { [k: string]: number } = {}\n  list: ResidueType[] = []\n\n  constructor (readonly structure: Structure) {}\n\n  add (resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType = '', bonds?: ResidueBonds) {\n    resname = resname.toUpperCase()\n    const hash = getHash(resname, atomTypeIdList, hetero, chemCompType)\n    let id = this.dict[ hash ]\n    if (id === undefined) {\n      const residueType = new ResidueType(\n        this.structure, resname, atomTypeIdList, hetero, chemCompType, bonds\n      )\n      id = this.list.length\n      this.dict[ hash ] = id\n      this.list.push(residueType)\n    }\n    return id\n  }\n\n  get (id: number) {\n    return this.list[ id ]\n  }\n}\n\nexport default ResidueMap\n","/**\n * @file Bond Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport Structure from '../structure/structure'\nimport BondStore from '../store/bond-store'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Bond proxy\n */\nclass BondProxy {\n  index: number\n\n  bondStore: BondStore\n\n  private _v12: Vector3\n  private _v13: Vector3\n  private _ap1: AtomProxy\n  private _ap2: AtomProxy\n  private _ap3: AtomProxy\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.bondStore = structure.bondStore\n\n    this._v12 = new Vector3()\n    this._v13 = new Vector3()\n    this._ap1 = this.structure.getAtomProxy()\n    this._ap2 = this.structure.getAtomProxy()\n    this._ap3 = this.structure.getAtomProxy()\n  }\n\n  /**\n   * @type {AtomProxy}\n   */\n  get atom1 () {\n    return this.structure.getAtomProxy(this.atomIndex1)\n  }\n\n  /**\n   * @type {AtomProxy}\n   */\n  get atom2 () {\n    return this.structure.getAtomProxy(this.atomIndex2)\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get atomIndex1 () {\n    return this.bondStore.atomIndex1[ this.index ]\n  }\n  set atomIndex1 (value) {\n    this.bondStore.atomIndex1[ this.index ] = value\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get atomIndex2 () {\n    return this.bondStore.atomIndex2[ this.index ]\n  }\n  set atomIndex2 (value) {\n    this.bondStore.atomIndex2[ this.index ] = value\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get bondOrder () {\n    return this.bondStore.bondOrder[ this.index ]\n  }\n  set bondOrder (value) {\n    this.bondStore.bondOrder[ this.index ] = value\n  }\n\n  getOtherAtomIndex (atomIndex: number) {\n    return atomIndex === this.atomIndex1 ? this.atomIndex2 : this.atomIndex1\n  }\n\n  getOtherAtom (atom: AtomProxy) {\n    return this.structure.getAtomProxy(this.getOtherAtomIndex(atom.index))\n  }\n\n  /**\n   * Get reference atom index for the bond\n   * @return {Integer|undefined} atom index, or `undefined` if unavailable\n   */\n  getReferenceAtomIndex () {\n    const ap1 = this._ap1\n    const ap2 = this._ap2\n    ap1.index = this.atomIndex1\n    ap2.index = this.atomIndex2\n    if (ap1.residueIndex !== ap2.residueIndex) {\n      return undefined  // Bond between residues, for now ignore (could detect)\n    }\n    const typeAtomIndex1 = ap1.index - ap1.residueAtomOffset\n    const typeAtomIndex2 = ap2.index - ap2.residueAtomOffset\n    const residueType = ap1.residueType\n    const ix = residueType.getBondReferenceAtomIndex(typeAtomIndex1, typeAtomIndex2)\n    if (ix !== undefined) {\n      return ix + ap1.residueAtomOffset\n    } else {\n      console.warn('No reference atom found', ap1.index, ap2.index)\n    }\n  }\n\n  /**\n   * calculate shift direction for displaying double/triple bonds\n   * @param  {Vector3} [v] pre-allocated output vector\n   * @return {Vector3} the shift direction vector\n   */\n  calculateShiftDir (v = new Vector3()) {\n    const ap1 = this._ap1\n    const ap2 = this._ap2\n    const ap3 = this._ap3\n    const v12 = this._v12\n    const v13 = this._v13\n\n    ap1.index = this.atomIndex1\n    ap2.index = this.atomIndex2\n    const ai3 = this.getReferenceAtomIndex()\n\n    v12.subVectors(ap1 as any, ap2 as any).normalize()  // TODO\n    if (ai3 !== undefined) {\n      ap3.index = ai3\n      v13.subVectors(ap1 as any, ap3 as any)  // TODO\n    } else {\n      v13.copy(ap1 as any)  // no reference point, use origin  // TODO\n    }\n    v13.normalize()\n\n    // make sure v13 and v12 are not colinear\n    let dp = v12.dot(v13)\n    if (1 - Math.abs(dp) < 1e-5) {\n      v13.set(1, 0, 0)\n      dp = v12.dot(v13)\n      if (1 - Math.abs(dp) < 1e-5) {\n        v13.set(0, 1, 0)\n        dp = v12.dot(v13)\n      }\n    }\n\n    return v.copy(v13.sub(v12.multiplyScalar(dp))).normalize()\n  }\n\n  qualifiedName () {\n    return this.atomIndex1 + '=' + this.atomIndex2\n  }\n\n  /**\n   * Clone object\n   * @return {BondProxy} cloned bond\n   */\n  clone () {\n    return new BondProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      atomIndex1: this.atomIndex1,\n      atomIndex2: this.atomIndex2,\n      bondOrder: this.bondOrder\n    }\n  }\n}\n\nexport default BondProxy\n","/**\n * @file Residue Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\nimport { defaults } from '../utils'\nimport {\n    SecStrucHelix, SecStrucSheet, SecStrucTurn,\n    ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType,\n    CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType,\n    AA1\n} from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueType, { RingData } from '../store/residue-type';\nimport { ResidueBonds } from '../structure/structure-utils';\nimport AtomType from '../store/atom-type';\nimport ChainProxy from './chain-proxy';\nimport Entity from '../structure/entity';\n\n/**\n * Residue proxy\n */\nclass ResidueProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueMap: ResidueMap\n  atomMap: AtomMap\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n    this.residueMap = structure.residueMap\n    this.atomMap = structure.atomMap\n  }\n\n  /**\n   * Entity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.chainIndex ]\n  }\n  /**\n   * Chain\n   * @type {ChainProxy}\n   */\n  get chain (): ChainProxy {\n    return this.structure.getChainProxy(this.chainIndex)\n  }\n\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.index ]\n  }\n  set chainIndex (value) {\n    this.residueStore.chainIndex[ this.index ] = value\n  }\n\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.index ]\n  }\n  set atomOffset (value) {\n    this.residueStore.atomOffset[ this.index ] = value\n  }\n\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    return this.residueStore.atomCount[ this.index ]\n  }\n  set atomCount (value) {\n    this.residueStore.atomCount[ this.index ] = value\n  }\n\n  get atomEnd () {\n    return this.atomOffset + this.atomCount - 1\n  }\n\n  //\n\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * Residue number/label\n   * @type {Integer}\n   */\n  get resno () {\n    return this.residueStore.resno[ this.index ]\n  }\n  set resno (value) {\n    this.residueStore.resno[ this.index ] = value\n  }\n\n  /**\n   * Secondary structure code\n   * @type {String}\n   */\n  get sstruc () {\n    return this.residueStore.getSstruc(this.index)\n  }\n  set sstruc (value) {\n    this.residueStore.setSstruc(this.index, value)\n  }\n\n  /**\n   * Insertion code\n   * @type {String}\n   */\n  get inscode () {\n    return this.residueStore.getInscode(this.index)\n  }\n  set inscode (value) {\n    this.residueStore.setInscode(this.index, value)\n  }\n\n  //\n\n  get residueType (): ResidueType {\n    return this.residueMap.get(this.residueStore.residueTypeId[ this.index ])\n  }\n\n  /**\n   * Residue name\n   * @type {String}\n   */\n  get resname () {\n    return this.residueType.resname\n  }\n  /**\n   * Hetero flag\n   * @type {Boolean}\n   */\n  get hetero () {\n    return this.residueType.hetero\n  }\n  get moleculeType () {\n    return this.residueType.moleculeType\n  }\n  get backboneType () {\n    return this.residueType.backboneType\n  }\n  get backboneStartType () {\n    return this.residueType.backboneStartType\n  }\n  get backboneEndType () {\n    return this.residueType.backboneEndType\n  }\n  get traceAtomIndex () {\n    return this.residueType.traceAtomIndex + this.atomOffset\n  }\n  get direction1AtomIndex () {\n    return this.residueType.direction1AtomIndex + this.atomOffset\n  }\n  get direction2AtomIndex () {\n    return this.residueType.direction2AtomIndex + this.atomOffset\n  }\n  get backboneStartAtomIndex () {\n    return this.residueType.backboneStartAtomIndex + this.atomOffset\n  }\n  get backboneEndAtomIndex () {\n    return this.residueType.backboneEndAtomIndex + this.atomOffset\n  }\n  get rungEndAtomIndex () {\n    return this.residueType.rungEndAtomIndex + this.atomOffset\n  }\n\n  //\n\n  get x () {\n    let x = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      x += this.atomStore.x[ i ]\n    }\n    return x / this.atomCount\n  }\n\n  get y () {\n    let y = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      y += this.atomStore.y[ i ]\n    }\n    return y / this.atomCount\n  }\n\n  get z () {\n    let z = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      z += this.atomStore.z[ i ]\n    }\n    return z / this.atomCount\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    const count = this.atomCount\n    const offset = this.atomOffset\n    const ap = this.structure._ap\n    const end = offset + count\n\n    if (selection && selection.atomOnlyTest) {\n      const atomOnlyTest = selection.atomOnlyTest\n      for (let i = offset; i < end; ++i) {\n        ap.index = i\n        if (atomOnlyTest(ap)) callback(ap)\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  //\n\n  /**\n   * Write residue center position to array\n   * @param  {Array|TypedArray} [array] - target array\n   * @param  {Integer} [offset] - the offset\n   * @return {Array|TypedArray} target array\n   */\n  positionToArray (array: NumberArray = [], offset = 0) {\n    array[ offset + 0 ] = this.x\n    array[ offset + 1 ] = this.y\n    array[ offset + 2 ] = this.z\n\n    return array\n  }\n\n  //\n\n  /**\n   * If residue is from a protein\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    return this.residueType.moleculeType === ProteinType\n  }\n\n  /**\n   * If residue is nucleic\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    const moleculeType = this.residueType.moleculeType\n    return moleculeType === RnaType || moleculeType === DnaType\n  }\n\n  /**\n   * If residue is rna\n   * @return {Boolean} flag\n   */\n  isRna () {\n    return this.residueType.moleculeType === RnaType\n  }\n\n  /**\n   * If residue is dna\n   * @return {Boolean} flag\n   */\n  isDna () {\n    return this.residueType.moleculeType === DnaType\n  }\n\n  /**\n   * If residue is coarse-grain\n   * @return {Boolean} flag\n   */\n  isCg () {\n    const backboneType = this.residueType.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  /**\n   * If residue is from a polymer\n   * @return {Boolean} flag\n   */\n  isPolymer () {\n    if (this.structure.entityList.length > 0) {\n      return this.entity.isPolymer()\n    } else {\n      const moleculeType = this.residueType.moleculeType\n      return (\n        moleculeType === ProteinType ||\n        moleculeType === RnaType ||\n        moleculeType === DnaType\n      )\n    }\n  }\n\n  /**\n   * If residue is hetero\n   * @return {Boolean} flag\n   */\n  isHetero () {\n    return this.residueType.hetero === 1\n  }\n\n  /**\n   * If residue is a water molecule\n   * @return {Boolean} flag\n   */\n  isWater () {\n    return this.residueType.moleculeType === WaterType\n  }\n\n  /**\n   * If residue is an ion\n   * @return {Boolean} flag\n   */\n  isIon () {\n    return this.residueType.moleculeType === IonType\n  }\n\n  /**\n   * If residue is a saccharide\n   * @return {Boolean} flag\n   */\n  isSaccharide () {\n    return this.residueType.moleculeType === SaccharideType\n  }\n\n  isStandardAminoacid () {\n    return this.residueType.isStandardAminoacid()\n  }\n\n  isStandardBase () {\n    return this.residueType.isStandardBase()\n  }\n\n  /**\n   * If residue is part of a helix\n   * @return {Boolean} flag\n   */\n  isHelix () {\n    return SecStrucHelix.includes(this.sstruc)\n  }\n\n  /**\n   * If residue is part of a sheet\n   * @return {Boolean} flag\n   */\n  isSheet () {\n    return SecStrucSheet.includes(this.sstruc)\n  }\n\n  /**\n   * If residue is part of a turn\n   * @return {Boolean} flag\n   */\n  isTurn () {\n    return SecStrucTurn.includes(this.sstruc) && this.isProtein()\n  }\n\n  getAtomType (index: number): AtomType {\n    return this.atomMap.get(this.atomStore.atomTypeId[ index ])\n  }\n\n  getResname1 () {\n    // FIXME nucleic support\n    return AA1[ this.resname.toUpperCase() ] || 'X'\n  }\n\n  getBackboneType (position: number) {\n    switch (position) {\n      case -1:\n        return this.residueType.backboneStartType\n      case 1:\n        return this.residueType.backboneEndType\n      default:\n        return this.residueType.backboneType\n    }\n  }\n\n  getAtomIndexByName (atomname: string) {\n    let index = this.residueType.getAtomIndexByName(atomname)\n    if (index !== undefined) {\n      index += this.atomOffset\n    }\n    return index\n  }\n\n  hasAtomWithName (atomname: string) {\n    return this.residueType.hasAtomWithName(atomname)\n  }\n\n  getAtomnameList () {\n    console.warn('getAtomnameList - might be expensive')\n\n    const n = this.atomCount\n    const offset = this.atomOffset\n    const list = new Array(n)\n    for (let i = 0; i < n; ++i) {\n      list[ i ] = this.getAtomType(offset + i).atomname\n    }\n    return list\n  }\n\n  /**\n   * If residue is connected to another\n   * @param  {ResidueProxy} rNext - the other residue\n   * @return {Boolean} - flag\n   */\n  connectedTo (rNext: ResidueProxy) {\n    const bbAtomEnd = this.structure.getAtomProxy(this.backboneEndAtomIndex)\n    const bbAtomStart = this.structure.getAtomProxy(rNext.backboneStartAtomIndex)\n    if (bbAtomEnd && bbAtomStart) {\n      return bbAtomEnd.connectedTo(bbAtomStart)\n    } else {\n      return false\n    }\n  }\n\n  getNextConnectedResidue () {\n    const rOffset = this.chainStore.residueOffset[ this.chainIndex ]\n    const rCount = this.chainStore.residueCount[ this.chainIndex ]\n    const nextIndex = this.index + 1\n    if (nextIndex < rOffset + rCount) {\n      const rpNext = this.structure.getResidueProxy(nextIndex)\n      if (this.connectedTo(rpNext)) {\n        return rpNext\n      }\n    } else if (nextIndex === rOffset + rCount) {  // cyclic\n      const rpFirst = this.structure.getResidueProxy(rOffset)\n      if (this.connectedTo(rpFirst)) {\n        return rpFirst\n      }\n    }\n    return undefined\n  }\n\n  getPreviousConnectedResidue (residueProxy?: ResidueProxy) {\n    const rOffset = this.chainStore.residueOffset[ this.chainIndex ]\n    const prevIndex = this.index - 1\n    if (prevIndex >= rOffset) {\n      const rpPrev = defaults(residueProxy, this.structure.getResidueProxy())\n      rpPrev.index = prevIndex\n      if (rpPrev.connectedTo(this)) {\n        return rpPrev\n      }\n    } else if (prevIndex === rOffset - 1) {  // cyclic\n      const rCount = this.chainStore.residueCount[ this.chainIndex ]\n      const rpLast = defaults(residueProxy, this.structure.getResidueProxy())\n      rpLast.index = rOffset + rCount - 1\n      if (rpLast.connectedTo(this)) {\n        return rpLast\n      }\n    }\n    return undefined\n  }\n\n  getBonds (): ResidueBonds {\n    return this.residueType.getBonds(this)\n  }\n\n  getRings (): RingData|undefined {\n    return this.residueType.getRings()\n  }\n\n  getAromaticRings () {\n    return this.residueType.getAromaticRings(this)\n  }\n\n  qualifiedName (noResname = false) {\n    let name = ''\n    if (this.resname && !noResname) name += '[' + this.resname + ']'\n    if (this.resno !== undefined) name += this.resno\n    if (this.inscode) name += '^' + this.inscode\n    if (this.chain) name += ':' + this.chainname\n    name += '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ResidueProxy} cloned residue\n   */\n  clone () {\n    return new ResidueProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      chainIndex: this.chainIndex,\n      atomOffset: this.atomOffset,\n      atomCount: this.atomCount,\n\n      resno: this.resno,\n      resname: this.resname,\n      sstruc: this.sstruc\n    }\n  }\n}\n\nexport default ResidueProxy\n","/**\n * @file Polymer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// import { Log } from '../globals'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Polymer\n */\nclass Polymer {\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueCount: number\n\n  isPrevConnected: boolean\n  isNextConnected: boolean\n  isNextNextConnected: boolean\n  isCyclic: boolean\n\n  private __residueProxy: ResidueProxy\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} residueIndexStart - the index of the first residue\n   * @param {Integer} residueIndexEnd - the index of the last residue\n   */\n  constructor (readonly structure: Structure, readonly residueIndexStart: number, readonly residueIndexEnd: number) {\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n\n    /**\n     * @type {Integer}\n     */\n    this.residueCount = residueIndexEnd - residueIndexStart + 1\n\n    const rpStart = this.structure.getResidueProxy(this.residueIndexStart)\n    const rpEnd = this.structure.getResidueProxy(this.residueIndexEnd)\n    this.isPrevConnected = rpStart.getPreviousConnectedResidue() !== undefined\n    const rpNext = rpEnd.getNextConnectedResidue()\n    this.isNextConnected = rpNext !== undefined\n    this.isNextNextConnected = rpNext !== undefined && rpNext.getNextConnectedResidue() !== undefined\n    this.isCyclic = rpEnd.connectedTo(rpStart)\n\n    this.__residueProxy = this.structure.getResidueProxy()\n\n    // console.log( this.qualifiedName(), this );\n  }\n\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.residueIndexStart ]\n  }\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n\n  /**\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * If first residue is from aprotein\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isProtein()\n  }\n\n  /**\n   * If atom is part of a coarse-grain group\n   * @return {Boolean} flag\n   */\n  isCg () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isCg()\n  }\n\n  /**\n   * If atom is part of a nucleic molecule\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isNucleic()\n  }\n\n  getMoleculeType () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.moleculeType\n  }\n\n  getBackboneType (position: number) {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.getBackboneType(position)\n  }\n\n  getAtomIndexByType (index: number, type: string) {\n    // TODO pre-calculate, add to residueStore???\n\n    if (this.isCyclic) {\n      if (index === -1) {\n        index = this.residueCount - 1\n      } else if (index === this.residueCount) {\n        index = 0\n      }\n    } else {\n      if (index === -1 && !this.isPrevConnected) index += 1\n      if (index === this.residueCount && !this.isNextNextConnected) index -= 1\n      // if( index === this.residueCount - 1 && !this.isNextConnected ) index -= 1;\n    }\n\n    const rp = this.__residueProxy\n    rp.index = this.residueIndexStart + index\n    let aIndex\n\n    switch (type) {\n      case 'trace':\n        aIndex = rp.traceAtomIndex\n        break\n      case 'direction1':\n        aIndex = rp.direction1AtomIndex\n        break\n      case 'direction2':\n        aIndex = rp.direction2AtomIndex\n        break\n      default:\n        aIndex = rp.getAtomIndexByName(type)\n    }\n\n    // if (!ap){\n    //   console.log(this, type, rp.residueType)\n    //   // console.log(rp.qualifiedName(), rp.index, index, this.residueCount - 1)\n    //   // rp.index = this.residueIndexStart;\n    //   // console.log(rp.qualifiedName(), this.residueIndexStart)\n    //   // rp.index = this.residueIndexEnd;\n    //   // console.log(rp.qualifiedName(), this.residueIndexEnd)\n    // }\n\n    return aIndex\n  }\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachResidue(function (rp) {\n      rp.eachAtom(callback, selection)\n    })\n  }\n\n  eachAtomN (n: number, callback: (...apArray: AtomProxy[]) => void, type: string) {\n    const m = this.residueCount\n    const array: AtomProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.structure.getAtomProxy(this.getAtomIndexByType(i, type))\n    }\n    callback.apply(this, array)\n\n    for (var j = n; j < m; ++j) {\n      for (let i = 1; i < n; ++i) {\n        array[ i - 1 ].index = array[ i ].index\n      }\n      array[ n - 1 ].index = this.getAtomIndexByType(j, type)!  // TODO\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void) {\n    const rp = this.structure.getResidueProxy()\n    const n = this.residueCount\n    const rStartIndex = this.residueIndexStart\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = rStartIndex + i\n      callback(rp)\n    }\n  }\n\n  qualifiedName () {\n    const rpStart = this.structure.getResidueProxy(this.residueIndexStart)\n    const rpEnd = this.structure.getResidueProxy(this.residueIndexEnd)\n    return rpStart.qualifiedName() + ' - ' + rpEnd.qualifiedName()\n  }\n}\n\nexport default Polymer\n","/**\n * @file Chain Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { UnknownBackboneType } from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\n\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from './model-proxy';\nimport Entity from '../structure/entity';\n\n/**\n * Chain proxy\n */\nclass ChainProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n  }\n\n  /**\n   * Entity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  /**\n   * Model\n   * @type {ModelProxy}\n   */\n  get model (): ModelProxy {\n    return this.structure.getModelProxy(this.modelIndex)\n  }\n\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.index ]\n  }\n  set entityIndex (value) {\n    this.chainStore.entityIndex[ this.index ] = value\n  }\n\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.index ]\n  }\n  set modelIndex (value) {\n    this.chainStore.modelIndex[ this.index ] = value\n  }\n\n  get residueOffset () {\n    return this.chainStore.residueOffset[ this.index ]\n  }\n  set residueOffset (value) {\n    this.chainStore.residueOffset[ this.index ] = value\n  }\n\n  /**\n   * Residue count\n   * @type {Integer}\n   */\n  get residueCount () {\n    return this.chainStore.residueCount[ this.index ]\n  }\n  set residueCount (value) {\n    this.chainStore.residueCount[ this.index ] = value\n  }\n\n  get residueEnd () {\n    return this.residueOffset + this.residueCount - 1\n  }\n\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.residueOffset ]\n  }\n  get atomEnd () {\n    return (\n      this.residueStore.atomOffset[ this.residueEnd ] +\n      this.residueStore.atomCount[ this.residueEnd ] - 1\n    )\n  }\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    if (this.residueCount === 0) {\n      return 0\n    } else {\n      return this.atomEnd - this.atomOffset + 1\n    }\n  }\n\n  //\n\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.index)\n  }\n  set chainname (value) {\n    this.chainStore.setChainname(this.index, value)\n  }\n\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.index)\n  }\n  set chainid (value) {\n    this.chainStore.setChainid(this.index, value)\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachResidue(function (rp) {\n      rp.eachAtom(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void, selection?: Selection) {\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const rp = this.structure._rp\n    const end = offset + count\n\n    if (selection && selection.test) {\n      const residueOnlyTest = selection.residueOnlyTest\n      if (residueOnlyTest) {\n        for (let i = offset; i < end; ++i) {\n          rp.index = i\n          if (residueOnlyTest(rp)) {\n            callback(rp)\n          }\n        }\n      } else {\n        for (let i = offset; i < end; ++i) {\n          rp.index = i\n          callback(rp)\n        }\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        rp.index = i\n        callback(rp)\n      }\n    }\n  }\n\n  /**\n   * Multi-residue iterator\n   * @param {Integer} n - window size\n   * @param  {function(residueList: ResidueProxy[])} callback - the callback\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (...rpArray: ResidueProxy[]) => void) {\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const end = offset + count\n    if (count < n) return\n    const array: ResidueProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.structure.getResidueProxy(offset + i)\n    }\n    callback.apply(this, array)\n\n    for (let j = offset + n; j < end; ++j) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ].index += 1\n      }\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (p: Polymer) => void, selection?: Selection) {\n    let rStartIndex = 0\n    let rNextIndex = 0\n    const test = selection ? selection.residueOnlyTest : undefined\n    const structure = this.model.structure\n\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const end = offset + count\n\n    const rp1 = this.structure.getResidueProxy()\n    const rp2 = this.structure.getResidueProxy(offset)\n\n    const ap1 = this.structure.getAtomProxy()\n    const ap2 = this.structure.getAtomProxy()\n\n    let first = true\n\n    for (let i = offset + 1; i < end; ++i) {\n      rp1.index = rp2.index\n      rp2.index = i\n\n      const bbType1 = first ? rp1.backboneEndType : rp1.backboneType\n      const bbType2 = rp2.backboneType\n\n      if (first) {\n        rStartIndex = rp1.index\n        first = false\n      }\n      rNextIndex = rp2.index\n\n      if (bbType1 !== UnknownBackboneType && bbType1 === bbType2) {\n        ap1.index = rp1.backboneEndAtomIndex\n        ap2.index = rp2.backboneStartAtomIndex\n      } else {\n        if (bbType1 !== UnknownBackboneType) {\n          if (rp1.index - rStartIndex > 1) {\n            // console.log(\"FOO1\",rStartIndex, rp1.index)\n            callback(new Polymer(structure, rStartIndex, rp1.index))\n          }\n        }\n        rStartIndex = rNextIndex\n\n        continue\n      }\n\n      if (!ap1 || !ap2 || !ap1.connectedTo(ap2) ||\n        (test && (!test(rp1) || !test(rp2)))\n      ) {\n        if (rp1.index - rStartIndex > 1) {\n          // console.log(\"FOO2\",rStartIndex, rp1.index)\n          callback(new Polymer(structure, rStartIndex, rp1.index))\n        }\n        rStartIndex = rNextIndex\n      }\n    }\n\n    if (rNextIndex - rStartIndex > 1) {\n      if (this.structure.getResidueProxy(rStartIndex).backboneEndType) {\n        // console.log(\"FOO3\",rStartIndex, rNextIndex)\n        callback(new Polymer(structure, rStartIndex, rNextIndex))\n      }\n    }\n  }\n\n  //\n\n  qualifiedName () {\n    var name = ':' + this.chainname + '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ChainProxy} cloned chain\n   */\n  clone () {\n    return new ChainProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      residueOffset: this.residueOffset,\n      residueCount: this.residueCount,\n\n      chainname: this.chainname\n    }\n  }\n}\n\nexport default ChainProxy\n","/**\n * @file Model Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ModelStore from '../store/model-store'\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\n\nimport ChainProxy from '../proxy/chain-proxy'\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Model proxy\n */\nclass ModelProxy {\n  index: number\n\n  modelStore: ModelStore\n  chainStore: ChainStore\n  residueStore: ResidueStore\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.modelStore = structure.modelStore\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n  }\n\n  get chainOffset () {\n    return this.modelStore.chainOffset[ this.index ]\n  }\n  set chainOffset (value) {\n    this.modelStore.chainOffset[ this.index ] = value\n  }\n\n  get chainCount () {\n    return this.modelStore.chainCount[ this.index ]\n  }\n  set chainCount (value) {\n    this.modelStore.chainCount[ this.index ] = value\n  }\n\n  get residueOffset () {\n    return this.chainStore.residueOffset[ this.chainOffset ]\n  }\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.residueOffset ]\n  }\n\n  get chainEnd () {\n    return this.chainOffset + this.chainCount - 1\n  }\n  get residueEnd () {\n    return (\n      this.chainStore.residueOffset[ this.chainEnd ] +\n      this.chainStore.residueCount[ this.chainEnd ] - 1\n    )\n  }\n  get atomEnd () {\n    return (\n      this.residueStore.atomOffset[ this.residueEnd ] +\n      this.residueStore.atomCount[ this.residueEnd ] - 1\n    )\n  }\n\n  /**\n   * Residue count\n   * @type {Integer}\n   */\n  get residueCount () {\n    if (this.chainCount === 0) {\n      return 0\n    } else {\n      return this.residueEnd - this.residueOffset + 1\n    }\n  }\n\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    if (this.residueCount === 0) {\n      return 0\n    } else {\n      return this.atomEnd - this.atomOffset + 1\n    }\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachChain(function (cp) {\n      cp.eachAtom(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void, selection?: Selection) {\n    this.eachChain(function (cp) {\n      cp.eachResidue(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (p: Polymer) => void, selection?: Selection) {\n    if (selection && selection.chainOnlyTest) {\n      const chainOnlyTest = selection.chainOnlyTest\n\n      this.eachChain(function (cp) {\n        if (chainOnlyTest(cp)) {\n          cp.eachPolymer(callback, selection)\n        }\n      })\n    } else {\n      this.eachChain(function (cp) {\n        cp.eachPolymer(callback, selection)\n      })\n    }\n  }\n\n  /**\n   * Chain iterator\n   * @param  {function(chain: ChainProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachChain (callback: (cp: ChainProxy) => void, selection?: Selection) {\n    const count = this.chainCount\n    const offset = this.chainOffset\n    const cp = this.structure._cp\n    const end = offset + count\n\n    if (selection && selection.test) {\n      const chainOnlyTest = selection.chainOnlyTest\n      if (chainOnlyTest) {\n        for (let i = offset; i < end; ++i) {\n          cp.index = i\n          if (chainOnlyTest(cp)) {\n            callback(cp)\n          }\n        }\n      } else {\n        for (let i = offset; i < end; ++i) {\n          cp.index = i\n          callback(cp)\n        }\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        cp.index = i\n        callback(cp)\n      }\n    }\n  }\n\n  //\n\n  qualifiedName () {\n    const name = '/' + this.index\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ModelProxy} cloned model\n   */\n  clone () {\n    return new ModelProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      chainOffset: this.chainOffset,\n      chainCount: this.chainCount\n    }\n  }\n}\n\nexport default ModelProxy\n","/**\n * @file Structure\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\nimport { Signal } from 'signals'\nimport { CifBlock } from 'molstar/lib/mol-io/reader/cif'\n\nimport { Debug, Log, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AtomPicker, BondPicker } from '../utils/picker'\nimport { copyWithin, arrayMin, arrayMax } from '../math/array-utils'\nimport BitArray from '../utils/bitarray'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { Matrix } from '../math/matrix-utils'\nimport PrincipalAxes from '../math/principal-axes'\nimport SpatialHash from '../geometry/spatial-hash'\nimport FilteredVolume from '../surface/filtered-volume'\nimport StructureView from './structure-view'\nimport { AtomDataParams, AtomData, BondDataParams, BondData } from './structure-data'\nimport { Data, createData } from './data'\n\nimport Entity from './entity'\nimport Unitcell from '../symmetry/unitcell'\nimport Validation from './validation'\nimport Selection from '../selection/selection'\nimport Assembly from '../symmetry/assembly'\nimport Volume from '../surface/volume'\nimport Polymer from '../proxy/polymer'\n\nimport BondHash from '../store/bond-hash'\nimport BondStore from '../store/bond-store'\nimport AtomStore from '../store/atom-store'\nimport ResidueStore from '../store/residue-store'\nimport ChainStore from '../store/chain-store'\nimport ModelStore from '../store/model-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\nimport ChemCompMap from '../store/chemcomp-map'\n\ninterface Structure {\n  signals: StructureSignals\n\n  name: string\n  path: string\n  title: string\n  id: string\n\n  data: Data\n\n  atomCount: number\n  bondCount: number\n\n  header: StructureHeader\n  extraData: StructureExtraData\n\n  atomSetCache: { [k: string]: BitArray }\n  atomSetDict: { [k: string]: BitArray }\n  biomolDict: { [k: string]: Assembly }\n\n  entityList: Entity[]\n  unitcell?: Unitcell\n\n  frames: Float32Array[]\n  boxes: Float32Array[]\n\n  validation?: Validation\n\n  bondStore: BondStore\n  backboneBondStore: BondStore\n  rungBondStore: BondStore\n  atomStore: AtomStore\n  residueStore: ResidueStore\n  chainStore: ChainStore\n  modelStore: ModelStore\n\n  atomMap: AtomMap\n  residueMap: ResidueMap\n  chemCompMap?: ChemCompMap\n\n  bondHash?: BondHash\n  spatialHash?: SpatialHash\n\n  atomSet?: BitArray\n  bondSet?: BitArray\n\n  center: Vector3\n  boundingBox: Box3\n\n  trajectory?: {\n    name: string\n    frame: number\n  }\n\n  getView(selection: Selection): StructureView\n\n  _hasCoords?: boolean\n\n  _bp: BondProxy\n  _ap: AtomProxy\n  _rp: ResidueProxy\n  _cp: ChainProxy\n}\n\nexport type StructureHeader = {\n  releaseDate?: string\n  depositionDate?: string\n  resolution?: number\n  rFree?: number\n  rWork?: number\n  experimentalMethods?: string[]\n}\n\nexport type StructureExtraData = {\n  cif?: CifBlock\n  sdf?: object[]\n}\n\nexport type StructureSignals = {\n  refreshed: Signal\n}\n\n/**\n * Structure\n */\nclass Structure implements Structure{\n  signals: StructureSignals = {\n    refreshed: new Signal()\n  }\n\n  /**\n   * @param {String} name - structure name\n   * @param {String} path - source path\n   */\n  constructor (name = '', path = '') {\n    this.init(name, path)\n  }\n\n  init (name: string, path: string) {\n    this.name = name\n    this.path = path\n    this.title = ''\n    this.id = ''\n\n    this.data = createData(this)\n\n    this.header = {}\n    this.extraData = {}\n\n    this.atomSetCache = {}\n    this.atomSetDict = {}\n    this.biomolDict = {}\n\n    this.entityList = []\n    this.unitcell = undefined\n\n    this.frames = []\n    this.boxes = []\n\n    this.validation = undefined\n\n    this.bondStore = new BondStore(0)\n    this.backboneBondStore = new BondStore(0)\n    this.rungBondStore = new BondStore(0)\n    this.atomStore = new AtomStore(0)\n    this.residueStore = new ResidueStore(0)\n    this.chainStore = new ChainStore(0)\n    this.modelStore = new ModelStore(0)\n\n    this.atomMap = new AtomMap(this)\n    this.residueMap = new ResidueMap(this)\n    this.chemCompMap = undefined\n\n    this.bondHash = undefined\n    this.spatialHash = undefined\n\n    this.atomSet = undefined\n    this.bondSet = undefined\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this._bp = this.getBondProxy()\n    this._ap = this.getAtomProxy()\n    this._rp = this.getResidueProxy()\n    this._cp = this.getChainProxy()\n  }\n\n  get type () { return 'Structure' }\n\n  finalizeAtoms () {\n    this.atomSet = this.getAtomSet()\n    this.atomCount = this.atomStore.count\n    this.boundingBox = this.getBoundingBox(undefined, this.boundingBox)\n    this.center = this.boundingBox.getCenter(new Vector3())\n    this.spatialHash = new SpatialHash(this.atomStore, this.boundingBox)\n  }\n\n  finalizeBonds () {\n    this.bondSet = this.getBondSet()\n    this.bondCount = this.bondStore.count\n    this.bondHash = new BondHash(this.bondStore, this.atomStore.count)\n\n    this.atomSetCache = {}\n    if (!this.atomSetDict.rung) {\n      this.atomSetDict.rung = this.getAtomSet(false)\n    }\n\n    for (let name in this.atomSetDict) {\n      this.atomSetCache[ '__' + name ] = this.atomSetDict[ name ].clone()\n    }\n  }\n\n  //\n\n  getBondProxy (index?: number) {\n    return new BondProxy(this, index)\n  }\n\n  getAtomProxy (index?: number) {\n    return new AtomProxy(this, index)\n  }\n\n  getResidueProxy (index?: number) {\n    return new ResidueProxy(this, index)\n  }\n\n  getChainProxy (index?: number) {\n    return new ChainProxy(this, index)\n  }\n\n  getModelProxy (index?: number) {\n    return new ModelProxy(this, index)\n  }\n\n  //\n\n  getBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.bondStore.count\n    const bondSet = new BitArray(n)\n    const atomSet = this.atomSet\n\n    if (atomSet) {\n      if (atomSet.isAllSet()) {\n        bondSet.setAll()\n      } else if (atomSet.isAllClear()) {\n        bondSet.clearAll()\n      } else {\n        const bp = this.getBondProxy()\n\n        for (let i = 0; i < n; ++i) {\n          bp.index = i\n          if (atomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n            bondSet.set(bp.index)\n          }\n        }\n      }\n    } else {\n      bondSet.setAll()\n    }\n\n    return bondSet\n  }\n\n  getBackboneBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.backboneBondStore.count\n    const backboneBondSet = new BitArray(n)\n    const backboneAtomSet = this.atomSetCache.__backbone\n\n    if (backboneAtomSet) {\n      const bp = this.getBondProxy()\n      bp.bondStore = this.backboneBondStore\n\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        if (backboneAtomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n          backboneBondSet.set(bp.index)\n        }\n      }\n    } else {\n      backboneBondSet.setAll()\n    }\n\n    return backboneBondSet\n  }\n\n  getRungBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.rungBondStore.count\n    const rungBondSet = new BitArray(n)\n    const rungAtomSet = this.atomSetCache.__rung\n\n    if (rungAtomSet) {\n      const bp = this.getBondProxy()\n      bp.bondStore = this.rungBondStore\n\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        if (rungAtomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n          rungBondSet.set(bp.index)\n        }\n      }\n    } else {\n      rungBondSet.setAll()\n    }\n\n    return rungBondSet\n  }\n\n  /**\n   * Get a set of atoms\n   * @param  {Boolean|Selection|BitArray} selection - object defining how to\n   *                                      initialize the atom set.\n   *                                      Boolean: init with value;\n   *                                      Selection: init with selection;\n   *                                      BitArray: return bit array\n   * @return {BitArray} set of atoms\n   */\n  getAtomSet (selection?: boolean|Selection|BitArray) {\n    const n = this.atomStore.count\n\n    if (selection === undefined) {\n      return new BitArray(n, true)\n    } else if (selection instanceof BitArray) {\n      return selection\n    } else if (selection === true) {\n      return new BitArray(n, true)\n    } else if (selection && selection.test) {\n      const seleString = selection.string\n      if (seleString in this.atomSetCache) {\n        return this.atomSetCache[ seleString ]\n      } else {\n        if (seleString === '') {\n          return new BitArray(n, true)\n        } else {\n          const atomSet = new BitArray(n)\n          this.eachAtom(function (ap: AtomProxy) {\n            atomSet.set(ap.index)\n          }, selection)\n          this.atomSetCache[ seleString ] = atomSet\n          return atomSet\n        }\n      }\n    } else if (selection === false) {\n      return new BitArray(n)\n    }\n\n    return new BitArray(n, true)\n  }\n\n  /**\n   * Get set of atoms around a set of atoms from a selection\n   * @param  {Selection} selection - the selection object\n   * @param  {Number} radius - radius to select within\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinSelection (selection: boolean|Selection|BitArray, radius: number) {\n    const spatialHash = this.spatialHash\n    const atomSet = this.getAtomSet(false)\n    const ap = this.getAtomProxy()\n\n    if (!spatialHash) return atomSet\n\n    this.getAtomSet(selection).forEach(function (idx: number) {\n      ap.index = idx\n      spatialHash.within(ap.x, ap.y, ap.z, radius).forEach(function (idx2: number) {\n        atomSet.set(idx2)\n      })\n    })\n\n    return atomSet\n  }\n\n  /**\n   * Get set of atoms around a point\n   * @param  {Vector3|AtomProxy} point - the point\n   * @param  {Number} radius - radius to select within\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinPoint (point: Vector3|AtomProxy, radius: number) {\n    const p = point\n    const atomSet = this.getAtomSet(false)\n\n    if (!this.spatialHash) return atomSet\n\n    this.spatialHash.within(p.x, p.y, p.z, radius).forEach(function (idx: number) {\n      atomSet.set(idx)\n    })\n\n    return atomSet\n  }\n\n  /**\n   * Get set of atoms within a volume\n   * @param  {Volume} volume - the volume\n   * @param  {Number} radius - radius to select within\n   * @param  {[type]} minValue - minimum value to be considered as within the volume\n   * @param  {[type]} maxValue - maximum value to be considered as within the volume\n   * @param  {[type]} outside - use only values falling outside of the min/max values\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinVolume (volume: Volume, radius: number, minValue: number, maxValue: number, outside: boolean) {\n    const fv = new FilteredVolume(volume, minValue, maxValue, outside) as any  // TODO\n\n    const dp = fv.getDataPosition()\n    const n = dp.length\n    const r = fv.matrix.getMaxScaleOnAxis()\n    const atomSet = this.getAtomSet(false)\n\n    if (!this.spatialHash) return atomSet\n\n    for (let i = 0; i < n; i += 3) {\n      this.spatialHash.within(dp[ i ], dp[ i + 1 ], dp[ i + 2 ], r).forEach(function (idx) {\n        atomSet.set(idx)\n      })\n    }\n\n    return atomSet\n  }\n\n  /**\n   * Get set of all atoms within the groups of a selection\n   * @param  {Selection} selection - the selection object\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinGroup (selection: boolean|Selection|BitArray) {\n    const atomResidueIndex = this.atomStore.residueIndex\n    const atomSet = this.getAtomSet(false)\n    const rp = this.getResidueProxy()\n\n    this.getAtomSet(selection).forEach(function (idx) {\n      rp.index = atomResidueIndex[ idx ]\n      for (let idx2 = rp.atomOffset; idx2 <= rp.atomEnd; ++idx2) {\n        atomSet.set(idx2)\n      }\n    })\n\n    return atomSet\n  }\n\n  //\n\n  getSelection (): undefined|Selection {\n    return\n  }\n\n  getStructure (): Structure|StructureView {\n    return this\n  }\n\n  /**\n   * Entity iterator\n   * @param  {function(entity: Entity)} callback - the callback\n   * @param  {EntityType} type - entity type\n   * @return {undefined}\n   */\n  eachEntity (callback: (entity: Entity) => void, type: number) {\n    this.entityList.forEach(function (entity) {\n      if (type === undefined || entity.getEntityType() === type) {\n        callback(entity)\n      }\n    })\n  }\n\n  /**\n   * Bond iterator\n   * @param  {function(bond: BondProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachBond (callback: (entity: BondProxy) => void, selection?: Selection) {\n    const bp = this.getBondProxy()\n    let bondSet\n\n    if (selection && selection.test) {\n      bondSet = this.getBondSet(/*selection*/)\n      if (this.bondSet) {\n        bondSet.intersection(this.bondSet)\n      }\n    }\n\n    if (bondSet) {\n      bondSet.forEach(function (index) {\n        bp.index = index\n        callback(bp)\n      })\n    } else {\n      const n = this.bondStore.count\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        callback(bp)\n      }\n    }\n  }\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (entity: AtomProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      this.eachModel(function (mp) {\n        mp.eachAtom(callback, selection)\n      }, selection)\n    } else {\n      const an = this.atomStore.count\n      const ap = this.getAtomProxy()\n      for (let i = 0; i < an; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (entity: ResidueProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      const mn = this.modelStore.count\n      const mp = this.getModelProxy()\n      const modelOnlyTest = selection.modelOnlyTest\n      if (modelOnlyTest) {\n        for (let i = 0; i < mn; ++i) {\n          mp.index = i\n          if (modelOnlyTest(mp)) {\n            mp.eachResidue(callback, selection)\n          }\n        }\n      } else {\n        for (let i = 0; i < mn; ++i) {\n          mp.index = i\n          mp.eachResidue(callback, selection)\n        }\n      }\n    } else {\n      const rn = this.residueStore.count\n      const rp = this.getResidueProxy()\n      for (let i = 0; i < rn; ++i) {\n        rp.index = i\n        callback(rp)\n      }\n    }\n  }\n\n  /**\n   * Multi-residue iterator\n   * @param {Integer} n - window size\n   * @param  {function(residueList: ResidueProxy[])} callback - the callback\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (...entityArray: ResidueProxy[]) => void) {\n    const rn = this.residueStore.count\n    if (rn < n) return\n    const array: ResidueProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.getResidueProxy(i)\n    }\n    callback.apply(this, array)\n\n    for (let j = n; j < rn; ++j) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ].index += 1\n      }\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (entity: Polymer) => void, selection?: Selection) {\n    if (selection && selection.modelOnlyTest) {\n      const modelOnlyTest = selection.modelOnlyTest\n\n      this.eachModel(function (mp) {\n        if (modelOnlyTest(mp)) {\n          mp.eachPolymer(callback, selection)\n        }\n      })\n    } else {\n      this.eachModel(function (mp) {\n        mp.eachPolymer(callback, selection)\n      })\n    }\n  }\n\n  /**\n   * Chain iterator\n   * @param  {function(chain: ChainProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachChain (callback: (entity: ChainProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      this.eachModel(function (mp) {\n        mp.eachChain(callback, selection)\n      })\n    } else {\n      const cn = this.chainStore.count\n      const cp = this.getChainProxy()\n      for (let i = 0; i < cn; ++i) {\n        cp.index = i\n        callback(cp)\n      }\n    }\n  }\n\n  /**\n   * Model iterator\n   * @param  {function(model: ModelProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachModel (callback: (entity: ModelProxy) => void, selection?: Selection) {\n    const n = this.modelStore.count\n    const mp = this.getModelProxy()\n\n    if (selection && selection.test) {\n      const modelOnlyTest = selection.modelOnlyTest\n      if (modelOnlyTest) {\n        for (let i = 0; i < n; ++i) {\n          mp.index = i\n          if (modelOnlyTest(mp)) {\n            callback(mp)\n          }\n        }\n      } else {\n        for (let i = 0; i < n; ++i) {\n          mp.index = i\n          callback(mp)\n        }\n      }\n    } else {\n      for (let i = 0; i < n; ++i) {\n        mp.index = i\n        callback(mp)\n      }\n    }\n  }\n\n  //\n\n  getAtomData (params: AtomDataParams) {\n    const p = Object.assign({}, params)\n    if (p.colorParams) p.colorParams.structure = this.getStructure()\n\n    const what = p.what\n    const atomSet = defaults(p.atomSet, this.atomSet)\n\n    let radiusFactory: any  // TODO\n    let colormaker: any  // TODO\n\n    const atomData: AtomData = {}\n    const ap = this.getAtomProxy()\n    const atomCount = atomSet.getSize()\n\n    if (!what || what.position) {\n      atomData.position = new Float32Array(atomCount * 3)\n    }\n    if ((!what || what.color) && p.colorParams) {\n      atomData.color = new Float32Array(atomCount * 3)\n      colormaker = ColormakerRegistry.getScheme(p.colorParams)\n    }\n    if (!what || what.picking) {\n      atomData.picking = new AtomPicker(new Float32Array(atomCount), this.getStructure())\n    }\n    if (!what || what.radius) {\n      atomData.radius = new Float32Array(atomCount)\n      radiusFactory = new RadiusFactory(p.radiusParams as RadiusParams)\n    }\n    if (!what || what.index) {\n      atomData.index = new Uint32Array(atomCount)\n    }\n\n    const {position, color, picking, radius, index} = atomData\n\n    atomSet.forEach((idx: number, i: number) => {\n      const i3 = i * 3\n      ap.index = idx\n      if (position) {\n        ap.positionToArray(position, i3)\n      }\n      if (color) {\n        colormaker.atomColorToArray(ap, color, i3)\n      }\n      if (picking) {\n        picking.array![ i ] = idx\n      }\n      if (radius) {\n        radius[ i ] = radiusFactory.atomRadius(ap)\n      }\n      if (index) {\n        index[ i ] = idx\n      }\n    })\n    return atomData\n  }\n\n  getBondData (params: BondDataParams) {\n    const p = Object.assign({}, params)\n    if (p.colorParams) p.colorParams.structure = this.getStructure()\n\n    const what = p.what\n    const bondSet = defaults(p.bondSet, this.bondSet)\n    const multipleBond = defaults(p.multipleBond, 'off')\n    const isMulti = multipleBond !== 'off'\n    const isOffset = multipleBond === 'offset'\n    const bondScale = defaults(p.bondScale, 0.4)\n    const bondSpacing = defaults(p.bondSpacing, 1.0)\n\n    let radiusFactory: any  // TODO\n    let colormaker: any  // TODO\n\n    const bondData: BondData = {}\n    const bp = this.getBondProxy()\n    if (p.bondStore) bp.bondStore = p.bondStore\n    const ap1 = this.getAtomProxy()\n    const ap2 = this.getAtomProxy()\n\n    let bondCount: number\n    if (isMulti) {\n      const storeBondOrder = bp.bondStore.bondOrder\n      bondCount = 0\n      bondSet.forEach(function (index: number) {\n        bondCount += storeBondOrder[ index ]\n      })\n    } else {\n      bondCount = bondSet.getSize()\n    }\n\n    if (!what || what.position) {\n      bondData.position1 = new Float32Array(bondCount * 3)\n      bondData.position2 = new Float32Array(bondCount * 3)\n    }\n    if ((!what || what.color) && p.colorParams) {\n      bondData.color = new Float32Array(bondCount * 3)\n      bondData.color2 = new Float32Array(bondCount * 3)\n      colormaker = ColormakerRegistry.getScheme(p.colorParams)\n    }\n    if (!what || what.picking) {\n      bondData.picking = new BondPicker(new Float32Array(bondCount), this.getStructure(), p.bondStore)\n    }\n    if (!what || what.radius || (isMulti && what.position)) {\n      radiusFactory = new RadiusFactory(p.radiusParams as RadiusParams)\n    }\n    if (!what || what.radius) {\n      bondData.radius = new Float32Array(bondCount)\n      if (p.radius2) {\n        bondData.radius2 = new Float32Array(bondCount)\n      }\n    }\n\n    const {position1, position2, color, color2, picking, radius, radius2} = bondData\n\n    let i = 0\n    let j, i3, k, bondOrder, absOffset\n    let multiRadius\n\n    const vt = new Vector3()\n    const vShortening = new Vector3()\n    const vShift = new Vector3()\n\n    bondSet.forEach((index: number) => {\n      i3 = i * 3\n      bp.index = index\n      ap1.index = bp.atomIndex1\n      ap2.index = bp.atomIndex2\n      bondOrder = bp.bondOrder\n      if (position1) {\n        if (isMulti && bondOrder > 1) {\n          const atomRadius = radiusFactory.atomRadius(ap1)\n          multiRadius = atomRadius * bondScale / (0.5 * bondOrder)\n\n          bp.calculateShiftDir(vShift)\n\n          if (isOffset) {\n            absOffset = 2 * bondSpacing * atomRadius\n            vShift.multiplyScalar(absOffset)\n            vShift.negate()\n\n            // Shortening is calculated so that neighbouring double\n            // bonds on tetrahedral geometry (e.g. sulphonamide)\n            // are not quite touching (arccos(1.9 / 2) ~ 109deg)\n            // but don't shorten beyond 10% each end or it looks odd\n            vShortening.subVectors(ap2 as any, ap1 as any).multiplyScalar(  // TODO\n              Math.max(0.1, absOffset / 1.88)\n            )\n            ap1.positionToArray(position1, i3)\n            ap2.positionToArray(position2, i3)\n\n            if (bondOrder >= 2) {\n              vt.addVectors(ap1 as any, vShift).add(vShortening).toArray(position1 as any, i3 + 3)  // TODO\n              vt.addVectors(ap2 as any, vShift).sub(vShortening).toArray(position2 as any, i3 + 3)  // TODO\n\n              if (bondOrder >= 3) {\n                vt.subVectors(ap1 as any, vShift).add(vShortening).toArray(position1 as any, i3 + 6)  // TODO\n                vt.subVectors(ap2 as any, vShift).sub(vShortening).toArray(position2 as any, i3 + 6)  // TODO\n              }\n            }\n          } else {\n            absOffset = (bondSpacing - bondScale) * atomRadius\n            vShift.multiplyScalar(absOffset)\n\n            if (bondOrder === 2) {\n              vt.addVectors(ap1 as any, vShift).toArray(position1 as any, i3)  // TODO\n              vt.subVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 3)  // TODO\n              vt.addVectors(ap2 as any, vShift).toArray(position2 as any, i3)  // TODO\n              vt.subVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 3)  // TODO\n            } else if (bondOrder === 3) {\n              ap1.positionToArray(position1, i3)\n              vt.addVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 3)  // TODO\n              vt.subVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 6)  // TODO\n              ap2.positionToArray(position2, i3)\n              vt.addVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 3)  // TODO\n              vt.subVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 6)  // TODO\n            } else {\n              // todo, better fallback\n              ap1.positionToArray(position1, i3)\n              ap2.positionToArray(position2, i3)\n            }\n          }\n        } else {\n          ap1.positionToArray(position1, i3)\n          ap2.positionToArray(position2, i3)\n        }\n      }\n      if (color && color2) {\n        colormaker.bondColorToArray(bp, 1, color, i3)\n        colormaker.bondColorToArray(bp, 0, color2, i3)\n        if (isMulti && bondOrder > 1) {\n          for (j = 1; j < bondOrder; ++j) {\n            k = j * 3 + i3\n            copyWithin(color, i3, k, 3)\n            copyWithin(color2, i3, k, 3)\n          }\n        }\n      }\n      if (picking && picking.array) {\n        picking.array[ i ] = index\n        if (isMulti && bondOrder > 1) {\n          for (j = 1; j < bondOrder; ++j) {\n            picking.array[ i + j ] = index\n          }\n        }\n      }\n      if (radius) {\n        radius[ i ] = radiusFactory.atomRadius(ap1)\n        if (isMulti && bondOrder > 1) {\n          multiRadius = radius[ i ] * bondScale / (isOffset ? 1 : (0.5 * bondOrder))\n          for (j = isOffset ? 1 : 0; j < bondOrder; ++j) {\n            radius[ i + j ] = multiRadius\n          }\n        }\n      }\n      if (radius2) {\n        radius2[ i ] = radiusFactory.atomRadius(ap2)\n        if (isMulti && bondOrder > 1) {\n          multiRadius = radius2[ i ] * bondScale / (isOffset ? 1 : (0.5 * bondOrder))\n          for (j = isOffset ? 1 : 0; j < bondOrder; ++j) {\n            radius2[ i + j ] = multiRadius\n          }\n        }\n      }\n      i += isMulti ? bondOrder : 1\n    })\n\n    return bondData\n  }\n\n  getBackboneAtomData (params: AtomDataParams) {\n    params = Object.assign({\n      atomSet: this.atomSetCache.__backbone\n    }, params)\n\n    return this.getAtomData(params)\n  }\n\n  getBackboneBondData (params: BondDataParams) {\n    params = Object.assign({\n      bondSet: this.getBackboneBondSet(),\n      bondStore: this.backboneBondStore\n    }, params)\n\n    return this.getBondData(params)\n  }\n\n  getRungAtomData (params: AtomDataParams) {\n    params = Object.assign({\n      atomSet: this.atomSetCache.__rung\n    }, params)\n\n    return this.getAtomData(params)\n  }\n\n  getRungBondData (params: BondDataParams) {\n    params = Object.assign({\n      bondSet: this.getRungBondSet(),\n      bondStore: this.rungBondStore\n    }, params)\n\n    return this.getBondData(params)\n  }\n\n  //\n\n  /**\n   * Gets the bounding box of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @param  {Box3} [box] - optional target\n   * @return {Vector3} the box\n   */\n  getBoundingBox (selection?: Selection, box?: Box3) {\n    if (Debug) Log.time('getBoundingBox')\n\n    box = box || new Box3()\n\n    let minX = +Infinity\n    let minY = +Infinity\n    let minZ = +Infinity\n\n    let maxX = -Infinity\n    let maxY = -Infinity\n    let maxZ = -Infinity\n\n    this.eachAtom(ap => {\n      const x = ap.x\n      const y = ap.y\n      const z = ap.z\n\n      if (x < minX) minX = x\n      if (y < minY) minY = y\n      if (z < minZ) minZ = z\n\n      if (x > maxX) maxX = x\n      if (y > maxY) maxY = y\n      if (z > maxZ) maxZ = z\n    }, selection)\n\n    box.min.set(minX, minY, minZ)\n    box.max.set(maxX, maxY, maxZ)\n\n    if (Debug) Log.timeEnd('getBoundingBox')\n\n    return box\n  }\n\n  /**\n   * Gets the principal axes of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @return {PrincipalAxes} the principal axes\n   */\n  getPrincipalAxes (selection?: Selection) {\n    if (Debug) Log.time('getPrincipalAxes')\n\n    let i = 0\n    const coords = new Matrix(3, this.atomCount)\n    const cd = coords.data\n\n    this.eachAtom(a => {\n      cd[ i + 0 ] = a.x\n      cd[ i + 1 ] = a.y\n      cd[ i + 2 ] = a.z\n      i += 3\n    }, selection)\n\n    if (Debug) Log.timeEnd('getPrincipalAxes')\n\n    return new PrincipalAxes(coords)\n  }\n\n  /**\n   * Gets the center of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @return {Vector3} the center\n   */\n  atomCenter (selection?: Selection) {\n    if (selection) {\n      return this.getBoundingBox(selection).getCenter(new Vector3())\n    } else {\n      return this.center.clone()\n    }\n  }\n\n  hasCoords () {\n    if (this._hasCoords === undefined) {\n      const atomStore = this.atomStore\n      this._hasCoords = (\n        arrayMin(atomStore.x) !== 0 || arrayMax(atomStore.x) !== 0 ||\n        arrayMin(atomStore.y) !== 0 || arrayMax(atomStore.y) !== 0 ||\n        arrayMin(atomStore.z) !== 0 || arrayMax(atomStore.z) !== 0\n      ) || (\n        // allow models with a single atom at the origin\n        atomStore.count / this.modelStore.count === 1\n      )\n    }\n    return this._hasCoords;\n  }\n\n  getSequence (selection?: Selection) {\n    const seq: string[] = []\n    const rp = this.getResidueProxy()\n\n    this.eachAtom(function (ap: AtomProxy) {\n      rp.index = ap.residueIndex\n      if (ap.index === rp.traceAtomIndex) {\n        seq.push(rp.getResname1())\n      }\n    }, selection)\n\n    return seq\n  }\n\n  getAtomIndices (selection?: Selection) {\n    if (selection && selection.string) {\n      const indices: number[] = []\n      this.eachAtom(function (ap: AtomProxy) {\n        indices.push(ap.index)\n      }, selection)\n      return new Uint32Array(indices)\n    } else {\n      const p = { what: { index: true } }\n      return this.getAtomData(p).index\n    }\n  }\n\n  /**\n   * Get number of unique chainnames\n   * @param  {Selection} selection - limit count to selection\n   * @return {Integer} count\n   */\n  getChainnameCount (selection?: Selection) {\n    const chainnames = new Set()\n    this.eachChain(function (cp: ChainProxy) {\n      if (cp.residueCount) {\n        chainnames.add(cp.chainname)\n      }\n    }, selection)\n\n    return chainnames.size\n  }\n\n  /**\n   * Update atomic positions\n   * @param position - Array to copy positions from\n   * @param refresh - Whether or not to issue a full refresh (automatically\n   *                  triggers re-calculation of bounding boxes, spatial hash,\n   *                  representations etc etc). This provides compatibility with\n   *                  the old behaviour\n   */\n  updatePosition (position: Float32Array|number[], refresh: boolean = true) {\n    let i = 0\n\n    this.eachAtom(function (ap: AtomProxy) {\n      ap.positionFromArray(position, i)\n      i += 3\n    }, undefined)\n\n    this._hasCoords = undefined  // to trigger recalculation (of the _hasCoords value)\n\n    if (refresh) { \n      this.refreshPosition()  // Recalculate bounds - structure-component listener will \n                              // trigger representation rebuild\n    }\n\n  }\n\n  refreshPosition () {\n    this.getBoundingBox(undefined, this.boundingBox)\n    this.boundingBox.getCenter(this.center)\n    this.spatialHash = new SpatialHash(this.atomStore, this.boundingBox)\n\n    this.signals.refreshed.dispatch(this)\n  }\n\n  /**\n   * Calls dispose() method of property objects.\n   * Unsets properties to help garbage collection.\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.frames) this.frames.length = 0\n    if (this.boxes) this.boxes.length = 0\n\n    this.bondStore.dispose()\n    this.backboneBondStore.dispose()\n    this.rungBondStore.dispose()\n    this.atomStore.dispose()\n    this.residueStore.dispose()\n    this.chainStore.dispose()\n    this.modelStore.dispose()\n\n    // can't delete non-optional properties as of TS 4\n    // and since we've already disposed them, don't need to.\n\n    delete this.bondSet\n    delete this.atomSet\n  }\n}\n\nexport default Structure\n","/**\n * @file Shape\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Matrix4 required for declaration only\nimport { Box3, Vector3, Color, Matrix4 } from 'three'\n\nimport { createParams, ensureFloat32Array, getUintArray } from '../utils'\nimport {\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive, EllipsoidPrimitive,\n  OctahedronPrimitive, SpherePrimitive, TetrahedronPrimitive, TextPrimitive,\n  TorusPrimitive, PointPrimitive, WidelinePrimitive, IcosahedronPrimitive\n} from './primitive'\nimport { MeshPicker } from '../utils/picker'\nimport Buffer from '../buffer/buffer'\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport { TextBufferParameters } from '../buffer/text-buffer'\n\nconst tmpBox = new Box3()\n\nconst Primitives = [\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive,\n  EllipsoidPrimitive, OctahedronPrimitive, SpherePrimitive, TetrahedronPrimitive,\n  TextPrimitive, TorusPrimitive, PointPrimitive, WidelinePrimitive, IcosahedronPrimitive\n]\n\nexport const ShapeDefaultParameters = {\n  aspectRatio: 1.5,\n  sphereDetail: 2,\n  radialSegments: 50,\n  disableImpostor: false,\n  openEnded: false,\n  dashedCylinder: false,\n  labelParams: {} as Partial<TextBufferParameters>,\n  pointSize: 2,\n  sizeAttenuation: false,\n  useTexture: true,\n  linewidth: 2\n}\nexport type ShapeParameters = typeof ShapeDefaultParameters\n\n/**\n * Class for building custom shapes.\n *\n * @example\n * var shape = new NGL.Shape('shape', { disableImpostor: true });\n * shape.addSphere([ 0, 0, 9 ], [ 1, 0, 0 ], 1.5 );\n * shape.addEllipsoid([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n * shape.addCylinder([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n * shape.addCone([ 0, 2, 7 ], [ 0, 3, 3 ], [ 1, 1, 0 ], 1.5);\n * shape.addArrow([ 1, 2, 7 ], [ 30, 3, 3 ], [ 1, 0, 1 ], 1.0);\n * shape.addBox([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n * var shapeComp = stage.addComponentFromObject(shape);\n * geoComp.addRepresentation('buffer');\n */\nclass Shape {\n  name: string\n  parameters: ShapeParameters\n\n  boundingBox = new Box3()\n  bufferList: Buffer[] = []\n  meshCount = 0\n\n  _center?: Vector3\n  _primitiveData: { [k: string]: any } = {}\n\n  /**\n   * @param {String} name - name\n   * @param {Object} params - parameter object\n   * @param {Integer} params.aspectRatio - arrow aspect ratio, used for cylinder radius and cone length\n   * @param {Integer} params.sphereDetail - sphere quality (icosahedron subdivisions)\n   * @param {Integer} params.radialSegments - cylinder quality (number of segments)\n   * @param {Boolean} params.disableImpostor - disable use of raycasted impostors for rendering\n   * @param {Boolean} params.openEnded - capped or not\n   * @param {TextBufferParameters} params.labelParams - label parameters\n   */\n  constructor (name = 'shape', params: Partial<ShapeParameters> = {}) {\n    this.name = name\n\n    this.parameters = createParams(params, ShapeDefaultParameters)\n\n    Primitives.forEach(P => {\n      Object.keys(P.fields).forEach(name => {\n        this._primitiveData[ P.getShapeKey(name) ] = []\n      })\n      this._primitiveData[ P.getShapeKey('name') ] = []\n    })\n  }\n\n  /**\n   * Add a buffer\n   * @param {Buffer} buffer - buffer object\n   * @return {Shape} this object\n   */\n  addBuffer (buffer: Buffer) {\n    this.bufferList.push(buffer)\n\n    const geometry = (buffer as any).geometry  // TODO\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox()\n    }\n    this.boundingBox.union(geometry.boundingBox)\n\n    return this\n  }\n\n  /**\n   * Add a mesh\n   * @example\n   * shape.addMesh(\n   *   [ 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1 ],\n   *   [ 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0 ]\n   * );\n   *\n   * @param {Float32Array|Array} position - positions\n   * @param {Float32Array|Array} color - colors\n   * @param {Uint32Array|Uint16Array|Array} [index] - indices\n   * @param {Float32Array|Array} [normal] - normals\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addMesh (position: Float32Array|number[], color:Float32Array|number[], index: Uint32Array|Uint16Array|number[], normal?: Float32Array|number[], name?: string) {\n    position = ensureFloat32Array(position)\n    color = ensureFloat32Array(color)\n\n    if (Array.isArray(index)) {\n      index = getUintArray(index, position.length)\n    }\n    if (normal) {\n      normal = ensureFloat32Array(normal)\n    }\n\n    let data\n    if (normal === undefined || normal.length == 0 ) {\n      data = { position, color, index }\n    } else {\n      data = { position, color, index, normal }\n    }\n    //const data = { position, color, index, normal }\n    const picking = new MeshPicker(\n      this, Object.assign({ serial: this.meshCount, name }, data)\n    )\n    const meshBuffer = new MeshBuffer(\n      Object.assign({ picking }, data) as any\n    )\n    this.bufferList.push(meshBuffer)\n\n    tmpBox.setFromArray(position)\n    this.boundingBox.union(tmpBox)\n    this.meshCount += 1\n\n    return this\n  }\n\n  /**\n   * Add a sphere\n   * @example\n   * shape.addSphere([ 0, 0, 9 ], [ 1, 0, 0 ], 1.5);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addSphere (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    SpherePrimitive.objectToShape(\n      this, { position, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an ellipsoid\n   * @example\n   * shape.addEllipsoid([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {Vector3|Array} majorAxis - major axis vector or array\n   * @param {Vector3|Array} minorAxis - minor axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addEllipsoid (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, majorAxis: Vector3|[number, number, number], minorAxis: Vector3|[number, number, number], name: string) {\n    EllipsoidPrimitive.objectToShape(\n      this, { position, color, radius, majorAxis, minorAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a torus\n   * @example\n   * shape.addTorus([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {Vector3|Array} majorAxis - major axis vector or array\n   * @param {Vector3|Array} minorAxis - minor axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addTorus (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, majorAxis: Vector3|[number, number, number], minorAxis: Vector3|[number, number, number], name: string) {\n    TorusPrimitive.objectToShape(\n      this, { position, color, radius, majorAxis, minorAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a cylinder\n   * @example\n   * shape.addCylinder([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addCylinder (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    CylinderPrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a cone\n   * @example\n   * shape.addCone([ 0, 2, 7 ], [ 0, 3, 3 ], [ 1, 1, 0 ], 1.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addCone (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    ConePrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an arrow\n   * @example\n   * shape.addArrow([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addArrow (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    ArrowPrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a box\n   * @example\n   * shape.addBox([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addBox (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    BoxPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an octahedron\n   * @example\n   * shape.addOctahedron([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addOctahedron (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    OctahedronPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a tetrahedron\n   * @example\n   * shape.addTetrahedron([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addTetrahedron (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    TetrahedronPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an icosahedron\n   * @example\n   * shape.addIcosahedron([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addIcosahedron (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    IcosahedronPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add text\n   * @example\n   * shape.addText([ 10, -2, 4 ], [ 0.2, 0.5, 0.8 ], 0.5, \"Hello\");\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {String} text - text value\n   * @return {Shape} this object\n   */\n  addText (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, text: string) {\n    TextPrimitive.objectToShape(\n      this, { position, color, size, text }\n    )\n    return this\n  }\n\n  /**\n   * Add point\n   * @example\n   * shape.addPoint([ 10, -2, 4 ], [ 0.2, 0.5, 0.8 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addPoint (position: Vector3|[number, number, number], color: Color|[number, number, number], name: string) {\n    PointPrimitive.objectToShape(\n      this, { position, color, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a wideline\n   * @example\n   * shape.addWideline([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ]);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addWideline (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], linewidth: number, name: string) {\n    this.parameters.linewidth = linewidth\n    WidelinePrimitive.objectToShape(\n      this, { position1, position2, color, name }\n    )\n    return this\n  }\n\n  /**\n   * Deprecated, use `.addText`\n   */\n  addLabel (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, text: string) {\n    console.warn('Shape.addLabel is deprecated, use .addText instead')\n    return this.addText(position, color, size, text)\n  }\n\n  getBufferList () {\n    const buffers: Buffer[] = []\n\n    Primitives.forEach(P => {\n      if (this._primitiveData[ P.getShapeKey('color') ].length) {\n        buffers.push(P.bufferFromShape(this, this.parameters))\n      }\n    })\n\n    return this.bufferList.concat(buffers)\n  }\n\n  dispose () {\n    this.bufferList.forEach(function (buffer) {\n      buffer.dispose()\n    })\n    this.bufferList.length = 0\n\n    Primitives.forEach(P => {\n      Object.keys(P.fields).forEach(name => {\n        this._primitiveData[ P.getShapeKey(name) ].length = 0\n      })\n      this._primitiveData[ P.getShapeKey('name') ].length = 0\n    })\n  }\n\n  get center () {\n    if (!this._center) {\n      this._center = this.boundingBox.getCenter(new Vector3())\n    }\n    return this._center\n  }\n\n  get type () { return 'Shape' }\n}\n\nexport default Shape\n","/**\n * @file Buffer Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Representation, { RepresentationParameters } from './representation'\nimport Viewer from '../viewer/viewer';\n\n/**\n * Representation for showing buffer objects. Good for efficiently showing\n * large amounts of geometric primitives e.g. spheres via {@link SphereBuffer}.\n * Smaller numbers of geometric primitives are more easily shown with help\n * from the {@link Shape} class.\n *\n * __Name:__ _buffer_\n *\n * @example\n * // add a single red sphere from a buffer to a shape instance\n * var shape = new NGL.Shape( \"shape\" );\n * var sphereBuffer = new NGL.SphereBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] ),\n *     radius: new Float32Array( [ 1 ] )\n * } );\n * shape.addBuffer( sphereBuffer );\n * var shapeComp = stage.addComponentFromObject( shape );\n * shapeComp.addRepresentation( \"buffer\" );\n *\n * @example\n * // add a single red sphere from a buffer to a structure component instance\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     var sphereBuffer = new NGL.SphereBuffer( {\n *         position: new Float32Array( [ 0, 0, 0 ] ),\n *         color: new Float32Array( [ 1, 0, 0 ] ),\n *         radius: new Float32Array( [ 1 ] )\n *     } );\n *     o.addBufferRepresentation( sphereBuffer, { opacity: 0.5 } );\n * } );\n */\nclass BufferRepresentation extends Representation {\n  buffer: Buffer[]\n  /**\n   * Create Buffer representation\n   * @param {Buffer} buffer - a buffer object\n   * @param {Viewer} viewer - a viewer object\n   * @param {RepresentationParameters} params - representation parameters\n   */\n  constructor (buffer: Buffer|Buffer[], viewer: Viewer, params: Partial<RepresentationParameters>) {\n    if (!Array.isArray(buffer)) {\n      buffer = [ buffer ]\n    }\n\n    super(buffer, viewer, params)\n\n    this.type = 'buffer'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      colorScheme: null,\n      colorScale: null,\n      colorValue: null,\n      colorDomain: null,\n      colorMode: null\n\n    })\n\n    this.buffer = buffer\n\n    this.init(params)\n  }\n\n  init (params: Partial<RepresentationParameters>) {\n    super.init(params)\n\n    this.build()\n  }\n\n  create () {\n    this.bufferList.push.apply(this.bufferList, this.buffer)\n  }\n\n  attach (callback: ()=> void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n      buffer.setParameters(this.getBufferParams())\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n}\n\nexport default BufferRepresentation\n","/**\n * @file Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\n import {  Vector3, Matrix4, Matrix3, BufferGeometry } from 'three'\n\nimport { getUintArray } from '../utils'\nimport { serialBlockArray } from '../math/array-utils'\nimport { applyMatrix3toVector3array, applyMatrix4toVector3array } from '../math/vector-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferParameters, BufferData } from './buffer'\nimport {Log} from \"../globals\";\n\nconst matrix = new Matrix4()\nconst normalMatrix = new Matrix3()\n\nfunction getData(data: BufferData, geo: BufferGeometry){\n  const geoPosition = (geo.attributes as any).position.array\n  const geoIndex = geo.index ? geo.index.array : undefined\n\n  const n = data.position!.length / 3\n  const m = geoPosition.length / 3\n\n  const size = n * m\n\n  const meshPosition = new Float32Array(size * 3)\n  const meshNormal = new Float32Array(size * 3)\n  const meshColor = new Float32Array(size * 3)\n\n  let meshIndex\n  if (geoIndex) {\n    meshIndex = getUintArray(n * geoIndex.length, size)\n  }\n\n  return {\n    position: meshPosition,\n    color: meshColor,\n    index: meshIndex,\n    normal: meshNormal,\n    primitiveId: data.primitiveId || serialBlockArray(n, m) as Float32Array,\n    picking: data.picking\n  }\n}\n\n/**\n * Geometry buffer. Base class for geometry-based buffers. Used to draw\n * geometry primitives given a mesh.\n * @interface\n */\nabstract class GeometryBuffer extends MeshBuffer {\n  updateNormals = false\n\n  geoPosition: Float32Array\n  geoNormal: Float32Array\n  geoIndex?: Uint32Array|Uint16Array\n\n  positionCount: number\n  geoPositionCount: number\n\n  transformedGeoPosition: Float32Array\n  transformedGeoNormal: Float32Array\n\n  meshPosition: Float32Array\n  meshColor: Float32Array\n  meshIndex: Uint32Array|Uint16Array\n  meshNormal: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   * @param {BufferGeometry} geo - geometry object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}, geo: BufferGeometry) {\n    super(getData(data, geo), params)\n\n    const geoPosition = (geo.attributes as any).position.array\n    const geoNormal = (geo.attributes as any).normal.array\n    const geoIndex = geo.index ? (geo.index.array as Uint32Array|Uint16Array) : undefined\n\n    this.geoPosition = geoPosition\n    this.geoNormal = geoNormal\n    this.geoIndex = geoIndex\n\n    this.positionCount = data.position!.length / 3\n    this.geoPositionCount = geoPosition.length / 3\n\n    this.transformedGeoPosition = new Float32Array(this.geoPositionCount * 3)\n    this.transformedGeoNormal = new Float32Array(this.geoPositionCount * 3)\n\n    const attributes = this.geometry.attributes as any  // TODO\n    this.meshPosition = attributes.position.array\n    this.meshColor = attributes.color.array\n    this.meshNormal = attributes.normal.array\n\n    this.setAttributes(data)\n\n    if (geoIndex) {\n      const index = this.geometry.getIndex()\n      if (!index) { Log.error('Index is null'); return; }\n      this.meshIndex = index.array as Uint32Array|Uint16Array\n      this.makeIndex()\n    }\n  }\n\n  abstract applyPositionTransform (matrix: Matrix4, i: number, i3?: number): void\n\n  setAttributes (data: Partial<BufferData> = {}, initNormals = false) {\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, color\n    let geoPosition, geoNormal\n    let transformedGeoPosition, transformedGeoNormal\n    let meshPosition, meshColor, meshNormal\n\n    const updateNormals = this.updateNormals\n\n    if (data.position) {\n      position = data.position\n      geoPosition = this.geoPosition\n      meshPosition = this.meshPosition\n      transformedGeoPosition = this.transformedGeoPosition\n      attributes.position.needsUpdate = true\n      if (updateNormals || initNormals) {\n        geoNormal = this.geoNormal\n        meshNormal = this.meshNormal\n        transformedGeoNormal = this.transformedGeoNormal\n        attributes.normal.needsUpdate = true\n      }\n    }\n\n    if (data.color) {\n      color = data.color\n      meshColor = this.meshColor\n      attributes.color.needsUpdate = true\n    }\n\n    const n = this.positionCount\n    const m = this.geoPositionCount\n\n    for (let i = 0; i < n; ++i) {\n      let j, l\n      const k = i * m * 3\n      const i3 = i * 3\n\n      if (position && transformedGeoPosition && meshPosition && meshNormal && geoPosition && geoNormal) {\n        transformedGeoPosition.set(geoPosition)\n        matrix.makeTranslation(\n          position[ i3 ], position[ i3 + 1 ], position[ i3 + 2 ]\n        )\n        this.applyPositionTransform(matrix, i, i3)\n        applyMatrix4toVector3array(matrix.elements as unknown as Float32Array,\n                                   transformedGeoPosition)\n\n        meshPosition.set(transformedGeoPosition, k)\n\n        if (updateNormals && transformedGeoNormal) {\n          transformedGeoNormal.set(geoNormal)\n          normalMatrix.getNormalMatrix(matrix)\n          applyMatrix3toVector3array(normalMatrix.elements as unknown as Float32Array,\n                                     transformedGeoNormal)\n\n          meshNormal.set(transformedGeoNormal, k)\n        } else if (initNormals) {\n          meshNormal.set(geoNormal, k)\n        }\n      }\n\n      if (color && meshColor) {\n        for (j = 0; j < m; ++j) {\n          l = k + 3 * j\n\n          meshColor[ l ] = color[ i3 ]\n          meshColor[ l + 1 ] = color[ i3 + 1 ]\n          meshColor[ l + 2 ] = color[ i3 + 2 ]\n        }\n      }\n    }\n  }\n\n  makeIndex () {\n    const geoIndex = this.geoIndex\n    const meshIndex = this.meshIndex\n\n    if (!geoIndex) return\n\n    const n = this.positionCount\n    const m = this.geoPositionCount\n    const o = geoIndex.length / 3\n\n    const o3 = o * 3\n\n    for (let i = 0; i < n; ++i) {\n      const j = i * o3\n      const q = j + o3\n\n      meshIndex.set(geoIndex, j)\n      for (let p = j; p < q; ++p) meshIndex[ p ] += i * m\n    }\n  }\n}\n\nexport default GeometryBuffer\n","/**\n * @file Sphere Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { IcosahedronGeometry, Vector3, Matrix4 } from 'three'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { SphereBufferData } from './sphere-buffer'\nimport { BufferDefaultParameters, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\n\nexport const SphereGeometryBufferDefaultParameters = Object.assign({\n  sphereDetail: 1\n}, BufferDefaultParameters)\nexport type SphereGeometryBufferParameters = BufferParameters & { sphereDetail: number }\n\n/**\n * Sphere geometry buffer.\n *\n * @example\n * var sphereGeometryBuffer = new SphereGeometryBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass SphereGeometryBuffer extends GeometryBuffer {\n  get defaultParameters() { return SphereGeometryBufferDefaultParameters }\n  parameters: SphereGeometryBufferParameters\n\n  private _radius: Float32Array\n\n  /**\n   * @param {Object} data - attribute object\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} params - parameter object\n   */\n  constructor (data: SphereBufferData, params: Partial<SphereGeometryBufferParameters> = {}) {\n    super(data, params, new IcosahedronGeometry(1, defaults(params.sphereDetail, 1)))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number) {\n    const r = this._radius[ i ]\n    scale.set(r, r, r)\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<SphereBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nexport default SphereGeometryBuffer\n","/**\n * @file Mapped Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getUintArray } from '../utils'\nimport { calculateCenterArray, serialArray } from '../math/array-utils'\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\nexport type MappingType = 'v2'|'v3'\n\n/**\n * Mapped buffer. Sends mapping attribute to the GPU and repeats data in\n * others attributes. Used to render imposters.\n * @interface\n */\nabstract class MappedBuffer extends Buffer {\n  index: Uint32Array|Uint16Array\n\n  constructor (mappingType: MappingType, data: BufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.index = getUintArray(this.indexSize, this.attributeSize)\n    this.makeIndex()\n    this.initIndex(this.index)\n\n    this.addAttributes({\n      'mapping': { type: mappingType, value: null }\n    })\n\n    this.setAttributes({ primitiveId: serialArray(this.size) })\n  }\n\n  abstract get mapping (): Float32Array\n  abstract get mappingIndices (): Uint32Array|Uint16Array\n  abstract get mappingIndicesSize (): number\n  abstract get mappingSize (): number\n  abstract get mappingItemSize (): number\n\n  get attributeSize () {\n    return this.size * this.mappingSize\n  }\n\n  get indexSize () {\n    return this.size * this.mappingIndicesSize\n  }\n\n  addAttributes (attributes: any) {\n    const nullValueAttributes: any = {}\n    for (const name in attributes) {\n      const a = attributes[ name ]\n      nullValueAttributes[ name ] = {\n        type: a.type,\n        value: null\n      }\n    }\n\n    super.addAttributes(nullValueAttributes)\n  }\n\n  getAttributeIndex (dataIndex: number) {\n    return dataIndex * 3 * this.mappingSize\n  }\n\n  setAttributes (data: any) {  // TODO\n    if (data && !data.position && data.position1 && data.position2) {\n      data.position = calculateCenterArray(data.position1, data.position2)\n    }\n\n    const size = this.size\n    const mappingSize = this.mappingSize\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let a, d, itemSize, array, n, i, j\n\n    for (const name in data) {\n      if (name === 'index' || name === 'picking') continue\n\n      d = data[ name ]\n      a = attributes[ name ]\n      itemSize = a.itemSize\n      array = a.array\n\n      for (let k = 0; k < size; ++k) {\n        n = k * itemSize\n        i = n * mappingSize\n\n        for (let l = 0; l < mappingSize; ++l) {\n          j = i + (itemSize * l)\n\n          for (let m = 0; m < itemSize; ++m) {\n            array[ j + m ] = d[ n + m ]\n          }\n        }\n      }\n\n      a.needsUpdate = true\n    }\n  }\n\n  makeMapping () {\n    const size = this.size\n    const mapping = this.mapping\n    const mappingSize = this.mappingSize\n    const mappingItemSize = this.mappingItemSize\n\n    const attributes = this.geometry.attributes as any  // TODO\n    const aMapping = attributes.mapping.array\n\n    for (let v = 0; v < size; v++) {\n      aMapping.set(mapping, v * mappingItemSize * mappingSize)\n    }\n  }\n\n  makeIndex () {\n    const size = this.size\n    const mappingSize = this.mappingSize\n    const mappingIndices = this.mappingIndices\n    const mappingIndicesSize = this.mappingIndicesSize\n\n    const index = this.index\n\n    for (let v = 0; v < size; v++) {\n      const ix = v * mappingIndicesSize\n      const it = v * mappingSize\n\n      index.set(mappingIndices, ix)\n\n      for (let s = 0; s < mappingIndicesSize; ++s) {\n        index[ ix + s ] += it\n      }\n    }\n  }\n}\n\nexport default MappedBuffer\n","/**\n * @file Mapped Quad Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\nconst mapping = new Float32Array([\n  -1.0, 1.0,\n  -1.0, -1.0,\n  1.0, 1.0,\n  1.0, -1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\n/**\n * Mapped Quad buffer. Draws screen-aligned quads. Used to render impostors.\n * @interface\n */\nclass MappedQuadBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v2', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 6 }\n  get mappingSize () { return 4 }\n  get mappingItemSize () { return 2 }\n}\n\nexport default MappedQuadBuffer\n","/**\n * @file Sphere Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport '../shader/SphereImpostor.vert'\nimport '../shader/SphereImpostor.frag'\n\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { SphereBufferData } from './sphere-buffer'\nimport { BufferParameters } from './buffer'\n\n/**\n * Sphere impostor buffer.\n *\n * @example\n * var sphereImpostorBuffer = new SphereImpostorBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass SphereImpostorBuffer extends MappedQuadBuffer {\n  isImpostor = true\n  vertexShader = 'SphereImpostor.vert'\n  fragmentShader = 'SphereImpostor.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: SphereBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'projectionMatrixInverse': { value: new Matrix4() },\n      'ortho': { value: 0.0 }\n    })\n\n    this.addAttributes({\n      'radius': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n}\n\nexport default SphereImpostorBuffer\n","/**\n * @file Sphere Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only \nimport { Vector3, Matrix4 } from 'three'\nimport { BufferRegistry, ExtensionFragDepth } from '../globals'\nimport SphereGeometryBuffer, { SphereGeometryBufferDefaultParameters, SphereGeometryBufferParameters } from './spheregeometry-buffer'\nimport SphereImpostorBuffer from './sphereimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface SphereBufferData extends BufferData {\n  radius: Float32Array\n}\n\nexport const SphereBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, SphereGeometryBufferDefaultParameters)\nexport type SphereBufferParameters = SphereGeometryBufferParameters & { disableImpostor: boolean }\n\nclass SphereBufferImpl {\n    /**\n     * @param {Object} data - buffer data\n     * @param {Float32Array} data.position - positions\n     * @param {Float32Array} data.color - colors\n     * @param {Float32Array} data.radius - radii\n     * @param {Picker} [data.picking] - picking ids\n     * @param {BufferParameters} params - parameters object\n     * @return {SphereGeometryBuffer|SphereImpostorBuffer} the buffer object\n     */\n  constructor (data: SphereBufferData, params: SphereBufferParameters) {\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      return new SphereGeometryBuffer(data, params)\n    } else {\n      return new SphereImpostorBuffer(data, params)\n    }\n  }\n}\n\n/**\n * Sphere buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link SphereGeometryBuffer} or a {@link SphereImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var sphereBuffer = new SphereBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] ),\n *     radius: new Float32Array( [ 1 ] )\n * } );\n */\n//@ts-expect-error Incompatible constructor signatures\nconst SphereBuffer: {\n  new(data: SphereBufferData, params: SphereBufferParameters): SphereGeometryBuffer | SphereImpostorBuffer;\n} = SphereBufferImpl;\n\ntype SphereBuffer = SphereGeometryBuffer | SphereImpostorBuffer;\n\nBufferRegistry.add('sphere', SphereBuffer)\n\nexport default SphereBuffer\n","/**\n * @file Point Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { DataTexture, Vector3, Matrix4 } from 'three'\n\nimport '../shader/Point.vert'\nimport '../shader/Point.frag'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Buffer, { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferTypes, BufferParameters } from './buffer'\n\nfunction distance (x0: number, y0: number, x1: number, y1: number) {\n  const dx = x1 - x0\n  const dy = y1 - y0\n  return Math.sqrt(dx * dx + dy * dy)\n}\n\ninterface PointTextureParams {\n  width?: number\n  height?: number\n  delta?: number\n}\n\nfunction makePointTexture (params: PointTextureParams) {\n  const p = params || {}\n\n  const width = defaults(p.width, 256)\n  const height = defaults(p.height, 256)\n  const center = [ width / 2, height / 2 ]\n  const radius = Math.min(width / 2, height / 2)\n  const delta = defaults(p.delta, 1 / (radius + 1)) * radius\n\n  let x = 0\n  let y = 0\n  const data = new Uint8Array(width * height * 4)\n\n  for (let i = 0, il = data.length; i < il; i += 4) {\n    const dist = distance(x, y, center[ 0 ], center[ 1 ])\n    const value = 1 - smoothstep(radius - delta, radius, dist)\n\n    data[ i ] = value * 255\n    data[ i + 1 ] = value * 255\n    data[ i + 2 ] = value * 255\n    data[ i + 3 ] = value * 255\n\n    if (++x === width) {\n      x = 0\n      y++\n    }\n  }\n\n  const tex = new DataTexture(data, width, height)\n  tex.needsUpdate = true\n\n  return tex\n}\n\nexport const PointBufferDefaultParameters = Object.assign({\n  pointSize: 1,\n  sizeAttenuation: true,\n  sortParticles: false,\n  alphaTest: 0.5,\n  useTexture: false,\n  forceTransparent: false,\n  edgeBleach: 0.0\n}, BufferDefaultParameters)\nexport type PointBufferParameters = BufferParameters & {\n  pointSize: number,\n  sizeAttenuation: boolean,\n  sortParticles: boolean,\n  alphaTest: number,\n  useTexture: boolean,\n  forceTransparent: boolean,\n  edgeBleach: number\n}\n\nconst PointBufferParameterTypes = Object.assign({\n  pointSize: { uniform: 'size' },\n  sizeAttenuation: { updateShader: true },\n  sortParticles: {},\n  alphaTest: { uniform: true },\n  useTexture: { updateShader: true },\n  forceTransparent: {},\n  edgeBleach: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Point buffer. Draws points. Optionally textured.\n *\n * @example\n * var pointBuffer = new PointBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] )\n * } );\n */\nclass PointBuffer extends Buffer {\n  parameterTypes = PointBufferParameterTypes\n  get defaultParameters() { return PointBufferDefaultParameters }\n  parameters: PointBufferParameters\n\n  vertexShader = 'Point.vert'\n  fragmentShader ='Point.frag'\n\n  isPoint = true\n  tex: DataTexture\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<PointBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'size': { value: this.parameters.pointSize },\n      'canvasHeight': { value: 1.0 },\n      'pixelRatio': { value: 1.0 },\n      'map': { value: null },\n      'alphaTest': {value: this.parameters.alphaTest}\n    })\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n\n    this.makeTexture()\n\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    m.uniforms.map.value = this.tex\n    m.needsUpdate = true\n\n    wm.uniforms.map.value = this.tex\n    wm.needsUpdate = true\n\n    pm.uniforms.map.value = this.tex\n    pm.needsUpdate = true\n  }\n\n  makeTexture () {\n    if (this.tex) this.tex.dispose()\n    this.tex = makePointTexture({ delta: this.parameters.edgeBleach })\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines = super.getDefines(type)\n\n    if (this.parameters.sizeAttenuation) {\n      defines.USE_SIZEATTENUATION = 1\n    }\n\n    if (this.parameters.useTexture) {\n      defines.USE_MAP = 1\n    }\n\n    if (this.parameters.alphaTest > 0 && this.parameters.alphaTest <= 1) {\n      defines.USE_ALPHATEST = 1\n    }\n\n    return defines\n  }\n\n  setUniforms (data: any) {\n    if (data && data.edgeBleach !== undefined) {\n      this.makeTexture()\n      data.map = this.tex\n    }\n\n    super.setUniforms(data)\n  }\n\n  dispose () {\n    super.dispose()\n\n    if (this.tex) this.tex.dispose()\n  }\n}\n\nBufferRegistry.add('point', PointBuffer)\n\nexport default PointBuffer\n","/**\n * @file Dot Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ExtensionFragDepth } from '../globals'\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport Volume from '../surface/volume'\nimport FilteredVolume from '../surface/filtered-volume'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport PointBuffer from '../buffer/point-buffer'\nimport Surface from '../surface/surface';\nimport Viewer from '../viewer/viewer';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n\nexport interface DotDataFields {\n  color?: boolean,\n  radius?: boolean,\n  scale?: boolean\n}\n\n/**\n * Dot representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} DotRepresentationParameters - dot representation parameters\n *\n * @property {String} thresholdType - Meaning of the threshold values. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Number} thresholdMin - Minimum value to be displayed. For volume data only.\n * @property {Number} thresholdMax - Maximum value to be displayed. For volume data only.\n * @property {Number} thresholdOut - Show only values falling outside of the treshold minumum and maximum. For volume data only.\n */\nexport interface DotRepresentationParameters extends RepresentationParameters {\n  thresholdType: 'value'|'value'|'sigma'|'sigma'\n  thresholdMin: number\n  thresholdMax: number\n  thresholdOut: boolean\n  dotType: ''|'sphere'|'point'\n  radiusType: ''|'value'|'abs-value'|'value-min'|'deviation'|'size'|'radius' //TODO had to add 'radius' because of test in line 333\n  radius: number\n  scale: number\n  sphereDetail: number\n  disableImpostor: boolean\n  pointSize: number\n  sizeAttenuation: boolean\n  sortParticles: boolean\n  useTexture: boolean\n  alphaTest: number\n  forceTransparent: boolean\n  edgeBleach: number\n}\n/**\n * Dot representation\n */\nclass DotRepresentation extends Representation {\n  protected thresholdType: 'value'|'value'|'sigma'|'sigma'\n  protected thresholdMin: number\n  protected thresholdMax: number\n  protected thresholdOut: boolean\n  protected dotType: ''|'sphere'|'point'\n  protected radiusType: ''|'value'|'abs-value'|'value-min'|'deviation'|'size'|'radius' //TODO had to add 'radius' because of test in line 333\n  protected radius: number\n  protected scale: number\n  protected sphereDetail: number\n  protected disableImpostor: boolean\n  protected pointSize: number\n  protected sizeAttenuation: boolean\n  protected sortParticles: boolean\n  protected useTexture: boolean\n  protected alphaTest: number\n  protected forceTransparent: boolean\n  protected edgeBleach: number\n\n  protected surface: Surface|undefined\n  protected volume: FilteredVolume|undefined\n  protected dotBuffer: SphereBuffer|PointBuffer\n  /**\n   * Create Dot representation object\n   * @param {Surface|Volume} surface - the surface or volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {DotRepresentationParameters} params - dot representation parameters\n   */\n  constructor (surface: Surface, viewer: Viewer, params: Partial<DotRepresentationParameters>) {\n    super(surface, viewer, params)\n\n    this.type = 'dot'\n\n    this.parameters = Object.assign({\n\n      thresholdType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      thresholdMin: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdMax: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdOut: {\n        type: 'boolean', rebuild: true\n      },\n      dotType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          '': '',\n          'sphere': 'sphere',\n          'point': 'point'\n        }\n      },\n      radiusType: {\n        type: 'select',\n        options: {\n          '': '',\n          'value': 'value',\n          'abs-value': 'abs-value',\n          'value-min': 'value-min',\n          'deviation': 'deviation',\n          'size': 'size'\n        }\n      },\n      radius: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001, property: 'size'\n      },\n      scale: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      disableImpostor: true,\n\n      pointSize: {\n        type: 'number', precision: 1, max: 100, min: 0, buffer: true\n      },\n      sizeAttenuation: {\n        type: 'boolean', buffer: true\n      },\n      sortParticles: {\n        type: 'boolean', rebuild: true\n      },\n      useTexture: {\n        type: 'boolean', buffer: true\n      },\n      alphaTest: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      },\n      forceTransparent: {\n        type: 'boolean', buffer: true\n      },\n      edgeBleach: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      }\n\n    }, this.parameters, {\n\n      colorScheme: {\n        type: 'select',\n        update: 'color',\n        options: {\n          '': '',\n          'value': 'value',\n          'uniform': 'uniform',\n          'random': 'random'\n        }\n      }\n\n    })\n\n    if (surface instanceof Volume) {\n      this.surface = undefined\n      this.volume = new FilteredVolume(surface)\n    } else {\n      this.surface = surface\n      this.volume = undefined\n    }\n\n    this.init(params)\n  }\n\n  init (params: Partial<DotRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, 2.0)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.thresholdOut = defaults(p.thresholdOut, false)\n    this.dotType = defaults(p.dotType, 'point')\n    this.radius = defaults(p.radius, 0.1)\n    this.scale = defaults(p.scale, 1.0)\n\n    this.pointSize = defaults(p.pointSize, 1)\n    this.sizeAttenuation = defaults(p.sizeAttenuation, true)\n    this.sortParticles = defaults(p.sortParticles, false)\n    this.useTexture = defaults(p.useTexture, false)\n    this.alphaTest = defaults(p.alphaTest, 0.5)\n    this.forceTransparent = defaults(p.forceTransparent, false)\n    this.edgeBleach = defaults(p.edgeBleach, 0.0)\n\n    super.init(p)\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  create () {\n    var dotData: SphereBufferData|{} = {}\n\n    if (this.volume) {\n      var volume = this.volume\n      var thresholdMin, thresholdMax\n\n      if (this.thresholdType === 'sigma') {\n        thresholdMin = volume.getValueForSigma(this.thresholdMin)\n        thresholdMax = volume.getValueForSigma(this.thresholdMax)\n      } else {\n        thresholdMin = this.thresholdMin\n        thresholdMax = this.thresholdMax\n      }\n      volume.setFilter(thresholdMin, thresholdMax, this.thresholdOut)\n\n      Object.assign(dotData, {\n        position: volume.getDataPosition(),\n        color: volume.getDataColor(this.getColorParams())\n      })\n      if (this.dotType === 'sphere') {\n        Object.assign(dotData, {\n          radius: volume.getDataSize(this.radius, this.scale),\n          picking: volume.getDataPicking()\n        })\n      }\n    } else {\n      var surface = this.surface\n      Object.assign(dotData, {\n        position: (surface as Surface).getPosition(),\n        color: (surface as Surface).getColor(this.getColorParams())\n      })\n      if (this.dotType === 'sphere') {\n        Object.assign(dotData, {\n          radius: (surface as Surface).getSize(this.radius, this.scale),\n          picking: (surface as Surface).getPicking()\n        })\n      }\n    }\n\n    if (this.dotType === 'sphere') {\n      this.dotBuffer = new SphereBuffer(\n        dotData as SphereBufferData,\n        this.getBufferParams({\n          sphereDetail: this.sphereDetail,\n          disableImpostor: this.disableImpostor,\n          dullInterior: false\n        }) as SphereBufferParameters\n      ) as SphereGeometryBuffer\n    } else {\n      this.dotBuffer = new PointBuffer(\n        dotData,\n        this.getBufferParams({\n          pointSize: this.pointSize,\n          sizeAttenuation: this.sizeAttenuation,\n          sortParticles: this.sortParticles,\n          useTexture: this.useTexture,\n          alphaTest: this.alphaTest,\n          forceTransparent: this.forceTransparent,\n          edgeBleach: this.edgeBleach\n        })\n      )\n    }\n\n    this.bufferList.push(this.dotBuffer as SphereGeometryBuffer)\n  }\n\n  update (what: DotDataFields = {}) {\n    if (this.bufferList.length === 0) return\n\n    const dotData: SphereBufferData|{} = {}\n\n    if (what.color) {\n      if (this.volume) {\n        Object.assign(dotData, {\n          color: this.volume.getDataColor(\n            this.getColorParams()\n          )\n        })\n      } else {\n        Object.assign(dotData, {\n          color: (this.surface as Surface).getColor(\n            this.getColorParams()\n          )\n        })\n      }\n    }\n\n    if (this.dotType === 'sphere' && (what.radius || what.scale)) {\n      if (this.volume) {\n        Object.assign(dotData, {\n          radius: this.volume.getDataSize(\n            this.radius, this.scale\n          )\n        })\n      } else {\n        Object.assign(dotData, {\n          radius: (this.surface as Surface).getSize(\n            this.radius, this.scale\n          )\n        })\n      }\n    }\n\n    (this.dotBuffer as SphereGeometryBuffer).setAttributes(dotData)\n  }\n\n  setParameters (params: Partial<DotRepresentationParameters>, what: DotDataFields = {}, rebuild: boolean) {\n    \n    if (params && params.thresholdType !== undefined &&\n        this.volume instanceof Volume\n    ) {\n      if (this.thresholdType === 'value' &&\n          params.thresholdType === 'sigma'\n      ) {\n        this.thresholdMin = this.volume.getSigmaForValue(\n          this.thresholdMin\n        )\n        this.thresholdMax = this.volume.getSigmaForValue(\n          this.thresholdMax\n        )\n      } else if (this.thresholdType === 'sigma' &&\n                 params.thresholdType === 'value'\n      ) {\n        this.thresholdMin = this.volume.getValueForSigma(\n          this.thresholdMin\n        )\n        this.thresholdMax = this.volume.getValueForSigma(\n          this.thresholdMax\n        )\n      }\n\n      this.thresholdType = params.thresholdType\n    }\n\n    if (params && params.radiusType !== undefined) {\n      if (params.radiusType === 'radius') {\n        this.radius = 0.1\n      } else {\n        this.radius = parseFloat(params.radiusType)\n      }\n      what.radius = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    if (params && params.radius !== undefined) {\n      what.radius = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    if (params && params.scale !== undefined) {\n      what.scale = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nexport default DotRepresentation\n","/**\n * @file Image Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n    // @ts-ignore: unused import Vector3, Matrix4 required for declaration only\n    Vector2, Vector3, Matrix4, BufferAttribute, DataTexture,\n    NormalBlending, NearestFilter, LinearFilter\n} from 'three'\n\nimport '../shader/Image.vert'\nimport '../shader/Image.frag'\n\nimport { Picker } from '../utils/picker'\nimport Buffer, { BufferDefaultParameters, BufferParameterTypes, BufferTypes } from './buffer'\n\n\nconst quadIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\nconst quadUvs = new Float32Array([\n  0, 1,\n  0, 0,\n  1, 1,\n  1, 0\n])\n\ntype ImageFilterTypes = 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n\nexport interface ImageBufferData {\n  position: Float32Array\n  imageData: Uint8Array\n  width: number\n  height: number\n\n  picking?: Picker\n}\n\nexport const ImageBufferDefaultParameters = Object.assign({\n  filter: 'nearest' as ImageFilterTypes,\n  forceTransparent: true\n}, BufferDefaultParameters)\nexport type ImageBufferParameters = typeof ImageBufferDefaultParameters\n\nexport const ImageBufferParameterTypes = Object.assign({\n  filter: { updateShader: true, uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Image buffer. Draw a single image. Optionally interpolate.\n */\nclass ImageBuffer extends Buffer {\n  parameterTypes = ImageBufferParameterTypes\n  get defaultParameters() { return ImageBufferDefaultParameters }\n  parameters: ImageBufferParameters\n\n  alwaysTransparent = true\n  hasWireframe = false\n  vertexShader = 'Image.vert'\n  fragmentShader = 'Image.frag'\n\n  tex: DataTexture\n  pickingTex: DataTexture\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position - image position\n   * @param {Float32Array} data.imageData - image data, rgba channels\n   * @param {Float32Array} data.width - image width\n   * @param {Float32Array} data.height - image height\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ImageBufferData, params: ImageBufferParameters) {\n    super({\n      position: data.position,\n      index: quadIndices,\n      picking: data.picking\n    }, params)\n\n    const {imageData, width, height} = data\n\n    const tex = new DataTexture(imageData, width, height)\n    tex.flipY = true\n    this.tex = tex\n\n    const n = imageData.length\n    const pickingData = new Uint8Array(n)\n    for (let i = 0; i < n; i += 4) {\n      const j = i / 4\n      pickingData[ i ] = j >> 16 & 255\n      pickingData[ i + 1 ] = j >> 8 & 255\n      pickingData[ i + 2 ] = j & 255\n    }\n\n    const pickingTex = new DataTexture(pickingData, width, height)\n    pickingTex.flipY = true\n    pickingTex.minFilter = NearestFilter\n    pickingTex.magFilter = NearestFilter\n    this.pickingTex = pickingTex\n\n    this.addUniforms({\n      'map': { value: tex },\n      'pickingMap': { value: pickingTex },\n      'mapSize': { value: new Vector2(width, height) }\n    })\n\n    this.geometry.setAttribute('uv', new BufferAttribute(quadUvs, 2))\n  }\n\n  getDefines (type: BufferTypes) {\n    const defines = super.getDefines(type)\n    const filter = this.parameters.filter\n\n    if (filter.startsWith('cubic')) {\n      defines.CUBIC_INTERPOLATION = 1\n      if (filter.endsWith('bspline')) {\n        defines.BSPLINE_FILTER = 1\n      } else if (filter.endsWith('catmulrom')) {\n        defines.CATMULROM_FILTER = 1\n      } else if (filter.endsWith('mitchell')) {\n        defines.MITCHELL_FILTER = 1\n      }\n    }\n\n    return defines\n  }\n\n  updateTexture () {\n    const tex = this.tex\n    const filter = this.parameters.filter\n\n    if (filter.startsWith('cubic')) {\n      tex.minFilter = NearestFilter\n      tex.magFilter = NearestFilter\n    } else if (filter === 'linear') {\n      tex.minFilter = LinearFilter\n      tex.magFilter = LinearFilter\n    } else {  // filter === \"nearest\"\n      tex.minFilter = NearestFilter\n      tex.magFilter = NearestFilter\n    }\n\n    tex.needsUpdate = true\n    this.pickingTex.needsUpdate = true\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n    this.updateTexture()\n\n    const m = this.material\n    m.uniforms.map.value = this.tex\n    m.blending = NormalBlending\n    m.needsUpdate = true\n\n    const wm = this.wireframeMaterial\n    wm.uniforms.map.value = this.tex\n    wm.blending = NormalBlending\n    wm.needsUpdate = true\n\n    const pm = this.pickingMaterial\n    pm.uniforms.map.value = this.tex\n    pm.uniforms.pickingMap.value = this.pickingTex\n    pm.blending = NormalBlending\n    pm.needsUpdate = true\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (data && data.filter !== undefined) {\n      this.updateTexture()\n      data.map = this.tex\n    }\n\n    super.setUniforms(data)\n  }\n}\n\nexport default ImageBuffer\n","/**\n * @file Volume Slice\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { SlicePicker } from '../utils/picker'\nimport { Volume } from '../ngl';\nimport { SliceRepresentationParameters } from '../representation/slice-representation';\n\nclass VolumeSlice {\n  dimension: 'x'|'y'|'z'\n  positionType: 'percent'|'coordinate'\n  position: number\n  thresholdType: 'sigma'|'value'\n  thresholdMin: number\n  thresholdMax: number\n  normalize: boolean\n  volume: Volume\n\n  constructor (volume: Volume, params: Partial<SliceRepresentationParameters>) {\n    const p = params || {}\n\n    this.dimension = defaults(p.dimension, 'x')\n    this.positionType = defaults(p.positionType, 'percent')\n    this.position = defaults(p.position, 30)\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, -Infinity)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.normalize = defaults(p.normalize, false)\n\n    this.volume = volume\n  }\n\n  getPositionFromCoordinate (coord: number) {\n    const dim = this.dimension\n    const v = this.volume\n    const m = v.matrix\n\n    const mp = new Vector3().setFromMatrixPosition(m)[ dim ]\n    const ms = new Vector3().setFromMatrixScale(m)[ dim ]\n\n    let vn\n    if (dim === 'x') {\n      vn = v.nx\n    } else if (dim === 'y') {\n      vn = v.ny\n    } else {\n      vn = v.nz\n    }\n\n    return Math.round((((coord - mp) / (vn / 100)) + 1) / ms)\n  }\n\n  getData (params: any) {\n    params = params || {}\n\n    const v = this.volume\n    const d = v.data\n    const m = v.matrix\n\n    let p: number\n    if (this.positionType === 'coordinate') {\n      p = this.getPositionFromCoordinate(this.position)\n    } else {\n      p = this.position\n    }\n\n    function pos (dimLen: number) {\n      return Math.round((dimLen / 100) * (p - 1))\n    }\n\n    function index (x: number, y: number, z: number, i: number) {\n      return (z * v.ny * v.nx + y * v.nx + x) * 3 + i\n    }\n\n    const position = new Float32Array(4 * 3)\n    const vec = new Vector3()\n\n    let width, height\n    let x\n    let y\n    let z\n    let x0 = 0\n    let y0 = 0\n    let z0 = 0\n    let nx = v.nx\n    let ny = v.ny\n    let nz = v.nz\n\n    function setVec (x: number, y: number, z: number, offset: number) {\n      vec.set(x, y, z).applyMatrix4(m).toArray(position as any, offset)\n    }\n\n    if (this.dimension === 'x') {\n      x = pos(v.nx)\n      y = v.ny - 1\n      z = v.nz - 1\n\n      width = v.nz\n      height = v.ny\n\n      x0 = x\n      nx = x0 + 1\n\n      setVec(x, 0, 0, 0)\n      setVec(x, y, 0, 3)\n      setVec(x, 0, z, 6)\n      setVec(x, y, z, 9)\n    } else if (this.dimension === 'y') {\n      x = v.nx - 1\n      y = pos(v.ny)\n      z = v.nz - 1\n\n      width = v.nz\n      height = v.nx\n\n      y0 = y\n      ny = y0 + 1\n\n      setVec(0, y, 0, 0)\n      setVec(x, y, 0, 3)\n      setVec(0, y, z, 6)\n      setVec(x, y, z, 9)\n    } else if (this.dimension === 'z') {\n      x = v.nx - 1\n      y = v.ny - 1\n      z = pos(v.nz)\n\n      width = v.nx\n      height = v.ny\n\n      z0 = z\n      nz = z0 + 1\n\n      setVec(0, 0, z, 0)\n      setVec(0, y, z, 3)\n      setVec(x, 0, z, 6)\n      setVec(x, y, z, 9)\n    }\n\n    let i = 0\n    let j = 0\n    const imageData = new Uint8Array(<number>width * <number>height * 4)\n    const pickingArray = new Float32Array(<number>width * <number>height)\n\n    let tMin, tMax\n    if (this.thresholdType === 'sigma') {\n      tMin = v.getValueForSigma(this.thresholdMin)\n      tMax = v.getValueForSigma(this.thresholdMax)\n    } else {\n      tMin = this.thresholdMin\n      tMax = this.thresholdMax\n    }\n\n    const cp = Object.assign({}, params.colorParams, { volume: v })\n    if (this.normalize) {\n      cp.domain = [ 0, 1 ]\n    }\n    const colormaker = ColormakerRegistry.getScheme(cp)\n    const tmp = new Float32Array(3)\n    const scale = colormaker.getScale()\n\n    let min = 0, max, diff = 0\n    if (this.normalize) {\n      min = +Infinity\n      max = -Infinity\n      for (let iy = y0; iy < ny; ++iy) {\n        for (let ix = x0; ix < nx; ++ix) {\n          for (let iz = z0; iz < nz; ++iz) {\n            const idx = index(ix, iy, iz, 0) / 3\n            const val = d[ idx ]\n            if (val < min) min = val\n            if (val > max) max = val\n          }\n        }\n      }\n      diff = max - min\n    }\n\n    for (let iy = y0; iy < ny; ++iy) {\n      for (let ix = x0; ix < nx; ++ix) {\n        for (let iz = z0; iz < nz; ++iz) {\n          const idx = index(ix, iy, iz, 0) / 3\n          let val = d[ idx ]\n          if (this.normalize) {\n            val = (val - min) / diff\n          }\n\n          colormaker.colorToArray(scale(val), tmp)\n          imageData[ i ] = Math.round(tmp[ 0 ] * 255)\n          imageData[ i + 1 ] = Math.round(tmp[ 1 ] * 255)\n          imageData[ i + 2 ] = Math.round(tmp[ 2 ] * 255)\n          imageData[ i + 3 ] = (val > tMin && val < tMax) ? 255 : 0\n\n          pickingArray[ j ] = idx\n\n          ++j\n          i += 4\n        }\n      }\n    }\n\n    const picking = new SlicePicker(pickingArray, v)\n\n    return { position, imageData, width, height, picking }\n  }\n}\n\nexport default VolumeSlice\n","/**\n * @file Slice Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport ImageBuffer, { ImageBufferParameters, ImageBufferData } from '../buffer/image-buffer'\nimport VolumeSlice from '../surface/volume-slice'\nimport Viewer from '../viewer/viewer';\nimport { Volume } from '../ngl';\n\n/**\n * Slice representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} SliceRepresentationParameters - slice representation parameters\n *\n * @property {String} filter - filter applied to map the volume data on the slice, one of \"nearest\", \"linear\", \"cubic-bspline\", \"cubic-catmulrom\", \"cubic-mitchell\".\n * @property {String} positionType - Meaning of the position value. Either \"percent\" od \"coordinate\".\n * @property {Number} position - position of the slice.\n * @property {String} dimension - one of \"x\", \"y\" or \"z\"\n * @property {String} thresholdType - Meaning of the threshold values. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Number} thresholdMin - Minimum value to be displayed. For volume data only.\n * @property {Number} thresholdMax - Maximum value to be displayed. For volume data only.\n * @property {Boolean} normalize - Flag indicating wheather to normalize the data in a slice when coloring.\n */\nexport interface SliceRepresentationParameters extends RepresentationParameters {\n  filter: 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n  positionType: 'percent'|'coordinate'\n  position: number\n  dimension: 'x'|'y'|'z'\n  thresholdType: 'value'|'sigma'\n  thresholdMin: number\n  thresholdMax: number\n  normalize: boolean\n}\n/**\n * Slice representation\n */\nclass SliceRepresentation extends Representation {\n  protected filter: 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n  protected positionType: 'percent'|'coordinate'\n  protected position: number\n  protected dimension: 'x'|'y'|'z'\n  protected thresholdType: 'value'|'sigma'\n  protected thresholdMin: number\n  protected thresholdMax: number\n  protected normalize: boolean\n  protected volume: Volume\n  /**\n   * Create Slice representation object\n   * @param {Volume} surface - the volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {SliceRepresentationParameters} params - slice representation parameters\n   */\n  constructor (volume: Volume, viewer: Viewer, params: Partial<SliceRepresentationParameters>) {\n    super(volume, viewer, params)\n\n    this.type = 'slice'\n\n    this.parameters = Object.assign({\n\n      filter: {\n        type: 'select',\n        buffer: true,\n        options: {\n          'nearest': 'nearest',\n          'linear': 'linear',\n          'cubic-bspline': 'cubic-bspline',\n          'cubic-catmulrom': 'cubic-catmulrom',\n          'cubic-mitchell': 'cubic-mitchell'\n        }\n      },\n      positionType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'percent': 'percent', 'coordinate': 'coordinate'\n        }\n      },\n      position: {\n        type: 'range',\n        step: 0.1,\n        max: 100,\n        min: 1,\n        rebuild: true\n      },\n      dimension: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'x': 'x', 'y': 'y', 'z': 'z'\n        }\n      },\n      thresholdType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      thresholdMin: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdMax: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      normalize: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null,\n      linewidth: null,\n      colorScheme: null,\n\n      roughness: null,\n      metalness: null,\n      diffuse: null\n\n    })\n\n    this.volume = volume\n\n    this.init(params)\n  }\n\n  init (params: Partial<SliceRepresentationParameters>) {\n    const v = this.volume\n    const p = params || {}\n    p.colorDomain = defaults(p.colorDomain, [ v.min, v.max ])\n    p.colorScheme = defaults(p.colorScheme, 'value')\n    p.colorScale = defaults(p.colorScale, 'Spectral')\n\n    this.colorScheme = 'value'\n    this.dimension = defaults(p.dimension, 'x')\n    this.filter = defaults(p.filter, 'cubic-bspline')\n    this.positionType = defaults(p.positionType, 'percent')\n    this.position = defaults(p.position, 30)\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, -Infinity)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.normalize = defaults(p.normalize, false)\n\n    super.init(p)\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  create () {\n    const volumeSlice = new VolumeSlice(this.volume, {\n      positionType: this.positionType,\n      position: this.position,\n      dimension: this.dimension,\n      thresholdType: this.thresholdType,\n      thresholdMin: this.thresholdMin,\n      thresholdMax: this.thresholdMax,\n      normalize: this.normalize\n    })\n\n    const sliceBuffer = new ImageBuffer(\n      volumeSlice.getData({ colorParams: this.getColorParams() }) as ImageBufferData,\n      this.getBufferParams({\n        filter: this.filter\n      }) as ImageBufferParameters\n    )\n\n    this.bufferList.push(sliceBuffer)\n  }\n}\n\nexport default SliceRepresentation\n","/**\n * @file Representation Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, RepresentationRegistry } from '../globals'\n\nimport Viewer from '../viewer/viewer'\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Shape from '../geometry/shape'\n\nimport BufferRepresentation from './buffer-representation'\nimport SurfaceRepresentation from './surface-representation'\nimport DotRepresentation from './dot-representation'\nimport SliceRepresentation from './slice-representation'\n\nfunction logReprUnknown (type: string) {\n  Log.error(`makeRepresentation: representation type ${type} unknown`)\n}\n\nexport function makeRepresentation (type: string, object: any, viewer: Viewer, params: any) {  // TODO\n  if (Debug) Log.time('makeRepresentation ' + type)\n\n  var ReprClass\n\n  if (object instanceof Structure) {\n    ReprClass = RepresentationRegistry.get(type)\n\n    if (!ReprClass) {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Surface) {\n    if (type === 'surface') {\n      ReprClass = SurfaceRepresentation\n    } else if (type === 'dot') {\n      ReprClass = DotRepresentation\n    } else {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Volume) {\n    if (type === 'surface') {\n      ReprClass = SurfaceRepresentation\n    } else if (type === 'dot') {\n      ReprClass = DotRepresentation\n    } else if (type === 'slice') {\n      ReprClass = SliceRepresentation\n    } else {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Shape) {\n    ReprClass = BufferRepresentation\n    object = object.getBufferList()\n  } else if (type === 'buffer') {\n    ReprClass = BufferRepresentation\n  } else {\n    Log.error('makeRepresentation: object ' + object + ' unknown')\n    return\n  }\n\n  const repr = new ReprClass(object, viewer, params)\n\n  if (Debug) Log.timeEnd('makeRepresentation ' + type)\n\n  return repr\n}\n","/**\n * @file Element\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { createParams } from '../utils'\nimport { generateUUID } from '../math/math-utils'\nimport Stage from '../stage/stage'\n\nexport const ElementDefaultParameters = {\n  name: 'some element',\n  status: ''\n}\nexport type ElementParameters = typeof ElementDefaultParameters\n\nexport interface ElementSignals {\n  statusChanged: Signal  // on status change\n  nameChanged: Signal  // on name change\n  disposed: Signal  // on dispose\n}\n\n/**\n * Element base class\n */\nabstract class Element {\n  /**\n   * Events emitted by the element\n   */\n  signals: ElementSignals = {\n    statusChanged: new Signal(),\n    nameChanged: new Signal(),\n    disposed: new Signal()\n  }\n  readonly parameters: ElementParameters\n  readonly uuid: string\n\n  get defaultParameters() { return ElementDefaultParameters }\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {ElementParameters} params - component parameters\n   */\n  constructor (readonly stage: Stage, params: Partial<ElementParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n    this.uuid = generateUUID()\n  }\n\n  abstract get type (): string\n\n  get name () { return this.parameters.name }\n\n  setStatus (value: string) {\n    this.parameters.status = value\n    this.signals.statusChanged.dispatch(value)\n\n    return this\n  }\n\n  setName (value: string) {\n    this.parameters.name = value\n    this.signals.nameChanged.dispatch(value)\n\n    return this\n  }\n\n  dispose () {\n    this.signals.disposed.dispatch()\n  }\n}\n\nexport default Element\n","/**\n * @file Representation Element\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\nimport { Color } from 'three'\n\nimport Stage from '../stage/stage'\nimport Representation, { RepresentationParameters } from '../representation/representation'\nimport Component from './component'\nimport Element, { ElementDefaultParameters, ElementSignals } from './element'\n\nexport const RepresentationElementDefaultParameters = Object.assign({\n  visible: true\n}, ElementDefaultParameters)\nexport type RepresentationElementParameters = typeof RepresentationElementDefaultParameters\n\nexport interface RepresentationElementSignals extends ElementSignals {\n  visibilityChanged: Signal  // on visibility change\n  parametersChanged: Signal  // on parameters change\n}\n\n/**\n * Element wrapping a {@link Representation} object\n */\nclass RepresentationElement extends Element {\n  signals: RepresentationElementSignals\n  parameters: RepresentationElementParameters\n  get defaultParameters() { return RepresentationElementDefaultParameters }\n\n  repr: Representation\n\n  /**\n   * Create representation component\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Representation} repr - representation object to wrap\n   * @param {RepresentationParameters} [params] - component parameters\n   * @param {Component} [parent] - parent component\n   */\n  constructor (stage: Stage, repr: Representation, params: Partial<RepresentationElementParameters> = {}, readonly parent: Component) {\n    super(stage, Object.assign({ name: repr.type }, params))\n\n    this.signals = Object.assign({\n      visibilityChanged: new Signal(),\n      parametersChanged: new Signal()\n    }, this.signals)\n\n    this.setRepresentation(repr)\n  }\n\n  get visible () { return this.parameters.visible }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'representation' }\n\n  getType () {\n    return this.repr.type\n  }\n\n  setRepresentation (repr: Representation) {\n    this._disposeRepresentation()\n    this.repr = repr\n    // this.name = repr.type;\n    this.stage.tasks.listen(this.repr.tasks)\n    this.updateVisibility()\n  }\n\n  _disposeRepresentation () {\n    if (this.repr) {\n      this.stage.tasks.unlisten(this.repr.tasks)\n      this.repr.dispose()\n    }\n  }\n\n  dispose () {\n    if (this.parent && this.parent.hasRepresentation(this)) {\n      this.parent.removeRepresentation(this)\n    } else {\n      this._disposeRepresentation()\n      this.signals.disposed.dispatch()\n    }\n  }\n\n  /**\n   * Set the visibility of the component, takes parent visibility into account\n   * @param {Boolean} value - visibility flag\n   * @return {RepresentationElement} this object\n   */\n  setVisibility (value: boolean) {\n    this.parameters.visible = value\n    this.updateVisibility()\n    this.signals.visibilityChanged.dispatch(this.parameters.visible)\n\n    return this\n  }\n\n  getVisibility () {\n    if (this.parent) {\n      return this.parent.parameters.visible && this.parameters.visible\n    } else {\n      return this.parameters.visible\n    }\n  }\n\n  /**\n   * Toggle visibility of the component, takes parent visibility into account\n   * @return {RepresentationElement} this object\n   */\n  toggleVisibility () {\n    return this.setVisibility(!this.parameters.visible)\n  }\n\n  updateVisibility () {\n    this.repr.setVisibility(this.getVisibility())\n  }\n\n  /**\n   * Set selection\n   * @param {Object} what - flags indicating what attributes to update\n   * @param {Boolean} what.position - update position attribute\n   * @param {Boolean} what.color - update color attribute\n   * @param {Boolean} what.radius - update radius attribute\n   * @return {RepresentationElement} this object\n   */\n  update (what: any) {  // TODO\n    (this.repr as any).update(what)  // TODO\n\n    return this\n  }\n\n  build (params?: any) {  // TODO\n    this.repr.build(params)\n\n    return this\n  }\n\n  /**\n   * Set selection\n   * @param {String} string - selection string\n   * @return {RepresentationElement} this object\n   */\n  setSelection (string: string) {\n    const repr: any = this.repr  // TODO\n\n    if (repr.setSelection) {\n      repr.setSelection(string)\n    }\n\n    return this\n  }\n\n  /**\n   * Set representation parameters\n   * @param {RepresentationParameters} params - parameter object\n   * @return {RepresentationElement} this object\n   */\n  setParameters (params: any) {  // TODO\n    this.repr.setParameters(params)\n    this.signals.parametersChanged.dispatch(\n      this.repr.getParameters()\n    )\n\n    return this\n  }\n\n  /**\n   * Get representation parameters\n   * @return {RepresentationParameters} parameter object\n   */\n  getParameters (): Partial<RepresentationParameters> {\n    return this.repr.getParameters()\n  }\n\n  /**\n   * Set color\n   * @param {String|Color|Hex} value - color value\n   * @return {RepresentationElement} this object\n   */\n  setColor (value: string|number|Color) {\n    this.repr.setColor(value)\n\n    return this\n  }\n}\n\nexport default RepresentationElement\n","\n/**\n * @file Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion, Matrix4, Euler, Box3 } from 'three'\nimport { Signal } from 'signals'\n\nimport { defaults, createParams } from '../utils'\nimport { generateUUID } from '../math/math-utils'\nimport Annotation, { AnnotationParams } from '../component/annotation'\nimport ComponentControls from '../controls/component-controls'\nimport { makeRepresentation } from '../representation/representation-utils'\nimport RepresentationElement from './representation-element'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\nconst _m = new Matrix4()\nconst _v = new Vector3()\n\nexport const ComponentDefaultParameters = {\n  name: '',\n  status: '',\n  visible: true\n}\nexport type ComponentParameters = typeof ComponentDefaultParameters\n\n\nexport interface ComponentSignals {\n  representationAdded: Signal  // when a representation is added\n  representationRemoved: Signal  // when a representation is removed\n  visibilityChanged: Signal  // on visibility change\n  matrixChanged: Signal  // on matrix change\n  statusChanged: Signal  // on status change\n  nameChanged: Signal  // on name change\n  disposed: Signal  // on dispose\n}\n\n/**\n * Base class for components\n */\nabstract class Component {\n  /**\n   * Events emitted by the component\n   */\n  readonly signals: ComponentSignals = {\n    representationAdded: new Signal(),\n    representationRemoved: new Signal(),\n    visibilityChanged: new Signal(),\n    matrixChanged: new Signal(),\n    statusChanged: new Signal(),\n    nameChanged: new Signal(),\n    disposed: new Signal()\n  }\n\n  readonly parameters: ComponentParameters\n  get defaultParameters () { return ComponentDefaultParameters }\n\n  readonly uuid: string\n  readonly viewer: Viewer\n\n  reprList: RepresentationElement[] = []\n  annotationList: Annotation[] = []\n\n  matrix = new Matrix4()\n  position = new Vector3()\n  quaternion = new Quaternion()\n  scale = new Vector3(1, 1, 1)\n  transform = new Matrix4()\n\n  controls: ComponentControls\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {ComponentParameters} params - parameter object\n   */\n  constructor (readonly stage: Stage, readonly object: any, params: Partial<ComponentParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n    this.uuid = generateUUID()\n    this.viewer = stage.viewer\n\n    this.controls = new ComponentControls(this)\n  }\n\n  abstract get type (): string\n\n  get name () { return this.parameters.name }\n  get status () { return this.parameters.status }\n  get visible () { return this.parameters.visible }\n\n  /**\n   * Set position transform\n   *\n   * @example\n   * // translate by 25 angstrom along x axis\n   * component.setPosition([ 25, 0, 0 ]);\n   *\n   * @param {Vector3|Array} p - the coordinates\n   * @return {Component} this object\n   */\n  setPosition (p: [number, number, number]|Vector3) {\n    if (Array.isArray(p)) {\n      this.position.fromArray(p)\n    } else {\n      this.position.copy(p)\n    }\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set local rotation transform\n   * (for global rotation use setTransform)\n   *\n   * @example\n   * // rotate by 2 degree radians on x axis\n   * component.setRotation( [ 2, 0, 0 ] );\n   *\n   * @param {Quaternion|Euler|Array} r - the rotation\n   * @return {Component} this object\n   */\n  setRotation (r: [number, number, number]|Euler|Quaternion) {\n    if (Array.isArray(r)) {\n      if (r.length === 3) {\n        const e = new Euler().fromArray(r)\n        this.quaternion.setFromEuler(e)\n      } else {\n        this.quaternion.fromArray(r)\n      }\n    } else if (r instanceof Euler) {\n      this.quaternion.setFromEuler(r)\n    } else {\n      this.quaternion.copy(r)\n    }\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set scale transform\n   *\n   * @example\n   * // scale by factor of two\n   * component.setScale( 2 );\n   *\n   * @param {Number} s - the scale\n   * @return {Component} this object\n   */\n  setScale (s: number) {\n    this.scale.set(s, s, s)\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set general transform. Is applied before and in addition\n   * to the position, rotation and scale transformations\n   *\n   * @example\n   * component.setTransform( matrix );\n   *\n   * @param {Matrix4} m - the matrix\n   * @return {Component} this object\n   */\n  setTransform (m: Matrix4) {\n    this.transform.copy(m)\n    this.updateMatrix()\n\n    return this\n  }\n\n  updateMatrix () {\n    const c = this.getCenterUntransformed(_v)\n    this.matrix.makeTranslation(-c.x, -c.y, -c.z)\n\n    _m.makeRotationFromQuaternion(this.quaternion)\n    this.matrix.premultiply(_m)\n\n    _m.makeScale(this.scale.x, this.scale.y, this.scale.z)\n    this.matrix.premultiply(_m)\n\n    const p = this.position\n    _m.makeTranslation(p.x + c.x, p.y + c.y, p.z + c.z)\n    this.matrix.premultiply(_m)\n\n    this.matrix.premultiply(this.transform)\n\n    this.updateRepresentationMatrices()\n\n    this.stage.viewer.updateBoundingBox()\n\n    this.signals.matrixChanged.dispatch(this.matrix)\n  }\n\n  /**\n   * Propogates our matrix to each representation\n   */\n  updateRepresentationMatrices () {\n    this.reprList.forEach(repr => {\n      repr.setParameters({ matrix: this.matrix })\n    })\n  }\n\n  /**\n   * Add an anotation object\n   * @param {Vector3} position - the 3d position\n   * @param {String|Element} content - the HTML content\n   * @param {Object} [params] - parameters\n   * @param {Integer} params.offsetX - 2d offset in x direction\n   * @param {Integer} params.offsetY - 2d offset in y direction\n   * @return {Annotation} the added annotation object\n   */\n  addAnnotation (position: Vector3, content: string|HTMLElement, params: AnnotationParams) {\n    const annotation = new Annotation(this, position, content, params)\n    this.annotationList.push(annotation)\n\n    return annotation\n  }\n\n  /**\n   * Iterator over each annotation and executing the callback\n   * @param  {Function} callback - function to execute\n   * @return {undefined}\n   */\n  eachAnnotation (callback: (a: Annotation) => void) {\n    this.annotationList.slice().forEach(callback)\n  }\n\n  /**\n   * Remove the give annotation from the component\n   * @param {Annotation} annotation - the annotation to remove\n   * @return {undefined}\n   */\n  removeAnnotation (annotation: Annotation) {\n    const idx = this.annotationList.indexOf(annotation)\n    if (idx !== -1) {\n      this.annotationList.splice(idx, 1)\n      annotation.dispose()\n    }\n  }\n\n  /**\n   * Remove all annotations from the component\n   * @return {undefined}\n   */\n  removeAllAnnotations () {\n    this.eachAnnotation(annotation => annotation.dispose())\n    this.annotationList.length = 0\n  }\n\n  /**\n   * Add a new representation to the component\n   * @param {String} type - the name of the representation\n   * @param {Object} object - the object on which the representation should be based\n   * @param {RepresentationParameters} [params] - representation parameters\n   * @return {RepresentationElement} the created representation wrapped into\n   *                                   a representation element object\n   */\n  protected _addRepresentation (type: string, object: any, params: any, hidden = false) {  // TODO\n    const p = params || {}\n    const sp = this.stage.getParameters() as any  // TODO\n    p.matrix = this.matrix.clone()\n    p.quality = p.quality || sp.quality\n    p.disableImpostor = defaults(p.disableImpostor, !sp.impostor)\n    p.useWorker = defaults(p.useWorker, sp.workerDefault)\n    p.visible = defaults(p.visible, true)\n\n    const p2 = Object.assign({}, p, { visible: this.parameters.visible && p.visible })\n    const repr = makeRepresentation(type, object, this.viewer, p2)\n    const reprElem = new RepresentationElement(this.stage, repr, p, this)\n\n    if (!hidden) {\n      this.reprList.push(reprElem)\n      this.signals.representationAdded.dispatch(reprElem)\n    }\n    return reprElem\n  }\n\n  abstract addRepresentation (type: any, params: any): any\n\n  addBufferRepresentation (buffer: any, params: any) {  // TODO\n    return this._addRepresentation.call(this, 'buffer', buffer, params)\n  }\n\n  hasRepresentation (repr: RepresentationElement) {\n    return this.reprList.indexOf(repr) !== -1\n  }\n\n  /**\n   * Iterator over each representation and executing the callback\n   * @param  {Function} callback - function to execute\n   * @return {undefined}\n   */\n  eachRepresentation (callback: (repr: RepresentationElement) => void) {\n    this.reprList.slice().forEach(callback)\n  }\n\n  /**\n   * Removes a representation component\n   * @param {RepresentationElement} repr - the representation element\n   * @return {undefined}\n   */\n  removeRepresentation (repr: RepresentationElement) {\n    const idx = this.reprList.indexOf(repr)\n    if (idx !== -1) {\n      this.reprList.splice(idx, 1)\n      repr.dispose()\n      this.signals.representationRemoved.dispatch(repr)\n    }\n  }\n\n  updateRepresentations (what: any) {  // TODO\n    this.reprList.forEach(repr => repr.update(what))\n    this.stage.viewer.requestRender()\n  }\n\n  /**\n   * Removes all representation components\n   * @return {undefined}\n   */\n  removeAllRepresentations () {\n    this.eachRepresentation(repr => repr.dispose())\n  }\n\n  dispose () {\n    this.removeAllAnnotations()\n    this.removeAllRepresentations()\n\n    this.reprList.length = 0\n\n    this.signals.disposed.dispatch()\n  }\n\n  /**\n   * Set the visibility of the component, including added representations\n   * @param {Boolean} value - visibility flag\n   * @return {Component} this object\n   */\n  setVisibility (value: boolean) {\n    this.parameters.visible = value\n\n    this.eachRepresentation((repr: RepresentationElement) => repr.updateVisibility())\n    this.eachAnnotation((annotation: Annotation) => annotation.updateVisibility())\n\n    this.signals.visibilityChanged.dispatch(value)\n\n    return this\n  }\n\n  setStatus (value: string) {\n    this.parameters.status = value\n    this.signals.statusChanged.dispatch(value)\n\n    return this\n  }\n\n  setName (value: string) {\n    this.parameters.name = value\n    this.signals.nameChanged.dispatch(value)\n\n    return this\n  }\n\n  /**\n   * @return {Box3} the component's bounding box\n   */\n  getBox (...args: any[]) {\n    return this.getBoxUntransformed(...args)\n              .clone().applyMatrix4(this.matrix)\n  }\n\n  /**\n   * @return {Vector3} the component's center position\n   */\n  getCenter (...args: any[]) {\n    return this.getCenterUntransformed(...args)\n              .clone().applyMatrix4(this.matrix)\n  }\n\n  getZoom (...args: any[]) {\n    return this.stage.getZoomForBox(this.getBox(...args))\n  }\n\n  /**\n   * @abstract\n   * @return {Box3} the untransformed component's bounding box\n   */\n  getBoxUntransformed (...args: any[]): Box3 {\n    return new Box3()\n  }\n\n  getCenterUntransformed (...args: any[]) {\n    return this.getBoxUntransformed().getCenter(new Vector3())\n  }\n\n  /**\n   * Automatically center and zoom the component\n   * @param  {Integer} [duration] - duration of the animation, defaults to 0\n   * @return {undefined}\n   */\n  autoView (duration?: number) {\n    this.stage.animationControls.zoomMove(\n      this.getCenter(),\n      this.getZoom(),\n      defaults(duration, 0)\n    )\n  }\n}\n\nexport default Component\n","/**\n * @file Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Component from './component'\nimport Element from './element'\n\nclass Collection<T extends (Component|Element)> {\n  constructor (readonly list: T[] = []) {\n    // remove elements from list when they get disposed\n    const n = list.length\n\n    for (let i = 0; i < n; ++i) {\n      const elm = list[ i ]\n      elm.signals.disposed.add(this._remove, this)\n    }\n  }\n\n  _remove (elm: T) {\n    const idx = this.list.indexOf(elm)\n\n    if (idx !== -1) {\n      this.list.splice(idx, 1)\n    }\n  }\n\n  get first () {\n    return this.list.length > 0 ? this.list[0] : undefined\n  }\n\n  forEach (fn: (x: T) => any) {\n    this.list.forEach(fn)\n\n    return this\n  }\n\n  dispose () {\n    return this.forEach((elm) => elm.dispose())\n  }\n}\n\nexport default Collection\n","/**\n * @file Component Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport RepresentationElement from './representation-element'\nimport Collection from './collection'\nimport { GenericColor } from '../types'\n\nclass RepresentationCollection extends Collection<RepresentationElement> {\n  setParameters (params: any) {\n    return this.forEach((repr) => repr.setParameters(params))\n  }\n\n  setVisibility (value: boolean) {\n    return this.forEach((repr) => repr.setVisibility(value))\n  }\n\n  setSelection (string: string) {\n    return this.forEach((repr) => repr.setSelection(string))\n  }\n\n  setColor (color: GenericColor) {\n    return this.forEach((repr) => repr.setColor(color))\n  }\n\n  update (what: any) {\n    return this.forEach((repr) => repr.update(what))\n  }\n\n  build (params?: any) {\n    return this.forEach((repr) => repr.build(params))\n  }\n\n  dispose (params?: any) {\n    return this.forEach((repr) => repr.dispose())\n  }\n}\n\nexport default RepresentationCollection\n","/**\n * @file Trajectory Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport Element, { ElementSignals, ElementDefaultParameters } from './element'\nimport Stage from '../stage/stage'\nimport Trajectory, { TrajectoryParameters } from '../trajectory/trajectory'\nimport TrajectoryPlayer, {\n  TrajectoryPlayerDirection, TrajectoryPlayerMode, TrajectoryPlayerInterpolateType\n} from '../trajectory/trajectory-player'\n\n/**\n * Trajectory component parameter object.\n * @typedef {Object} TrajectoryComponentParameters - component parameters\n *\n * @property {String} name - component name\n * @property {Integer} initialFrame - initial frame the trajectory is set to\n * @property {Integer} defaultStep - default step size to be used by trajectory players\n * @property {Integer} defaultTimeout - default timeout to be used by trajectory players\n * @property {String} defaultInterpolateType - one of \"\" (empty string), \"linear\" or \"spline\"\n * @property {Integer} defaultInterpolateStep - window size used for interpolation\n * @property {String} defaultMode - either \"loop\" or \"once\"\n * @property {String} defaultDirection - either \"forward\" or \"backward\"\n */\n\nexport const TrajectoryElementDefaultParameters = Object.assign({\n  defaultStep: 1,\n  defaultTimeout: 50,\n  defaultInterpolateType: '' as TrajectoryPlayerInterpolateType,\n  defaultInterpolateStep: 5,\n  defaultMode: 'loop' as TrajectoryPlayerMode,\n  defaultDirection: 'forward' as TrajectoryPlayerDirection,\n  initialFrame: 0\n}, ElementDefaultParameters)\nexport type TrajectoryElementParameters = typeof TrajectoryElementDefaultParameters\n\nexport interface TrajectoryElementSignals extends ElementSignals {\n  frameChanged: Signal  // on frame change\n  playerChanged: Signal  // on player change\n  countChanged: Signal  // when frame count is available\n  parametersChanged: Signal  // on parameters change\n}\n\n/**\n * Component wrapping a {@link Trajectory} object\n */\nclass TrajectoryElement extends Element {\n  signals: TrajectoryElementSignals\n  parameters: TrajectoryElementParameters\n  get defaultParameters () { return TrajectoryElementDefaultParameters }\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Trajectory} trajectory - the trajectory object\n   * @param {TrajectoryComponentParameters} params - component parameters\n   * @param {StructureComponent} parent - the parent structure\n   */\n  constructor (stage: Stage, readonly trajectory: Trajectory, params: Partial<TrajectoryElementParameters> = {}) {\n    super(stage, Object.assign({ name: trajectory.name }, params))\n\n    this.signals = Object.assign(this.signals, {\n      frameChanged: new Signal(),\n      playerChanged: new Signal(),\n      countChanged: new Signal(),\n      parametersChanged: new Signal()\n    })\n\n    // signals\n\n    trajectory.signals.frameChanged.add((i: number) => {\n      this.signals.frameChanged.dispatch(i)\n    })\n\n    trajectory.signals.playerChanged.add((player: TrajectoryPlayer) => {\n      this.signals.playerChanged.dispatch(player)\n    })\n\n    trajectory.signals.countChanged.add((n: number) => {\n      this.signals.countChanged.dispatch(n)\n    })\n\n    //\n\n    if (params.initialFrame !== undefined) {\n      this.setFrame(params.initialFrame)\n    }\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'trajectory' }\n\n  /**\n   * Set the frame of the trajectory\n   * @param {Integer} i - frame number\n   * @return {undefined}\n   */\n  setFrame (i: number) {\n    this.trajectory.setFrame(i)\n  }\n\n  /**\n   * Set trajectory parameters\n   * @param {TrajectoryParameters} params - trajectory parameters\n   * @return {undefined}\n   */\n  setParameters (params: Partial<TrajectoryParameters> = {}) {\n    this.trajectory.setParameters(params)\n    this.signals.parametersChanged.dispatch(params)\n  }\n\n  dispose () {\n    this.trajectory.dispose()\n    super.dispose()\n  }\n}\n\nexport default TrajectoryElement\n","/**\n * @file Frames\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport default class Frames {\n  coordinates = []\n  boxes = []\n  times = []\n\n  timeOffset = 0\n  deltaTime = 1\n\n  constructor (readonly name: string, readonly path: string) {}\n\n  get type () { return 'Frames' }\n}\n","/**\n * @file Superposition\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\nimport { Debug, Log } from '../globals'\nimport {\n    Matrix, svd, meanRows, subRows, transpose,\n    multiplyABt, invert3x3, multiply3x3, mat3x3determinant, multiply\n} from '../math/matrix-utils'\nimport Structure from '../structure/structure'\n\nclass Superposition {\n  coords1t: Matrix\n  coords2t: Matrix\n\n  transformationMatrix: Matrix4\n\n  mean1: number[]\n  mean2: number[]\n\n  A = new Matrix(3, 3)\n  W = new Matrix(1, 3)\n  U = new Matrix(3, 3)\n  V = new Matrix(3, 3)\n  VH = new Matrix(3, 3)\n  R = new Matrix(3, 3)\n\n  private tmp = new Matrix(3, 3)\n  private c = new Matrix(3, 3)\n\n  constructor (atoms1: Structure|Float32Array, atoms2: Structure|Float32Array) {\n    // allocate & init data structures\n\n    let n1\n    if (atoms1 instanceof Structure) {\n      n1 = atoms1.atomCount\n    } else if (atoms1 instanceof Float32Array) {\n      n1 = atoms1.length / 3\n    } else {\n      return\n    }\n\n    let n2\n    if (atoms2 instanceof Structure) {\n      n2 = atoms2.atomCount\n    } else if (atoms2 instanceof Float32Array) {\n      n2 = atoms2.length / 3\n    } else {\n      return\n    }\n\n    const n = Math.min(n1, n2)\n\n    const coords1 = new Matrix(3, n)\n    const coords2 = new Matrix(3, n)\n\n    this.coords1t = new Matrix(n, 3)\n    this.coords2t = new Matrix(n, 3)\n\n    this.transformationMatrix = new Matrix4()\n\n    this.c.data.set([ 1, 0, 0, 0, 1, 0, 0, 0, -1 ])\n\n    // prep coords\n\n    this.prepCoords(atoms1, coords1, n, false)\n    this.prepCoords(atoms2, coords2, n, false)\n\n    // superpose\n\n    this._superpose(coords1, coords2)\n  }\n\n  _superpose (coords1: Matrix, coords2: Matrix) {\n    this.mean1 = meanRows(coords1)\n    this.mean2 = meanRows(coords2)\n\n    subRows(coords1, this.mean1)\n    subRows(coords2, this.mean2)\n\n    transpose(this.coords1t, coords1)\n    transpose(this.coords2t, coords2)\n\n    multiplyABt(this.A, this.coords2t, this.coords1t)\n\n    svd(this.A, this.W, this.U, this.V)\n\n    invert3x3(this.V, this.VH)\n    multiply3x3(this.R, this.U, this.VH)\n\n    if (mat3x3determinant(this.R) < 0.0) {\n      if (Debug) Log.log('R not a right handed system')\n\n      multiply3x3(this.tmp, this.c, this.VH)\n      multiply3x3(this.R, this.U, this.tmp)\n    }\n\n    //get the transformation matrix\n\n    const transformMat_ = new Matrix(4,4)\n    const tmp_1 = new Matrix(4,4)\n    const tmp_2 = new Matrix(4,4)\n\n    const sub = new Matrix(4,4)\n    const mult = new Matrix(4,4)\n    const add = new Matrix(4,4)\n\n    const R = this.R.data\n    const M1 = this.mean1\n    const M2 = this.mean2\n\n    sub.data.set([ 1, 0, 0, -M1[0],\n                   0, 1, 0, -M1[1],\n                   0, 0, 1, -M1[2],\n                   0, 0, 0, 1 ])\n\n    mult.data.set([ R[0], R[1], R[2], 0,\n                    R[3], R[4], R[5], 0,\n                    R[6], R[7], R[8], 0,\n                    0, 0, 0, 1 ])\n\n    add.data.set([ 1, 0, 0, M2[0],\n                   0, 1, 0, M2[1],\n                   0, 0, 1, M2[2],\n                   0, 0, 0, 1 ])\n\n    transpose(tmp_1,sub)\n    multiplyABt(transformMat_,mult,tmp_1)\n    transpose(tmp_2,transformMat_)\n    multiplyABt(tmp_1,add,tmp_2)\n\n    transpose(transformMat_,tmp_1)\n    this.transformationMatrix.elements = transformMat_.data as unknown as number[]\n\n  }\n\n  prepCoords (atoms: Structure|Float32Array, coords: Matrix, n: number, is4X4: boolean) {\n    let i = 0\n    const cd = coords.data\n\n    let c = 3\n    let d = n * 3\n\n    if (is4X4) {\n      d = n * 4\n      c = 4\n    }\n    if (atoms instanceof Structure) {\n      atoms.eachAtom(function (a) {\n        if (i < d) {\n          cd[ i + 0 ] = a.x\n          cd[ i + 1 ] = a.y\n          cd[ i + 2 ] = a.z\n          if (is4X4) cd[ i + 3 ] = 1\n\n          i += c\n        }\n      })\n    } else if (atoms instanceof Float32Array) {\n      for (; i < d; i += c){\n        if (i < d) {\n          cd[ i ] = atoms[ i ]\n          cd[ i + 1 ] = atoms[ i + 1 ]\n          cd[ i + 2 ] = atoms[ i + 2 ]\n          if (is4X4) cd[ i + 3 ] = 1\n        }\n      }\n    } else {\n      Log.warn('prepCoords: input type unknown')\n    }\n  }\n\n  transform (atoms: Structure|Float32Array) {\n    // allocate data structures\n\n    let n\n    if (atoms instanceof Structure) {\n      n = atoms.atomCount\n    } else if (atoms instanceof Float32Array) {\n      n = atoms.length / 3\n    } else {\n      return\n    }\n\n    const coords = new Matrix(4, n)\n    const tCoords = new Matrix(n,4)\n\n    // prep coords\n\n    this.prepCoords(atoms, coords, n, true)\n\n    // check for transformation matrix correctness\n\n    const transform = this.transformationMatrix\n    const det = transform.determinant()\n    if (!det){\n      return det\n    }\n\n    // do transform\n\n    const mult = new Matrix(4,4)\n    mult.data = transform.elements as unknown as Float32Array\n    multiply(tCoords,coords,mult)\n\n    let i = 0\n    const cd = tCoords.data\n    if (atoms instanceof Structure) {\n        atoms.eachAtom(function (a) {\n          a.x = cd[ i ]\n          a.y = cd[ i + 1 ]\n          a.z = cd[ i + 2 ]\n          i += 4\n        })\n\n        //update transformation matrices for each assembly\n\n        const invertTrasform = new Matrix4()\n        invertTrasform.copy(transform).invert()\n\n        const biomolDict = atoms.biomolDict\n\n        for (let key in biomolDict) {\n\n          if (biomolDict.hasOwnProperty(key)) {\n            let assembly = biomolDict[key]\n\n            assembly.partList.forEach(function(part){\n\n              part.matrixList.forEach(function(mat){\n\n                mat.premultiply(transform)\n                mat.multiply(invertTrasform)\n\n              })\n            })\n          }\n        }\n    } else if (atoms instanceof Float32Array) {\n\n      const n4 = n * 4\n      for (; i < n4; i += 4){\n\n        atoms[ i ] = cd[ i ]\n        atoms[ i + 1 ] = cd[ i + 1 ]\n        atoms[ i + 2 ] = cd[ i + 2 ]\n\n      }\n    } else {\n      Log.warn('transform: input type unknown')\n    }\n\n    return this.transformationMatrix\n  }\n}\nexport default Superposition\n","/**\n * @file Trajectory Player\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { defaults, createParams, updateParams } from '../utils'\nimport Trajectory from './trajectory'\n\nexport type TrajectoryPlayerInterpolateType = ''|'linear'|'spline'\nexport type TrajectoryPlayerMode = 'loop'|'once'\nexport type TrajectoryPlayerDirection = 'forward'|'backward'|'bounce'\n\nexport const TrajectoryPlayerDefaultParameters = {\n  step: 1,  // how many frames to advance when playing\n  timeout: 50,  // how many milliseconds to wait between playing frames\n  start: 0,  // first frame to play\n  end: 0,  // last frame to play\n  interpolateType: '' as TrajectoryPlayerInterpolateType,\n  interpolateStep: 5,  // window size used for interpolation\n  mode: 'loop' as TrajectoryPlayerMode,\n  direction: 'forward' as TrajectoryPlayerDirection\n}\nexport type TrajectoryPlayerParameters = typeof TrajectoryPlayerDefaultParameters\n\nexport interface TrajectoryPlayerSignals {\n  startedRunning: Signal\n  haltedRunning: Signal\n}\n\n/**\n * Trajectory player for animating coordinate frames\n * @example\n * var player = new TrajectoryPlayer(trajectory, {step: 1, timeout: 50});\n * player.play();\n */\nclass TrajectoryPlayer {\n  signals: TrajectoryPlayerSignals = {\n    startedRunning: new Signal(),\n    haltedRunning: new Signal()\n  }\n\n  parameters: TrajectoryPlayerParameters\n  traj: Trajectory\n\n  private _run = false\n  private _previousTime = 0\n  private _currentTime = 0\n  private _currentStep = 1\n  private _currentFrame: number|[number, number, number, number]\n  private _direction: TrajectoryPlayerDirection\n\n  /**\n   * make trajectory player\n   * @param {Trajectory} traj - the trajectory\n   * @param {TrajectoryPlayerParameters} [params] - parameter object\n   */\n  constructor (traj: Trajectory, params: Partial<TrajectoryPlayerParameters> = {}) {\n    traj.signals.playerChanged.add((player: TrajectoryPlayer) => {\n      if (player !== this) {\n        this.pause()\n      }\n    }, this)\n\n    const n = defaults(traj.frameCount, 1)\n\n    this.traj = traj\n    this.parameters = createParams(params, TrajectoryPlayerDefaultParameters)\n    this.parameters.end = Math.min(defaults(params.end, n - 1), n - 1)\n    this.parameters.step = defaults(params.step, Math.ceil((n + 1) / 100))\n\n    this._currentFrame = this.parameters.start\n    this._direction = this.parameters.direction === 'bounce' ? 'forward' : this.parameters.direction\n\n    traj.signals.countChanged.add((n: number) => {\n      this.parameters.end = Math.min(defaults(this.parameters.end, n - 1), n - 1)\n    }, this)\n\n    this._animate = this._animate.bind(this)\n  }\n\n  get isRunning () { return this._run }\n\n  /**\n   * set player parameters\n   * @param {TrajectoryPlayerParameters} [params] - parameter object\n   */\n  setParameters (params: Partial<TrajectoryPlayerParameters> = {}) {\n    updateParams(this.parameters, params)\n\n    if (params.direction !== undefined && this.parameters.direction !== 'bounce') {\n      this._direction = this.parameters.direction\n    }\n  }\n\n  _animate () {\n    if (!this._run) return\n\n    this._currentTime = window.performance.now()\n    const dt = this._currentTime - this._previousTime\n    const step = this.parameters.interpolateType ? this.parameters.interpolateStep : 1\n    const timeout = this.parameters.timeout / step\n    const traj = this.traj\n\n    if (traj && traj.frameCount && !traj.inProgress && dt >= timeout) {\n      if (this.parameters.interpolateType) {\n        if (this._currentStep > this.parameters.interpolateStep) {\n          this._currentStep = 1\n        }\n        if (this._currentStep === 1) {\n          this._currentFrame = this._nextInterpolated()\n        }\n        if (traj.hasFrame(this._currentFrame)) {\n          this._currentStep += 1\n          const t = this._currentStep / (this.parameters.interpolateStep + 1)\n          const [i, ip, ipp, ippp] = this._currentFrame as [number, number, number, number]\n          traj.setFrameInterpolated(\n            i, ip, ipp, ippp, t, this.parameters.interpolateType\n          )\n          this._previousTime = this._currentTime\n        } else {\n          traj.loadFrame(this._currentFrame)\n        }\n      } else {\n        const i = this._next()\n        if (traj.hasFrame(i)) {\n          traj.setFrame(i)\n          this._previousTime = this._currentTime\n        } else {\n          traj.loadFrame(i)\n        }\n      }\n    }\n\n    window.requestAnimationFrame(this._animate)\n  }\n\n  _next () {\n    const p = this.parameters\n    let i\n\n    if (this._direction === 'forward') {\n      i = this.traj.currentFrame + p.step\n    } else {\n      i = this.traj.currentFrame - p.step\n    }\n\n    if (i > p.end || i < p.start) {\n      if (p.direction === 'bounce') {\n        if (this._direction === 'forward') {\n          this._direction = 'backward'\n        } else {\n          this._direction = 'forward'\n        }\n      }\n\n      if (p.mode === 'once') {\n        this.pause()\n\n        if (p.direction === 'forward') {\n          i = p.end\n        } else if (p.direction === 'backward') {\n          i = p.start\n        } else {\n          if (this._direction === 'forward') {\n            i = p.start\n          } else {\n            i = p.end\n          }\n        }\n      } else {\n        if (this._direction === 'forward') {\n          i = p.start\n          if (p.interpolateType) {\n            i = Math.min(p.end, i + p.step)\n          }\n        } else {\n          i = p.end\n          if (p.interpolateType) {\n            i = Math.max(p.start, i - p.step)\n          }\n        }\n      }\n    }\n\n    return i\n  }\n\n  _nextInterpolated () {\n    const p = this.parameters\n    const i = this._next()\n    let ip, ipp, ippp\n\n    if (this._direction === 'forward') {\n      ip = Math.max(p.start, i - p.step)\n      ipp = Math.max(p.start, i - 2 * p.step)\n      ippp = Math.max(p.start, i - 3 * p.step)\n    } else {\n      ip = Math.min(p.end, i + p.step)\n      ipp = Math.min(p.end, i + 2 * p.step)\n      ippp = Math.min(p.end, i + 3 * p.step)\n    }\n\n    return [i, ip, ipp, ippp] as [number, number, number, number]\n  }\n\n  /**\n   * toggle between playing and pausing the animation\n   * @return {undefined}\n   */\n  toggle () {\n    if (this._run) {\n      this.pause()\n    } else {\n      this.play()\n    }\n  }\n\n  /**\n   * start the animation\n   * @return {undefined}\n   */\n  play () {\n    if (!this._run) {\n      if (this.traj.player !== this) {\n        this.traj.setPlayer(this)\n      }\n      this._currentStep = 1\n\n      const p = this.parameters\n      const frame = this.traj.currentFrame\n\n      // snap to the grid implied by this.step division and multiplication\n      // thus minimizing cache misses\n      let i = Math.ceil(frame / p.step) * p.step\n      // wrap when restarting from the limit (i.e. end or start)\n      if (p.direction === 'forward' && frame >= p.end) {\n        i = p.start\n      } else if (p.direction === 'backward' && frame <= p.start) {\n        i = p.end\n      }\n\n      this.traj.setFrame(i)\n\n      this._run = true\n      this._animate()\n      this.signals.startedRunning.dispatch()\n    }\n  }\n\n  /**\n   * pause the animation\n   * @return {undefined}\n   */\n  pause () {\n    this._run = false\n    this.signals.haltedRunning.dispatch()\n  }\n\n  /**\n   * stop the animation (pause and go to start-frame)\n   * @return {undefined}\n   */\n  stop () {\n    this.pause()\n    this.traj.setFrame(this.parameters.start)\n  }\n}\n\nexport default TrajectoryPlayer\n","/**\n * @file Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { Log } from '../globals'\nimport { defaults } from '../utils'\nimport { NumberArray } from '../types'\nimport { circularMean, arrayMean } from '../math/array-utils'\nimport { lerp, spline } from '../math/math-utils'\nimport Selection from '../selection/selection'\nimport Superposition from '../align/superposition'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport TrajectoryPlayer, { TrajectoryPlayerInterpolateType } from './trajectory-player'\n\n\nfunction centerPbc (coords: NumberArray, mean: number[], box: ArrayLike<number>) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  const n = coords.length\n\n  const bx = box[ 0 ]\n  const by = box[ 1 ]\n  const bz = box[ 2 ]\n  const mx = mean[ 0 ]\n  const my = mean[ 1 ]\n  const mz = mean[ 2 ]\n\n  const fx = -mx + bx + bx / 2\n  const fy = -my + by + by / 2\n  const fz = -mz + bz + bz / 2\n\n  for (let i = 0; i < n; i += 3) {\n    coords[ i + 0 ] = (coords[ i + 0 ] + fx) % bx\n    coords[ i + 1 ] = (coords[ i + 1 ] + fy) % by\n    coords[ i + 2 ] = (coords[ i + 2 ] + fz) % bz\n  }\n}\n\nfunction removePbc (x: NumberArray, box: ArrayLike<number>) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  // ported from GROMACS src/gmxlib/rmpbc.c:rm_gropbc()\n  // in-place\n\n  const n = x.length\n\n  for (let i = 3; i < n; i += 3) {\n    for (let j = 0; j < 3; ++j) {\n      const dist = x[ i + j ] - x[ i - 3 + j ]\n\n      if (Math.abs(dist) > 0.9 * box[ j * 3 + j ]) {\n        if (dist > 0) {\n          for (let d = 0; d < 3; ++d) {\n            x[ i + d ] -= box[ j * 3 + d ]\n          }\n        } else {\n          for (let d = 0; d < 3; ++d) {\n            x[ i + d ] += box[ j * 3 + d ]\n          }\n        }\n      }\n    }\n  }\n\n  return x\n}\n\nfunction removePeriodicity (x: NumberArray, box: ArrayLike<number>, mean: number[]) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  const n = x.length\n  for (let i = 3; i < n; i += 3) {\n    for (let j = 0; j < 3; ++j) {\n      const f = (x[ i + j ] - mean[ j ]) / box[ j * 3 + j ]\n      if (Math.abs(f) > 0.5) {\n        x[ i + j ] -= box[ j * 3 + j ] * Math.round(f)\n      }\n    }\n  }\n\n  return x\n}\n\nfunction circularMean3 (indices: NumberArray, coords: NumberArray, box: ArrayLike<number>) {\n  return [\n    circularMean(coords, box[ 0 ], 3, 0, indices),\n    circularMean(coords, box[ 1 ], 3, 1, indices),\n    circularMean(coords, box[ 2 ], 3, 2, indices)\n  ]\n}\n\nfunction arrayMean3 (coords: NumberArray) {\n  return [\n    arrayMean(coords, 3, 0),\n    arrayMean(coords, 3, 1),\n    arrayMean(coords, 3, 2)\n  ]\n}\n\nfunction interpolateSpline (c: NumberArray, cp: NumberArray, cpp: NumberArray, cppp: NumberArray, t: number) {\n  const m = c.length\n  const coords = new Float32Array(m)\n\n  for (let j0 = 0; j0 < m; j0 += 3) {\n    const j1 = j0 + 1\n    const j2 = j0 + 2\n    coords[ j0 ] = spline(cppp[ j0 ], cpp[ j0 ], cp[ j0 ], c[ j0 ], t, 1)\n    coords[ j1 ] = spline(cppp[ j1 ], cpp[ j1 ], cp[ j1 ], c[ j1 ], t, 1)\n    coords[ j2 ] = spline(cppp[ j2 ], cpp[ j2 ], cp[ j2 ], c[ j2 ], t, 1)\n  }\n\n  return coords\n}\n\nfunction interpolateLerp (c: NumberArray, cp: NumberArray, t: number) {\n  const m = c.length\n  const coords = new Float32Array(m)\n\n  for (let j0 = 0; j0 < m; j0 += 3) {\n    const j1 = j0 + 1\n    const j2 = j0 + 2\n    coords[ j0 ] = lerp(cp[ j0 ], c[ j0 ], t)\n    coords[ j1 ] = lerp(cp[ j1 ], c[ j1 ], t)\n    coords[ j2 ] = lerp(cp[ j2 ], c[ j2 ], t)\n  }\n\n  return coords\n}\n\n/**\n * Trajectory parameter object.\n * @typedef {Object} TrajectoryParameters - parameters\n *\n * @property {Number} deltaTime - timestep between frames in picoseconds\n * @property {Number} timeOffset - starting time of frames in picoseconds\n * @property {String} sele - to restrict atoms used for superposition\n * @property {Boolean} centerPbc - center on initial frame\n * @property {Boolean} removePeriodicity - move atoms into the origin box\n * @property {Boolean} remo - try fixing periodic boundary discontinuities\n * @property {Boolean} superpose - superpose on initial frame\n */\n\n/**\n * @example\n * trajectory.signals.frameChanged.add( function(i){ ... } );\n *\n * @typedef {Object} TrajectorySignals\n * @property {Signal<Integer>} countChanged - when the frame count is changed\n * @property {Signal<Integer>} frameChanged - when the set frame is changed\n * @property {Signal<TrajectoryPlayer>} playerChanged - when the player is changed\n */\n\nexport interface TrajectoryParameters {\n  deltaTime: number  // timestep between frames in picoseconds\n  timeOffset: number  // starting time of frames in picoseconds\n  sele: string  // to restrict atoms used for superposition\n  centerPbc: boolean  // center on initial frame\n  removePbc: boolean  // move atoms into the origin box\n  removePeriodicity: boolean  // try fixing periodic boundary discontinuities\n  superpose: boolean  // superpose on initial frame\n}\n\nexport interface TrajectorySignals {\n  countChanged: Signal\n  frameChanged: Signal\n  playerChanged: Signal\n}\n\n/**\n * Base class for trajectories, tying structures and coordinates together\n * @interface\n */\nclass Trajectory {\n  signals: TrajectorySignals = {\n    countChanged: new Signal(),\n    frameChanged: new Signal(),\n    playerChanged: new Signal()\n  }\n\n  deltaTime: number\n  timeOffset: number\n  sele: string\n  centerPbc: boolean\n  removePbc: boolean\n  removePeriodicity: boolean\n  superpose: boolean\n\n  name: string\n  frame: number\n  trajPath: string\n\n  initialCoords: Float32Array\n  structureCoords: Float32Array\n  selectionIndices: NumberArray\n  backboneIndices: NumberArray\n\n  coords1: Float32Array\n  coords2: Float32Array\n\n  frameCache: { [k: number]: Float32Array } = {}\n  loadQueue: { [k: number]: boolean } = {}\n  boxCache: { [k: number]: ArrayLike<number> } = {}\n  pathCache = {}\n  frameCacheSize = 0\n\n  atomCount: number\n  inProgress: boolean\n\n  selection: Selection  // selection to restrict atoms used for superposition\n  structure: Structure\n  player: TrajectoryPlayer\n\n  private _frameCount = 0\n  private _currentFrame = -1\n  private _disposed = false\n\n  /**\n   * @param {String} trajPath - trajectory source\n   * @param {Structure} structure - the structure object\n   * @param {TrajectoryParameters} params - trajectory parameters\n   */\n  constructor (trajPath: string, structure: Structure, params: Partial<TrajectoryParameters> = {}) {\n    this.deltaTime = defaults(params.deltaTime, 0)\n    this.timeOffset = defaults(params.timeOffset, 0)\n    this.centerPbc = defaults(params.centerPbc, false)\n    this.removePbc = defaults(params.removePbc, false)\n    this.removePeriodicity = defaults(params.removePeriodicity, false)\n    this.superpose = defaults(params.superpose, false)\n\n    this.name = trajPath.replace(/^.*[\\\\/]/, '')\n    this.trajPath = trajPath\n\n    this.selection = new Selection(\n      defaults(params.sele, 'backbone and not hydrogen')\n    )\n\n    this.selection.signals.stringChanged.add(() => {\n      this.selectionIndices = this.structure.getAtomIndices(this.selection)!\n      this._resetCache()\n      this._saveInitialCoords()\n      this.setFrame(this._currentFrame)\n    })\n  }\n\n  /**\n   * Number of frames in the trajectory\n   */\n  get frameCount () {\n    return this._frameCount\n  }\n\n  /**\n   * Currently set frame of the trajectory\n   */\n  get currentFrame () {\n    return this._currentFrame\n  }\n\n  _init (structure: Structure) {\n    this.setStructure(structure)\n    this._loadFrameCount()\n    this.setPlayer(new TrajectoryPlayer(this))\n  }\n\n  _loadFrameCount () {}\n\n  setStructure (structure: Structure) {\n    this.structure = structure\n    this.atomCount = structure.atomCount\n\n    this.backboneIndices = this._getIndices(\n      new Selection('backbone and not hydrogen')\n    )\n    this._makeAtomIndices()\n    this._saveStructureCoords()\n\n    this.selectionIndices = this._getIndices(this.selection)\n    this._resetCache()\n    this._saveInitialCoords()\n    this.setFrame(this._currentFrame)\n  }\n\n  _saveInitialCoords () {\n    if (this.structure.hasCoords()) {\n      this.initialCoords = new Float32Array(this.structureCoords)\n      this._makeSuperposeCoords()\n    } else if (this.frameCache[0]) {\n      this.initialCoords = new Float32Array(this.frameCache[0])\n      this._makeSuperposeCoords()\n    } else {\n      this.loadFrame(0, () => this._saveInitialCoords())\n    }\n  }\n\n  _saveStructureCoords () {\n    const p = { what: { position: true } }\n    this.structureCoords = this.structure.getAtomData(p).position!\n  }\n\n  setSelection (string: string) {\n    this.selection.setString(string)\n    return this\n  }\n\n  _getIndices (selection: Selection) {\n    let i = 0\n    const test = selection.test\n    const indices: number[] = []\n\n    if (test) {\n      this.structure.eachAtom((ap: AtomProxy) => {\n        if (test(ap)) indices.push(i)\n        i += 1\n      })\n    }\n\n    return indices\n  }\n\n  _makeSuperposeCoords () {\n    const n = this.selectionIndices.length * 3\n\n    this.coords1 = new Float32Array(n)\n    this.coords2 = new Float32Array(n)\n\n    const y = this.initialCoords\n    const coords2 = this.coords2\n\n    for (let i = 0; i < n; i += 3) {\n      const j = this.selectionIndices[ i / 3 ] * 3\n\n      coords2[ i + 0 ] = y[ j + 0 ]\n      coords2[ i + 1 ] = y[ j + 1 ]\n      coords2[ i + 2 ] = y[ j + 2 ]\n    }\n  }\n\n  _makeAtomIndices () {\n    Log.error('Trajectory._makeAtomIndices not implemented')\n  }\n\n  _resetCache () {\n    this.frameCache = {}\n    this.loadQueue = {}\n    this.boxCache = {}\n    this.pathCache = {}\n    this.frameCacheSize = 0\n    this.initialCoords = new Float32Array(0)\n  }\n\n  setParameters (params: Partial<TrajectoryParameters> = {}) {\n    let resetCache = false\n\n    if (params.centerPbc !== undefined && params.centerPbc !== this.centerPbc) {\n      this.centerPbc = params.centerPbc\n      resetCache = true\n    }\n\n    if (params.removePeriodicity !== undefined && params.removePeriodicity !== this.removePeriodicity) {\n      this.removePeriodicity = params.removePeriodicity\n      resetCache = true\n    }\n\n    if (params.removePbc !== undefined && params.removePbc !== this.removePbc) {\n      this.removePbc = params.removePbc\n      resetCache = true\n    }\n\n    if (params.superpose !== undefined && params.superpose !== this.superpose) {\n      this.superpose = params.superpose\n      resetCache = true\n    }\n\n    this.deltaTime = defaults(params.deltaTime, this.deltaTime)\n    this.timeOffset = defaults(params.timeOffset, this.timeOffset)\n\n    if (resetCache) {\n      this._resetCache()\n      this.setFrame(this._currentFrame)\n    }\n  }\n\n  /**\n   * Check if a frame is available\n   * @param  {Integer|Integer[]} i - the frame index\n   * @return {Boolean} frame availability\n   */\n  hasFrame (i: number|number[]) {\n    if (Array.isArray(i)) {\n      return i.every(j => !!this.frameCache[j])\n    } else {\n      return !!this.frameCache[i]\n    }\n  }\n\n  /**\n   * Set trajectory to a frame index\n   * @param {Integer} i - the frame index\n   * @param {Function} [callback] - fired when the frame has been set\n   */\n  setFrame (i: number, callback?: Function) {\n    if (i === undefined) return this\n\n    this.inProgress = true\n\n    // i = parseInt(i)  // TODO\n\n    if (i === -1 || this.frameCache[ i ]) {\n      this._updateStructure(i)\n      if (callback) callback()\n    } else {\n      this.loadFrame(i, () => {\n        this._updateStructure(i)\n        if (callback) callback()\n      })\n    }\n\n    return this\n  }\n\n  _interpolate (i: number, ip: number, ipp: number, ippp: number, t: number, type: TrajectoryPlayerInterpolateType) {\n    const fc = this.frameCache\n\n    let coords\n    if (type === 'spline') {\n      coords = interpolateSpline(fc[ i ], fc[ ip ], fc[ ipp ], fc[ ippp ], t)\n    } else {\n      coords = interpolateLerp(fc[ i ], fc[ ip ], t)\n    }\n\n    this.structure.updatePosition(coords)\n    this._currentFrame = i\n    this.signals.frameChanged.dispatch(i)\n  }\n\n  /**\n   * Interpolated and set trajectory to frame indices\n   * @param {Integer} i - the frame index\n   * @param {Integer} ip - one before frame index\n   * @param {Integer} ipp - two before frame index\n   * @param {Integer} ippp - three before frame index\n   * @param {Number} t - interpolation step [0,1]\n   * @param {String} type - interpolation type, '', 'spline' or 'linear'\n   * @param {Function} callback - fired when the frame has been set\n   */\n  setFrameInterpolated (i: number, ip: number, ipp: number, ippp: number, t: number, type: TrajectoryPlayerInterpolateType, callback?: Function) {\n    if (i === undefined) return this\n\n    const fc = this.frameCache\n    const iList: number[] = []\n\n    if (!fc[ ippp ]) iList.push(ippp)\n    if (!fc[ ipp ]) iList.push(ipp)\n    if (!fc[ ip ]) iList.push(ip)\n    if (!fc[ i ]) iList.push(i)\n\n    if (iList.length) {\n      this.loadFrame(iList, () => {\n        this._interpolate(i, ip, ipp, ippp, t, type)\n        if (callback) callback()\n      })\n    } else {\n      this._interpolate(i, ip, ipp, ippp, t, type)\n      if (callback) callback()\n    }\n\n    return this\n  }\n\n  /**\n   * Load frame index\n   * @param {Integer|Integer[]} i - the frame index\n   * @param {Function} callback - fired when the frame has been loaded\n   */\n  loadFrame (i: number|number[], callback?: Function) {\n    if (Array.isArray(i)) {\n      i.forEach(j => {\n        if (!this.loadQueue[j] && !this.frameCache[j]) {\n          this.loadQueue[j] = true\n          this._loadFrame(j, () => {\n            delete this.loadQueue[j]\n          })\n        }\n      })\n    } else {\n      if (!this.loadQueue[i] && !this.frameCache[i]) {\n        this.loadQueue[i] = true\n        this._loadFrame(i, () => {\n          delete this.loadQueue[i]\n          if (callback) callback()\n        })\n      }\n    }\n  }\n\n  /**\n   * Load frame index\n   * @abstract\n   * @param {Integer} i - the frame index\n   * @param {Function} callback - fired when the frame has been loaded\n   */\n  _loadFrame (i: number, callback?: Function) {\n    Log.error('Trajectory._loadFrame not implemented', i, callback)\n  }\n\n  _updateStructure (i: number) {\n    if (this._disposed) {\n      console.error('updateStructure: traj disposed')\n      return\n    }\n\n    if (i === -1) {\n      if (this.structureCoords) {\n        this.structure.updatePosition(this.structureCoords)\n      }\n    } else {\n      this.structure.updatePosition(this.frameCache[ i ])\n    }\n\n    this.structure.trajectory = {\n      name: this.trajPath,\n      frame: i\n    }\n\n    this._currentFrame = i\n    this.inProgress = false\n    this.signals.frameChanged.dispatch(i)\n  }\n\n  _doSuperpose (x: Float32Array) {\n    const n = this.selectionIndices.length * 3\n\n    const coords1 = this.coords1\n    const coords2 = this.coords2\n\n    for (let i = 0; i < n; i += 3) {\n      const j = this.selectionIndices[ i / 3 ] * 3\n\n      coords1[ i + 0 ] = x[ j + 0 ]\n      coords1[ i + 1 ] = x[ j + 1 ]\n      coords1[ i + 2 ] = x[ j + 2 ]\n    }\n\n    // TODO re-use superposition object\n    const sp = new Superposition(coords1, coords2)\n    sp.transform(x)\n  }\n\n  _process (i: number, box: ArrayLike<number>, coords: Float32Array, frameCount: number) {\n    this._setFrameCount(frameCount)\n\n    if (box) {\n      if (this.backboneIndices.length > 0 && this.centerPbc) {\n        const box2 = [ box[ 0 ], box[ 4 ], box[ 8 ] ]\n        const circMean = circularMean3(this.backboneIndices, coords, box2)\n        centerPbc(coords, circMean, box2)\n      }\n\n      if (this.removePeriodicity) {\n        const mean = arrayMean3(coords)\n        removePeriodicity(coords, box, mean)\n      }\n\n      if (this.removePbc) {\n        removePbc(coords, box)\n      }\n    }\n\n    if (this.selectionIndices.length > 0 && this.coords1 && this.superpose) {\n      this._doSuperpose(coords)\n    }\n\n    this.frameCache[ i ] = coords\n    this.boxCache[ i ] = box\n    this.frameCacheSize += 1\n  }\n\n  _setFrameCount (n: number) {\n    if (n !== this._frameCount) {\n      this._frameCount = n\n      this.signals.countChanged.dispatch(n)\n    }\n  }\n\n  /**\n   * Dispose of the trajectory object\n   * @return {undefined}\n   */\n  dispose () {\n    this._resetCache()  // aid GC\n    this._disposed = true\n    if (this.player) this.player.stop()\n  }\n\n  /**\n   * Set player for this trajectory\n   * @param {TrajectoryPlayer} player - the player\n   */\n  setPlayer (player: TrajectoryPlayer) {\n    this.player = player\n    this.signals.playerChanged.dispatch(player)\n  }\n\n  /**\n   * Get time for frame\n   * @param  {Integer} i - frame index\n   * @return {Number} time in picoseconds\n   */\n  getFrameTime (i: number) {\n    return this.timeOffset + i * this.deltaTime\n  }\n}\n\nexport default Trajectory\n","/**\n * @file Frames Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Structure from '../structure/structure'\nimport Frames from './frames'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Frames trajectory class. Gets data from a frames object.\n */\nclass FramesTrajectory extends Trajectory {\n  path: string\n\n  frames: ArrayLike<number>[]\n  boxes: ArrayLike<number>[]\n\n  atomIndices?: ArrayLike<number>\n\n  constructor (frames: Frames, structure: Structure, params: TrajectoryParameters) {\n    const p = params || {}\n    p.timeOffset = defaults(p.timeOffset, frames.timeOffset)\n    p.deltaTime = defaults(p.deltaTime, frames.deltaTime)\n\n    super('', structure, p)\n\n    this.name = frames.name\n    this.path = frames.path\n\n    this.frames = frames.coordinates\n    this.boxes = frames.boxes\n\n    this._init(structure)\n  }\n\n  get type () { return 'frames' }\n\n  _makeAtomIndices () {\n    if (this.structure.type === 'StructureView') {\n      this.atomIndices = this.structure.getAtomIndices()\n    } else {\n      this.atomIndices = undefined\n    }\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    let coords\n    const frame = this.frames[ i ]\n\n    if (this.atomIndices) {\n      const indices = this.atomIndices\n      const m = indices.length\n\n      coords = new Float32Array(m * 3)\n\n      for (let j = 0; j < m; ++j) {\n        const j3 = j * 3\n        const idx3 = indices[ j ] * 3\n\n        coords[ j3 + 0 ] = frame[ idx3 + 0 ]\n        coords[ j3 + 1 ] = frame[ idx3 + 1 ]\n        coords[ j3 + 2 ] = frame[ idx3 + 2 ]\n      }\n    } else {\n      coords = new Float32Array(frame)\n    }\n\n    const box = this.boxes[ i ]\n    const frameCount = this.frames.length\n\n    this._process(i, box, coords, frameCount)\n\n    if (typeof callback === 'function') {\n      callback()\n    }\n  }\n\n  _loadFrameCount () {\n    if (this.frames) {\n      this._setFrameCount(this.frames.length)\n    }\n  }\n}\n\nexport default FramesTrajectory\n","/**\n * @file Structure Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Structure trajectory class. Gets data from a structure object.\n */\nclass StructureTrajectory extends Trajectory {\n  atomIndices?: ArrayLike<number>\n\n  constructor (trajPath: string, structure: Structure, params: TrajectoryParameters) {\n    super('', structure, params)\n    this._init(structure)\n  }\n\n  get type () { return 'structure' }\n\n  _makeAtomIndices () {\n    if (this.structure.atomSet && this.structure.atomSet.getSize() < this.structure.atomStore.count) {\n      this.atomIndices = this.structure.getAtomIndices()\n    } else {\n      this.atomIndices = undefined\n    }\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    let coords\n    const structure = this.structure\n    const frame = structure.frames[ i ]\n\n    if (this.atomIndices) {\n      const indices = this.atomIndices\n      const m = indices.length\n\n      coords = new Float32Array(m * 3)\n\n      for (let j = 0; j < m; ++j) {\n        const j3 = j * 3\n        const idx3 = indices[ j ] * 3\n\n        coords[ j3 + 0 ] = frame[ idx3 + 0 ]\n        coords[ j3 + 1 ] = frame[ idx3 + 1 ]\n        coords[ j3 + 2 ] = frame[ idx3 + 2 ]\n      }\n    } else {\n      coords = new Float32Array(frame)\n    }\n\n    const box = structure.boxes[ i ]\n    const frameCount = structure.frames.length\n\n    this._process(i, box, coords, frameCount)\n\n    if (typeof callback === 'function') {\n      callback()\n    }\n  }\n\n  _loadFrameCount () {\n    this._setFrameCount(this.structure.frames.length)\n  }\n}\n\nexport default StructureTrajectory\n","/**\n * @file Remote Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, TrajectoryDatasource } from '../globals'\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Remote trajectory class. Gets data from an MDsrv instance.\n */\nclass RemoteTrajectory extends Trajectory {\n  atomIndices: number[][]\n\n  constructor (trajPath: string, structure: Structure, params: TrajectoryParameters) {\n    super(trajPath, structure, params)\n    this._init(structure)\n  }\n\n  get type () { return 'remote' }\n\n  _makeAtomIndices () {\n    const atomIndices = []\n\n    if (this.structure.type === 'StructureView') {\n      const indices = this.structure.getAtomIndices()!  // TODO\n      const n = indices.length\n\n      let p = indices[ 0 ]\n      let q = indices[ 0 ]\n\n      for (let i = 1; i < n; ++i) {\n        const r = indices[ i ]\n\n        if (q + 1 < r) {\n          atomIndices.push([ p, q + 1 ])\n          p = r\n        }\n\n        q = r\n      }\n\n      atomIndices.push([ p, q + 1 ])\n    } else {\n      atomIndices.push([ 0, this.atomCount ])\n    }\n\n    this.atomIndices = atomIndices\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    // TODO implement max frameCache size, re-use arrays\n\n    const request = new XMLHttpRequest()\n\n    const url = TrajectoryDatasource.getFrameUrl(this.trajPath, i)\n    const params = TrajectoryDatasource.getFrameParams(this.trajPath, this.atomIndices)\n\n    request.open('POST', url, true)\n    request.responseType = 'arraybuffer'\n    request.setRequestHeader(\n      'Content-type', 'application/x-www-form-urlencoded'\n    )\n\n    request.addEventListener('load', () => {\n      const arrayBuffer = request.response\n      if (!arrayBuffer) {\n        Log.error(`empty arrayBuffer for '${url}'`)\n        return\n      }\n\n      const frameCount = new Int32Array(arrayBuffer, 0, 1)[ 0 ]\n      // const time = new Float32Array( arrayBuffer, 1 * 4, 1 )[ 0 ];\n      const box = new Float32Array(arrayBuffer, 2 * 4, 9)\n      const coords = new Float32Array(arrayBuffer, 11 * 4)\n\n      this._process(i, box, coords, frameCount)\n      if (typeof callback === 'function') {\n        callback()\n      }\n    }, false)\n\n    request.send(params)\n  }\n\n  _loadFrameCount () {\n    const request = new XMLHttpRequest()\n\n    const url = TrajectoryDatasource.getCountUrl(this.trajPath)\n\n    request.open('GET', url, true)\n    request.addEventListener('load', () => {\n      this._setFrameCount(parseInt(request.response))\n    }, false)\n    request.send()\n  }\n}\n\nexport default RemoteTrajectory\n","/**\n * @file Callback Trajectory\n * @author Tarn W. Burton <twburton@gmail.com>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\ntype RequestCallback = (responseCallback: Function, i?: number, atomIndices?: number[][]) => void\n\n/**\n * Callback trajectory class. Gets data from an JavaScript function.\n */\nclass CallbackTrajectory extends Trajectory {\n  atomIndices: number[][]\n  requestCallback: RequestCallback\n\n  constructor (requestCallback: RequestCallback, structure: Structure, params: TrajectoryParameters) {\n    super('', structure, params)\n    this.requestCallback = requestCallback;\n    this._init(structure)\n  }\n\n  get type () { return 'callback' }\n\n  _makeAtomIndices () {\n    const atomIndices = []\n\n    if (this.structure.type === 'StructureView') {\n      const indices = this.structure.getAtomIndices()!  // TODO\n      const n = indices.length\n\n      let p = indices[ 0 ]\n      let q = indices[ 0 ]\n\n      for (let i = 1; i < n; ++i) {\n        const r = indices[ i ]\n\n        if (q + 1 < r) {\n          atomIndices.push([ p, q + 1 ])\n          p = r\n        }\n\n        q = r\n      }\n\n      atomIndices.push([ p, q + 1 ])\n    } else {\n      atomIndices.push([ 0, this.atomCount ])\n    }\n\n    this.atomIndices = atomIndices\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    this.requestCallback(\n      (i: number, box: ArrayLike<number>, coords: Float32Array, frameCount: number) => {\n        this._process(i, box, coords, frameCount)\n        if (typeof callback === 'function') {\n          callback()\n        }\n      }, i, this.atomIndices)\n  }\n\n  _loadFrameCount () {\n    this.requestCallback((count: number) => this._setFrameCount(count))\n  }\n}\n\nexport default CallbackTrajectory\n\n","/**\n * @file Structure View\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport Structure from './structure'\nimport Selection from '../selection/selection'\nimport BitArray from '../utils/bitarray'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\nimport SpatialHash from '../geometry/spatial-hash';\nimport BondHash from '../store/bond-hash';\nimport ResidueMap from '../store/residue-map';\nimport AtomMap from '../store/atom-map';\nimport ModelStore from '../store/model-store';\nimport ChainStore from '../store/chain-store';\nimport ResidueStore from '../store/residue-store';\nimport AtomStore from '../store/atom-store';\nimport BondStore from '../store/bond-store';\nimport Validation from './validation';\nimport Unitcell from '../symmetry/unitcell';\nimport Entity from './entity';\nimport Assembly from '../symmetry/assembly';\nimport { Data } from './data';\n\n/**\n * Get view on structure restricted to the selection\n * @param  {Selection} selection - the selection\n * @return {StructureView} the view on the structure\n */\nStructure.prototype.getView = function (this: Structure, selection: Selection) {\n  // added here to avoid cyclic import dependency\n  return new StructureView(this, selection)\n}\n\n/**\n * View on the structure, restricted to the selection\n */\nclass StructureView extends Structure {\n  structure: Structure\n  selection: Selection\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Selection} selection - the selection\n   */\n  constructor (structure: Structure, selection: Selection) {\n    super()\n\n    this.structure = structure\n    this.selection = selection\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this._bp = this.getBondProxy()\n    this._ap = this.getAtomProxy()\n    this._rp = this.getResidueProxy()\n    this._cp = this.getChainProxy()\n\n    if (this.selection) {\n      this.selection.signals.stringChanged.add(this.refresh, this)\n    }\n\n    this.structure.signals.refreshed.add(this.refresh, this)\n\n    this.refresh()\n  }\n\n  init () {}\n\n  get type () { return 'StructureView' }\n\n  get name () { return this.structure.name }\n  get path () { return this.structure.path }\n  get title () { return this.structure.title }\n  get id () { return this.structure.id }\n  get data (): Data { return this.structure.data }\n  get atomSetDict () { return this.structure.atomSetDict }\n  get biomolDict (): {[k: string]: Assembly} { return this.structure.biomolDict }\n  get entityList (): Entity[] { return this.structure.entityList }\n  get unitcell (): Unitcell|undefined { return this.structure.unitcell }\n  get frames () { return this.structure.frames }\n  get boxes () { return this.structure.boxes }\n  get validation (): Validation|undefined { return this.structure.validation }\n  get bondStore () { return this.structure.bondStore }\n  get backboneBondStore () { return this.structure.backboneBondStore }\n  get rungBondStore (): BondStore { return this.structure.rungBondStore }\n  get atomStore (): AtomStore { return this.structure.atomStore }\n  get residueStore (): ResidueStore { return this.structure.residueStore }\n  get chainStore (): ChainStore { return this.structure.chainStore }\n  get modelStore (): ModelStore { return this.structure.modelStore }\n  get atomMap (): AtomMap { return this.structure.atomMap }\n  get residueMap (): ResidueMap { return this.structure.residueMap }\n  get bondHash (): BondHash|undefined { return this.structure.bondHash }\n  get spatialHash (): SpatialHash|undefined { return this.structure.spatialHash }\n\n  get _hasCoords () { return this.structure._hasCoords }\n  set _hasCoords (value) { this.structure._hasCoords = value }\n\n  /**\n   * Updates atomSet, bondSet, atomSetCache, atomCount, bondCount, boundingBox, center.\n   * @emits {Structure.signals.refreshed} when refreshed\n   * @return {undefined}\n   */\n  refresh () {\n    if (Debug) Log.time('StructureView.refresh')\n\n    this.atomSetCache = {}\n    const structure = this.structure\n\n    if (this.selection.isAllSelection() &&\n        structure !== this && structure.atomSet && structure.bondSet\n    ) {\n      this.atomSet = structure.atomSet.clone()\n      this.bondSet = structure.bondSet.clone()\n\n      for (let name in this.atomSetDict) {\n        const atomSet = this.atomSetDict[ name ]\n        this.atomSetCache[ '__' + name ] = atomSet.clone()\n      }\n\n      this.atomCount = structure.atomCount\n      this.bondCount = structure.bondCount\n\n      this.boundingBox.copy(structure.boundingBox)\n      this.center.copy(structure.center)\n    } else if (this.selection.isNoneSelection() &&\n        structure !== this && structure.atomSet && structure.bondSet\n    ) {\n      this.atomSet = new BitArray(structure.atomCount)\n      this.bondSet = new BitArray(structure.bondCount)\n\n      for (let name in this.atomSetDict) {\n        this.atomSetCache[ '__' + name ] = new BitArray(structure.atomCount)\n      }\n\n      this.atomCount = 0\n      this.bondCount = 0\n\n      this.boundingBox.makeEmpty()\n      this.center.set(0, 0, 0)\n    } else {\n      this.atomSet = this.getAtomSet(this.selection, true)\n      if (structure.atomSet) {\n        this.atomSet = this.atomSet.intersection(structure.atomSet)\n      }\n\n      this.bondSet = this.getBondSet()\n\n      for (let name in this.atomSetDict) {\n        const atomSet = this.atomSetDict[ name ]\n        this.atomSetCache[ '__' + name ] = atomSet.makeIntersection(this.atomSet)\n      }\n\n      this.atomCount = this.atomSet.getSize()\n      this.bondCount = this.bondSet.getSize()\n\n      this.boundingBox = this.getBoundingBox()\n      this.center = this.boundingBox.getCenter(new Vector3())\n    }\n\n    if (Debug) Log.timeEnd('StructureView.refresh')\n\n    this.signals.refreshed.dispatch()\n  }\n\n  //\n\n  setSelection (selection: Selection) {\n    this.selection = selection\n\n    this.refresh()\n  }\n\n  getSelection (selection?: Selection) {\n    const seleList: string[] = []\n\n    if (selection && selection.string) {\n      seleList.push(selection.string)\n    }\n\n    const parentSelection = this.structure.getSelection()\n    if (parentSelection && parentSelection.string) {\n      seleList.push(parentSelection.string)\n    }\n\n    if (this.selection && this.selection.string) {\n      seleList.push(this.selection.string)\n    }\n\n    let sele = ''\n    if (seleList.length > 0) {\n      sele = `( ${seleList.join(' ) AND ( ')} )`\n    }\n\n    return new Selection(sele)\n  }\n\n  getStructure () {\n    return this.structure.getStructure()\n  }\n\n  //\n\n  eachBond (callback: (entity: BondProxy) => any, selection?: Selection) {\n    this.structure.eachBond(callback, this.getSelection(selection))\n  }\n\n  eachAtom (callback: (entity: AtomProxy) => any, selection?: Selection) {\n    const ap = this.getAtomProxy()\n    const atomSet = this.getAtomSet(selection)\n    const n = this.atomStore.count\n\n    if (atomSet.getSize() < n) {\n      atomSet.forEach(function (index) {\n        ap.index = index\n        callback(ap)\n      })\n    } else {\n      for (let i = 0; i < n; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  eachResidue (callback: (entity: ResidueProxy) => any, selection?: Selection) {\n    this.structure.eachResidue(callback, this.getSelection(selection))\n  }\n\n  /**\n   * Not implemented\n   * @alias StructureView#eachResidueN\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (entity: ResidueProxy) => any) {\n    console.error('StructureView.eachResidueN() not implemented')\n  }\n\n  eachChain (callback: (entity: ChainProxy) => any, selection?: Selection) {\n    this.structure.eachChain(callback, this.getSelection(selection))\n  }\n\n  eachModel (callback: (entity: ModelProxy) => any, selection?: Selection) {\n    this.structure.eachModel(callback, this.getSelection(selection))\n  }\n\n    //\n\n  getAtomSet (selection?: boolean|Selection|BitArray, ignoreView = false) {\n    let atomSet = this.structure.getAtomSet(selection)\n    if (!ignoreView && this.atomSet) {\n      atomSet = atomSet.makeIntersection(this.atomSet)\n    }\n\n    return atomSet\n  }\n\n  //\n\n  getAtomIndices (selection?: Selection) {\n    return this.structure.getAtomIndices(this.getSelection(selection))\n  }\n\n  refreshPosition () {\n    return this.structure.refreshPosition()\n  }\n\n  //\n\n  dispose () {\n    if (this.selection) {\n      this.selection.signals.stringChanged.remove(this.refresh, this)\n    }\n\n    this.structure.signals.refreshed.remove(this.refresh, this)\n\n    this.structure = new Structure() // delete old data\n\n    delete this.atomSet\n    delete this.bondSet\n\n  }\n}\n\nexport default StructureView\n","/**\n * @file Alignment\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log } from '../globals'\n\n// const nucleotides = 'ACTG';\nconst aminoacidsX = 'ACDEFGHIKLMNPQRSTVWY'\nconst aminoacids = 'ARNDCQEGHILKMFPSTWYVBZ?'\n\nconst blosum62x = [\n  [4, 0, -2, -1, -2, 0, -2, -1, -1, -1, -1, -2, -1, -1, -1, 1, 0, 0, -3, -2],        // A\n  [0, 9, -3, -4, -2, -3, -3, -1, -3, -1, -1, -3, -3, -3, -3, -1, -1, -1, -2, -2],    // C\n  [-2, -3, 6, 2, -3, -1, -1, -3, -1, -4, -3, 1, -1, 0, -2, 0, -1, -3, -4, -3],       // D\n  [-1, -4, 2, 5, -3, -2, 0, -3, 1, -3, -2, 0, -1, 2, 0, 0, -1, -2, -3, -2],          // E\n  [-2, -2, -3, -3, 6, -3, -1, 0, -3, 0, 0, -3, -4, -3, -3, -2, -2, -1, 1, 3],        // F\n  [0, -3, -1, -2, -3, 6, -2, -4, -2, -4, -3, 0, -2, -2, -2, 0, -2, -3, -2, -3],      // G\n  [-2, -3, -1, 0, -1, -2, 8, -3, -1, -3, -2, 1, -2, 0, 0, -1, -2, -3, -2, 2],        // H\n  [-1, -1, -3, -3, 0, -4, -3, 4, -3, 2, 1, -3, -3, -3, -3, -2, -1, 3, -3, -1],       // I\n  [-1, -3, -1, 1, -3, -2, -1, -3, 5, -2, -1, 0, -1, 1, 2, 0, -1, -2, -3, -2],        // K\n  [-1, -1, -4, -3, 0, -4, -3, 2, -2, 4, 2, -3, -3, -2, -2, -2, -1, 1, -2, -1],       // L\n  [-1, -1, -3, -2, 0, -3, -2, 1, -1, 2, 5, -2, -2, 0, -1, -1, -1, 1, -1, -1],        // M\n  [-2, -3, 1, 0, -3, 0, 1, -3, 0, -3, -2, 6, -2, 0, 0, 1, 0, -3, -4, -2],            // N\n  [-1, -3, -1, -1, -4, -2, -2, -3, -1, -3, -2, -2, 7, -1, -2, -1, -1, -2, -4, -3],   // P\n  [-1, -3, 0, 2, -3, -2, 0, -3, 1, -2, 0, 0, -1, 5, 1, 0, -1, -2, -2, -1],           // Q\n  [-1, -3, -2, 0, -3, -2, 0, -3, 2, -2, -1, 0, -2, 1, 5, -1, -1, -3, -3, -2],        // R\n  [1, -1, 0, 0, -2, 0, -1, -2, 0, -2, -1, 1, -1, 0, -1, 4, 1, -2, -3, -2],           // S\n  [0, -1, -1, -1, -2, -2, -2, -1, -1, -1, -1, 0, -1, -1, -1, 1, 5, 0, -2, -2],       // T\n  [0, -1, -3, -2, -1, -3, -3, 3, -2, 1, 1, -3, -2, -2, -3, -2, 0, 4, -3, -1],        // V\n  [-3, -2, -4, -3, 1, -2, -2, -3, -3, -2, -1, -4, -4, -2, -3, -3, -2, -3, 11, 2],    // W\n  [-2, -2, -3, -2, 3, -3, 2, -1, -2, -1, -1, -2, -3, -1, -2, -2, -2, -1, 2, 7]       // Y\n]\n\nconst blosum62 = [\n  // A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V  B  Z  X\n  [4, -1, -2, -2, 0, -1, -1, 0, -2, -1, -1, -1, -1, -2, -1, 1, 0, -3, -2, 0, -2, -1, 0], // A\n  [-1, 5, 0, -2, -3, 1, 0, -2, 0, -3, -2, 2, -1, -3, -2, -1, -1, -3, -2, -3, -1, 0, -1], // R\n  [-2, 0, 6, 1, -3, 0, 0, 0, 1, -3, -3, 0, -2, -3, -2, 1, 0, -4, -2, -3, 3, 0, -1], // N\n  [-2, -2, 1, 6, -3, 0, 2, -1, -1, -3, -4, -1, -3, -3, -1, 0, -1, -4, -3, -3, 4, 1, -1], // D\n  [0, -3, -3, -3, 9, -3, -4, -3, -3, -1, -1, -3, -1, -2, -3, -1, -1, -2, -2, -1, -3, -3, -2], // C\n  [-1, 1, 0, 0, -3, 5, 2, -2, 0, -3, -2, 1, 0, -3, -1, 0, -1, -2, -1, -2, 0, 3, -1], // Q\n  [-1, 0, 0, 2, -4, 2, 5, -2, 0, -3, -3, 1, -2, -3, -1, 0, -1, -3, -2, -2, 1, 4, -1], // E\n  [0, -2, 0, -1, -3, -2, -2, 6, -2, -4, -4, -2, -3, -3, -2, 0, -2, -2, -3, -3, -1, -2, -1], // G\n  [-2, 0, 1, -1, -3, 0, 0, -2, 8, -3, -3, -1, -2, -1, -2, -1, -2, -2, 2, -3, 0, 0, -1], // H\n  [-1, -3, -3, -3, -1, -3, -3, -4, -3, 4, 2, -3, 1, 0, -3, -2, -1, -3, -1, 3, -3, -3, -1], // I\n  [-1, -2, -3, -4, -1, -2, -3, -4, -3, 2, 4, -2, 2, 0, -3, -2, -1, -2, -1, 1, -4, -3, -1], // L\n  [-1, 2, 0, -1, -3, 1, 1, -2, -1, -3, -2, 5, -1, -3, -1, 0, -1, -3, -2, -2, 0, 1, -1], // K\n  [-1, -1, -2, -3, -1, 0, -2, -3, -2, 1, 2, -1, 5, 0, -2, -1, -1, -1, -1, 1, -3, -1, -1], // M\n  [-2, -3, -3, -3, -2, -3, -3, -3, -1, 0, 0, -3, 0, 6, -4, -2, -2, 1, 3, -1, -3, -3, -1], // F\n  [-1, -2, -2, -1, -3, -1, -1, -2, -2, -3, -3, -1, -2, -4, 7, -1, -1, -4, -3, -2, -2, -1, -2], // P\n  [1, -1, 1, 0, -1, 0, 0, 0, -1, -2, -2, 0, -1, -2, -1, 4, 1, -3, -2, -2, 0, 0, 0], // S\n  [0, -1, 0, -1, -1, -1, -1, -2, -2, -1, -1, -1, -1, -2, -1, 1, 5, -2, -2, 0, -1, -1, 0], // T\n  [-3, -3, -4, -4, -2, -2, -3, -2, -2, -3, -2, -3, -1, 1, -4, -3, -2, 11, 2, -3, -4, -3, -2], // W\n  [-2, -2, -2, -3, -2, -1, -2, -3, 2, -1, -1, -2, -1, 3, -3, -2, -2, 2, 7, -1, -3, -2, -1], // Y\n  [0, -3, -3, -3, -1, -2, -2, -3, -3, 3, 1, -2, 1, -1, -2, -2, 0, -3, -1, 4, -3, -2, -1], // V\n  [-2, -1, 3, 4, -3, 0, 1, -1, 0, -3, -4, 0, -3, -3, -2, 0, -1, -4, -3, -3, 4, 1, -1], // B\n  [-1, 0, 0, 1, -3, 3, 4, -2, 0, -3, -3, 1, -1, -3, -1, 0, -1, -3, -2, -2, 1, 4, -1], // Z\n  [0, -1, -1, -1, -2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -2, 0, 0, -2, -1, -1, -1, -1, -1]  // X\n]\n\nfunction prepareMatrix (cellNames: string, mat: number[][]) {\n  let j: number\n  let i = 0\n  const matDict: { [k: string]: { [k: string]: number } } = {}\n  mat.forEach(function (row) {\n    j = 0\n    const rowDict: { [k: string]: number } = {}\n    row.forEach(function (elm) {\n      rowDict[ cellNames[ j++ ] ] = elm\n    })\n    matDict[ cellNames[ i++ ] ] = rowDict\n  })\n  return matDict\n}\n\nconst SubstitutionMatrices = (function () {\n  return {\n    blosum62: prepareMatrix(aminoacids, blosum62),\n    blosum62x: prepareMatrix(aminoacidsX, blosum62x)\n  }\n}())\nexport type SubstitutionMatrix = ''|'blosum62'|'blosum62x'\n\nclass Alignment {\n  substMatrix: { [k: string]: { [k: string]: number } }\n\n  n: number\n  m: number\n  score?: number\n  ali: string\n\n  S: number[][]\n  V: number[][]\n  H: number[][]\n\n  ali1: string\n  ali2: string\n\n  constructor (readonly seq1: string, readonly seq2: string, readonly gapPenalty = -10, readonly gapExtensionPenalty = -1, substMatrix: SubstitutionMatrix = 'blosum62') {\n    // TODO try encoding seqs as integers and use array subst matrix, maybe faster\n\n    if (substMatrix) {\n      this.substMatrix = SubstitutionMatrices[ substMatrix ]\n    }\n  }\n\n  initMatrices () {\n    this.n = this.seq1.length\n    this.m = this.seq2.length\n\n    // Log.log(this.n, this.m);\n\n    this.score = undefined\n    this.ali = ''\n\n    this.S = []\n    this.V = []\n    this.H = []\n\n    for (let i = 0; i <= this.n; ++i) {\n      this.S[ i ] = []\n      this.V[ i ] = []\n      this.H[ i ] = []\n\n      for (let j = 0; j <= this.m; ++j) {\n        this.S[ i ][ j ] = 0\n        this.V[ i ][ j ] = 0\n        this.H[ i ][ j ] = 0\n      }\n    }\n\n    for (let i = 0; i <= this.n; ++i) {\n      this.S[ i ][ 0 ] = this.gap(0)\n      this.H[ i ][ 0 ] = -Infinity\n    }\n\n    for (let j = 0; j <= this.m; ++j) {\n      this.S[ 0 ][ j ] = this.gap(0)\n      this.V[ 0 ][ j ] = -Infinity\n    }\n\n    this.S[ 0 ][ 0 ] = 0\n\n    // Log.log(this.S, this.V, this.H);\n  }\n\n  gap (len: number) {\n    return this.gapPenalty + len * this.gapExtensionPenalty\n  }\n\n  makeScoreFn () {\n    const seq1 = this.seq1\n    const seq2 = this.seq2\n\n    const substMatrix = this.substMatrix\n\n    if (substMatrix) {\n      return function score (i: number, j: number) {\n        const c1 = seq1[ i ]\n        const c2 = seq2[ j ]\n\n        try {\n          return substMatrix[ c1 ][ c2 ]\n        } catch (e) {\n          return -4\n        }\n      }\n    } else {\n      Log.warn('Alignment: no subst matrix')\n\n      return function scoreNoSubstMat (i: number, j: number) {\n        const c1 = seq1[ i ]\n        const c2 = seq2[ j ]\n\n        return c1 === c2 ? 5 : -3\n      }\n    }\n  }\n\n  calc () {\n    if (Debug) Log.time('Alignment.calc')\n\n    this.initMatrices()\n\n    const gap0 = this.gap(0)\n    const scoreFn = this.makeScoreFn()\n    const gapExtensionPenalty = this.gapExtensionPenalty\n\n    const V = this.V\n    const H = this.H\n    const S = this.S\n\n    const n = this.n\n    const m = this.m\n\n    let Vi1, Si1, Vi, Hi, Si\n\n    for (let i = 1; i <= n; ++i) {\n      Si1 = S[ i - 1 ]\n      Vi1 = V[ i - 1 ]\n\n      Vi = V[ i ]\n      Hi = H[ i ]\n      Si = S[ i ]\n\n      for (let j = 1; j <= m; ++j) {\n        Vi[j] = Math.max(\n          Si1[ j ] + gap0,\n          Vi1[ j ] + gapExtensionPenalty\n        )\n\n        Hi[j] = Math.max(\n          Si[ j - 1 ] + gap0,\n          Hi[ j - 1 ] + gapExtensionPenalty\n        )\n\n        Si[j] = Math.max(\n          Si1[ j - 1 ] + scoreFn(i - 1, j - 1), // match\n          Vi[ j ], // del\n          Hi[ j ]  // ins\n        )\n      }\n    }\n\n    if (Debug) Log.timeEnd('Alignment.calc')\n\n    if (Debug) Log.log(this.S, this.V, this.H)\n  }\n\n  trace () {\n    if (Debug) Log.time('Alignment.trace')\n\n    this.ali1 = ''\n    this.ali2 = ''\n\n    const scoreFn = this.makeScoreFn()\n\n    let i = this.n\n    let j = this.m\n    let mat\n\n    if (this.S[i][j] >= this.V[i][j]) {\n      mat = 'S'\n      this.score = this.S[i][j]\n    } else if (this.V[i][j] >= this.H[i][j]) {\n      mat = 'V'\n      this.score = this.V[i][j]\n    } else {\n      mat = 'H'\n      this.score = this.H[i][j]\n    }\n\n    if (Debug) Log.log('Alignment: SCORE', this.score)\n    if (Debug) Log.log('Alignment: S, V, H', this.S[i][j], this.V[i][j], this.H[i][j])\n\n    while (i > 0 && j > 0) {\n      if (mat === 'S') {\n        if (this.S[i][j] === this.S[i - 1][j - 1] + scoreFn(i - 1, j - 1)) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --i\n          --j\n          mat = 'S'\n        } else if (this.S[i][j] === this.V[i][j]) {\n          mat = 'V'\n        } else if (this.S[i][j] === this.H[i][j]) {\n          mat = 'H'\n        } else {\n          // Log.debug('Alignment: S');\n          --i\n          --j\n        }\n      } else if (mat === 'V') {\n        if (this.V[i][j] === this.V[i - 1][j] + this.gapExtensionPenalty) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = '-' + this.ali2\n          --i\n          mat = 'V'\n        } else if (this.V[i][j] === this.S[i - 1][j] + this.gap(0)) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = '-' + this.ali2\n          --i\n          mat = 'S'\n        } else {\n          // Log.debug('Alignment: V');\n          --i\n        }\n      } else if (mat === 'H') {\n        if (this.H[i][j] === this.H[i][j - 1] + this.gapExtensionPenalty) {\n          this.ali1 = '-' + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --j\n          mat = 'H'\n        } else if (this.H[i][j] === this.S[i][j - 1] + this.gap(0)) {\n          this.ali1 = '-' + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --j\n          mat = 'S'\n        } else {\n          // Log.debug('Alignment: H');\n          --j\n        }\n      } else {\n        Log.error('Alignment: no matrix')\n      }\n    }\n\n    while (i > 0) {\n      this.ali1 = this.seq1[ i - 1 ] + this.ali1\n      this.ali2 = '-' + this.ali2\n      --i\n    }\n\n    while (j > 0) {\n      this.ali1 = '-' + this.ali1\n      this.ali2 = this.seq2[ j - 1 ] + this.ali2\n      --j\n    }\n\n    if (Debug) Log.timeEnd('Alignment.trace')\n\n    if (Debug) Log.log([this.ali1, this.ali2])\n  }\n}\n\nexport default Alignment\n","/**\n * @file Align Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\nimport Alignment from './alignment'\nimport Superposition from './superposition'\n\n/**\n * Perform structural superposition of two structures,\n * optionally guided by a sequence alignment\n * @param  {Structure|StructureView} s1 - structure 1 which is superposed onto structure 2\n * @param  {Structure|StructureView} s2 - structure 2 onto which structure 1 is superposed\n * @param  {Boolean} [align] - guide the superposition by a sequence alignment\n * @param  {String} [sele1] - selection string for structure 1\n * @param  {String} [sele2] - selection string for structure 2\n * @return {undefined}\n */\nfunction superpose (s1: Structure, s2: Structure, align = false, sele1 = '', sele2 = '') {\n  let i: number\n  let j: number\n  let n: number\n  let atoms1\n  let atoms2\n\n  if (align) {\n    let _s1 = s1\n    let _s2 = s2\n\n    if (sele1 && sele2) {\n      _s1 = s1.getView(new Selection(sele1))\n      _s2 = s2.getView(new Selection(sele2))\n    }\n\n    const seq1 = _s1.getSequence()\n    const seq2 = _s2.getSequence()\n\n    // Log.log( seq1.join(\"\") );\n    // Log.log( seq2.join(\"\") );\n\n    const ali = new Alignment(seq1.join(''), seq2.join(''))\n\n    ali.calc()\n    ali.trace()\n\n    // Log.log( \"superpose alignment score\", ali.score );\n\n    // Log.log( ali.ali1 );\n    // Log.log( ali.ali2 );\n\n    let _i, _j\n    i = 0\n    j = 0\n    n = ali.ali1.length\n    const aliIdx1: boolean[] = []\n    const aliIdx2: boolean[] = []\n\n    for (let l = 0; l < n; ++l) {\n      const x = ali.ali1[ l ]\n      const y = ali.ali2[ l ]\n\n      _i = 0\n      _j = 0\n\n      if (x === '-') {\n        aliIdx2[ j ] = false\n      } else {\n        aliIdx2[ j ] = true\n        _i = 1\n      }\n\n      if (y === '-') {\n        aliIdx1[ i ] = false\n      } else {\n        aliIdx1[ i ] = true\n        _j = 1\n      }\n\n      i += _i\n      j += _j\n    }\n\n    // Log.log( i, j );\n\n    // Log.log( aliIdx1 );\n    // Log.log( aliIdx2 );\n\n    const _atoms1: number[] = []\n    const _atoms2: number[] = []\n    const ap1 = _s1.getAtomProxy()\n    const ap2 = _s2.getAtomProxy()\n\n    i = 0\n    _s1.eachResidue(function (r) {\n      if (r.traceAtomIndex === undefined ||\n            r.traceAtomIndex !== r.getAtomIndexByName('CA')) return\n\n      if (aliIdx1[ i ]) {\n        ap1.index = r.getAtomIndexByName('CA')!  // TODO\n        _atoms1.push(ap1.x, ap1.y, ap1.z)\n      }\n      i += 1\n    })\n\n    i = 0\n    _s2.eachResidue(function (r) {\n      if (r.traceAtomIndex === undefined ||\n            r.traceAtomIndex !== r.getAtomIndexByName('CA')) return\n\n      if (aliIdx2[ i ]) {\n        ap2.index = r.getAtomIndexByName('CA')!  // TODO\n        _atoms2.push(ap2.x, ap2.y, ap2.z)\n      }\n      i += 1\n    })\n\n    atoms1 = new Float32Array(_atoms1)\n    atoms2 = new Float32Array(_atoms2)\n  } else {\n    const sviewCa1 = s1.getView(new Selection(`${sele1} and .CA`))\n    const sviewCa2 = s2.getView(new Selection(`${sele2} and .CA`))\n\n    atoms1 = sviewCa1\n    atoms2 = sviewCa2\n  }\n\n  const superpose = new Superposition(atoms1, atoms2)\n  const result = superpose.transform(s1)\n  s1.refreshPosition()\n  return result\n}\n\nexport {\n  superpose\n}\n","/**\n * @file Sturucture Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { ComponentRegistry, MeasurementDefaultParams } from '../globals'\nimport {\n  defaults, /*deepEqual, */createRingBuffer, RingBuffer, createSimpleDict, SimpleDict\n} from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Component, { ComponentSignals, ComponentDefaultParameters } from './component'\nimport RepresentationCollection from './representation-collection'\nimport TrajectoryElement from './trajectory-element'\nimport RepresentationElement from './representation-element'\nimport { makeTrajectory } from '../trajectory/trajectory-utils'\nimport { TrajectoryParameters } from '../trajectory/trajectory'\nimport Selection from '../selection/selection'\nimport Structure from '../structure/structure'\nimport StructureView from '../structure/structure-view'\nimport { superpose } from '../align/align-utils'\nimport Stage from '../stage/stage'\nimport StructureRepresentation, { StructureRepresentationParameters } from '../representation/structure-representation'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { Vector3, Box3 } from 'three';\nimport { AngleRepresentationParameters } from '../representation/angle-representation';\nimport { AxesRepresentationParameters } from '../representation/axes-representation';\nimport { BallAndStickRepresentationParameters } from '../representation/ballandstick-representation';\nimport { CartoonRepresentationParameters } from '../representation/cartoon-representation';\nimport { ContactRepresentationParameters } from '../representation/contact-representation';\nimport { DihedralRepresentationParameters } from '../representation/dihedral-representation';\nimport { DihedralHistogramRepresentationParameters } from '../representation/dihedral-histogram-representation';\nimport { DistanceRepresentationParameters } from '../representation/distance-representation';\nimport { HyperballRepresentationParameters } from '../representation/hyperball-representation';\nimport { LabelRepresentationParameters } from '../representation/label-representation';\nimport { LineRepresentationParameters } from '../representation/line-representation';\nimport { PointRepresentationParameters } from '../representation/point-representation';\nimport { SurfaceRepresentationParameters } from '../representation/surface-representation';\nimport { RibbonRepresentationParameters } from '../representation/ribbon-representation';\nimport { RocketRepresentationParameters } from '../representation/rocket-representation';\nimport { TraceRepresentationParameters } from '../representation/trace-representation';\nimport { UnitcellRepresentationParameters } from '../representation/unitcell-representation';\nimport { SliceRepresentationParameters } from '../representation/slice-representation'\nimport { MolecularSurfaceRepresentationParameters } from '../representation/molecularsurface-representation'\nimport { DotRepresentationParameters } from '../representation/dot-representation'\n\nexport type StructureRepresentationType = keyof StructureRepresentationParametersMap\n\ninterface StructureRepresentationParametersMap {\n  'angle':  AngleRepresentationParameters,\n  'axes' :  AxesRepresentationParameters,\n  'backbone': BallAndStickRepresentationParameters,\n  'ball+stick': BallAndStickRepresentationParameters,\n  'base': BallAndStickRepresentationParameters,\n  'cartoon': CartoonRepresentationParameters,\n  'contact': ContactRepresentationParameters,\n  'dihedral': DihedralRepresentationParameters,\n  'dihedral-histogram': DihedralHistogramRepresentationParameters,\n  'distance': DistanceRepresentationParameters,\n  'dot': DotRepresentationParameters,\n  'helixorient': StructureRepresentationParameters,\n  'hyperball': HyperballRepresentationParameters,\n  'label': LabelRepresentationParameters,\n  'licorice': BallAndStickRepresentationParameters,\n  'line': LineRepresentationParameters,\n  'molecularsurface': MolecularSurfaceRepresentationParameters,\n  'point': PointRepresentationParameters,\n  'ribbon': RibbonRepresentationParameters,\n  'rocket': RocketRepresentationParameters,\n  'rope': CartoonRepresentationParameters,\n  'slice': SliceRepresentationParameters,\n  'spacefill': BallAndStickRepresentationParameters,\n  'surface': SurfaceRepresentationParameters,\n  'trace': TraceRepresentationParameters,\n  'tube': CartoonRepresentationParameters,\n  'unitcell': UnitcellRepresentationParameters,\n  'validation': StructureRepresentationParameters\n}\n\nexport const StructureComponentDefaultParameters = Object.assign({\n  sele: '',\n  defaultAssembly: ''\n}, ComponentDefaultParameters)\nexport type StructureComponentParameters = typeof StructureComponentDefaultParameters\n\nexport interface StructureComponentSignals extends ComponentSignals {\n  trajectoryAdded: Signal  // when a trajectory is added\n  trajectoryRemoved: Signal  // when a trajectory is removed\n  defaultAssemblyChanged: Signal  // on default assembly change\n}\n\n/**\n * Component wrapping a {@link Structure} object\n *\n * @example\n * // get a structure component by loading a structure file into the stage\n * stage.loadFile( \"rcsb://4opj\" ).then( function( structureComponent ){\n *     structureComponent.addRepresentation( \"cartoon\" );\n *     structureComponent.autoView();\n * } );\n */\nclass StructureComponent extends Component {\n  readonly signals: StructureComponentSignals\n  readonly parameters: StructureComponentParameters\n  get defaultParameters () { return StructureComponentDefaultParameters }\n\n  selection: Selection\n  structureView: StructureView\n  readonly trajList: TrajectoryElement[] = []\n\n  pickBuffer: RingBuffer<number>\n  pickDict: SimpleDict<number[], number[]>\n  lastPick?: number\n\n  spacefillRepresentation: RepresentationElement\n  distanceRepresentation: RepresentationElement\n  angleRepresentation: RepresentationElement\n  dihedralRepresentation: RepresentationElement\n\n  measureRepresentations: RepresentationCollection\n\n  constructor (stage: Stage, readonly structure: Structure, params: Partial<StructureComponentParameters> = {}) {\n    super(stage, structure, Object.assign({ name: structure.name }, params))\n\n    this.signals = Object.assign(this.signals, {\n      trajectoryAdded: new Signal(),\n      trajectoryRemoved: new Signal(),\n      defaultAssemblyChanged: new Signal()\n    })\n\n    this.initSelection(this.parameters.sele)\n\n    //\n\n    this.pickBuffer = createRingBuffer(4)\n    this.pickDict = createSimpleDict()\n\n    this.spacefillRepresentation = this.addRepresentation('spacefill', {\n      sele: 'none',\n      opacity: MeasurementDefaultParams.opacity,\n      color: MeasurementDefaultParams.color,\n      disablePicking: true,\n      radiusType: 'data'\n    }, true)\n\n    this.distanceRepresentation = this.addRepresentation(\n      'distance', MeasurementDefaultParams, true\n    )\n    this.angleRepresentation = this.addRepresentation(\n      'angle', MeasurementDefaultParams, true\n    )\n    this.dihedralRepresentation = this.addRepresentation(\n      'dihedral', MeasurementDefaultParams, true\n    )\n\n    this.measureRepresentations = new RepresentationCollection([\n      this.spacefillRepresentation,\n      this.distanceRepresentation,\n      this.angleRepresentation,\n      this.dihedralRepresentation\n    ])\n\n    //\n\n    this.setDefaultAssembly(this.parameters.defaultAssembly)\n\n    this.structure.signals.refreshed.add(() => {\n      this.updateRepresentations({ position: true })\n    })\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'structure' }\n\n  /**\n   * Initialize selection\n   * @private\n   * @param {String} sele - selection string\n   * @return {undefined}\n   */\n  initSelection (sele: string) {\n    /**\n     * Selection for {@link StructureComponent#structureView}\n     * @private\n     * @type {Selection}\n     */\n    this.selection = new Selection(sele)\n\n    /**\n     * View on {@link StructureComponent#structure}.\n     * Change its selection via {@link StructureComponent#setSelection}.\n     * @type {StructureView}\n     */\n    this.structureView = new StructureView(\n      this.structure, this.selection\n    )\n\n    this.selection.signals.stringChanged.add(() => {\n      this.structureView.setSelection(this.selection)\n\n      this.rebuildRepresentations()\n      this.rebuildTrajectories()\n    })\n  }\n\n  /**\n   * Set selection of {@link StructureComponent#structureView}\n   * @param {String} string - selection string\n   * @return {StructureComponent} this object\n   */\n  setSelection (string: string) {\n    this.parameters.sele = string\n    this.selection.setString(string)\n    return this\n  }\n\n  /**\n   * Set the default assembly\n   * @param {String} value - assembly name\n   * @return {undefined}\n   */\n  setDefaultAssembly (value:string) {\n    // filter out non-exsisting assemblies\n    if (this.structure.biomolDict[value] === undefined) value = ''\n    // only set default assembly when changed\n    if (this.parameters.defaultAssembly !== value) {\n      const reprParams = { defaultAssembly: value }\n      this.reprList.forEach(repr => repr.setParameters(reprParams))\n      this.measureRepresentations.setParameters(reprParams)\n      this.parameters.defaultAssembly = value\n      this.signals.defaultAssemblyChanged.dispatch(value)\n    }\n    return this\n  }\n\n  /**\n   * Rebuild all representations\n   * @return {undefined}\n   */\n  rebuildRepresentations () {\n    this.reprList.forEach((repr: RepresentationElement) => {\n      repr.build()\n    })\n    this.measureRepresentations.build()\n  }\n\n  /**\n   * Rebuild all trajectories\n   * @return {undefined}\n   */\n  rebuildTrajectories () {\n    this.trajList.forEach(trajComp => {\n      trajComp.trajectory.setStructure(this.structureView)\n    })\n  }\n\n  updateRepresentations (what: any) {\n    super.updateRepresentations(what)\n    this.measureRepresentations.update(what)\n  }\n\n  /**\n   * Overrides {@link Component.updateRepresentationMatrices} \n   * to also update matrix for measureRepresentations \n   */\n  updateRepresentationMatrices () {\n    super.updateRepresentationMatrices()\n    this.measureRepresentations.setParameters({ matrix: this.matrix })\n  }\n\n  addRepresentation <K extends keyof StructureRepresentationParametersMap>(\n    type: K,\n    params: Partial<StructureRepresentationParametersMap[K]>|{defaultAssembly: string} = {},\n    hidden = false\n  ) {\n    params.defaultAssembly = this.parameters.defaultAssembly\n\n    const reprComp = this._addRepresentation(type, this.structureView, params, hidden)\n    if (!hidden) {\n      reprComp.signals.parametersChanged.add(() => this.measureUpdate())\n    }\n    return reprComp\n  }\n\n  /**\n   * Add a new trajectory component to the structure\n   */\n  addTrajectory (trajPath = '', params: { [k: string]: any } = {}) {\n    const traj = makeTrajectory(trajPath, this.structureView, params as TrajectoryParameters)\n\n    const trajComp = new TrajectoryElement(this.stage, traj, params)\n    this.trajList.push(trajComp)\n    this.signals.trajectoryAdded.dispatch(trajComp)\n\n    return trajComp\n  }\n\n  removeTrajectory (traj: TrajectoryElement) {\n    const idx = this.trajList.indexOf(traj)\n    if (idx !== -1) {\n      this.trajList.splice(idx, 1)\n    }\n\n    traj.dispose()\n\n    this.signals.trajectoryRemoved.dispatch(traj)\n  }\n\n  dispose () {\n    // copy via .slice because side effects may change trajList\n    this.trajList.slice().forEach(traj => traj.dispose())\n\n    this.trajList.length = 0\n    this.structure.dispose()\n    this.measureRepresentations.dispose()\n\n    super.dispose()\n  }\n\n  /**\n   * Automatically center and zoom the component\n   * @param  {String|Integer} [sele] - selection string or duration if integer\n   * @param  {Integer} [duration] - duration of the animation, defaults to 0\n   * @return {undefined}\n   */\n  autoView (sele?: string|number, duration?: number) {\n    if (typeof sele === 'number') {\n      duration = sele\n      sele = ''\n    }\n\n    this.stage.animationControls.zoomMove(\n      this.getCenter(sele),\n      this.getZoom(sele),\n      defaults(duration, 0)\n    )\n  }\n\n  getBoxUntransformed (sele: string): Box3 {\n    let bb\n\n    if (sele) {\n      bb = this.structureView.getBoundingBox(new Selection(sele))\n    } else {\n      bb = this.structureView.boundingBox\n    }\n\n    return bb\n  }\n\n  getCenterUntransformed (sele: string): Vector3 {\n    if (sele && typeof sele === 'string') {\n      return this.structure.atomCenter(new Selection(sele))\n    } else {\n      return this.structure.center\n    }\n  }\n\n  superpose (component: StructureComponent, align: boolean, sele1: string, sele2: string) {\n    superpose(\n      this.structureView, component.structureView, align, sele1, sele2\n    )\n\n    this.updateRepresentations({ 'position': true })\n\n    return this\n  }\n\n  getMaxRepresentationRadius (atomIndex: number) {\n    let maxRadius = 0\n    const atom = this.structure.getAtomProxy(atomIndex)\n    this.eachRepresentation(reprElem => {\n      if (reprElem.getVisibility()) {\n        const repr: StructureRepresentation = reprElem.repr as any  // TODO\n        maxRadius = Math.max(repr.getAtomRadius(atom), maxRadius)\n      }\n    })\n    return maxRadius\n  }\n\n  measurePick (atom: AtomProxy) {\n    const pickCount = this.pickBuffer.count\n\n    if (this.lastPick === atom.index && pickCount >= 1) {\n      if (pickCount > 1) {\n        const atomList = this.pickBuffer.data\n        const atomListSorted = this.pickBuffer.data.sort()\n        if (this.pickDict.has(atomListSorted)) {\n          this.pickDict.del(atomListSorted)\n        } else {\n          this.pickDict.add(atomListSorted, atomList)\n        }\n        if (pickCount === 2) {\n          this.distanceRepresentation.setParameters({\n            atomPair: this.pickDict.values.filter(l => l.length === 2)\n          })\n        } else if (pickCount === 3) {\n          this.angleRepresentation.setParameters({\n            atomTriple: this.pickDict.values.filter(l => l.length === 3)\n          })\n        } else if (pickCount === 4) {\n          this.dihedralRepresentation.setParameters({\n            atomQuad: this.pickDict.values.filter(l => l.length === 4)\n          })\n        }\n      }\n      this.pickBuffer.clear()\n      this.lastPick = undefined\n    } else {\n      if (!this.pickBuffer.has(atom.index)) {\n        this.pickBuffer.push(atom.index)\n      }\n      this.lastPick = atom.index\n    }\n\n    this.measureUpdate()\n  }\n\n  measureClear () {\n    this.pickBuffer.clear()\n    this.lastPick = undefined\n    this.spacefillRepresentation.setSelection('none')\n  }\n\n  measureBuild () {\n    const md = this.measureData()\n    this.distanceRepresentation.setParameters({ atomPair: md.distance })\n    this.angleRepresentation.setParameters({ atomTriple: md.angle })\n    this.dihedralRepresentation.setParameters({ atomQuad: md.dihedral })\n  }\n\n  measureUpdate () {\n    const pickData = this.pickBuffer.data\n    const radiusData: { [k: number]: number } = {}\n    pickData.forEach(ai => {\n      const r = Math.max(0.1, this.getMaxRepresentationRadius(ai))\n      radiusData[ ai ] = r * (2.3 - smoothstep(0.1, 2, r))\n    })\n    this.spacefillRepresentation.setSelection(\n      pickData.length ? ( '@' + pickData.join(',') ) : 'none'\n    )\n    if (pickData.length)\n      this.spacefillRepresentation.setParameters({ radiusData })\n  }\n\n  measureData () {\n    const pv = this.pickDict.values\n    return {\n      distance: pv.filter(l => l.length === 2),\n      angle: pv.filter(l => l.length === 3),\n      dihedral: pv.filter(l => l.length === 4)\n    }\n  }\n\n  /**\n   * Remove all measurements, optionally limit to distance, angle or dihedral\n   */\n  removeAllMeasurements (type?: MeasurementFlags) {\n    const pd = this.pickDict\n    const pv = pd.values\n    const remove = function (len: number) {\n      pv.filter(l => l.length === len).forEach(l => pd.del(l.slice().sort()))\n    }\n    if (!type || type & MeasurementFlags.Distance) remove(2)\n    if (!type || type & MeasurementFlags.Angle) remove(3)\n    if (!type || type & MeasurementFlags.Dihedral) remove(4)\n    this.measureBuild()\n  }\n\n  /**\n   * Remove a measurement given as a pair, triple, quad of atom indices\n   */\n  removeMeasurement (atomList: number[]) {\n    this.pickDict.del(atomList.slice().sort())\n    this.measureBuild()\n  }\n\n  /**\n   * Add a measurement given as a pair, triple, quad of atom indices\n   */\n  addMeasurement (atomList: number[]) {\n    if (atomList.length < 2 || atomList.length > 4) return\n    const atomListSorted = atomList.slice().sort()\n    if (!this.pickDict.has(atomListSorted)) {\n      this.pickDict.add(atomListSorted, atomList)\n    }\n    this.measureBuild()\n  }\n}\n\nexport const enum MeasurementFlags {\n  Distance = 0x1,\n  Angle = 0x2,\n  Dihedral = 0x4\n}\n\nComponentRegistry.add('structure', StructureComponent)\nComponentRegistry.add('structureview', StructureComponent)\n\nexport default StructureComponent\n","/**\n * @file Trajectory Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Frames from './frames'\nimport { TrajectoryParameters } from './trajectory'\nimport FramesTrajectory from './frames-trajectory'\nimport StructureTrajectory from './structure-trajectory'\nimport RemoteTrajectory from './remote-trajectory'\nimport CallbackTrajectory from './callback-trajectory'\n\nexport function makeTrajectory (trajSrc: string|Frames, structure: Structure, params: TrajectoryParameters) {\n  let traj\n\n  if (trajSrc && trajSrc instanceof Frames) {\n    traj = new FramesTrajectory(trajSrc, structure, params)\n  } else if (!trajSrc && structure.frames) {\n    traj = new StructureTrajectory(trajSrc, structure, params)\n  } else if (trajSrc && typeof trajSrc === 'function') {\n    traj = new CallbackTrajectory(trajSrc, structure, params)\n  } else {\n    traj = new RemoteTrajectory(trajSrc, structure, params)\n  }\n\n  return traj\n}\n\n","/**\n * @file Surface Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Surface from '../surface/surface'\nimport { Vector3, Box3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type SurfaceRepresentationType = 'surface'|'dot'\n\n/**\n * Component wrapping a {@link Surface} object\n *\n * @example\n * // get a surface component by loading a surface file into the stage\n * stage.loadFile( \"url/for/surface\" ).then( function( surfaceComponent ){\n *     surfaceComponent.addRepresentation( \"surface\" );\n *     surfaceComponent.autoView();\n * } );\n */\nclass SurfaceComponent extends Component {\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Surface} surface - surface object to wrap\n   * @param {ComponentParameters} params - component parameters\n   */\n  constructor (stage: Stage, readonly surface: Surface, params: Partial<ComponentParameters> = {}) {\n    super(stage, surface, Object.assign({ name: surface.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'surface' }\n\n  /**\n   * Add a new surface representation to the component\n   * @param {String} type - the name of the representation, one of:\n   *                        surface, dot.\n   * @param {SurfaceRepresentationParameters} params - representation parameters\n   * @return {RepresentationComponent} the created representation wrapped into\n   *                                   a representation component object\n   */\n  addRepresentation (type: SurfaceRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.surface, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.surface.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.surface.center\n  }\n\n  dispose () {\n    this.surface.dispose()\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('surface', SurfaceComponent)\n\nexport default SurfaceComponent\n","/**\n * @file Volume Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Volume from '../surface/volume'\nimport { Box3, Vector3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type VolumeRepresentationType = 'surface'|'slice'|'dot'\n\n/**\n * Component wrapping a {@link Volume} object\n *\n * @example\n * // get a volume component by loading a volume file into the stage\n * stage.loadFile( \"url/for/volume\" ).then(function(volumeComponent){\n *   volumeComponent.addRepresentation('surface');\n *   volumeComponent.autoView();\n * });\n */\nclass VolumeComponent extends Component {\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Volume} volume - volume object to wrap\n   * @param {ComponentParameters} params - component parameters\n   */\n  constructor (stage: Stage, readonly volume: Volume, params: Partial<ComponentParameters> = {}) {\n    super(stage, volume, Object.assign({ name: volume.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'volume' }\n\n  /**\n   * Add a new volume representation to the component\n   */\n  addRepresentation (type: VolumeRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.volume, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.volume.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.volume.center\n  }\n\n  dispose () {\n    this.volume.dispose()\n\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('volume', VolumeComponent)\n\nexport default VolumeComponent\n","/**\n * @file Component Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Component from './component'\nimport Collection from './collection'\n\nclass ComponentCollection extends Collection<Component> {\n  addRepresentation (name: string, params: any) {\n  \treturn this.forEach((comp) => comp.addRepresentation(name, params))\n  }\n\n  autoView (duration: number) {\n    return this.forEach((comp) => comp.autoView(duration))\n  }\n}\n\nexport default ComponentCollection\n","/**\n * @file Stage\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\nimport { Signal } from 'signals'\n\nimport {\n  Debug, Log, Mobile, ComponentRegistry, ParserRegistry\n} from '../globals'\nimport { defaults, createParams, updateParams } from '../utils'\nimport { degToRad, clamp, pclamp } from '../math/math-utils'\nimport Counter from '../utils/counter'\nimport Viewer from '../viewer/viewer'\nimport { ImageParameters } from '../viewer/viewer-utils'\nimport MouseObserver from './mouse-observer'\n\nimport TrackballControls from '../controls/trackball-controls'\nimport PickingControls from '../controls/picking-controls'\nimport ViewerControls from '../controls/viewer-controls'\nimport AnimationControls from '../controls/animation-controls'\nimport MouseControls, { MouseControlPreset } from '../controls/mouse-controls'\nimport KeyControls from '../controls/key-controls'\n\nimport PickingBehavior from './picking-behavior'\nimport MouseBehavior from './mouse-behavior'\nimport AnimationBehavior from './animation-behavior'\nimport KeyBehavior from './key-behavior'\n\nimport Component, { ComponentParameters } from '../component/component'\nimport RepresentationElement from '../component/representation-element'\nimport StructureComponent from '../component/structure-component'\nimport SurfaceComponent from '../component/surface-component'\nimport VolumeComponent from '../component/volume-component'\nimport ComponentCollection from '../component/component-collection'\nimport RepresentationCollection from '../component/representation-collection'\nimport { autoLoad, getFileInfo, LoaderParameters } from '../loader/loader-utils'\nimport { ParserParams } from '../loader/parser-loader'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Animation from '../animation/animation'\nimport Selection from '../selection/selection'\n\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Shape from '../geometry/shape'\nimport Script from '../script'\nimport { GenericColor } from '../types'\n\nfunction matchName (name: string|RegExp, object: { name: string }) {\n  if (name instanceof RegExp) {\n    return object.name.match(name) !== null\n  } else {\n    return object.name === name\n  }\n}\n\nconst tmpZoomVector = new Vector3()\n\ndeclare global {\n  interface Document {\n    mozFullScreen: boolean\n    mozFullScreenEnabled: boolean\n    mozFullScreenElement: Element\n    mozCancelFullScreen(): void\n\n    msFullscreenEnabled: boolean\n    msFullscreenElement: Element\n    msExitFullscreen(): void\n  }\n\n  interface Element {\n    mozRequestFullScreen(): void\n    msRequestFullscreen(): void\n  }\n}\n\n/**\n * Stage parameter object.\n * @typedef {Object} StageParameters - stage parameters\n * @property {Color} backgroundColor - background color\n * @property {Integer} sampleLevel - sampling level for antialiasing, between -1 and 5;\n *                                   -1: no sampling, 0: only sampling when not moving\n * @property {Boolean} workerDefault - default value for useWorker parameter of representations\n * @property {Float} rotateSpeed - camera-controls rotation speed, between 0 and 10\n * @property {Float} zoomSpeed - camera-controls zoom speed, between 0 and 10\n * @property {Float} panSpeed - camera-controls pan speed, between 0 and 10\n * @property {Float} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Float} clipFar - position of camera far/back clipping plane\n *                               in percent of scene bounding box\n * @property {Float} clipDist - camera clipping distance in Angstrom\n * @property {String} clipMode - how to interpret clipNear/Far and fogNear/Far values: \"scene\" for scene-relative, \"camera\" for camera-relative\n * @property {String} clipScale - \"relative\" or \"absolute\": interpret clipNear/Far and fogNear/Far as percentage of bounding box or absolute Angstroms (ignored when clipMode==camera)\n * @property {Float} fogNear - position of the start of the fog effect\n *                               in percent of scene bounding box\n * @property {Float} fogFar - position where the fog is in full effect\n *                              in percent of scene bounding box\n * @property {String} cameraType - type of camera, either 'persepective' or 'orthographic'\n * @property {Float} cameraFov - perspective camera field of view in degree, between 15 and 120\n * @property {Float} cameraEyeSep - stereo camera eye seperation\n * @property {Color} lightColor - point light color\n * @property {Float} lightIntensity - point light intensity\n * @property {Color} ambientColor - ambient light color\n * @property {Float} ambientIntensity - ambient light intensity\n * @property {Integer} hoverTimeout - timeout for hovering\n */\n\nexport interface StageSignals {\n  parametersChanged: Signal\n  fullscreenChanged: Signal\n  componentAdded: Signal\n  componentRemoved: Signal\n  clicked: Signal\n  hovered: Signal\n}\n\nexport type RenderQualityType = 'auto'|'low'|'medium'|'high'\n\nexport const StageDefaultParameters = {\n  impostor: true,\n  quality: 'medium' as RenderQualityType,\n  workerDefault: true,\n  sampleLevel: 0,\n  backgroundColor: 'black' as GenericColor,\n  rotateSpeed: 2.0,\n  zoomSpeed: 1.2,\n  panSpeed: 1.0,\n  clipNear: 0,\n  clipFar: 100,\n  clipDist: 10,\n  clipMode: 'scene',\n  clipScale: 'relative',\n  fogNear: 50,\n  fogFar: 100,\n  cameraFov: 40,\n  cameraEyeSep: 0.3,\n  cameraType: 'perspective' as 'perspective'|'orthographic'|'stereo',\n  lightColor: 0xdddddd as GenericColor,\n  lightIntensity: 1.2,\n  ambientColor: 0xdddddd as GenericColor,\n  ambientIntensity: 0.3,\n  hoverTimeout: 0,\n  tooltip: true,\n  mousePreset: 'default' as MouseControlPreset\n}\nexport type StageParameters = typeof StageDefaultParameters\n\nexport interface StageLoadFileParams extends LoaderParameters {\n  defaultRepresentation: boolean,\n  assembly: string\n}\n\n/**\n * Stage class, central for creating molecular scenes with NGL.\n *\n * @example\n * var stage = new Stage( \"elementId\", { backgroundColor: \"white\" } );\n */\nclass Stage {\n  signals: StageSignals = {\n    parametersChanged: new Signal(),\n    fullscreenChanged: new Signal(),\n    componentAdded: new Signal(),\n    componentRemoved: new Signal(),\n    clicked: new Signal(),\n    hovered: new Signal()\n  }\n  parameters: StageParameters\n\n  /**\n   * Counter that keeps track of various potentially long-running tasks,\n   * including file loading and surface calculation.\n   */\n  tasks = new Counter()\n  compList: Component[] = []\n  defaultFileParams = {}\n  logList: string[] = []\n\n  transformComponent?: Component\n  transformAtom?: AtomProxy\n\n  viewer: Viewer\n  tooltip: HTMLElement\n  lastFullscreenElement: HTMLElement\n\n  mouseObserver: MouseObserver\n  viewerControls: ViewerControls\n  trackballControls: TrackballControls\n  pickingControls: PickingControls\n  animationControls: AnimationControls\n  mouseControls: MouseControls\n  keyControls: KeyControls\n\n  pickingBehavior: PickingBehavior\n  mouseBehavior: MouseBehavior\n  animationBehavior: AnimationBehavior\n  keyBehavior: KeyBehavior\n\n  spinAnimation: Animation\n  rockAnimation: Animation\n\n  constructor (idOrElement: string|HTMLElement, params: Partial<StageParameters> = {}) {\n    this.viewer = new Viewer(idOrElement)\n    if (!this.viewer.renderer) return\n\n    this.tooltip = document.createElement('div')\n    Object.assign(this.tooltip.style, {\n      display: 'none',\n      position: 'fixed',\n      zIndex: '1000000',\n      pointerEvents: 'none',\n      backgroundColor: 'rgba( 0, 0, 0, 0.6 )',\n      color: 'lightgrey',\n      padding: '8px',\n      fontFamily: 'sans-serif'\n    })\n    this.viewer.container.appendChild(this.tooltip)\n\n    this.mouseObserver = new MouseObserver(this.viewer.renderer.domElement)\n    this.viewerControls = new ViewerControls(this)\n    this.trackballControls = new TrackballControls(this)\n    this.pickingControls = new PickingControls(this)\n    this.animationControls = new AnimationControls(this)\n    this.mouseControls = new MouseControls(this)\n    this.keyControls = new KeyControls(this)\n\n    this.pickingBehavior = new PickingBehavior(this)\n    this.mouseBehavior = new MouseBehavior(this)\n    this.animationBehavior = new AnimationBehavior(this)\n    this.keyBehavior = new KeyBehavior(this)\n\n    this.spinAnimation = this.animationControls.spin([ 0, 1, 0 ], 0.005)\n    this.spinAnimation.pause(true)\n    this.rockAnimation = this.animationControls.rock([ 0, 1, 0 ], 0.005)\n    this.rockAnimation.pause(true)\n\n    // must come after the viewer has been instantiated\n    this.parameters = createParams(params, StageDefaultParameters)\n    this.setParameters(this.parameters)\n\n    this.viewer.animate()\n  }\n\n  /**\n   * Set stage parameters\n   */\n  setParameters (params: Partial<StageParameters> = {}) {\n    updateParams(this.parameters, params)\n\n    const p = params\n    const tp = this.parameters\n\n    const viewer = this.viewer\n    const controls = this.trackballControls\n\n    // apply parameters\n    if (p.quality !== undefined) this.setQuality(tp.quality)\n    if (p.impostor !== undefined) this.setImpostor(tp.impostor)\n    if (p.rotateSpeed !== undefined) controls.rotateSpeed = tp.rotateSpeed\n    if (p.zoomSpeed !== undefined) controls.zoomSpeed = tp.zoomSpeed\n    if (p.panSpeed !== undefined) controls.panSpeed = tp.panSpeed\n    if (p.mousePreset !== undefined) this.mouseControls.preset(tp.mousePreset)\n    this.mouseObserver.setParameters({ hoverTimeout: tp.hoverTimeout })\n    viewer.setClip(tp.clipNear, tp.clipFar, tp.clipDist, tp.clipMode, tp.clipScale)\n    viewer.setFog(undefined, tp.fogNear, tp.fogFar)\n    viewer.setCamera(tp.cameraType, tp.cameraFov, tp.cameraEyeSep)\n    viewer.setSampling(tp.sampleLevel)\n    viewer.setBackground(tp.backgroundColor)\n    viewer.setLight(tp.lightColor, tp.lightIntensity, tp.ambientColor, tp.ambientIntensity)\n\n    this.signals.parametersChanged.dispatch(this.getParameters())\n\n    return this\n  }\n\n  log (msg: string) {\n    console.log('STAGE LOG', msg)\n    this.logList.push(msg)\n  }\n\n  /**\n   * Get stage parameters\n   */\n  getParameters () {\n    return Object.assign({}, this.parameters)\n  }\n\n  /**\n   * Create default representations for the given component\n   * @param  {StructureComponent|SurfaceComponent} object - component to create the representations for\n   * @return {undefined}\n   */\n  defaultFileRepresentation (component: Component) {\n    if (component instanceof StructureComponent) {\n      component.setSelection('/0')\n\n      let atomCount, residueCount, instanceCount\n      const structure = component.structure\n\n      if (structure.biomolDict.BU1) {\n        const assembly = structure.biomolDict.BU1\n        atomCount = assembly.getAtomCount(structure)\n        residueCount = assembly.getResidueCount(structure)\n        instanceCount = assembly.getInstanceCount()\n        component.setDefaultAssembly('BU1')\n      } else {\n        atomCount = structure.getModelProxy(0).atomCount\n        residueCount = structure.getModelProxy(0).residueCount\n        instanceCount = 1\n      }\n\n      let sizeScore = atomCount\n\n      if (Mobile) {\n        sizeScore *= 4\n      }\n\n      const backboneOnly = structure.atomStore.count / structure.residueStore.count < 2\n      if (backboneOnly) {\n        sizeScore *= 10\n      }\n\n      let colorScheme = 'chainname'\n      let colorScale = 'RdYlBu'\n      let colorReverse = false\n      if (structure.getChainnameCount(new Selection('polymer and /0')) === 1) {\n        colorScheme = 'residueindex'\n        colorScale = 'Spectral'\n        colorReverse = true\n      }\n\n      if (Debug) console.log(sizeScore, atomCount, instanceCount, backboneOnly)\n\n      if (residueCount / instanceCount < 4) {\n        component.addRepresentation('ball+stick', {\n          colorScheme: 'element',\n          radiusScale: 2.0,\n          aspectRatio: 1.5,\n          bondScale: 0.3,\n          bondSpacing: 0.75,\n          quality: 'auto'\n        })\n      } else if ((instanceCount > 5 && sizeScore > 15000) || sizeScore > 700000) {\n        let scaleFactor = (\n          Math.min(\n            2.0,\n            Math.max(\n              0.1,\n              6000 / (sizeScore / instanceCount)\n            )\n          )\n        )\n        if (backboneOnly) scaleFactor = Math.min(scaleFactor, 0.5)\n\n        component.addRepresentation('surface', {\n          colorScheme, colorScale, colorReverse,\n          sele: 'polymer',\n          surfaceType: 'av',\n          probeRadius: 1.4,\n          scaleFactor: scaleFactor,\n          useWorker: false\n        })\n      } else if (sizeScore > 250000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          lineOnly: true\n        })\n      } else if (sizeScore > 100000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          quality: 'low',\n          disableImpostor: true,\n          radiusScale: 2.0\n        })\n      } else if (sizeScore > 80000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          radiusScale: 2.0\n        })\n      } else {\n        component.addRepresentation('cartoon', {\n          colorScheme, colorScale, colorReverse,\n          radiusScale: 0.7,\n          aspectRatio: 5,\n          quality: 'auto'\n        })\n        if (sizeScore < 50000) {\n          component.addRepresentation('base', {\n            colorScheme, colorScale, colorReverse,\n            quality: 'auto'\n          })\n        }\n        component.addRepresentation('ball+stick', {\n          sele: 'ligand',\n          colorScheme: 'element',\n          radiusScale: 2.0,\n          aspectRatio: 1.5,\n          bondScale: 0.3,\n          bondSpacing: 0.75,\n          quality: 'auto'\n        })\n      }\n\n      // add frames as trajectory\n      if (component.structure.frames.length) {\n        component.addTrajectory()\n      }\n    } else if (component instanceof SurfaceComponent) {\n      component.addRepresentation('surface')\n    } else if (component instanceof VolumeComponent) {\n      component.addRepresentation('surface')\n    }\n\n    this.tasks.onZeroOnce(this.autoView, this)\n  }\n\n  /**\n   * Load a file onto the stage\n   *\n   * @example\n   * // load from URL\n   * stage.loadFile( \"http://files.rcsb.org/download/5IOS.cif\" );\n   *\n   * @example\n   * // load binary data in CCP4 format via a Blob\n   * var binaryBlob = new Blob( [ ccp4Data ], { type: 'application/octet-binary'} );\n   * stage.loadFile( binaryBlob, { ext: \"ccp4\" } );\n   *\n   * @example\n   * // load string data in PDB format via a Blob\n   * var stringBlob = new Blob( [ pdbData ], { type: 'text/plain'} );\n   * stage.loadFile( stringBlob, { ext: \"pdb\" } );\n   *\n   * @example\n   * // load a File object\n   * stage.loadFile( file );\n   *\n   * @example\n   * // load from URL and add a 'ball+stick' representation with double/triple bonds\n   * stage.loadFile( \"http://files.rcsb.org/download/1crn.cif\" ).then( function( comp ){\n   *     comp.addRepresentation( \"ball+stick\", { multipleBond: true } );\n   * } );\n   *\n   * @param  {String|File|Blob} path - either a URL or an object containing the file data\n   * @param  {LoaderParameters} params - loading parameters\n   * @param  {Boolean} params.asTrajectory - load multi-model structures as a trajectory\n   * @return {Promise} A Promise object that resolves to a {@link StructureComponent},\n   *                   a {@link SurfaceComponent} or a {@link ScriptComponent} object,\n   *                   depending on the type of the loaded file.\n   */\n  loadFile (path: string|File|Blob, params: Partial<StageLoadFileParams & ParserParams> = {}) {\n    const p = Object.assign({}, this.defaultFileParams, params)\n    const name = getFileInfo(path).name\n\n    this.tasks.increment()\n    this.log(`loading file '${name}'`)\n\n    const onLoadFn = (object: Structure|Surface|Volume) => {\n      this.log(`loaded '${name}'`)\n\n      const component = this.addComponentFromObject(object, p)\n      if (p.defaultRepresentation) {\n        this.defaultFileRepresentation(component as Component)\n      }\n      this.tasks.decrement()\n\n      return component\n    }\n\n    const onErrorFn = (e: Error|string) => {\n      this.tasks.decrement()\n      const errorMsg = `error loading file: '${e}'`\n      this.log(errorMsg)\n      throw errorMsg  // throw so it can be catched\n    }\n\n    const ext = defaults(p.ext, getFileInfo(path).ext)\n    let promise: Promise<any>\n\n    if (ParserRegistry.isTrajectory(ext)) {\n      promise = Promise.reject(\n        new Error(`loadFile: ext '${ext}' is a trajectory and must be loaded into a structure component`)\n      )\n    } else {\n      promise = autoLoad(path, p)\n    }\n\n    return promise.then(onLoadFn, onErrorFn)\n  }\n\n  loadScript (path: string|File|Blob) {\n    const name = getFileInfo(path).name\n\n    this.log(`loading script '${name}'`)\n\n    return autoLoad(path).then(\n      (script: Script) => {\n        this.tasks.increment()\n        this.log(`running script '${name}'`)\n        script.run(this).then(() => {\n          this.tasks.decrement()\n          this.log(`finished script '${name}'`)\n        })\n        this.log(`called script '${name}'`)\n      },\n      (error: Error|string) => {\n        this.tasks.decrement()\n        const errorMsg = `errored script '${name}' \"${error}\"`\n        this.log(errorMsg)\n        throw errorMsg  // throw so it can be catched\n      }\n    )\n  }\n\n  /**\n   * Add the given component to the stage\n   * @param {Component} component - the component to add\n   * @return {undefined}\n   */\n  addComponent (component: Component) {\n    if (!component) {\n      Log.warn('Stage.addComponent: no component given')\n      return\n    }\n\n    this.compList.push(component)\n    this.signals.componentAdded.dispatch(component)\n  }\n\n  /**\n   * Create a component from the given object and add to the stage\n   */\n  addComponentFromObject (object: Structure|Surface|Volume|Shape, params: Partial<ComponentParameters> = {}): void|Component {\n    const CompClass = ComponentRegistry.get(object.type)\n\n    if (CompClass) {\n      const component = new CompClass(this, object, params)\n      this.addComponent(component)\n      return component\n    }\n\n    Log.warn('no component for object type', object.type)\n  }\n\n  /**\n   * Remove the given component\n   * @param  {Component} component - the component to remove\n   * @return {undefined}\n   */\n  removeComponent (component: Component) {\n    const idx = this.compList.indexOf(component)\n    if (idx !== -1) {\n      this.compList.splice(idx, 1)\n      component.dispose()\n      this.signals.componentRemoved.dispatch(component)\n    }\n  }\n\n  /**\n   * Remove all components from the stage\n   */\n  removeAllComponents () {\n    this.compList.slice().forEach(o => this.removeComponent(o))\n  }\n\n  /**\n   * Handle any size-changes of the container element\n   * @return {undefined}\n   */\n  handleResize () {\n    this.viewer.handleResize()\n  }\n\n  /**\n   * Set width and height\n   * @param {String} width - CSS width value\n   * @param {String} height - CSS height value\n   * @return {undefined}\n   */\n  setSize (width: string, height: string) {\n    const container = this.viewer.container\n\n    if (container !== document.body) {\n      if (width !== undefined) container.style.width = width\n      if (height !== undefined) container.style.height = height\n      this.handleResize()\n    }\n  }\n\n  /**\n   * Toggle fullscreen\n   * @param  {Element} [element] - document element to put into fullscreen,\n   *                               defaults to the viewer container\n   * @return {undefined}\n   */\n  toggleFullscreen (element: HTMLElement) {\n    if (!document.fullscreenEnabled && !document.mozFullScreenEnabled &&\n        !(document as any).webkitFullscreenEnabled && !document.msFullscreenEnabled\n    ) {\n      Log.log('fullscreen mode (currently) not possible')\n      return\n    }\n\n    const self = this\n    element = element || this.viewer.container\n    this.lastFullscreenElement = element\n\n    //\n\n    function getFullscreenElement () {\n      return document.fullscreenElement || document.mozFullScreenElement ||\n        (document as any).webkitFullscreenElement || document.msFullscreenElement\n    }\n\n    function resizeElement () {\n      if (!getFullscreenElement() && self.lastFullscreenElement) {\n        const element = self.lastFullscreenElement\n        element.style.width = element.dataset.normalWidth || ''\n        element.style.height = element.dataset.normalHeight || ''\n\n        document.removeEventListener('fullscreenchange', resizeElement)\n        document.removeEventListener('mozfullscreenchange', resizeElement)\n        document.removeEventListener('webkitfullscreenchange', resizeElement)\n        document.removeEventListener('MSFullscreenChange', resizeElement)\n\n        self.handleResize()\n        self.signals.fullscreenChanged.dispatch(false)\n      }\n    }\n\n    //\n\n    if (!getFullscreenElement()) {\n      element.dataset.normalWidth = element.style.width || ''\n      element.dataset.normalHeight = element.style.height || ''\n      element.style.width = window.screen.width + 'px'\n      element.style.height = window.screen.height + 'px'\n\n      if (element.requestFullscreen) {\n        element.requestFullscreen()\n      } else if (element.msRequestFullscreen) {\n        element.msRequestFullscreen()\n      } else if (element.mozRequestFullScreen) {\n        element.mozRequestFullScreen()\n      } else if ((element as any).webkitRequestFullscreen) {\n        (element as any).webkitRequestFullscreen()\n      }\n\n      document.addEventListener('fullscreenchange', resizeElement)\n      document.addEventListener('mozfullscreenchange', resizeElement)\n      document.addEventListener('webkitfullscreenchange', resizeElement)\n      document.addEventListener('MSFullscreenChange', resizeElement)\n\n      this.handleResize()\n      this.signals.fullscreenChanged.dispatch(true)\n\n      // workaround for Safari\n      setTimeout(function () { self.handleResize() }, 100)\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen()\n      } else if (document.msExitFullscreen) {\n        document.msExitFullscreen()\n      } else if (document.mozCancelFullScreen) {\n        document.mozCancelFullScreen()\n      } else if ((document as any).webkitExitFullscreen) {\n        (document as any).webkitExitFullscreen()\n      }\n    }\n  }\n\n  /**\n   * Set spin\n   * @param {Boolean} flag - if true start rocking and stop spinning\n   * @return {undefined}\n   */\n  setSpin (flag: boolean) {\n    if (flag) {\n      this.spinAnimation.resume(true)\n      this.rockAnimation.pause(true)\n    } else {\n      this.spinAnimation.pause(true)\n    }\n  }\n\n  /**\n   * Set rock\n   * @param {Boolean} flag - if true start rocking and stop spinning\n   * @return {undefined}\n   */\n  setRock (flag: boolean) {\n    if (flag) {\n      this.rockAnimation.resume(true)\n      this.spinAnimation.pause(true)\n    } else {\n      this.rockAnimation.pause(true)\n    }\n  }\n\n  /**\n   * Toggle spin\n   * @return {undefined}\n   */\n  toggleSpin () {\n    this.setSpin(this.spinAnimation.paused)\n  }\n\n  /**\n   * Toggle rock\n   * @return {undefined}\n   */\n  toggleRock () {\n    this.setRock(this.rockAnimation.paused)\n  }\n\n  /**\n   * Get the current focus from the current clipNear value expressed\n   * as 0 (full view) to 100 (completely clipped)\n   * Negative values may be returned in some cases.\n   *\n   * In 'camera' clipMode focus isn't applicable, this method returns 0.0\n   *\n   * @return {number} focus\n   */\n  getFocus () : number {\n    const p = this.parameters\n    if (p.clipMode !== 'scene') return 0.0\n\n    let clipNear = p.clipNear\n    if (p.clipScale === 'absolute') {\n      clipNear = this.viewer.absoluteToRelative(clipNear)\n    }\n    return clipNear * 2\n  }\n\n\n  /**\n   * Set the focus, a value of 0 sets clipping planes to show full scene,\n   * while a value of 100 will compltely clip the scene.\n   *\n   * @param {number} value focus\n   */\n  setFocus (value: number) {\n    if (this.parameters.clipMode !== 'scene') return\n\n    let clipNear\n    let clipFar\n    let fogNear\n    let fogFar\n\n    if (this.parameters.clipScale === 'relative') {\n      clipNear = clamp(value / 2.0, 0.0, 49.9)\n      clipFar = 100 - clipNear\n      fogNear = 50\n      fogFar = pclamp(2 * clipFar - 50)\n\n    } else {\n      clipNear = this.viewer.relativeToAbsolute(value / 2.0)\n      clipFar = clipNear\n      fogNear = 0\n      fogFar = 2 * clipFar\n    }\n\n    this.setParameters({ clipNear, clipFar, fogNear, fogFar })\n  }\n\n  getZoomForBox (boundingBox: Box3) {\n    const bbSize = boundingBox.getSize(tmpZoomVector)\n    const maxSize = Math.max(bbSize.x, bbSize.y, bbSize.z)\n    const minSize = Math.min(bbSize.x, bbSize.y, bbSize.z)\n    let distance = maxSize + Math.sqrt(minSize)\n\n    const fov = degToRad(this.viewer.perspectiveCamera.fov)\n    const width = this.viewer.width\n    const height = this.viewer.height\n    const aspect = width / height\n    const aspectFactor = (height < width ? 1 : aspect)\n\n    distance = Math.abs(\n      ((distance * 0.5) / aspectFactor) / Math.sin(fov / 2)\n    )\n    distance += this.parameters.clipDist\n    return -distance\n  }\n\n  getBox () {\n    return this.viewer.boundingBox\n  }\n\n  getZoom () {\n    return this.getZoomForBox(this.getBox())\n  }\n\n  getCenter (optionalTarget?: Vector3) {\n    return this.getBox().getCenter(optionalTarget || new Vector3())\n  }\n\n  /**\n   * Add a zoom and a move animation with automatic targets\n   * @param  {Integer} duration - animation time in milliseconds\n   * @return {undefined}\n   */\n  autoView (duration?: number) {\n    this.animationControls.zoomMove(\n      this.getCenter(),\n      this.getZoom(),\n      defaults(duration, 0)\n    )\n  }\n\n  /**\n   * Make image from what is shown in a viewer canvas\n   */\n  makeImage (params: Partial<ImageParameters> = {}) {\n    return new Promise<Blob>((resolve, reject) => {\n      this.tasks.onZeroOnce(() => {\n        this.tasks.increment()\n        this.viewer.makeImage(params).then(blob => {\n          this.tasks.decrement()\n          resolve(blob)\n        }).catch(e => {\n          this.tasks.decrement()\n          reject(e)\n        })\n      })\n    })\n  }\n\n  setImpostor (value: boolean) {\n    this.parameters.impostor = value\n\n    const types = [\n      'spacefill', 'ball+stick', 'licorice', 'hyperball',\n      'backbone', 'rocket', 'helixorient', 'contact', 'distance',\n      'dot'\n    ]\n\n    this.eachRepresentation(function (reprElem) {\n      if (!types.includes(reprElem.getType())) return\n\n      const p = reprElem.getParameters() as any  // TODO\n      p.disableImpostor = !value\n      reprElem.build(p)\n    })\n  }\n\n  setQuality (value: RenderQualityType) {\n    this.parameters.quality = value\n\n    const types = [\n      'tube', 'cartoon', 'ribbon', 'trace', 'rope'\n    ]\n\n    const impostorTypes = [\n      'spacefill', 'ball+stick', 'licorice', 'hyperball',\n      'backbone', 'rocket', 'helixorient', 'contact', 'distance',\n      'dot'\n    ]\n\n    this.eachRepresentation(function (repr) {\n      const p = repr.getParameters() as any  // TODO\n\n      if (!types.includes(repr.getType())) {\n        if (!impostorTypes.includes(repr.getType())) return\n\n        if (!p.disableImpostor) {\n          (repr.repr as any).quality = value  // TODO\n          return\n        }\n      }\n\n      p.quality = value\n      repr.build(p)\n    })\n  }\n\n  /**\n   * Iterator over each component and executing the callback\n   */\n  eachComponent (callback: (comp: Component) => void, type?: string) {\n    this.compList.slice().forEach(comp => {\n      if (type === undefined || type === comp.type) callback(comp)\n    })\n  }\n\n  /**\n   * Iterator over each representation and executing the callback\n   */\n  eachRepresentation (callback: (reprElem: RepresentationElement, comp: Component) => void, type?: string) {\n    this.eachComponent(comp => {\n      comp.reprList.slice().forEach(reprElem => {\n        if (type === undefined || type === reprElem.getType()) callback(reprElem, comp)\n      })\n    })\n  }\n\n  /**\n   * Get collection of components by name\n   */\n  getComponentsByName (name: string|RegExp) {\n    const compList: Component[] = []\n\n    this.eachComponent(comp => {\n      if (name === undefined || matchName(name, comp)) compList.push(comp)\n    })\n\n    return new ComponentCollection(compList)\n  }\n\n  /**\n   * Get collection of components by object\n   */\n  getComponentsByObject (object: Structure|Surface|Volume|Shape) {\n    const compList: Component[] = []\n\n    this.eachComponent(comp => {\n      if (comp.object === object) compList.push(comp)\n    })\n\n    return new ComponentCollection(compList)\n  }\n\n  /**\n   * Get collection of representations by name\n   */\n  getRepresentationsByName (name: string|RegExp) {\n    const reprList: RepresentationElement[] = []\n\n    this.eachRepresentation((repr, comp) => {\n      if (name === undefined || matchName(name, repr)) reprList.push(repr)\n    })\n\n    return new RepresentationCollection(reprList)\n  }\n\n  measureClear () {\n    this.eachComponent((sc: StructureComponent) => sc.measureClear(), 'structure')\n  }\n\n  measureUpdate () {\n    this.eachComponent((sc: StructureComponent) => sc.measureUpdate(), 'structure')\n  }\n\n  /**\n   * Cleanup when disposing of a stage object\n   */\n  dispose () {\n    this.tasks.dispose()\n    this.viewer.dispose()\n    this.mouseObserver.dispose()\n  }\n}\n\nexport default Stage\n","/**\n * @file Shape Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Shape from '../geometry/shape'\nimport { Vector3, Box3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type ShapeRepresentationType = 'buffer'\n\n/**\n * Component wrapping a {@link Shape} object\n *\n * @example\n * // get a shape component by adding a shape object to the stage\n * var shape = new NGL.Shape( \"shape\" );\n * shape.addSphere( [ 0, 0, 0 ], [ 1, 0, 0 ], 1.5 );\n * var shapeComponent = stage.addComponentFromObject( shape );\n * shapeComponent.addRepresentation( \"buffer\" );\n */\nclass ShapeComponent extends Component {\n  constructor (stage: Stage, readonly shape: Shape, params: Partial<ComponentParameters> = {}) {\n    super(stage, shape, Object.assign({ name: shape.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'shape' }\n\n  /**\n   * Add a new shape representation to the component\n   * @param {String} type - the name of the representation, one of:\n   *                        buffer.\n   * @param {BufferRepresentationParameters} params - representation parameters\n   * @return {RepresentationComponent} the created representation wrapped into\n   *                                   a representation component object\n   */\n  addRepresentation (type: ShapeRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.shape, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.shape.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.shape.center\n  }\n\n  dispose () {\n    this.shape.dispose()\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('shape', ShapeComponent)\n\nexport default ShapeComponent\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","/**\n * @file Atomindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\n/**\n * Color by atom index. The {@link AtomProxy.index} property is used for coloring.\n * Each {@link ModelProxy} of a {@link Structure} is colored seperately. The\n * `params.domain` parameter is ignored.\n *\n * __Name:__ _atomindex_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\", { colorScheme: \"atomindex\" } );\n *     o.autoView();\n * } );\n */\nclass AtomindexColormaker extends Colormaker {\n  scalePerModel: { [k: number]: ColormakerScale }\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n      this.parameters.reverse = defaults(params.reverse, true)\n    }\n\n    this.scalePerModel = {}\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      this.parameters.domain = [ mp.atomOffset, mp.atomEnd ]\n      this.scalePerModel[ mp.index ] = this.getScale()  // TODO\n    })\n  }\n\n  /**\n   * get color for an atom\n   * @param  {AtomProxy} atom - atom to get color for\n   * @return {Integer} hex atom color\n   */\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    return this.scalePerModel[ atom.modelIndex ](atom.index)\n  }\n}\n\nColormakerRegistry.add('atomindex', AtomindexColormaker)\n\nexport default AtomindexColormaker\n","/**\n * @file Bfactor Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Selection from '../selection/selection'\n\n/**\n * Color by b-factor. The {@link AtomProxy.bfactor} property is used for coloring.\n * By default the min and max b-factor values are used for the scale`s domain.\n *\n * __Name:__ _bfactor_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\", { colorScheme: \"bfactor\" } );\n *     o.autoView();\n * } );\n */\nclass BfactorColormaker extends Colormaker {\n  bfactorScale: ColormakerScale\n\n  constructor (params: { sele?: string } & StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'OrRd'\n    }\n\n    if (!params.domain) {\n      let selection\n      let min = Infinity\n      let max = -Infinity\n\n      if (params.sele) {\n        selection = new Selection(params.sele)\n      }\n\n      params.structure.eachAtom(function (a) {\n        const bfactor = a.bfactor\n        min = Math.min(min, bfactor)\n        max = Math.max(max, bfactor)\n      }, selection)\n\n      this.parameters.domain = [ min, max ]\n    }\n\n    this.bfactorScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.bfactorScale(a.bfactor)\n  }\n}\n\nColormakerRegistry.add('bfactor', BfactorColormaker)\n\nexport default BfactorColormaker\n","/**\n * @file Chainid Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ChainidDict = { [k: string]: number }\n\n/**\n * Color by chain id\n */\nclass ChainidColormaker extends Colormaker {\n  chainidDictPerModel: { [k: number]: ChainidDict } = {}\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      let i = 0\n      const chainidDict: ChainidDict = {}\n      mp.eachChain(function (cp: ChainProxy) {\n        if (chainidDict[ cp.chainid ] === undefined) {\n          chainidDict[ cp.chainid ] = i\n          i += 1\n        }\n      })\n      this.parameters.domain = [ 0, i - 1 ]\n      this.chainidDictPerModel[ mp.index ] = chainidDict\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const chainidDict = this.chainidDictPerModel[ a.modelIndex ]\n    return this.scalePerModel[ a.modelIndex ](chainidDict[ a.chainid ])\n  }\n}\n\nColormakerRegistry.add('chainid', ChainidColormaker)\n\nexport default ChainidColormaker\n","/**\n * @file Chainindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\n/**\n * Color by chain index\n */\nclass ChainindexColormaker extends Colormaker {\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      this.parameters.domain = [ mp.chainOffset, mp.chainEnd ]\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.scalePerModel[ a.modelIndex ](a.chainIndex)\n  }\n}\n\nColormakerRegistry.add('chainindex', ChainindexColormaker)\n\nexport default ChainindexColormaker\n","/**\n * @file Chainname Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ChainnameDict = { [k: string]: number }\n\n/**\n * Color by chain name\n */\nclass ChainnameColormaker extends Colormaker {\n  chainnameDictPerModel: { [k: number]: ChainnameDict } = {}\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      let i = 0\n      const chainnameDict: ChainnameDict = {}\n      mp.eachChain(function (cp: ChainProxy) {\n        if (chainnameDict[ cp.chainname ] === undefined) {\n          chainnameDict[ cp.chainname ] = i\n          i += 1\n        }\n      })\n      this.parameters.domain = [ 0, i - 1 ]\n      this.chainnameDictPerModel[ mp.index ] = chainnameDict\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const chainnameDict = this.chainnameDictPerModel[ a.modelIndex ]\n    return this.scalePerModel[ a.modelIndex ](chainnameDict[ a.chainname ])\n  }\n}\n\nColormakerRegistry.add('chainname', ChainnameColormaker)\n\nexport default ChainnameColormaker\n","/**\n * @file Densityfit Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by validation density fit\n */\nclass DensityfitColormaker extends Colormaker {\n  rsrzScale: ColormakerScale\n  rsccScale: ColormakerScale\n\n  rsrzDict: { [k: string]: number|undefined } = {}\n  rsccDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlBu'\n    }\n\n    this.rsrzScale = this.getScale({ domain: [ 2, 0 ] })\n    this.rsccScale = this.getScale({ domain: [ 0.678, 1.0 ] })\n\n    const val = params.structure.validation\n    if (val) {\n      this.rsrzDict = val.rsrzDict\n      this.rsccDict = val.rsccDict\n    }\n\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = atom.resno + ''\n    if (atom.inscode) sele += '^' + atom.inscode\n    if (atom.chainname) sele += ':' + atom.chainname\n    sele += '/' + atom.modelIndex\n\n    const rsrz = this.rsrzDict[ sele ]\n    if (rsrz !== undefined) {\n      return this.rsrzScale(rsrz)\n    }\n\n    const rscc = this.rsccDict[ sele ]\n    if (rscc !== undefined) {\n      return this.rsccScale(rscc)\n    }\n\n    return 0x909090\n  }\n}\n\nColormakerRegistry.add('densityfit', DensityfitColormaker)\n\nexport default DensityfitColormaker\n","/**\n * @file Atomindex Colormaker\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport SpatialHash from '../geometry/spatial-hash'\n\n// from CHARMM\nconst partialCharges: { [k: string]: { [k: string]: number } } = {\n  'ARG': {\n    'CD': 0.1,\n    'CZ': 0.5,\n    'NE': -0.1\n  },\n  'ASN': {\n    'CG': 0.55,\n    'OD1': -0.55\n  },\n  'ASP': {\n    'CB': -0.16,\n    'CG': 0.36,\n    'OD1': -0.6,\n    'OD2': -0.6\n  },\n  'CYS': {\n    'CB': 0.19,\n    'SG': -0.19\n  },\n  'GLN': {\n    'CD': 0.55,\n    'OE1': -0.55\n  },\n  'GLU': {\n    'CD': 0.36,\n    'CG': -0.16,\n    'OE1': -0.6,\n    'OE2': -0.6\n  },\n  'HIS': {\n    'CB': 0.1,\n    'CD2': 0.2,\n    'CE1': 0.45,\n    'CG': 0.15,\n    'ND1': 0.05,\n    'NE2': 0.05\n  },\n  'LYS': {\n    'CE': 0.25,\n    'NZ': 0.75\n  },\n  'MET': {\n    'CE': 0.06,\n    'CG': 0.06,\n    'SD': -0.12\n  },\n  'PTR': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CZ': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'OG1': -1.1,\n    'P': 1.4\n  },\n  'SEP': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CB': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'OG1': -1.1,\n    'P': 1.4\n  },\n  'SER': {\n    'CB': 0.25,\n    'OG': -0.25\n  },\n  'THR': {\n    'CB': 0.25,\n    'OG1': -0.25\n  },\n  'TPO': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CB': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'OG1': -1.1,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'P': 1.4\n  },\n  'TRP': {\n    'CD1': 0.06,\n    'CD2': 0.1,\n    'CE2': -0.04,\n    'CE3': -0.03,\n    'CG': -0.03,\n    'NE1': -0.06\n  },\n  'TYR': {\n    'CZ': 0.25,\n    'OH': -0.25\n  },\n  'backbone': {\n    'C': 0.55,\n    'O': -0.55,\n    'N': -0.35,\n    'CA': 0.1\n  }\n}\n\nconst maxRadius = 12.0\nconst nHBondDistance = 1.04\nconst nHCharge = 0.25\n\n/**\n * Populates position vector with location of implicit or explicit H\n * Returns position or undefined if not able to locate H\n *\n * @param {AtomProxy} ap - the nitrogen atom\n * @param {Vector3} [position] - optional target\n * @return {Vectors|undefined} the hydrogen atom position\n */\nfunction backboneNHPosition (ap: AtomProxy, position = new Vector3()) {\n  let h = false\n  let ca = false\n  let c = false\n  position.set(2 * ap.x, 2 * ap.y, 2 * ap.z)\n\n  ap.eachBondedAtom(function (a2: AtomProxy) {\n    // Any time we detect H, reset position and skip\n    // future tests\n    if (h) return\n    if (a2.atomname === 'H') {\n      position.set(a2.x, a2.y, a2.z)\n      h = true\n      return\n    }\n    if (!ca && a2.atomname === 'CA') {\n      position.sub(a2 as any)  // TODO\n      ca = true\n    } else if (!c && a2.atomname === 'C') {\n      c = true\n      position.sub(a2 as any)  // TODO\n    }\n  })\n\n  if (h) { return position }\n\n  if (ca && c) {\n    position.normalize()\n    position.multiplyScalar(nHBondDistance)\n    position.add(ap as any)\n    return position\n  }\n}\n\n/**\n * Takes an array of Vector3 objects and\n * converts to an object that looks like an AtomStore\n *\n * @param {Vector3[]} positions - array of positions\n * @return {Object} AtomStore-like object\n */\nfunction buildStoreLike (positions: Vector3[]) {\n  const n = positions.length\n  const x = new Float32Array(n)\n  const y = new Float32Array(n)\n  const z = new Float32Array(n)\n\n  for (let i = 0; i < positions.length; i++) {\n    const v = positions[ i ]\n    x[ i ] = v.x\n    y[ i ] = v.y\n    z[ i ] = v.z\n  }\n\n  return { x: x, y: y, z: z, count: n }\n}\n\nfunction chargeForAtom (a: AtomProxy): number {\n  if (a.partialCharge !== null) return a.partialCharge\n  if (!a.isProtein()) { return 0.0 }\n  return (\n    (partialCharges[ a.resname ] &&\n        partialCharges[ a.resname ][ a.atomname ]) ||\n    partialCharges[ 'backbone' ][ a.atomname ] || 0.0\n  )\n}\n\n/**\n * Color a surface by electrostatic charge. This is a highly approximate\n * calculation! The partial charges are CHARMM with hydrogens added to heavy\n * atoms and hydrogen positions generated for amides.\n *\n * __Name:__ _electrostatic_\n *\n * @example\n * stage.loadFile( \"rcsb://3dqb\" ).then( function( o ){\n *     o.addRepresentation( \"surface\", { colorScheme: \"electrostatic\" } );\n *     o.autoView();\n * } );\n */\nclass ElectrostaticColormaker extends Colormaker {\n  scale: ColormakerScale\n  hHash: SpatialHash\n  hash: SpatialHash\n  charges: Float32Array\n  hStore: { x: Float32Array, y: Float32Array, z: Float32Array, count: number }\n  atomProxy: AtomProxy\n\n  delta = new Vector3()\n  hCharges: number[] = []\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ -50, 50 ]\n    }\n\n    this.scale = this.getScale()\n\n    this.charges = new Float32Array(params.structure.atomCount)\n    const hPositions: Vector3[] = []\n\n    params.structure.eachAtom((ap: AtomProxy) => {\n      this.charges[ ap.index ] = chargeForAtom(ap) * ap.occupancy\n      if (ap.atomname === 'N') {\n\n        // In the specific case where N forms two bonds to\n        // CA and C, try and place a dummy hydrogen\n\n        if (ap.bondCount >= 3) return; // Skip if 3 bonds already (e.g. PRO)\n\n        if (ap.bondToElementCount(1)) return; // Skip if any H specificed\n\n        const hPos = backboneNHPosition(ap)\n        if (hPos !== undefined) {\n          hPositions.push(hPos)\n          this.hCharges.push(nHCharge * ap.occupancy)\n        }\n      }\n    })\n\n    const bbox = params.structure.getBoundingBox()\n    bbox.expandByScalar(nHBondDistance) // Worst case\n\n    // SpatialHash requires x,y,z and count\n    this.hStore = buildStoreLike(hPositions)\n    this.hHash = new SpatialHash(this.hStore as any, bbox)  // TODO\n    this.hash = new SpatialHash(params.structure.atomStore, bbox)\n  }\n\n  @manageColor\n  positionColor (v: Vector3) {\n\n    const charges = this.charges\n    const hCharges = this.hCharges\n\n    let p = 0.0\n    this.hash.eachWithin(v.x, v.y, v.z, maxRadius, (atomIndex, dSq) => {\n      const charge = charges[atomIndex]\n      if (charge === 0.0) return\n      p += charge / dSq\n    })\n\n    this.hHash.eachWithin(v.x, v.y, v.z, maxRadius, (atomIndex, dSq) => {\n      const charge = hCharges[atomIndex]\n      if (charge === 0.0) return\n      p += charge / dSq\n    })\n\n    return this.scale(p * 332) // 332 to convert to kcal/mol\n  }\n}\n\nColormakerRegistry.add('electrostatic', ElectrostaticColormaker)\n\nexport default ElectrostaticColormaker\n","/**\n * @file Element Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { ColormakerParameters, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// from Jmol http://jmol.sourceforge.net/jscolors/ (or 0xFFFFFF)\nconst ElementColors: { [k: string]: number } = {\n  'H': 0xFFFFFF,\n  'HE': 0xD9FFFF,\n  'LI': 0xCC80FF,\n  'BE': 0xC2FF00,\n  'B': 0xFFB5B5,\n  'C': 0x909090,\n  'N': 0x3050F8,\n  'O': 0xFF0D0D,\n  'F': 0x90E050,\n  'NE': 0xB3E3F5,\n  'NA': 0xAB5CF2,\n  'MG': 0x8AFF00,\n  'AL': 0xBFA6A6,\n  'SI': 0xF0C8A0,\n  'P': 0xFF8000,\n  'S': 0xFFFF30,\n  'CL': 0x1FF01F,\n  'AR': 0x80D1E3,\n  'K': 0x8F40D4,\n  'CA': 0x3DFF00,\n  'SC': 0xE6E6E6,\n  'TI': 0xBFC2C7,\n  'V': 0xA6A6AB,\n  'CR': 0x8A99C7,\n  'MN': 0x9C7AC7,\n  'FE': 0xE06633,\n  'CO': 0xF090A0,\n  'NI': 0x50D050,\n  'CU': 0xC88033,\n  'ZN': 0x7D80B0,\n  'GA': 0xC28F8F,\n  'GE': 0x668F8F,\n  'AS': 0xBD80E3,\n  'SE': 0xFFA100,\n  'BR': 0xA62929,\n  'KR': 0x5CB8D1,\n  'RB': 0x702EB0,\n  'SR': 0x00FF00,\n  'Y': 0x94FFFF,\n  'ZR': 0x94E0E0,\n  'NB': 0x73C2C9,\n  'MO': 0x54B5B5,\n  'TC': 0x3B9E9E,\n  'RU': 0x248F8F,\n  'RH': 0x0A7D8C,\n  'PD': 0x006985,\n  'AG': 0xC0C0C0,\n  'CD': 0xFFD98F,\n  'IN': 0xA67573,\n  'SN': 0x668080,\n  'SB': 0x9E63B5,\n  'TE': 0xD47A00,\n  'I': 0x940094,\n  'XE': 0x940094,\n  'CS': 0x57178F,\n  'BA': 0x00C900,\n  'LA': 0x70D4FF,\n  'CE': 0xFFFFC7,\n  'PR': 0xD9FFC7,\n  'ND': 0xC7FFC7,\n  'PM': 0xA3FFC7,\n  'SM': 0x8FFFC7,\n  'EU': 0x61FFC7,\n  'GD': 0x45FFC7,\n  'TB': 0x30FFC7,\n  'DY': 0x1FFFC7,\n  'HO': 0x00FF9C,\n  'ER': 0x00E675,\n  'TM': 0x00D452,\n  'YB': 0x00BF38,\n  'LU': 0x00AB24,\n  'HF': 0x4DC2FF,\n  'TA': 0x4DA6FF,\n  'W': 0x2194D6,\n  'RE': 0x267DAB,\n  'OS': 0x266696,\n  'IR': 0x175487,\n  'PT': 0xD0D0E0,\n  'AU': 0xFFD123,\n  'HG': 0xB8B8D0,\n  'TL': 0xA6544D,\n  'PB': 0x575961,\n  'BI': 0x9E4FB5,\n  'PO': 0xAB5C00,\n  'AT': 0x754F45,\n  'RN': 0x428296,\n  'FR': 0x420066,\n  'RA': 0x007D00,\n  'AC': 0x70ABFA,\n  'TH': 0x00BAFF,\n  'PA': 0x00A1FF,\n  'U': 0x008FFF,\n  'NP': 0x0080FF,\n  'PU': 0x006BFF,\n  'AM': 0x545CF2,\n  'CM': 0x785CE3,\n  'BK': 0x8A4FE3,\n  'CF': 0xA136D4,\n  'ES': 0xB31FD4,\n  'FM': 0xB31FBA,\n  'MD': 0xB30DA6,\n  'NO': 0xBD0D87,\n  'LR': 0xC70066,\n  'RF': 0xCC0059,\n  'DB': 0xD1004F,\n  'SG': 0xD90045,\n  'BH': 0xE00038,\n  'HS': 0xE6002E,\n  'MT': 0xEB0026,\n  'DS': 0xFFFFFF,\n  'RG': 0xFFFFFF,\n  'CN': 0xFFFFFF,\n  'UUT': 0xFFFFFF,\n  'FL': 0xFFFFFF,\n  'UUP': 0xFFFFFF,\n  'LV': 0xFFFFFF,\n  'UUH': 0xFFFFFF,\n\n  'D': 0xFFFFC0,\n  'T': 0xFFFFA0\n}\nconst DefaultElementColor = 0xFFFFFF\n\n/**\n * Color by element\n */\nclass ElementColormaker extends Colormaker {\n  constructor (params: ColormakerParameters) {\n    params.value = defaults(params.value, ElementColors.C)\n\n    super(params)\n  }\n\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const element = a.element\n\n    if (element === 'C') {\n      return this.parameters.value\n    } else {\n      return ElementColors[ element ] || DefaultElementColor\n    }\n  }\n}\n\nColormakerRegistry.add('element', ElementColormaker)\n\nexport default ElementColormaker\n","/**\n * @file Entityindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by entity index\n */\nclass EntityindexColormaker extends Colormaker {\n  entityindexScale: ColormakerScale\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ 0, params.structure.entityList.length - 1 ]\n    }\n\n    this.entityindexScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.entityindexScale(a.entityIndex)\n  }\n}\n\nColormakerRegistry.add('entityindex', EntityindexColormaker)\n\nexport default EntityindexColormaker\n","/**\n * @file Entitytype Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    PolymerEntity, NonPolymerEntity, MacrolideEntity, WaterEntity\n} from '../structure/structure-constants'\n\n/**\n * Color by entity type\n */\nclass EntitytypeColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const e = a.entity\n    const et = e ? e.entityType : undefined\n    switch (et) {\n      case PolymerEntity:\n        return 0x7fc97f\n      case NonPolymerEntity:\n        return 0xfdc086\n      case MacrolideEntity:\n        return 0xbeaed4\n      case WaterEntity:\n        return 0x386cb0\n      default:\n        return 0xffff99\n    }\n  }\n}\n\nColormakerRegistry.add('entitytype', EntitytypeColormaker)\n\nexport default EntitytypeColormaker\n","/**\n * @file Geoquality Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { countSetBits } from '../math/math-utils'\n\n/**\n * Color by validation gometry quality\n */\nclass GeoqualityColormaker extends Colormaker {\n  geoAtomDict: { [k: string]: { [k: string]: number } } = {}\n  geoDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    const val = params.structure.validation\n    if (val) {\n      this.geoAtomDict = val.geoAtomDict\n      this.geoDict = val.geoDict\n    }\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = atom.resno + ''\n    if (atom.inscode) sele += '^' + atom.inscode\n    if (atom.chainname) sele += ':' + atom.chainname\n    sele += '/' + atom.modelIndex\n\n    let geoProblemCount\n    const geoAtom = this.geoAtomDict[ sele ]\n    if (geoAtom !== undefined) {\n      const atomProblems: number = geoAtom[ atom.atomname ] || 0\n      geoProblemCount = countSetBits(atomProblems)\n    } else {\n      geoProblemCount = this.geoDict[ sele ] || 0\n    }\n\n    if (geoProblemCount === 0) {\n      return 0x2166ac\n    } else if (geoProblemCount === 1) {\n      return 0xfee08b\n    } else if (geoProblemCount === 2) {\n      return 0xf46d43\n    } else if (geoProblemCount >= 3) {\n      return 0xa50026\n    }\n    return 0x909090\n  }\n}\n\nColormakerRegistry.add('geoquality', GeoqualityColormaker)\n\nexport default GeoqualityColormaker\n","/**\n * @file Hydrophobicity Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    ResidueHydrophobicity, DefaultResidueHydrophobicity\n} from '../structure/structure-constants'\n\n/**\n * Color by hydrophobicity\n */\nclass HydrophobicityColormaker extends Colormaker {\n  hfScale: ColormakerScale\n  resHF: { [k: string]: number } = {}\n  defaultResidueHydrophobicity: number\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlGn'\n    }\n\n    const idx = 0  // 0: DGwif, 1: DGwoct, 2: Oct-IF\n\n    for (const name in ResidueHydrophobicity) {\n      this.resHF[ name ] = ResidueHydrophobicity[ name ][ idx ]\n    }\n    this.defaultResidueHydrophobicity = DefaultResidueHydrophobicity[idx]\n\n    if (!params.domain) {\n      let min = Infinity\n      let max = -Infinity\n\n      for (const name in this.resHF) {\n        const val = this.resHF[ name ]\n        min = Math.min(min, val)\n        max = Math.max(max, val)\n      }\n\n      this.parameters.domain = [ min, 0, max ]\n    }\n\n    this.hfScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.hfScale(this.resHF[ a.resname ] || this.defaultResidueHydrophobicity)\n  }\n}\n\nColormakerRegistry.add('hydrophobicity', HydrophobicityColormaker)\n\nexport default HydrophobicityColormaker\n","/**\n * @file Modelindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by model index\n */\nclass ModelindexColormaker extends Colormaker {\n  modelindexScale: ColormakerScale\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ 0, params.structure.modelStore.count ]\n    }\n\n    this.modelindexScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.modelindexScale(a.modelIndex)\n  }\n}\n\nColormakerRegistry.add('modelindex', ModelindexColormaker)\n\nexport default ModelindexColormaker\n","/**\n * @file Moleculetype Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    WaterType, IonType, ProteinType, RnaType, DnaType, SaccharideType\n} from '../structure/structure-constants'\n\n/**\n * Color by molecule type\n */\nclass MoleculetypeColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    switch (a.residueType.moleculeType) {\n      case WaterType:\n        return 0x386cb0\n      case IonType:\n        return 0xf0027f\n      case ProteinType:\n        return 0xbeaed4\n      case RnaType:\n        return 0xfdc086\n      case DnaType:\n        return 0xbf5b17\n      case SaccharideType:\n        return 0x7fc97f\n      default:\n        return 0xffff99\n    }\n  }\n}\n\nColormakerRegistry.add('moleculetype', MoleculetypeColormaker)\n\nexport default MoleculetypeColormaker\n","/**\n * @file Occupancy Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by occupancy\n */\nclass OccupancyColormaker extends Colormaker {\n  occupancyScale: ColormakerScale\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'PuBu'\n    }\n\n    if (!params.domain) {\n      this.parameters.domain = [ 0.0, 1.0 ]\n    }\n\n    this.occupancyScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.occupancyScale(a.occupancy)\n  }\n}\n\nColormakerRegistry.add('occupancy', OccupancyColormaker)\n\nexport default OccupancyColormaker\n","/**\n * @file Partialcharge Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by partial charge. The {@link AtomProxy.partialCharge} property is used for coloring.\n * The default domain is [-1, 1].\n *\n * __Name:__ _partialCharge_\n *\n * @example\n * stage.loadFile(\"rcsb://1crn\").then(function (o) {\n *   o.addRepresentation(\"ball+stick\", {colorScheme: \"partialCharge\"});\n *   o.autoView();\n * });\n */\nclass PartialchargeColormaker extends Colormaker {\n  partialchargeScale: ColormakerScale\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n\n    if (!params.domain) {\n      this.parameters.domain = [-1, 1]\n    }\n\n    this.partialchargeScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.partialchargeScale(a.partialCharge || 0)\n  }\n}\n\nColormakerRegistry.add('partialcharge', PartialchargeColormaker)\n\nexport default PartialchargeColormaker\n","/**\n * @file Random Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\n\nfunction randomColor () {\n  return Math.random() * 0xFFFFFF\n}\n\n/**\n * Class by random color\n */\nclass RandomColormaker extends Colormaker {\n  /**\n   * get color for an atom\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  atomColor () {\n    return randomColor()\n  }\n\n  /**\n   * get color for volume cell\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  volumeColor () {\n    return randomColor()\n  }\n\n  /**\n   * get color for coordinates in space\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  positionColor () {\n    return randomColor()\n  }\n}\n\nColormakerRegistry.add('random', RandomColormaker)\n\nexport default RandomColormaker\n","/**\n * @file Randomcoilindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by random coil index\n */\nclass RandomcoilindexColormaker extends Colormaker {\n  rciScale: ColormakerScale\n  rciDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlBu'\n    }\n\n    this.rciScale = this.getScale({ domain: [ 0.6, 0 ] })\n\n    const val = params.structure.validation\n    if (val) this.rciDict = val.rciDict\n\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = `[${atom.resname}]${atom.resno}`\n    if (atom.chainname) sele += ':' + atom.chainname\n\n    const rci = this.rciDict[ sele ]\n    return rci !== undefined ? this.rciScale(rci) : 0x909090\n  }\n}\n\nColormakerRegistry.add('randomcoilindex', RandomcoilindexColormaker)\n\nexport default RandomcoilindexColormaker\n","/**\n * @file Residueindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\n\n/**\n * Color by residue index\n */\nclass ResidueindexColormaker extends Colormaker {\n  scalePerChain: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n      this.parameters.reverse = defaults(params.reverse, true)\n    }\n\n    params.structure.eachChain((cp: ChainProxy) => {\n      this.parameters.domain = [ cp.residueOffset, cp.residueEnd ]\n      this.scalePerChain[ cp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.scalePerChain[ a.chainIndex ](a.residueIndex)\n  }\n}\n\nColormakerRegistry.add('residueindex', ResidueindexColormaker)\n\nexport default ResidueindexColormaker\n","/**\n * @file Resname Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// protein colors from Jmol http://jmol.sourceforge.net/jscolors/\nconst ResidueColors: { [k: string]: number } = {\n  'ALA': 0x8CFF8C,\n  'ARG': 0x00007C,\n  'ASN': 0xFF7C70,\n  'ASP': 0xA00042,\n  'CYS': 0xFFFF70,\n  'GLN': 0xFF4C4C,\n  'GLU': 0x660000,\n  'GLY': 0xFFFFFF,\n  'HIS': 0x7070FF,\n  'ILE': 0x004C00,\n  'LEU': 0x455E45,\n  'LYS': 0x4747B8,\n  'MET': 0xB8A042,\n  'PHE': 0x534C52,\n  'PRO': 0x525252,\n  'SER': 0xFF7042,\n  'THR': 0xB84C00,\n  'TRP': 0x4F4600,\n  'TYR': 0x8C704C,\n  'VAL': 0xFF8CFF,\n\n  'ASX': 0xFF00FF,\n  'GLX': 0xFF00FF,\n  'ASH': 0xFF00FF,\n  'GLH': 0xFF00FF,\n\n  'A': 0xDC143C,  // Crimson Red\n  'G': 0x32CD32,  // Lime Green\n  'I': 0x9ACD32,  // Yellow Green\n  'X': 0x7CFC00,  // Lawn Green\n  'C': 0xFFD700,  // Gold Yellow\n  'T': 0x4169E1,  // Royal Blue\n  'U': 0x40E0D0,  // Turquoise Cyan\n  'D': 0x008B8B,  // Dark Cyan\n\n  'DA': 0xDC143C,\n  'DG': 0x32CD32,\n  'DI': 0x9ACD32,\n  'DX': 0x7CFC00,\n  'DC': 0xFFD700,\n  'DT': 0x4169E1,\n  'DU': 0x40E0D0,\n  'DD': 0x008B8B\n}\nconst DefaultResidueColor = 0xFF00FF\n\n/**\n * Color by residue name\n */\nclass ResnameColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return ResidueColors[ a.resname ] || DefaultResidueColor\n  }\n}\n\nColormakerRegistry.add('resname', ResnameColormaker)\n\nexport default ResnameColormaker\n","/**\n * @file Sstruc Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\n\n// from Jmol http://jmol.sourceforge.net/jscolors/ (shapely)\nconst StructureColors = {\n  'alphaHelix': 0xFF0080,\n  'threeTenHelix': 0xA00080,\n  'piHelix': 0x600080,\n  'betaStrand': 0xFFC800,\n  'betaTurn': 0x6080FF,\n  'coil': 0xFFFFFF,\n\n  'dna': 0xAE00FE,\n  'rna': 0xFD0162,\n\n  'carbohydrate': 0xA6A6FA\n}\nconst DefaultStructureColor = 0x808080\n\n/**\n * Color by secondary structure\n */\nclass SstrucColormaker extends Colormaker {\n  residueProxy: ResidueProxy\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    this.residueProxy = params.structure.getResidueProxy()\n  }\n\n  @manageColor\n  atomColor (ap: AtomProxy) {\n    const sstruc = ap.sstruc\n    const rp = this.residueProxy\n\n    if (sstruc === 'h') {\n      return StructureColors.alphaHelix\n    } else if (sstruc === 'g') {\n      return StructureColors.threeTenHelix\n    } else if (sstruc === 'i') {\n      return StructureColors.piHelix\n    } else if (sstruc === 'e' || sstruc === 'b') {\n      return StructureColors.betaStrand\n    } else if (sstruc === 't') {\n      return StructureColors.betaTurn\n    } else {\n      rp.index = ap.residueIndex\n      if (rp.isDna()) {\n        return StructureColors.dna\n      } else if (rp.isRna()) {\n        return StructureColors.rna\n      } else if (rp.isSaccharide()) {\n        return StructureColors.carbohydrate\n      } else if (rp.isProtein() || sstruc === 's' || sstruc === 'l') {\n        return StructureColors.coil\n      } else {\n        return DefaultStructureColor\n      }\n    }\n  }\n}\n\nColormakerRegistry.add('sstruc', SstrucColormaker)\n\nexport default SstrucColormaker\n","/**\n * @file Colordata Colormaker\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColorData, ColormakerScale, manageColor, StuctureColormakerParams } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\n\nclass StructuredataColormaker extends Colormaker {\n  atomData?: ColorData['atomData']\n  bondData?: ColorData['bondData']\n  scale: ColormakerScale\n\n  constructor(params: StuctureColormakerParams) {\n    super(params)\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n    this.atomData = this.parameters.data?.atomData\n    this.bondData = this.parameters.data?.bondData\n    this.scale = this.getScale(this.parameters)\n  }\n\n  @manageColor\n  atomColor(a: AtomProxy) {\n    const val = this.atomData?.[a.index]\n    return  (val !== undefined) ? this.scale(val) : this.parameters.value\n  }\n\n  @manageColor\n  bondColor(bond: BondProxy, fromTo: boolean) {\n      const val = this.bondData?.[bond.index]\n      \n      // Explicit bond data?\n      if (val !== undefined) return this.scale(val)\n      \n      \n      if (this.atomProxy) {\n        this.atomProxy.index = fromTo ? bond.atomIndex1 : bond.atomIndex2\n        return this.atomColor(this.atomProxy)\n      } \n      \n      // Fallback\n      return this.parameters.value\n  }\n}\n\nColormakerRegistry.add('structuredata', StructuredataColormaker)\n\nexport default StructuredataColormaker","/**\n * @file Uniform Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\n\n/**\n * Color by uniform color\n */\nclass UniformColormaker extends Colormaker {\n  @manageColor\n  atomColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  bondColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  valueColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  volumeColor () {\n    return this.parameters.value\n  }\n}\n\nColormakerRegistry.add('uniform', UniformColormaker)\n\nexport default UniformColormaker\n","/**\n * @file Value Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { VolumeColormakerParams, ColormakerScale, manageColor } from './colormaker'\n\n/**\n * Color by volume value\n */\nclass ValueColormaker extends Colormaker {\n  valueScale: ColormakerScale\n\n  constructor (params: VolumeColormakerParams) {\n    super(params)\n    this.valueScale = this.getScale()\n  }\n\n  /**\n   * return the color for a volume cell\n   * @param  {Integer} index - volume cell index\n   * @return {Integer} hex cell color\n   */\n  @manageColor\n  volumeColor (index: number) {\n    return this.valueScale((this.parameters.volume! as any).data[ index ])  // TODO\n  }\n}\n\nColormakerRegistry.add('value', ValueColormaker)\n\nexport default ValueColormaker\n","/**\n * @file Volume Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\nimport { lerp } from '../math/math-utils'\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { VolumeColormakerParams, ColormakerScale, manageColor } from './colormaker'\n\n/**\n * Color by volume position\n */\nclass VolumeColormaker extends Colormaker {\n  valueScale: ColormakerScale\n  vec = new Vector3()\n\n  constructor (params: VolumeColormakerParams) {\n    super(params)\n    this.valueScale = this.getScale()\n  }\n\n  /**\n   * return the color for coordinates in space\n   * @param  {Vector3} coords - xyz coordinates\n   * @return {Integer} hex coords color\n   */\n  @manageColor\n  positionColor (coords: Vector3) {\n    const volume = this.parameters.volume as any  // TODO\n\n    if (!volume || !volume.inverseMatrix) {\n      return this.parameters.value\n    }\n\n    const vec = this.vec\n    const data = volume.data\n    const nx = volume.nx\n    const ny = volume.ny\n    const nxy = nx * ny\n\n    vec.copy(coords)\n    vec.applyMatrix4(volume.inverseMatrix)\n\n    // position of grid cell\n    const x0 = Math.floor(vec.x)\n    const y0 = Math.floor(vec.y)\n    const z0 = Math.floor(vec.z)\n\n    // Indices\n    const i = ((((z0 * ny) + y0) * nx) + x0)\n    const i1 = i + 1\n    const iy = i + nx\n    const iz = i + nxy\n    const i1y = iy + 1\n    const i1z = iz + 1\n    const iyz = iy + nxy\n    const i1yz = iyz + 1\n\n    // Values\n    const v = data[ i ]\n    const v1 = data[ i1 ]\n    const vy = data[ iy ]\n    const vz = data[ iz ]\n    const v1y = data[ i1y ]\n    const v1z = data[ i1z ]\n    const vyz = data[ iyz ]\n    const v1yz = data[ i1yz ]\n\n    // Position of point in fraction of grid\n    const xd = vec.x - x0\n    const yd = vec.y - y0\n    const zd = vec.z - z0\n\n    // 1st Dimension\n    const c00 = lerp(v, v1, xd)\n    const c01 = lerp(vz, v1z, xd)\n    const c10 = lerp(vy, v1y, xd)\n    const c11 = lerp(vyz, v1yz, xd)\n\n    // 2nd Dimension\n    const c0 = lerp(c00, c10, yd)\n    const c1 = lerp(c01, c11, yd)\n\n    // 3rd Dimension\n    const c = lerp(c0, c1, zd)\n\n    return this.valueScale(c)\n  }\n}\n\nColormakerRegistry.add('volume', VolumeColormaker)\n\nexport default VolumeColormaker\n","/**\n * @file Structure Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ExtensionFragDepth, Mobile } from '../globals'\nimport { defaults } from '../utils'\nimport { RepresentationParameters, default as Representation } from './representation'\nimport Selection from '../selection/selection'\nimport RadiusFactory, { RadiusFactoryTypes, RadiusType } from '../utils/radius-factory'\nimport Structure from '../structure/structure'\nimport Viewer from '../viewer/viewer'\n// @ts-ignore: unused import Volume required for declaration only\nimport { Assembly, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport AtomProxy from '../proxy/atom-proxy';\nimport Polymer from '../proxy/polymer';\nimport Buffer from '../buffer/buffer';\nimport { AtomDataFields, BondDataFields, AtomDataParams, BondDataParams } from '../structure/structure-data';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface'\n\n/**\n * Structure representation parameter object.\n * @typedef {Object} StructureRepresentationParameters - structure representation parameters\n * @mixes RepresentationParameters\n *\n * @property {String} radiusType - A list of possible sources of the radius used for rendering the representation. The radius can be based on the *vdW radius*, the *covalent radius* or the *B-factor* value of the corresponding atom. Additionally the radius can be based on the *secondary structure*. Alternatively, when set to *size*, the value from the *radius* parameter is used for all atoms.\n * @property {Float} radius - A number providing a fixed radius used for rendering the representation.\n * @property {Float} scale - A number that scales the value defined by the *radius* or the *radiusType* parameter.\n * @property {String} assembly - name of an assembly object. Included are the asymmetric unit (*AU*) corresponding to the coordinates given in the structure file, biological assemblies from *PDB*, *mmCIF* or *MMTF* files (*BU1*, *BU2*, ...), a filled (crystallographic) unitcell of a given space group (*UNITCELL*), a supercell consisting of a center unitcell and its 26 direct neighbors (*SUPERCELL*). Set to *default* to use the default asemmbly of the structure object.\n */\nexport interface StructureRepresentationParameters extends RepresentationParameters {\n  radiusType: string\n  radius: number\n  scale: number\n  assembly: string\n}\nexport interface StructureRepresentationData {\n  bufferList: Buffer[]\n  polymerList?: Polymer[]\n  sview?: StructureView | Structure\n  [k: string]: any\n}\n/**\n * Structure representation\n * @interface\n */\nabstract class StructureRepresentation extends Representation {\n\n  protected selection: Selection\n  protected dataList: StructureRepresentationData[]\n  structure: Structure\n  structureView: StructureView\n\n  protected radiusType: RadiusType\n  protected radiusData: {[k: number]: number}\n  protected radiusSize: number\n  protected radiusScale: number\n  protected assembly: string\n  protected defaultAssembly: string\n  protected needsBuild: boolean\n\n  /**\n   * Create Structure representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {StructureRepresentationParameters} params - structure representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n\n    super(structure, viewer, p)\n\n    this.type = 'structure'\n\n    this.parameters = Object.assign({\n      radiusType: {\n        type: 'select', options: RadiusFactory.types\n      },\n      radiusData: {\n        type: 'hidden'\n      },\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      radiusScale: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      assembly: null,\n      defaultAssembly: {\n        type: 'hidden'\n      }\n    }, this.parameters)\n\n    /**\n     * @type {Selection}\n     * @private\n     */\n    this.selection = new Selection(p.sele)\n\n    /**\n     * @type {Array}\n     * @private\n     */\n    this.dataList = []\n\n    /**\n     * @type {Structure}\n     */\n    this.structure = structure\n\n    /**\n     * @type {StructureView}\n     */\n    this.structureView = this.structure.getView(this.selection)\n\n    if (structure.biomolDict) {\n      const biomolOptions:{[key: string]: string} = {\n        'default': 'default',\n        '': (structure.unitcell ? 'AU' : 'FULL')\n      }\n      Object.keys(structure.biomolDict).forEach(function (k) {\n        biomolOptions[ k ] = k\n      })\n      this.parameters.assembly = {\n        type: 'select',\n        options: biomolOptions,\n        rebuild: true\n      }\n    } else {\n      this.parameters.assembly = null\n    }\n  }\n\n  get defaultScale () {\n    return {\n      'vdw': 1.0,\n      'covalent': 1.0,\n      'bfactor': 0.01,\n      'sstruc': 1.0\n    }\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'element')\n\n    this.setRadius(p.radius, p)\n\n    this.radiusType = defaults(p.radiusType, 'vdw')\n    this.radiusData = defaults(p.radiusData, {})\n    this.radiusSize = defaults(p.radiusSize, 1.0)\n    this.radiusScale = defaults(p.radiusScale, 1.0)\n    this.assembly = defaults(p.assembly, 'default')\n    this.defaultAssembly = defaults(p.defaultAssembly, '')\n\n    if (p.quality === 'auto') {\n      p.quality = this.getQuality()\n    }\n\n    super.init(p)\n\n    this.selection.signals.stringChanged.add((/* sele */) => {\n      this.build()\n    })\n\n    this.build()\n  }\n\n  setRadius (value: string | number | undefined, p: Partial<StructureRepresentationParameters>) {\n    const types = Object.keys(RadiusFactoryTypes)\n\n    if (typeof value === 'string' && types.includes(value.toLowerCase())) {\n      p.radiusType = value\n    } else if (value !== undefined) {\n      p.radiusType = 'size'\n      p.radiusSize = value\n    }\n\n    return this\n  }\n\n  getAssembly (): Assembly {\n    const name = this.assembly === 'default' ? this.defaultAssembly : this.assembly\n    return this.structure.biomolDict[ name ]\n  }\n\n  getQuality () {\n    let atomCount\n    const s = this.structureView\n    const assembly = this.getAssembly()\n    if (assembly) {\n      atomCount = assembly.getAtomCount(s)\n    } else {\n      atomCount = s.atomCount\n    }\n    if (Mobile) {\n      atomCount *= 4\n    }\n    const backboneOnly = s.atomStore.count / s.residueStore.count < 2\n    if (backboneOnly) {\n      atomCount *= 10\n    }\n\n    if (atomCount < 15000) {\n      return 'high'\n    } else if (atomCount < 80000) {\n      return 'medium'\n    } else {\n      return 'low'\n    }\n  }\n\n  create () {\n    if (this.structureView.atomCount === 0) return\n\n    if (!this.structureView.hasCoords()) {\n      this.needsBuild = true\n      return\n    } else {\n      this.needsBuild = false\n    }\n\n    const assembly = this.getAssembly()\n\n    if (assembly) {\n      assembly.partList.forEach((part, i) => {\n        const sview = <StructureView>part.getView(this.structureView)\n        if (sview.atomCount === 0) return\n        const data = this.createData(sview, i)\n        if (data) {\n          data.sview = sview\n          data.instanceList = part.getInstanceList()\n          this.dataList.push(data)\n        }\n      })\n    } else {\n      const data = this.createData(this.structureView, 0)\n      if (data) {\n        data.sview = this.structureView\n        this.dataList.push(data)\n      }\n    }\n  }\n\n  abstract createData (sview: StructureView, k?: number): StructureRepresentationData|undefined\n\n  update (what: AtomDataFields|BondDataFields) {\n    if (this.lazy && !this.visible) {\n      Object.assign(this.lazyProps.what, what)\n      return\n    }\n\n    if (this.needsBuild) {\n      this.build()\n      return\n    }\n\n    this.dataList.forEach((data) => {\n      if (data.bufferList.length > 0) {\n        this.updateData(what, data)\n      }\n    }, this)\n  }\n\n  updateData (what?: AtomDataFields|BondDataFields, data?: any) {\n    this.build()\n  }\n\n  getColorParams () {\n    return {\n      ...super.getColorParams(),\n      structure: this.structure\n    }\n  }\n\n  getRadiusParams (param?: any) {\n    return {\n      type: this.radiusType,\n      scale: this.radiusScale,\n      size: this.radiusSize,\n      data: this.radiusData\n    }\n  }\n\n  getAtomParams (what?: AtomDataFields, params?: AtomDataParams) {\n    return Object.assign({\n      what: what,\n      colorParams: this.getColorParams(),\n      radiusParams: this.getRadiusParams()\n    }, params)\n  }\n\n  getBondParams (what?: BondDataFields, params?: BondDataParams) {\n    return Object.assign({\n      what: what,\n      colorParams: this.getColorParams(),\n      radiusParams: this.getRadiusParams()\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    if (this.structureView.atomSet!.isSet(atom.index)) {\n      const radiusFactory = new RadiusFactory(this.getRadiusParams())\n      return radiusFactory.atomRadius(atom)\n    }\n    return 0\n  }\n\n  /**\n   * Set representation parameters\n   * @alias StructureRepresentation#setSelection\n   * @param {String} string - selection string, see {@tutorial selection-language}\n   * @param {Boolean} [silent] - don't trigger a change event in the selection\n   * @return {StructureRepresentation} this object\n   */\n  setSelection (string: string, silent?: boolean) {\n    this.selection.setString(string, silent)\n\n    return this\n  }\n\n  /**\n   * Set representation parameters\n   * @alias StructureRepresentation#setParameters\n   * @param {StructureRepresentationParameters} params - structure parameter object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {StructureRepresentation} this object\n   */\n  setParameters (params: Partial<StructureRepresentationParameters>, what: AtomDataFields = {}, rebuild = false) {\n    const p = params || {}\n\n    this.setRadius(p.radius, p)\n\n    if (p.radiusType !== undefined || p.radiusData !== undefined || p.radiusSize !== undefined || p.radiusScale !== undefined) {\n      what.radius = true\n      if (!ExtensionFragDepth || this.disableImpostor) {\n        rebuild = true\n      }\n    }\n\n    if (p.defaultAssembly !== undefined &&\n        p.defaultAssembly !== this.defaultAssembly &&\n        ((this.assembly === 'default' && p.assembly === undefined) ||\n          p.assembly === 'default')\n    ) {\n      rebuild = true\n    }\n\n    super.setParameters(p, what, rebuild)\n\n    return this\n  }\n\n  getParameters () {\n    const params = Object.assign(\n      super.getParameters(),\n      {\n        sele: this.selection ? this.selection.string : undefined,\n        defaultAssembly: this.defaultAssembly\n      }\n    )\n\n    return params\n  }\n\n  attach (callback: ()=> void) {\n    const viewer = this.viewer\n    const bufferList = this.bufferList\n\n    this.dataList.forEach(function (data) {\n      data.bufferList.forEach(function (buffer) {\n        bufferList.push(buffer)\n        viewer.add(buffer, data.instanceList)\n      })\n    })\n\n    this.setVisibility(this.visible)\n    callback()\n  }\n\n  clear () {\n    this.dataList.length = 0\n\n    super.clear()\n  }\n\n  dispose () {\n    this.structureView.dispose()\n\n    super.dispose()\n  }\n}\n\nexport default StructureRepresentation\n","/**\n * @file Measurement Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport Selection from '../selection/selection'\nimport { Browser } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { LabelRepresentationParameters } from './label-representation';\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer';\nimport { GenericColor } from '../types'\n\nexport interface LabelDataField {\n  position?: boolean\n  labelColor?: boolean\n  labelSize?: boolean\n  radius?: boolean\n  labelText?: boolean\n}\n\n/**\n * Measurement representation parameter object.\n * @typedef {Object} MeasurementRepresentationParameters - measurement representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n *\n * @property {Float} labelSize - size of the distance label\n * @property {Color} labelColor - color of the distance label\n * @property {Boolean} labelVisible - visibility of the distance label\n * @property {Float} labelZOffset - offset in z-direction (i.e. in camera direction)\n */\nexport interface MeasurementRepresentationParameters extends StructureRepresentationParameters {\n  labelVisible: boolean\n  labelSize: number\n  labelColor: GenericColor\n  labelType: 'atomname'|'atomindex'|'occupancy'|'bfactor'|'serial'|'element'|'atom'|'resname'|'resno'|'res'|'text'|'qualified'\n  labelText: string\n  labelFormat: string\n  labelGrouping: 'atom'|'residue'\n  labelFontFamily: 'sans-serif'|'monospace'|'serif'\n  labelFontStyle: 'normal'|'italic'\n  labelFontWeight: 'normal'|'bold'\n  labelsdf: boolean\n  labelXOffset: number\n  labelYOffset: number\n  labelZOffset: number\n  labelAttachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  labelBorder: boolean\n  labelBorderColor: GenericColor\n  labelBorderWidth: number\n  labelBackground: boolean\n  labelBackgroundColor: GenericColor\n  labelBackgroundMargin: number\n  labelBackgroundOpacity: number\n  labelFixedSize: boolean\n  lineOpacity: number\n  linewidth: number\n}\n\n/**\n * Measurement representation\n * @interface\n */\nabstract class MeasurementRepresentation extends StructureRepresentation {\n  protected n: number\n  protected labelVisible: boolean\n  protected labelSize: number\n  protected labelColor: GenericColor\n  protected labelType: 'atomname'|'atomindex'|'occupancy'|'bfactor'|'serial'|'element'|'atom'|'resname'|'resno'|'res'|'text'|'qualified'\n  protected labelText: string\n  protected labelFormat: string\n  protected labelGrouping: 'atom'|'residue'\n  protected labelFontFamily: 'sans-serif'|'monospace'|'serif'\n  protected labelFontStyle: 'normal'|'italic'\n  protected labelFontWeight: 'normal'|'bold'\n  protected labelsdf: boolean\n  protected labelXOffset: number\n  protected labelYOffset: number\n  protected labelZOffset: number\n  protected labelAttachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  protected labelBorder: boolean\n  protected labelBorderColor: GenericColor\n  protected labelBorderWidth: number\n  protected labelBackground: boolean\n  protected labelBackgroundColor: GenericColor\n  protected labelBackgroundMargin: number\n  protected labelBackgroundOpacity: number\n  protected labelFixedSize: boolean\n  protected lineOpacity: number\n  protected linewidth: number\n  protected lineVisible: boolean\n\n  protected textBuffer: TextBuffer\n  /**\n   * Handles common label settings and position logic for\n   * distance, angle and dihedral representations\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<MeasurementRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.n = 0 // Subclass create sets value\n    this.parameters = Object.assign({\n      labelVisible: {\n        type: 'boolean'\n      },\n      labelSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      labelColor: {\n        type: 'color'\n      },\n      labelFontFamily: {\n        type: 'select',\n        options: {\n          'sans-serif': 'sans-serif',\n          'monospace': 'monospace',\n          'serif': 'serif'\n        },\n        buffer: 'fontFamily'\n      },\n      labelFontStyle: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'italic': 'italic'\n        },\n        buffer: 'fontStyle'\n      },\n      labelFontWeight: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'bold': 'bold'\n        },\n        buffer: 'fontWeight'\n      },\n      labelsdf: {\n        type: 'boolean', buffer: 'sdf'\n      },\n      labelXOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'xOffset'\n      },\n      labelYOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'yOffset'\n      },\n      labelZOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'zOffset'\n      },\n      labelAttachment: {\n        type: 'select',\n        options: {\n          'bottom-left': 'bottom-left',\n          'bottom-center': 'bottom-center',\n          'bottom-right': 'bottom-right',\n          'middle-left': 'middle-left',\n          'middle-center': 'middle-center',\n          'middle-right': 'middle-right',\n          'top-left': 'top-left',\n          'top-center': 'top-center',\n          'top-right': 'top-right'\n        },\n        rebuild: true\n      },\n      labelBorder: {\n        type: 'boolean', buffer: 'showBorder'\n      },\n      labelBorderColor: {\n        type: 'color', buffer: 'borderColor'\n      },\n      labelBorderWidth: {\n        type: 'number', precision: 2, max: 0.3, min: 0, buffer: 'borderWidth'\n      },\n      labelBackground: {\n        type: 'boolean', rebuild: true\n      },\n      labelBackgroundColor: {\n        type: 'color', buffer: 'backgroundColor'\n      },\n      labelBackgroundMargin: {\n        type: 'number', precision: 2, max: 2, min: 0, rebuild: true\n      },\n      labelBackgroundOpacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: 'backgroundOpacity'\n      },\n      labelFixedSize: {\n        type: 'boolean', buffer: 'fixedSize'\n      },\n      lineOpacity: {\n        type: 'range', min: 0.0, max: 1.0, step: 0.01\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      }\n    }, this.parameters, {\n      flatShaded: null\n    })\n  }\n\n  init (params: Partial<MeasurementRepresentationParameters>) {\n    const p = params || {}\n    this.labelVisible = defaults(p.labelVisible, true)\n    this.labelSize = defaults(p.labelSize, 2.0)\n    this.labelColor = defaults(p.labelColor, 0xFFFFFF)\n    this.labelFontFamily = defaults(p.labelFontFamily, 'sans-serif')\n    this.labelFontStyle = defaults(p.labelFontstyle, 'normal')\n    this.labelFontWeight = defaults(p.labelFontWeight, 'bold')\n    this.labelsdf = defaults(p.labelsdf, Browser === 'Chrome')\n    this.labelXOffset = defaults(p.labelXOffset, 0.0)\n    this.labelYOffset = defaults(p.labelYOffset, 0.0)\n    this.labelZOffset = defaults(p.labelZOffset, 0.5)\n    this.labelAttachment = defaults(p.labelAttachment, 'bottom-left')\n    this.labelBorder = defaults(p.labelBorder, false)\n    this.labelBorderColor = defaults(p.labelBorderColor, 'lightgrey')\n    this.labelBorderWidth = defaults(p.labelBorderWidth, 0.15)\n    this.labelBackground = defaults(p.labelBackground, false)\n    this.labelBackgroundColor = defaults(p.labelBackgroundColor, 'lightgrey')\n    this.labelBackgroundMargin = defaults(p.labelBackgroundMargin, 0.5)\n    this.labelBackgroundOpacity = defaults(p.labelBackgroundOpacity, 1.0)\n    this.labelFixedSize = defaults(p.labelFixedSize, false)\n    this.lineOpacity = defaults(p.lineOpacity, 1.0)\n    this.linewidth = defaults(p.linewidth, 2)\n\n    super.init(p)\n  }\n\n  // All measurements need to rebuild on position change\n  update (what: LabelDataField) {\n    if (what.position) {\n      this.build()\n    } else {\n      super.update(what)\n    }\n  }\n\n  updateData (what: LabelDataField & {[k: string]: any}, data: any) {\n    const textData: TextBufferData | {} = {}\n    if (!what || what.labelSize) {\n      Object.assign(textData, {size: uniformArray(this.n, this.labelSize)})\n    }\n\n    if (!what || what.labelColor) {\n      const c = new Color(this.labelColor)\n      Object.assign(textData, {color: uniformArray3(this.n, c.r, c.g, c.b)})\n    }\n\n    this.textBuffer.setAttributes(textData as TextBufferData)\n  }\n\n  setParameters (params: Partial<MeasurementRepresentationParameters>, what: LabelDataField = {}, rebuild = false) {\n    if (params && params.labelSize) {\n      what.labelSize = true\n    }\n\n    if (params && (params.labelColor || params.labelColor === 0x000000)) {\n      what.labelColor = true\n      rebuild = true\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && params.opacity !== undefined) {\n      this.textBuffer.setParameters({ opacity: 1.0 }) // only opaque labels\n    }\n\n    if (params && params.labelVisible !== undefined) {\n      this.setVisibility(this.visible)\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n    if (this.textBuffer) {\n      this.textBuffer.setVisibility(\n        this.labelVisible && this.visible\n      )\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n\n  getLabelBufferParams (params: Partial<LabelRepresentationParameters> = {}) {\n    return super.getBufferParams(Object.assign({\n      fontFamily: this.labelFontFamily,\n      fontStyle: this.labelFontStyle,\n      fontWeight: this.labelFontWeight,\n      sdf: this.labelsdf,\n      xOffset: this.labelXOffset,\n      yOffset: this.labelYOffset,\n      zOffset: this.labelZOffset,\n      attachment: this.labelAttachment,\n      showBorder: this.labelBorder,\n      borderColor: this.labelBorderColor,\n      borderWidth: this.labelBorderWidth,\n      showBackground: this.labelBackground,\n      backgroundColor: this.labelBackgroundColor,\n      backgroundMargin: this.labelBackgroundMargin,\n      backgroundOpacity: this.labelBackgroundOpacity,\n      fixedSize: this.labelFixedSize,\n      disablePicking: true,\n      visible: this.labelVisible\n    }, params, {\n      opacity: 1.0 // only opaque labels\n    }))\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n}\n\n/**\n * MeasurementRepresentations take atom[Pair|Triple|Quad] parameters.\n *\n * Parses nested array of either integer atom indices or selection\n * expressions into a flat array of coordinates.\n *\n * @param  {Structure} sview The structure to which the atoms refer\n * @param  {Array} atoms Nested array of atom pairs|triples|quads as\n *   Integer indices or selection expressions\n * @return {Float32Array} Flattened array of position coordinates\n */\nfunction parseNestedAtoms (sview: StructureView, atoms: (number|string)[][]) {\n  const ap = sview.getAtomProxy()\n  const sele = new Selection()\n\n  const nSets = atoms.length\n  if (nSets === 0) return new Float32Array(0)\n\n  // Peek-ahead at first item to determine order and parse mode\n  const order = atoms[ 0 ].length\n  const selected = sview.getAtomSet()\n\n  const a = new Float32Array(nSets * order * 3)\n\n  let p = 0\n  atoms.forEach(function (group) {\n    let _break = false\n    for (let j = 0; j < order; j++) {\n      const value = group[ j ]\n      if (typeof (value) === 'number' && Number.isInteger(value)) {\n        if (selected.get(value)) {\n          ap.index = value\n        } else {\n          _break = true\n          break\n        }\n      } else {\n        sele.setString(value as string)\n        const atomIndices = sview.getAtomIndices(sele)\n        if (atomIndices!.length) {\n          ap.index = atomIndices![ 0 ]\n        } else {\n          _break = true\n          break\n        }\n      }\n\n      let offset = p + j * 3\n      a[ offset++ ] = ap.x\n      a[ offset++ ] = ap.y\n      a[ offset++ ] = ap.z\n    }\n    if (!_break) p += 3 * order\n  })\n\n  return a.subarray(0, p)\n}\n\n/* out = v1 * cos(angle) + v2 * sin(angle) */\nfunction calcArcPoint (out: Float32Array, center: Float32Array, v1: Float32Array, v2: Float32Array, angle: number) {\n  const x = Math.cos(angle)\n  const y = Math.sin(angle)\n  out[ 0 ] = center[ 0 ] + v1[ 0 ] * x + v2[ 0 ] * y\n  out[ 1 ] = center[ 1 ] + v1[ 1 ] * x + v2[ 1 ] * y\n  out[ 2 ] = center[ 2 ] + v1[ 2 ] * x + v2[ 2 ] * y\n}\n\nexport {\n  MeasurementRepresentation as default,\n  calcArcPoint,\n  parseNestedAtoms\n}\n","/**\n * @file Edt\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\n\n// 2D Euclidean distance transform by Felzenszwalb & Huttenlocher https://cs.brown.edu/~pff/papers/dt-final.pdf\nexport function edt(data: NumberArray, width: number, height: number, f: NumberArray, d: NumberArray, v: NumberArray, z: NumberArray) {\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            f[y] = data[y * width + x]\n        }\n        edt1d(f, d, v, z, height)\n        for (let y = 0; y < height; y++) {\n            data[y * width + x] = d[y]\n        }\n    }\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n            f[x] = data[y * width + x]\n        }\n        edt1d(f, d, v, z, width)\n        for (let x = 0; x < width; x++) {\n            data[y * width + x] = Math.sqrt(d[x])\n        }\n    }\n}\n\n// 1D squared distance transform\nfunction edt1d(f: NumberArray, d: NumberArray, v: NumberArray, z: NumberArray, n: number) {\n    v[0] = 0\n    z[0] = Number.MIN_SAFE_INTEGER\n    z[1] = Number.MAX_SAFE_INTEGER\n\n    for (let q = 1, k = 0; q < n; q++) {\n        let s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\n        while (s <= z[k]) {\n            k--\n            s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\n        }\n        k++\n        v[k] = q\n        z[k] = s\n        z[k + 1] = Number.MAX_SAFE_INTEGER\n    }\n\n    for (let q = 0, k = 0; q < n; q++) {\n        while (z[k + 1] < q) k++\n        d[q] = (q - v[k]) * (q - v[k]) + f[v[k]]\n    }\n}\n","/**\n * @file Text Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, CanvasTexture, Vector3, Matrix4 } from 'three'\n\nimport '../shader/SDFFont.vert'\nimport '../shader/SDFFont.frag'\n\nimport { BufferRegistry } from '../globals'\nimport { createParams } from '../utils'\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { IgnorePicker } from '../utils/picker'\nimport { edt } from '../utils/edt'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferTypes, BufferParameters } from './buffer'\nimport { GenericColor } from '../types'\n\nconst TextAtlasCache: { [k: string]: TextAtlas } = {}\n\nfunction getTextAtlas (params: Partial<TextAtlasParams>) {\n  const hash = JSON.stringify(params)\n  if (TextAtlasCache[ hash ] === undefined) {\n    TextAtlasCache[ hash ] = new TextAtlas(params)\n  }\n  return TextAtlasCache[ hash ]\n}\n\ntype TextFonts = 'sans-serif'|'monospace'|'serif'\ntype TextStyles = 'normal'|'italic'\ntype TextVariants = 'normal'\ntype TextWeights = 'normal'|'bold'\n\nexport const TextAtlasDefaultParams = {\n  font: 'sans-serif' as TextFonts,\n  size: 36,\n  style: 'normal' as TextStyles,\n  variant: 'normal' as TextVariants,\n  weight: 'normal' as TextWeights,\n  outline: 3,\n  width: 1024,\n  height: 1024\n}\nexport type TextAtlasParams = typeof TextAtlasDefaultParams\n\nexport type TextAtlasMap = { x: number, y: number, w: number, h: number }\n\nexport class TextAtlas {\n  parameters: TextAtlasParams\n\n  gamma = 1\n  mapped: { [k: string]: TextAtlasMap } = {}\n  scratchW = 0\n  scratchH = 0\n  currentX = 0\n  currentY = 0\n\n  cutoff = 0.25\n  padding: number\n  radius: number\n\n  gridOuter: Float64Array\n  gridInner: Float64Array\n  f: Float64Array\n  d: Float64Array\n  z: Float64Array\n  v: Int16Array\n\n  paddedSize: number\n  middle: number\n\n  texture: CanvasTexture\n  canvas: HTMLCanvasElement\n  context: CanvasRenderingContext2D\n\n  lineHeight: number\n  maxWidth: number\n  colors: string[]\n  scratch: Uint8Array\n  canvas2: HTMLCanvasElement\n  context2: CanvasRenderingContext2D\n  data: Uint8Array\n\n  placeholder: TextAtlasMap\n\n  constructor (params: Partial<TextAtlasParams> = {}) {\n    this.parameters = createParams(params, TextAtlasDefaultParams)\n    const p = this.parameters\n\n    this.radius = p.size / 8\n    this.padding = p.size / 3\n\n    // Prepare line-height with room for outline and descenders/ascenders\n    const lineHeight = this.lineHeight = p.size + 2 * p.outline + Math.round(p.size / 4)\n    const maxWidth = this.maxWidth = p.width / 4\n\n    // Prepare scratch canvas\n    const canvas = this.canvas = document.createElement('canvas')\n    canvas.width = maxWidth\n    canvas.height = lineHeight\n\n    const ctx = this.context = this.canvas.getContext('2d', { willReadFrequently: true})!\n    ctx.font = `${p.style} ${p.variant} ${p.weight} ${p.size}px ${p.font}`\n    ctx.fillStyle = 'black'\n    ctx.textAlign = 'left'\n    ctx.textBaseline = 'bottom'\n    ctx.lineJoin = 'round'\n\n    // temporary arrays for the distance transform\n    this.gridOuter = new Float64Array(lineHeight * maxWidth)\n    this.gridInner = new Float64Array(lineHeight * maxWidth)\n    this.f = new Float64Array(Math.max(lineHeight, maxWidth))\n    this.d = new Float64Array(Math.max(lineHeight, maxWidth))\n    this.z = new Float64Array(Math.max(lineHeight, maxWidth) + 1)\n    this.v = new Int16Array(Math.max(lineHeight, maxWidth))\n\n    //\n    this.data = new Uint8Array(p.width * p.height * 4)\n    this.canvas2 = document.createElement('canvas')\n    this.canvas2.width = p.width\n    this.canvas2.height = p.height\n    this.context2 = this.canvas2.getContext('2d')!\n\n    // Replacement Character\n    this.placeholder = this.map(String.fromCharCode(0xFFFD))\n\n    // Basic Latin (subset)\n    for (let i = 0x0020; i <= 0x007E; ++i) {\n      this.map(String.fromCharCode(i))\n    }\n\n    // TODO: to slow to always prepare them\n    // // Latin-1 Supplement (subset)\n    // for (let i = 0x00A1; i <= 0x00FF; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // Degree sign\n    this.map(String.fromCharCode(0x00B0))\n\n    // // Greek and Coptic (subset)\n    // for (let i = 0x0391; i <= 0x03C9; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // // Cyrillic (subset)\n    // for (let i = 0x0400; i <= 0x044F; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // Angstrom Sign\n    this.map(String.fromCharCode(0x212B))\n\n    this.texture = new CanvasTexture(this.canvas2)\n    this.texture.flipY = false\n    this.texture.needsUpdate = true\n  }\n\n  map (text: string) {\n    const p = this.parameters\n\n    if (this.mapped[ text ] === undefined) {\n      this.draw(text)\n\n      if (this.currentX + this.scratchW > p.width) {\n        this.currentX = 0\n        this.currentY += this.scratchH\n      }\n      if (this.currentY + this.scratchH > p.height) {\n        console.warn('canvas to small')\n      }\n\n      this.mapped[ text ] = {\n        x: this.currentX,\n        y: this.currentY,\n        w: this.scratchW,\n        h: this.scratchH\n      }\n\n      this.context2.drawImage(\n        this.canvas,\n        0, 0,\n        this.scratchW, this.scratchH,\n        this.currentX, this.currentY,\n        this.scratchW, this.scratchH\n      )\n\n      this.currentX += this.scratchW\n    }\n\n    return this.mapped[ text ]\n  }\n\n  get (text: string) {\n    return this.mapped[ text ] || this.placeholder\n  }\n\n  draw (text: string) {\n    const p = this.parameters\n\n    const h = this.lineHeight\n    const o = p.outline\n    const ctx = this.context\n    // const dst = this.scratch\n    const max = this.maxWidth\n    // const colors = this.colors\n\n    // Bottom aligned, take outline into account\n    const x = o\n    const y = h - p.outline\n\n    // Measure text\n    const m = ctx.measureText(text)\n    const w = Math.min(max, Math.ceil(m.width + 2 * x + 1))\n\n    const n = w * h\n\n    // Clear scratch area\n    ctx.clearRect(0, 0, w, h)\n\n    // Draw text\n    ctx.fillText(text, x, y)\n\n    const imageData = ctx.getImageData(0, 0, w, h)\n    const data = imageData.data\n\n    for (let i = 0; i < n; i++) {\n        const a = imageData.data[i * 4 + 3] / 255; // alpha value\n        this.gridOuter[i] = a === 1 ? 0 : a === 0 ? Number.MAX_SAFE_INTEGER : Math.pow(Math.max(0, 0.5 - a), 2);\n        this.gridInner[i] = a === 1 ? Number.MAX_SAFE_INTEGER : a === 0 ? 0 : Math.pow(Math.max(0, a - 0.5), 2);\n    }\n\n    edt(this.gridOuter, w, h, this.f, this.d, this.v, this.z);\n    edt(this.gridInner, w, h, this.f, this.d, this.v, this.z);\n\n    for (let i = 0; i < n; i++) {\n        const d = this.gridOuter[i] - this.gridInner[i];\n        data[i * 4 + 3] = Math.max(0, Math.min(255, Math.round(255 - 255 * (d / this.radius + this.cutoff))));\n    }\n\n    ctx.putImageData(imageData, 0, 0)\n    this.scratchW = w\n    this.scratchH = h\n  }\n}\n\n/**\n * Text buffer parameter object.\n * @typedef {Object} TextBufferParameters - text buffer parameters\n *\n * @property {Float} opacity - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {Integer} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {String} labelType - type of the label, one of:\n *                                 \"atomname\", \"atomindex\", \"occupancy\", \"bfactor\",\n *                                 \"serial\", \"element\", \"atom\", \"resname\", \"resno\",\n *                                 \"res\", \"text\", \"qualified\". When set to \"text\", the\n *                                 `labelText` list is used.\n * @property {String[]} labelText - list of label strings, must set `labelType` to \"text\"\n *                                   to take effect\n * @property {String} fontFamily - font family, one of: \"sans-serif\", \"monospace\", \"serif\"\n * @property {String} fontStyle - font style, \"normal\" or \"italic\"\n * @property {String} fontWeight - font weight, \"normal\" or \"bold\"\n * @property {Float} xOffset - offset in x-direction\n * @property {Float} yOffset - offset in y-direction\n * @property {Float} zOffset - offset in z-direction (i.e. in camera direction)\n * @property {String} attachment - attachment of the label, one of:\n *                                 \"bottom-left\", \"bottom-center\", \"bottom-right\",\n *                                 \"middle-left\", \"middle-center\", \"middle-right\",\n *                                 \"top-left\", \"top-center\", \"top-right\"\n * @property {Boolean} showBorder - show border/outline\n * @property {Color} borderColor - color of the border/outline\n * @property {Float} borderWidth - width of the border/outline\n * @property {Boolean} showBackground - show background rectangle\n * @property {Color} backgroundColor - color of the background\n * @property {Float} backgroundMargin - width of the background\n * @property {Float} backgroundOpacity - opacity of the background\n * @property {Boolean} fixedSize - show text with a fixed pixel size\n */\n\nexport interface TextBufferData extends BufferData {\n  size: Float32Array\n  text: string[]\n}\n\ntype TextAttachments = 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n\nexport const TextBufferDefaultParameters = Object.assign({\n  fontFamily: 'sans-serif' as TextFonts,\n  fontStyle: 'normal' as TextStyles,\n  fontWeight: 'bold' as TextWeights,\n  fontSize: 36,\n  xOffset: 0.0,\n  yOffset: 0.0,\n  zOffset: 0.5,\n  attachment: 'bottom-left' as TextAttachments,\n  showBorder: false,\n  borderColor: 'lightgrey' as number|string,\n  borderWidth: 0.15,\n  showBackground: false,\n  backgroundColor: 'lightgrey' as number|string,\n  backgroundMargin: 0.5,\n  backgroundOpacity: 1.0,\n  forceTransparent: true,\n  fixedSize: false\n}, BufferDefaultParameters)\nexport type TextBufferParameters = BufferParameters & {\n  fontFamily: TextFonts,\n  fontStyle: TextStyles,\n  fontWeight: TextWeights,\n  fontSize: number,\n  xOffset: number,\n  yOffset: number,\n  zOffset: number,\n  attachment: TextAttachments,\n  showBorder: boolean,\n  borderColor: GenericColor,\n  borderWidth: number,\n  showBackground: boolean,\n  backgroundColor: GenericColor,\n  backgroundMargin: number,\n  backgroundOpacity: number,\n  forceTransparent: boolean,\n  fixedSize: boolean\n}\n\nconst TextBufferParameterTypes = Object.assign({\n  fontFamily: { uniform: true },\n  fontStyle: { uniform: true },\n  fontWeight: { uniform: true },\n  fontSize: { uniform: true },\n  xOffset: { uniform: true },\n  yOffset: { uniform: true },\n  zOffset: { uniform: true },\n  showBorder: { uniform: true },\n  borderColor: { uniform: true },\n  borderWidth: { uniform: true },\n  backgroundColor: { uniform: true },\n  backgroundOpacity: { uniform: true },\n  fixedSize: { updateShader: true }\n}, BufferParameterTypes)\n\nfunction getCharCount (data: TextBufferData, params: Partial<TextBufferParameters>) {\n  const n = data.position!.length / 3\n  let charCount = 0\n  for (let i = 0; i < n; ++i) {\n    charCount += data.text[ i ].length\n  }\n  if (params.showBackground) charCount += n\n\n  return charCount\n}\n\n/**\n * Text buffer. Renders screen-aligned text strings.\n *\n * @example\n * var textBuffer = new TextBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   size: new Float32Array([ 2 ]),\n *   text: [ \"Hello\" ]\n * });\n */\nclass TextBuffer extends MappedQuadBuffer {\n  parameterTypes = TextBufferParameterTypes\n  get defaultParameters() { return TextBufferDefaultParameters }\n  parameters: TextBufferParameters\n\n  alwaysTransparent = true\n  hasWireframe = false\n  isText = true\n  vertexShader = 'SDFFont.vert'\n  fragmentShader = 'SDFFont.frag'\n\n  text: string[]\n  positionCount: number\n  texture: CanvasTexture\n  textAtlas: TextAtlas\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {String[]} data.text - text strings\n   * @param  {TextBufferParameters} params - parameters object\n   */\n  constructor (data: TextBufferData, params: Partial<TextBufferParameters> = {}) {\n    super({\n      position: new Float32Array(getCharCount(data, params) * 3),\n      color: new Float32Array(getCharCount(data, params) * 3),\n      picking: new IgnorePicker()\n    }, params)\n\n    this.text = data.text\n    this.positionCount = data.position!.length / 3\n\n    this.addUniforms({\n      'fontTexture': { value: null },\n      'xOffset': { value: this.parameters.xOffset },\n      'yOffset': { value: this.parameters.yOffset },\n      'zOffset': { value: this.parameters.zOffset },\n      'ortho': { value: false },\n      'showBorder': { value: this.parameters.showBorder },\n      'borderColor': { value: new Color(this.parameters.borderColor as number) },\n      'borderWidth': { value: this.parameters.borderWidth },\n      'backgroundColor': { value: new Color(this.parameters.backgroundColor as number) },\n      'backgroundOpacity': { value: this.parameters.backgroundOpacity },\n      'canvasHeight': { value: 1.0 },\n      'pixelRatio': { value: 1.0 }\n    })\n\n    this.addAttributes({\n      'inputTexCoord': { type: 'v2', value: null },\n      'inputSize': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n\n    this.makeTexture()\n    this.makeMapping()\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n\n    const tex = this.texture\n\n    const m = this.material\n    m.transparent = true\n    m.extensions.derivatives = true\n    m.lights = false\n    m.uniforms.fontTexture.value = tex\n    m.needsUpdate = true\n\n    const wm = this.wireframeMaterial\n    wm.transparent = true\n    wm.extensions.derivatives = true\n    wm.lights = false\n    wm.uniforms.fontTexture.value = tex\n    wm.needsUpdate = true\n\n    const pm = this.pickingMaterial\n    pm.extensions.derivatives = true\n    pm.lights = false\n    pm.uniforms.fontTexture.value = tex\n    pm.needsUpdate = true\n  }\n\n  setAttributes (data: Partial<TextBufferData> = {}) {\n    let position, size, color\n    let aPosition, inputSize, aColor\n\n    const text = this.text\n    const attributes = this.geometry.attributes as any  // TODO\n\n    if (data.position) {\n      position = data.position\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.size) {\n      size = data.size\n      inputSize = attributes.inputSize.array\n      attributes.inputSize.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      aColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    const n = this.positionCount\n\n    let j, o\n    let iCharAll = 0\n    let txt, iChar, nChar\n\n    for (let v = 0; v < n; ++v) {\n      o = 3 * v\n      txt = text[ v ]\n      nChar = txt.length\n      if (this.parameters.showBackground) nChar += 1\n\n      for (iChar = 0; iChar < nChar; ++iChar, ++iCharAll) {\n        for (let m = 0; m < 4; m++) {\n          j = iCharAll * 4 * 3 + (3 * m)\n\n          if (position) {\n            aPosition[ j ] = position[ o ]\n            aPosition[ j + 1 ] = position[ o + 1 ]\n            aPosition[ j + 2 ] = position[ o + 2 ]\n          }\n\n          if (size) {\n            inputSize[ (iCharAll * 4) + m ] = size[ v ]\n          }\n\n          if (color) {\n            aColor[ j ] = color[ o ]\n            aColor[ j + 1 ] = color[ o + 1 ]\n            aColor[ j + 2 ] = color[ o + 2 ]\n          }\n        }\n      }\n    }\n  }\n\n  makeTexture () {\n    this.textAtlas = getTextAtlas({\n      font: this.parameters.fontFamily,\n      style: this.parameters.fontStyle,\n      weight: this.parameters.fontWeight,\n      size: this.parameters.fontSize\n    })\n\n    this.texture = this.textAtlas.texture\n  }\n\n  makeMapping () {\n    const ta = this.textAtlas\n    const text = this.text\n    const attachment = this.parameters.attachment\n    const margin = (ta.lineHeight * this.parameters.backgroundMargin * 0.1) - 10\n\n    const attribs = this.geometry.attributes as any  // TODO\n    const inputTexCoord = attribs.inputTexCoord.array\n    const inputMapping = attribs.mapping.array\n\n    const n = this.positionCount\n    let iCharAll = 0\n    let c, i, txt, xadvance, iChar, nChar, xShift, yShift\n\n    for (let v = 0; v < n; ++v) {\n      txt = text[ v ]\n      xadvance = 0\n      nChar = txt.length\n\n      // calculate width\n      for (iChar = 0; iChar < nChar; ++iChar) {\n        c = ta.get(txt[ iChar ])\n        xadvance += c.w - 2 * ta.parameters.outline\n      }\n\n      // attachment\n      if (attachment.startsWith('top')) {\n        yShift = ta.lineHeight / 1.25\n      } else if (attachment.startsWith('middle')) {\n        yShift = ta.lineHeight / 2.5\n      } else {\n        yShift = 0  // \"bottom\"\n      }\n      if (attachment.endsWith('right')) {\n        xShift = xadvance\n      } else if (attachment.endsWith('center')) {\n        xShift = xadvance / 2\n      } else {\n        xShift = 0  // \"left\"\n      }\n      xShift += ta.parameters.outline\n      yShift += ta.parameters.outline\n\n      // background\n      if (this.parameters.showBackground) {\n        i = iCharAll * 2 * 4\n        inputMapping[ i + 0 ] = -ta.lineHeight / 6 - xShift - margin  // top left\n        inputMapping[ i + 1 ] = ta.lineHeight - yShift + margin\n        inputMapping[ i + 2 ] = -ta.lineHeight / 6 - xShift - margin  // bottom left\n        inputMapping[ i + 3 ] = 0 - yShift - margin\n        inputMapping[ i + 4 ] = xadvance + ta.lineHeight / 6 - xShift + 2 * ta.parameters.outline + margin  // top right\n        inputMapping[ i + 5 ] = ta.lineHeight - yShift + margin\n        inputMapping[ i + 6 ] = xadvance + ta.lineHeight / 6 - xShift + 2 * ta.parameters.outline + margin  // bottom right\n        inputMapping[ i + 7 ] = 0 - yShift - margin\n        inputTexCoord[ i + 0 ] = 10\n        inputTexCoord[ i + 2 ] = 10\n        inputTexCoord[ i + 4 ] = 10\n        inputTexCoord[ i + 6 ] = 10\n        iCharAll += 1\n      }\n\n      xadvance = 0\n\n      for (iChar = 0; iChar < nChar; ++iChar, ++iCharAll) {\n        c = ta.get(txt[ iChar ])\n        i = iCharAll * 2 * 4\n\n        inputMapping[ i + 0 ] = xadvance - xShift  // top left\n        inputMapping[ i + 1 ] = c.h - yShift\n        inputMapping[ i + 2 ] = xadvance - xShift  // bottom left\n        inputMapping[ i + 3 ] = 0 - yShift\n        inputMapping[ i + 4 ] = xadvance + c.w - xShift  // top right\n        inputMapping[ i + 5 ] = c.h - yShift\n        inputMapping[ i + 6 ] = xadvance + c.w - xShift  // bottom right\n        inputMapping[ i + 7 ] = 0 - yShift\n\n        const texWidth = ta.parameters.width\n        const texHeight = ta.parameters.height\n\n        const texCoords = [\n          c.x / texWidth, c.y / texHeight,             // top left\n          c.x / texWidth, (c.y + c.h) / texHeight,       // bottom left\n          (c.x + c.w) / texWidth, c.y / texHeight,       // top right\n          (c.x + c.w) / texWidth, (c.y + c.h) / texHeight  // bottom right\n        ]\n        inputTexCoord.set(texCoords, i)\n\n        xadvance += c.w - 2 * ta.parameters.outline\n      }\n    }\n\n    attribs.inputTexCoord.needsUpdate = true\n    attribs.mapping.needsUpdate = true\n  }\n\n  getDefines (type: BufferTypes) {\n    const defines = super.getDefines(type)\n\n    if (this.parameters.fixedSize) {\n      defines.FIXED_SIZE = 1\n    }\n\n    return defines\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (data && (\n      data.fontFamily !== undefined ||\n      data.fontStyle !== undefined ||\n      data.fontWeight !== undefined ||\n      data.fontSize !== undefined\n    )) {\n      this.makeTexture()\n      this.makeMapping()\n      this.texture.needsUpdate = true\n      data.fontTexture = this.texture\n    }\n\n    super.setUniforms(data)\n  }\n}\n\nBufferRegistry.add('text', TextBuffer)\n\nexport default TextBuffer\n","/**\n * @file Wide Line Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Vector2, Vector3, Matrix4 } from 'three'\n\nimport '../shader/WideLine.vert'\nimport '../shader/WideLine.frag'\n\nimport { BufferRegistry } from '../globals'\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferParameters } from './buffer'\n\nexport interface WideLineBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n}\n\nexport const WideLineBufferDefaultParameters = Object.assign({\n  linewidth: 2\n}, BufferDefaultParameters)\nexport type WideLineBufferParameters = BufferParameters & { linewidth: number }\n\nconst WideLineBufferParameterTypes = Object.assign({\n  linewidth: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Wide Line buffer. Draws lines with a fixed width in pixels.\n *\n * @example\n * var lineBuffer = new WideLineBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ])\n * });\n */\nclass WideLineBuffer extends MappedQuadBuffer {\n  parameterTypes = WideLineBufferParameterTypes\n  get defaultParameters() { return WideLineBufferDefaultParameters }\n  parameters: WideLineBufferParameters\n\n  vertexShader = 'WideLine.vert'\n  fragmentShader ='WideLine.frag'\n\n  constructor (data: Partial<WideLineBufferData>, params: Partial<WideLineBufferParameters> = {}) {\n    super(data, params)\n\n    if (!data.color2 && data.color) data.color2 = data.color\n\n    this.addUniforms({\n      'linewidth': { value: this.parameters.linewidth },\n      'resolution': { value: new Vector2() },\n      'projectionMatrixInverse': { value: new Matrix4() }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n\n  setParameters (params: Partial<WideLineBufferParameters>) {\n    super.setParameters(params)\n  }\n}\n\nBufferRegistry.add('wideline', WideLineBuffer)\n\nexport default WideLineBuffer\n","/**\n * @file Angle Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport MeasurementRepresentation, { parseNestedAtoms, calcArcPoint, MeasurementRepresentationParameters, LabelDataField } from './measurement-representation'\nimport { defaults } from '../utils'\n\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport TextBuffer, { TextBufferData, TextBufferParameters } from '../buffer/text-buffer'\nimport WideLineBuffer, { WideLineBufferData } from '../buffer/wideline-buffer'\n\nimport { v3add, v3cross, v3dot, v3fromArray, v3length, v3new,\n  v3normalize, v3sub, v3toArray } from '../math/vector-utils'\nimport { copyArray, uniformArray, uniformArray3 } from '../math/array-utils'\nimport { RAD2DEG } from '../math/math-constants'\nimport { getFixedLengthWrappedDashData } from '../geometry/dash'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { BufferData } from '../buffer/buffer';\nimport { StructureRepresentationData, StructureRepresentationParameters } from './structure-representation';\n\n/**\n * @typedef {Object} AngleRepresentationParameters - angle representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} atomTriple - list of triplets of selection strings\n *                                 or atom indices\n * @property {Boolean} vectorVisible - Indicate the 3 points for each angle by drawing lines 1-2-3\n * @property {Boolean} arcVisible - Show the arc outline for each angle\n * @property {Number}  lineOpacity - opacity for the line part of the representation\n * @property {Number} linewidth - width for line part of representation\n * @property {Boolean} sectorVisible - Show the filled arc for each angle\n */\n\nexport interface AngleRepresentationParameters extends MeasurementRepresentationParameters {\n  atomTriple: (number|string)[][]\n  vectorVisible: boolean\n  arcVisible: boolean\n  lineOpacity: number\n  lineWidth: number\n  sectorVisible: boolean\n}\n\n/**\n * Angle representation object\n *\n * Reperesentation consists of four parts, visibility can be set for each\n * label - the text label with the angle size\n * vectors - lines joining the three points\n * sector - triangles representing the angle\n * arc - line bordering the sector\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {AngleRepresentationParameters} params - angle representation parameters\n */\nclass AngleRepresentation extends MeasurementRepresentation {\n  protected atomTriple: (number|string)[][]\n  protected vectorVisible: boolean\n  protected arcVisible: boolean\n  protected lineOpacity: number\n  protected lineWidth: number\n  protected sectorVisible: boolean\n  protected vectorBuffer: WideLineBuffer\n  arcLength: number\n  sectorLength: number\n  arcBuffer: WideLineBuffer\n  sectorBuffer: MeshBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<AngleRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'angle'\n\n    this.parameters = Object.assign({\n      atomTriple: {\n        type: 'hidden', rebuild: true\n      },\n      vectorVisible: {\n        type: 'boolean', default: true\n      },\n      arcVisible: {\n        type: 'boolean', default: true\n      },\n      sectorVisible: {\n        type: 'boolean', default: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<AngleRepresentationParameters>) {\n    const p = params || {}\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n\n    this.atomTriple = defaults(p.atomTriple, [])\n    this.arcVisible = defaults(p.arcVisible, true)\n    this.sectorVisible = defaults(p.sectorVisible, true)\n    this.vectorVisible = defaults(p.vectorVisible, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomTriple.length) return\n\n    const atomPosition = atomTriplePositions(sview, this.atomTriple)\n    const angleData = getAngleData(atomPosition)\n    const n = this.n = angleData.labelPosition.length / 3\n\n    const labelColor = new Color(this.labelColor)\n\n    // Create buffers\n    this.textBuffer = new TextBuffer({\n      position: angleData.labelPosition,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, labelColor.r, labelColor.g, labelColor.b),\n      text: angleData.labelText\n    } as TextBufferData, this.getLabelBufferParams() as TextBufferParameters)\n\n    const c = new Color(this.colorValue)\n\n    this.vectorBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: angleData.vectorPosition1,\n        position2: angleData.vectorPosition2,\n        color: uniformArray3(2 * n, c.r, c.g, c.b),\n        color2: uniformArray3(2 * n, c.r, c.g, c.b)\n      } as WideLineBufferData),\n      this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.vectorVisible,\n        opacity: this.lineOpacity\n      })\n    )\n\n    this.arcLength = angleData.arcPosition1.length / 3\n\n    this.arcBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: angleData.arcPosition1,\n        position2: angleData.arcPosition2,\n        color: uniformArray3(this.arcLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.arcLength, c.r, c.g, c.b)\n      } as WideLineBufferData), this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.arcVisible,\n        opacity: this.lineOpacity\n      }))\n\n    this.sectorLength = angleData.sectorPosition.length / 3\n\n    this.sectorBuffer = new MeshBuffer({\n      position: angleData.sectorPosition,\n      color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.sectorVisible\n    }))\n\n    return {\n      bufferList: [\n        this.textBuffer,\n        this.vectorBuffer,\n        this.arcBuffer,\n        this.sectorBuffer\n      ]\n    }\n  }\n\n  updateData (what: LabelDataField & {color?: boolean}, data: StructureRepresentationData) {\n    super.updateData(what, data)\n    const vectorData = {}\n    const arcData = {}\n    const sectorData = {}\n\n    if (what.color) {\n      const c = new Color(this.colorValue)\n      Object.assign(vectorData, {\n        color: uniformArray3(this.n * 2, c.r, c.g, c.b),\n        color2: uniformArray3(this.n * 2, c.r, c.g, c.b)\n      })\n      Object.assign(arcData, {\n        color: uniformArray3(this.arcLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.arcLength, c.r, c.g, c.b)\n      })\n      Object.assign(sectorData, {\n        color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n      })\n    }\n\n    // if (what.sectorOpacity) {\n    //   this.sectorBuffer.opacity = what.sectorOpacity\n    // }\n\n    this.vectorBuffer.setAttributes(vectorData)\n    this.arcBuffer.setAttributes(arcData)\n    this.sectorBuffer.setAttributes(sectorData)\n  }\n\n  setParameters (params: Partial<AngleRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && (\n      params.vectorVisible !== undefined ||\n      params.arcVisible !== undefined ||\n      params.sectorVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n\n    if (params && params.lineOpacity) {\n      this.vectorBuffer.setParameters({ opacity: params.lineOpacity })\n      this.arcBuffer.setParameters({ opacity: params.lineOpacity })\n    }\n\n    if (params && params.opacity !== undefined) {\n      this.vectorBuffer.setParameters({ opacity: this.lineOpacity })\n      this.arcBuffer.setParameters({ opacity: this.lineOpacity })\n    }\n\n    if (params && params.linewidth) {\n      this.vectorBuffer.setParameters({ linewidth: params.linewidth })\n      this.arcBuffer.setParameters({ linewidth: params.linewidth })\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n\n    if (this.vectorBuffer) {\n      this.vectorBuffer.setVisibility(this.vectorVisible && this.visible)\n    }\n\n    if (this.arcBuffer) {\n      this.arcBuffer.setVisibility(this.arcVisible && this.visible)\n    }\n\n    if (this.sectorBuffer) {\n      this.sectorBuffer.setVisibility(this.sectorVisible && this.visible)\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n}\n\n/**\n * Ensure mid point does not coincide with first or second\n * @param  {Float32Array} position 9*nAngle array of coordinates\n * @return {Float32Array}          Filtered position array, may be shorter\n */\nfunction validatePositions (position: Float32Array) {\n  const include = []\n  const n = position.length / 9\n  for (let i = 0; i < n; i++) {\n    // Check that first point not same as second and that second not same as third\n    let okay = true\n    for (let j = i; j < i + 3; j += 3) {\n      if (position[j] === position[j + 3] &&\n        position[j + 1] === position[j + 4] &&\n        position[j + 2] === position[j + 5]) {\n        okay = false\n      }\n    }\n    if (okay) include.push(i)\n  }\n  const outPosition = new Float32Array(include.length * 9)\n  let outIdx = 0\n  include.forEach(function (i) {\n    copyArray(position, outPosition, i * 9, outIdx * 9, 9)\n    outIdx++\n  })\n  return outPosition\n}\n\nfunction atomTriplePositions (sview: StructureView, atomTriple: (number|string)[][]) {\n  return validatePositions(parseNestedAtoms(sview, atomTriple))\n}\n\n/**\n * Converts triple positions into data required to build various buffers.\n */\nfunction getAngleData (position: Float32Array, params: Partial<StructureRepresentationParameters> = {}) {\n  const angleStep = defaults(params.angleStep, Math.PI / 90)\n  const n = position.length / 9\n  const angles = new Float32Array(n)\n  const labelPosition = new Float32Array(n * 3)\n  const labelText = new Array(n)\n\n  const vectorPosition1 = new Float32Array(n * 6) // Two lines per angle\n  const vectorPosition2 = new Float32Array(n * 6)\n\n  const arcPositionTmp1 = new Array(n) // Start points for arc lines\n  const arcPositionTmp2 = new Array(n) // End points for arc lines\n  const sectorPositionTmp = new Array(n) // Triangle points\n\n  let totalSegments = 0\n\n  // Re-used vectors etc\n  const p1 = v3new() // Positions of points for each angel\n  const p2 = v3new()\n  const p3 = v3new()\n  const v21 = v3new() // Vectors\n  const v23 = v3new()\n  const cross = v3new() // Cross product v21xv23\n  const cross2 = v3new() // In-plane cross product v21 x (v21 x v23)\n  const labelTmp = v3new()\n  const arcPoint = v3new()\n\n  for (var i = 0; i < n; i++) {\n    let p = 9 * i\n    v3fromArray(p1, position, p)\n    v3fromArray(p2, position, p + 3)\n    v3fromArray(p3, position, p + 6)\n\n    let v = 6 * i\n    v3toArray(p1, vectorPosition1, v)\n    v3toArray(p2, vectorPosition2, v)\n    v3toArray(p2, vectorPosition1, v + 3)\n    v3toArray(p3, vectorPosition2, v + 3)\n\n    v3sub(v21, p1, p2)\n    v3sub(v23, p3, p2)\n\n    v3normalize(v21, v21) // validatePositions ensures valid\n    v3normalize(v23, v23)\n\n    v3cross(cross, v21, v23)\n    const crossLength = v3length(cross)\n    const dot = v3dot(v21, v23)\n\n    const angle = angles[i] = Math.atan2(crossLength, dot)\n    labelText[i] = (RAD2DEG * angle).toFixed(1) + String.fromCharCode(0x00B0)\n\n    if (v3length(cross) === 0.0) {\n      // Angle exactly 0/180, pick an arbitrary direction\n      cross[ 0 ] = 1.0\n      cross[ 1 ] = 0.0\n      cross[ 2 ] = 0.0\n    }\n    v3cross(cross2, cross, v21)\n    v3normalize(cross2, cross2)\n\n    calcArcPoint(labelTmp, p2, v21, cross2, angle / 2.0)\n    // TODO: Scale label position?\n    v3toArray(labelTmp, labelPosition, 3 * i)\n\n    // Build the arc and sector\n\n    const nSegments = Math.ceil(angle / angleStep)\n    const sectorVertices = new Float32Array(nSegments * 9)\n    sectorPositionTmp[ i ] = sectorVertices\n    const arcVertices1 = new Float32Array(nSegments * 3)\n    const arcVertices2 = new Float32Array(nSegments * 3)\n    arcPositionTmp1[ i ] = arcVertices1\n    arcPositionTmp2[ i ] = arcVertices2\n\n    v3add(arcPoint, p2, v21) // Our initial arc point\n\n    const appendArcSection = function (a: number, j: number) {\n      const si = j * 9\n      const ai = j * 3\n      v3toArray(p2, sectorVertices, si)\n      v3toArray(arcPoint, sectorVertices, si + 3)\n      v3toArray(arcPoint, arcVertices1, ai)\n\n      calcArcPoint(arcPoint, p2, v21, cross2, a)\n\n      v3toArray(arcPoint, sectorVertices, si + 6)\n      v3toArray(arcPoint, arcVertices2, ai)\n    }\n\n    let j = 0\n    for (let a = angleStep; a < angle; a += angleStep) {\n      appendArcSection(a, j)\n      j++\n    }\n    appendArcSection(angle, j)\n    totalSegments += nSegments\n  }\n\n  // Flatten nested arrays of arc/segment points\n  const arcSize = totalSegments * 3\n  const sectorSize = totalSegments * 9\n  const arcPosition1 = new Float32Array(arcSize)\n  const arcPosition2 = new Float32Array(arcSize)\n  const sectorPosition = new Float32Array(sectorSize)\n\n  let sectorOffset = 0\n  let arcOffset = 0\n  for (let i = 0; i < n; i++) {\n    const ap1 = arcPositionTmp1[ i ]\n    const ap2 = arcPositionTmp2[ i ]\n    copyArray(ap1, arcPosition1, 0, arcOffset, ap1.length)\n    copyArray(ap2, arcPosition2, 0, arcOffset, ap2.length)\n    arcOffset += ap1.length // === ap2.length\n\n    const sp = sectorPositionTmp[ i ]\n    copyArray(sp, sectorPosition, 0, sectorOffset, sp.length)\n    sectorOffset += sp.length\n  }\n\n  return {\n    labelPosition,\n    labelText,\n    vectorPosition1,\n    vectorPosition2,\n    arcPosition1,\n    arcPosition2,\n    sectorPosition\n  }\n}\n\nRepresentationRegistry.add('angle', AngleRepresentation)\n\nexport default AngleRepresentation\n","/**\n * @file Cylinder Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, CylinderGeometry } from 'three'\n\nimport { defaults } from '../utils'\nimport { calculateCenterArray, serialBlockArray } from '../math/array-utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { CylinderBufferData } from './cylinder-buffer'\nimport { BufferDefaultParameters, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst eye = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3(0, 1, 0)\n\nexport const CylinderGeometryBufferDefaultParameters = Object.assign({\n  radialSegments: 1,\n  openEnded: true\n}, BufferDefaultParameters)\nexport type CylinderGeometryBufferParameters = BufferParameters & {radialSegments: number, openEnded: boolean}\n\nfunction getData (data: CylinderBufferData, params: Partial<CylinderGeometryBufferParameters> = {}) {\n  const geo = getGeo(params)\n\n  const n = data.position1.length\n\n  const geoLength = (geo.attributes as any).position.array.length / 3\n  const count = n / 3\n  const primitiveId = new Float32Array(count * 2 * geoLength)\n  serialBlockArray(count, geoLength, 0, primitiveId)\n  serialBlockArray(count, geoLength, count * geoLength, primitiveId)\n\n  const position = new Float32Array(n * 2)\n  const color = new Float32Array(n * 2)\n\n  return {\n    position, color, primitiveId, picking: data.picking\n  }\n}\n\nfunction getGeo (params: Partial<CylinderGeometryBufferParameters> = {}) {\n  const radialSegments = defaults(params.radialSegments, 10)\n  const openEnded = defaults(params.openEnded, true)\n  const matrix = new Matrix4().makeRotationX(Math.PI / 2)\n\n  const geo = new CylinderGeometry(\n    1,  // radiusTop,\n    1,  // radiusBottom,\n    1,  // height,\n    radialSegments,  // radialSegments,\n    1,  // heightSegments,\n    openEnded  // openEnded\n  )\n  geo.applyMatrix4(matrix)\n\n  return geo\n}\n\n/**\n * Cylinder geometry buffer.\n *\n * @example\n * var cylinderGeometryBuffer = new CylinderGeometryBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass CylinderGeometryBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return CylinderGeometryBufferDefaultParameters }\n  parameters: CylinderGeometryBufferParameters\n\n  __center: Float32Array\n  _position: Float32Array\n  _color: Float32Array\n  _from: Float32Array\n  _to: Float32Array\n  _radius: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - from colors\n   * @param {Float32Array} data.color2 - to colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: CylinderBufferData, params: Partial<CylinderGeometryBufferParameters> = {}) {\n    super(getData(data, params), params, getGeo(params))\n\n    const n = data.position1.length\n    const m = data.radius.length\n\n    this.__center = new Float32Array(n)\n    this._position = new Float32Array(n * 2)\n    this._color = new Float32Array(n * 2)\n    this._from = new Float32Array(n * 2)\n    this._to = new Float32Array(n * 2)\n    this._radius = new Float32Array(m * 2)\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    eye.fromArray(this._from as any, i3)\n    target.fromArray(this._to as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, eye.distanceTo(target))\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<CylinderBufferData> = {}, initNormals?: boolean) {\n    const meshData: Partial<CylinderBufferData> = {}\n\n    if (data.position1 && data.position2) {\n      calculateCenterArray(\n        data.position1, data.position2, this.__center\n      )\n      calculateCenterArray(\n        data.position1, this.__center, this._position\n      )\n      calculateCenterArray(\n        this.__center, data.position2, this._position, data.position1.length\n      )\n      this._from.set(data.position1)\n      this._from.set(this.__center, data.position1.length)\n      this._to.set(this.__center)\n      this._to.set(data.position2, this.__center.length)\n      meshData.position = this._position\n    }\n\n    if (data.color && data.color2) {\n      this._color.set(data.color)\n      this._color.set(data.color2, data.color.length)\n      meshData.color = this._color\n    }\n\n    if (data.radius) {\n      this._radius.set(data.radius)\n      this._radius.set(data.radius, data.radius.length)\n      meshData.radius = this._radius\n    }\n\n    super.setAttributes(meshData, initNormals)\n  }\n}\n\nexport default CylinderGeometryBuffer\n","/**\n * @file Mapped Aligned Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\n//       +Y   /\n//    0**********2\n//    *   | /   **\n//    *   |/   * *\n// -----------3---- +X\n//    *  /|   *  *\n//    * / |   *  *\n//    1/**|******4\n//    /   |   * *\n//   /    |   **  \n//  +Z    |   5 \nconst mapping = new Float32Array([\n  -1.0, 1.0, -1.0,\n  -1.0, -1.0, -1.0,\n  1.0, 1.0, -1.0,\n  1.0, 1.0, 1.0,\n  1.0, -1.0, -1.0,\n  1.0, -1.0, 1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  1, 4, 2,\n  2, 4, 3,\n  4, 5, 3\n])\n\n/**\n * Mapped Aligned box buffer. Draws boxes where one side is always screen-space aligned.\n * Used to render cylinder imposters.\n * @interface\n */\nclass MappedAlignedBoxBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v3', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 12 }\n  get mappingSize () { return 6 }\n  get mappingItemSize () { return 3 }\n}\n\nexport default MappedAlignedBoxBuffer\n","/**\n * @file Cylinder Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Matrix4, Vector3 } from 'three'\n\nimport '../shader/CylinderImpostor.vert'\nimport '../shader/CylinderImpostor.frag'\n\nimport MappedAlignedBoxBuffer from './mappedalignedbox-buffer'\nimport { BufferDefaultParameters, BufferParameters, BufferParameterTypes, BufferTypes } from './buffer'\nimport { CylinderBufferData } from './cylinder-buffer'\n\nexport const CylinderImpostorBufferDefaultParameters = Object.assign({\n  openEnded: false\n}, BufferDefaultParameters)\nexport type CylinderImpostorBufferParameters = BufferParameters & { openEnded: boolean }\n\nconst CylinderImpostorBufferParameterTypes = Object.assign({\n  openEnded: { updateShader: true }\n}, BufferParameterTypes)\n\n/**\n * Cylinder impostor buffer.\n *\n * @example\n * var cylinderimpostorBuffer = new CylinderImpostorBuffer({\n *     position1: new Float32Array([ 0, 0, 0 ]),\n *     position2: new Float32Array([ 1, 1, 1 ]),\n *     color: new Float32Array([ 1, 0, 0 ]),\n *     color2: new Float32Array([ 0, 1, 0 ]),\n *     radius: new Float32Array([ 1 ])\n * });\n */\nclass CylinderImpostorBuffer extends MappedAlignedBoxBuffer {\n  parameterTypes = CylinderImpostorBufferParameterTypes\n  get defaultParameters() { return CylinderImpostorBufferDefaultParameters }\n  parameters: CylinderImpostorBufferParameters\n\n  isImpostor = true\n  vertexShader = 'CylinderImpostor.vert'\n  fragmentShader = 'CylinderImpostor.frag'\n\n  /**\n   * make cylinder impostor buffer\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position1 - from positions\n   * @param  {Float32Array} data.position2 - to positions\n   * @param  {Float32Array} data.color - from colors\n   * @param  {Float32Array} data.color2 - to colors\n   * @param  {Float32Array} data.radius - radii\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: CylinderBufferData, params: Partial<CylinderImpostorBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'modelViewMatrixInverse': { value: new Matrix4() },\n      'ortho': { value: 0.0 }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null },\n      'radius': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines = MappedAlignedBoxBuffer.prototype.getDefines.call(this, type)\n\n    if (!this.parameters.openEnded) {\n      defines.CAP = 1\n    }\n\n    return defines\n  }\n}\n\nexport default CylinderImpostorBuffer\n","/**\n * @file Cylinder Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import required for declaration only\nimport { Vector3, Matrix4 } from 'three'\nimport { BufferRegistry, ExtensionFragDepth } from '../globals'\nimport CylinderGeometryBuffer, { CylinderGeometryBufferDefaultParameters, CylinderGeometryBufferParameters } from './cylindergeometry-buffer'\nimport CylinderImpostorBuffer, { CylinderImpostorBufferDefaultParameters, CylinderImpostorBufferParameters } from './cylinderimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface CylinderBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n}\n\nexport const CylinderBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, CylinderGeometryBufferDefaultParameters, CylinderImpostorBufferDefaultParameters)\nexport type CylinderBufferParameters = (CylinderGeometryBufferParameters & {disableImpostor: boolean}) | (CylinderImpostorBufferParameters & {disableImpostor: boolean})\n\nclass CylinderBufferImpl {\n  constructor (data: CylinderBufferData, params: Partial<CylinderBufferParameters> = {}) {\n    if (!data.color2 && data.color) data.color2 = data.color\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      return new CylinderGeometryBuffer(data, params)\n    } else {\n      return new CylinderImpostorBuffer(data, params)\n    }\n  }\n}\n\n/**\n * Cylinder buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link CylinderGeometryBuffer} or a {@link CylinderImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var cylinderBuffer = new CylinderBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\n//@ts-expect-error Incompatible constructor signatures\nconst CylinderBuffer: {\n  new(data: CylinderBufferData, params: Partial<CylinderBufferParameters>): CylinderGeometryBuffer | CylinderImpostorBuffer;\n} = CylinderBufferImpl;\n\ntype CylinderBuffer = CylinderGeometryBuffer | CylinderImpostorBuffer;\n\nBufferRegistry.add('cylinder', CylinderBuffer)\n\nexport default CylinderBuffer\n","/**\n * @file Axes Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3 } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AxesPicker } from '../utils/picker'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport StructureView from '../structure/structure-view';\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport PrincipalAxes from '../math/principal-axes';\n\nexport interface AxesRepresentationParameters extends StructureRepresentationParameters {\n  showAxes: boolean\n  showBox: boolean\n}\n\n/**\n * Axes representation. Show principal axes and/or a box aligned with them\n * that fits the structure or selection.\n *\n * __Name:__ _axes_\n *\n * @example\n * stage.loadFile( \"rcsb://3pqr\", {\n *     assembly: \"BU1\"\n * } ).then( function( o ){\n *     o.addRepresentation( \"cartoon\" );\n *     o.addRepresentation( \"axes\", {\n *         sele: \"RET\", showAxes: false, showBox: true, radius: 0.2\n *     } );\n *     o.addRepresentation( \"ball+stick\", { sele: \"RET\" } );\n *     o.addRepresentation( \"axes\", {\n *         sele: \":B and backbone\", showAxes: false, showBox: true, radius: 0.2\n *     } );\n *     stage.autoView();\n *     var pa = o.structure.getPrincipalAxes();\n *     stage.animationControls.rotate( pa.getRotationQuaternion(), 1500 );\n * } );\n */\nclass AxesRepresentation extends StructureRepresentation {\n  \n  protected showAxes: boolean\n  protected showBox: boolean\n  protected sphereBuffer: SphereBuffer\n  protected cylinderBuffer: CylinderBuffer\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {StructureRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<AxesRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'axes'\n\n    this.parameters = Object.assign({\n\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      radialSegments: true,\n      disableImpostor: true,\n      showAxes: {\n        type: 'boolean', rebuild: true\n      },\n      showBox: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n      assembly: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<AxesRepresentationParameters>) {\n    const p = params || {}\n    p.radiusSize = defaults(p.radiusSize, 0.5)\n    p.colorValue = defaults(p.colorValue, 'lightgreen')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.showAxes = defaults(p.showAxes, true)\n    this.showBox = defaults(p.showBox, false)\n\n    super.init(p)\n  }\n\n  getPrincipalAxes (): PrincipalAxes {\n    let selection\n    const assembly = this.getAssembly()\n\n    if (assembly) {\n      selection = assembly.partList[ 0 ].getSelection()\n    }\n\n    return this.structureView.getPrincipalAxes(selection)\n  }\n\n  getAxesData (sview: StructureView) {\n    const pa = this.getPrincipalAxes()\n    const c = new Color(this.colorValue)\n\n    let vn = 0\n    let en = 0\n\n    if (this.showAxes) {\n      vn += 6\n      en += 3\n    }\n\n    if (this.showBox) {\n      vn += 8\n      en += 12\n    }\n\n    const vertexPosition = new Float32Array(3 * vn)\n    const vertexColor = uniformArray3(vn, c.r, c.g, c.b)\n    const vertexRadius = uniformArray(vn, this.radiusSize)\n\n    const edgePosition1 = new Float32Array(3 * en)\n    const edgePosition2 = new Float32Array(3 * en)\n    const edgeColor = uniformArray3(en, c.r, c.g, c.b)\n    const edgeRadius = uniformArray(en, this.radiusSize)\n\n    let offset = 0\n\n    if (this.showAxes) {\n      const addAxis = function (v1: Vector3, v2: Vector3) {\n        v1.toArray(vertexPosition as any, offset * 2)\n        v2.toArray(vertexPosition as any, offset * 2 + 3)\n        v1.toArray(edgePosition1 as any, offset)\n        v2.toArray(edgePosition2 as any, offset)\n        offset += 3\n      }\n\n      addAxis(pa.begA, pa.endA)\n      addAxis(pa.begB, pa.endB)\n      addAxis(pa.begC, pa.endC)\n    }\n\n    if (this.showBox) {\n      const v = new Vector3()\n      const { d1a, d2a, d3a, d1b, d2b, d3b } = pa.getProjectedScaleForAtoms(sview)\n\n      // console.log(d1a, d2a, d3a, d1b, d2b, d3b)\n\n      let offset2 = offset * 2\n      const addCorner = function (d1: number, d2: number, d3: number) {\n        v.copy(pa.center)\n          .addScaledVector(pa.normVecA, d1)\n          .addScaledVector(pa.normVecB, d2)\n          .addScaledVector(pa.normVecC, d3)\n        v.toArray(vertexPosition as any, offset2)\n        offset2 += 3\n      }\n      addCorner(d1a, d2a, d3a)\n      addCorner(d1a, d2a, d3b)\n      addCorner(d1a, d2b, d3b)\n      addCorner(d1a, d2b, d3a)\n      addCorner(d1b, d2b, d3b)\n      addCorner(d1b, d2b, d3a)\n      addCorner(d1b, d2a, d3a)\n      addCorner(d1b, d2a, d3b)\n\n      let edgeOffset = offset\n      const addEdge = function (a: number, b: number) {\n        v.fromArray(vertexPosition as any, offset * 2 + a * 3)\n          .toArray(edgePosition1 as any, edgeOffset)\n        v.fromArray(vertexPosition as any, offset * 2 + b * 3)\n          .toArray(edgePosition2 as any, edgeOffset)\n        edgeOffset += 3\n      }\n      addEdge(0, 1)\n      addEdge(0, 3)\n      addEdge(0, 6)\n      addEdge(1, 2)\n      addEdge(1, 7)\n      addEdge(2, 3)\n      addEdge(2, 4)\n      addEdge(3, 5)\n      addEdge(4, 5)\n      addEdge(4, 7)\n      addEdge(5, 6)\n      addEdge(6, 7)\n    }\n\n    const picker = new AxesPicker(pa)\n\n    return {\n      vertex: {\n        position: vertexPosition,\n        color: vertexColor,\n        radius: vertexRadius,\n        picking: picker\n      },\n      edge: {\n        position1: edgePosition1,\n        position2: edgePosition2,\n        color: edgeColor,\n        color2: edgeColor,\n        radius: edgeRadius,\n        picking: picker\n      }\n    }\n  }\n\n  create () {\n    const axesData = this.getAxesData(this.structureView)\n\n    this.sphereBuffer = new SphereBuffer(\n      axesData.vertex as SphereBufferData,\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    )\n\n    this.cylinderBuffer = new CylinderBuffer(\n      axesData.edge as CylinderBufferData,\n      this.getBufferParams({\n        openEnded: true,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    this.dataList.push({\n      sview: this.structureView,\n      bufferList: [ this.sphereBuffer as SphereGeometryBuffer, this.cylinderBuffer as CylinderGeometryBuffer]\n    })\n  }\n\n  createData (sview: StructureView): undefined {\n    return\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    const axesData = this.getAxesData(data.sview as StructureView)\n    const sphereData = {}\n    const cylinderData = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {\n        position: axesData.vertex.position\n      })\n      Object.assign(cylinderData, {\n        position1: axesData.edge.position1,\n        position2: axesData.edge.position2\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {\n        color: axesData.vertex.color as Float32Array\n      })\n      Object.assign(cylinderData, {\n        color: axesData.edge.color as Float32Array,\n        color2: axesData.edge.color as Float32Array\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {\n        radius: axesData.vertex.radius as Float32Array\n      })\n      Object.assign(cylinderData, {\n        radius: axesData.edge.radius as Float32Array\n      })\n    }\n\n    (this.sphereBuffer as SphereGeometryBuffer).setAttributes(sphereData);\n    (this.cylinderBuffer as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('axes', AxesRepresentation)\n\nexport default AxesRepresentation\n","/**\n * @file Ball And Stick Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { ExtensionFragDepth, RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport Viewer from '../viewer/viewer';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport AtomProxy from '../proxy/atom-proxy';\nimport { AtomDataParams, BondDataParams, BondDataFields, AtomDataFields, BondData, AtomData } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n\nexport interface BallAndStickRepresentationParameters extends StructureRepresentationParameters {\n  sphereDetail: number\n  radialSegments: number\n  openEnded: boolean\n  disableImpostor: boolean\n  aspectRatio: number\n  lineOnly: boolean\n  lineWidth: number\n  cylinderOnly: boolean\n  multipleBond: 'off' | 'symmetric' | 'offset'\n  bondSpacing: number\n  bondScale: number\n  linewidth: number\n}\n\n/**\n * Ball And Stick representation parameter object. Extends {@link RepresentationParameters} and\n * {@link StructureRepresentationParameters}.\n *\n * @typedef {Object} BallAndStickRepresentationParameters - ball and stick representation parameters\n *\n * @property {Integer} sphereDetail - sphere quality (icosahedron subdivisions)\n * @property {Integer} radialSegments - cylinder quality (number of segments)\n * @property {Boolean} openEnded - capped or not\n * @property {Boolean} disableImpostor - disable use of raycasted impostors for rendering\n * @property {Float} aspectRatio - size difference between atom and bond radii\n * @property {Boolean} lineOnly - render only bonds, and only as lines\n * @property {Integer} linewidth - width of lines\n * @property {Boolean} cylinderOnly - render only bonds (no atoms)\n * @property {String} multipleBond - one off \"off\", \"symmetric\", \"offset\"\n * @property {Float} bondSpacing - spacing for multiple bond rendering\n * @property {Float} bondScale - scale/radius for multiple bond rendering\n */\n\n/**\n * Ball And Stick representation. Show atoms as spheres and bonds as cylinders.\n *\n * __Name:__ _ball+stick_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\" );\n *     o.autoView();\n * } );\n */\nclass BallAndStickRepresentation extends StructureRepresentation {\n  protected sphereDetail: number\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  protected aspectRatio: number\n  protected lineOnly: boolean\n  protected lineWidth: number\n  protected cylinderOnly: boolean\n  protected multipleBond: 'off' | 'symmetric' | 'offset'\n  protected bondSpacing: number\n  protected bondScale: number\n  protected linewidth: number\n\n  protected lineBuffer: WideLineBuffer\n  /**\n   * Create Ball And Stick representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {BallAndStickRepresentationParameters} params - ball and stick representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'ball+stick'\n\n    this.parameters = Object.assign({\n\n      sphereDetail: true,\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true,\n      aspectRatio: {\n        type: 'number', precision: 1, max: 10.0, min: 1.0\n      },\n      lineOnly: {\n        type: 'boolean', rebuild: true\n      },\n      cylinderOnly: {\n        type: 'boolean', rebuild: true\n      },\n      multipleBond: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'symmetric': 'symmetric',\n          'offset': 'offset'\n        }\n      },\n      bondScale: {\n        type: 'number', precision: 2, max: 1.0, min: 0.01\n      },\n      bondSpacing: {\n        type: 'number', precision: 2, max: 2.0, min: 0.5\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      }\n\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.aspectRatio = defaults(p.aspectRatio, 2.0)\n    this.lineOnly = defaults(p.lineOnly, false)\n    this.cylinderOnly = defaults(p.cylinderOnly, false)\n    this.multipleBond = defaults(p.multipleBond, 'off')\n    this.bondSpacing = defaults(p.bondSpacing, 1.0)\n    this.bondScale = defaults(p.bondScale, 0.4)\n    this.linewidth = defaults(p.linewidth, 2)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return this.aspectRatio * super.getAtomRadius(atom)\n  }\n\n  getAtomParams (what?: AtomDataFields, params?: Partial<AtomDataParams>) {\n    var p = super.getAtomParams(what, params)\n    p.radiusParams.scale *= this.aspectRatio\n\n    return p\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: Partial<AtomDataParams>): AtomData {\n    return sview.getAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondParams (what?: BondDataFields, params?: Partial<BondDataParams>) {\n    params = Object.assign({\n      multipleBond: this.multipleBond,\n      bondSpacing: this.bondSpacing,\n      bondScale: this.bondScale\n    }, params)\n\n    return super.getBondParams(what, params)\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: Partial<BondDataParams>): BondData {\n    return sview.getBondData(this.getBondParams(what, params))\n  }\n\n  createData (sview: StructureView) {\n    const bufferList: any[] = []\n\n    if (this.lineOnly) {\n      this.lineBuffer = new WideLineBuffer(\n        this.getBondData(sview, { position: true, color: true, picking: true }),\n        this.getBufferParams({ linewidth: this.linewidth })\n      )\n\n      bufferList.push(this.lineBuffer)\n    } else {\n      const cylinderBuffer = new CylinderBuffer(\n        (this.getBondData(sview) as CylinderBufferData),\n        this.getBufferParams({\n          openEnded: this.openEnded,\n          radialSegments: this.radialSegments,\n          disableImpostor: this.disableImpostor,\n          dullInterior: true\n        })\n      )\n\n      bufferList.push(cylinderBuffer as CylinderGeometryBuffer)\n\n      if (!this.cylinderOnly) {\n        const sphereBuffer = new SphereBuffer(\n          (this.getAtomData(sview) as SphereBufferData),\n          (this.getBufferParams({\n            sphereDetail: this.sphereDetail,\n            disableImpostor: this.disableImpostor,\n            dullInterior: true\n          }) as SphereBufferParameters)\n        )\n\n        bufferList.push(sphereBuffer as SphereGeometryBuffer)\n      }\n    }\n\n    return {\n      bufferList: bufferList\n    }\n  }\n\n  updateData (what: BondDataFields | AtomDataFields, data: StructureRepresentationData) {\n    if (this.multipleBond !== 'off' && what && what.radius) {\n      what.position = true\n    }\n\n    const bondData = this.getBondData(data.sview as StructureView, what)\n\n    if (this.lineOnly) {\n      const lineData:Partial<CylinderBufferData> = {}\n\n      if (!what || what.position) {\n        Object.assign(lineData, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(lineData, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      data.bufferList[ 0 ].setAttributes(lineData)\n    } else {\n      var cylinderData: Partial<CylinderBufferData> = {}\n\n      if (!what || what.position) {\n        Object.assign(cylinderData, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(cylinderData, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      if (!what || what.radius) {\n        Object.assign(cylinderData, {\n          radius: bondData.radius\n        })\n      }\n\n      data.bufferList[ 0 ].setAttributes(cylinderData)\n\n      if (!this.cylinderOnly) {\n        var atomData = this.getAtomData(data.sview as StructureView, what)\n\n        var sphereData: Partial<SphereBufferData> = {}\n\n        if (!what || what.position) {\n          Object.assign(sphereData, {\n            position: atomData.position\n          })\n        }\n\n        if (!what || what.color) {\n          Object.assign(sphereData, {\n            color: atomData.color\n          })\n        }\n\n        if (!what || what.radius) {\n          Object.assign(sphereData, {\n            radius: atomData.radius\n          })\n        }\n\n        data.bufferList[ 1 ].setAttributes(sphereData)\n      }\n    }\n  }\n\n  setParameters (params: Partial<BallAndStickRepresentationParameters> = {}) {\n    let rebuild = false\n    const what: AtomDataFields = {}\n\n    if (params.aspectRatio || params.bondSpacing || params.bondScale) {\n      Object.assign(what, {radius: true})\n      if (!ExtensionFragDepth || this.disableImpostor) {\n        rebuild = true\n      }\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('ball+stick', BallAndStickRepresentation)\n\nexport default BallAndStickRepresentation\n","/**\n * @file Backbone Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields, AtomDataParams, BondDataFields, BondDataParams, BondData, AtomData } from '../structure/structure-data';\n\n/**\n * Backbone representation. Show cylinders (or lines) connecting .CA (protein)\n * or .C4'/.C3' (RNA/DNA) of polymers.\n *\n * __Name:__ _backbone_\n *\n * @example\n * stage.loadFile( \"rcsb://1sfi\" ).then( function( o ){\n *     o.addRepresentation( \"backbone\" );\n *     o.autoView();\n * } );\n */\nclass BackboneRepresentation extends BallAndStickRepresentation {\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {BallAndStickRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'backbone'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = defaults(p.aspectRatio, 1.0)\n    p.radiusSize = defaults(p.radiusSize, 0.25)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: Partial<AtomDataParams>): AtomData {\n    return sview.getBackboneAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: Partial<BondDataParams>): BondData {\n    return sview.getBackboneBondData(this.getBondParams(what, params))\n  }\n}\n\nRepresentationRegistry.add('backbone', BackboneRepresentation)\n\nexport default BackboneRepresentation\n","/**\n * @file Base Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields, AtomDataParams, BondDataFields, BondDataParams, BondData, AtomData } from '../structure/structure-data';\n\n/**\n * Base representation. Show cylinders for RNA/DNA ladders.\n *\n * __Name:__ _base_\n *\n * @example\n * stage.loadFile( \"rcsb://1d66\" ).then( function( o ){\n *     o.addRepresentation( \"cartoon\", { sele: \"nucleic\" } );\n *     o.addRepresentation( \"base\", { color: \"resname\" } );\n *     o.autoView( \"nucleic\" );\n * } );\n */\nclass BaseRepresentation extends BallAndStickRepresentation {\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {BallAndStickRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'base'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    let p = params || {}\n    p.aspectRatio = defaults(p.aspectRatio, 1.0)\n    p.radiusSize = defaults(p.radiusSize, 0.3)\n\n    super.init(p)\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: AtomDataParams): AtomData {\n    return sview.getRungAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: BondDataParams): BondData {\n    let p = this.getBondParams(what, params)\n    Object.assign(p.colorParams, {rung: true})\n\n    return sview.getRungBondData(p)\n  }\n}\n\nRepresentationRegistry.add('base', BaseRepresentation)\n\nexport default BaseRepresentation\n","/**\n * @file Spline\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { copyArray } from '../math/array-utils'\nimport { spline } from '../math/math-utils'\nimport Polymer from '../proxy/polymer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport { ColormakerParameters } from '../color/colormaker';\nimport { NumberArray } from '../types';\n\nexport class Interpolator {\n  \n  m: number\n  tension: number\n  dt: number\n  delta: number\n  vec1: Vector3\n  vec2: Vector3\n  vDir: Vector3 \n  vTan: Vector3\n  vNorm: Vector3\n  vBin: Vector3\n  m2: number\n\n  constructor (m: number, tension: number) {\n    this.m = m\n    this.tension = tension\n    this.dt = 1.0 / this.m\n    this.delta = 0.0001\n\n    this.vec1 = new Vector3()\n    this.vec2 = new Vector3()\n\n    this.vDir = new Vector3()\n    this.vTan = new Vector3()\n    this.vNorm = new Vector3()\n    this.vBin = new Vector3()\n  \n    this.m2 = Math.ceil(this.m / 2)\n  }\n\n  private interpolateToArr (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, t: number, arr: Float32Array, offset: number) {\n    arr[ offset + 0 ] = spline(v0.x, v1.x, v2.x, v3.x, t, this.tension)\n    arr[ offset + 1 ] = spline(v0.y, v1.y, v2.y, v3.y, t, this.tension)\n    arr[ offset + 2 ] = spline(v0.z, v1.z, v2.z, v3.z, t, this.tension)\n  }\n\n  private interpolateToVec (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, t: number, vec: Vector3) {\n    vec.x = spline(v0.x, v1.x, v2.x, v3.x, t, this.tension)\n    vec.y = spline(v0.y, v1.y, v2.y, v3.y, t, this.tension)\n    vec.z = spline(v0.z, v1.z, v2.z, v3.z, t, this.tension)\n  }\n\n  private interpolatePosition (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, pos: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var l = offset + j * 3\n      var d = this.dt * j\n      this.interpolateToArr(v0, v1, v2, v3, d, pos, l)\n    }\n  }\n\n  private interpolateTangent (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, tan: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var d = this.dt * j\n      var d1 = d - this.delta\n      var d2 = d + this.delta\n      var l = offset + j * 3\n      // capping as a precaution\n      if (d1 < 0) d1 = 0\n      if (d2 > 1) d2 = 1\n      //\n      this.interpolateToVec(v0, v1, v2, v3, d1, this.vec1)\n      this.interpolateToVec(v0, v1, v2, v3, d2, this.vec2)\n      //\n      this.vec2.sub(this.vec1).normalize()\n      this.vec2.toArray(tan as any, l)\n    }\n  }\n\n  private vectorSubdivide (interpolationFn: (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, array: Float32Array, offset: number) => void,\n                            iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    let v0: Vector3\n    let v1 = <Vector3>iterator.next()\n    let v2 = <Vector3>iterator.next()\n    let v3 = <Vector3>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (let i = 0; i < n1; ++i) {\n      v0 = v1\n      v1 = v2\n      v2 = v3\n      v3 = <Vector3>iterator.next()\n      interpolationFn.apply(this, [v0, v1, v2, v3, array, k])\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      v0 = <Vector3>iterator.get(n - 2)\n      v1 = <Vector3>iterator.get(n - 1)\n      v2 = <Vector3>iterator.get(0)\n      v3 = <Vector3>iterator.get(1)\n      interpolationFn.apply(this, [v0, v1, v2, v3, array, k])\n      k += 3 * this.m\n    }\n  }\n\n  //\n\n  public getPosition (iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    this.vectorSubdivide(this.interpolatePosition, iterator, array, offset, isCyclic)\n    var n1 = iterator.size - 1\n    var k = n1 * this.m * 3\n    if (isCyclic) k += this.m * 3\n    var v = iterator.get(isCyclic ? 0 : n1)\n    array[ k ] = v.x\n    array[ k + 1 ] = v.y\n    array[ k + 2 ] = v.z\n  }\n\n  public getTangent (iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    this.vectorSubdivide(this.interpolateTangent, iterator, array, offset, isCyclic)\n    const n1 = iterator.size - 1\n    let k = n1 * this.m * 3\n    if (isCyclic) k += this.m * 3\n    copyArray(array, array, k - 3, k, 3)\n  }\n\n  private interpolateNormalDir (u0: Vector3, u1: Vector3, u2: Vector3, u3: Vector3,\n                                v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3,\n                                tan: Float32Array, norm: Float32Array, bin: Float32Array,\n                                offset: number, shift: boolean) {\n    for (let j = 0; j < this.m; ++j) {\n      let l = offset + j * 3\n      if (shift) l += this.m2 * 3\n      const d = this.dt * j\n      this.interpolateToVec(u0, u1, u2, u3, d, this.vec1)\n      this.interpolateToVec(v0, v1, v2, v3, d, this.vec2)\n      this.vDir.subVectors(this.vec2, this.vec1).normalize()\n      this.vTan.fromArray(tan as any, l)\n      this.vBin.crossVectors(this.vDir, this.vTan).normalize()\n      this.vBin.toArray(bin as any, l)\n      this.vNorm.crossVectors(this.vTan, this.vBin).normalize()\n      this.vNorm.toArray(norm as any, l)\n    }\n  }\n\n  private interpolateNormal (vDir: Vector3, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var l = offset + j * 3\n      vDir.copy(this.vNorm)\n      this.vTan.fromArray(tan as any, l)\n      this.vBin.crossVectors(vDir, this.vTan).normalize()\n      this.vBin.toArray(bin as any, l)\n      this.vNorm.crossVectors(this.vTan, this.vBin).normalize()\n      this.vNorm.toArray(norm as any, l)\n    }\n  }\n\n  public getNormal (size: number, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number, isCyclic: boolean) {\n    this.vNorm.set(0, 0, 1)\n    const n = size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      this.interpolateNormal(this.vDir, tan, norm, bin, k)\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      this.interpolateNormal(this.vDir, tan, norm, bin, k)\n      k += 3 * this.m\n    }\n    this.vBin.toArray(bin as any, k)\n    this.vNorm.toArray(norm as any, k)\n  }\n\n  public getNormalDir (iterDir1: AtomIterator, iterDir2: AtomIterator, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number, isCyclic: boolean, shift: boolean) {\n    iterDir1.reset()\n    iterDir2.reset()\n    //\n    const vSub1 = new Vector3()\n    const vSub2 = new Vector3()\n    const vSub3 = new Vector3()\n    const vSub4 = new Vector3()\n    //\n    const d1v1 = new Vector3()\n    const d1v2 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d1v3 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d1v4 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d2v1 = new Vector3()\n    const d2v2 = new Vector3().copy(<Vector3>iterDir2.next())\n    const d2v3 = new Vector3().copy(<Vector3>iterDir2.next())\n    const d2v4 = new Vector3().copy(<Vector3>iterDir2.next())\n    //\n    this.vNorm.set(0, 0, 1)\n    let n = iterDir1.size\n    let n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      d1v1.copy(d1v2)\n      d1v2.copy(d1v3)\n      d1v3.copy(d1v4)\n      d1v4.copy(<Vector3>iterDir1.next())\n      d2v1.copy(d2v2)\n      d2v2.copy(d2v3)\n      d2v3.copy(d2v4)\n      d2v4.copy(<Vector3>iterDir2.next())\n      //\n      if (i === 0) {\n        vSub1.subVectors(d2v1, d1v1)\n        vSub2.subVectors(d2v2, d1v2)\n        if (vSub1.dot(vSub2) < 0) {\n          vSub2.multiplyScalar(-1)\n          d2v2.addVectors(d1v2, vSub2)\n        }\n        vSub3.subVectors(d2v3, d1v3)\n        if (vSub2.dot(vSub3) < 0) {\n          vSub3.multiplyScalar(-1)\n          d2v3.addVectors(d1v3, vSub3)\n        }\n      } else {\n        vSub3.copy(vSub4)\n      }\n      vSub4.subVectors(d2v4, d1v4)\n      if (vSub3.dot(vSub4) < 0) {\n        vSub4.multiplyScalar(-1)\n        d2v4.addVectors(d1v4, vSub4)\n      }\n      this.interpolateNormalDir(\n        d1v1, d1v2, d1v3, d1v4,\n        d2v1, d2v2, d2v3, d2v4,\n        tan, norm, bin, k, shift\n      )\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      d1v1.copy(<Vector3>iterDir1.get(n - 2))\n      d1v2.copy(<Vector3>iterDir1.get(n - 1))\n      d1v3.copy(<Vector3>iterDir1.get(0))\n      d1v4.copy(<Vector3>iterDir1.get(1))\n      d2v1.copy(<Vector3>iterDir2.get(n - 2))\n      d2v2.copy(<Vector3>iterDir2.get(n - 1))\n      d2v3.copy(<Vector3>iterDir2.get(0))\n      d2v4.copy(<Vector3>iterDir2.get(1))\n      //\n      vSub3.copy(vSub4)\n      vSub4.subVectors(d2v4, d1v4)\n      if (vSub3.dot(vSub4) < 0) {\n        vSub4.multiplyScalar(-1)\n        d2v4.addVectors(d1v4, vSub4)\n      }\n      this.interpolateNormalDir(\n        d1v1, d1v2, d1v3, d1v4,\n        d2v1, d2v2, d2v3, d2v4,\n        tan, norm, bin, k, shift\n      )\n      k += 3 * this.m\n    }\n    if (shift) {\n      // FIXME shift requires data from one this.more preceeding residue\n      this.vBin.fromArray(bin as any, this.m2 * 3)\n      this.vNorm.fromArray(norm as any, this.m2 * 3)\n      for (var j = 0; j < this.m2; ++j) {\n        this.vBin.toArray(bin as any, j * 3)\n        this.vNorm.toArray(norm as any, j * 3)\n      }\n    } else {\n      this.vBin.toArray(bin as any, k)\n      this.vNorm.toArray(norm as any, k)\n    }\n  }\n\n  //\n\n  private interpolateColor (item1: AtomProxy, item2: AtomProxy, colFn: (...arg: any[]) => void, col: any, offset: number) {\n    var j, l\n    for (j = 0; j < this.m2; ++j) {\n      l = offset + j * 3\n      colFn.apply(this, [item1, col, l]) // itemColorToArray\n    }\n    for (j = this.m2; j < this.m; ++j) {\n      l = offset + j * 3\n      colFn.apply(this, [item2, col, l]) // itemColorToArray\n    }\n  }\n\n  public getColor (iterator: AtomIterator, colFn: (...arg: any[]) => void, col: any, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1 = <AtomProxy>iterator.next()\n    //\n    var n = iterator.size\n    var n1 = n - 1\n    var k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolateColor(i0, i1, colFn, col, k)\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolateColor(i0, i1, colFn, col, k)\n      k += 3 * this.m\n    }\n    //\n    col[ k ] = col[ k - 3 ]\n    col[ k + 1 ] = col[ k - 2 ]\n    col[ k + 2 ] = col[ k - 1 ]\n  }\n\n  //\n\n  private interpolatePicking (item1: AtomProxy, item2: AtomProxy, pickFn: (item: AtomProxy) => number, pick: Float32Array, offset: number) {\n    var j\n    for (j = 0; j < this.m2; ++j) {\n      pick[ offset + j ] = pickFn.apply(this, [item1])\n    }\n    for (j = this.m2; j < this.m; ++j) {\n      pick[ offset + j ] = pickFn.apply(this, [item2])\n    }\n  }\n\n  public getPicking (iterator: AtomIterator, pickFn: (item: AtomProxy) => number, pick: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1 = <AtomProxy>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolatePicking(i0, i1, pickFn, pick, k)\n      k += this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolatePicking(i0, i1, pickFn, pick, k)\n      k += this.m\n    }\n    //\n    pick[ k ] = pick[ k - 1 ]\n  }\n\n  //\n\n  private interpolateSize (item1: AtomProxy, item2: AtomProxy, sizeFn: (item: AtomProxy) => number, size: Float32Array, offset: number) {\n    const s1: number = sizeFn.apply(this, [item1])\n    const s2: number = sizeFn.apply(this, [item2])\n    for (let j = 0; j < this.m; ++j) {\n      // linear interpolation\n      let t = j / this.m\n      size[ offset + j ] = (1 - t) * s1 + t * s2\n    }\n  }\n\n  public getSize (iterator: AtomIterator, sizeFn: (item: AtomProxy) => number, size: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1: AtomProxy = <AtomProxy>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolateSize(i0, i1, sizeFn, size, k)\n      k += this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolateSize(i0, i1, sizeFn, size, k)\n      k += this.m\n    }\n    //\n    size[ k ] = size[ k - 1 ]\n  }\n}\n\nexport interface SplineParameters {\n  directional?: boolean\n  positionIterator?: boolean\n  subdiv?: number\n  smoothSheet?: boolean\n  tension?: number\n}\nexport interface AtomIterator {\n  size: number,\n  next: () => AtomProxy | Vector3,\n  get: (idx: number) => AtomProxy | Vector3,\n  reset: () => void\n}\nclass Spline {\n\n  polymer: Polymer\n  size: number\n  directional: boolean\n  positionIterator: any\n  subdiv: number\n  smoothSheet: boolean\n  tension: number\n  interpolator: Interpolator\n\n  constructor (polymer: Polymer, params?: SplineParameters) {\n    this.polymer = polymer\n      this.size = polymer.residueCount\n\n      var p = params || {}\n      this.directional = p.directional || false\n      this.positionIterator = p.positionIterator || false\n      this.subdiv = p.subdiv || 1\n      this.smoothSheet = p.smoothSheet || false\n\n      if (!p.tension) {\n        this.tension = this.polymer.isNucleic() ? 0.5 : 0.9\n      } else {\n        this.tension = p.tension\n      }\n\n      this.interpolator = new Interpolator(this.subdiv, this.tension)\n  }\n\n  getAtomIterator (type: string, smooth?: boolean): AtomIterator {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n\n    let i = 0\n    let j = -1\n\n    const cache = [\n      structure.getAtomProxy(),\n      structure.getAtomProxy(),\n      structure.getAtomProxy(),\n      structure.getAtomProxy()\n    ]\n\n    const cache2 = [\n      new Vector3(),\n      new Vector3(),\n      new Vector3(),\n      new Vector3()\n    ]\n\n    function next () {\n      var atomProxy = get(j)\n      j += 1\n      return atomProxy\n    }\n\n    var apPrev = structure.getAtomProxy()\n    var apNext = structure.getAtomProxy()\n\n    function get (idx: number) {\n      var atomProxy = cache[ i % 4 ]\n      atomProxy.index = polymer.getAtomIndexByType(idx, type) as number\n      if (smooth && idx > 0 && idx < n && atomProxy.sstruc === 'e') {\n        var vec = cache2[ i % 4 ]\n        apPrev.index = polymer.getAtomIndexByType(idx + 1, type) as number\n        apNext.index = polymer.getAtomIndexByType(idx - 1, type) as number\n        vec.addVectors(apPrev as any, apNext as any)\n          .add(atomProxy as any).add(atomProxy as any)\n          .multiplyScalar(0.25)\n        i += 1\n        return vec\n      }\n      i += 1\n      return atomProxy\n    }\n\n    function reset () {\n      i = 0\n      j = -1\n    }\n\n    return {\n      size: n,\n      next: next,\n      get: get,\n      reset: reset\n    }\n  }\n\n  getSubdividedColor (params: {scheme: string, [k: string]: any } & ColormakerParameters) {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nCol = n1 * m * 3 + 3\n    if (polymer.isCyclic) nCol += m * 3\n\n    var col = new Float32Array(nCol)\n    var iterator = this.getAtomIterator('trace')\n\n    var p = params || {}\n    p.structure = polymer.structure\n\n    var colormaker = ColormakerRegistry.getScheme(p)\n\n    function colFn (item: AtomProxy, array: NumberArray, offset: number) {\n      colormaker.atomColorToArray(item, array, offset)\n    }\n\n    this.interpolator.getColor(\n      iterator, colFn, col, 0, polymer.isCyclic\n    )\n\n    return {\n      'color': col\n    }\n  }\n  \n  getSubdividedPicking () {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nCol = n1 * m + 1\n    if (polymer.isCyclic) nCol += m\n\n    var structure = polymer.structure\n    var iterator = this.getAtomIterator('trace')\n    var pick = new Float32Array(nCol)\n\n    function pickFn (item: AtomProxy) {\n      return item.index\n    }\n\n    this.interpolator.getPicking(\n      iterator, pickFn, pick, 0, polymer.isCyclic\n    )\n\n    return {\n      'picking': new AtomPicker(pick, structure)\n    }\n  }\n\n  getSubdividedPosition () {\n    var pos = this.getPosition()\n\n    return {\n      'position': pos\n    }\n  }\n  \n  getSubdividedOrientation () {\n    const tan = this.getTangent()\n    const normals = this.getNormals(tan)\n\n    return {\n      'tangent': tan,\n      'normal': normals.normal,\n      'binormal': normals.binormal\n    }\n  }\n\n  getSubdividedSize (params: RadiusParams) {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nSize = n1 * m + 1\n    if (polymer.isCyclic) nSize += m\n\n    var size = new Float32Array(nSize)\n    var iterator = this.getAtomIterator('trace')\n\n    var radiusFactory = new RadiusFactory(params)\n\n    function sizeFn (item: AtomProxy) {\n      return radiusFactory.atomRadius(item)\n    }\n\n    this.interpolator.getSize(\n      iterator, sizeFn, size, 0, polymer.isCyclic\n    )\n\n    return {\n      'size': size\n    }\n  }\n\n  getPosition () {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const n = polymer.residueCount\n    const n1 = n - 1\n    let nPos = n1 * m * 3 + 3\n    if (polymer.isCyclic) nPos += m * 3\n\n    const pos = new Float32Array(nPos)\n    const iterator = this.positionIterator || this.getAtomIterator('trace', this.smoothSheet)\n\n    this.interpolator.getPosition(iterator, pos, 0, polymer.isCyclic)\n\n    return pos\n  }\n\n  getTangent () {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const n = this.size\n    const n1 = n - 1\n    let nTan = n1 * m * 3 + 3\n    if (polymer.isCyclic) nTan += m * 3\n\n    const tan = new Float32Array(nTan)\n    const iterator = this.positionIterator || this.getAtomIterator('trace', this.smoothSheet)\n\n    this.interpolator.getTangent(iterator, tan, 0, polymer.isCyclic)\n\n    return tan\n  }\n\n  getNormals (tan: Float32Array) {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const isProtein = polymer.isProtein()\n    const n = this.size\n    const n1 = n - 1\n    let nNorm = n1 * m * 3 + 3\n    if (polymer.isCyclic) nNorm += m * 3\n\n    const norm = new Float32Array(nNorm)\n    const bin = new Float32Array(nNorm)\n\n    if (this.directional && !this.polymer.isCg()) {\n      const iterDir1 = this.getAtomIterator('direction1')\n      const iterDir2 = this.getAtomIterator('direction2')\n      this.interpolator.getNormalDir(\n        iterDir1, iterDir2, tan, norm, bin, 0, polymer.isCyclic, isProtein\n      )\n    } else {\n      this.interpolator.getNormal(\n        n, tan, norm, bin, 0, polymer.isCyclic\n      )\n    }\n\n    return {\n      'normal': norm,\n      'binormal': bin\n    }\n  }\n\n}\n\nexport default Spline\n","/**\n * @file Tube Mesh Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Matrix4 required for declaration only\nimport { Vector3, Matrix4 } from 'three'\n\nimport { defaults, getUintArray } from '../utils'\nimport { serialArray } from '../math/array-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferDefaultParameters, BufferData, BufferParameters } from './buffer'\nimport {Log} from \"../globals\";\n\nconst vTangent = new Vector3()\nconst vMeshNormal = new Vector3()\n\nexport interface TubeMeshBufferData extends BufferData {\n  binormal: Float32Array\n  tangent: Float32Array\n  size: Float32Array\n}\n\nexport const TubeMeshBufferDefaultParameters = Object.assign({\n  radialSegments: 4,\n  capped: false,\n  aspectRatio: 1.0\n}, BufferDefaultParameters)\nexport type TubeMeshBufferParameters = BufferParameters & {\n  radialSegments: number,\n  capped: boolean,\n  aspectRatio: number\n}\n\nfunction getData (data: TubeMeshBufferData, params: Partial<TubeMeshBufferParameters> = {}) {\n  const radialSegments = defaults(params.radialSegments, 4)\n  const capped = defaults(params.capped, false)\n\n  const capVertices = capped ? radialSegments : 0\n  const capTriangles = capped ? radialSegments - 2 : 0\n\n  const n = data.position!.length / 3\n  const n1 = n - 1\n  const x = n * radialSegments * 3 + 2 * capVertices * 3\n  const xi = n1 * 2 * radialSegments * 3 + 2 * capTriangles * 3\n\n  return {\n    position: new Float32Array(x),\n    color: new Float32Array(x),\n    index: getUintArray(xi, x / 3),\n    normal: new Float32Array(x),\n    picking: data.picking\n  }\n}\n\n/**\n * Tube mesh buffer. Draws a tube.\n */\nclass TubeMeshBuffer extends MeshBuffer {\n  get defaultParameters() { return TubeMeshBufferDefaultParameters }\n  parameters: TubeMeshBufferParameters\n\n  capVertices: number\n  capTriangles: number\n  size2: number\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.normal - normals\n   * @param  {Float32Array} data.binormal - binormals\n   * @param  {Float32Array} data.tangent - tangents\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: TubeMeshBufferData, params: Partial<TubeMeshBufferParameters> = {}) {\n    super(getData(data, params), params)\n\n    this.capVertices = this.parameters.capped ? this.parameters.radialSegments : 0\n    this.capTriangles = this.parameters.capped ? this.parameters.radialSegments - 2 : 0\n\n    this.size2 = data.position!.length / 3\n    data.primitiveId = serialArray(this.size2)\n\n    this.setAttributes(data)\n    this.makeIndex()\n  }\n\n  setAttributes (data: Partial<TubeMeshBufferData> = {}) {\n    const aspectRatio = this.parameters.aspectRatio\n\n    const n = this.size2\n    const n1 = n - 1\n    const radialSegments = this.parameters.radialSegments\n\n    const attributes = this.geometry.attributes as any\n\n    let position, normal, binormal, tangent, color, size, primitiveId\n    let meshPosition, meshColor, meshNormal, meshPrimitiveId\n\n    if (data.position) {\n      position = data.position\n      normal = data.normal\n      binormal = data.binormal\n      tangent = data.tangent\n      size = data.size\n\n      meshPosition = attributes.position.array\n      meshNormal = attributes.normal.array\n\n      attributes.position.needsUpdate = true\n      attributes.normal.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      meshColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (data.primitiveId) {\n      primitiveId = data.primitiveId\n      meshPrimitiveId = attributes.primitiveId.array\n      attributes.primitiveId.needsUpdate = true\n    }\n\n    let k, l\n    let radius = 0\n\n    let normX = 0\n    let normY = 0\n    let normZ = 0\n    let biX = 0\n    let biY = 0\n    let biZ = 0\n    let posX = 0\n    let posY = 0\n    let posZ = 0\n\n    const cxArr = []\n    const cyArr = []\n    const cx1Arr = []\n    const cy1Arr = []\n    const cx2Arr = []\n    const cy2Arr = []\n\n    if (position) {\n      for (let j = 0; j < radialSegments; ++j) {\n        const v = (j / radialSegments) * 2 * Math.PI\n\n        cxArr[ j ] = aspectRatio * Math.cos(v)\n        cyArr[ j ] = Math.sin(v)\n\n        cx1Arr[ j ] = aspectRatio * Math.cos(v - 0.01)\n        cy1Arr[ j ] = Math.sin(v - 0.01)\n        cx2Arr[ j ] = aspectRatio * Math.cos(v + 0.01)\n        cy2Arr[ j ] = Math.sin(v + 0.01)\n      }\n    }\n\n    for (let i = 0; i < n; ++i) {\n      k = i * 3\n      l = k * radialSegments\n\n      if (position && tangent && normal && binormal && size) {\n        vTangent.set(\n          tangent[ k ], tangent[ k + 1 ], tangent[ k + 2 ]\n        )\n\n        normX = normal[ k ]\n        normY = normal[ k + 1 ]\n        normZ = normal[ k + 2 ]\n\n        biX = binormal[ k ]\n        biY = binormal[ k + 1 ]\n        biZ = binormal[ k + 2 ]\n\n        posX = position[ k ]\n        posY = position[ k + 1 ]\n        posZ = position[ k + 2 ]\n\n        radius = size[ i ]\n      }\n\n      for (let j = 0; j < radialSegments; ++j) {\n        const s = l + j * 3\n\n        if (position) {\n          const cx = -radius * cxArr[ j ] // TODO: Hack: Negating it so it faces outside.\n          const cy = radius * cyArr[ j ]\n\n          const cx1 = -radius * cx1Arr[ j ]\n          const cy1 = radius * cy1Arr[ j ]\n          const cx2 = -radius * cx2Arr[ j ]\n          const cy2 = radius * cy2Arr[ j ]\n\n          meshPosition[ s ] = posX + cx * normX + cy * biX\n          meshPosition[ s + 1 ] = posY + cx * normY + cy * biY\n          meshPosition[ s + 2 ] = posZ + cx * normZ + cy * biZ\n\n                    // TODO half of these are symmetric\n          vMeshNormal.set(\n            // ellipse tangent approximated as vector from/to adjacent points\n            (cx2 * normX + cy2 * biX) - (cx1 * normX + cy1 * biX),\n            (cx2 * normY + cy2 * biY) - (cx1 * normY + cy1 * biY),\n            (cx2 * normZ + cy2 * biZ) - (cx1 * normZ + cy1 * biZ)\n          ).cross(vTangent)\n\n          meshNormal[ s ] = vMeshNormal.x\n          meshNormal[ s + 1 ] = vMeshNormal.y\n          meshNormal[ s + 2 ] = vMeshNormal.z\n        }\n\n        if (color) {\n          meshColor[ s ] = color[ k ]\n          meshColor[ s + 1 ] = color[ k + 1 ]\n          meshColor[ s + 2 ] = color[ k + 2 ]\n        }\n\n        if (primitiveId) {\n          meshPrimitiveId[ i * radialSegments + j ] = primitiveId[ i ]\n        }\n      }\n    }\n\n        // front cap\n\n    k = 0\n    l = n * 3 * radialSegments\n\n    for (let j = 0; j < radialSegments; ++j) {\n      const s = k + j * 3\n      const t = l + j * 3\n\n      if (position && tangent) {\n        meshPosition[ t ] = meshPosition[ s ]\n        meshPosition[ t + 1 ] = meshPosition[ s + 1 ]\n        meshPosition[ t + 2 ] = meshPosition[ s + 2 ]\n\n        meshNormal[ t ] = tangent[ k ]\n        meshNormal[ t + 1 ] = tangent[ k + 1 ]\n        meshNormal[ t + 2 ] = tangent[ k + 2 ]\n      }\n\n      if (color) {\n        meshColor[ t ] = meshColor[ s ]\n        meshColor[ t + 1 ] = meshColor[ s + 1 ]\n        meshColor[ t + 2 ] = meshColor[ s + 2 ]\n      }\n\n      if (primitiveId) {\n        meshPrimitiveId[ n * radialSegments + j ] = meshPrimitiveId[ 0 + j ]\n      }\n    }\n\n        // back cap\n\n    k = (n - 1) * 3 * radialSegments\n    l = (n + 1) * 3 * radialSegments\n\n    for (let j = 0; j < radialSegments; ++j) {\n      const s = k + j * 3\n      const t = l + j * 3\n\n      if (position && tangent) {\n        meshPosition[ t ] = meshPosition[ s ]\n        meshPosition[ t + 1 ] = meshPosition[ s + 1 ]\n        meshPosition[ t + 2 ] = meshPosition[ s + 2 ]\n\n        meshNormal[ t ] = tangent[ n1 * 3 ]\n        meshNormal[ t + 1 ] = tangent[ n1 * 3 + 1 ]\n        meshNormal[ t + 2 ] = tangent[ n1 * 3 + 2 ]\n      }\n\n      if (color) {\n        meshColor[ t ] = meshColor[ s ]\n        meshColor[ t + 1 ] = meshColor[ s + 1 ]\n        meshColor[ t + 2 ] = meshColor[ s + 2 ]\n      }\n\n      if (primitiveId) {\n        meshPrimitiveId[ (n + 1) * radialSegments + j ] = meshPrimitiveId[ (n - 1) * radialSegments + j ]\n      }\n    }\n  }\n\n  makeIndex () {\n    const index = this.geometry.getIndex()\n    if (!index) { Log.error('Index is null'); return; }\n    const meshIndex = index.array as Uint32Array|Uint16Array\n\n    const n = this.size2\n    const n1 = n - 1\n    const capTriangles = this.capTriangles\n    const radialSegments = this.parameters.radialSegments\n    const radialSegments1 = this.parameters.radialSegments + 1\n\n    let k, l\n\n    for (let i = 0; i < n1; ++i) {\n      const k = i * radialSegments * 3 * 2\n\n      const irs = i * radialSegments\n      const irs1 = (i + 1) * radialSegments\n\n      for (let j = 0; j < radialSegments; ++j) {\n        l = k + j * 3 * 2\n\n        // meshIndex[ l + 0 ] = irs + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l ] = irs + j\n        meshIndex[ l + 1 ] = irs + ((j + 1) % radialSegments)\n        // meshIndex[ l + 2 ] = irs1 + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l + 2 ] = irs1 + j\n\n        // meshIndex[ l + 3 ] = irs1 + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l + 3 ] = irs1 + j\n        meshIndex[ l + 4 ] = irs + ((j + 1) % radialSegments)\n        meshIndex[ l + 5 ] = irs1 + ((j + 1) % radialSegments)\n      }\n    }\n\n    // capping\n\n    const strip = [ 0 ]\n\n    for (let j = 1; j < radialSegments1 / 2; ++j) {\n      strip.push(j)\n      if (radialSegments - j !== j) {\n        strip.push(radialSegments - j)\n      }\n    }\n\n    // front cap\n\n    l = n1 * radialSegments * 3 * 2\n    k = n * radialSegments\n\n    for (let j = 0; j < strip.length - 2; ++j) {\n      if (j % 2 === 0) {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 0 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 2 ]\n      } else {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 2 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 0 ]\n      }\n    }\n\n    // back cap\n\n    l = n1 * radialSegments * 3 * 2 + 3 * capTriangles\n    k = n * radialSegments + radialSegments\n\n    for (let j = 0; j < strip.length - 2; ++j) {\n      if (j % 2 === 0) {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 0 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 2 ]\n      } else {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 2 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 0 ]\n      }\n    }\n  }\n}\n\nexport default TubeMeshBuffer\n","/**\n * @file Cartoon Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { Debug, Log, RepresentationRegistry } from '../globals'\nimport Spline from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport TubeMeshBuffer from '../buffer/tubemesh-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport Polymer from '../proxy/polymer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Buffer from '../buffer/buffer';\n\nexport interface CartoonRepresentationParameters extends StructureRepresentationParameters {\n  aspectRatio: number\n  subdiv: number\n  radialSegments: number\n  tension: number\n  capped: boolean\n  smoothSheet: boolean\n}\n\n/**\n * Cartoon representation. Show a thick ribbon that\n * smoothly connecting backbone atoms in polymers.\n *\n * __Name:__ _cartoon_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"cartoon\" );\n *     o.autoView();\n * } );\n */\nclass CartoonRepresentation extends StructureRepresentation {\n  protected aspectRatio: number\n  protected tension: number\n  protected capped: boolean\n  protected smoothSheet: boolean\n  protected subdiv: number\n  \n  /**\n   * Create Cartoon representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {StructureRepresentationParameters} params - representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'cartoon'\n\n    this.parameters = Object.assign({\n\n      aspectRatio: {\n        type: 'number', precision: 1, max: 10.0, min: 1.0, rebuild: true\n      },\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      radialSegments: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      capped: {\n        type: 'boolean', rebuild: true\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n    p.radiusType = defaults(p.radiusType, 'sstruc')\n    p.radiusScale = defaults(p.radiusScale, 0.7)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.aspectRatio = defaults(p.aspectRatio, 5.0)\n    this.tension = defaults(p.tension, NaN)\n    this.capped = defaults(p.capped, true)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n      this.radialSegments = 6\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: Partial<CartoonRepresentationParameters>) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: this.aspectRatio !== 1.0,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getSpline (polymer: Polymer): Spline {\n    return new Spline(polymer, this.getSplineParams())\n  }\n\n  getAspectRatio (polymer: Polymer): number {\n    return polymer.isCg() ? 1.0 : this.aspectRatio\n  }\n\n  getAtomRadius (atom: AtomProxy): number {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  createData (sview: StructureView) {\n    let bufferList: Buffer[] = []\n    let polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      const spline = this.getSpline(polymer)\n      const aspectRatio = this.getAspectRatio(polymer)\n\n      const subPos = spline.getSubdividedPosition()\n      const subOri = spline.getSubdividedOrientation()\n      const subCol = spline.getSubdividedColor(this.getColorParams())\n      const subPick = spline.getSubdividedPicking()\n      const subSize = spline.getSubdividedSize(this.getRadiusParams())\n\n      bufferList.push(\n        new TubeMeshBuffer(\n          Object.assign({}, subPos, subOri, subCol, subPick, subSize),\n          this.getBufferParams({\n            radialSegments: this.radialSegments,\n            aspectRatio: aspectRatio,\n            capped: this.capped\n          })\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    if (Debug) Log.time(this.type + ' repr update')\n\n    what = what || {}\n\n    for (var i = 0, il = data.polymerList!.length; i < il; ++i) {\n      var bufferData: {[key: string]: any} = {}\n      var polymer = data.polymerList![ i ]\n      var spline = this.getSpline(polymer)\n      var aspectRatio = this.getAspectRatio(polymer)\n\n      Object.assign(data.bufferList[ i ], {aspectRatio: aspectRatio})\n\n      if (what.position || what.radius) {\n        var subPos = spline.getSubdividedPosition()\n        var subOri = spline.getSubdividedOrientation()\n        var subSize = spline.getSubdividedSize(this.getRadiusParams(aspectRatio))\n\n        bufferData.position = subPos.position\n        bufferData.normal = subOri.normal\n        bufferData.binormal = subOri.binormal\n        bufferData.tangent = subOri.tangent\n        bufferData.size = subSize.size\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        bufferData.color = subCol.color\n      }\n\n      if (what.picking) {\n        var subPick = spline.getSubdividedPicking()\n        bufferData.picking = subPick.picking\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n\n    if (Debug) Log.timeEnd(this.type + ' repr update')\n  }\n\n  setParameters (params: Partial<CartoonRepresentationParameters>) {\n    const rebuild = false\n    var what: {[k: string]: any} = {}\n\n    if (params && params.aspectRatio) {\n      what.radius = true\n    }\n\n    if (params && params.tension) {\n      what.position = true\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('cartoon', CartoonRepresentation)\n\nexport default CartoonRepresentation\n","/**\n * @file Contact Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport { calculateContacts, getContactData, getLabelData } from '../chemistry/interactions/contact'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport TextBuffer from '../buffer/text-buffer'\nimport { getFixedCountDashData } from '../geometry/dash'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n// @ts-ignore: unused import ContactPicker required for declaration only\nimport { ContactPicker } from '../utils/picker';\n\nexport interface ContactRepresentationParameters extends StructureRepresentationParameters {\n  hydrogenBond: boolean\n  weakHydrogenBond: boolean\n  waterHydrogenBond: boolean\n  backboneHydrogenBond: boolean\n  hydrophobic: boolean\n  halogenBond: boolean\n  ionicInteraction: boolean\n  metalCoordination: boolean\n  cationPi: boolean\n  piStacking: boolean\n  filterSele: string|[string, string]\n  maxHydrophobicDist: number\n  maxHbondDist: number\n  maxHbondSulfurDist: number\n  maxHbondAccAngle: number\n  maxHbondDonAngle: number\n  maxHbondAccPlaneAngle: number\n  maxHbondDonPlaneAngle: number\n  maxPiStackingDist: number\n  maxPiStackingOffset: number\n  maxPiStackingAngle: number\n  maxCationPiDist: number\n  maxCationPiOffset: number\n  maxIonicDist: number\n  maxHalogenBondDist: number\n  maxHalogenBondAngle: number\n  maxMetalDist: number\n  refineSaltBridges: boolean\n  masterModelIndex: number\n  lineOfSightDistFactor: number\n}\n\n/**\n * Contact representation.\n */\nclass ContactRepresentation extends StructureRepresentation {\n  protected hydrogenBond: boolean\n  protected weakHydrogenBond: boolean\n  protected waterHydrogenBond: boolean\n  protected backboneHydrogenBond: boolean\n  protected hydrophobic: boolean\n  protected halogenBond: boolean\n  protected ionicInteraction: boolean\n  protected metalCoordination: boolean\n  protected cationPi: boolean\n  protected piStacking: boolean\n  protected filterSele: string|[string, string]\n  protected maxHydrophobicDist: number\n  protected maxHbondDist: number\n  protected maxHbondSulfurDist: number\n  protected maxHbondAccAngle: number\n  protected maxHbondDonAngle: number\n  protected maxHbondAccPlaneAngle: number\n  protected maxHbondDonPlaneAngle: number\n  protected maxPiStackingDist: number\n  protected maxPiStackingOffset: number\n  protected maxPiStackingAngle: number\n  protected maxCationPiDist: number\n  protected maxCationPiOffset: number\n  protected maxIonicDist: number\n  protected maxHalogenBondDist: number\n  protected maxHalogenBondAngle: number\n  protected maxMetalDist: number\n  protected refineSaltBridges: boolean\n  protected masterModelIndex: number\n  protected lineOfSightDistFactor: number\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<ContactRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'contact'\n\n    this.parameters = Object.assign({\n      hydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      weakHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      waterHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      backboneHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      hydrophobic: {\n        type: 'boolean', rebuild: true\n      },\n      halogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      ionicInteraction: {\n        type: 'boolean', rebuild: true\n      },\n      metalCoordination: {\n        type: 'boolean', rebuild: true\n      },\n      cationPi: {\n        type: 'boolean', rebuild: true\n      },\n      piStacking: {\n        type: 'boolean', rebuild: true\n      },\n\n      filterSele: {\n        type: 'text', rebuild: true\n      },\n\n      labelVisible: {\n        type: 'boolean', rebuild: true\n      },\n\n      labelFixedSize: {\n        type: 'boolean', buffer: 'fixedSize'\n      },\n\n      labelSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001, rebuild: true\n      },\n\n      labelUnit: {\n        type: 'select',\n        rebuild: true,\n        options: { '': '', angstrom: 'angstrom', nm: 'nm' }\n      },\n\n      maxHydrophobicDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondSulfurDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondAccAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxHbondDonAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxHbondAccPlaneAngle: {\n        type: 'integer', max: 90, min: 0, rebuild: true\n      },\n      maxHbondDonPlaneAngle: {\n        type: 'integer', max: 90, min: 0, rebuild: true\n      },\n      maxPiStackingDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxPiStackingOffset: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxPiStackingAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxCationPiDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxCationPiOffset: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxIonicDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHalogenBondDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHalogenBondAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxMetalDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      refineSaltBridges: {\n        type: 'boolean', rebuild: true\n      },\n      masterModelIndex: {\n        type: 'integer', max: 1000, min: -1, rebuild: true\n      },\n      lineOfSightDistFactor: {\n        type: 'number', precision: 1, max: 10, min: 0.0, rebuild: true\n      },\n\n      radialSegments: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<ContactRepresentationParameters>) {\n    var p = params || {}\n    p.radiusSize = defaults(p.radiusSize, 0.05)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.hydrogenBond = defaults(p.hydrogenBond, true)\n    this.weakHydrogenBond = defaults(p.weakHydrogenBond, false)\n    this.waterHydrogenBond = defaults(p.waterHydrogenBond, false)\n    this.backboneHydrogenBond = defaults(p.backboneHydrogenBond, false)\n    this.hydrophobic = defaults(p.hydrophobic, false)\n    this.halogenBond = defaults(p.halogenBond, true)\n    this.ionicInteraction = defaults(p.ionicInteraction, true)\n    this.metalCoordination = defaults(p.metalCoordination, true)\n    this.cationPi = defaults(p.cationPi, true)\n    this.piStacking = defaults(p.piStacking, true)\n\n    this.filterSele = defaults(p.filterSele, '')\n    this.labelVisible = defaults(p.labelVisible, false)\n    this.labelFixedSize = defaults(p.labelFixedSize, false)\n    this.labelSize = defaults(p.labelSize, 2.0)\n    this.labelUnit = defaults(p.labelUnit, '')\n\n    this.maxHydrophobicDist = defaults(p.maxHydrophobicDist, 4.0)\n    this.maxHbondDist = defaults(p.maxHbondDist, 3.5)\n    this.maxHbondSulfurDist = defaults(p.maxHbondSulfurDist, 4.1)\n    this.maxHbondAccAngle = defaults(p.maxHbondAccAngle, 45)\n    this.maxHbondDonAngle = defaults(p.maxHbondDonAngle, 45)\n    this.maxHbondAccPlaneAngle = defaults(p.maxHbondAccPlaneAngle, 90)\n    this.maxHbondDonPlaneAngle = defaults(p.maxHbondDonPlaneAngle, 30)\n    this.maxPiStackingDist = defaults(p.maxPiStackingDist, 5.5)\n    this.maxPiStackingOffset = defaults(p.maxPiStackingOffset, 2.0)\n    this.maxPiStackingAngle = defaults(p.maxPiStackingAngle, 30)\n    this.maxCationPiDist = defaults(p.maxCationPiDist, 6.0)\n    this.maxCationPiOffset = defaults(p.maxCationPiOffset, 2.0)\n    this.maxIonicDist = defaults(p.maxIonicDist, 5.0)\n    this.maxHalogenBondDist = defaults(p.maxHalogenBondDist, 3.5)\n    this.maxHalogenBondAngle = defaults(p.maxHalogenBondAngle, 30)\n    this.maxMetalDist = defaults(p.maxMetalDist, 3.0)\n    this.refineSaltBridges = defaults(p.refineSaltBridges, true)\n    this.masterModelIndex = defaults(p.masterModelIndex, -1)\n    this.lineOfSightDistFactor = defaults(p.lineOfSightDistFactor, 1.0)\n\n    super.init(p)\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n\n  getContactData (sview: StructureView) {\n    const params = {\n      maxHydrophobicDist: this.maxHydrophobicDist,\n      maxHbondDist: this.maxHbondDist,\n      maxHbondSulfurDist: this.maxHbondSulfurDist,\n      maxHbondAccAngle: this.maxHbondAccAngle,\n      maxHbondDonAngle: this.maxHbondDonAngle,\n      maxHbondAccPlaneAngle: this.maxHbondAccPlaneAngle,\n      maxHbondDonPlaneAngle: this.maxHbondDonPlaneAngle,\n      maxPiStackingDist: this.maxPiStackingDist,\n      maxPiStackingOffset: this.maxPiStackingOffset,\n      maxPiStackingAngle: this.maxPiStackingAngle,\n      maxCationPiDist: this.maxCationPiDist,\n      maxCationPiOffset: this.maxCationPiOffset,\n      maxIonicDist: this.maxIonicDist,\n      maxHalogenBondDist: this.maxHalogenBondDist,\n      maxHalogenBondAngle: this.maxHalogenBondAngle,\n      maxMetalDist: this.maxMetalDist,\n      refineSaltBridges: this.refineSaltBridges,\n      masterModelIndex: this.masterModelIndex,\n      lineOfSightDistFactor: this.lineOfSightDistFactor\n    }\n\n    const dataParams = {\n      hydrogenBond: this.hydrogenBond,\n      weakHydrogenBond: this.weakHydrogenBond,\n      waterHydrogenBond: this.waterHydrogenBond,\n      backboneHydrogenBond: this.backboneHydrogenBond,\n      hydrophobic: this.hydrophobic,\n      halogenBond: this.halogenBond,\n      ionicInteraction: this.ionicInteraction,\n      metalCoordination: this.metalCoordination,\n      cationPi: this.cationPi,\n      piStacking: this.piStacking,\n      radius: this.radiusSize * this.radiusScale,\n      filterSele: this.filterSele\n    }\n\n    const contacts = calculateContacts(sview, params)\n    return getContactData(contacts, sview, dataParams)\n  }\n\n  createData (sview: StructureView) {\n    const contactData = this.getContactData(sview)\n\n    const bufferList = [\n      new CylinderBuffer(\n        getFixedCountDashData(contactData),\n        this.getBufferParams({\n          sphereDetail: 1,\n          dullInterior: true,\n          disableImpostor: this.disableImpostor\n        })\n      ) as (CylinderGeometryBuffer | CylinderImpostorBuffer | TextBuffer)\n    ]\n\n    if (this.labelVisible) {\n      const labelParams = {\n        size: this.labelSize,\n        unit: this.labelUnit\n      }\n      bufferList.push(new TextBuffer(\n        getLabelData(contactData, labelParams),\n        this.getBufferParams({fixedSize: this.labelFixedSize})\n      ))\n    }\n\n    return { bufferList }\n  }\n}\n\nRepresentationRegistry.add('contact', ContactRepresentation)\n\nexport default ContactRepresentation\n","/**\n * @file Dihedral Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport MeasurementRepresentation, { calcArcPoint, parseNestedAtoms, MeasurementRepresentationParameters, LabelDataField } from './measurement-representation'\nimport { defaults } from '../utils'\n\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\n\nimport { copyArray, uniformArray, uniformArray3 } from '../math/array-utils'\nimport { v3add, v3angle, v3cross, v3dot, v3multiplyScalar, v3fromArray, v3length,\n  v3negate, v3new, v3normalize, v3sub, v3toArray } from '../math/vector-utils'\nimport { RAD2DEG } from '../math/math-constants'\nimport { getFixedLengthWrappedDashData } from '../geometry/dash'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { CylinderBufferData } from '../buffer/cylinder-buffer';\nimport { BufferData } from '../buffer/buffer';\nimport { StructureRepresentationData } from './structure-representation';\n\n/**\n * @typedef {Object} DihedralRepresentationParameters - dihedral representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} atomQuad - list of quadruplets of selection strings\n *                               or atom indices\n * @property {Boolean} extendLine - Extend lines in planes\n * @property {Number} lineOpacity - Opacity for the line part of the representation\n * @property {Boolean} lineVisible - Display the line part of the representation\n * @property {Number} linewidth - width for line part of representation\n * @property {Boolean} planeVisible - Display the two planes corresponding to dihedral\n * @property {Boolean} sectorVisible - Display the filled arc for each angle\n */\n\nexport interface DihedralRepresentationParameters extends MeasurementRepresentationParameters {\n  atomQuad: (number|string)[][]\n  extendLine: boolean\n  lineOpacity: number\n  lineVisible: boolean\n  linewidth: number\n  planeVisible: boolean\n  sectorVisible: boolean\n}\n\n/**\n * Dihedral representation object\n *\n * Reperesentation consists of three parts, visibility can be set for each\n * label - text label indicating dihedral angle\n * line - line indicating four positions that define the dihedral\n * sector - filled arc section\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {AngleRepresentationParameters} params - angle representation parameters\n */\nclass DihedralRepresentation extends MeasurementRepresentation {\n  protected atomQuad: (number|string)[][]\n  protected extendLine: boolean\n  protected lineOpacity: number\n  protected lineVisible: boolean\n  protected linewidth: number\n  protected planeVisible: boolean\n  protected sectorVisible: boolean\n\n  protected lineLength: number\n  protected planeLength: number\n  protected sectorLength: number\n\n  protected lineBuffer: WideLineBuffer\n  protected planeBuffer: MeshBuffer\n  protected sectorBuffer: MeshBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<DihedralRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'dihedral'\n\n    this.parameters = Object.assign({\n      atomQuad: {\n        type: 'hidden', rebuild: true\n      },\n      extendLine: {\n        type: 'boolean', rebuild: true, default: true\n      },\n      lineVisible: {\n        type: 'boolean', default: true\n      },\n      planeVisible: {\n        type: 'boolean', default: true\n      },\n      sectorVisible: {\n        type: 'boolean', default: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<DihedralRepresentationParameters>) {\n    const p = params || {}\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n\n    this.atomQuad = defaults(p.atomQuad, [])\n    this.extendLine = defaults(p.extendLine, true)\n    this.lineVisible = defaults(p.lineVisible, true)\n    this.planeVisible = defaults(p.planeVisible, true)\n    this.sectorVisible = defaults(p.sectorVisible, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomQuad.length) return\n\n    const atomPosition = parseNestedAtoms(sview, this.atomQuad)\n    const dihedralData = getDihedralData(\n      atomPosition, {\n        extendLine: this.extendLine\n      }\n    )\n\n    const n = this.n = dihedralData.labelText.length\n    const labelColor = new Color(this.labelColor)\n\n    this.textBuffer = new TextBuffer({\n      position: dihedralData.labelPosition,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, labelColor.r, labelColor.g, labelColor.b),\n      text: dihedralData.labelText\n    } as TextBufferData, this.getLabelBufferParams())\n\n    const c = new Color(this.colorValue)\n    this.lineLength = dihedralData.linePosition1.length / 3\n    const lineColor = uniformArray3(this.lineLength, c.r, c.g, c.b)\n\n    this.lineBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: dihedralData.linePosition1,\n        position2: dihedralData.linePosition2,\n        color: lineColor,\n        color2: lineColor\n      } as CylinderBufferData) ,\n      this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.lineVisible,\n        opacity: this.lineOpacity\n      })\n    )\n\n    this.planeLength = dihedralData.planePosition.length / 3\n    this.planeBuffer = new MeshBuffer({\n      position: dihedralData.planePosition,\n      color: uniformArray3(this.planeLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.planeVisible\n    }))\n\n    this.sectorLength = dihedralData.sectorPosition.length / 3\n    this.sectorBuffer = new MeshBuffer({\n      position: dihedralData.sectorPosition,\n      color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.sectorVisible\n    }))\n\n    return {\n      bufferList: [\n        this.textBuffer,\n        this.lineBuffer,\n        this.planeBuffer,\n        this.sectorBuffer\n      ]\n    }\n  }\n\n  updateData (what: LabelDataField & {color?: boolean}, data: StructureRepresentationData) {\n    super.updateData(what, data)\n    const lineData = {}\n    const planeData = {}\n    const sectorData = {}\n\n    if (what.color) {\n      const c = new Color(this.colorValue)\n      Object.assign(lineData, {\n        color: uniformArray3(this.lineLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.lineLength, c.r, c.g, c.b)\n      })\n      Object.assign(planeData, {\n        color: uniformArray3(this.planeLength, c.r, c.g, c.b)\n      })\n      Object.assign(sectorData, {\n        color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n      })\n    }\n\n    this.lineBuffer.setAttributes(lineData)\n    this.planeBuffer.setAttributes(planeData)\n    this.sectorBuffer.setAttributes(sectorData)\n  }\n\n  setParameters (params: Partial<DihedralRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && (\n      params.lineVisible !== undefined ||\n      params.sectorVisible !== undefined ||\n      params.planeVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n\n    if (params && params.lineOpacity) {\n      this.lineBuffer.setParameters({ opacity: params.lineOpacity })\n    }\n\n    if (params && params.opacity !== undefined) {\n      this.lineBuffer.setParameters({ opacity: this.lineOpacity })\n    }\n\n    if (params && params.linewidth) {\n      this.lineBuffer.setParameters({ linewidth: params.linewidth })\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n\n    if (this.lineBuffer) {\n      this.lineBuffer.setVisibility(this.lineVisible && this.visible)\n    }\n\n    if (this.planeBuffer) {\n      this.planeBuffer.setVisibility(this.planeVisible && this.visible)\n    }\n\n    if (this.sectorBuffer) {\n      this.sectorBuffer.setVisibility(this.sectorVisible && this.visible)\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n}\n\n/**\n * Build the data required to create {Buffer} objects, given positions\n * @param  {Float32Array} atomPosition 3*4*nDihedral array of coordinates\n * @return {Object}              Arrays for building buffers\n */\nfunction getDihedralData (position: Float32Array, params: Partial<DihedralRepresentationParameters> = {}) {\n  const angleStep = defaults(params.angleStep, Math.PI / 90)\n  const nPos = position.length\n  const n = position.length / 12\n  const angles = new Float32Array(n)\n  const labelPosition = new Float32Array(n * 3)\n  const labelText = new Array(n)\n\n  // Temporary arrays as don't know output length yet\n  const lineTmp1 = new Array(n)\n  const lineTmp2 = new Array(n)\n  const sectorTmp = new Array(n)\n  const planeTmp = new Array(n)\n\n  // Eventual sizes of output arrays\n  let totalLines = 0\n  let totalSegments = 0\n  let totalPlanes = 0\n\n  const p1 = v3new()\n  const p2 = v3new()\n  const p3 = v3new()\n  const p4 = v3new()\n\n  const v21 = v3new()\n  const v23 = v3new()\n  const v34 = v3new()\n\n  const tmp = v3new()\n  const mid = v3new()\n  const inPlane1 = v3new()\n  const inPlane2 = v3new()\n  const start = v3new()\n  const end = v3new()\n\n  const cross = v3new()\n  const arcPoint = v3new()\n\n  let i = 0 // Actual output index (after skipping inappropriate)\n\n  for (var p = 0; p < nPos; p += 12) {\n    // Set Positions\n    v3fromArray(p1, position, p)\n    v3fromArray(p2, position, p + 3)\n    v3fromArray(p3, position, p + 6)\n    v3fromArray(p4, position, p + 9)\n\n    // Vectors between points\n    v3sub(v21, p1, p2)\n    v3sub(v23, p3, p2)\n    if (v3length(v23) === 0.0) {\n      continue // Can't define axis\n    }\n\n    v3sub(v34, p4, p3)\n\n    v3multiplyScalar(tmp, v23, 0.5)\n    v3add(mid, p2, tmp)\n\n    v3normalize(v21, v21)\n    v3normalize(v23, v23)\n    v3normalize(v34, v34)\n\n    // Which side of plane are p1, p4 (are we measuring something that\n    // looks more like an improper? e.g. C, CA, CB, N)\n    v3sub(tmp, p1, mid)\n    const improperStart = v3dot(tmp, v23) > 0.0\n    v3sub(tmp, p4, mid)\n    const improperEnd = v3dot(tmp, v23) < 0.0\n\n    // Calculate vectors perp to v23 (lying in plane (1,2,3) and (2,3,4))\n    v3multiplyScalar(tmp, v23, v3dot(v23, v21))\n    v3sub(inPlane1, v21, tmp)\n\n    v3multiplyScalar(tmp, v23, v3dot(v23, v34))\n    v3sub(inPlane2, v34, tmp)\n\n    if (v3length(inPlane1) === 0.0 || v3length(inPlane2) === 0.0) {\n      continue // Indeterminate angle\n    }\n\n    v3normalize(inPlane1, inPlane1)\n    v3normalize(inPlane2, inPlane2)\n\n    const angle = angles[ i ] = v3angle(inPlane1, inPlane2)\n    labelText[ i ] = (RAD2DEG * angle).toFixed(1) + String.fromCharCode(0x00B0)\n\n    v3cross(cross, inPlane1, v23)\n    v3normalize(cross, cross)\n    if (v3dot(cross, inPlane2) < 0.0) {\n      v3negate(cross, cross) // Ensure cp faces correct way\n    }\n\n    calcArcPoint(tmp, mid, inPlane1, cross, angle / 2.0)\n    v3toArray(tmp, labelPosition, 3 * i)\n\n    const nSegments = Math.ceil(angle / angleStep)\n    // For extended display mode, 4 straight lines plus arc/segment edge\n    // For non-extended, 2 straight lines plus segment edge\n    const nLines = nSegments + ((params.extendLine) ? 4 : 2)\n\n    // Don't draw planes if not extending lines\n    const nPlanes = params.extendLine ? 36 : 0\n\n    const line1 = new Float32Array(nLines * 3)\n    const line2 = new Float32Array(nLines * 3)\n    const sector = new Float32Array(nSegments * 9)\n    // 2 planes, 2 triangles each per dihedral (2*2*9)\n    const plane = new Float32Array(nPlanes)\n\n    lineTmp1[ i ] = line1\n    lineTmp2[ i ] = line2\n    sectorTmp[ i ] = sector\n    planeTmp[ i ] = plane\n\n    // Start points for lines/planes, only required\n    // if extending lines\n    if (params.extendLine) {\n      if (improperStart) { // We'll start on the v3->1 line (tmp)\n        v3sub(tmp, p1, p3)\n        v3normalize(tmp, tmp)\n        v3multiplyScalar(start, tmp, 1.0 / v3dot(inPlane1, tmp))\n        v3add(start, start, p3)\n      } else { // start on the 2->1 line\n        v3multiplyScalar(start, v21, 1.0 / v3dot(inPlane1, v21))\n        v3add(start, start, p2)\n      }\n\n      if (improperEnd) { // Finish on 2->4 line\n        v3sub(tmp, p4, p2)\n        v3normalize(tmp, tmp)\n        v3multiplyScalar(end, tmp, 1.0 / v3dot(inPlane2, tmp))\n        v3add(end, end, p2)\n      } else { // end on the 3->4 line\n        v3multiplyScalar(end, v34, 1.0 / v3dot(inPlane2, v34))\n        v3add(end, end, p3)\n      }\n    }\n\n    v3add(arcPoint, mid, inPlane1)\n\n    // index into line1, line2\n    let li = 0\n    // If extending lines, there's a bit of stuff to do here\n    // figuring out start and end positions\n    if (params.extendLine) {\n      v3toArray(p1, line1, li)\n      v3toArray(start, line2, li)\n      li += 3\n      v3toArray(start, line1, li)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n\n      // Construct plane at start, if not extening lines\n      // this is skipped\n      v3toArray(start, plane, 0)\n      v3toArray(arcPoint, plane, 3)\n      v3toArray(improperStart ? p3 : p2, plane, 6)\n      v3toArray(improperStart ? p3 : p2, plane, 9)\n      v3toArray(arcPoint, plane, 12)\n      v3toArray(mid, plane, 15)\n    } else {\n      // Not extending lines\n      v3toArray(mid, line1, li)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n    }\n\n    const appendArcSection = function (a: number, j: number) {\n      const si = j * 9\n\n      v3toArray(mid, sector, si)\n      v3toArray(arcPoint, sector, si + 3)\n      v3toArray(arcPoint, line1, li)\n\n      calcArcPoint(arcPoint, mid, inPlane1, cross, a)\n\n      v3toArray(arcPoint, sector, si + 6)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n    }\n\n    let j = 0\n    for (let a = angleStep; a < angle; a += angleStep) {\n      appendArcSection(a, j++)\n    }\n    appendArcSection(angle, j++)\n\n    if (params.extendLine) {\n      v3toArray(arcPoint, line1, (nLines - 2) * 3)\n      v3toArray(end, line2, (nLines - 2) * 3)\n      v3toArray(end, line1, (nLines - 1) * 3)\n      v3toArray(p4, line2, (nLines - 1) * 3)\n\n      // Construct plane at end\n      v3toArray(end, plane, 18)\n      v3toArray(arcPoint, plane, 21)\n      v3toArray(improperEnd ? p2 : p3, plane, 24)\n      v3toArray(improperEnd ? p2 : p3, plane, 27)\n      v3toArray(arcPoint, plane, 30)\n      v3toArray(mid, plane, 33)\n    } else {\n      v3toArray(arcPoint, line1, li)\n      v3toArray(mid, line2, li)\n      li += 3\n    }\n\n    totalLines += nLines * 3\n    totalSegments += nSegments * 9\n    totalPlanes += nPlanes\n    i += 1\n  }\n\n  const nSuccess = i\n\n  const linePosition1 = new Float32Array(totalLines)\n  const linePosition2 = new Float32Array(totalLines)\n  const sectorPosition = new Float32Array(totalSegments)\n  const planePosition = new Float32Array(totalPlanes)\n\n  let lineOffset = 0\n  let sectorOffset = 0\n  let planeOffset = 0\n\n  for (let i = 0; i < nSuccess; i++) {\n    const lp1 = lineTmp1[ i ]\n    const lp2 = lineTmp2[ i ]\n    const sp = sectorTmp[ i ]\n    const pp = planeTmp[ i ]\n\n    copyArray(lp1, linePosition1, 0, lineOffset, lp1.length)\n    copyArray(lp2, linePosition2, 0, lineOffset, lp2.length)\n    copyArray(sp, sectorPosition, 0, sectorOffset, sp.length)\n    copyArray(pp, planePosition, 0, planeOffset, pp.length)\n\n    lineOffset += lp1.length\n    sectorOffset += sp.length\n    planeOffset += pp.length\n  }\n\n  return {\n    labelPosition: labelPosition.subarray(0, nSuccess * 3),\n    labelText: labelText.slice(0, nSuccess),\n    linePosition1,\n    linePosition2,\n    planePosition,\n    sectorPosition\n  }\n}\n\nRepresentationRegistry.add('dihedral', DihedralRepresentation)\n\nexport default DihedralRepresentation\n","/**\n * @file Dihedral Histogram Representation\n * @author Rudolfs Petrovs <rudolfs.petrovs@astx.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { calcArcPoint, parseNestedAtoms } from './measurement-representation'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\n\nimport { RepresentationRegistry } from '../globals'\nimport { Structure } from '../ngl'\nimport { defaults } from '../utils'\n\nimport { BufferData } from '../buffer/buffer'\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport WideLineBuffer, { WideLineBufferData } from '../buffer/wideline-buffer'\n\nimport { copyArray, uniformArray3, arraySum } from '../math/array-utils'\nimport {\n  v3add, v3cross, v3dot, v3multiplyScalar, v3fromArray,\n  v3negate, v3new, v3normalize, v3sub, v3toArray, v3length\n} from '../math/vector-utils'\n\nimport StructureView from '../structure/structure-view'\n\nimport Viewer from '../viewer/viewer'\n\n\nconst pointLength = 3 // One Point Length (number of coordinates of one point in 3D)\nconst pointsInTriangle = 3\n\ntype ColorDefinition = Color | string | number | undefined\n\ninterface HistogramColorParameters {\n  histogramBinBorderColor: ColorDefinition\n  adjacentBondArrowColor: ColorDefinition\n  distantBondArrowColor: ColorDefinition\n  frontHistogramColor: ColorDefinition\n  backHistogramColor: ColorDefinition\n  opaqueMiddleDiscColor: ColorDefinition\n}\n\ninterface HistogramInputData extends Partial<HistogramColorParameters> {\n  atomQuad: (number | string)[]\n  histogram360: number[]\n}\n\ninterface HistogramData extends HistogramInputData {\n  atomPositions: Float32Array\n  histogram360Scaled: number[]\n}\n\ninterface WideLineData {\n  startPoints: Float32Array\n  endPoints: Float32Array\n  startColors: Float32Array\n  endColors: Float32Array\n}\n\ninterface MeshData {\n  triangles: Float32Array\n  triangleColors: Float32Array\n}\n\nfunction createUpdatedObject(o: Object, updateSource: Object) {\n  function hasKey<O>(obj: O, key: keyof any): key is keyof O {\n    return key in obj\n  }\n\n  const result = { ...o } // Shallow copy\n  for (const key in result) {\n    if (hasKey(result, key) && hasKey(updateSource, key)) {\n      result[key] = defaults(updateSource[key], result[key])\n    }\n  }\n  return result\n}\n\nfunction createColorArray(color: ColorDefinition, arrayLength: number) {\n  const colorValue = new Color(color)\n  const targetArray = new Float32Array(arrayLength * 3)\n  uniformArray3(arrayLength, colorValue.r, colorValue.g, colorValue.b, targetArray)\n  return targetArray\n}\n\n/**\n * @typedef {Object} DihedralHistogramRepresentationParameters - dihedral representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n *\n * @property {HistogramInputData[]} histogramsData\n * List of HistogramInputData objects, which properties specifies each particular\n * histogram, and can contain particular histogram-specific parameters.\n * Obligatory properties are:\n * atomQuad - Quadruplet of selection strings or atom indices\n * histogram360 - List of values, representing histogram from 0 to 360 degrees.\n * @property {Boolean} histogramBinBorderVisible - Display the lines that separate circular histogram bins\n * @property {Boolean} scaleBinToSectorArea - Should sector-based histogram bins'\n * area be proportional to the bins' value\n */\n\nexport interface DihedralHistogramRepresentationParameters extends StructureRepresentationParameters {\n  histogramsData: HistogramInputData[]\n\n  histogramBinBorderVisible: boolean\n  scaleBinToSectorArea: boolean\n}\n\n/**\n * Dihedral Histogram representation object\n *\n * Reperesentation consists of several parts:\n * opaqueMiddleDisc - opaque disc in the middle of the dihedral between front and back histograms\n * frontHistogram - circular histogram from the adjacent bond viewpoint\n * backHistogram - circular histogram from the distant bond viewpoint\n * histogramBinBorder - lines, which separate histogram bins\n * bondArrows - lines, which show the actual angle on the histogram disc\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {DihedralHistogramRepresentationParameters} params - Dihedral histogram representation parameters\n */\nclass DihedralHistogramRepresentation extends StructureRepresentation {\n  protected histogramsData: HistogramData[]\n\n  protected histogramBinBorderVisible: boolean\n  protected histogramBinBorderWidth: number\n  protected histogramBinBorderColor: ColorDefinition\n  protected histogramBinBorderOpacity: number\n\n  protected bondArrowVisible: boolean\n  protected bondArrowWidth: number\n  protected bondArrowOpacity: number\n\n  protected adjacentBondArrowColor: ColorDefinition\n  protected distantBondArrowColor: ColorDefinition\n\n  protected histogramOpacity: number\n  protected frontHistogramColor: ColorDefinition\n  protected backHistogramColor: ColorDefinition\n\n  protected opaqueMiddleDiscVisible: boolean\n  protected opaqueMiddleDiscColor: ColorDefinition\n  protected opaqueMiddleDiscOpacity: number\n\n  protected scaleBinToSectorArea: boolean\n\n  constructor(structure: Structure, viewer: Viewer, params: DihedralHistogramRepresentationParameters) {\n    super(structure, viewer, params)\n\n    this.type = 'dihedral-histogram'\n\n    this.parameters = Object.assign({\n      histogramsData: {\n        type: 'hidden', rebuild: true\n      },\n      histogramBinBorderVisible: {\n        type: 'boolean', default: true\n      },\n      scaleBinToSectorArea: {\n        type: 'boolean',\n        rebuild: true,\n        default: false\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init(params: Partial<DihedralHistogramRepresentationParameters>) {\n    const p = params || {}\n\n    const defaultColorData = {\n      histogramBinBorderColor: 'grey',\n      adjacentBondArrowColor: 'black',\n      distantBondArrowColor: 'magenta',\n      frontHistogramColor: 'green',\n      backHistogramColor: 'blue',\n      opaqueMiddleDiscColor: 'white'\n    }\n\n    const colorData = createUpdatedObject(defaultColorData, p)\n    Object.assign(this, colorData)\n\n    const defaultParameters = {\n      histogramsData: [],\n      histogramOpacity: 1.0,\n\n      opaqueMiddleDiscVisible: true,\n      opaqueMiddleDiscOpacity: 1.0,\n\n      histogramBinBorderVisible: true,\n      histogramBinBorderWidth: 1,\n      histogramBinBorderOpacity: 0.5,\n\n      bondArrowVisible: true,\n      bondArrowWidth: 2,\n      bondArrowOpacity: 1.0,\n\n      scaleBinToSectorArea: false,\n    }\n    const parameters = createUpdatedObject(defaultParameters, p)\n    Object.assign(this, parameters)\n\n    this.histogramsData.forEach(x => {\n      const specificColorData = createUpdatedObject(colorData, x)\n      Object.assign(x, specificColorData)\n    })\n\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n\n    super.init(p)\n  }\n\n  getHistogramBinBorderBufferParameters() {\n    return this.getBufferParams({\n      linewidth: this.histogramBinBorderWidth,\n      visible: this.histogramBinBorderVisible,\n      opacity: this.histogramBinBorderOpacity,\n    })\n  }\n\n  getBondArrowsBufferParameters() {\n    return this.getBufferParams({\n      linewidth: this.bondArrowWidth,\n      visible: this.bondArrowVisible,\n      opacity: this.bondArrowOpacity,\n    })\n  }\n\n  getOpaqueMiddleDiscBufferParameters() {\n    return this.getBufferParams({\n      visible: this.opaqueMiddleDiscVisible,\n      opacity: this.opaqueMiddleDiscOpacity\n    })\n  }\n\n  getHistogramBufferParameters() {\n    return this.getBufferParams({\n      visible: true,\n      opacity: this.histogramOpacity,\n      side: \"double\"\n    })\n  }\n\n  createData(sview: StructureView) {\n    if (!sview.atomCount || !this.histogramsData.length) return\n    this.histogramsData.forEach(x => x.atomPositions = parseNestedAtoms(sview, [x.atomQuad]))\n    const scaleData = this.scaleBinToSectorArea ? function (y: number) { return Math.sqrt(y) } : function (y: number) { return y }\n    this.histogramsData.forEach(x => x.histogram360Scaled = x.histogram360.map(scaleData))\n    function Float32Concat(arrays: Float32Array[]) {\n      const lengths = arrays.map(x => x.length)\n      const result = new Float32Array(arraySum(lengths))\n      let accumulatedOffset = 0\n      for (let i = 0; i < arrays.length; i++) {\n        result.set(arrays[i], accumulatedOffset)\n        accumulatedOffset += arrays[i].length\n      }\n      return result\n    }\n\n    function createWideLineBuffer(linesList: WideLineData[], params: {}) {\n      return new WideLineBuffer(\n        {\n          position1: Float32Concat(linesList.map(x => x.startPoints)),\n          position2: Float32Concat(linesList.map(x => x.endPoints)),\n          color: Float32Concat(linesList.map(x => x.startColors)),\n          color2: Float32Concat(linesList.map(x => x.endColors)),\n        } as WideLineBufferData,\n        params)\n    }\n\n    function createMeshBuffer(mesh: MeshData[], params: {}) {\n      return new MeshBuffer(\n        {\n          position: Float32Concat(mesh.map(x => x.triangles)),\n          color: Float32Concat(mesh.map(x => x.triangleColors))\n        } as BufferData,\n        params)\n    }\n\n    const dihedralDataArray = []\n\n    for (let i = 0; i < this.histogramsData.length; i++) {\n      let dihedralData = undefined\n      let currentHistogramData = this.histogramsData[i]\n      let currentHistogram360 = currentHistogramData.histogram360\n      if (currentHistogram360.length >= 3) {\n        dihedralData = calculateDihedralHistogram(currentHistogramData)\n      }\n      if (typeof dihedralData === \"undefined\") continue\n      dihedralDataArray.push(dihedralData)\n    }\n\n    this.frontHistogramBinBordersBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.frontHistogramBinBorders),\n      this.getHistogramBinBorderBufferParameters()\n    )\n\n    this.backHistogramBinBordersBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.backHistogramBinBorders),\n      this.getHistogramBinBorderBufferParameters()\n    )\n\n    this.adjacentBondArrowsBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.adjacentBondArrows),\n      this.getBondArrowsBufferParameters()\n    )\n\n    this.distantBondArrowsBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.distantBondArrows),\n      this.getBondArrowsBufferParameters()\n    )\n\n    this.opaqueMiddleDiscBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.opaqueMiddleDisc),\n      this.getOpaqueMiddleDiscBufferParameters()\n    )\n\n    this.frontHistogramBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.frontHistogram),\n      this.getHistogramBufferParameters()\n    )\n\n    this.backHistogramBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.backHistogram),\n      this.getHistogramBufferParameters()\n    )\n\n    return {\n      bufferList: [].concat(\n        this.frontHistogramBinBordersBuffer,\n        this.backHistogramBinBordersBuffer,\n        this.adjacentBondArrowsBuffer,\n        this.distantBondArrowsBuffer,\n        this.opaqueMiddleDiscBuffer,\n        this.frontHistogramBuffer,\n        this.backHistogramBuffer\n      )\n    }\n  }\n\n  setParameters(params: Partial<DihedralHistogramRepresentationParameters>) {\n    const rebuild = false\n    const what = {}\n    super.setParameters(params, what, rebuild)\n\n    if (params && (params.histogramBinBorderVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n    return this\n  }\n\n  setVisibility(value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n    if (this.frontHistogramBinBordersBuffer) {\n      this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible)\n    }\n    if (this.backHistogramBinBordersBuffer) {\n      this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible)\n    }\n    if (!noRenderRequest) this.viewer.requestRender()\n    return this\n  }\n}\n\n/**\n * Calculates the data required to create {Buffer} objects for one histogram, given positions\n * @param  Float32Array positionOfDihedralAtoms 3*4 array of coordinates\n * @param  NumberArray histogram array of coordinates\n * @return Arrays for building buffers\n */\nfunction calculateDihedralHistogram(histogramData: HistogramData) {\n  const positionOfDihedralAtoms = histogramData.atomPositions\n  const histogram = histogramData.histogram360Scaled;\n  const totalSectorTrianglesInOpaqueMiddleDisc = histogram.length <= 180 ? 360 : histogram.length * 2\n  const frontAndBack = 2\n\n  const opaqueMiddleDisc = {\n    triangles: new Float32Array(totalSectorTrianglesInOpaqueMiddleDisc * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.opaqueMiddleDiscColor, totalSectorTrianglesInOpaqueMiddleDisc * pointsInTriangle)\n  }\n\n  const frontHistogram = {\n    triangles: new Float32Array(histogram.length * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.frontHistogramColor, histogram.length * pointsInTriangle)\n  }\n\n  const backHistogram = {\n    triangles: new Float32Array(histogram.length * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.backHistogramColor, histogram.length * pointsInTriangle)\n  }\n\n  const frontHistogramBinBorders = {\n    startPoints: new Float32Array(histogram.length * pointLength),\n    endPoints: new Float32Array(histogram.length * pointLength),\n    startColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length),\n    endColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length)\n  }\n\n  const backHistogramBinBorders = {\n    startPoints: new Float32Array(histogram.length * pointLength),\n    endPoints: new Float32Array(histogram.length * pointLength),\n    startColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length),\n    endColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length)\n  }\n\n  const adjacentBondArrows = {\n    startPoints: new Float32Array(frontAndBack * pointLength),\n    endPoints: new Float32Array(frontAndBack * pointLength),\n    startColors: createColorArray(histogramData.adjacentBondArrowColor, histogram.length),\n    endColors: createColorArray(histogramData.adjacentBondArrowColor, histogram.length)\n  }\n  const distantBondArrows = {\n    startPoints: new Float32Array(frontAndBack * pointLength),\n    endPoints: new Float32Array(frontAndBack * pointLength),\n    startColors: createColorArray(histogramData.distantBondArrowColor, histogram.length),\n    endColors: createColorArray(histogramData.distantBondArrowColor, histogram.length)\n  }\n\n  const p1 = v3new()\n  const p2 = v3new()\n  const p3 = v3new()\n  const p4 = v3new()\n\n  const v21 = v3new()\n  const v23 = v3new()\n  const v32 = v3new()\n  const v34 = v3new()\n\n  const mid = v3new()\n  const inPlane1 = v3new()\n  const inPlane2 = v3new()\n\n  const cross1 = v3new()\n  const cross2 = v3new()\n\n  const arcPoint = v3new()\n  const tmp = v3new()\n  const tmp2 = v3new()\n\n  // Set Atom Coordinates\n  const dihedralAtomVectors = [p1, p2, p3, p4]\n\n  for (let i = 0; i < dihedralAtomVectors.length; i++) {\n    v3fromArray(dihedralAtomVectors[i], positionOfDihedralAtoms, i * pointLength)\n  }\n\n  // Vectors between points\n  v3sub(v21, p1, p2)\n  v3sub(v23, p3, p2)\n  v3sub(v34, p4, p3)\n  if (v3length(v23) === 0.0) {\n    return // Can't define axis\n  }\n\n  v3multiplyScalar(tmp, v23, 0.5)\n  v3add(mid, p2, tmp)\n\n  v3normalize(v21, v21)\n  v3normalize(v23, v23)\n  v3normalize(v34, v34)\n\n  v3negate(v32, v23)\n  // Calculate vectors perp to v23 (lying in plane (1,2,3) and (2,3,4))\n  v3multiplyScalar(tmp, v32, v3dot(v32, v21))\n  v3sub(inPlane1, v21, tmp)\n\n  v3multiplyScalar(tmp, v23, v3dot(v23, v34))\n  v3sub(inPlane2, v34, tmp)\n\n  if (v3length(inPlane1) === 0.0 || v3length(inPlane2) === 0.0) {\n    return // Indeterminate angle\n  }\n\n  v3normalize(inPlane1, inPlane1)\n  v3normalize(inPlane2, inPlane2)\n\n  // Can use acos as normalized and non-zero\n  const absAngle = Math.acos(v3dot(inPlane1, inPlane2))\n\n  v3cross(cross1, v32, inPlane1)\n  v3cross(cross2, v23, inPlane2)\n  v3normalize(cross1, cross1)\n  v3normalize(cross2, cross2)\n\n  let angle = absAngle\n  if (v3dot(cross1, inPlane2) < 0.0) {\n    angle = -absAngle\n  }\n\n  v3add(arcPoint, mid, inPlane1)\n\n  // Calculate necessary constants\n  const maxHist = Math.max.apply(null, histogram)\n  const histBinAngleStep = (Math.PI * 2) / histogram.length\n\n  function setHistogramBinCoordinates(out: Float32Array, ind: number, zeroDegreeVector: Float32Array, crossVector: Float32Array, histBinAngleStep: number) {\n    const startOffset = ind * pointsInTriangle * pointLength\n    v3toArray(mid, out, startOffset)\n    const scalingFactor = Number(histogram[ind]) / maxHist\n    v3multiplyScalar(tmp, zeroDegreeVector, scalingFactor)\n    v3multiplyScalar(tmp2, crossVector, scalingFactor)\n    calcArcPoint(arcPoint, mid, tmp, tmp2, ind * histBinAngleStep)\n    v3toArray(arcPoint, out, startOffset + 1 * pointLength)\n    calcArcPoint(arcPoint, mid, tmp, tmp2, (ind + 1) * histBinAngleStep)\n    v3toArray(arcPoint, out, startOffset + 2 * pointLength)\n  }\n\n  function setOneSideHistogram(discHistogram: MeshData, binBorders: { startPoints: Float32Array, endPoints: Float32Array }, ind: number, zeroDegreeVector: Float32Array, crossVector: Float32Array) {\n    // Set Bond Arrows\n\n    copyArray(mid, adjacentBondArrows.startPoints, 0, ind * pointLength, mid.length)\n    calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, 0 + histBinAngleStep * 0)\n    copyArray(tmp, adjacentBondArrows.endPoints, 0, ind * pointLength, mid.length)\n\n    copyArray(mid, distantBondArrows.startPoints, 0, ind * pointLength, mid.length)\n    calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, angle)\n    copyArray(tmp, distantBondArrows.endPoints, 0, ind * pointLength, mid.length)\n\n    // Set Histogram Bin Borders\n\n    for (let i = 0; i < histogram.length; i++) {\n      copyArray(mid, binBorders.startPoints, 0, i * 3, mid.length)\n      calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, 0 + histBinAngleStep * i)\n      copyArray(tmp, binBorders.endPoints, 0, i * 3, tmp.length)\n    }\n\n    // Set Histogram Bins\n\n    for (let sectionIndex = 0; sectionIndex < histogram.length; sectionIndex++) {\n      setHistogramBinCoordinates(discHistogram.triangles, sectionIndex, zeroDegreeVector, crossVector, histBinAngleStep)\n    }\n  }\n\n  // Opaque disc\n  const opaqueCircleSectorAngleStep = Math.PI * 2 / totalSectorTrianglesInOpaqueMiddleDisc\n\n  for (let sectionIndex = 0; sectionIndex < totalSectorTrianglesInOpaqueMiddleDisc; sectionIndex++) {\n    const startOffset = sectionIndex * pointsInTriangle * pointLength\n    v3toArray(mid, opaqueMiddleDisc.triangles, startOffset)\n    calcArcPoint(arcPoint, mid, inPlane1, cross1, sectionIndex * opaqueCircleSectorAngleStep)\n    v3toArray(arcPoint, opaqueMiddleDisc.triangles, startOffset + 1 * pointLength)\n    calcArcPoint(arcPoint, mid, inPlane1, cross1, (sectionIndex + 1) * opaqueCircleSectorAngleStep)\n    v3toArray(arcPoint, opaqueMiddleDisc.triangles, startOffset + 2 * pointLength)\n  }\n\n  // Front Histogram\n  const distanceToOpaqueDisc = 0.01\n  v3multiplyScalar(tmp, v23, -distanceToOpaqueDisc) // Get a vector to move \"mid\" just a bit from opaque disc\n  v3add(mid, mid, tmp)\n  setOneSideHistogram(frontHistogram, frontHistogramBinBorders, 0, inPlane1, cross1)\n\n  // Back Histogram\n  v3multiplyScalar(tmp, v23, 2 * distanceToOpaqueDisc) // Get a vector to move \"mid\" back and plus just a bit from opaque disc the other way\n  v3add(mid, mid, tmp)\n  setOneSideHistogram(backHistogram, backHistogramBinBorders, 1, inPlane2, cross2)\n\n  return {\n    opaqueMiddleDisc,\n    frontHistogram,\n    backHistogram,\n    frontHistogramBinBorders,\n    backHistogramBinBorders,\n    adjacentBondArrows,\n    distantBondArrows\n  }\n}\n\nRepresentationRegistry.add('dihedral-histogram', DihedralHistogramRepresentation)\n\nexport default DihedralHistogramRepresentation\n","/**\n * @file Distance Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { DistancePicker } from '../utils/picker'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport BitArray from '../utils/bitarray'\nimport MeasurementRepresentation, { MeasurementRepresentationParameters } from './measurement-representation'\nimport Selection from '../selection/selection'\nimport BondStore from '../store/bond-store'\nimport TextBuffer, { TextBufferData, TextBufferParameters } from '../buffer/text-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { getFixedLengthDashData } from '../geometry/dash'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport { BondDataFields, BondDataParams, BondData } from '../structure/structure-data';\nimport { StructureRepresentationData } from './structure-representation';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\n\n/**\n * Distance representation parameter object.\n * @typedef {Object} DistanceRepresentationParameters - distance representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} labelUnit - distance unit (e.g. \"angstrom\" or \"nm\"). If set, a distance\n *                                symbol is appended to the label (i.e. 'nm' or '\\u00C5'). In case of 'nm', the\n *                                distance value is computed in nanometers instead of Angstroms.\n * @property {Array[]} atomPair - list of pairs of selection strings (see {@link Selection})\n *                                or pairs of atom indices. Using atom indices is much more\n *                                efficient when the representation is updated often, e.g. by\n *                                changing the selection or the atom positions, as there\n *                                are no selection strings to be evaluated.\n */\nexport interface DistanceRepresentationParameters extends MeasurementRepresentationParameters {\n  labelUnit: string\n  atomPair: AtomPair\n  useCylinder: boolean\n}\nexport type AtomPair = (number|string)[][]\n/**\n * Distance representation\n */\nclass DistanceRepresentation extends MeasurementRepresentation {\n  protected labelUnit: string\n  protected atomPair: AtomPair\n  protected useCylinder: boolean\n  protected distanceBuffer: WideLineBuffer|CylinderGeometryBuffer\n  /**\n   * Create Distance representation object\n   * @example\n   * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\" );\n   *     // either give selections (uses first selected atom) ...\n   *     var atomPair = [ [ \"1.CA\", \"4.CA\" ], [ \"7.CA\", \"13.CA\" ] ];\n   *     // or atom indices\n   *     var atomPair = [ [ 8, 28 ], [ 173, 121 ] ];\n   *     o.addRepresentation( \"distance\", { atomPair: atomPair } );\n   *     stage.autoView();\n   * } );\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {DistanceRepresentationParameters} params - distance representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<DistanceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'distance'\n\n    this.parameters = Object.assign({\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true,\n      labelUnit: {\n        type: 'select',\n        rebuild: true,\n        options: { '': '', angstrom: 'angstrom', nm: 'nm' }\n      },\n      useCylinder: {\n        type: 'boolean', rebuild: true\n      },\n      atomPair: {\n        type: 'hidden', rebuild: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<DistanceRepresentationParameters>) {\n    const p = params || {}\n    p.linewidth = defaults(p.linewidth, 5.0)\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.2)\n\n    this.labelUnit = defaults(p.labelUnit, '')\n    this.useCylinder = defaults(p.useCylinder, false)\n    this.atomPair = defaults(p.atomPair, [])\n\n    super.init(p)\n  }\n\n  getDistanceData (sview: StructureView, atomPair: AtomPair) {\n    let n = atomPair.length\n    const text = new Array(n)\n    let position = new Float32Array(n * 3)\n    const sele1 = new Selection()\n    const sele2 = new Selection()\n\n    const bondStore = new BondStore()\n\n    const ap1 = sview.getAtomProxy()\n    const ap2 = sview.getAtomProxy()\n\n    let j = 0 // Skipped pairs\n    const selected = sview.getAtomSet()\n\n    atomPair.forEach((pair, i) => {\n      let v1 = pair[ 0 ]\n      let v2 = pair[ 1 ]\n\n      if (typeof(v1) === 'number' && Number.isInteger(v1) && typeof(v2) === 'number' && Number.isInteger(v2)) {\n        if (selected.get(v1) && selected.get(v2)) {\n          ap1.index = v1\n          ap2.index = v2\n        } else {\n          j += 1\n          return\n        }\n      } else {\n        sele1.setString(v1 as string)\n        sele2.setString(v2 as string)\n\n        var atomIndices1 = sview.getAtomIndices(sele1)\n        var atomIndices2 = sview.getAtomIndices(sele2)\n\n        if (atomIndices1!.length && atomIndices2!.length) {\n          ap1.index = atomIndices1![ 0 ]\n          ap2.index = atomIndices2![ 0 ]\n        } else {\n          j += 1\n          return\n        }\n      }\n\n      bondStore.addBond(ap1, ap2, 1)\n\n      i -= j\n      var d = ap1.distanceTo(ap2)\n      switch (this.labelUnit) {\n        case 'angstrom':\n          text[ i ] = d.toFixed(2) + ' ' + String.fromCharCode(0x212B)\n          break\n        case 'nm':\n          text[ i ] = (d / 10).toFixed(2) + ' nm'\n          break\n        default:\n          text[ i ] = d.toFixed(2)\n          break\n      }\n\n      var i3 = i * 3\n      position[ i3 + 0 ] = (ap1.x + ap2.x) / 2\n      position[ i3 + 1 ] = (ap1.y + ap2.y) / 2\n      position[ i3 + 2 ] = (ap1.z + ap2.z) / 2\n    })\n\n    if (j > 0) {\n      n -= j\n      position = position.subarray(0, n * 3)\n    }\n\n    var bondSet = new BitArray(bondStore.count, true)\n\n    return {\n      text: text,\n      position: position,\n      bondSet: bondSet,\n      bondStore: bondStore\n    }\n  }\n\n  getBondData (sview: StructureView, what: BondDataFields, params: BondDataParams): BondData {\n    const bondData = sview.getBondData(this.getBondParams(what, params))\n    if (bondData.picking) {\n      bondData.picking = new DistancePicker(\n        bondData.picking.array,\n        bondData.picking.structure,\n        params.bondStore!\n      ) as any\n    }\n    return bondData\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomPair.length) return\n\n    const n = this.atomPair.length\n    const c = new Color(this.labelColor)\n    const distanceData = this.getDistanceData(sview, this.atomPair)\n\n    this.textBuffer = new TextBuffer({\n      position: distanceData.position,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, c.r, c.g, c.b),\n      text: distanceData.text\n    } as TextBufferData, this.getLabelBufferParams() as TextBufferParameters)\n\n    const bondParams = {\n      bondSet: distanceData.bondSet,\n      bondStore: distanceData.bondStore\n    }\n\n    const bondData = this.getBondData(\n      sview,\n      { position: true, color: true, picking: true, radius: this.useCylinder },\n      bondParams\n    )\n\n    if (this.useCylinder) {\n      this.distanceBuffer = new CylinderBuffer(\n        bondData as CylinderBufferData,\n        this.getBufferParams({\n          openEnded: this.openEnded,\n          radialSegments: this.radialSegments,\n          disableImpostor: this.disableImpostor,\n          dullInterior: true\n        }) \n      ) as CylinderGeometryBuffer\n    } else {\n      this.distanceBuffer = new WideLineBuffer(\n        getFixedLengthDashData(bondData as CylinderBufferData),\n        this.getBufferParams({\n          linewidth: this.linewidth,\n          visible: this.lineVisible,\n          opacity: this.lineOpacity\n        })\n      )\n    }\n\n    return {\n      bondSet: distanceData.bondSet,\n      bondStore: distanceData.bondStore,\n      position: distanceData.position,\n      bufferList: [ this.textBuffer, this.distanceBuffer ]\n    }\n  }\n\n  updateData (what: BondDataFields, data: StructureRepresentationData) {\n    super.updateData(what, data)\n\n    const bondParams = {\n      bondSet: data.bondSet,\n      bondStore: data.bondStore\n    }\n\n    const bondData = this.getBondData(data.sview as StructureView, what, bondParams)\n    const distanceData = {}\n\n    if (!what || what.color) {\n      Object.assign( distanceData, {\n        color: bondData.color,\n        color2: bondData.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign( distanceData, {radius: bondData.radius})\n    }\n\n    (this.distanceBuffer as CylinderGeometryBuffer).setAttributes(distanceData)\n  }\n\n  setParameters (params: Partial<DistanceRepresentationParameters>) {\n    let rebuild = false\n    const what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (!this.useCylinder) {\n      if (params && params.lineOpacity) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ opacity: params.lineOpacity })\n      }\n      if (params && params.opacity !== undefined) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ opacity: this.lineOpacity })\n      }\n      if (params && params.linewidth) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ linewidth: params.linewidth })\n      }\n    }\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('distance', DistanceRepresentation)\n\nexport default DistanceRepresentation\n","/**\n * @file Vector Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, Matrix4, Vector3 } from 'three'\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport { uniformArray3 } from '../math/array-utils'\nimport Buffer, { BufferDefaultParameters, BufferData, BufferParameters } from './buffer'\nimport { GenericColor } from '../types'\n\nfunction getSize(data: BufferData){\n  const n = data.position!.length / 3\n  return n * 2 * 3\n}\n\nexport interface VectorBufferData extends BufferData {\n  vector: Float32Array\n}\n\nexport const VectorBufferDefaultParameters = Object.assign({\n  scale: 1,\n  color: 'grey'\n}, BufferDefaultParameters)\nexport type VectorBufferParameters = BufferParameters & { scale: number, color: GenericColor }\n\n/**\n * Vector buffer. Draws vectors as lines.\n */\nclass VectorBuffer extends Buffer {\n  get defaultParameters() { return VectorBufferDefaultParameters }\n  parameters: VectorBufferParameters\n\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.vector - vectors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: VectorBufferData, params: Partial<VectorBufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data))\n    }, params)\n\n    const color = new Color(this.parameters.color)\n    const attributes = this.geometry.attributes as any  // TODO\n    uniformArray3(getSize(data) / 3, color.r, color.g, color.b, attributes.color.array)\n\n    this.setAttributes(data)\n  }\n\n  setAttributes (data: Partial<VectorBufferData> = {}) {\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, vector\n    let aPosition\n\n    if (data.position && data.vector) {\n      position = data.position\n      vector = data.vector\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    const n = this.size / 2\n    const scale = this.parameters.scale\n\n    if (position && vector) {\n      for (let v = 0; v < n; v++) {\n        const i = v * 2 * 3\n        const j = v * 3\n\n        aPosition[ i + 0 ] = position[ j + 0 ]\n        aPosition[ i + 1 ] = position[ j + 1 ]\n        aPosition[ i + 2 ] = position[ j + 2 ]\n        aPosition[ i + 3 ] = position[ j + 0 ] + vector[ j + 0 ] * scale\n        aPosition[ i + 4 ] = position[ j + 1 ] + vector[ j + 1 ] * scale\n        aPosition[ i + 5 ] = position[ j + 2 ] + vector[ j + 2 ] * scale\n      }\n    }\n  }\n}\n\nexport default VectorBuffer\n","/**\n * @file Helixorient Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Helixorient from '../geometry/helixorient'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferParameters } from '../buffer/sphere-buffer'\nimport VectorBuffer from '../buffer/vector-buffer'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport SphereImpostorBuffer from '../buffer/sphereimpostor-buffer';\nimport { BufferData } from '../buffer/buffer';\n\n/**\n * Helixorient Representation\n */\nclass HelixorientRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'helixorient'\n\n    this.parameters = Object.assign({\n      sphereDetail: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'sstruc')\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n    p.radiusScale = defaults(p.radiusScale, 1.0)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    const bufferList: (SphereBuffer|VectorBuffer)[] = []\n    const polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      const helixorient = new Helixorient(polymer)\n      const position = helixorient.getPosition()\n      const color = helixorient.getColor(this.getColorParams())\n      const size = helixorient.getSize(this.getRadiusParams())\n      const picking = helixorient.getPicking()\n\n      bufferList.push(\n        new SphereBuffer(\n          {\n            position: position.center,\n            color: color.color,\n            radius: size.size,\n            picking: picking.picking\n          },\n          this.getBufferParams({\n            sphereDetail: this.sphereDetail,\n            disableImpostor: this.disableImpostor,\n            dullInterior: true\n          }) as SphereBufferParameters\n        ),\n        new VectorBuffer(\n          {\n            position: position.center,\n            vector: position.axis\n          },\n          this.getBufferParams({\n            color: 'skyblue',\n            scale: 1\n          })\n        ),\n        new VectorBuffer(\n          {\n            position: position.center,\n            vector: position.resdir\n          },\n          this.getBufferParams({\n            color: 'lightgreen',\n            scale: 1\n          })\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList as (SphereGeometryBuffer|SphereImpostorBuffer|VectorBuffer)[],\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    if (Debug) Log.time(this.type + ' repr update')\n\n    what = what || {}\n\n    for (let i = 0, il = data.polymerList!.length; i < il; ++i) {\n      const j = i * 3\n\n      const bufferData: Partial<BufferData> = {}\n      const polymer = data.polymerList![ i ]\n      const helixorient = new Helixorient(polymer)\n\n      if (what.position) {\n        const position = helixorient.getPosition()\n\n        Object.assign(bufferData, {position: position.center})\n\n        data.bufferList[ j + 1 ].setAttributes({\n          'position': position.center,\n          'vector': position.axis\n        })\n        data.bufferList[ j + 2 ].setAttributes({\n          'position': position.center,\n          'vector': position.resdir\n        })\n      }\n\n      data.bufferList[ j ].setAttributes(bufferData)\n    }\n\n    if (Debug) Log.timeEnd(this.type + ' repr update')\n  }\n}\n\nRepresentationRegistry.add('helixorient', HelixorientRepresentation)\n\nexport default HelixorientRepresentation\n","/**\n * @file Licorice Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\n\n/**\n * Licorice representation object ({@link BallAndStickRepresentation} with `aspectRatio` fixed at 1.0)\n */\nclass LicoriceRepresentation extends BallAndStickRepresentation {\n  /**\n   * Create Licorice representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {BallAndStickRepresentationParameters} params - ball and stick representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'licorice'\n\n    this.parameters = Object.assign(\n      {}, this.parameters, { aspectRatio: null }\n    )\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n\n    super.init(p)\n  }\n}\n\nRepresentationRegistry.add('licorice', LicoriceRepresentation)\n\nexport default LicoriceRepresentation\n","/**\n * @file Mapped Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\nconst mapping = new Float32Array([\n  -1.0, -1.0, -1.0,\n  1.0, -1.0, -1.0,\n  1.0, -1.0, 1.0,\n  -1.0, -1.0, 1.0,\n  -1.0, 1.0, -1.0,\n  1.0, 1.0, -1.0,\n  1.0, 1.0, 1.0,\n  -1.0, 1.0, 1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  0, 2, 3,\n  1, 5, 6,\n  1, 6, 2,\n  4, 6, 5,\n  4, 7, 6,\n  0, 7, 4,\n  0, 3, 7,\n  0, 5, 1,\n  0, 4, 5,\n  3, 2, 6,\n  3, 6, 7\n])\n\n/**\n * Mapped Box buffer. Draws boxes. Used to render general imposters.\n * @interface\n */\nclass MappedBoxBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v3', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 36 }\n  get mappingSize () { return 8 }\n  get mappingItemSize () { return 3 }\n}\n\nexport default MappedBoxBuffer\n","/**\n * @file Hyperball Stick Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Matrix4, Vector3 } from 'three'\n\nimport '../shader/HyperballStickImpostor.vert'\nimport '../shader/HyperballStickImpostor.frag'\n\nimport MappedBoxBuffer from './mappedbox-buffer'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferParameters } from './buffer'\n\nexport interface HyperballStickImpostorBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n  radius2: Float32Array\n}\n\nexport const HyperballStickImpostorBufferDefaultParameters = Object.assign({\n  shrink: 0.14\n}, BufferDefaultParameters)\nexport type HyperballStickImpostorBufferParameters = BufferParameters & { shrink: number }\n\nconst HyperballStickImpostorBufferParameterTypes = Object.assign({\n  shrink: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Hyperball stick impostor buffer.\n *\n * @example\n * var hyperballStickImpostorBuffer = new HyperballStickImpostorBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 2, 2, 2 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   radius2: new Float32Array([ 2 ])\n * });\n */\nclass HyperballStickImpostorBuffer extends MappedBoxBuffer {\n  parameterTypes = HyperballStickImpostorBufferParameterTypes\n  get defaultParameters() { return HyperballStickImpostorBufferDefaultParameters }\n  parameters: HyperballStickImpostorBufferParameters\n\n  isImpostor = true\n  vertexShader = 'HyperballStickImpostor.vert'\n  fragmentShader = 'HyperballStickImpostor.frag'\n\n  constructor (data: HyperballStickImpostorBufferData, params: Partial<HyperballStickImpostorBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'modelViewProjectionMatrix': { value: new Matrix4() },\n      'modelViewProjectionMatrixInverse': { value: new Matrix4() },\n      'modelViewMatrixInverseTranspose': { value: new Matrix4() },\n      'shrink': { value: this.parameters.shrink }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null },\n      'radius': { type: 'f', value: null },\n      'radius2': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n}\n\nexport default HyperballStickImpostorBuffer\n","/**\n * @file Hyperball Stick Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import required for declaration only\nimport { Vector3, Matrix4 } from 'three'\nimport { ExtensionFragDepth } from '../globals'\nimport { calculateMinArray } from '../math/array-utils'\nimport CylinderGeometryBuffer, { CylinderGeometryBufferDefaultParameters, CylinderGeometryBufferParameters } from './cylindergeometry-buffer'\nimport HyperballStickImpostorBuffer, { HyperballStickImpostorBufferDefaultParameters, HyperballStickImpostorBufferParameters } from './hyperballstickimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface HyperballStickBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n  radius2: Float32Array\n}\n\nexport const HyperballStickBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, CylinderGeometryBufferDefaultParameters, HyperballStickImpostorBufferDefaultParameters)\nexport type HyperballStickBufferParameters = HyperballStickImpostorBufferParameters & CylinderGeometryBufferParameters & { disableImpostor: boolean }\n\nclass HyperballStickBufferImpl {\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position1 - from positions\n   * @param  {Float32Array} data.position2 - to positions\n   * @param  {Float32Array} data.color - from colors\n   * @param  {Float32Array} data.color2 - to colors\n   * @param  {Float32Array} data.radius - from radii\n   * @param  {Float32Array} data.radius2 - to radii\n   * @param  {Float32Array} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: HyperballStickBufferData, params: Partial<HyperballStickBufferParameters> = {}) {\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      data.radius = calculateMinArray(data.radius, data.radius2)\n      return new CylinderGeometryBuffer(data, params)\n    } else {\n      return new HyperballStickImpostorBuffer(data, params)\n    }\n  }\n}\n\n/**\n * Hyperball stick buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link CylinderGeometryBuffer} or a {@link HyperballStickImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var hyperballStickBuffer = new HyperballStickBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 2, 2, 2 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   radius2: new Float32Array([ 2 ])\n * });\n */\n//@ts-expect-error Incompatible constructor signatures\nconst HyperballStickBuffer: {\n  new(data: HyperballStickBufferData, params: Partial<HyperballStickBufferParameters>): CylinderGeometryBuffer | HyperballStickImpostorBuffer;\n} = HyperballStickBufferImpl;\n\ntype HyperballStickBuffer = CylinderGeometryBuffer | HyperballStickImpostorBuffer;\n\nexport default HyperballStickBuffer\n","/**\n * @file Hyperball Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { calculateCenterArray } from '../math/array-utils'\nimport LicoriceRepresentation from './licorice-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport HyperballStickBuffer, { HyperballStickBufferData } from '../buffer/hyperballstick-buffer'\nimport { BallAndStickRepresentationParameters } from './ballandstick-representation';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport { BondDataParams, BondDataFields, AtomDataFields } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport { StructureRepresentationData } from './structure-representation';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n\nexport interface HyperballRepresentationParameters extends BallAndStickRepresentationParameters {\n  shrink: number\n}\n\n/**\n * Hyperball Representation\n */\nclass HyperballRepresentation extends LicoriceRepresentation {\n  protected shrink: number\n  protected __center: Float32Array\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<HyperballRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'hyperball'\n\n    this.parameters = Object.assign({\n\n      shrink: {\n        type: 'number', precision: 3, max: 1.0, min: 0.001, buffer: true\n      }\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n  }\n\n  init (params: Partial<HyperballRepresentationParameters>) {\n    var p = params || {}\n    p.radiusScale = defaults(p.radiusScale, 0.2)\n    p.radiusType = defaults(p.radiusType, 'vdw')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.shrink = defaults(p.shrink, 0.12)\n\n    super.init(p)\n  }\n\n  getBondParams (what?: BondDataFields, params?: BondDataParams) {\n    if (!what || what.radius) {\n      params = Object.assign({ radius2: true }, params)\n    }\n\n    return super.getBondParams(what, params)\n  }\n\n  createData (sview: StructureView) {\n    var sphereBuffer = new SphereBuffer(\n      (sview.getAtomData(this.getAtomParams()) as SphereBufferData),\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    ) as SphereGeometryBuffer\n\n    this.__center = new Float32Array(sview.bondCount * 3)\n\n    var stickBuffer = new HyperballStickBuffer(\n      sview.getBondData(this.getBondParams()) as HyperballStickBufferData,\n      this.getBufferParams({\n        shrink: this.shrink,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    return {\n      bufferList: [ sphereBuffer, stickBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams())\n    var bondData = data.sview!.getBondData(this.getBondParams())\n    var sphereData = {}\n    var stickData = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: atomData.position})\n      var from = bondData.position1\n      var to = bondData.position2\n      Object.assign(stickData, {\n        position: calculateCenterArray(from!, to!, this.__center),\n        position1: from,\n        position2: to\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: atomData.color})\n      Object.assign(stickData, {\n        color: bondData.color,\n        color2: bondData.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: atomData.radius})\n      Object.assign(stickData, {\n        radius: bondData.radius,\n        radius2: bondData.radius2\n      })\n    }\n\n    data.bufferList[ 0 ].setAttributes(sphereData)\n    data.bufferList[ 1 ].setAttributes(stickData)\n  }\n}\n\nRepresentationRegistry.add('hyperball', HyperballRepresentation)\n\nexport default HyperballRepresentation\n","/**\n * @file Label Factory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { AA1 } from '../structure/structure-constants'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { sprintf } from 'sprintf-js'\n\nexport const LabelFactoryTypes = {\n  '': '',\n  'atomname': 'atom name',\n  'atomindex': 'atom index',\n  'occupancy': 'occupancy',\n  'bfactor': 'b-factor',\n  'serial': 'serial',\n  'element': 'element',\n  'atom': 'atom name + index',\n  'resname': 'residue name',\n  'resno': 'residue no',\n  'res': 'one letter code + no',\n  'residue': '[residue name] + no + inscode',\n  'text': 'text',\n  'format': 'format',\n  'qualified': 'qualified name'\n}\nexport type LabelType = keyof typeof LabelFactoryTypes\n\nclass LabelFactory {\n\n  static types = LabelFactoryTypes\n  errorLogged: boolean = false\n\n  constructor(readonly type: LabelType, readonly text: { [k: number]: string } = {},\n    readonly format: string = '') {}\n\n  atomLabel (a: AtomProxy) {\n    const type = this.type\n\n    let l\n\n    switch (type) {\n      case 'atomname':\n        l = a.atomname\n        break\n\n      case 'atomindex':\n        l = `${a.index}`\n        break\n\n      case 'occupancy':\n        l = a.occupancy.toFixed(2)\n        break\n\n      case 'bfactor':\n        l = a.bfactor.toFixed(2)\n        break\n\n      case 'serial':\n        l = `${a.serial}`\n        break\n\n      case 'element':\n        l = a.element\n        break\n\n      case 'atom':\n        l = `${a.atomname}|${a.index}`\n        break\n\n      case 'resname':\n        l = a.resname\n        break\n\n      case 'resno':\n        l = `${a.resno}`\n        break\n\n      case 'res':\n        l = `${(AA1[ a.resname.toUpperCase() ] || a.resname)}${a.resno}`\n        break\n\n      case 'residue':\n        const aa1 = AA1[ a.resname.toUpperCase() ]\n        if (aa1 && !a.inscode) {\n          l = `${aa1}${a.resno}`\n        } else {\n          l = `[${a.resname}]${a.resno}${a.inscode}`\n        }\n        break\n\n      case 'text':\n        l = this.text[ a.index ]\n        break\n\n      case 'format':\n        try {\n          l = sprintf(this.format, a)\n        } catch (e) {\n          if (!this.errorLogged) {\n            this.errorLogged = true\n            console.log(e.message)\n          }\n        }\n        break\n\n      // case \"qualified\":\n      default:\n        l = a.qualifiedName()\n        break\n    }\n\n    return l === undefined ? '' : l\n  }\n}\n\nexport default LabelFactory\n","/**\n * @file Label Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport LabelFactory, { LabelType } from '../utils/label-factory'\nimport RadiusFactory from '../utils/radius-factory'\nimport StructureRepresentation, { StructureRepresentationData } from './structure-representation'\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer'\nimport { RepresentationParameters } from './representation';\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { GenericColor } from '../types'\n\nexport interface TextDataField {\n  position?: boolean\n  color?: boolean\n  radius?: boolean\n  text?: boolean\n}\n\n/**\n * Label representation parameter object. Extends {@link RepresentationParameters} and\n * {@link StructureRepresentationParameters}.\n *\n * @typedef {Object} LabelRepresentationParameters - label representation parameters\n *\n * @property {Integer} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Float} opacity - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {String} labelType - type of the label, one of:\n *                                 \"atomname\", \"atomindex\", \"occupancy\", \"bfactor\",\n *                                 \"serial\", \"element\", \"atom\", \"resname\", \"resno\",\n *                                 \"res\", \"text\", \"qualified\". When set to \"text\", the\n *                                 `labelText` list is used.\n * @property {String[]} labelText - list of label strings, must set `labelType` to \"text\"\n *                                   to take effect\n * @property {String} labelFormat - sprintf-js format string, any attribute of\n *                                  {@link  AtomProxy} can be used\n * @property {String} labelGrouping - grouping of the label, one of:\n *                                 \"atom\", \"residue\".\n * @property {String} fontFamily - font family, one of: \"sans-serif\", \"monospace\", \"serif\"\n * @property {String} fontStyle - font style, \"normal\" or \"italic\"\n * @property {String} fontWeight - font weight, \"normal\" or \"bold\"\n * @property {Float} xOffset - offset in x-direction\n * @property {Float} yOffset - offset in y-direction\n * @property {Float} zOffset - offset in z-direction (i.e. in camera direction)\n * @property {String} attachment - attachment of the label, one of:\n *                                 \"bottom-left\", \"bottom-center\", \"bottom-right\",\n *                                 \"middle-left\", \"middle-center\", \"middle-right\",\n *                                 \"top-left\", \"top-center\", \"top-right\"\n * @property {Boolean} showBorder - show border/outline\n * @property {Color} borderColor - color of the border/outline\n * @property {Float} borderWidth - width of the border/outline\n * @property {Boolean} showBackground - show background rectangle\n * @property {Color} backgroundColor - color of the background\n * @property {Float} backgroundMargin - width of the background\n * @property {Float} backgroundOpacity - opacity of the background\n * @property {Boolean} fixedSize - show text with a fixed pixel size\n */\nexport interface LabelRepresentationParameters extends RepresentationParameters {\n  labelType: LabelType\n  labelText: string[]\n  labelFormat: string\n  labelGrouping: 'atom'|'residue'\n  fontFamily: 'sans-serif'|'monospace'|'serif'\n  fontStyle: 'normal'|'italic'\n  fontWeight: 'normal'|'bold'\n  xOffset: number\n  yOffset: number\n  zOffset: number\n  attachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  showBorder: boolean\n  borderColor: GenericColor\n  borderWidth: number\n  showBackground: boolean\n  backgroundColor: GenericColor\n  backgroundMargin: number\n  backgroundOpacity: number\n  fixedSize: boolean\n}\n/**\n * Label representation\n */\nclass LabelRepresentation extends StructureRepresentation {\n\n  protected labelType: LabelType\n  protected labelText: string[]\n  protected labelFormat: string\n  protected labelGrouping: 'atom'|'residue'\n  protected fontFamily: 'sans-serif'|'monospace'|'serif'\n  protected fontStyle: 'normal'|'italic'\n  protected fontWeight: 'normal'|'bold'\n  protected xOffset: number\n  protected yOffset: number\n  protected zOffset: number\n  protected attachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  protected showBorder: boolean\n  protected borderColor: GenericColor\n  protected borderWidth: number\n  protected showBackground: boolean\n  protected backgroundColor: GenericColor\n  protected backgroundMargin: number\n  protected backgroundOpacity: number\n  protected fixedSize: boolean\n\n  /**\n   * Create Label representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {LabelRepresentationParameters} params - label representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<LabelRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'label'\n\n    this.parameters = Object.assign({\n\n      labelType: {\n        type: 'select', options: LabelFactory.types, rebuild: true\n      },\n      labelText: {\n        type: 'hidden', rebuild: true\n      },\n      labelFormat: {\n        type: 'text', rebuild: true\n      },\n      labelGrouping: {\n        type: 'select',\n        options: {\n          'atom': 'atom',\n          'residue': 'residue'\n        },\n        rebuild: true\n      },\n      fontFamily: {\n        type: 'select',\n        options: {\n          'sans-serif': 'sans-serif',\n          'monospace': 'monospace',\n          'serif': 'serif'\n        },\n        buffer: true\n      },\n      fontStyle: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'italic': 'italic'\n        },\n        buffer: true\n      },\n      fontWeight: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'bold': 'bold'\n        },\n        buffer: true\n      },\n      xOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      yOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      zOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      attachment: {\n        type: 'select',\n        options: {\n          'bottom-left': 'bottom-left',\n          'bottom-center': 'bottom-center',\n          'bottom-right': 'bottom-right',\n          'middle-left': 'middle-left',\n          'middle-center': 'middle-center',\n          'middle-right': 'middle-right',\n          'top-left': 'top-left',\n          'top-center': 'top-center',\n          'top-right': 'top-right'\n        },\n        rebuild: true\n      },\n      showBorder: {\n        type: 'boolean', buffer: true\n      },\n      borderColor: {\n        type: 'color', buffer: true\n      },\n      borderWidth: {\n        type: 'number', precision: 2, max: 0.3, min: 0, buffer: true\n      },\n      showBackground: {\n        type: 'boolean', rebuild: true\n      },\n      backgroundColor: {\n        type: 'color', buffer: true\n      },\n      backgroundMargin: {\n        type: 'number', precision: 2, max: 2, min: 0, rebuild: true\n      },\n      backgroundOpacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      fixedSize: {\n        type: 'boolean', buffer: true\n      }\n\n    }, this.parameters, {\n\n      side: null,\n      flatShaded: null,\n      wireframe: null,\n      linewidth: null,\n\n      roughness: null,\n      metalness: null,\n      diffuse: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<LabelRepresentationParameters>) {\n    const p = params || {}\n\n    this.labelType = defaults(p.labelType, 'res')\n    this.labelText = defaults(p.labelText, {})\n    this.labelFormat = defaults(p.labelFormat, '')\n    this.labelGrouping = defaults(p.labelGrouping, 'atom')\n    this.fontFamily = defaults(p.fontFamily, 'sans-serif')\n    this.fontStyle = defaults(p.fontStyle, 'normal')\n    this.fontWeight = defaults(p.fontWeight, 'bold')\n    this.xOffset = defaults(p.xOffset, 0.0)\n    this.yOffset = defaults(p.yOffset, 0.0)\n    this.zOffset = defaults(p.zOffset, 0.5)\n    this.attachment = defaults(p.attachment, 'bottom-left')\n    this.showBorder = defaults(p.showBorder, false)\n    this.borderColor = defaults(p.borderColor, 'lightgrey')\n    this.borderWidth = defaults(p.borderWidth, 0.15)\n    this.showBackground = defaults(p.showBackground, false)\n    this.backgroundColor = defaults(p.backgroundColor, 'lightgrey')\n    this.backgroundMargin = defaults(p.backgroundMargin, 0.5)\n    this.backgroundOpacity = defaults(p.backgroundOpacity, 1.0)\n    this.fixedSize = defaults(p.fixedSize, false)\n\n    super.init(p)\n  }\n\n  getTextData (sview: StructureView, what?: TextDataField) {\n    const p = this.getAtomParams(what)\n    const labelFactory = new LabelFactory(this.labelType, this.labelText, this.labelFormat)\n    let position: Float32Array, size: Float32Array, color: Float32Array, text: string[],\n      positionN: number[], sizeN: number[], colorN: number[]\n    if (this.labelGrouping === 'atom') {\n      const atomData = sview.getAtomData(p)\n      position = atomData.position as Float32Array\n      size = atomData.radius as Float32Array\n      color = atomData.color as Float32Array\n      if (!what || what.text) {\n        text = []\n        sview.eachAtom(ap => text.push(labelFactory.atomLabel(ap)))\n      }\n    } else if (this.labelGrouping === 'residue') {\n      if (!what || what.position) positionN = []\n      if (!what || what.color) colorN = []\n      if (!what || what.radius) sizeN = []\n      if (!what || what.text) text = []\n      if (p.colorParams) p.colorParams.structure = sview.getStructure()\n      const colormaker = ColormakerRegistry.getScheme(p.colorParams)\n      const radiusFactory = new RadiusFactory(p.radiusParams)\n      const ap1 = sview.getAtomProxy()\n\n      let i = 0\n      sview.eachResidue(rp => {\n        const i3 = i * 3\n        if (rp.isProtein() || rp.isNucleic()) {\n          ap1.index = rp.traceAtomIndex\n          if (!what || what.position) {\n            ap1.positionToArray(positionN, i3)\n          }\n        } else {\n          ap1.index = rp.atomOffset\n          if (!what || what.position) {\n            rp.positionToArray(positionN, i3)\n          }\n        }\n        if (!what || what.color) {\n          colormaker.atomColorToArray(ap1, colorN, i3)\n        }\n        if (!what || what.radius) {\n          sizeN[ i ] = radiusFactory.atomRadius(ap1)\n        }\n        if (!what || what.text) {\n          text.push(labelFactory.atomLabel(ap1))\n        }\n        ++i\n      })\n\n      if (!what || what.position) position = new Float32Array(positionN!)\n      if (!what || what.color) color = new Float32Array(colorN!)\n      if (!what || what.radius) size = new Float32Array(sizeN!)\n    }\n\n    return { position: position!, size: size!, color: color!, text: text! }\n  }\n\n  createData (sview: StructureView) {\n    const what: TextDataField = { position: true, color: true, radius: true, text: true }\n\n    const textBuffer = new TextBuffer(\n      this.getTextData(sview, what) as TextBufferData,\n      this.getBufferParams({\n        fontFamily: this.fontFamily,\n        fontStyle: this.fontStyle,\n        fontWeight: this.fontWeight,\n        xOffset: this.xOffset,\n        yOffset: this.yOffset,\n        zOffset: this.zOffset,\n        attachment: this.attachment,\n        showBorder: this.showBorder,\n        borderColor: this.borderColor,\n        borderWidth: this.borderWidth,\n        showBackground: this.showBackground,\n        backgroundColor: this.backgroundColor,\n        backgroundMargin: this.backgroundMargin,\n        backgroundOpacity: this.backgroundOpacity,\n        fixedSize: this.fixedSize\n      })\n    )\n\n    return { bufferList: [ textBuffer ] }\n  }\n\n  updateData (what: TextDataField, data: StructureRepresentationData) {\n    data.bufferList[ 0 ].setAttributes(this.getTextData(data.sview as StructureView, what))\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n}\n\nRepresentationRegistry.add('label', LabelRepresentation)\n\nexport default LabelRepresentation\n","/**\n * @file Line Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport { AtomPicker } from '../utils/picker'\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n// @ts-ignore: unused import BondDataFields, BondDataParams required for declaration only\nimport { BondDataFields, BondDataParams } from '../structure/structure-data';\n\n/**\n * Determine which atoms in  a Structure[View] form no bonds to any other atoms\n * in that Structure.\n *\n * This differs from setting the selection to \"nonbonded\" as it finds atoms\n * that have no bonds within the current selection.\n * @param  {Structure} structure - The Structure or StructureView object\n * @return {AtomSet} AtomSet of lone atoms\n */\nfunction getLoneAtomSet (structure: Structure | StructureView) {\n  const atomSet = structure.getAtomSet()\n  const bondSet = structure.getBondSet()\n  const bp = structure.getBondProxy()\n  bondSet.forEach(function (idx) {\n    bp.index = idx\n    atomSet.clear(bp.atomIndex1)\n    atomSet.clear(bp.atomIndex2)\n  })\n  return atomSet\n}\n\nexport interface LineRepresentationParameters extends StructureRepresentationParameters {\n  multipleBond: 'off' | 'symmetric' | 'offset'\n  bondSpacing: number\n  linewidth: number\n  lines: boolean\n  crosses: 'off' | 'all' | 'lone'\n  crossSize: number\n}\n\nexport interface CrossData {\n  position1?: Float32Array\n  position2?: Float32Array\n  color?: Float32Array\n  color2?: Float32Array\n  picking?: AtomPicker\n}\n\n/**\n * Line representation\n */\nclass LineRepresentation extends StructureRepresentation {\n  protected multipleBond: 'off' | 'symmetric' | 'offset'\n  protected bondSpacing: number\n  protected linewidth: number\n  protected lines: boolean\n  protected crosses: 'off' | 'all' | 'lone'\n  protected crossSize: number\n  /**\n   * Create Line representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {RepresentationParameters} params - representation parameters, plus the properties listed below\n   * @property {String} multipleBond - one off \"off\", \"symmetric\", \"offset\"\n   * @param {Float} params.bondSpacing - spacing for multiple bond rendering\n   * @param {Integer} params.linewidth - width of lines\n   * @param {Boolean} params.lines - render bonds as lines\n   * @param {String} params.crosses - render atoms as crosses: \"off\", \"all\" or \"lone\" (default)\n   * @param {Float} params.crossSize - size of cross\n   * @param {null} params.flatShaded - not available\n   * @param {null} params.side - not available\n   * @param {null} params.wireframe - not available\n   * @param {null} params.roughness - not available\n   * @param {null} params.metalness - not available\n   * @param {null} params.diffuse - not available\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<LineRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'line'\n\n    this.parameters = Object.assign({\n\n      multipleBond: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'symmetric': 'symmetric',\n          'offset': 'offset'\n        }\n      },\n      bondSpacing: {\n        type: 'number', precision: 2, max: 2.0, min: 0.5\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      },\n      lines: {\n        type: 'boolean', rebuild: true\n      },\n      crosses: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'lone': 'lone',\n          'all': 'all'\n        }\n      },\n      crossSize: {\n        type: 'number', precision: 2, max: 2.0, min: 0.1\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null,\n\n      roughness: null,\n      metalness: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<LineRepresentationParameters>) {\n    var p = params || {}\n\n    this.multipleBond = defaults(p.multipleBond, 'off')\n    this.bondSpacing = defaults(p.bondSpacing, 1.0)\n    this.linewidth = defaults(p.linewidth, 2)\n    this.lines = defaults(p.lines, true)\n    this.crosses = defaults(p.crosses, 'lone')\n    this.crossSize = defaults(p.crossSize, 0.4)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom:AtomProxy) {\n    return 0.1\n  }\n\n  getBondParams (what: any, params?: Partial<LineRepresentationParameters>) {\n    params = Object.assign({\n      multipleBond: this.multipleBond,\n      bondSpacing: this.bondSpacing,\n      radiusParams: { 'type': 'size', 'size': 0.1, 'scale': 1 }\n    }, params)\n\n    return super.getBondParams(what, params)\n  }\n\n  _crossData (what: any, sview: StructureView) {\n    if (what) {\n      if (!what.position && !what.color) return\n    }\n\n    const p = {}\n    if (this.crosses === 'lone') {\n      Object.assign(p, {atomSet : getLoneAtomSet(sview)})\n    }\n\n    const atomData = sview.getAtomData(this.getAtomParams(what, p))\n    const crossData: CrossData = {}\n    const position = atomData.position\n    const color = atomData.color\n    const picking = atomData.picking\n\n    const size = (position! || color).length\n    const attrSize = size * 3\n\n    let cPosition1 = new Float32Array(0)\n    let cPosition2 = new Float32Array(0)\n    let cColor = new Float32Array(0)\n    let cColor2 = new Float32Array(0)\n    let cOffset: number = 0\n\n    let pickingArray = new Float32Array(0)\n\n    if (!what || what.position) {\n      cPosition1 = crossData.position1 = new Float32Array(attrSize)\n      cPosition2 = crossData.position2 = new Float32Array(attrSize)\n      cOffset = this.crossSize / 2\n    }\n    if (!what || what.color) {\n      cColor = crossData.color = new Float32Array(attrSize)\n      cColor2 = crossData.color2 = new Float32Array(attrSize)\n    }\n    if (!what || what.picking) {\n      pickingArray = new Float32Array(atomData.picking!.array!.length * 3) // Needs padding??\n    }\n\n    for (let v = 0; v < size; v++) {\n      const j = v * 3\n      const i = j * 3\n\n      if (!what || what.position) {\n        const x = position![ j ]\n        const y = position![ j + 1 ]\n        const z = position![ j + 2 ]\n\n        cPosition1[ i ] = x - cOffset!\n        cPosition1[ i + 1 ] = y\n        cPosition1[ i + 2 ] = z\n        cPosition2[ i ] = x + cOffset\n        cPosition2[ i + 1 ] = y\n        cPosition2[ i + 2 ] = z\n\n        cPosition1[ i + 3 ] = x\n        cPosition1[ i + 4 ] = y - cOffset\n        cPosition1[ i + 5 ] = z\n        cPosition2[ i + 3 ] = x\n        cPosition2[ i + 4 ] = y + cOffset\n        cPosition2[ i + 5 ] = z\n\n        cPosition1[ i + 6 ] = x\n        cPosition1[ i + 7 ] = y\n        cPosition1[ i + 8 ] = z - cOffset\n        cPosition2[ i + 6 ] = x\n        cPosition2[ i + 7 ] = y\n        cPosition2[ i + 8 ] = z + cOffset\n      }\n\n      if (!what || what.color) {\n        const cimax = i + 9\n        for (let ci = i; ci < cimax; ci += 3) {\n          cColor[ ci ] = cColor2[ ci ] = color![ j ]\n          cColor[ ci + 1 ] = cColor2[ ci + 1 ] = color![ j + 1 ]\n          cColor[ ci + 2 ] = cColor2[ ci + 2 ] = color![ j + 2 ]\n        }\n      }\n\n      if (!what || what.picking) {\n        pickingArray[ j ] =\n        pickingArray[ j + 1 ] =\n        pickingArray[ j + 2 ] = picking!.array![ v ]\n      }\n    }\n\n    if (!what || what.picking) {\n      crossData.picking = new AtomPicker(\n        pickingArray, picking!.structure\n      )\n    }\n\n    return crossData\n  }\n\n  createData (sview: StructureView) {\n    const what = { position: true, color: true, picking: true }\n\n    const bufferList = []\n\n    if (this.lines) {\n      const bondData = sview.getBondData(this.getBondParams(what))\n\n      const lineBuffer = new WideLineBuffer(\n        bondData, this.getBufferParams({ linewidth: this.linewidth })\n      )\n\n      bufferList.push(lineBuffer)\n    }\n\n    if (this.crosses !== 'off') {\n      const crossBuffer = new WideLineBuffer(\n        (this._crossData(what, sview) as CrossData),\n        this.getBufferParams({linewidth: this.linewidth})\n      )\n      bufferList.push(crossBuffer)\n    }\n\n    return {\n      bufferList: bufferList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    let bufferIdx = 0\n\n    if (this.lines) {\n      const bondData = data.sview!.getBondData(this.getBondParams(what))\n      const lineAttributes = {}\n\n      if (!what || what.position) {\n        Object.assign(lineAttributes, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(lineAttributes, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      data.bufferList[ bufferIdx++ ].setAttributes(lineAttributes)\n    }\n\n    if (this.crosses !== 'off') {\n      const crossData = this._crossData(what, (data.sview as StructureView))\n      const crossAttributes = {}\n\n      if (!what || what.position) {\n        Object.assign(crossAttributes, {\n          position1: crossData!.position1,\n          position2: crossData!.position2\n        })\n      }\n      if (!what || what.color) {\n        Object.assign(crossAttributes, {\n          color: crossData!.color,\n          color2: crossData!.color2\n        })\n      }\n\n      data.bufferList[ bufferIdx++ ].setAttributes(crossAttributes)\n    }\n  }\n\n  setParameters (params: Partial<LineRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && (params.bondSpacing || params.crossSize)) {\n      Object.assign(what, { position: true })\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('line', LineRepresentation)\n\nexport default LineRepresentation\n","import { NumberArray, TypedArray } from \"../types\";\n\n/**\n * @file Grid\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\nexport interface iGrid {\n  data: TypedArray\n  index: (x: number, y: number, z: number) => number\n  set: (x: number, y: number, z: number, ...arg: number[]) => void\n  toArray: (x: number, y: number, z: number, array?: NumberArray, offset?: number) => void\n  fromArray: (x: number, y: number, z: number, array: NumberArray, offset?: number) => void\n  copy: (grid: iGrid) => void\n  // clone: () => iGrid\n}\n\nfunction makeGrid (length: number, width: number, height: number, DataCtor: any, elemSize: number) : iGrid {\n  DataCtor = DataCtor || Int32Array\n  elemSize = elemSize || 1\n\n  const data = new DataCtor(length * width * height * elemSize)\n\n  function index (x: number, y: number, z: number) {\n    return ((((x * width) + y) * height) + z) * elemSize\n  }\n\n  function set (x: number, y: number, z: number, ...args: number[]) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      data[ i + j ] = args[ j ]\n    }\n  }\n\n  function toArray (x: number, y: number, z: number, array: NumberArray = [], offset: number = 0) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      array[ offset + j ] = data[ i + j ]\n    }\n  }\n\n  function fromArray(x: number, y: number, z: number, array: NumberArray, offset: number = 0) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      data[ i + j ] = array[ offset + j ]\n    }\n  }\n\n  function copy(grid: iGrid) {\n    data.set(grid.data)\n  }\n\n  // function clone() {\n  //   return makeGrid(\n  //     length, width, height, DataCtor, elemSize\n  //   ).copy(this)\n  // }\n  return { data, index, set, toArray, fromArray, copy }\n}\n\nexport { makeGrid }","/**\n * @file EDT Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { VolumeSurface } from './volume'\nimport { iGrid, makeGrid } from '../geometry/grid'\nimport { computeBoundingBox } from '../math/vector-utils'\nimport { getRadiusDict, getSurfaceGrid } from './surface-utils'\nimport { TypedArray } from '../types';\n\ninterface EDTSurface {\n  getVolume: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean) => {\n    data: TypedArray\n    nx: number\n    ny: number\n    nz: number\n    atomindex: TypedArray\n  }\n  getSurface: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) => any\n}\n\nfunction EDTSurface (this: EDTSurface, coordList: Float32Array, radiusList: Float32Array, indexList: Uint16Array|Uint32Array) {\n  // based on D. Xu, Y. Zhang (2009) Generating Triangulated Macromolecular\n  // Surfaces by Euclidean Distance Transform. PLoS ONE 4(12): e8140.\n  //\n  // Permission to use, copy, modify, and distribute this program for\n  // any purpose, with or without fee, is hereby granted, provided that\n  // the notices on the head, the reference information, and this\n  // copyright notice appear in all copies or substantial portions of\n  // the Software. It is provided \"as is\" without express or implied\n  // warranty.\n  //\n  // ported to JavaScript by biochem_fan (http://webglmol.sourceforge.jp/)\n  // refactored by dkoes (https://github.com/dkoes)\n  //\n  // adapted to NGL by Alexander Rose\n\n  var radiusDict = getRadiusDict(radiusList as any)\n  var bbox = computeBoundingBox(coordList)\n  if (coordList.length === 0) {\n    bbox[ 0 ].set([ 0, 0, 0 ])\n    bbox[ 1 ].set([ 0, 0, 0 ])\n  }\n  var min = bbox[ 0 ]\n  var max = bbox[ 1 ]\n\n  var probeRadius: number, scaleFactor: number, cutoff: number\n  var pLength: number, pWidth: number, pHeight: number\n  var matrix: Float32Array, ptran: Float32Array\n  var depty: {[k: string]: TypedArray}, widxz: {[k: string]: number}\n  var cutRadius: number\n  var setAtomID: boolean\n  var vpBits: TypedArray, vpDistance: TypedArray, vpAtomID: TypedArray\n\n  function init (btype: boolean, _probeRadius: number, _scaleFactor: number, _cutoff: number, _setAtomID: boolean) {\n    probeRadius = _probeRadius || 1.4\n    scaleFactor = _scaleFactor || 2.0\n    setAtomID = _setAtomID || true\n\n    var maxRadius = 0\n    for (var radius in radiusDict) {\n      maxRadius = Math.max(maxRadius, radius as any)\n    }\n\n    var grid = getSurfaceGrid(\n      min, max, maxRadius, scaleFactor, btype ? probeRadius : 0\n    )\n\n    pLength = grid.dim[0]\n    pWidth = grid.dim[1]\n    pHeight = grid.dim[2]\n\n    matrix = grid.matrix\n    ptran = grid.tran\n    scaleFactor = grid.scaleFactor\n\n    // boundingatom caches\n    depty = {}\n    widxz = {}\n    boundingatom(btype)\n\n    cutRadius = probeRadius * scaleFactor\n\n    if (_cutoff) {\n      cutoff = _cutoff\n    } else {\n      // cutoff = Math.max( 0.1, -1.2 + scaleFactor * probeRadius );\n      cutoff = probeRadius / scaleFactor\n    }\n\n    vpBits = new Uint8Array(pLength * pWidth * pHeight)\n    if (btype) {\n      vpDistance = new Float64Array(pLength * pWidth * pHeight)\n    }\n    if (setAtomID) {\n      vpAtomID = new Int32Array(pLength * pWidth * pHeight)\n    }\n  }\n\n  // constants for vpBits bitmasks\n  var INOUT = 1\n  var ISDONE = 2\n  var ISBOUND = 4\n\n  var nb = [\n    new Int32Array([ 1, 0, 0 ]), new Int32Array([ -1, 0, 0 ]),\n    new Int32Array([ 0, 1, 0 ]), new Int32Array([ 0, -1, 0 ]),\n    new Int32Array([ 0, 0, 1 ]), new Int32Array([ 0, 0, -1 ]),\n    new Int32Array([ 1, 1, 0 ]), new Int32Array([ 1, -1, 0 ]),\n    new Int32Array([ -1, 1, 0 ]), new Int32Array([ -1, -1, 0 ]),\n    new Int32Array([ 1, 0, 1 ]), new Int32Array([ 1, 0, -1 ]),\n    new Int32Array([ -1, 0, 1 ]), new Int32Array([ -1, 0, -1 ]),\n    new Int32Array([ 0, 1, 1 ]), new Int32Array([ 0, 1, -1 ]),\n    new Int32Array([ 0, -1, 1 ]), new Int32Array([ 0, -1, -1 ]),\n    new Int32Array([ 1, 1, 1 ]), new Int32Array([ 1, 1, -1 ]),\n    new Int32Array([ 1, -1, 1 ]), new Int32Array([ -1, 1, 1 ]),\n    new Int32Array([ 1, -1, -1 ]), new Int32Array([ -1, -1, 1 ]),\n    new Int32Array([ -1, 1, -1 ]), new Int32Array([ -1, -1, -1 ])\n  ]\n\n  //\n\n  this.getVolume = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean) {\n    console.time('EDTSurface.getVolume')\n\n    var btype = type !== 'vws'\n\n    init(btype, probeRadius, scaleFactor, cutoff, setAtomID)\n\n    fillvoxels(btype)\n    buildboundary()\n\n    if (type === 'ms' || type === 'ses') {\n      fastdistancemap()\n    }\n\n    if (type === 'ses') {\n      boundingatom(false)\n      fillvoxelswaals()\n    }\n\n    marchingcubeinit(type)\n\n    // set atomindex in the volume data\n    for (var i = 0, il = vpAtomID.length; i < il; ++i) {\n      vpAtomID[ i ] = indexList[ vpAtomID[ i ] ]\n    }\n\n    console.timeEnd('EDTSurface.getVolume')\n\n    return {\n      data: vpBits,\n      nx: pHeight,\n      ny: pWidth,\n      nz: pLength,\n      atomindex: vpAtomID\n    }\n  }\n\n  this.getSurface = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) {\n    var vd = this.getVolume(\n      type, probeRadius, scaleFactor, cutoff, setAtomID\n    )\n\n    var volsurf = new (VolumeSurface as any)(\n      vd.data, vd.nx, vd.ny, vd.nz, vd.atomindex\n    ) as VolumeSurface\n\n    return (volsurf!.getSurface as any)(1, smooth, undefined, matrix, contour)\n  }\n\n  function boundingatom (btype: boolean) {\n    var r\n    var j\n    var k\n    var txz\n    var tdept\n    var sradius\n    var tradius\n    var widxzR\n    var deptyName\n    var indx\n\n    for (var name in radiusDict) {\n      r = parseFloat(name)\n\n      if (depty[ name ]) continue\n\n      if (!btype) {\n        tradius = r * scaleFactor + 0.5\n      } else {\n        tradius = (r + probeRadius) * scaleFactor + 0.5\n      }\n\n      sradius = tradius * tradius\n      widxzR = Math.floor(tradius) + 1\n      deptyName = new Int32Array(widxzR * widxzR)\n      indx = 0\n\n      for (j = 0; j < widxzR; ++j) {\n        for (k = 0; k < widxzR; ++k) {\n          txz = j * j + k * k\n\n          if (txz > sradius) {\n            deptyName[ indx ] = -1\n          } else {\n            tdept = Math.sqrt(sradius - txz)\n            deptyName[ indx ] = Math.floor(tdept)\n          }\n\n          ++indx\n        }\n      }\n\n      widxz[ name ] = widxzR\n      depty[ name ] = deptyName\n    }\n  }\n\n  function fillatom (idx: number) {\n    var ci = idx * 3\n    var ri = idx\n\n    var cx, cy, cz, ox, oy, oz, mi, mj, mk, i, j, k, si, sj, sk\n    var ii, jj, kk\n\n    cx = Math.floor(0.5 + scaleFactor * (coordList[ ci ] + ptran[0]))\n    cy = Math.floor(0.5 + scaleFactor * (coordList[ ci + 1 ] + ptran[1]))\n    cz = Math.floor(0.5 + scaleFactor * (coordList[ ci + 2 ] + ptran[2]))\n\n    var at = radiusList[ ri ]\n    var deptyAt = depty[ at ]\n    var nind = 0\n    var pWH = pWidth * pHeight\n    var n = widxz[ at ]\n\n    var deptyAtNind\n\n    for (i = 0; i < n; ++i) {\n      for (j = 0; j < n; ++j) {\n        deptyAtNind = deptyAt[ nind ]\n\n        if (deptyAtNind !== -1) {\n          for (ii = -1; ii < 2; ++ii) {\n            for (jj = -1; jj < 2; ++jj) {\n              for (kk = -1; kk < 2; ++kk) {\n                if (ii !== 0 && jj !== 0 && kk !== 0) {\n                  mi = ii * i\n                  mk = kk * j\n\n                  for (k = 0; k <= deptyAtNind; ++k) {\n                    mj = k * jj\n                    si = cx + mi\n                    sj = cy + mj\n                    sk = cz + mk\n\n                    if (si < 0 || sj < 0 || sk < 0 ||\n                      si >= pLength || sj >= pWidth || sk >= pHeight\n                    ) {\n                      continue\n                    }\n\n                    var index = si * pWH + sj * pHeight + sk\n\n                    if (!setAtomID) {\n                      vpBits[ index ] |= INOUT\n                    } else {\n                      if (!(vpBits[ index ] & INOUT)) {\n                        vpBits[ index ] |= INOUT\n                        vpAtomID[ index ] = idx\n                      } else if (vpBits[ index ] & INOUT) {\n                        var ci2 = vpAtomID[ index ]\n\n                        if (ci2 !== ci) {\n                          ox = cx + mi - Math.floor(0.5 + scaleFactor * (coordList[ci2] + ptran[0]))\n                          oy = cy + mj - Math.floor(0.5 + scaleFactor * (coordList[ci2 + 1] + ptran[1]))\n                          oz = cz + mk - Math.floor(0.5 + scaleFactor * (coordList[ci2 + 2] + ptran[2]))\n\n                          if (mi * mi + mj * mj + mk * mk < ox * ox + oy * oy + oz * oz) {\n                            vpAtomID[ index ] = idx\n                          }\n                        }\n                      }\n                    }\n                  } // k\n                } // if\n              } // kk\n            } // jj\n          } // ii\n        } // if\n\n        nind++\n      } // j\n    } // i\n  }\n\n  function fillvoxels (btype: boolean) {\n    console.time('EDTSurface fillvoxels')\n\n    var i, il\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      vpBits[ i ] = 0\n      if (btype) vpDistance[ i ] = -1.0\n      if (setAtomID) vpAtomID[ i ] = -1\n    }\n\n    for (i = 0, il = coordList.length / 3; i < il; ++i) {\n      fillatom(i)\n    }\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      if (vpBits[ i ] & INOUT) {\n        vpBits[ i ] |= ISDONE\n      }\n    }\n\n    console.timeEnd('EDTSurface fillvoxels')\n  }\n\n  function fillAtomWaals (idx: number) {\n    var ci = idx * 3\n    var ri = idx\n\n    var cx\n    var cy\n    var cz\n    var ox\n    var oy\n    var oz\n    var nind = 0\n\n    var mi\n    var mj\n    var mk\n    var si\n    var sj\n    var sk\n    var i\n    var j\n    var k\n    var ii\n    var jj\n    var kk\n    var n\n\n    cx = Math.floor(0.5 + scaleFactor * (coordList[ ci ] + ptran[0]))\n    cy = Math.floor(0.5 + scaleFactor * (coordList[ ci + 1 ] + ptran[1]))\n    cz = Math.floor(0.5 + scaleFactor * (coordList[ ci + 2 ] + ptran[2]))\n\n    var at = radiusList[ ri ]\n    var pWH = pWidth * pHeight\n\n    for (i = 0, n = widxz[at]; i < n; ++i) {\n      for (j = 0; j < n; ++j) {\n        if (depty[ at ][ nind ] !== -1) {\n          for (ii = -1; ii < 2; ++ii) {\n            for (jj = -1; jj < 2; ++jj) {\n              for (kk = -1; kk < 2; ++kk) {\n                if (ii !== 0 && jj !== 0 && kk !== 0) {\n                  mi = ii * i\n                  mk = kk * j\n\n                  for (k = 0; k <= depty[ at ][ nind ]; ++k) {\n                    mj = k * jj\n                    si = cx + mi\n                    sj = cy + mj\n                    sk = cz + mk\n\n                    if (si < 0 || sj < 0 || sk < 0 ||\n                      si >= pLength || sj >= pWidth || sk >= pHeight\n                    ) {\n                      continue\n                    }\n\n                    var index = si * pWH + sj * pHeight + sk\n\n                    if (!(vpBits[ index ] & ISDONE)) {\n                      vpBits[ index ] |= ISDONE\n                      if (setAtomID) vpAtomID[ index ] = idx\n                    } else if (setAtomID) {\n                      var ci2 = vpAtomID[ index ]\n\n                      ox = Math.floor(0.5 + scaleFactor * (coordList[ ci2 ] + ptran[0]))\n                      oy = Math.floor(0.5 + scaleFactor * (coordList[ ci2 + 1 ] + ptran[1]))\n                      oz = Math.floor(0.5 + scaleFactor * (coordList[ ci2 + 2 ] + ptran[2]))\n\n                      if (mi * mi + mj * mj + mk * mk < ox * ox + oy * oy + oz * oz) {\n                        vpAtomID[ index ] = idx\n                      }\n                    }\n                  } // k\n                } // if\n              } // kk\n            } // jj\n          } // ii\n        } // if\n\n        nind++\n      } // j\n    } // i\n  }\n\n  function fillvoxelswaals () {\n    var i, il\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      vpBits[ i ] &= ~ISDONE // not isdone\n    }\n\n    for (i = 0, il = coordList.length / 3; i < il; ++i) {\n      fillAtomWaals(i)\n    }\n  }\n\n  function buildboundary () {\n    var i, j, k\n    var pWH = pWidth * pHeight\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pHeight; ++j) {\n        for (k = 0; k < pWidth; ++k) {\n          var index = i * pWH + k * pHeight + j\n\n          if (vpBits[ index ] & INOUT) {\n            // var flagbound = false;\n            var ii = 0\n\n            // while( !flagbound && ii < 26 ){\n            while (ii < 26) {\n              var ti = i + nb[ ii ][ 0 ]\n              var tj = j + nb[ ii ][ 2 ]\n              var tk = k + nb[ ii ][ 1 ]\n\n              if (ti > -1 && ti < pLength &&\n                        tk > -1 && tk < pWidth &&\n                        tj > -1 && tj < pHeight &&\n                        !(vpBits[ ti * pWH + tk * pHeight + tj ] & INOUT)\n              ) {\n                vpBits[ index ] |= ISBOUND\n                // flagbound = true;\n                break\n              } else {\n                ii++\n              }\n            }\n          }\n        } // k\n      } // j\n    } // i\n  }\n\n  function fastdistancemap () {\n    console.time('EDTSurface fastdistancemap')\n\n    var i, j, k, n\n\n    var boundPoint = makeGrid(\n      pLength, pWidth, pHeight, Uint16Array, 3\n    )\n    var pWH = pWidth * pHeight\n    var cutRSq = cutRadius * cutRadius\n\n    var totalsurfacevox = 0\n    // var totalinnervox = 0;\n\n    var index\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n\n          vpBits[ index ] &= ~ISDONE\n\n          if (vpBits[ index ] & INOUT) {\n            if (vpBits[ index ] & ISBOUND) {\n              boundPoint.set(\n                i, j, k,\n                i, j, k\n              )\n\n              vpDistance[ index ] = 0\n              vpBits[ index ] |= ISDONE\n\n              totalsurfacevox += 1\n            }/* else{\n                totalinnervox += 1;\n            } */\n          }\n        }\n      }\n    }\n\n    var inarray = new Int32Array(3 * totalsurfacevox)\n    var positin = 0\n    var outarray = new Int32Array(3 * totalsurfacevox)\n    var positout = 0\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n\n          if (vpBits[ index ] & ISBOUND) {\n            inarray[ positin ] = i\n            inarray[ positin + 1 ] = j\n            inarray[ positin + 2 ] = k\n            positin += 3\n\n            vpBits[ index ] &= ~ISBOUND\n          }\n        }\n      }\n    }\n\n    do {\n      positout = fastoneshell(inarray, boundPoint, positin, outarray)\n      positin = 0\n\n      for (i = 0, n = positout; i < n; i += 3) {\n        index = pWH * outarray[ i ] + pHeight * outarray[ i + 1 ] + outarray[ i + 2 ]\n        vpBits[ index ] &= ~ISBOUND\n\n        if (vpDistance[ index ] <= 1.0404 * cutRSq) {\n          // if( vpDistance[ index ] <= 1.02 * cutRadius ){\n\n          inarray[ positin ] = outarray[ i ]\n          inarray[ positin + 1 ] = outarray[ i + 1 ]\n          inarray[ positin + 2 ] = outarray[ i + 2 ]\n          positin += 3\n        }\n      }\n    } while (positin > 0)\n\n    // var cutsf = Math.max( 0, scaleFactor - 0.5 );\n    // cutoff = cutRadius - 0.5 / ( 0.1 + cutsf );\n    var cutoffSq = cutoff * cutoff\n\n    var index2\n    var bp = new Uint16Array(3)\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n          vpBits[ index ] &= ~ISBOUND\n\n          // ses solid\n\n          if (vpBits[ index ] & INOUT) {\n            if (!(vpBits[ index ] & ISDONE) ||\n              ((vpBits[ index ] & ISDONE) && vpDistance[ index ] >= cutoffSq)\n            ) {\n              vpBits[ index ] |= ISBOUND\n\n              if (setAtomID && (vpBits[ index ] & ISDONE)) {\n                boundPoint.toArray(i, j, k, bp)\n                index2 = bp[ 0 ] * pWH + bp[ 1 ] * pHeight + bp[ 2 ]\n\n                vpAtomID[ index ] = vpAtomID[ index2 ]\n              }\n            }\n          }\n        }\n      }\n    }\n\n    console.timeEnd('EDTSurface fastdistancemap')\n  }\n\n  function fastoneshell (inarray: Int32Array, boundPoint: iGrid, positin: number, outarray: Int32Array) {\n    // *allocout,voxel2\n    // ***boundPoint, int*\n    // outnum, int *elimi)\n    var tx, ty, tz\n    var dx, dy, dz\n    var i, j, n\n    var square\n    var index\n    var nbj\n    var bp = new Uint16Array(3)\n    var positout = 0\n\n    if (positin === 0) {\n      return positout\n    }\n\n    var tnvix = -1\n    var tnviy = -1\n    var tnviz = -1\n\n    var pWH = pWidth * pHeight\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 0; j < 6; ++j) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[ index ] & INOUT) && !(vpBits[ index ] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[ index ] = square\n            vpBits[ index ] |= ISDONE\n            vpBits[ index ] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[ index ] & INOUT) && (vpBits[ index ] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[ index ]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[ index ] = square\n\n              if (!(vpBits[ index ] & ISBOUND)) {\n                vpBits[ index ] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 6; j < 18; j++) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[index] & INOUT) && !(vpBits[index] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[index] = square\n            vpBits[index] |= ISDONE\n            vpBits[index] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[index] & INOUT) && (vpBits[index] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[index]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[index] = square\n\n              if (!(vpBits[index] & ISBOUND)) {\n                vpBits[index] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 18; j < 26; j++) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[index] & INOUT) && !(vpBits[index] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[index] = square\n            vpBits[index] |= ISDONE\n            vpBits[index] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[index] & INOUT) && (vpBits[index] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[index]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[index] = square\n\n              if (!(vpBits[index] & ISBOUND)) {\n                vpBits[index] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return positout\n  }\n\n  function marchingcubeinit (stype: string) {\n    var i\n    var n = vpBits.length\n\n    if (stype === 'vws') {\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'ms') { // ses without vdw => ms\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISDONE\n        if (vpBits[ i ] & ISBOUND) {\n          vpBits[ i ] |= ISDONE\n        }\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'ses') {\n      for (i = 0; i < n; ++i) {\n        if ((vpBits[ i ] & ISBOUND) && (vpBits[ i ] & ISDONE)) {\n          vpBits[ i ] &= ~ISBOUND\n        } else if ((vpBits[ i ] & ISBOUND) && !(vpBits[ i ] & ISDONE)) {\n          vpBits[ i ] |= ISDONE\n        }\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'sas') {\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    }\n  }\n}\nObject.assign(EDTSurface, {__deps: [\n  getSurfaceGrid, getRadiusDict, VolumeSurface, computeBoundingBox, makeGrid\n]})\n\nexport default EDTSurface\n","/**\n * @file AV Surface\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { getSurfaceGrid } from './surface-utils'\nimport { VolumeSurface } from './volume'\nimport { uniformArray } from '../math/array-utils'\nimport {\n  computeBoundingBox, v3multiplyScalar, v3cross, v3normalize\n} from '../math/vector-utils'\nimport { defaults } from '../utils'\nimport { NumberArray } from '../types';\n\n\n/**\n * Modifed from SpatialHash\n *\n * Main differences are:\n * - Optimized grid size to ensure we only ever need to look +/-1 cell\n * - Aware of atomic radii and will only output atoms within rAtom + rExtra\n *   (see withinRadii method)\n *\n * (Uses rounding rather than bitshifting as consequence of arbitrary grid size)\n * @class\n * @param {Float32Array} atomsX - x coordinates\n * @param {Float32Array} atomsY - y coordinates\n * @param {Float32Array} atomsZ - z coordinates\n * @param {Float32Array} atomsR - atom radii\n * @param {Float32Array} min - xyz min coordinates\n * @param {Float32Array} max - xyz max coordinates\n * @param {Float} maxDistance - max distance\n */\nexport interface iAVHash {\n  neighbourListLength: number\n  withinRadii: (x: number, y: number, z: number, rExtra: number, out: Int32Array) => void\n}\n\n\nfunction makeAVHash (atomsX: Float32Array, atomsY: Float32Array, atomsZ: Float32Array, atomsR: Float32Array, min: Float32Array, max: Float32Array, maxDistance: number): iAVHash {\n  maxDistance = Math.max(0.1, maxDistance) // Avoid maxDistance of zero, see #802\n  var nAtoms = atomsX.length\n\n  var minX = min[ 0 ]\n  var minY = min[ 1 ]\n  var minZ = min[ 2 ]\n\n  var maxX = max[ 0 ]\n  var maxY = max[ 1 ]\n  var maxZ = max[ 2 ]\n\n  function hashFunc (w: number, minW: number) {\n    return Math.floor((w - minW) / maxDistance)\n  }\n\n  var iDim = hashFunc(maxX, minX) + 1\n  var jDim = hashFunc(maxY, minY) + 1\n  var kDim = hashFunc(maxZ, minZ) + 1\n\n  var nCells = iDim * jDim * kDim\n\n  var jkDim = jDim * kDim\n\n  /* Get cellID for cartesian x,y,z */\n  var cellID = function (x: number, y: number, z: number) {\n    return (((hashFunc(x, minX) * jDim) + hashFunc(y, minY)) * kDim) + hashFunc(z, minZ)\n  }\n\n  /* Initial building, could probably be optimized further */\n  var preHash = [] // preHash[ cellID ] = [ atomId1, atomId2 ];\n\n  for (var i = 0; i < nAtoms; i++) {\n    var cid = cellID(atomsX[ i ], atomsY[ i ], atomsZ[ i ])\n\n    if (preHash[ cid ] === undefined) {\n      preHash[ cid ] = [ i ]\n    } else {\n      preHash[ cid ].push(i)\n    }\n  }\n\n  var cellOffsets = new Uint32Array(nCells)\n  var cellLengths = new Uint16Array(nCells)\n  var data = new Uint32Array(nAtoms)\n\n  var offset = 0\n  var maxCellLength = 0\n\n  for (i = 0; i < nCells; i++) {\n    var start = cellOffsets[ i ] = offset\n\n    var subArray = preHash[ i ]\n\n    if (subArray !== undefined) {\n      for (var j = 0; j < subArray.length; j++) {\n        data[ offset ] = subArray[ j ]\n        offset++\n      }\n    }\n\n    var cellLength = offset - start\n    cellLengths[ i ] = cellLength\n\n    if (cellLength > maxCellLength) { maxCellLength = cellLength }\n  }\n\n  // Maximum number of neighbours we could ever produce (27 adjacent cells of equal population)\n  const neighbourListLength = (27 * maxCellLength) + 1\n\n  /**\n   * Populate the supplied out array with atom indices that are within rAtom + rExtra\n   * of x,y,z\n   *\n   * -1 in out array indicates the end of the list\n   *\n   * @param  {Float} x - x coordinate\n   * @param  {Float} y - y coordinate\n   * @param  {Float} z - z coordinate\n   * @param  {Float} rExtra - additional radius\n   * @param  {Float32Array} out - pre-allocated output array\n   * @return {undefined}\n   */\n  const withinRadii = function (x: number, y: number, z: number, rExtra: number, out: Int32Array) {\n    var outIdx = 0\n\n    var nearI = hashFunc(x, minX)\n    var nearJ = hashFunc(y, minY)\n    var nearK = hashFunc(z, minZ)\n\n    var loI = Math.max(0, nearI - 1)\n    var loJ = Math.max(0, nearJ - 1)\n    var loK = Math.max(0, nearK - 1)\n\n    var hiI = Math.min(iDim, nearI + 2)\n    var hiJ = Math.min(jDim, nearJ + 2)\n    var hiK = Math.min(kDim, nearK + 2)\n\n    for (var i = loI; i < hiI; ++i) {\n      var iOffset = i * jkDim\n\n      for (var j = loJ; j < hiJ; ++j) {\n        var jOffset = j * kDim\n\n        for (var k = loK; k < hiK; ++k) {\n          var cid = iOffset + jOffset + k\n\n          var cellStart = cellOffsets[ cid ]\n          var cellEnd = cellStart + cellLengths[ cid ]\n\n          for (var dataIndex = cellStart; dataIndex < cellEnd; dataIndex++) {\n            var atomIndex = data[ dataIndex ]\n            var dx = atomsX[ atomIndex ] - x\n            var dy = atomsY[ atomIndex ] - y\n            var dz = atomsZ[ atomIndex ] - z\n            var rSum = atomsR[ atomIndex ] + rExtra\n\n            if ((dx * dx + dy * dy + dz * dz) <= (rSum * rSum)) {\n              out[ outIdx++ ] = data[ dataIndex ]\n            }\n          }\n        }\n      }\n    }\n    // Add terminator\n    out[ outIdx ] = -1\n  }\n  return {\n    neighbourListLength: neighbourListLength,\n    withinRadii: withinRadii\n  }\n}\n\ninterface AVSurface {\n  getSurface: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) => any\n}\nfunction AVSurface (this: AVSurface, coordList: Float32Array, radiusList: Float32Array, indexList: Uint16Array|Uint32Array) {\n  // Field generation method adapted from AstexViewer (Mike Hartshorn)\n  // by Fred Ludlow.\n  // Other parts based heavily on NGL (Alexander Rose) EDT Surface class\n  //\n  // Should work as a drop-in alternative to EDTSurface (though some of\n  // the EDT paramters are not relevant in this method).\n\n  const nAtoms = radiusList.length\n\n  const x = new Float32Array(nAtoms)\n  const y = new Float32Array(nAtoms)\n  const z = new Float32Array(nAtoms)\n\n  for (let i = 0; i < nAtoms; i++) {\n    const ci = 3 * i\n    x[ i ] = coordList[ ci ]\n    y[ i ] = coordList[ ci + 1 ]\n    z[ i ] = coordList[ ci + 2 ]\n  }\n\n  let bbox = computeBoundingBox(coordList)\n  if (coordList.length === 0) {\n    bbox[ 0 ].set([ 0, 0, 0 ])\n    bbox[ 1 ].set([ 0, 0, 0 ])\n  }\n  const min = bbox[0]\n  const max = bbox[1]\n\n  let r: Float32Array, r2: Float32Array // Atom positions, expanded radii (squared)\n  let maxRadius: number\n\n  // Parameters\n  let probeRadius: number, scaleFactor: number, setAtomID: boolean, probePositions: number\n\n  // Cache last value for obscured test\n  let lastClip = -1\n\n  // Grid params\n  let dim: Float32Array, matrix: Float32Array, grid: NumberArray, atomIndex: Int32Array\n\n  // grid indices -> xyz coords\n  let gridx: Float32Array, gridy: Float32Array, gridz: Float32Array\n\n  // Lookup tables:\n  let sinTable: Float32Array, cosTable: Float32Array\n\n  // Spatial Hash\n  let hash: iAVHash\n\n  // Neighbour array to be filled by hash\n  let neighbours: Int32Array\n\n  // Vectors for Torus Projection\n  const atob = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const mid = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const n1 = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const n2 = new Float32Array([ 0.0, 0.0, 0.0 ])\n\n  let ngTorus: number\n\n  function init (_probeRadius?: number, _scaleFactor?: number, _setAtomID?: boolean, _probePositions?: number) {\n    probeRadius = defaults(_probeRadius, 1.4)\n    scaleFactor = defaults(_scaleFactor, 2.0)\n    setAtomID = defaults(_setAtomID, true)\n    probePositions = defaults(_probePositions, 30)\n\n    r = new Float32Array(nAtoms)\n    r2 = new Float32Array(nAtoms)\n\n    for (let i = 0; i < r.length; ++i) {\n      var rExt = radiusList[ i ] + probeRadius\n      r[ i ] = rExt\n      r2[ i ] = rExt * rExt\n    }\n\n    maxRadius = 0\n    for (let j = 0; j < r.length; ++j) {\n      if (r[ j ] > maxRadius) maxRadius = r[ j ]\n    }\n\n    initializeGrid()\n    initializeAngleTables()\n    initializeHash()\n\n    lastClip = -1\n  }\n\n  function fillGridDim (a: Float32Array, start: number, step: number) {\n    for (let i = 0; i < a.length; i++) {\n      a[i] = start + (step * i)\n    }\n  }\n\n  function initializeGrid () {\n    const surfGrid = getSurfaceGrid(\n      min, max, maxRadius, scaleFactor, 0.0\n    )\n\n    scaleFactor = surfGrid.scaleFactor\n    dim = surfGrid.dim\n    matrix = surfGrid.matrix\n\n    ngTorus = Math.max(5, 2 + Math.floor(probeRadius * scaleFactor))\n\n    grid = uniformArray(dim[0] * dim[1] * dim[2], -1001.0)\n\n    atomIndex = new Int32Array(grid.length)\n\n    gridx = new Float32Array(dim[0])\n    gridy = new Float32Array(dim[1])\n    gridz = new Float32Array(dim[2])\n\n    fillGridDim(gridx, min[0], 1 / scaleFactor)\n    fillGridDim(gridy, min[1], 1 / scaleFactor)\n    fillGridDim(gridz, min[2], 1 / scaleFactor)\n  }\n\n  function initializeAngleTables () {\n    var theta = 0.0\n    var step = 2 * Math.PI / probePositions\n\n    cosTable = new Float32Array(probePositions)\n    sinTable = new Float32Array(probePositions)\n    for (var i = 0; i < probePositions; i++) {\n      cosTable[ i ] = Math.cos(theta)\n      sinTable[ i ] = Math.sin(theta)\n      theta += step\n    }\n  }\n\n  function initializeHash () {\n    hash = makeAVHash(x, y, z, r, min, max, 2.01 * maxRadius)\n    neighbours = new Int32Array(hash.neighbourListLength)\n  }\n\n  function obscured (x: number, y: number, z: number, a: number, b: number) {\n    // Is the point at x,y,z obscured by any of the atoms\n    // specifeid by indices in neighbours. Ignore indices\n    // a and b (these are the relevant atoms in projectPoints/Torii)\n\n    // Cache the last clipped atom (as very often the same one in\n    // subsequent calls)\n    let ai: number\n\n    if (lastClip !== -1) {\n      ai = lastClip\n      if (ai !== a && ai !== b && singleAtomObscures(ai, x, y, z)) {\n        return ai\n      } else {\n        lastClip = -1\n      }\n    }\n\n    var ni = 0\n    ai = neighbours[ ni ]\n    while (ai >= 0) {\n      if (ai !== a && ai !== b && singleAtomObscures(ai, x, y, z)) {\n        lastClip = ai\n        return ai\n      }\n      ai = neighbours[ ++ni ]\n    }\n\n    lastClip = -1\n\n    return -1\n  }\n\n  function singleAtomObscures (ai: number, x: number, y: number, z: number) {\n    var ci = 3 * ai\n    var ra2 = r2[ ai ]\n    var dx = coordList[ ci ] - x\n    var dy = coordList[ ci + 1 ] - y\n    var dz = coordList[ ci + 2 ] - z\n    var d2 = dx * dx + dy * dy + dz * dz\n\n    return d2 < ra2\n  }\n\n  function projectPoints () {\n    // For each atom:\n    //     Iterate over a subsection of the grid, for each point:\n    //         If current value < 0.0, unvisited, set positive\n    //\n    //         In any case: Project this point onto surface of the atomic sphere\n    //         If this projected point is not obscured by any other atom\n    //             Calcualte delta distance and set grid value to minimum of\n    //             itself and delta\n\n    // Should we alias frequently accessed closure variables??\n    // Assume JS engine capable of optimizing this\n    // anyway...\n\n    for (var i = 0; i < nAtoms; i++) {\n      var ax = x[ i ]\n      var ay = y[ i ]\n      var az = z[ i ]\n      var ar = r[ i ]\n      var ar2 = r2[ i ]\n\n      hash.withinRadii(ax, ay, az, ar, neighbours)\n\n      // Number of grid points, round this up...\n      var ng = Math.ceil(ar * scaleFactor)\n\n      // Center of the atom, mapped to grid points (take floor)\n      var iax = Math.floor(scaleFactor * (ax - min[ 0 ]))\n      var iay = Math.floor(scaleFactor * (ay - min[ 1 ]))\n      var iaz = Math.floor(scaleFactor * (az - min[ 2 ]))\n\n      // Extents of grid to consider for this atom\n      var minx = Math.max(0, iax - ng)\n      var miny = Math.max(0, iay - ng)\n      var minz = Math.max(0, iaz - ng)\n\n      // Add two to these points:\n      // - iax are floor'd values so this ensures coverage\n      // - these are loop limits (exclusive)\n      var maxx = Math.min(dim[ 0 ], iax + ng + 2)\n      var maxy = Math.min(dim[ 1 ], iay + ng + 2)\n      var maxz = Math.min(dim[ 2 ], iaz + ng + 2)\n\n      for (var ix = minx; ix < maxx; ix++) {\n        var dx = gridx[ ix ] - ax\n        var xoffset = dim[ 1 ] * dim[ 2 ] * ix\n\n        for (var iy = miny; iy < maxy; iy++) {\n          var dy = gridy[ iy ] - ay\n          var dxy2 = dx * dx + dy * dy\n          var xyoffset = xoffset + dim[ 2 ] * iy\n\n          for (var iz = minz; iz < maxz; iz++) {\n            var dz = gridz[ iz ] - az\n            var d2 = dxy2 + dz * dz\n\n            if (d2 < ar2) {\n              var idx = iz + xyoffset\n\n              if (grid[idx] < 0.0) {\n                // Unvisited, make positive\n                grid[ idx ] = -grid[ idx ]\n              }\n              // Project on to the surface of the sphere\n              // sp is the projected point ( dx, dy, dz ) * ( ra / d )\n              var d = Math.sqrt(d2)\n              var ap = ar / d\n              var spx = dx * ap\n              var spy = dy * ap\n              var spz = dz * ap\n\n              spx += ax\n              spy += ay\n              spz += az\n\n              if (obscured(spx, spy, spz, i, -1) === -1) {\n                var dd = ar - d\n                if (dd < grid[ idx ]) {\n                  grid[ idx ] = dd\n                  if (setAtomID) atomIndex[ idx ] = i\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function projectTorii () {\n    for (var i = 0; i < nAtoms; i++) {\n      hash.withinRadii(x[ i ], y[ i ], z[ i ], r[ i ], neighbours)\n      var ia = 0\n      var ni = neighbours[ ia ]\n      while (ni >= 0) {\n        if (i < ni) {\n          projectTorus(i, ni)\n        }\n        ni = neighbours[ ++ia ]\n      }\n    }\n  }\n\n  function projectTorus (a: number, b: number) {\n    var r1 = r[ a ]\n    var r2 = r[ b ]\n    var dx = atob[ 0 ] = x[ b ] - x[ a ]\n    var dy = atob[ 1 ] = y[ b ] - y[ a ]\n    var dz = atob[ 2 ] = z[ b ] - z[ a ]\n    var d2 = dx * dx + dy * dy + dz * dz\n\n    // This check now redundant as already done in AVHash.withinRadii\n    // if( d2 > (( r1 + r2 ) * ( r1 + r2 )) ){ return; }\n\n    var d = Math.sqrt(d2)\n\n    // Find angle between a->b vector and the circle\n    // of their intersection by cosine rule\n    var cosA = (r1 * r1 + d * d - r2 * r2) / (2.0 * r1 * d)\n\n    // distance along a->b at intersection\n    var dmp = r1 * cosA\n\n    v3normalize(atob, atob)\n\n    // Create normal to line\n    normalToLine(n1 as any, atob)\n    v3normalize(n1, n1)\n\n    // Cross together for second normal vector\n    v3cross(n2, atob, n1)\n    v3normalize(n2, n2)\n\n    // r is radius of circle of intersection\n    var rInt = Math.sqrt(r1 * r1 - dmp * dmp)\n\n    v3multiplyScalar(n1, n1, rInt)\n    v3multiplyScalar(n2, n2, rInt)\n    v3multiplyScalar(atob, atob, dmp)\n\n    mid[ 0 ] = atob[ 0 ] + x[ a ]\n    mid[ 1 ] = atob[ 1 ] + y[ a ]\n    mid[ 2 ] = atob[ 2 ] + z[ a ]\n\n    lastClip = -1\n\n    var ng = ngTorus\n\n    for (var i = 0; i < probePositions; i++) {\n      var cost = cosTable[ i ]\n      var sint = sinTable[ i ]\n\n      var px = mid[ 0 ] + cost * n1[ 0 ] + sint * n2[ 0 ]\n      var py = mid[ 1 ] + cost * n1[ 1 ] + sint * n2[ 1 ]\n      var pz = mid[ 2 ] + cost * n1[ 2 ] + sint * n2[ 2 ]\n\n      if (obscured(px, py, pz, a, b) === -1) {\n        // As above, iterate over our grid...\n        // px, py, pz in grid coords\n        var iax = Math.floor(scaleFactor * (px - min[ 0 ]))\n        var iay = Math.floor(scaleFactor * (py - min[ 1 ]))\n        var iaz = Math.floor(scaleFactor * (pz - min[ 2 ]))\n\n        var minx = Math.max(0, iax - ng)\n        var miny = Math.max(0, iay - ng)\n        var minz = Math.max(0, iaz - ng)\n\n        var maxx = Math.min(dim[ 0 ], iax + ng + 2)\n        var maxy = Math.min(dim[ 1 ], iay + ng + 2)\n        var maxz = Math.min(dim[ 2 ], iaz + ng + 2)\n\n        for (var ix = minx; ix < maxx; ix++) {\n          dx = px - gridx[ ix ]\n          var xoffset = dim[ 1 ] * dim[ 2 ] * ix\n\n          for (var iy = miny; iy < maxy; iy++) {\n            dy = py - gridy[ iy ]\n            var dxy2 = dx * dx + dy * dy\n            var xyoffset = xoffset + dim[ 2 ] * iy\n\n            for (var iz = minz; iz < maxz; iz++) {\n              dz = pz - gridz[ iz ]\n              d2 = dxy2 + dz * dz\n              var idx = iz + xyoffset\n              var current = grid[ idx ]\n\n              if (current > 0.0 && d2 < (current * current)) {\n                grid[ idx ] = Math.sqrt(d2)\n                if (setAtomID) {\n                  // Is this grid point closer to a or b?\n                  // Take dot product of atob and gridpoint->p (dx, dy, dz)\n                  const dp = dx * atob[ 0 ] + dy * atob [ 1 ] + dz * atob[ 2 ]\n                  atomIndex[ idx ] = dp < 0.0 ? b : a\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function normalToLine (out: Int32Array, p: Float32Array) {\n    out[ 0 ] = out[ 1 ] = out[ 2 ] = 1.0\n    if (p[ 0 ] !== 0) {\n      out[ 0 ] = (p[ 1 ] + p[ 2 ]) / -p[ 0 ]\n    } else if (p[ 1 ] !== 0) {\n      out[ 1 ] = (p[ 0 ] + p[ 2 ]) / -p[ 1 ]\n    } else if (p[ 2 ] !== 0) {\n      out[ 2 ] = (p[ 0 ] + p[ 1 ]) / -p[ 2 ]\n    }\n    return out\n  }\n\n  function fixNegatives () {\n    for (var i = 0; i < grid.length; i++) {\n      if (grid[ i ] < 0) grid[ i ] = 0\n    }\n  }\n\n  function fixAtomIDs () {\n    for (var i = 0; i < atomIndex.length; i++) {\n      atomIndex[ i ] = indexList[ atomIndex[ i ] ]\n    }\n  }\n\n  function getVolume (probeRadius: number, scaleFactor: number, setAtomID: boolean) {\n    // Basic steps are:\n    // 1) Initialize\n    // 2) Project points\n    // 3) Project torii\n    init(probeRadius, scaleFactor, setAtomID)\n    projectPoints()\n    projectTorii()\n    fixNegatives()\n    fixAtomIDs()\n  }\n\n  this.getSurface = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) {\n    // type and cutoff left in for compatibility with EDTSurface.getSurface\n    // function signature\n\n    getVolume(probeRadius, scaleFactor, setAtomID)\n\n    var volsurf = new (VolumeSurface as any)(\n      grid, dim[ 2 ], dim[ 1 ], dim[ 0 ], atomIndex\n    ) as VolumeSurface\n\n    return volsurf.getSurface!(probeRadius, false, undefined, matrix, contour)\n  }\n}\nObject.assign(AVSurface, {__deps: [\n  getSurfaceGrid, VolumeSurface, uniformArray, computeBoundingBox,\n  v3multiplyScalar, v3cross, v3normalize,\n  makeAVHash,\n  defaults\n]})\n\nexport { AVSurface, makeAVHash }\n","/**\n * @file Molecular Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { WorkerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Worker from '../worker/worker'\nimport EDTSurface from './edt-surface'\nimport { AVSurface } from './av-surface'\nimport Surface, { SurfaceData } from './surface'\nimport { Structure } from '../ngl';\nimport { AtomData, RadiusParams } from '../structure/structure-data';\n\nWorkerRegistry.add('molsurf', function func (e: any, callback: (data: any, buffers: any[])=> void) {\n  const a = e.data.args\n  const p = e.data.params\n  if (a && p) {\n    const SurfClass = (p.type === 'av') ? AVSurface : EDTSurface\n    const surf = new (SurfClass as any)(a.coordList, a.radiusList, a.indexList) as AVSurface|EDTSurface\n    const sd = surf.getSurface(\n      p.type, p.probeRadius, p.scaleFactor, p.cutoff, true, p.smooth, p.contour\n    ) as SurfaceData\n    const transferList = [ sd.position.buffer, sd.index!.buffer ]\n    if (sd.normal) transferList.push(sd.normal.buffer)\n    if (sd.atomindex) transferList.push(sd.atomindex.buffer)\n    const data = {\n      sd: sd,\n      p: p\n    }\n    callback(data, transferList)\n  }\n}, [ EDTSurface, AVSurface ])\n\n/**\n * Molecular surface parameter object.\n * @typedef {Object} MolecularSurfaceParameters - stage parameters\n * @property {String} type - \"av\" or \"edt\"\n * @property {Number} probeRadius - probe radius\n * @property {Number} scaleFactor - higher for better quality\n * @property {Integer} smooth - number of smoothing cycles to apply\n * @property {String} name - name for created surface\n */\nexport interface MolecularSurfaceParameters {\n  type: 'av'|'edt'\n  probeRadius: number\n  scaleFactor: number\n  smooth: number\n  name: string\n  cutoff: number\n  contour: boolean,\n  radiusParams: RadiusParams\n}\n/**\n * Create Molecular surfaces\n */\nclass MolecularSurface {\n  structure: Structure\n  worker: Worker|undefined\n\n  constructor (structure: Structure) {\n    this.structure = structure\n  }\n\n  _getAtomData (params: Partial<MolecularSurfaceParameters>): AtomData {\n    return this.structure.getAtomData({\n      what: { position: true, radius: true, index: true },\n      radiusParams: defaults(params.radiusParams, {\n        type: 'vdw', scale: 1.0\n      })\n    })\n  }\n\n  _makeSurface (sd: SurfaceData, p: Partial<MolecularSurfaceParameters>) {\n    var surface = new Surface(p.name!, '', sd)\n\n    surface.info.type = p.type\n    surface.info.probeRadius = p.probeRadius\n    surface.info.scaleFactor = p.scaleFactor\n    surface.info.smooth = p.smooth\n    surface.info.cutoff = p.cutoff\n\n    return surface\n  }\n\n  /**\n   * Get molecular surface\n   * @param {MolecularSurfaceParameters} params - parameters for surface creation\n   * @return {Surface} the surface\n   */\n  getSurface (params: Partial<MolecularSurfaceParameters>) {\n    const p = params || {}\n\n    const atomData = this._getAtomData(params)\n    const coordList = atomData.position\n    const radiusList = atomData.radius\n    const indexList = atomData.index\n\n    const SurfClass = (p.type === 'av') ? AVSurface : EDTSurface\n    const surf = new (SurfClass as any)(coordList, radiusList, indexList) as AVSurface|EDTSurface\n    const sd = surf.getSurface(\n      p.type!, p.probeRadius!, p.scaleFactor!, p.cutoff!, true, p.smooth!, p.contour!\n    )\n\n    return this._makeSurface(sd, p)\n  }\n\n  /**\n   * Get molecular surface asynchronous\n   * @param {MolecularSurfaceParameters} params - parameters for surface creation\n   * @param {function(surface: Surface)} callback - function to be called after surface is created\n   * @return {undefined}\n   */\n  getSurfaceWorker (params: MolecularSurfaceParameters, callback: (s: Surface) => void) {\n    const p = Object.assign({}, params)\n\n    if (window.hasOwnProperty('Worker')) {\n      if (this.worker === undefined) {\n        this.worker = new Worker('molsurf')\n      }\n\n      const atomData = this._getAtomData(params)\n      const coordList = atomData.position\n      const radiusList = atomData.radius\n      const indexList = atomData.index\n\n      const msg = {\n        args: {\n          coordList: coordList,\n          radiusList: radiusList,\n          indexList: indexList\n        },\n        params: p\n      }\n\n      const transferList = [\n        coordList!.buffer, radiusList!.buffer, indexList!.buffer\n      ]\n\n      this.worker.post(msg, transferList,\n\n        (e: any) => {\n          callback(this._makeSurface(e.data.sd, p))\n        },\n\n        (e: string) => {\n          console.warn(\n            'MolecularSurface.getSurfaceWorker error - trying without worker', e\n          )\n          this.worker!.terminate()\n          this.worker = undefined\n          const surface = this.getSurface(p)\n          callback(surface)\n        }\n\n      )\n    } else {\n      const surface = this.getSurface(p)\n      callback(surface)\n    }\n  }\n\n  /**\n   * Cleanup\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.worker) this.worker.terminate()\n  }\n}\n\nexport default MolecularSurface\n","/**\n * @file Molecular Surface Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport MolecularSurface, { MolecularSurfaceParameters } from '../surface/molecular-surface'\nimport SurfaceBuffer from '../buffer/surface-buffer'\nimport ContourBuffer from '../buffer/contour-buffer'\nimport DoubleSidedBuffer from '../buffer/doublesided-buffer'\nimport Selection from '../selection/selection'\nimport Viewer from '../viewer/viewer';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Vector3, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport { SurfaceDataFields } from './surface-representation';\nimport Surface, {SurfaceData} from '../surface/surface';\n\nexport interface MolecularSurfaceRepresentationParameters extends StructureRepresentationParameters {\n  surfaceType: 'vws'|'sas'|'ms'|'ses'|'av'\n  probeRadius: number\n  smooth: number\n  scaleFactor: number\n  cutoff: number\n  contour: boolean\n  background: boolean\n  opaqueBack: boolean\n  filterSele: string\n  colorVolume: any\n  useWorker: boolean\n}\n\nexport interface MolecularSurfaceInfo {\n  molsurf?: MolecularSurface\n  sele?: string\n  surface?: Surface\n}\n\n/**\n * Molecular Surface Representation\n */\nclass MolecularSurfaceRepresentation extends StructureRepresentation {\n  protected surfaceType: 'vws'|'sas'|'ms'|'ses'|'av'\n  protected probeRadius: number\n  protected smooth: number\n  protected scaleFactor: number\n  protected cutoff: number\n  protected contour: boolean\n  protected background: boolean\n  protected opaqueBack: boolean\n  protected filterSele: string\n  protected colorVolume: any\n  protected useWorker: boolean\n\n  protected __infoList: MolecularSurfaceInfo[]\n  protected __forceNewMolsurf: boolean\n  protected __sele: string\n  protected __surfaceParams: string\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<MolecularSurfaceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'surface'\n\n    this.parameters = Object.assign({\n\n      surfaceType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'vws': 'vws',\n          'sas': 'sas',\n          'ms': 'ms',\n          'ses': 'ses',\n          'av': 'av'\n        }\n      },\n      probeRadius: {\n        type: 'number',\n        precision: 1,\n        max: 20,\n        min: 0,\n        rebuild: true\n      },\n      smooth: {\n        type: 'integer',\n        precision: 1,\n        max: 10,\n        min: 0,\n        rebuild: true\n      },\n      scaleFactor: {\n        type: 'number',\n        precision: 1,\n        max: 5,\n        min: 0,\n        rebuild: true\n      },\n      cutoff: {\n        type: 'number',\n        precision: 2,\n        max: 50,\n        min: 0,\n        rebuild: true\n      },\n      contour: {\n        type: 'boolean', rebuild: true\n      },\n      background: {\n        type: 'boolean', rebuild: true // FIXME\n      },\n      opaqueBack: {\n        type: 'boolean', buffer: true\n      },\n      filterSele: {\n        type: 'text', rebuild: true\n      },\n      colorVolume: {\n        type: 'hidden'\n      },\n      useWorker: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      radius: null,\n      scale: null\n\n    })\n\n    this.__infoList = []\n\n    // TODO find a more direct way\n    this.structure.signals.refreshed.add(() => {\n      this.__forceNewMolsurf = true\n    })\n\n    this.toBePrepared = true\n\n    this.init(params)\n  }\n\n  init (params: Partial<MolecularSurfaceRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n    p.disablePicking = defaults(p.disablePicking, true)\n\n    this.surfaceType = defaults(p.surfaceType, 'ms')\n    this.probeRadius = defaults(p.probeRadius, 1.4)\n    this.smooth = defaults(p.smooth, 2)\n    this.scaleFactor = defaults(p.scaleFactor, 2.0)\n    this.cutoff = defaults(p.cutoff, 0.0)\n    this.contour = defaults(p.contour, false)\n    this.background = defaults(p.background, false)\n    this.opaqueBack = defaults(p.opaqueBack, true)\n    this.filterSele = defaults(p.filterSele, '')\n    this.colorVolume = defaults(p.colorVolume, undefined)\n    this.useWorker = defaults(p.useWorker, true)\n\n    super.init(params)\n  }\n\n  prepareData (sview: StructureView, i: number, callback: (i: number) => void) {\n    let info: MolecularSurfaceInfo = this.__infoList[ i ]\n    if (!info) {\n      info = {}\n      this.__infoList[ i ] = info\n    }\n\n    if (!info.molsurf || info.sele !== sview.selection.string) {\n      if (this.filterSele) {\n        const sviewFilter = sview.structure.getView(new Selection(this.filterSele))\n        const bbSize = sviewFilter.boundingBox.getSize(new Vector3())\n        const maxDim = Math.max(bbSize.x, bbSize.y, bbSize.z)\n        const asWithin = sview.getAtomSetWithinPoint(sviewFilter.center, (maxDim / 2) + 6.0)\n        sview = sview.getView(\n          new Selection(sview.getAtomSetWithinSelection(asWithin, 3).toSeleString())\n        )\n        if (sview.atomCount === 0) {\n          callback(i)\n          return\n        }\n      }\n\n      info.sele = sview.selection.string\n      info.molsurf = new MolecularSurface(sview)\n\n      const p = this.getSurfaceParams()\n      const onSurfaceFinish = (surface: Surface) => {\n        info.surface = surface\n        callback(i)\n      }\n\n      if (this.useWorker) {\n        info.molsurf.getSurfaceWorker(p as MolecularSurfaceParameters, onSurfaceFinish)\n      } else {\n        onSurfaceFinish(info.molsurf.getSurface(p as {name: string, type: 'av'|'edt' } & MolecularSurfaceRepresentationParameters))\n      }\n    } else {\n      callback(i)\n    }\n  }\n\n  prepare (callback: () => void) {\n    if (this.__forceNewMolsurf || this.__sele !== this.selection.string ||\n          this.__surfaceParams !== JSON.stringify(this.getSurfaceParams())) {\n      this.__infoList.forEach((info: MolecularSurfaceInfo) => {\n        if (info && info.molsurf) {\n          info.molsurf.dispose()\n        }\n      })\n      this.__infoList.length = 0\n    }\n\n    if (this.structureView.atomCount === 0) {\n      callback()\n      return\n    }\n\n    const after = () => {\n      this.__sele = this.selection.string\n      this.__surfaceParams = JSON.stringify(this.getSurfaceParams())\n      this.__forceNewMolsurf = false\n      callback()\n    }\n\n    const name = this.assembly === 'default' ? this.defaultAssembly : this.assembly\n    const assembly = this.structure.biomolDict[ name ]\n\n    if (assembly) {\n      assembly.partList.forEach((part, i) => {\n        const sview = part.getView(this.structureView)\n        this.prepareData(sview as StructureView, i, (_i) => {\n          if (_i === assembly.partList.length - 1) after()\n        })\n      })\n    } else {\n      this.prepareData(this.structureView, 0, after)\n    }\n  }\n\n  createData (sview: StructureView, i: number) {\n    const info = this.__infoList[ i ]\n    const surface = info.surface\n\n    if (!surface) {\n      // Surface creation bailed (no surface generated for this sview)\n      return\n    }\n\n    const surfaceData = {\n      position: surface!.getPosition(),\n      color: surface!.getColor(this.getColorParams()),\n      index: surface!.getFilteredIndex(this.filterSele, sview)\n    }\n\n    const bufferList = []\n\n    if (surface.contour) {\n      const contourBuffer = new ContourBuffer(\n        surfaceData,\n        this.getBufferParams({\n          wireframe: false\n        })\n      )\n\n      bufferList.push(contourBuffer)\n    } else {\n      Object.assign(surfaceData, {\n        normal: surface.getNormal(),\n        picking: surface.getPicking(sview.getStructure())\n      })\n\n      const surfaceBuffer = new SurfaceBuffer(\n        surfaceData,\n        this.getBufferParams({\n          background: this.background,\n          opaqueBack: this.opaqueBack,\n          dullInterior: false\n        })\n      )\n\n      if (this.getBufferParams().side == 'double') {\n        const doubleSidedBuffer = new DoubleSidedBuffer(surfaceBuffer)\n        bufferList.push(doubleSidedBuffer)\n      }\n      else {\n        bufferList.push(surfaceBuffer)\n      }\n    }\n\n    return { bufferList, info } as StructureRepresentationData\n  }\n\n  updateData (what: SurfaceDataFields, data: StructureRepresentationData) {\n    const surfaceData: Partial<SurfaceData> = {}\n\n    if (what.position || what.radius) {\n      this.__forceNewMolsurf = true\n      this.build()\n      return\n    }\n\n    if (what.color) {\n      surfaceData.color = data.info.surface.getColor(this.getColorParams())\n    }\n\n    if (what.index) {\n      surfaceData.index = data.info.surface.getFilteredIndex(this.filterSele, data.sview)\n    }\n\n    data.bufferList[ 0 ].setAttributes(surfaceData)\n  }\n\n  setParameters (params: Partial<MolecularSurfaceRepresentationParameters>, what: Partial<SurfaceDataFields> = {}, rebuild?: boolean) {\n    if (params && params.filterSele) {\n      what.index = true\n    }\n\n    if (params && params.colorVolume !== undefined) {\n      what.color = true\n    }\n\n    // forbid setting wireframe to true when contour is true\n    if (params && params.wireframe && (\n      params.contour || (params.contour === undefined && this.contour)\n    )\n    ) {\n      params.wireframe = false\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n\n  getSurfaceParams (params: Partial<MolecularSurfaceRepresentationParameters> = {}) {\n    const p = Object.assign({\n      type: this.surfaceType as string,\n      probeRadius: this.probeRadius as number,\n      scaleFactor: this.scaleFactor as number,\n      smooth: this.smooth && !this.contour,\n      cutoff: this.cutoff as number,\n      contour: this.contour as boolean,\n      useWorker: this.useWorker as boolean,\n      radiusParams: this.getRadiusParams()\n    }, params)\n\n    return p\n  }\n\n  getColorParams () {\n    const p = super.getColorParams()\n\n    p.volume = this.colorVolume\n\n    return p\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n\n  clear () {\n    super.clear()\n  }\n\n  dispose () {\n    this.__infoList.forEach((info: MolecularSurfaceInfo) => {\n      if (info && info.molsurf) {\n        info.molsurf.dispose()\n      }\n    })\n    this.__infoList.length = 0\n\n    super.dispose()\n  }\n}\n\nRepresentationRegistry.add('surface', MolecularSurfaceRepresentation)\n\nexport default MolecularSurfaceRepresentation\n","/**\n * @file Point Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport PointBuffer from '../buffer/point-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields } from '../structure/structure-data';\n\nexport interface PointRepresentationParameters extends StructureRepresentationParameters {\n  pointSize: number\n  sizeAttenuation: boolean\n  sortParticles: boolean\n  useTexture: boolean\n  alphaTest: number\n  forceTransparent: boolean\n  edgeBleach: number\n}\n\n/**\n * Point Representation\n */\nclass PointRepresentation extends StructureRepresentation {\n  protected pointSize: number\n  protected sizeAttenuation: boolean\n  protected sortParticles: boolean\n  protected useTexture: boolean\n  protected alphaTest: number\n  protected forceTransparent: boolean\n  protected edgeBleach: number\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<PointRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'point'\n\n    this.parameters = Object.assign({\n\n      pointSize: {\n        type: 'number', precision: 1, max: 100, min: 0, buffer: true\n      },\n      sizeAttenuation: {\n        type: 'boolean', buffer: true\n      },\n      sortParticles: {\n        type: 'boolean', rebuild: true\n      },\n      useTexture: {\n        type: 'boolean', buffer: true\n      },\n      alphaTest: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      },\n      forceTransparent: {\n        type: 'boolean', buffer: true\n      },\n      edgeBleach: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      wireframe: null,\n      linewidth: null,\n      side: null,\n\n      roughness: null,\n      metalness: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<PointRepresentationParameters>) {\n    var p = params || {}\n\n    this.pointSize = defaults(p.pointSize, 1)\n    this.sizeAttenuation = defaults(p.sizeAttenuation, true)\n    this.sortParticles = defaults(p.sortParticles, false)\n    this.useTexture = defaults(p.useTexture, false)\n    this.alphaTest = defaults(p.alphaTest, 0.5)\n    this.forceTransparent = defaults(p.forceTransparent, false)\n    this.edgeBleach = defaults(p.edgeBleach, 0.0)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    var what = { position: true, color: true, picking: true }\n    var atomData = sview.getAtomData(this.getAtomParams(what))\n\n    var pointBuffer = new PointBuffer(\n      atomData,\n      this.getBufferParams({\n        pointSize: this.pointSize,\n        sizeAttenuation: this.sizeAttenuation,\n        sortParticles: this.sortParticles,\n        useTexture: this.useTexture,\n        alphaTest: this.alphaTest,\n        forceTransparent: this.forceTransparent,\n        edgeBleach: this.edgeBleach\n      })\n    )\n\n    return {\n      bufferList: [ pointBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams(what))\n    var pointData = {}\n\n    if (!what || what.position) {\n      Object.assign(pointData, {position: atomData.position})\n    }\n\n    if (!what || what.color) {\n      Object.assign(pointData, {color: atomData.color})\n    }\n\n    data.bufferList[ 0 ].setAttributes(pointData)\n  }\n\n  getAtomRadius () {\n    return 0.1\n  }\n}\n\nRepresentationRegistry.add('point', PointRepresentation)\n\nexport default PointRepresentation\n","/**\n * @file Ribbon Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Ribbon.vert'\n\nimport { getUintArray } from '../utils'\nimport { serialArray } from '../math/array-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferParameters, BufferData } from './buffer'\nimport {Log} from \"../globals\";\n\nconst quadIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\nexport interface RibbonBufferData extends BufferData {\n  normal: Float32Array\n  dir: Float32Array\n  size: Float32Array\n}\n\nfunction getSize(data: RibbonBufferData){\n  const n = (data.position!.length / 3) - 1\n  const n4 = n * 4\n  const x = n4 * 3\n  return x\n}\n\n/**\n * Ribbon buffer. Draws a thin ribbon.\n */\nclass RibbonBuffer extends MeshBuffer {\n  vertexShader = 'Ribbon.vert'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.normal - normals\n   * @param  {Float32Array} data.dir - binormals\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: RibbonBufferData, params: Partial<BufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data)),\n      index: getUintArray(getSize(data), getSize(data) / 3),\n      normal: new Float32Array(getSize(data)),\n      picking: data.picking\n    }, params)\n\n    const n = (data.position!.length / 3) - 1\n    const n4 = n * 4\n    const x = n4 * 3\n\n    this.addAttributes({\n      'dir': { type: 'v3', value: new Float32Array(x) }\n    })\n    this.addAttributes({\n      'size': { type: 'f', value: new Float32Array(n4) }\n    })\n\n    data.primitiveId = serialArray(n)\n    this.setAttributes(data)\n\n    this.makeIndex()\n  }\n\n  setAttributes (data: Partial<RibbonBufferData> = {}) {\n    const n4 = this.size\n    const n = n4 / 4\n\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, normal, size, dir, color, primitiveId\n    let aPosition, aNormal, aSize, aDir, aColor, aPrimitiveId\n\n    if (data.position) {\n      position = data.position\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.normal) {\n      normal = data.normal\n      aNormal = attributes.normal.array\n      attributes.normal.needsUpdate = true\n    }\n\n    if (data.size) {\n      size = data.size\n      aSize = attributes.size.array\n      attributes.size.needsUpdate = true\n    }\n\n    if (data.dir) {\n      dir = data.dir\n      aDir = attributes.dir.array\n      attributes.dir.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      aColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (data.primitiveId) {\n      primitiveId = data.primitiveId\n      aPrimitiveId = attributes.primitiveId.array\n      attributes.primitiveId.needsUpdate = true\n    }\n\n    let v, i, k, p, l, v3\n    let currSize\n    let prevSize = size ? size[ 0 ] : null\n\n    for (v = 0; v < n; ++v) {\n      v3 = v * 3\n      k = v * 3 * 4\n      l = v * 4\n\n      if (position) {\n        aPosition[ k ] = aPosition[ k + 3 ] = position[ v3 ]\n        aPosition[ k + 1 ] = aPosition[ k + 4 ] = position[ v3 + 1 ]\n        aPosition[ k + 2 ] = aPosition[ k + 5 ] = position[ v3 + 2 ]\n\n        aPosition[ k + 6 ] = aPosition[ k + 9 ] = position[ v3 + 3 ]\n        aPosition[ k + 7 ] = aPosition[ k + 10 ] = position[ v3 + 4 ]\n        aPosition[ k + 8 ] = aPosition[ k + 11 ] = position[ v3 + 5 ]\n      }\n\n      if (normal) {\n        aNormal[ k ] = aNormal[ k + 3 ] = -normal[ v3 ]\n        aNormal[ k + 1 ] = aNormal[ k + 4 ] = -normal[ v3 + 1 ]\n        aNormal[ k + 2 ] = aNormal[ k + 5 ] = -normal[ v3 + 2 ]\n\n        aNormal[ k + 6 ] = aNormal[ k + 9 ] = -normal[ v3 + 3 ]\n        aNormal[ k + 7 ] = aNormal[ k + 10 ] = -normal[ v3 + 4 ]\n        aNormal[ k + 8 ] = aNormal[ k + 11 ] = -normal[ v3 + 5 ]\n      }\n\n      for (i = 0; i < 4; ++i) {\n        p = k + 3 * i\n\n        if (color) {\n          aColor[ p ] = color[ v3 ]\n          aColor[ p + 1 ] = color[ v3 + 1 ]\n          aColor[ p + 2 ] = color[ v3 + 2 ]\n        }\n\n        if (primitiveId) {\n          aPrimitiveId[ l + i ] = primitiveId[ v ]\n        }\n      }\n\n      if (size) {\n        currSize = size[ v ]\n\n        if (prevSize !== size[ v ]) {\n          aSize[ l ] = prevSize\n          aSize[ l + 1 ] = prevSize\n          aSize[ l + 2 ] = currSize\n          aSize[ l + 3 ] = currSize\n        } else {\n          aSize[ l ] = currSize\n          aSize[ l + 1 ] = currSize\n          aSize[ l + 2 ] = currSize\n          aSize[ l + 3 ] = currSize\n        }\n\n        prevSize = currSize\n      }\n\n      if (dir) {\n        aDir[ k ] = dir[ v3 ]\n        aDir[ k + 1 ] = dir[ v3 + 1 ]\n        aDir[ k + 2 ] = dir[ v3 + 2 ]\n\n        aDir[ k + 3 ] = -dir[ v3 ]\n        aDir[ k + 4 ] = -dir[ v3 + 1 ]\n        aDir[ k + 5 ] = -dir[ v3 + 2 ]\n\n        aDir[ k + 6 ] = dir[ v3 + 3 ]\n        aDir[ k + 7 ] = dir[ v3 + 4 ]\n        aDir[ k + 8 ] = dir[ v3 + 5 ]\n\n        aDir[ k + 9 ] = -dir[ v3 + 3 ]\n        aDir[ k + 10 ] = -dir[ v3 + 4 ]\n        aDir[ k + 11 ] = -dir[ v3 + 5 ]\n      }\n    }\n  }\n\n  makeIndex () {\n    const index = this.geometry.getIndex()\n    if (!index) { Log.error('Index is null'); return; }\n    const meshIndex = index.array as Uint32Array|Uint16Array\n    const n = meshIndex.length / 4 / 3\n\n    for (let v = 0; v < n; ++v) {\n      const ix = v * 6\n      const it = v * 4\n\n      meshIndex.set(quadIndices, ix)\n      for (let s = 0; s < 6; ++s) {\n        meshIndex[ ix + s ] += it\n      }\n    }\n  }\n}\n\nexport default RibbonBuffer\n","/**\n * @file Ribbon Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Spline, { SplineParameters } from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport RibbonBuffer from '../buffer/ribbon-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\n\nexport interface RibbonRepresentationParameters extends StructureRepresentationParameters {\n  subdiv: number\n  tension: number\n  smoothSheet: boolean\n}\n\n/**\n * Ribbon Representation\n */\nclass RibbonRepresentation extends StructureRepresentation {\n  protected subdiv: number\n  protected tension: number\n  protected smoothSheet: boolean\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<RibbonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'ribbon'\n\n    this.parameters = Object.assign({\n\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      side: null,\n      wireframe: null,\n      linewidth: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<RibbonRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n    p.radiusType = defaults(p.radiusType, 'sstruc')\n    p.radiusScale = defaults(p.radiusScale, 4.0)\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    this.tension = defaults(p.tension, NaN)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: Partial<SplineParameters>) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: true,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  createData (sview: StructureView) {\n    var bufferList: RibbonBuffer[] = []\n    var polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      var spline = new Spline(polymer, this.getSplineParams())\n      var subPos = spline.getSubdividedPosition()\n      var subOri = spline.getSubdividedOrientation()\n      var subCol = spline.getSubdividedColor(this.getColorParams())\n      var subPick = spline.getSubdividedPicking()\n      var subSize = spline.getSubdividedSize(this.getRadiusParams())\n\n      bufferList.push(\n        new RibbonBuffer(\n          ({\n            position: subPos.position,\n            normal: subOri.binormal,\n            dir: subOri.normal,\n            color: subCol.color,\n            size: subSize.size,\n            picking: subPick.picking\n          }),\n          this.getBufferParams()\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: {position?: boolean, radius?: boolean, scale?: boolean, color?: boolean}, data: {polymerList: Polymer[], bufferList: RibbonBuffer[]}) {\n    what = what || {}\n\n    var i = 0\n    var n = data.polymerList.length\n\n    for (i = 0; i < n; ++i) {\n      var bufferData = {}\n      var spline = new Spline(data.polymerList[ i ], this.getSplineParams())\n\n      if (what.position) {\n        var subPos = spline.getSubdividedPosition()\n        var subOri = spline.getSubdividedOrientation()\n        Object.assign(bufferData, {\n          position: subPos.position,\n          normal: subOri.binormal,\n          dir: subOri.normal\n        })\n      }\n\n      if (what.radius || what.scale) {\n        var subSize = spline.getSubdividedSize(this.getRadiusParams())\n        Object.assign(bufferData, {size: subSize.size})\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        Object.assign(bufferData, {color: subCol.color})\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n  }\n\n  setParameters (params: Partial<RibbonRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && params.tension) {\n      Object.assign(what, {position: true})\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('ribbon', RibbonRepresentation)\n\nexport default RibbonRepresentation\n","/**\n * @file Rocket Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AtomPicker } from '../utils/picker'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport Helixbundle, { Axis } from '../geometry/helixbundle'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n\nexport interface RocketRepresentationParameters extends StructureRepresentationParameters {\n  localAngle: number\n  centerDist: number\n  ssBorder: boolean\n  radialSegments: number\n  openEnded: boolean\n  disableImpostor: boolean\n}\n\nexport interface AxisData {\n  begin: Float32Array\n  end: Float32Array\n  size: Float32Array\n  color: Float32Array\n  picking: AtomPicker\n}\n\n/**\n * Rocket Representation\n */\nclass RocketRepresentation extends StructureRepresentation {\n\n  protected localAngle: number\n  protected centerDist: number\n  protected ssBorder: boolean\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  // protected helixbundleList: Helixbundle[]\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<RocketRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'rocket'\n\n    this.parameters = Object.assign({\n\n      localAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      centerDist: {\n        type: 'number', precision: 1, max: 10, min: 0, rebuild: true\n      },\n      ssBorder: {\n        type: 'boolean', rebuild: true\n      },\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true\n\n    }, this.parameters)\n\n    // this.helixbundleList = []\n\n    this.init(params)\n  }\n\n  init (params: Partial<RocketRepresentationParameters>) {\n    let p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'sstruc')\n    p.radiusSize = defaults(p.radiusSize, 1.5)\n    p.radiusScale = defaults(p.radiusScale, 1.0)\n    p.openEnded = defaults(p.openEnded, false)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.localAngle = defaults(p.localAngle, 30)\n    this.centerDist = defaults(p.centerDist, 2.5)\n    this.ssBorder = defaults(p.ssBorder, false)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    let length = 0\n    const axisList:Axis[] = []\n    const helixbundleList:Helixbundle[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4 || polymer.isNucleic()) return\n\n      const helixbundle = new Helixbundle(polymer)\n      const axis = helixbundle.getAxis(\n        this.localAngle, this.centerDist, this.ssBorder,\n        this.getColorParams(), this.getRadiusParams()\n      )\n\n      length += axis.size.length\n      axisList.push(axis)\n      helixbundleList.push(helixbundle)\n    }, sview.getSelection())\n\n    const axisData = {\n      begin: new Float32Array(length * 3),\n      end: new Float32Array(length * 3),\n      size: new Float32Array(length),\n      color: new Float32Array(length * 3),\n      picking: <AtomPicker>{}\n    }\n\n    let picking = new Float32Array(length)\n\n    let offset = 0\n\n    axisList.forEach(function (axis) {\n      axisData.begin.set(axis.begin, offset * 3)\n      axisData.end.set(axis.end, offset * 3)\n      axisData.size.set(axis.size, offset)\n      axisData.color.set(axis.color, offset * 3)\n      picking.set(axis.picking.array!, offset)\n      offset += axis.size.length\n    })\n\n    if (length) {\n      axisData.picking = new AtomPicker(\n        picking, sview.getStructure()\n      )\n    }\n\n    const cylinderBuffer = new CylinderBuffer(\n      {\n        position1: axisData.begin,\n        position2: axisData.end,\n        color: axisData.color,\n        color2: axisData.color,\n        radius: axisData.size,\n        picking: axisData.picking\n      },\n      this.getBufferParams({\n        openEnded: this.openEnded,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    return {\n      bufferList: [ cylinderBuffer as CylinderGeometryBuffer|CylinderImpostorBuffer ],\n      axisList: axisList,\n      helixbundleList: helixbundleList,\n      axisData: axisData\n    }\n  }\n\n  \n  updateData (what: any, data: {bufferList: CylinderBuffer[], helixbundleList: Helixbundle[], axisList: Axis[], axisData: AxisData}) {\n    what = what || {}\n\n    if (what.position) {\n      this.build()\n      return\n    }\n\n    var cylinderData = {}\n\n    if (what.color || what.radius) {\n      var offset = 0\n\n      data.helixbundleList.forEach((helixbundle) => {\n        var axis = helixbundle.getAxis(\n          this.localAngle, this.centerDist, this.ssBorder,\n          this.getColorParams(), this.getRadiusParams()\n        )\n        if (what.color) {\n          data.axisData.color.set(axis.color, offset * 3)\n        }\n        if (what.radius || what.scale) {\n          data.axisData.size.set(axis.size, offset)\n        }\n        offset += axis.size.length\n      })\n\n      if (what.color) {\n        Object.assign(cylinderData, {\n          color: data.axisData.color,\n          color2: data.axisData.color\n        })\n      }\n\n      if (what.radius || what.scale) {\n        Object.assign(cylinderData, {\n          radius: data.axisData.size\n        })\n      }\n    }\n\n    (data.bufferList[ 0 ] as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('rocket', RocketRepresentation)\n\nexport default RocketRepresentation\n","/**\n * @file Rope Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport CartoonRepresentation, { CartoonRepresentationParameters } from './cartoon-representation'\nimport Helixorient from '../geometry/helixorient'\nimport Spline from '../geometry/spline'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport Polymer from '../proxy/polymer';\n\n/**\n * Rope Representation\n */\nclass RopeRepresentation extends CartoonRepresentation {\n  protected smooth: number\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>&{smooth: number}) {\n    super(structure, viewer, params)\n\n    this.type = 'rope'\n\n    this.parameters = Object.assign({\n\n      smooth: {\n        type: 'integer', max: 15, min: 0, rebuild: true\n      }\n\n    }, this.parameters, {\n      aspectRatio: null,\n      smoothSheet: null\n    })\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n    p.tension = defaults(p.tension, 0.5)\n    p.radiusScale = defaults(p.radiusScale, 5.0)\n    p.smoothSheet = false\n\n    this.smooth = defaults(p.smooth, 2)\n\n    super.init(p)\n  }\n\n  getSpline (polymer: Polymer) {\n    var helixorient = new Helixorient(polymer)\n\n    return new Spline(polymer, this.getSplineParams({\n      directional: false,\n      positionIterator: helixorient.getCenterIterator(this.smooth)\n    }))\n  }\n}\n\nRepresentationRegistry.add('rope', RopeRepresentation)\n\nexport default RopeRepresentation\n","/**\n * @file Spacefill Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereImpostorBuffer from '../buffer/sphereimpostor-buffer';\n\n/**\n * Spacefill Representation\n */\nclass SpacefillRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'spacefill'\n\n    this.parameters = Object.assign({\n      sphereDetail: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    var p = params || {}\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    var sphereBuffer = new SphereBuffer(\n      (sview.getAtomData(this.getAtomParams()) as SphereBufferData),\n      (this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        dullInterior: true,\n        disableImpostor: this.disableImpostor\n      }) as SphereBufferParameters)\n    )\n\n    return {\n      bufferList: [ sphereBuffer as SphereGeometryBuffer|SphereImpostorBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams(what))\n    var sphereData: Partial<SphereBufferData> = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: atomData.position})\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: atomData.color})\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: atomData.radius})\n    }\n\n    data.bufferList[ 0 ].setAttributes(sphereData)\n  }\n}\n\nRepresentationRegistry.add('spacefill', SpacefillRepresentation)\n\nexport default SpacefillRepresentation\n","/**\n * @file Trace Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport { Log } from '../globals'\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\nfunction getSize(data: BufferData){\n  const n = data.position!.length / 3\n  const n1 = n - 1\n  return n1 * 3 * 2\n}\n\n/**\n * Trace buffer. Draws a series of lines.\n */\nclass TraceBuffer extends Buffer {\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data))\n    }, params)\n\n    this.setAttributes(data)\n  }\n\n  setAttributes (data: Partial<BufferData>) {\n    let position, color\n    let linePosition, lineColor\n\n    const attributes = this.geometry.attributes as any  // TODO\n\n    if (data.position) {\n      position = data.position\n      linePosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      lineColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (!position && !color) {\n      Log.warn('TraceBuffer.prototype.setAttributes no data')\n      return\n    }\n\n    let v, v2\n    const n = this.size\n    const n1 = n - 1\n\n    for (let i = 0; i < n1; ++i) {\n      v = 3 * i\n      v2 = 3 * i * 2\n\n      if (position) {\n        linePosition[ v2 ] = position[ v ]\n        linePosition[ v2 + 1 ] = position[ v + 1 ]\n        linePosition[ v2 + 2 ] = position[ v + 2 ]\n\n        linePosition[ v2 + 3 ] = position[ v + 3 ]\n        linePosition[ v2 + 4 ] = position[ v + 4 ]\n        linePosition[ v2 + 5 ] = position[ v + 5 ]\n      }\n\n      if (color) {\n        lineColor[ v2 ] = color[ v ]\n        lineColor[ v2 + 1 ] = color[ v + 1 ]\n        lineColor[ v2 + 2 ] = color[ v + 2 ]\n\n        lineColor[ v2 + 3 ] = color[ v + 3 ]\n        lineColor[ v2 + 4 ] = color[ v + 4 ]\n        lineColor[ v2 + 5 ] = color[ v + 5 ]\n      }\n    }\n  }\n}\n\nexport default TraceBuffer\n","/**\n * @file Trace Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Spline from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport TraceBuffer from '../buffer/trace-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\n\nexport interface TraceRepresentationParameters extends StructureRepresentationParameters {\n  subdiv: number\n  tension: number\n  smoothSheet: boolean\n}\n/**\n * Trace Representation\n */\nclass TraceRepresentation extends StructureRepresentation {\n  protected subdiv: number\n  protected tension: number\n  protected smoothSheet: boolean\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<TraceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'trace'\n\n    this.parameters = Object.assign({\n\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<TraceRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    this.tension = defaults(p.tension, NaN)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: {[k:string]: any}) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: false,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? 0.1 : 0\n  }\n\n  createData (sview: StructureView) {\n    var bufferList: TraceBuffer[] = []\n    var polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      var spline = new Spline(polymer, this.getSplineParams())\n      var subPos = spline.getSubdividedPosition()\n      var subCol = spline.getSubdividedColor(this.getColorParams())\n\n      bufferList.push(\n        new TraceBuffer(\n          Object.assign({}, subPos, subCol),\n          this.getBufferParams()\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    what = what || {}\n\n    var i = 0\n    var n = data.polymerList!.length\n\n    for (i = 0; i < n; ++i) {\n      var bufferData = {}\n      var spline = new Spline(data.polymerList![ i ], this.getSplineParams())\n\n      if (what.position) {\n        var subPos = spline.getSubdividedPosition()\n        Object.assign(bufferData, { position: subPos.position })\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        Object.assign(bufferData, { color: subCol.color })\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n  }\n\n  setParameters (params: Partial<TraceRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && params.tension) {\n      Object.assign(what, {position: true})\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('trace', TraceRepresentation)\n\nexport default TraceRepresentation\n","/**\n * @file Tube Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport CartoonRepresentation, {CartoonRepresentationParameters} from './cartoon-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\n\n/**\n * Tube Representation\n */\nclass TubeRepresentation extends CartoonRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'tube'\n\n    this.parameters = Object.assign(\n      {}, this.parameters, { aspectRatio: null }\n    )\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n    p.radiusScale = defaults(p.radiusScale, 2.0)\n\n    if (p.quality === 'low') {\n      this.radialSegments = 5\n    }\n\n    super.init(p)\n  }\n\n  getSplineParams (/* params */) {\n    return super.getSplineParams({\n      directional: false\n    })\n  }\n}\n\nRepresentationRegistry.add('tube', TubeRepresentation)\n\nexport default TubeRepresentation\n","/**\n * @file Unitcell Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\n// @ts-ignore: unused import UnitcellPicker required for declaration only\nimport { UnitcellPicker } from '../utils/picker';\n\nexport interface UnitcellRepresentationParameters extends StructureRepresentationParameters {\n  radiusSize: number\n  sphereDetail: number\n  radialSegments: number\n  disableImpostor: boolean\n}\n\n/**\n * Unitcell Representation\n */\nclass UnitcellRepresentation extends StructureRepresentation {\n  sphereBuffer: SphereBuffer\n  cylinderBuffer: CylinderBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<UnitcellRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'unitcell'\n\n    this.parameters = Object.assign({\n\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      radialSegments: true,\n      disableImpostor: true\n\n    }, this.parameters, {\n      assembly: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<UnitcellRepresentationParameters>) {\n    const p = params || {}\n\n    let defaultRadius = 0.5\n    if (this.structure.unitcell) {\n      defaultRadius = Math.cbrt(this.structure.unitcell.volume) / 200\n    }\n\n    p.radiusSize = defaults(p.radiusSize, defaultRadius)\n    p.colorValue = defaults(p.colorValue, 'orange')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  getUnitcellData (structure: Structure) {\n    return structure.unitcell!.getData(structure)\n  }\n\n  create () {\n    const structure = this.structureView.getStructure()\n    if (!structure.unitcell) return\n    const unitcellData = this.getUnitcellData(structure)\n\n    this.sphereBuffer = new SphereBuffer(\n      unitcellData.vertex as SphereBufferData,\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    )\n\n    this.cylinderBuffer = new CylinderBuffer(\n      unitcellData.edge as CylinderBufferData,\n      this.getBufferParams({\n        openEnded: true,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    this.dataList.push({\n      sview: this.structureView,\n      bufferList: [ this.sphereBuffer as SphereGeometryBuffer, this.cylinderBuffer as CylinderGeometryBuffer ]\n    })\n  }\n\n  createData (sview: StructureView): undefined {\n    return\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    const structure = data.sview!.getStructure()\n    if (!structure.unitcell) return\n    const unitcellData = this.getUnitcellData(structure)\n    const sphereData: Partial<SphereBufferData> = {}\n    const cylinderData: Partial<CylinderBufferData> = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: unitcellData.vertex.position})\n      Object.assign(cylinderData, {\n        position1: unitcellData.edge.position1,\n        position2: unitcellData.edge.position2\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: unitcellData.vertex.color})\n      Object.assign(cylinderData, {\n        color: unitcellData.edge.color,\n        color2: unitcellData.edge.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: unitcellData.vertex.radius})\n      Object.assign(cylinderData, {radius: unitcellData.edge.radius})\n    }\n\n    (this.sphereBuffer as SphereGeometryBuffer).setAttributes(sphereData);\n    (this.cylinderBuffer as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('unitcell', UnitcellRepresentation)\n\nexport default UnitcellRepresentation\n","/**\n * @file Validation Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n\n/**\n * Validation representation\n */\nclass ValidationRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'validation'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n      radiusType: null,\n      radiusSize: null,\n      radiusScale: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorValue = defaults(p.colorValue, '#f0027f')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.validation) return\n\n    const clashData = sview.validation.getClashData({\n      structure: sview,\n      color: this.colorValue\n    })\n\n    const cylinderBuffer = new CylinderBuffer(\n      clashData, this.getBufferParams({ openEnded: false })\n    )\n\n    return {\n      bufferList: [ cylinderBuffer as CylinderGeometryBuffer|CylinderImpostorBuffer ]\n    }\n  }\n}\n\nRepresentationRegistry.add('validation', ValidationRepresentation)\n\nexport default ValidationRepresentation\n","/**\n * @file Cone Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, ConeGeometry } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { calculateCenterArray } from '../math/array-utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\nconst eye = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3(0, 1, 0)\n\nfunction getGeo (params: Partial<ConeBufferParameters> = {}) {\n  const geo = new ConeGeometry(\n    1,  // radius\n    1,  // height\n    defaults(params.radialSegments, 60),  // radialSegments\n    1,  // heightSegments\n    defaults(params.openEnded, false)  // openEnded\n  )\n  geo.applyMatrix4(new Matrix4().makeRotationX(-Math.PI / 2))\n\n  return geo\n}\n\nexport interface ConeBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  radius: Float32Array\n}\n\nexport const ConeBufferDefaultParameters = Object.assign({\n  radialSegments: 60,\n  openEnded: false\n}, BufferDefaultParameters)\nexport type ConeBufferParameters = typeof ConeBufferDefaultParameters\n\n\n/**\n * Cone geometry buffer.\n *\n * @example\n * var coneBuffer = new ConeBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass ConeBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return ConeBufferDefaultParameters }\n  parameters: ConeBufferParameters\n\n  _position: Float32Array\n  _position1: Float32Array\n  _position2: Float32Array\n  _radius: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ConeBufferData, params: Partial<ConeBufferParameters> = {}) {\n    super({\n      position: new Float32Array(data.position1.length),\n      color: data.color,\n      picking: data.picking\n    }, params, getGeo(params))\n\n    this._position = new Float32Array(data.position1.length)\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    eye.fromArray(this._position1 as any, i3)\n    target.fromArray(this._position2 as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, eye.distanceTo(target))\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<ConeBufferData> = {}, initNormals?: boolean) {\n    if (data.position1 && data.position2) {\n      calculateCenterArray(data.position1, data.position2, this._position)\n      this._position1 = data.position1\n      this._position2 = data.position2\n      data.position = this._position\n    }\n    if (data.radius) this._radius = data.radius\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('cone', ConeBuffer)\n\nexport default ConeBuffer\n","/**\n * @file Geometry Group\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Box3, BufferGeometry } from 'three'\n\nclass GeometryGroup {\n  geometryList: BufferGeometry[]\n  boundingBox: Box3\n\n  constructor (geometryList: BufferGeometry[] = []) {\n    this.geometryList = geometryList\n  }\n\n  computeBoundingBox () {\n    if (!this.boundingBox) {\n      this.boundingBox = new Box3()\n    } else {\n      this.boundingBox.empty()\n    }\n\n    this.geometryList.forEach(geo => {\n      if (!geo.boundingBox) geo.computeBoundingBox()\n      this.boundingBox.union(geo.boundingBox as Box3)\n    })\n  }\n}\n\nexport default GeometryGroup\n","/**\n * @file Arrow Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, Group } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { createParams, defaults } from '../utils'\nimport { Picker } from '../utils/picker'\nimport Buffer from './buffer'\nimport CylinderBuffer, { CylinderBufferData } from './cylinder-buffer'\nimport CylinderGeometryBuffer from './cylindergeometry-buffer'\nimport ConeBuffer, { ConeBufferData } from './cone-buffer'\nimport GeometryGroup from '../viewer/geometry-group'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nexport interface ArrowBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  radius: Float32Array\n}\n\nexport const ArrowBufferDefaultParameters = Object.assign({\n  aspectRatio: 1.5,\n  radialSegments: 50,\n  openEnded: false,\n  disableImpostor: false\n}, BufferDefaultParameters)\nexport type ArrowBufferParameters = typeof ArrowBufferDefaultParameters\n\n/**\n * Arrow buffer. Draws arrows made from a cylinder and a cone.\n * @implements {Buffer}\n *\n * @example\n * var arrowBuffer = new ArrowBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 10, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass ArrowBuffer {\n  parameters: ArrowBufferParameters\n  get defaultParameters() { return ArrowBufferDefaultParameters }\n\n  cylinderBuffer: CylinderGeometryBuffer\n  coneBuffer: ConeBuffer\n\n  splitPosition: Float32Array\n  cylinderRadius: Float32Array\n\n  geometry: GeometryGroup\n  picking?: Picker\n\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  visible = true\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ArrowBufferData, params: Partial<ArrowBufferParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n\n    this.splitPosition = new Float32Array(data.position1.length)\n    this.cylinderRadius = new Float32Array(data.radius.length)\n\n    const attr = this.makeAttributes(data)\n    const bufferParams = {\n      radialSegments: this.parameters.radialSegments,\n      openEnded: this.parameters.openEnded,\n      disableImpostor: this.parameters.disableImpostor\n    }\n\n    this.cylinderBuffer = new CylinderBuffer(\n      attr.cylinder as CylinderBufferData, bufferParams\n    ) as CylinderGeometryBuffer\n    this.coneBuffer = new ConeBuffer(\n      attr.cone as ConeBufferData, bufferParams\n    )\n\n    this.geometry = new GeometryGroup([\n      this.cylinderBuffer.geometry,\n      this.coneBuffer.geometry\n    ])\n\n    // requires Group objects to be present\n    this.matrix = defaults(params.matrix, new Matrix4())\n\n    this.picking = data.picking\n  }\n\n  set matrix (m) {\n    Buffer.prototype.setMatrix.call(this, m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get pickable () {\n    return !!this.picking\n  }\n\n  makeAttributes (data: Partial<ArrowBufferData> = {}) {\n    const splitPosition = this.splitPosition\n    const cylinderRadius = this.cylinderRadius\n\n    const aspectRatio = this.parameters.aspectRatio\n\n    let i, il\n    const cylinder: Partial<CylinderBufferData> = {}\n    const cone: Partial<ConeBufferData> = {}\n\n    if (data.radius) {\n      for (i = 0, il = cylinderRadius.length; i < il; ++i) {\n        cylinderRadius[ i ] = data.radius[ i ] / aspectRatio\n      }\n      cylinder.radius = cylinderRadius\n      cone.radius = data.radius\n    }\n\n    if (data.position1 && data.position2) {\n      const vFrom = new Vector3()\n      const vTo = new Vector3()\n      const vDir = new Vector3()\n      const vSplit = new Vector3()\n      for (i = 0, il = splitPosition.length; i < il; i += 3) {\n        vFrom.fromArray(data.position1 as any, i)\n        vTo.fromArray(data.position2 as any, i)\n        vDir.subVectors(vFrom, vTo)\n        const fullLength = vDir.length()\n        const coneLength = cylinderRadius[ i / 3 ] * aspectRatio * 2\n        const length = Math.min(fullLength, coneLength)\n        vDir.setLength(length)\n        vSplit.copy(vTo).add(vDir)\n        vSplit.toArray(splitPosition as any, i)\n      }\n      cylinder.position1 = data.position1\n      cylinder.position2 = splitPosition\n      cone.position1 = splitPosition\n      cone.position2 = data.position2\n    }\n\n    if (data.color) {\n      cylinder.color = data.color\n      cylinder.color2 = data.color\n      cone.color = data.color\n    }\n\n    return {\n      cylinder: cylinder,\n      cone: cone\n    }\n  }\n\n  getMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getMesh(),\n      this.coneBuffer.getMesh()\n    )\n  }\n\n  getWireframeMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getWireframeMesh(),\n      this.coneBuffer.getWireframeMesh()\n    )\n  }\n\n  getPickingMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getPickingMesh(),\n      this.coneBuffer.getPickingMesh()\n    )\n  }\n\n  setAttributes (data: Partial<ArrowBufferData> = {}) {\n    const attr = this.makeAttributes(data)\n\n    this.cylinderBuffer.setAttributes(attr.cylinder)\n    this.coneBuffer.setAttributes(attr.cone)\n  }\n\n  /**\n   * Set buffer parameters\n   * @param {BufferParameters} params - buffer parameters object\n   * @return {undefined}\n   */\n  setParameters (params: Partial<ArrowBufferParameters> = {}) {\n    params = Object.assign({}, params)\n\n    if (params && params.matrix !== undefined) {\n      this.matrix = params.matrix\n    }\n    delete params.matrix\n\n    if (params && params.wireframe !== undefined) {\n      this.parameters.wireframe = params.wireframe\n      this.setVisibility(this.visible)\n    }\n\n    this.cylinderBuffer.setParameters(params)\n    this.coneBuffer.setParameters(params)\n  }\n\n  setVisibility (value: boolean) {\n    Buffer.prototype.setVisibility.call(this, value)\n  }\n\n  dispose () {\n    this.cylinderBuffer.dispose()\n    this.coneBuffer.dispose()\n  }\n}\n\nBufferRegistry.add('arrow', ArrowBuffer)\n\nexport default ArrowBuffer\n","/**\n * @file Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BoxGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface BoxBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Box buffer. Draws boxes.\n *\n * @example\n * var boxBuffer = new BoxBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass BoxBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: BoxBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new BoxGeometry(1, 1, 1))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<BoxBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('box', BoxBuffer)\n\nexport default BoxBuffer\n","/**\n * @file Ellipsoid Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { IcosahedronGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface EllipsoidBufferData extends BufferData {\n  majorAxis: Float32Array\n  minorAxis: Float32Array\n  radius: Float32Array\n}\n\nexport const EllipsoidBufferDefaultParameters = Object.assign({\n  sphereDetail: 2,\n}, BufferDefaultParameters)\nexport type EllipsoidBufferParameters = typeof EllipsoidBufferDefaultParameters\n\n/**\n * Ellipsoid buffer. Draws ellipsoids.\n *\n * @example\n * var ellipsoidBuffer = new EllipsoidBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   majorAxis: new Float32Array([ 1, 1, 0 ]),\n *   minorAxis: new Float32Array([ 0.5, 0, 0.5 ]),\n * });\n */\nclass EllipsoidBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return EllipsoidBufferDefaultParameters }\n  parameters: EllipsoidBufferParameters\n\n  _majorAxis: Float32Array\n  _minorAxis: Float32Array\n  _radius: Float32Array\n\n  constructor (data: EllipsoidBufferData, params: Partial<EllipsoidBufferParameters> = {}) {\n    super(data, params, new IcosahedronGeometry(1, defaults(params.sphereDetail, 2)))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._majorAxis as any, i3)\n    up.fromArray(this._minorAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._radius[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<EllipsoidBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n    if (data.majorAxis) this._majorAxis = data.majorAxis\n    if (data.minorAxis) this._minorAxis = data.minorAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('ellipsoid', EllipsoidBuffer)\n\nexport default EllipsoidBuffer\n","/**\n * @file Icosahedron Buffer\n * @private\n */\n\nimport { IcosahedronGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface IcosahedronBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Icosahedron buffer. Draws Icosahedrons.\n *\n * @example\n * var icosahedronBuffer = new IcosahedronBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass IcosahedronBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: IcosahedronBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new IcosahedronGeometry(1, 0))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<IcosahedronBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('icosahedron', IcosahedronBuffer)\n\nexport default IcosahedronBuffer\n","/**\n * @file Octahedron Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { OctahedronGeometry, Vector3, Matrix4 } from 'three'\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface OctahedronBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Octahedron buffer. Draws octahedrons.\n *\n * @example\n * var octahedronBuffer = new OctahedronBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass OctahedronBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: OctahedronBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new OctahedronGeometry(1, 0))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<OctahedronBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('octahedron', OctahedronBuffer)\n\nexport default OctahedronBuffer\n","/**\n * @file Tetrahedron Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { TetrahedronGeometry, Vector3, Matrix4 } from 'three'\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface TetrahedronBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Tetrahedron buffer. Draws tetrahedrons.\n *\n * @example\n * var tetrahedronBuffer = new TetrahedronBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass TetrahedronBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: TetrahedronBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new TetrahedronGeometry(1, 0))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<TetrahedronBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('tetrahedron', TetrahedronBuffer)\n\nexport default TetrahedronBuffer\n","/**\n * @file Tetrahedron Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { TorusGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferDefaultParameters, BufferData } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface TorusBufferData extends BufferData {\n  majorAxis: Float32Array\n  minorAxis: Float32Array\n  radius: Float32Array\n}\n\nexport const TorusBufferDefaultParameters = Object.assign({\n  radiusRatio: 0.2,\n  radialSegments: 16,\n  tubularSegments: 32\n}, BufferDefaultParameters)\nexport type TorusBufferParameters = typeof TorusBufferDefaultParameters\n\n/**\n * Torus geometry buffer. Draws torii.\n *\n * @example\n * var torusBuffer = new TorusBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   majorAxis: new Float32Array([ 1, 1, 0 ]),\n *   minorAxis: new Float32Array([ 0.5, 0, 0.5 ]),\n * });\n */\nclass TorusBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return TorusBufferDefaultParameters }\n  parameters: TorusBufferParameters\n\n  _majorAxis: Float32Array\n  _minorAxis: Float32Array\n  _radius: Float32Array\n\n  constructor (data: TorusBufferData, params: Partial<TorusBufferParameters> = {}) {\n    super(data, params, new TorusGeometry(\n      1,\n      defaults(params.radiusRatio, 0.2),\n      defaults(params.radialSegments, 16),\n      defaults(params.tubularSegments, 32)\n    ))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._majorAxis as any, i3)\n    up.fromArray(this._minorAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, r)\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<TorusBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n    if (data.majorAxis) this._majorAxis = data.majorAxis\n    if (data.minorAxis) this._minorAxis = data.minorAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('torus', TorusBuffer)\n\nexport default TorusBuffer\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport function getArrayBounds(rowCount, params) {\n    const start = params && typeof params.start !== 'undefined' ? Math.max(Math.min(params.start, rowCount - 1), 0) : 0;\n    const end = params && typeof params.end !== 'undefined' ? Math.min(params.end, rowCount) : rowCount;\n    return { start, end };\n}\nexport function createArray(rowCount, params) {\n    const c = params && typeof params.array !== 'undefined' ? params.array : Array;\n    const { start, end } = getArrayBounds(rowCount, params);\n    return { array: new c(end - start), start, end };\n}\nexport function fillArrayValues(value, target, start) {\n    for (let i = 0, _e = target.length; i < _e; i++)\n        target[i] = value(start + i);\n    return target;\n}\nexport function createAndFillArray(rowCount, value, params) {\n    const { array, start } = createArray(rowCount, params);\n    return fillArrayValues(value, array, start);\n}\nexport function isTypedArray(data) {\n    return !!data.buffer && typeof data.byteLength === 'number' && typeof data.BYTES_PER_ELEMENT === 'number';\n}\nexport function typedArrayWindow(data, params) {\n    const { constructor, buffer, length, byteOffset, BYTES_PER_ELEMENT } = data;\n    const { start, end } = getArrayBounds(length, params);\n    if (start === 0 && end === length)\n        return data;\n    return new constructor(buffer, byteOffset + BYTES_PER_ELEMENT * start, Math.min(length, end - start));\n}\n","/**\n * Copyright (c) 2017-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/*\n * This code has been modified from https://github.com/toji/gl-matrix/,\n * copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n */\nexport const EPSILON = 0.000001;\nexport function equalEps(a, b, eps) {\n    return Math.abs(a - b) <= eps;\n}\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nexport function normalize(value, min, max) {\n    return (value - min) / (max - min);\n}\nexport function clamp(value, min, max) {\n    return Math.max(min, Math.min(max, value));\n}\nexport function pclamp(value) {\n    return clamp(value, 0, 100);\n}\nexport function saturate(value) {\n    return clamp(value, 0, 1);\n}\nexport function damp(value, dampingFactor) {\n    const dampedValue = value * dampingFactor;\n    return Math.abs(dampedValue) < 0.1 ? 0 : dampedValue;\n}\nexport function lerp(start, stop, alpha) {\n    return start + (stop - start) * alpha;\n}\n/** Catmul-Rom spline */\nexport function spline(p0, p1, p2, p3, t, tension) {\n    const v0 = (p2 - p0) * tension;\n    const v1 = (p3 - p1) * tension;\n    const t2 = t * t;\n    const t3 = t * t2;\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n}\nexport function quadraticBezier(p0, p1, p2, t) {\n    const k = 1 - t;\n    return (k * k * p0) + (2 * k * t * p1) + (t * t * p2);\n}\nexport function smoothstep(min, max, x) {\n    x = saturate(normalize(x, min, max));\n    return x * x * (3 - 2 * x);\n}\nexport function smootherstep(min, max, x) {\n    x = saturate(normalize(x, min, max));\n    return x * x * x * (x * (x * 6 - 15) + 10);\n}\nexport function smootheststep(min, max, x) {\n    x = saturate(normalize(x, min, max));\n    return -20 * Math.pow(x, 7) + 70 * Math.pow(x, 6) - 84 * Math.pow(x, 5) + 35 * Math.pow(x, 4);\n}\nexport function almostIdentity(value, start, stop) {\n    if (value > start)\n        return value;\n    const a = 2 * stop - start;\n    const b = 2 * start - 3 * stop;\n    const t = value / start;\n    return (a * t + b) * t * t + stop;\n}\n","/**\n * Copyright (c) 2017-2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/*\n * This code has been modified from https://github.com/toji/gl-matrix/,\n * copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n */\nimport { Mat4 } from './mat4';\nimport { spline as _spline, quadraticBezier as _quadraticBezier, clamp as _clamp } from '../../interpolate';\nimport { EPSILON } from './common';\nconst _isFinite = isFinite;\nfunction Vec3() {\n    return Vec3.zero();\n}\n(function (Vec3) {\n    function zero() {\n        const out = [0.1, 0.0, 0.0]; // ensure backing array of type double\n        out[0] = 0;\n        return out;\n    }\n    Vec3.zero = zero;\n    function clone(a) {\n        const out = zero();\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        return out;\n    }\n    Vec3.clone = clone;\n    function isFinite(a) {\n        return _isFinite(a[0]) && _isFinite(a[1]) && _isFinite(a[2]);\n    }\n    Vec3.isFinite = isFinite;\n    function hasNaN(a) {\n        return isNaN(a[0]) || isNaN(a[1]) || isNaN(a[2]);\n    }\n    Vec3.hasNaN = hasNaN;\n    function setNaN(out) {\n        out[0] = NaN;\n        out[1] = NaN;\n        out[2] = NaN;\n        return out;\n    }\n    Vec3.setNaN = setNaN;\n    function fromObj(v) {\n        return create(v.x, v.y, v.z);\n    }\n    Vec3.fromObj = fromObj;\n    function toObj(v) {\n        return { x: v[0], y: v[1], z: v[2] };\n    }\n    Vec3.toObj = toObj;\n    function fromArray(v, array, offset) {\n        v[0] = array[offset + 0];\n        v[1] = array[offset + 1];\n        v[2] = array[offset + 2];\n        return v;\n    }\n    Vec3.fromArray = fromArray;\n    function toArray(v, out, offset) {\n        out[offset + 0] = v[0];\n        out[offset + 1] = v[1];\n        out[offset + 2] = v[2];\n        return out;\n    }\n    Vec3.toArray = toArray;\n    function create(x, y, z) {\n        const out = zero();\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        return out;\n    }\n    Vec3.create = create;\n    function ofArray(array) {\n        const out = zero();\n        out[0] = array[0];\n        out[1] = array[1];\n        out[2] = array[2];\n        return out;\n    }\n    Vec3.ofArray = ofArray;\n    function set(out, x, y, z) {\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        return out;\n    }\n    Vec3.set = set;\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        return out;\n    }\n    Vec3.copy = copy;\n    function add(out, a, b) {\n        out[0] = a[0] + b[0];\n        out[1] = a[1] + b[1];\n        out[2] = a[2] + b[2];\n        return out;\n    }\n    Vec3.add = add;\n    function sub(out, a, b) {\n        out[0] = a[0] - b[0];\n        out[1] = a[1] - b[1];\n        out[2] = a[2] - b[2];\n        return out;\n    }\n    Vec3.sub = sub;\n    function mul(out, a, b) {\n        out[0] = a[0] * b[0];\n        out[1] = a[1] * b[1];\n        out[2] = a[2] * b[2];\n        return out;\n    }\n    Vec3.mul = mul;\n    function div(out, a, b) {\n        out[0] = a[0] / b[0];\n        out[1] = a[1] / b[1];\n        out[2] = a[2] / b[2];\n        return out;\n    }\n    Vec3.div = div;\n    function scale(out, a, b) {\n        out[0] = a[0] * b;\n        out[1] = a[1] * b;\n        out[2] = a[2] * b;\n        return out;\n    }\n    Vec3.scale = scale;\n    /** Scales b, then adds a and b together */\n    function scaleAndAdd(out, a, b, scale) {\n        out[0] = a[0] + (b[0] * scale);\n        out[1] = a[1] + (b[1] * scale);\n        out[2] = a[2] + (b[2] * scale);\n        return out;\n    }\n    Vec3.scaleAndAdd = scaleAndAdd;\n    /** Scales b, then subtracts b from a */\n    function scaleAndSub(out, a, b, scale) {\n        out[0] = a[0] - (b[0] * scale);\n        out[1] = a[1] - (b[1] * scale);\n        out[2] = a[2] - (b[2] * scale);\n        return out;\n    }\n    Vec3.scaleAndSub = scaleAndSub;\n    function addScalar(out, a, b) {\n        out[0] = a[0] + b;\n        out[1] = a[1] + b;\n        out[2] = a[2] + b;\n        return out;\n    }\n    Vec3.addScalar = addScalar;\n    function subScalar(out, a, b) {\n        out[0] = a[0] - b;\n        out[1] = a[1] - b;\n        out[2] = a[2] - b;\n        return out;\n    }\n    Vec3.subScalar = subScalar;\n    /**\n     * Math.round the components of a Vec3\n     */\n    function round(out, a) {\n        out[0] = Math.round(a[0]);\n        out[1] = Math.round(a[1]);\n        out[2] = Math.round(a[2]);\n        return out;\n    }\n    Vec3.round = round;\n    /**\n     * Math.ceil the components of a Vec3\n     */\n    function ceil(out, a) {\n        out[0] = Math.ceil(a[0]);\n        out[1] = Math.ceil(a[1]);\n        out[2] = Math.ceil(a[2]);\n        return out;\n    }\n    Vec3.ceil = ceil;\n    /**\n     * Math.floor the components of a Vec3\n     */\n    function floor(out, a) {\n        out[0] = Math.floor(a[0]);\n        out[1] = Math.floor(a[1]);\n        out[2] = Math.floor(a[2]);\n        return out;\n    }\n    Vec3.floor = floor;\n    /**\n     * Math.trunc the components of a Vec3\n     */\n    function trunc(out, a) {\n        out[0] = Math.trunc(a[0]);\n        out[1] = Math.trunc(a[1]);\n        out[2] = Math.trunc(a[2]);\n        return out;\n    }\n    Vec3.trunc = trunc;\n    /**\n     * Math.abs the components of a Vec3\n     */\n    function abs(out, a) {\n        out[0] = Math.abs(a[0]);\n        out[1] = Math.abs(a[1]);\n        out[2] = Math.abs(a[2]);\n        return out;\n    }\n    Vec3.abs = abs;\n    /**\n     * Returns the minimum of two Vec3's\n     */\n    function min(out, a, b) {\n        out[0] = Math.min(a[0], b[0]);\n        out[1] = Math.min(a[1], b[1]);\n        out[2] = Math.min(a[2], b[2]);\n        return out;\n    }\n    Vec3.min = min;\n    /**\n     * Returns the maximum of two Vec3's\n     */\n    function max(out, a, b) {\n        out[0] = Math.max(a[0], b[0]);\n        out[1] = Math.max(a[1], b[1]);\n        out[2] = Math.max(a[2], b[2]);\n        return out;\n    }\n    Vec3.max = max;\n    /**\n     * Assumes min < max, componentwise\n     */\n    function clamp(out, a, min, max) {\n        out[0] = Math.max(min[0], Math.min(max[0], a[0]));\n        out[1] = Math.max(min[1], Math.min(max[1], a[1]));\n        out[2] = Math.max(min[2], Math.min(max[2], a[2]));\n        return out;\n    }\n    Vec3.clamp = clamp;\n    function distance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1], z = b[2] - a[2];\n        return Math.sqrt(x * x + y * y + z * z);\n    }\n    Vec3.distance = distance;\n    function squaredDistance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1], z = b[2] - a[2];\n        return x * x + y * y + z * z;\n    }\n    Vec3.squaredDistance = squaredDistance;\n    function magnitude(a) {\n        const x = a[0], y = a[1], z = a[2];\n        return Math.sqrt(x * x + y * y + z * z);\n    }\n    Vec3.magnitude = magnitude;\n    function squaredMagnitude(a) {\n        const x = a[0], y = a[1], z = a[2];\n        return x * x + y * y + z * z;\n    }\n    Vec3.squaredMagnitude = squaredMagnitude;\n    function setMagnitude(out, a, l) {\n        return scale(out, normalize(out, a), l);\n    }\n    Vec3.setMagnitude = setMagnitude;\n    /**\n     * Negates the components of a vec3\n     */\n    function negate(out, a) {\n        out[0] = -a[0];\n        out[1] = -a[1];\n        out[2] = -a[2];\n        return out;\n    }\n    Vec3.negate = negate;\n    /**\n     * Returns the inverse of the components of a Vec3\n     */\n    function inverse(out, a) {\n        out[0] = 1.0 / a[0];\n        out[1] = 1.0 / a[1];\n        out[2] = 1.0 / a[2];\n        return out;\n    }\n    Vec3.inverse = inverse;\n    function normalize(out, a) {\n        const x = a[0], y = a[1], z = a[2];\n        let len = x * x + y * y + z * z;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out[0] = a[0] * len;\n            out[1] = a[1] * len;\n            out[2] = a[2] * len;\n        }\n        return out;\n    }\n    Vec3.normalize = normalize;\n    function dot(a, b) {\n        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n    }\n    Vec3.dot = dot;\n    function cross(out, a, b) {\n        const ax = a[0], ay = a[1], az = a[2], bx = b[0], by = b[1], bz = b[2];\n        out[0] = ay * bz - az * by;\n        out[1] = az * bx - ax * bz;\n        out[2] = ax * by - ay * bx;\n        return out;\n    }\n    Vec3.cross = cross;\n    /**\n     * Performs a linear interpolation between two Vec3's\n     */\n    function lerp(out, a, b, t) {\n        const ax = a[0], ay = a[1], az = a[2];\n        out[0] = ax + t * (b[0] - ax);\n        out[1] = ay + t * (b[1] - ay);\n        out[2] = az + t * (b[2] - az);\n        return out;\n    }\n    Vec3.lerp = lerp;\n    const slerpRelVec = zero();\n    function slerp(out, a, b, t) {\n        const d = _clamp(dot(a, b), -1, 1);\n        const theta = Math.acos(d) * t;\n        scaleAndAdd(slerpRelVec, b, a, -d);\n        normalize(slerpRelVec, slerpRelVec);\n        return add(out, scale(out, a, Math.cos(theta)), scale(slerpRelVec, slerpRelVec, Math.sin(theta)));\n    }\n    Vec3.slerp = slerp;\n    /**\n     * Performs a hermite interpolation with two control points\n     */\n    function hermite(out, a, b, c, d, t) {\n        const factorTimes2 = t * t;\n        const factor1 = factorTimes2 * (2 * t - 3) + 1;\n        const factor2 = factorTimes2 * (t - 2) + t;\n        const factor3 = factorTimes2 * (t - 1);\n        const factor4 = factorTimes2 * (3 - 2 * t);\n        out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n        out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n        out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n        return out;\n    }\n    Vec3.hermite = hermite;\n    /**\n     * Performs a bezier interpolation with two control points\n     */\n    function bezier(out, a, b, c, d, t) {\n        const inverseFactor = 1 - t;\n        const inverseFactorTimesTwo = inverseFactor * inverseFactor;\n        const factorTimes2 = t * t;\n        const factor1 = inverseFactorTimesTwo * inverseFactor;\n        const factor2 = 3 * t * inverseFactorTimesTwo;\n        const factor3 = 3 * factorTimes2 * inverseFactor;\n        const factor4 = factorTimes2 * t;\n        out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n        out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n        out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n        return out;\n    }\n    Vec3.bezier = bezier;\n    function quadraticBezier(out, a, b, c, t) {\n        out[0] = _quadraticBezier(a[0], b[0], c[0], t);\n        out[1] = _quadraticBezier(a[1], b[1], c[1], t);\n        out[2] = _quadraticBezier(a[2], b[2], c[2], t);\n        return out;\n    }\n    Vec3.quadraticBezier = quadraticBezier;\n    /**\n     * Performs a spline interpolation with two control points and a tension parameter\n     */\n    function spline(out, a, b, c, d, t, tension) {\n        out[0] = _spline(a[0], b[0], c[0], d[0], t, tension);\n        out[1] = _spline(a[1], b[1], c[1], d[1], t, tension);\n        out[2] = _spline(a[2], b[2], c[2], d[2], t, tension);\n        return out;\n    }\n    Vec3.spline = spline;\n    /**\n     * Generates a random vector with the given scale\n     */\n    function random(out, scale) {\n        const r = Math.random() * 2.0 * Math.PI;\n        const z = (Math.random() * 2.0) - 1.0;\n        const zScale = Math.sqrt(1.0 - z * z) * scale;\n        out[0] = Math.cos(r) * zScale;\n        out[1] = Math.sin(r) * zScale;\n        out[2] = z * scale;\n        return out;\n    }\n    Vec3.random = random;\n    /**\n     * Transforms the Vec3 with a Mat4. 4th vector component is implicitly '1'\n     */\n    function transformMat4(out, a, m) {\n        const x = a[0], y = a[1], z = a[2], w = 1 / ((m[3] * x + m[7] * y + m[11] * z + m[15]) || 1.0);\n        out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) * w;\n        out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) * w;\n        out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) * w;\n        return out;\n    }\n    Vec3.transformMat4 = transformMat4;\n    function transformDirection(out, a, m) {\n        const x = a[0], y = a[1], z = a[2];\n        out[0] = m[0] * x + m[4] * y + m[8] * z;\n        out[1] = m[1] * x + m[5] * y + m[9] * z;\n        out[2] = m[2] * x + m[6] * y + m[10] * z;\n        return normalize(out, out);\n    }\n    Vec3.transformDirection = transformDirection;\n    /**\n     * Like `transformMat4` but with offsets into arrays\n     */\n    function transformMat4Offset(out, a, m, outO, aO, oM) {\n        const x = a[0 + aO], y = a[1 + aO], z = a[2 + aO], w = 1 / ((m[3 + oM] * x + m[7 + oM] * y + m[11 + oM] * z + m[15 + oM]) || 1.0);\n        out[0 + outO] = (m[0 + oM] * x + m[4 + oM] * y + m[8 + oM] * z + m[12 + oM]) * w;\n        out[1 + outO] = (m[1 + oM] * x + m[5 + oM] * y + m[9 + oM] * z + m[13 + oM]) * w;\n        out[2 + outO] = (m[2 + oM] * x + m[6 + oM] * y + m[10 + oM] * z + m[14 + oM]) * w;\n        return out;\n    }\n    Vec3.transformMat4Offset = transformMat4Offset;\n    /**\n     * Transforms the direction vector with a Mat4. 4th vector component is implicitly '0'\n     * This means the translation components of the matrix are ignored.\n     * Assumes that m is already the transpose of the inverse matrix suitable for normal transformation.\n     */\n    function transformDirectionOffset(out, a, m, outO, aO, oM) {\n        const x = a[0 + aO], y = a[1 + aO], z = a[2 + aO];\n        out[0 + outO] = m[0 + oM] * x + m[4 + oM] * y + m[8 + oM] * z;\n        out[1 + outO] = m[1 + oM] * x + m[5 + oM] * y + m[9 + oM] * z;\n        out[2 + outO] = m[2 + oM] * x + m[6 + oM] * y + m[10 + oM] * z;\n        // Normalize the output vector to handle non-uniform scaling\n        const len = Math.hypot(out[0 + outO], out[1 + outO], out[2 + outO]);\n        if (len > 0) {\n            out[0 + outO] /= len;\n            out[1 + outO] /= len;\n            out[2 + outO] /= len;\n        }\n        return out;\n    }\n    Vec3.transformDirectionOffset = transformDirectionOffset;\n    /**\n     * Transforms the Vec3 with a Mat3.\n     */\n    function transformMat3(out, a, m) {\n        const x = a[0], y = a[1], z = a[2];\n        out[0] = x * m[0] + y * m[3] + z * m[6];\n        out[1] = x * m[1] + y * m[4] + z * m[7];\n        out[2] = x * m[2] + y * m[5] + z * m[8];\n        return out;\n    }\n    Vec3.transformMat3 = transformMat3;\n    /** Transforms the Vec3 with a quat */\n    function transformQuat(out, a, q) {\n        // benchmarks: http://jsperf.com/quaternion-transform-vec3-implementations\n        const x = a[0], y = a[1], z = a[2];\n        const qx = q[0], qy = q[1], qz = q[2], qw = q[3];\n        // calculate quat * vec\n        const ix = qw * x + qy * z - qz * y;\n        const iy = qw * y + qz * x - qx * z;\n        const iz = qw * z + qx * y - qy * x;\n        const iw = -qx * x - qy * y - qz * z;\n        // calculate result * inverse quat\n        out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n        out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n        out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n        return out;\n    }\n    Vec3.transformQuat = transformQuat;\n    /** Computes the angle between 2 vectors, reports in radians. */\n    function angle(a, b) {\n        const denominator = Math.sqrt(squaredMagnitude(a) * squaredMagnitude(b));\n        if (denominator === 0)\n            return Math.PI / 2;\n        const theta = dot(a, b) / denominator;\n        return Math.acos(_clamp(theta, -1, 1)); // clamp to avoid numerical problems\n    }\n    Vec3.angle = angle;\n    const tmp_dh_ab = zero();\n    const tmp_dh_cb = zero();\n    const tmp_dh_bc = zero();\n    const tmp_dh_dc = zero();\n    const tmp_dh_abc = zero();\n    const tmp_dh_bcd = zero();\n    const tmp_dh_cross = zero();\n    /**\n     * Computes the dihedral angles of 4 points, reports in radians.\n     */\n    function dihedralAngle(a, b, c, d) {\n        sub(tmp_dh_ab, a, b);\n        sub(tmp_dh_cb, c, b);\n        sub(tmp_dh_bc, b, c);\n        sub(tmp_dh_dc, d, c);\n        cross(tmp_dh_abc, tmp_dh_ab, tmp_dh_cb);\n        cross(tmp_dh_bcd, tmp_dh_bc, tmp_dh_dc);\n        const _angle = angle(tmp_dh_abc, tmp_dh_bcd);\n        cross(tmp_dh_cross, tmp_dh_abc, tmp_dh_bcd);\n        return dot(tmp_dh_cb, tmp_dh_cross) > 0 ? _angle : -_angle;\n    }\n    Vec3.dihedralAngle = dihedralAngle;\n    /**\n     * @param inclination in radians [0, PI]\n     * @param azimuth in radians [0, 2 * PI]\n     * @param radius [0, +Inf]\n     */\n    function directionFromSpherical(out, inclination, azimuth, radius) {\n        return Vec3.set(out, radius * Math.cos(azimuth) * Math.sin(inclination), radius * Math.sin(azimuth) * Math.sin(inclination), radius * Math.cos(inclination));\n    }\n    Vec3.directionFromSpherical = directionFromSpherical;\n    /**\n     * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n     */\n    function exactEquals(a, b) {\n        return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n    }\n    Vec3.exactEquals = exactEquals;\n    /**\n     * Returns whether or not the vectors have approximately the same elements in the same position.\n     */\n    function equals(a, b) {\n        const a0 = a[0], a1 = a[1], a2 = a[2];\n        const b0 = b[0], b1 = b[1], b2 = b[2];\n        return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n            Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n            Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)));\n    }\n    Vec3.equals = equals;\n    const rotTemp = zero();\n    function makeRotation(mat, a, b) {\n        const by = angle(a, b);\n        if (Math.abs(by) < 0.0001)\n            return Mat4.setIdentity(mat);\n        if (Math.abs(by - Math.PI) < EPSILON) {\n            // here, axis can be [0,0,0] but the rotation is a simple flip\n            return Mat4.fromScaling(mat, Vec3.negUnit);\n        }\n        const axis = cross(rotTemp, a, b);\n        return Mat4.fromRotation(mat, by, axis);\n    }\n    Vec3.makeRotation = makeRotation;\n    function isZero(v) {\n        return v[0] === 0 && v[1] === 0 && v[2] === 0;\n    }\n    Vec3.isZero = isZero;\n    /** Project `point` onto `vector` starting from `origin` */\n    function projectPointOnVector(out, point, vector, origin) {\n        sub(out, point, origin);\n        const scalar = dot(vector, out) / squaredMagnitude(vector);\n        return add(out, scale(out, vector, scalar), origin);\n    }\n    Vec3.projectPointOnVector = projectPointOnVector;\n    const tmpProjectPlane = zero();\n    /** Project `point` onto `plane` defined by `normal` starting from `origin` */\n    function projectPointOnPlane(out, point, normal, origin) {\n        normalize(tmpProjectPlane, normal);\n        sub(out, point, origin);\n        return sub(out, point, scale(tmpProjectPlane, tmpProjectPlane, dot(out, tmpProjectPlane)));\n    }\n    Vec3.projectPointOnPlane = projectPointOnPlane;\n    function projectOnVector(out, p, vector) {\n        const scalar = dot(vector, p) / squaredMagnitude(vector);\n        return scale(out, vector, scalar);\n    }\n    Vec3.projectOnVector = projectOnVector;\n    const tmpProject = zero();\n    function projectOnPlane(out, p, normal) {\n        projectOnVector(tmpProject, p, normal);\n        return sub(out, p, tmpProject);\n    }\n    Vec3.projectOnPlane = projectOnPlane;\n    /** Get a vector that is similar to `b` but orthogonal to `a` */\n    function orthogonalize(out, a, b) {\n        return normalize(out, cross(out, cross(out, a, b), a));\n    }\n    Vec3.orthogonalize = orthogonalize;\n    /**\n     * Get a vector like `a` that point into the same general direction as `b`,\n     * i.e. where the dot product is > 0\n     */\n    function matchDirection(out, a, b) {\n        if (dot(a, b) > 0)\n            copy(out, a);\n        else\n            negate(out, copy(out, a));\n        return out;\n    }\n    Vec3.matchDirection = matchDirection;\n    const triangleNormalTmpAB = zero();\n    const triangleNormalTmpAC = zero();\n    /** Calculate normal for the triangle defined by `a`, `b` and `c` */\n    function triangleNormal(out, a, b, c) {\n        sub(triangleNormalTmpAB, b, a);\n        sub(triangleNormalTmpAC, c, a);\n        return normalize(out, cross(out, triangleNormalTmpAB, triangleNormalTmpAC));\n    }\n    Vec3.triangleNormal = triangleNormal;\n    function toString(a, precision) {\n        return `[${a[0].toPrecision(precision)} ${a[1].toPrecision(precision)} ${a[2].toPrecision(precision)}]`;\n    }\n    Vec3.toString = toString;\n    Vec3.origin = create(0, 0, 0);\n    Vec3.unit = create(1, 1, 1);\n    Vec3.negUnit = create(-1, -1, -1);\n    Vec3.unitX = create(1, 0, 0);\n    Vec3.unitY = create(0, 1, 0);\n    Vec3.unitZ = create(0, 0, 1);\n    Vec3.negUnitX = create(-1, 0, 0);\n    Vec3.negUnitY = create(0, -1, 0);\n    Vec3.negUnitZ = create(0, 0, -1);\n})(Vec3 || (Vec3 = {}));\nexport { Vec3 };\n","/**\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nexport const halfPI = Math.PI / 2;\nexport const PiDiv180 = Math.PI / 180;\nexport function degToRad(deg) {\n    return deg * PiDiv180; // deg * Math.PI / 180\n}\nexport function radToDeg(rad) {\n    return rad / PiDiv180; // rad * 180 / Math.PI\n}\nexport function isPowerOfTwo(x) {\n    return (x !== 0) && (x & (x - 1)) === 0;\n}\n/** return the value that has the largest absolute value */\nexport function absMax(...values) {\n    let max = 0;\n    let absMax = 0;\n    for (let i = 0, il = values.length; i < il; ++i) {\n        const value = values[i];\n        const abs = Math.abs(value);\n        if (abs > absMax) {\n            max = value;\n            absMax = abs;\n        }\n    }\n    return max;\n}\n/** Length of an arc with angle in radians */\nexport function arcLength(angle, radius) {\n    return angle * radius;\n}\n/** Create an outward spiral of given `radius` on a 2d grid */\nexport function spiral2d(radius) {\n    let x = 0;\n    let y = 0;\n    const delta = [0, -1];\n    const size = radius * 2 + 1;\n    const halfSize = size / 2;\n    const out = [];\n    for (let i = Math.pow(size, 2); i > 0; --i) {\n        if ((-halfSize < x && x <= halfSize) && (-halfSize < y && y <= halfSize)) {\n            out.push([x, y]);\n        }\n        if (x === y || (x < 0 && x === -y) || (x > 0 && x === 1 - y)) {\n            [delta[0], delta[1]] = [-delta[1], delta[0]]; // change direction\n        }\n        x += delta[0];\n        y += delta[1];\n    }\n    return out;\n}\n","/**\n * Copyright (c) 2017-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/*\n * This code has been modified from https://github.com/toji/gl-matrix/,\n * copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n */\nimport { EPSILON, equalEps } from './common';\nimport { Vec3 } from './vec3';\nimport { degToRad } from '../../misc';\nfunction Mat4() {\n    return Mat4.zero();\n}\n/**\n * Stores a 4x4 matrix in a column major (j * 4 + i indexing) format.\n */\n(function (Mat4) {\n    function zero() {\n        // force double backing array by 0.1.\n        const ret = [0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        ret[0] = 0.0;\n        return ret;\n    }\n    Mat4.zero = zero;\n    function identity() {\n        const out = zero();\n        out[0] = 1;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = 1;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 0;\n        out[9] = 0;\n        out[10] = 1;\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.identity = identity;\n    function setIdentity(mat) {\n        mat[0] = 1;\n        mat[1] = 0;\n        mat[2] = 0;\n        mat[3] = 0;\n        mat[4] = 0;\n        mat[5] = 1;\n        mat[6] = 0;\n        mat[7] = 0;\n        mat[8] = 0;\n        mat[9] = 0;\n        mat[10] = 1;\n        mat[11] = 0;\n        mat[12] = 0;\n        mat[13] = 0;\n        mat[14] = 0;\n        mat[15] = 1;\n        return mat;\n    }\n    Mat4.setIdentity = setIdentity;\n    function setZero(mat) {\n        for (let i = 0; i < 16; i++)\n            mat[i] = 0;\n        return mat;\n    }\n    Mat4.setZero = setZero;\n    function ofRows(rows) {\n        const out = zero();\n        for (let i = 0; i < 4; i++) {\n            const r = rows[i];\n            for (let j = 0; j < 4; j++) {\n                out[4 * j + i] = r[j];\n            }\n        }\n        return out;\n    }\n    Mat4.ofRows = ofRows;\n    const _id = identity();\n    function isIdentity(m, eps) {\n        return areEqual(m, _id, typeof eps === 'undefined' ? EPSILON : eps);\n    }\n    Mat4.isIdentity = isIdentity;\n    function hasNaN(m) {\n        for (let i = 0; i < 16; i++)\n            if (isNaN(m[i]))\n                return true;\n        return false;\n    }\n    Mat4.hasNaN = hasNaN;\n    function areEqual(a, b, eps) {\n        for (let i = 0; i < 16; i++) {\n            if (Math.abs(a[i] - b[i]) > eps)\n                return false;\n        }\n        return true;\n    }\n    Mat4.areEqual = areEqual;\n    function setValue(a, i, j, value) {\n        a[4 * j + i] = value;\n    }\n    Mat4.setValue = setValue;\n    function getValue(a, i, j) {\n        return a[4 * j + i];\n    }\n    Mat4.getValue = getValue;\n    function toArray(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        out[offset + 2] = a[2];\n        out[offset + 3] = a[3];\n        out[offset + 4] = a[4];\n        out[offset + 5] = a[5];\n        out[offset + 6] = a[6];\n        out[offset + 7] = a[7];\n        out[offset + 8] = a[8];\n        out[offset + 9] = a[9];\n        out[offset + 10] = a[10];\n        out[offset + 11] = a[11];\n        out[offset + 12] = a[12];\n        out[offset + 13] = a[13];\n        out[offset + 14] = a[14];\n        out[offset + 15] = a[15];\n        return out;\n    }\n    Mat4.toArray = toArray;\n    function fromArray(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        a[2] = array[offset + 2];\n        a[3] = array[offset + 3];\n        a[4] = array[offset + 4];\n        a[5] = array[offset + 5];\n        a[6] = array[offset + 6];\n        a[7] = array[offset + 7];\n        a[8] = array[offset + 8];\n        a[9] = array[offset + 9];\n        a[10] = array[offset + 10];\n        a[11] = array[offset + 11];\n        a[12] = array[offset + 12];\n        a[13] = array[offset + 13];\n        a[14] = array[offset + 14];\n        a[15] = array[offset + 15];\n        return a;\n    }\n    Mat4.fromArray = fromArray;\n    function fromBasis(a, x, y, z) {\n        setZero(a);\n        setValue(a, 0, 0, x[0]);\n        setValue(a, 1, 0, x[1]);\n        setValue(a, 2, 0, x[2]);\n        setValue(a, 0, 1, y[0]);\n        setValue(a, 1, 1, y[1]);\n        setValue(a, 2, 1, y[2]);\n        setValue(a, 0, 2, z[0]);\n        setValue(a, 1, 2, z[1]);\n        setValue(a, 2, 2, z[2]);\n        setValue(a, 3, 3, 1);\n        return a;\n    }\n    Mat4.fromBasis = fromBasis;\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        out[4] = a[4];\n        out[5] = a[5];\n        out[6] = a[6];\n        out[7] = a[7];\n        out[8] = a[8];\n        out[9] = a[9];\n        out[10] = a[10];\n        out[11] = a[11];\n        out[12] = a[12];\n        out[13] = a[13];\n        out[14] = a[14];\n        out[15] = a[15];\n        return out;\n    }\n    Mat4.copy = copy;\n    function clone(a) {\n        return copy(zero(), a);\n    }\n    Mat4.clone = clone;\n    /**\n     * Returns the translation vector component of a transformation matrix.\n     */\n    function getTranslation(out, mat) {\n        out[0] = mat[12];\n        out[1] = mat[13];\n        out[2] = mat[14];\n        return out;\n    }\n    Mat4.getTranslation = getTranslation;\n    /**\n     * Returns the scaling factor component of a transformation matrix.\n     */\n    function getScaling(out, mat) {\n        const m11 = mat[0];\n        const m12 = mat[1];\n        const m13 = mat[2];\n        const m21 = mat[4];\n        const m22 = mat[5];\n        const m23 = mat[6];\n        const m31 = mat[8];\n        const m32 = mat[9];\n        const m33 = mat[10];\n        out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n        out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n        out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n        return out;\n    }\n    Mat4.getScaling = getScaling;\n    /**\n     * Returns a quaternion representing the rotational component of a transformation matrix.\n     */\n    function getRotation(out, mat) {\n        // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n        const trace = mat[0] + mat[5] + mat[10];\n        let S = 0;\n        if (trace > 0) {\n            S = Math.sqrt(trace + 1.0) * 2;\n            out[3] = 0.25 * S;\n            out[0] = (mat[6] - mat[9]) / S;\n            out[1] = (mat[8] - mat[2]) / S;\n            out[2] = (mat[1] - mat[4]) / S;\n        }\n        else if ((mat[0] > mat[5]) && (mat[0] > mat[10])) {\n            S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;\n            out[3] = (mat[6] - mat[9]) / S;\n            out[0] = 0.25 * S;\n            out[1] = (mat[1] + mat[4]) / S;\n            out[2] = (mat[8] + mat[2]) / S;\n        }\n        else if (mat[5] > mat[10]) {\n            S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;\n            out[3] = (mat[8] - mat[2]) / S;\n            out[0] = (mat[1] + mat[4]) / S;\n            out[1] = 0.25 * S;\n            out[2] = (mat[6] + mat[9]) / S;\n        }\n        else {\n            S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;\n            out[3] = (mat[1] - mat[4]) / S;\n            out[0] = (mat[8] + mat[2]) / S;\n            out[1] = (mat[6] + mat[9]) / S;\n            out[2] = 0.25 * S;\n        }\n        return out;\n    }\n    Mat4.getRotation = getRotation;\n    function extractRotation(out, mat) {\n        const scaleX = 1 / Math.sqrt(mat[0] * mat[0] + mat[1] * mat[1] + mat[2] * mat[2]);\n        const scaleY = 1 / Math.sqrt(mat[4] * mat[4] + mat[5] * mat[5] + mat[6] * mat[6]);\n        const scaleZ = 1 / Math.sqrt(mat[8] * mat[8] + mat[9] * mat[9] + mat[10] * mat[10]);\n        out[0] = mat[0] * scaleX;\n        out[1] = mat[1] * scaleX;\n        out[2] = mat[2] * scaleX;\n        out[3] = 0;\n        out[4] = mat[4] * scaleY;\n        out[5] = mat[5] * scaleY;\n        out[6] = mat[6] * scaleY;\n        out[7] = 0;\n        out[8] = mat[8] * scaleZ;\n        out[9] = mat[9] * scaleZ;\n        out[10] = mat[10] * scaleZ;\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.extractRotation = extractRotation;\n    function transpose(out, a) {\n        // If we are transposing ourselves we can skip a few steps but have to cache some values\n        if (out === a) {\n            const a01 = a[1], a02 = a[2], a03 = a[3];\n            const a12 = a[6], a13 = a[7];\n            const a23 = a[11];\n            out[1] = a[4];\n            out[2] = a[8];\n            out[3] = a[12];\n            out[4] = a01;\n            out[6] = a[9];\n            out[7] = a[13];\n            out[8] = a02;\n            out[9] = a12;\n            out[11] = a[14];\n            out[12] = a03;\n            out[13] = a13;\n            out[14] = a23;\n        }\n        else {\n            out[0] = a[0];\n            out[1] = a[4];\n            out[2] = a[8];\n            out[3] = a[12];\n            out[4] = a[1];\n            out[5] = a[5];\n            out[6] = a[9];\n            out[7] = a[13];\n            out[8] = a[2];\n            out[9] = a[6];\n            out[10] = a[10];\n            out[11] = a[14];\n            out[12] = a[3];\n            out[13] = a[7];\n            out[14] = a[11];\n            out[15] = a[15];\n        }\n        return out;\n    }\n    Mat4.transpose = transpose;\n    function tryInvert(out, a) {\n        const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3], a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7], a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11], a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32;\n        // Calculate the determinant\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        if (!det) {\n            return false;\n        }\n        det = 1.0 / det;\n        out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n        out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n        out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n        out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n        out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n        out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n        out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n        out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n        out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n        out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n        out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n        out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n        out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n        out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n        out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n        out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n        return true;\n    }\n    Mat4.tryInvert = tryInvert;\n    function invert(out, a) {\n        if (!tryInvert(out, a)) {\n            console.warn('non-invertible matrix.', a);\n        }\n        return out;\n    }\n    Mat4.invert = invert;\n    function mul(out, a, b) {\n        const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3], a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7], a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11], a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n        // Cache only the current line of the second matrix\n        let b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n        out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[4];\n        b1 = b[5];\n        b2 = b[6];\n        b3 = b[7];\n        out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[8];\n        b1 = b[9];\n        b2 = b[10];\n        b3 = b[11];\n        out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[12];\n        b1 = b[13];\n        b2 = b[14];\n        b3 = b[15];\n        out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        return out;\n    }\n    Mat4.mul = mul;\n    /**\n     * Like `mul` but with offsets into arrays\n     */\n    function mulOffset(out, a, b, oOut, oA, oB) {\n        const a00 = a[0 + oA], a01 = a[1 + oA], a02 = a[2 + oA], a03 = a[3 + oA], a10 = a[4 + oA], a11 = a[5 + oA], a12 = a[6 + oA], a13 = a[7 + oA], a20 = a[8 + oA], a21 = a[9 + oA], a22 = a[10 + oA], a23 = a[11 + oA], a30 = a[12 + oA], a31 = a[13 + oA], a32 = a[14 + oA], a33 = a[15 + oA];\n        // Cache only the current line of the second matrix\n        let b0 = b[0 + oB], b1 = b[1 + oB], b2 = b[2 + oB], b3 = b[3 + oB];\n        out[0 + oOut] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[1 + oOut] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[2 + oOut] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[3 + oOut] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[4 + oB];\n        b1 = b[5 + oB];\n        b2 = b[6 + oB];\n        b3 = b[7 + oB];\n        out[4 + oOut] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[5 + oOut] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[6 + oOut] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[7 + oOut] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[8 + oB];\n        b1 = b[9 + oB];\n        b2 = b[10 + oB];\n        b3 = b[11 + oB];\n        out[8 + oOut] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[9 + oOut] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[10 + oOut] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[11 + oOut] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        b0 = b[12 + oB];\n        b1 = b[13 + oB];\n        b2 = b[14 + oB];\n        b3 = b[15 + oB];\n        out[12 + oOut] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out[13 + oOut] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out[14 + oOut] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out[15 + oOut] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        return out;\n    }\n    Mat4.mulOffset = mulOffset;\n    function mul3(out, a, b, c) {\n        return mul(out, mul(out, a, b), c);\n    }\n    Mat4.mul3 = mul3;\n    /** Translate a Mat4 by the given Vec3 */\n    function translate(out, a, v) {\n        const x = v[0], y = v[1], z = v[2];\n        let a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23;\n        if (a === out) {\n            out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n            out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n            out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n            out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n        }\n        else {\n            a00 = a[0];\n            a01 = a[1];\n            a02 = a[2];\n            a03 = a[3];\n            a10 = a[4];\n            a11 = a[5];\n            a12 = a[6];\n            a13 = a[7];\n            a20 = a[8];\n            a21 = a[9];\n            a22 = a[10];\n            a23 = a[11];\n            out[0] = a00;\n            out[1] = a01;\n            out[2] = a02;\n            out[3] = a03;\n            out[4] = a10;\n            out[5] = a11;\n            out[6] = a12;\n            out[7] = a13;\n            out[8] = a20;\n            out[9] = a21;\n            out[10] = a22;\n            out[11] = a23;\n            out[12] = a00 * x + a10 * y + a20 * z + a[12];\n            out[13] = a01 * x + a11 * y + a21 * z + a[13];\n            out[14] = a02 * x + a12 * y + a22 * z + a[14];\n            out[15] = a03 * x + a13 * y + a23 * z + a[15];\n        }\n        return out;\n    }\n    Mat4.translate = translate;\n    function fromTranslation(out, v) {\n        out[0] = 1;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = 1;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 0;\n        out[9] = 0;\n        out[10] = 1;\n        out[11] = 0;\n        out[12] = v[0];\n        out[13] = v[1];\n        out[14] = v[2];\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromTranslation = fromTranslation;\n    function setTranslation(out, v) {\n        out[12] = v[0];\n        out[13] = v[1];\n        out[14] = v[2];\n        return out;\n    }\n    Mat4.setTranslation = setTranslation;\n    /**\n     * Sets the specified quaternion with values corresponding to the given\n     * axes. Each axis is a vec3 and is expected to be unit length and\n     * perpendicular to all other specified axes.\n     */\n    function setAxes(out, view, right, up) {\n        out[0] = right[0];\n        out[4] = right[1];\n        out[8] = right[2];\n        out[1] = up[0];\n        out[5] = up[1];\n        out[9] = up[2];\n        out[2] = view[0];\n        out[6] = view[1];\n        out[10] = view[2];\n        return out;\n    }\n    Mat4.setAxes = setAxes;\n    function rotate(out, a, rad, axis) {\n        let x = axis[0], y = axis[1], z = axis[2];\n        let len = Math.sqrt(x * x + y * y + z * z);\n        if (Math.abs(len) < EPSILON) {\n            return identity();\n        }\n        len = 1 / len;\n        x *= len;\n        y *= len;\n        z *= len;\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const t = 1 - c;\n        const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n        const a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n        const a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n        // Construct the elements of the rotation matrix\n        const b00 = x * x * t + c, b01 = y * x * t + z * s, b02 = z * x * t - y * s;\n        const b10 = x * y * t - z * s, b11 = y * y * t + c, b12 = z * y * t + x * s;\n        const b20 = x * z * t + y * s, b21 = y * z * t - x * s, b22 = z * z * t + c;\n        // Perform rotation-specific matrix multiplication\n        out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n        out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n        out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n        out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n        out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n        out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n        out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n        out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n        out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n        out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n        out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n        out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n        if (a !== out) { // If the source and destination differ, copy the unchanged last row\n            out[12] = a[12];\n            out[13] = a[13];\n            out[14] = a[14];\n            out[15] = a[15];\n        }\n        return out;\n    }\n    Mat4.rotate = rotate;\n    function fromRotation(out, rad, axis) {\n        let x = axis[0], y = axis[1], z = axis[2];\n        let len = Math.sqrt(x * x + y * y + z * z);\n        if (Math.abs(len) < EPSILON) {\n            return setIdentity(out);\n        }\n        len = 1 / len;\n        x *= len;\n        y *= len;\n        z *= len;\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const t = 1 - c;\n        // Perform rotation-specific matrix multiplication\n        out[0] = x * x * t + c;\n        out[1] = y * x * t + z * s;\n        out[2] = z * x * t - y * s;\n        out[3] = 0;\n        out[4] = x * y * t - z * s;\n        out[5] = y * y * t + c;\n        out[6] = z * y * t + x * s;\n        out[7] = 0;\n        out[8] = x * z * t + y * s;\n        out[9] = y * z * t - x * s;\n        out[10] = z * z * t + c;\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromRotation = fromRotation;\n    function scale(out, a, v) {\n        const x = v[0], y = v[1], z = v[2];\n        out[0] = a[0] * x;\n        out[1] = a[1] * x;\n        out[2] = a[2] * x;\n        out[3] = a[3] * x;\n        out[4] = a[4] * y;\n        out[5] = a[5] * y;\n        out[6] = a[6] * y;\n        out[7] = a[7] * y;\n        out[8] = a[8] * z;\n        out[9] = a[9] * z;\n        out[10] = a[10] * z;\n        out[11] = a[11] * z;\n        out[12] = a[12];\n        out[13] = a[13];\n        out[14] = a[14];\n        out[15] = a[15];\n        return out;\n    }\n    Mat4.scale = scale;\n    function scaleUniformly(out, a, scale) {\n        out[0] = a[0] * scale;\n        out[1] = a[1] * scale;\n        out[2] = a[2] * scale;\n        out[3] = a[3] * scale;\n        out[4] = a[4] * scale;\n        out[5] = a[5] * scale;\n        out[6] = a[6] * scale;\n        out[7] = a[7] * scale;\n        out[8] = a[8] * scale;\n        out[9] = a[9] * scale;\n        out[10] = a[10] * scale;\n        out[11] = a[11] * scale;\n        out[12] = a[12];\n        out[13] = a[13];\n        out[14] = a[14];\n        out[15] = a[15];\n        return out;\n    }\n    Mat4.scaleUniformly = scaleUniformly;\n    function fromScaling(out, v) {\n        out[0] = v[0];\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = v[1];\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 0;\n        out[9] = 0;\n        out[10] = v[2];\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromScaling = fromScaling;\n    function fromUniformScaling(out, scale) {\n        out[0] = scale;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = scale;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 0;\n        out[9] = 0;\n        out[10] = scale;\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromUniformScaling = fromUniformScaling;\n    /**\n     * Copies the mat3 into upper-left 3x3 values.\n     */\n    function fromMat3(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[4] = a[3];\n        out[5] = a[4];\n        out[6] = a[5];\n        out[8] = a[6];\n        out[9] = a[7];\n        out[10] = a[8];\n        return out;\n    }\n    Mat4.fromMat3 = fromMat3;\n    function compose(out, position, quaternion, scale) {\n        const [x, y, z, w] = quaternion;\n        const x2 = x + x, y2 = y + y, z2 = z + z;\n        const xx = x * x2, xy = x * y2, xz = x * z2;\n        const yy = y * y2, yz = y * z2, zz = z * z2;\n        const wx = w * x2, wy = w * y2, wz = w * z2;\n        const [sx, sy, sz] = scale;\n        out[0] = (1 - (yy + zz)) * sx;\n        out[1] = (xy + wz) * sx;\n        out[2] = (xz - wy) * sx;\n        out[3] = 0;\n        out[4] = (xy - wz) * sy;\n        out[5] = (1 - (xx + zz)) * sy;\n        out[6] = (yz + wx) * sy;\n        out[7] = 0;\n        out[8] = (xz + wy) * sz;\n        out[9] = (yz - wx) * sz;\n        out[10] = (1 - (xx + yy)) * sz;\n        out[11] = 0;\n        out[12] = position[0];\n        out[13] = position[1];\n        out[14] = position[2];\n        out[15] = 1;\n        return out;\n    }\n    Mat4.compose = compose;\n    const _v3 = [0, 0, 0];\n    const _m4 = zero();\n    function decompose(m, position, quaternion, scale) {\n        let sx = Vec3.magnitude(Vec3.set(_v3, m[0], m[1], m[2]));\n        const sy = Vec3.magnitude(Vec3.set(_v3, m[4], m[5], m[6]));\n        const sz = Vec3.magnitude(Vec3.set(_v3, m[8], m[9], m[10]));\n        // if determine is negative, we need to invert one scale\n        const det = determinant(m);\n        if (det < 0)\n            sx = -sx;\n        position[0] = m[12];\n        position[1] = m[13];\n        position[2] = m[14];\n        // scale the rotation part\n        copy(_m4, m);\n        const invSX = 1 / sx;\n        const invSY = 1 / sy;\n        const invSZ = 1 / sz;\n        _m4[0] *= invSX;\n        _m4[1] *= invSX;\n        _m4[2] *= invSX;\n        _m4[4] *= invSY;\n        _m4[5] *= invSY;\n        _m4[6] *= invSY;\n        _m4[8] *= invSZ;\n        _m4[9] *= invSZ;\n        _m4[10] *= invSZ;\n        getRotation(quaternion, _m4);\n        scale[0] = sx;\n        scale[1] = sy;\n        scale[2] = sz;\n        return m;\n    }\n    Mat4.decompose = decompose;\n    function makeTable(m) {\n        let ret = '';\n        for (let i = 0; i < 4; i++) {\n            for (let j = 0; j < 4; j++) {\n                ret += m[4 * j + i].toString();\n                if (j < 3)\n                    ret += ' ';\n            }\n            if (i < 3)\n                ret += '\\n';\n        }\n        return ret;\n    }\n    Mat4.makeTable = makeTable;\n    function determinant(a) {\n        const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3], a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7], a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11], a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32;\n        // Calculate the determinant\n        return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    }\n    Mat4.determinant = determinant;\n    /**\n     * Check if the matrix has the form\n     * [ Rotation    Translation ]\n     * [ 0           1           ]\n     *\n     * Allows for improper rotations\n     */\n    function isRotationAndTranslation(a, eps) {\n        return _isRotationAndTranslation(a, typeof eps !== 'undefined' ? eps : EPSILON);\n    }\n    Mat4.isRotationAndTranslation = isRotationAndTranslation;\n    function _isRotationAndTranslation(a, eps) {\n        const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3], a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7], a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11], a33 = a[15];\n        if (!equalEps(a33, 1, eps) || !equalEps(a03, 0, eps) || !equalEps(a13, 0, eps) || !equalEps(a23, 0, eps)) {\n            return false;\n        }\n        // use `abs` to allow for improper rotations\n        const det3x3 = Math.abs(a00 * (a11 * a22 - a12 * a21) - a01 * (a10 * a22 - a12 * a20) + a02 * (a10 * a21 - a11 * a20));\n        if (!equalEps(det3x3, 1, eps)) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Check if the matrix has only translation and uniform scaling\n     * [ S  0  0  X ]\n     * [ 0  S  0  Y ]\n     * [ 0  0  S  Z ]\n     * [ 0  0  0  1 ]\n     */\n    function isTranslationAndUniformScaling(a, eps) {\n        return _isTranslationAndUniformScaling(a, typeof eps !== 'undefined' ? eps : EPSILON);\n    }\n    Mat4.isTranslationAndUniformScaling = isTranslationAndUniformScaling;\n    function _isTranslationAndUniformScaling(a, eps) {\n        const a00 = a[0];\n        return (\n        // 0 base scaling\n        equalEps(a[1], 0, eps) &&\n            equalEps(a[2], 0, eps) &&\n            equalEps(a[3], 0, eps) &&\n            equalEps(a[4], 0, eps) &&\n            equalEps(a[5], a00, eps) &&\n            equalEps(a[6], 0, eps) &&\n            equalEps(a[7], 0, eps) &&\n            equalEps(a[8], 0, eps) &&\n            equalEps(a[9], 0, eps) &&\n            equalEps(a[10], a00, eps) &&\n            equalEps(a[11], 0, eps) &&\n            // 12, 13, 14 translation can be anything\n            equalEps(a[15], 1, eps));\n    }\n    function fromQuat(out, q) {\n        const x = q[0], y = q[1], z = q[2], w = q[3];\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n        const xx = x * x2;\n        const yx = y * x2;\n        const yy = y * y2;\n        const zx = z * x2;\n        const zy = z * y2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n        out[0] = 1 - yy - zz;\n        out[1] = yx + wz;\n        out[2] = zx - wy;\n        out[3] = 0;\n        out[4] = yx - wz;\n        out[5] = 1 - xx - zz;\n        out[6] = zy + wx;\n        out[7] = 0;\n        out[8] = zx + wy;\n        out[9] = zy - wx;\n        out[10] = 1 - xx - yy;\n        out[11] = 0;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromQuat = fromQuat;\n    function fromEuler(out, euler, order) {\n        const x = euler[0], y = euler[1], z = euler[2];\n        const a = Math.cos(x), b = Math.sin(x);\n        const c = Math.cos(y), d = Math.sin(y);\n        const e = Math.cos(z), f = Math.sin(z);\n        if (order === 'XYZ') {\n            const ae = a * e, af = a * f, be = b * e, bf = b * f;\n            out[0] = c * e;\n            out[4] = -c * f;\n            out[8] = d;\n            out[1] = af + be * d;\n            out[5] = ae - bf * d;\n            out[9] = -b * c;\n            out[2] = bf - ae * d;\n            out[6] = be + af * d;\n            out[10] = a * c;\n        }\n        else if (order === 'YXZ') {\n            const ce = c * e, cf = c * f, de = d * e, df = d * f;\n            out[0] = ce + df * b;\n            out[4] = de * b - cf;\n            out[8] = a * d;\n            out[1] = a * f;\n            out[5] = a * e;\n            out[9] = -b;\n            out[2] = cf * b - de;\n            out[6] = df + ce * b;\n            out[10] = a * c;\n        }\n        else if (order === 'ZXY') {\n            const ce = c * e, cf = c * f, de = d * e, df = d * f;\n            out[0] = ce - df * b;\n            out[4] = -a * f;\n            out[8] = de + cf * b;\n            out[1] = cf + de * b;\n            out[5] = a * e;\n            out[9] = df - ce * b;\n            out[2] = -a * d;\n            out[6] = b;\n            out[10] = a * c;\n        }\n        else if (order === 'ZYX') {\n            const ae = a * e, af = a * f, be = b * e, bf = b * f;\n            out[0] = c * e;\n            out[4] = be * d - af;\n            out[8] = ae * d + bf;\n            out[1] = c * f;\n            out[5] = bf * d + ae;\n            out[9] = af * d - be;\n            out[2] = -d;\n            out[6] = b * c;\n            out[10] = a * c;\n        }\n        else if (order === 'YZX') {\n            const ac = a * c, ad = a * d, bc = b * c, bd = b * d;\n            out[0] = c * e;\n            out[4] = bd - ac * f;\n            out[8] = bc * f + ad;\n            out[1] = f;\n            out[5] = a * e;\n            out[9] = -b * e;\n            out[2] = -d * e;\n            out[6] = ad * f + bc;\n            out[10] = ac - bd * f;\n        }\n        else if (order === 'XZY') {\n            const ac = a * c, ad = a * d, bc = b * c, bd = b * d;\n            out[0] = c * e;\n            out[4] = -f;\n            out[8] = d * e;\n            out[1] = ac * f + bd;\n            out[5] = a * e;\n            out[9] = ad * f - bc;\n            out[2] = bc * f - ad;\n            out[6] = b * e;\n            out[10] = bd * f + ac;\n        }\n        // bottom row\n        out[3] = 0;\n        out[7] = 0;\n        out[11] = 0;\n        // last column\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = 0;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.fromEuler = fromEuler;\n    /**\n     * Generates a perspective projection (frustum) matrix with the given bounds\n     */\n    function perspective(out, left, right, top, bottom, near, far) {\n        const x = 2 * near / (right - left);\n        const y = 2 * near / (top - bottom);\n        const a = (right + left) / (right - left);\n        const b = (top + bottom) / (top - bottom);\n        const c = -(far + near) / (far - near);\n        const d = -2 * far * near / (far - near);\n        out[0] = x;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = y;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = a;\n        out[9] = b;\n        out[10] = c;\n        out[11] = -1;\n        out[12] = 0;\n        out[13] = 0;\n        out[14] = d;\n        out[15] = 0;\n        return out;\n    }\n    Mat4.perspective = perspective;\n    /**\n     * Generates a orthogonal projection matrix with the given bounds\n     */\n    function ortho(out, left, right, top, bottom, near, far) {\n        const w = 1.0 / (right - left);\n        const h = 1.0 / (top - bottom);\n        const p = 1.0 / (far - near);\n        const x = (right + left) * w;\n        const y = (top + bottom) * h;\n        const z = (far + near) * p;\n        out[0] = 2 * w;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 0;\n        out[5] = 2 * h;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 0;\n        out[9] = 0;\n        out[10] = -2 * p;\n        out[11] = 0;\n        out[12] = -x;\n        out[13] = -y;\n        out[14] = -z;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.ortho = ortho;\n    /**\n     * Generates a look-at matrix with the given eye position, focal point, and up axis\n     */\n    function lookAt(out, eye, center, up) {\n        let x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n        const eyex = eye[0];\n        const eyey = eye[1];\n        const eyez = eye[2];\n        const upx = up[0];\n        const upy = up[1];\n        const upz = up[2];\n        const centerx = center[0];\n        const centery = center[1];\n        const centerz = center[2];\n        if (Math.abs(eyex - centerx) < EPSILON &&\n            Math.abs(eyey - centery) < EPSILON &&\n            Math.abs(eyez - centerz) < EPSILON) {\n            return setIdentity(out);\n        }\n        z0 = eyex - centerx;\n        z1 = eyey - centery;\n        z2 = eyez - centerz;\n        len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n        z0 *= len;\n        z1 *= len;\n        z2 *= len;\n        x0 = upy * z2 - upz * z1;\n        x1 = upz * z0 - upx * z2;\n        x2 = upx * z1 - upy * z0;\n        len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n        if (!len) {\n            x0 = 0;\n            x1 = 0;\n            x2 = 0;\n        }\n        else {\n            len = 1 / len;\n            x0 *= len;\n            x1 *= len;\n            x2 *= len;\n        }\n        y0 = z1 * x2 - z2 * x1;\n        y1 = z2 * x0 - z0 * x2;\n        y2 = z0 * x1 - z1 * x0;\n        len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n        if (!len) {\n            y0 = 0;\n            y1 = 0;\n            y2 = 0;\n        }\n        else {\n            len = 1 / len;\n            y0 *= len;\n            y1 *= len;\n            y2 *= len;\n        }\n        out[0] = x0;\n        out[1] = y0;\n        out[2] = z0;\n        out[3] = 0;\n        out[4] = x1;\n        out[5] = y1;\n        out[6] = z1;\n        out[7] = 0;\n        out[8] = x2;\n        out[9] = y2;\n        out[10] = z2;\n        out[11] = 0;\n        out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n        out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n        out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n        out[15] = 1;\n        return out;\n    }\n    Mat4.lookAt = lookAt;\n    /**\n     * Generates a matrix that makes something look at something else.\n     */\n    function targetTo(out, eye, target, up) {\n        const eyex = eye[0], eyey = eye[1], eyez = eye[2], upx = up[0], upy = up[1], upz = up[2];\n        let z0 = eyex - target[0], z1 = eyey - target[1], z2 = eyez - target[2];\n        let len = z0 * z0 + z1 * z1 + z2 * z2;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            z0 *= len;\n            z1 *= len;\n            z2 *= len;\n        }\n        let x0 = upy * z2 - upz * z1, x1 = upz * z0 - upx * z2, x2 = upx * z1 - upy * z0;\n        len = x0 * x0 + x1 * x1 + x2 * x2;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            x0 *= len;\n            x1 *= len;\n            x2 *= len;\n        }\n        out[0] = x0;\n        out[1] = x1;\n        out[2] = x2;\n        out[3] = 0;\n        out[4] = z1 * x2 - z2 * x1;\n        out[5] = z2 * x0 - z0 * x2;\n        out[6] = z0 * x1 - z1 * x0;\n        out[7] = 0;\n        out[8] = z0;\n        out[9] = z1;\n        out[10] = z2;\n        out[11] = 0;\n        out[12] = eyex;\n        out[13] = eyey;\n        out[14] = eyez;\n        out[15] = 1;\n        return out;\n    }\n    Mat4.targetTo = targetTo;\n    /**\n     * Perm is 0-indexed permutation\n     */\n    function fromPermutation(out, perm) {\n        setZero(out);\n        for (let i = 0; i < 4; i++) {\n            const p = perm[i];\n            setValue(out, i, p, 1);\n        }\n        return out;\n    }\n    Mat4.fromPermutation = fromPermutation;\n    function getMaxScaleOnAxis(m) {\n        const scaleXSq = m[0] * m[0] + m[1] * m[1] + m[2] * m[2];\n        const scaleYSq = m[4] * m[4] + m[5] * m[5] + m[6] * m[6];\n        const scaleZSq = m[8] * m[8] + m[9] * m[9] + m[10] * m[10];\n        return Math.sqrt(Math.max(scaleXSq, scaleYSq, scaleZSq));\n    }\n    Mat4.getMaxScaleOnAxis = getMaxScaleOnAxis;\n    const xAxis = [1, 0, 0];\n    const yAxis = [0, 1, 0];\n    const zAxis = [0, 0, 1];\n    /** Rotation matrix for 90deg around x-axis */\n    Mat4.rotX90 = fromRotation(zero(), degToRad(90), xAxis);\n    /** Rotation matrix for 180deg around x-axis */\n    Mat4.rotX180 = fromRotation(zero(), degToRad(180), xAxis);\n    /** Rotation matrix for 90deg around y-axis */\n    Mat4.rotY90 = fromRotation(zero(), degToRad(90), yAxis);\n    /** Rotation matrix for 180deg around y-axis */\n    Mat4.rotY180 = fromRotation(zero(), degToRad(180), yAxis);\n    /** Rotation matrix for 270deg around y-axis */\n    Mat4.rotY270 = fromRotation(zero(), degToRad(270), yAxis);\n    /** Rotation matrix for 90deg around z-axis */\n    Mat4.rotZ90 = fromRotation(zero(), degToRad(90), zAxis);\n    /** Rotation matrix for 180deg around z-axis */\n    Mat4.rotZ180 = fromRotation(zero(), degToRad(180), zAxis);\n    /** Rotation matrix for 90deg around first x-axis and then y-axis */\n    Mat4.rotXY90 = mul(zero(), Mat4.rotX90, Mat4.rotY90);\n    /** Rotation matrix for 90deg around first z-axis and then y-axis */\n    Mat4.rotZY90 = mul(zero(), Mat4.rotZ90, Mat4.rotY90);\n    /** Rotation matrix for 90deg around first z-axis and then y-axis and then z-axis */\n    Mat4.rotZYZ90 = mul(zero(), Mat4.rotZY90, Mat4.rotZ90);\n    /** Rotation matrix for 90deg around first z-axis and then 180deg around x-axis */\n    Mat4.rotZ90X180 = mul(zero(), Mat4.rotZ90, Mat4.rotX180);\n    /** Rotation matrix for 90deg around first y-axis and then 180deg around z-axis */\n    Mat4.rotY90Z180 = mul(zero(), Mat4.rotY90, Mat4.rotZ180);\n    /** Identity matrix */\n    Mat4.id = identity();\n})(Mat4 || (Mat4 = {}));\nexport { Mat4 };\n","/**\n * Copyright (c) 2017-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { EPSILON } from './common';\nimport { Mat4 } from './mat4';\nimport { Vec3 } from './vec3';\nfunction Mat3() {\n    return Mat3.zero();\n}\n(function (Mat3) {\n    function zero() {\n        // force double backing array by 0.1.\n        const ret = [0.1, 0, 0, 0, 0, 0, 0, 0, 0];\n        ret[0] = 0.0;\n        return ret;\n    }\n    Mat3.zero = zero;\n    function identity() {\n        const out = zero();\n        out[0] = 1;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 0;\n        out[4] = 1;\n        out[5] = 0;\n        out[6] = 0;\n        out[7] = 0;\n        out[8] = 1;\n        return out;\n    }\n    Mat3.identity = identity;\n    function setIdentity(mat) {\n        mat[0] = 1;\n        mat[1] = 0;\n        mat[2] = 0;\n        mat[3] = 0;\n        mat[4] = 1;\n        mat[5] = 0;\n        mat[6] = 0;\n        mat[7] = 0;\n        mat[8] = 1;\n        return mat;\n    }\n    Mat3.setIdentity = setIdentity;\n    function toArray(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        out[offset + 2] = a[2];\n        out[offset + 3] = a[3];\n        out[offset + 4] = a[4];\n        out[offset + 5] = a[5];\n        out[offset + 6] = a[6];\n        out[offset + 7] = a[7];\n        out[offset + 8] = a[8];\n        return out;\n    }\n    Mat3.toArray = toArray;\n    function fromArray(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        a[2] = array[offset + 2];\n        a[3] = array[offset + 3];\n        a[4] = array[offset + 4];\n        a[5] = array[offset + 5];\n        a[6] = array[offset + 6];\n        a[7] = array[offset + 7];\n        a[8] = array[offset + 8];\n        return a;\n    }\n    Mat3.fromArray = fromArray;\n    function fromColumns(out, left, middle, right) {\n        out[0] = left[0];\n        out[1] = left[1];\n        out[2] = left[2];\n        out[3] = middle[0];\n        out[4] = middle[1];\n        out[5] = middle[2];\n        out[6] = right[0];\n        out[7] = right[1];\n        out[8] = right[2];\n        return out;\n    }\n    Mat3.fromColumns = fromColumns;\n    /**\n     * Copies the upper-left 3x3 values into the given mat3.\n     */\n    function fromMat4(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[4];\n        out[4] = a[5];\n        out[5] = a[6];\n        out[6] = a[8];\n        out[7] = a[9];\n        out[8] = a[10];\n        return out;\n    }\n    Mat3.fromMat4 = fromMat4;\n    const _m4 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    function fromEuler(out, euler, order) {\n        Mat4.fromEuler(_m4, euler, order);\n        return fromMat4(out, _m4);\n    }\n    Mat3.fromEuler = fromEuler;\n    function create(a00, a01, a02, a10, a11, a12, a20, a21, a22) {\n        const out = zero();\n        out[0] = a00;\n        out[1] = a01;\n        out[2] = a02;\n        out[3] = a10;\n        out[4] = a11;\n        out[5] = a12;\n        out[6] = a20;\n        out[7] = a21;\n        out[8] = a22;\n        return out;\n    }\n    Mat3.create = create;\n    const _id = identity();\n    function isIdentity(m, eps) {\n        return areEqual(m, _id, typeof eps === 'undefined' ? EPSILON : eps);\n    }\n    Mat3.isIdentity = isIdentity;\n    function hasNaN(m) {\n        for (let i = 0; i < 9; i++)\n            if (isNaN(m[i]))\n                return true;\n        return false;\n    }\n    Mat3.hasNaN = hasNaN;\n    /**\n     * Creates a new Mat3 initialized with values from an existing matrix\n     */\n    function clone(a) {\n        return copy(zero(), a);\n    }\n    Mat3.clone = clone;\n    function areEqual(a, b, eps) {\n        for (let i = 0; i < 9; i++) {\n            if (Math.abs(a[i] - b[i]) > eps)\n                return false;\n        }\n        return true;\n    }\n    Mat3.areEqual = areEqual;\n    function setValue(a, i, j, value) {\n        a[3 * j + i] = value;\n    }\n    Mat3.setValue = setValue;\n    function getValue(a, i, j) {\n        return a[3 * j + i];\n    }\n    Mat3.getValue = getValue;\n    /**\n     * Copy the values from one Mat3 to another\n     */\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        out[4] = a[4];\n        out[5] = a[5];\n        out[6] = a[6];\n        out[7] = a[7];\n        out[8] = a[8];\n        return out;\n    }\n    Mat3.copy = copy;\n    /**\n     * Transpose the values of a Mat3\n     */\n    function transpose(out, a) {\n        // If we are transposing ourselves we can skip a few steps but have to cache some values\n        if (out === a) {\n            const a01 = a[1], a02 = a[2], a12 = a[5];\n            out[1] = a[3];\n            out[2] = a[6];\n            out[3] = a01;\n            out[5] = a[7];\n            out[6] = a02;\n            out[7] = a12;\n        }\n        else {\n            out[0] = a[0];\n            out[1] = a[3];\n            out[2] = a[6];\n            out[3] = a[1];\n            out[4] = a[4];\n            out[5] = a[7];\n            out[6] = a[2];\n            out[7] = a[5];\n            out[8] = a[8];\n        }\n        return out;\n    }\n    Mat3.transpose = transpose;\n    /**\n     * Inverts a Mat3\n     */\n    function invert(out, a) {\n        const a00 = a[0], a01 = a[1], a02 = a[2];\n        const a10 = a[3], a11 = a[4], a12 = a[5];\n        const a20 = a[6], a21 = a[7], a22 = a[8];\n        const b01 = a22 * a11 - a12 * a21;\n        const b11 = -a22 * a10 + a12 * a20;\n        const b21 = a21 * a10 - a11 * a20;\n        // Calculate the determinant\n        let det = a00 * b01 + a01 * b11 + a02 * b21;\n        if (!det) {\n            console.warn('non-invertible matrix.', a);\n            return out;\n        }\n        det = 1.0 / det;\n        out[0] = b01 * det;\n        out[1] = (-a22 * a01 + a02 * a21) * det;\n        out[2] = (a12 * a01 - a02 * a11) * det;\n        out[3] = b11 * det;\n        out[4] = (a22 * a00 - a02 * a20) * det;\n        out[5] = (-a12 * a00 + a02 * a10) * det;\n        out[6] = b21 * det;\n        out[7] = (-a21 * a00 + a01 * a20) * det;\n        out[8] = (a11 * a00 - a01 * a10) * det;\n        return out;\n    }\n    Mat3.invert = invert;\n    function symmtricFromUpper(out, a) {\n        if (out === a) {\n            out[3] = a[1];\n            out[6] = a[2];\n            out[7] = a[5];\n        }\n        else {\n            out[0] = a[0];\n            out[1] = a[1];\n            out[2] = a[2];\n            out[3] = a[1];\n            out[4] = a[4];\n            out[5] = a[5];\n            out[6] = a[2];\n            out[7] = a[5];\n            out[8] = a[8];\n        }\n        return out;\n    }\n    Mat3.symmtricFromUpper = symmtricFromUpper;\n    function symmtricFromLower(out, a) {\n        if (out === a) {\n            out[1] = a[3];\n            out[2] = a[6];\n            out[5] = a[7];\n        }\n        else {\n            out[0] = a[0];\n            out[1] = a[3];\n            out[2] = a[6];\n            out[3] = a[3];\n            out[4] = a[4];\n            out[5] = a[7];\n            out[6] = a[6];\n            out[7] = a[7];\n            out[8] = a[8];\n        }\n        return out;\n    }\n    Mat3.symmtricFromLower = symmtricFromLower;\n    function determinant(a) {\n        const a00 = a[0], a01 = a[1], a02 = a[2];\n        const a10 = a[3], a11 = a[4], a12 = a[5];\n        const a20 = a[6], a21 = a[7], a22 = a[8];\n        const b01 = a22 * a11 - a12 * a21;\n        const b11 = -a22 * a10 + a12 * a20;\n        const b21 = a21 * a10 - a11 * a20;\n        // Calculate the determinant\n        return a00 * b01 + a01 * b11 + a02 * b21;\n    }\n    Mat3.determinant = determinant;\n    function trace(a) {\n        return a[0] + a[4] + a[8];\n    }\n    Mat3.trace = trace;\n    function sub(out, a, b) {\n        out[0] = a[0] - b[0];\n        out[1] = a[1] - b[1];\n        out[2] = a[2] - b[2];\n        out[3] = a[3] - b[3];\n        out[4] = a[4] - b[4];\n        out[5] = a[5] - b[5];\n        out[6] = a[6] - b[6];\n        out[7] = a[7] - b[7];\n        out[8] = a[8] - b[8];\n        return out;\n    }\n    Mat3.sub = sub;\n    function add(out, a, b) {\n        out[0] = a[0] + b[0];\n        out[1] = a[1] + b[1];\n        out[2] = a[2] + b[2];\n        out[3] = a[3] + b[3];\n        out[4] = a[4] + b[4];\n        out[5] = a[5] + b[5];\n        out[6] = a[6] + b[6];\n        out[7] = a[7] + b[7];\n        out[8] = a[8] + b[8];\n        return out;\n    }\n    Mat3.add = add;\n    function mul(out, a, b) {\n        const a00 = a[0], a01 = a[1], a02 = a[2], a10 = a[3], a11 = a[4], a12 = a[5], a20 = a[6], a21 = a[7], a22 = a[8];\n        const b00 = b[0], b01 = b[1], b02 = b[2], b10 = b[3], b11 = b[4], b12 = b[5], b20 = b[6], b21 = b[7], b22 = b[8];\n        out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n        out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n        out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n        out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n        out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n        out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n        out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n        out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n        out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n        return out;\n    }\n    Mat3.mul = mul;\n    function subScalar(out, a, s) {\n        out[0] = a[0] - s;\n        out[1] = a[1] - s;\n        out[2] = a[2] - s;\n        out[3] = a[3] - s;\n        out[4] = a[4] - s;\n        out[5] = a[5] - s;\n        out[6] = a[6] - s;\n        out[7] = a[7] - s;\n        out[8] = a[8] - s;\n        return out;\n    }\n    Mat3.subScalar = subScalar;\n    function addScalar(out, a, s) {\n        out[0] = a[0] + s;\n        out[1] = a[1] + s;\n        out[2] = a[2] + s;\n        out[3] = a[3] + s;\n        out[4] = a[4] + s;\n        out[5] = a[5] + s;\n        out[6] = a[6] + s;\n        out[7] = a[7] + s;\n        out[8] = a[8] + s;\n        return out;\n    }\n    Mat3.addScalar = addScalar;\n    function mulScalar(out, a, s) {\n        out[0] = a[0] * s;\n        out[1] = a[1] * s;\n        out[2] = a[2] * s;\n        out[3] = a[3] * s;\n        out[4] = a[4] * s;\n        out[5] = a[5] * s;\n        out[6] = a[6] * s;\n        out[7] = a[7] * s;\n        out[8] = a[8] * s;\n        return out;\n    }\n    Mat3.mulScalar = mulScalar;\n    const piThird = Math.PI / 3;\n    const tmpB = zero();\n    /**\n     * Given a real symmetric 3x3 matrix A, compute the eigenvalues\n     *\n     * From https://en.wikipedia.org/wiki/Eigenvalue_algorithm#3.C3.973_matrices\n     */\n    function symmetricEigenvalues(out, a) {\n        const p1 = a[1] * a[1] + a[2] * a[2] + a[5] * a[5];\n        if (p1 === 0) {\n            out[0] = a[0];\n            out[1] = a[4];\n            out[2] = a[8];\n        }\n        else {\n            const q = trace(a) / 3;\n            const a1 = a[0] - q;\n            const a2 = a[4] - q;\n            const a3 = a[8] - q;\n            const p2 = a1 * a1 + a2 * a2 + a3 * a3 + 2 * p1;\n            const p = Math.sqrt(p2 / 6);\n            mulScalar(tmpB, Mat3.Identity, q);\n            sub(tmpB, a, tmpB);\n            mulScalar(tmpB, tmpB, (1 / p));\n            const r = determinant(tmpB) / 2;\n            // In exact arithmetic for a symmetric matrix  -1 <= r <= 1\n            // but computation error can leave it slightly outside this range.\n            const phi = r <= -1 ? piThird : r >= 1 ?\n                0 : Math.acos(r) / 3;\n            // the eigenvalues satisfy eig3 <= eig2 <= eig1\n            out[0] = q + 2 * p * Math.cos(phi);\n            out[2] = q + 2 * p * Math.cos(phi + (2 * piThird));\n            out[1] = 3 * q - out[0] - out[2]; // since trace(A) = eig1 + eig2 + eig3\n        }\n        return out;\n    }\n    Mat3.symmetricEigenvalues = symmetricEigenvalues;\n    const tmpR0 = [0.1, 0.0, 0.0];\n    const tmpR1 = [0.1, 0.0, 0.0];\n    const tmpR2 = [0.1, 0.0, 0.0];\n    const tmpR0xR1 = [0.1, 0.0, 0.0];\n    const tmpR0xR2 = [0.1, 0.0, 0.0];\n    const tmpR1xR2 = [0.1, 0.0, 0.0];\n    /**\n     * Calculates the eigenvector for the given eigenvalue `e` of matrix `a`\n     */\n    function eigenvector(out, a, e) {\n        Vec3.set(tmpR0, a[0] - e, a[1], a[2]);\n        Vec3.set(tmpR1, a[1], a[4] - e, a[5]);\n        Vec3.set(tmpR2, a[2], a[5], a[8] - e);\n        Vec3.cross(tmpR0xR1, tmpR0, tmpR1);\n        Vec3.cross(tmpR0xR2, tmpR0, tmpR2);\n        Vec3.cross(tmpR1xR2, tmpR1, tmpR2);\n        const d0 = Vec3.dot(tmpR0xR1, tmpR0xR1);\n        const d1 = Vec3.dot(tmpR0xR2, tmpR0xR2);\n        const d2 = Vec3.dot(tmpR1xR2, tmpR1xR2);\n        let dmax = d0;\n        let imax = 0;\n        if (d1 > dmax) {\n            dmax = d1;\n            imax = 1;\n        }\n        if (d2 > dmax)\n            imax = 2;\n        if (imax === 0) {\n            Vec3.scale(out, tmpR0xR1, 1 / Math.sqrt(d0));\n        }\n        else if (imax === 1) {\n            Vec3.scale(out, tmpR0xR2, 1 / Math.sqrt(d1));\n        }\n        else {\n            Vec3.scale(out, tmpR1xR2, 1 / Math.sqrt(d2));\n        }\n        return out;\n    }\n    Mat3.eigenvector = eigenvector;\n    /**\n     * Get matrix to transform directions, e.g. normals\n     */\n    function directionTransform(out, t) {\n        fromMat4(out, t);\n        invert(out, out);\n        transpose(out, out);\n        return out;\n    }\n    Mat3.directionTransform = directionTransform;\n    Mat3.Identity = identity();\n    /** Return the Frobenius inner product of two matrices (= dot product of the flattened matrices).\n     * Can be used as a measure of similarity between two rotation matrices. */\n    function innerProduct(a, b) {\n        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]\n            + a[3] * b[3] + a[4] * b[4] + a[5] * b[5]\n            + a[6] * b[6] + a[7] * b[7] + a[8] * b[8];\n    }\n    Mat3.innerProduct = innerProduct;\n})(Mat3 || (Mat3 = {}));\nexport { Mat3 };\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nfunction Vec2() {\n    return Vec2.zero();\n}\n(function (Vec2) {\n    function zero() {\n        // force double backing array by 0.1.\n        const ret = [0.1, 0];\n        ret[0] = 0.0;\n        return ret;\n    }\n    Vec2.zero = zero;\n    function clone(a) {\n        const out = zero();\n        out[0] = a[0];\n        out[1] = a[1];\n        return out;\n    }\n    Vec2.clone = clone;\n    function create(x, y) {\n        const out = zero();\n        out[0] = x;\n        out[1] = y;\n        return out;\n    }\n    Vec2.create = create;\n    function hasNaN(a) {\n        return isNaN(a[0]) || isNaN(a[1]);\n    }\n    Vec2.hasNaN = hasNaN;\n    function toArray(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        return out;\n    }\n    Vec2.toArray = toArray;\n    function fromArray(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        return a;\n    }\n    Vec2.fromArray = fromArray;\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        return out;\n    }\n    Vec2.copy = copy;\n    function set(out, x, y) {\n        out[0] = x;\n        out[1] = y;\n        return out;\n    }\n    Vec2.set = set;\n    function add(out, a, b) {\n        out[0] = a[0] + b[0];\n        out[1] = a[1] + b[1];\n        return out;\n    }\n    Vec2.add = add;\n    function sub(out, a, b) {\n        out[0] = a[0] - b[0];\n        out[1] = a[1] - b[1];\n        return out;\n    }\n    Vec2.sub = sub;\n    function mul(out, a, b) {\n        out[0] = a[0] * b[0];\n        out[1] = a[1] * b[1];\n        return out;\n    }\n    Vec2.mul = mul;\n    function div(out, a, b) {\n        out[0] = a[0] / b[0];\n        out[1] = a[1] / b[1];\n        return out;\n    }\n    Vec2.div = div;\n    function scale(out, a, b) {\n        out[0] = a[0] * b;\n        out[1] = a[1] * b;\n        return out;\n    }\n    Vec2.scale = scale;\n    /**\n     * Math.round the components of a Vec2\n     */\n    function round(out, a) {\n        out[0] = Math.round(a[0]);\n        out[1] = Math.round(a[1]);\n        return out;\n    }\n    Vec2.round = round;\n    /**\n     * Math.ceil the components of a Vec2\n     */\n    function ceil(out, a) {\n        out[0] = Math.ceil(a[0]);\n        out[1] = Math.ceil(a[1]);\n        return out;\n    }\n    Vec2.ceil = ceil;\n    /**\n     * Math.floor the components of a Vec2\n     */\n    function floor(out, a) {\n        out[0] = Math.floor(a[0]);\n        out[1] = Math.floor(a[1]);\n        return out;\n    }\n    Vec2.floor = floor;\n    function distance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1];\n        return Math.sqrt(x * x + y * y);\n    }\n    Vec2.distance = distance;\n    function squaredDistance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1];\n        return x * x + y * y;\n    }\n    Vec2.squaredDistance = squaredDistance;\n    function magnitude(a) {\n        const x = a[0], y = a[1];\n        return Math.sqrt(x * x + y * y);\n    }\n    Vec2.magnitude = magnitude;\n    function squaredMagnitude(a) {\n        const x = a[0], y = a[1];\n        return x * x + y * y;\n    }\n    Vec2.squaredMagnitude = squaredMagnitude;\n    /**\n     * Returns the inverse of the components of a Vec2\n     */\n    function inverse(out, a) {\n        out[0] = 1.0 / a[0];\n        out[1] = 1.0 / a[1];\n        return out;\n    }\n    Vec2.inverse = inverse;\n    function areEqual(a, b) {\n        return a[0] === b[0] && a[1] === b[1];\n    }\n    Vec2.areEqual = areEqual;\n    function toString(a, precision) {\n        return `[${a[0].toPrecision(precision)} ${a[1].toPrecision(precision)}}]`;\n    }\n    Vec2.toString = toString;\n})(Vec2 || (Vec2 = {}));\nexport { Vec2 };\n","/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { EPSILON } from './common';\nfunction Vec4() {\n    return Vec4.zero();\n}\n(function (Vec4) {\n    function zero() {\n        // force double backing array by 0.1.\n        const ret = [0.1, 0, 0, 0];\n        ret[0] = 0.0;\n        return ret;\n    }\n    Vec4.zero = zero;\n    function clone(a) {\n        const out = zero();\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        return out;\n    }\n    Vec4.clone = clone;\n    function create(x, y, z, w) {\n        const out = zero();\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        out[3] = w;\n        return out;\n    }\n    Vec4.create = create;\n    function fromSphere(out, sphere) {\n        out[0] = sphere.center[0];\n        out[1] = sphere.center[1];\n        out[2] = sphere.center[2];\n        out[3] = sphere.radius;\n        return out;\n    }\n    Vec4.fromSphere = fromSphere;\n    function ofSphere(sphere) {\n        return fromSphere(zero(), sphere);\n    }\n    Vec4.ofSphere = ofSphere;\n    function hasNaN(a) {\n        return isNaN(a[0]) || isNaN(a[1]) || isNaN(a[2]) || isNaN(a[3]);\n    }\n    Vec4.hasNaN = hasNaN;\n    function toArray(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        out[offset + 2] = a[2];\n        out[offset + 3] = a[3];\n        return out;\n    }\n    Vec4.toArray = toArray;\n    function fromArray(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        a[2] = array[offset + 2];\n        a[3] = array[offset + 3];\n        return a;\n    }\n    Vec4.fromArray = fromArray;\n    function toVec3Array(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        out[offset + 2] = a[2];\n    }\n    Vec4.toVec3Array = toVec3Array;\n    function fromVec3Array(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        a[2] = array[offset + 2];\n        a[3] = 0;\n        return a;\n    }\n    Vec4.fromVec3Array = fromVec3Array;\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        return out;\n    }\n    Vec4.copy = copy;\n    function set(out, x, y, z, w) {\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        out[3] = w;\n        return out;\n    }\n    Vec4.set = set;\n    function add(out, a, b) {\n        out[0] = a[0] + b[0];\n        out[1] = a[1] + b[1];\n        out[2] = a[2] + b[2];\n        out[3] = a[3] + b[3];\n        return out;\n    }\n    Vec4.add = add;\n    function distance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1], z = b[2] - a[2], w = b[3] - a[3];\n        return Math.sqrt(x * x + y * y + z * z + w * w);\n    }\n    Vec4.distance = distance;\n    function scale(out, a, b) {\n        out[0] = a[0] * b;\n        out[1] = a[1] * b;\n        out[2] = a[2] * b;\n        out[4] = a[4] * b;\n        return out;\n    }\n    Vec4.scale = scale;\n    /**\n     * Math.round the components of a Vec4\n     */\n    function round(out, a) {\n        out[0] = Math.round(a[0]);\n        out[1] = Math.round(a[1]);\n        out[2] = Math.round(a[2]);\n        out[3] = Math.round(a[3]);\n        return out;\n    }\n    Vec4.round = round;\n    /**\n     * Math.ceil the components of a Vec4\n     */\n    function ceil(out, a) {\n        out[0] = Math.ceil(a[0]);\n        out[1] = Math.ceil(a[1]);\n        out[2] = Math.ceil(a[2]);\n        out[3] = Math.ceil(a[3]);\n        return out;\n    }\n    Vec4.ceil = ceil;\n    /**\n     * Math.floor the components of a Vec3\n     */\n    function floor(out, a) {\n        out[0] = Math.floor(a[0]);\n        out[1] = Math.floor(a[1]);\n        out[2] = Math.floor(a[2]);\n        out[3] = Math.floor(a[3]);\n        return out;\n    }\n    Vec4.floor = floor;\n    function squaredDistance(a, b) {\n        const x = b[0] - a[0], y = b[1] - a[1], z = b[2] - a[2], w = b[3] - a[3];\n        return x * x + y * y + z * z + w * w;\n    }\n    Vec4.squaredDistance = squaredDistance;\n    function norm(a) {\n        const x = a[0], y = a[1], z = a[2], w = a[3];\n        return Math.sqrt(x * x + y * y + z * z + w * w);\n    }\n    Vec4.norm = norm;\n    function squaredNorm(a) {\n        const x = a[0], y = a[1], z = a[2], w = a[3];\n        return x * x + y * y + z * z + w * w;\n    }\n    Vec4.squaredNorm = squaredNorm;\n    function transformMat4(out, a, m) {\n        const x = a[0], y = a[1], z = a[2], w = a[3];\n        out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n        out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n        out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n        out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n        return out;\n    }\n    Vec4.transformMat4 = transformMat4;\n    function dot(a, b) {\n        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n    }\n    Vec4.dot = dot;\n    /**\n     * Returns the inverse of the components of a Vec4\n     */\n    function inverse(out, a) {\n        out[0] = 1.0 / a[0];\n        out[1] = 1.0 / a[1];\n        out[2] = 1.0 / a[2];\n        out[3] = 1.0 / a[3];\n        return out;\n    }\n    Vec4.inverse = inverse;\n    /**\n     * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n     */\n    function exactEquals(a, b) {\n        return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n    }\n    Vec4.exactEquals = exactEquals;\n    /**\n     * Returns whether or not the vectors have approximately the same elements in the same position.\n     */\n    function equals(a, b) {\n        const a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n        const b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n        return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n            Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n            Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\n            Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)));\n    }\n    Vec4.equals = equals;\n    function toString(a, precision) {\n        return `[${a[0].toPrecision(precision)} ${a[1].toPrecision(precision)} ${a[2].toPrecision(precision)}  ${a[3].toPrecision(precision)}]`;\n    }\n    Vec4.toString = toString;\n})(Vec4 || (Vec4 = {}));\nexport { Vec4 };\n","/**\n * Copyright (c) 2018-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport function ObjectKeys(o) {\n    return Object.keys(o);\n}\n;\nexport function assertUnreachable(x) {\n    throw new Error('unreachable');\n}\nexport function isPromiseLike(x) {\n    return typeof (x === null || x === void 0 ? void 0 : x.then) === 'function';\n}\n","/**\n * Copyright (c) 2017-2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Vec3 } from './vec3';\nimport { EPSILON } from './common';\nimport { assertUnreachable } from '../../../mol-util/type-helpers';\nfunction Quat() {\n    return Quat.zero();\n}\n(function (Quat) {\n    function zero() {\n        // force double backing array by 0.1.\n        const ret = [0.1, 0, 0, 0];\n        ret[0] = 0.0;\n        return ret;\n    }\n    Quat.zero = zero;\n    function identity() {\n        const out = zero();\n        out[3] = 1;\n        return out;\n    }\n    Quat.identity = identity;\n    function setIdentity(out) {\n        out[0] = 0;\n        out[1] = 0;\n        out[2] = 0;\n        out[3] = 1;\n    }\n    Quat.setIdentity = setIdentity;\n    function hasNaN(q) {\n        return isNaN(q[0]) || isNaN(q[1]) || isNaN(q[2]) || isNaN(q[3]);\n    }\n    Quat.hasNaN = hasNaN;\n    function create(x, y, z, w) {\n        const out = identity();\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        out[3] = w;\n        return out;\n    }\n    Quat.create = create;\n    function setAxisAngle(out, axis, rad) {\n        rad = rad * 0.5;\n        const s = Math.sin(rad);\n        out[0] = s * axis[0];\n        out[1] = s * axis[1];\n        out[2] = s * axis[2];\n        out[3] = Math.cos(rad);\n        return out;\n    }\n    Quat.setAxisAngle = setAxisAngle;\n    /**\n     * Gets the rotation axis and angle for a given\n     *  quaternion. If a quaternion is created with\n     *  setAxisAngle, this method will return the same\n     *  values as providied in the original parameter list\n     *  OR functionally equivalent values.\n     * Example: The quaternion formed by axis [0, 0, 1] and\n     *  angle -90 is the same as the quaternion formed by\n     *  [0, 0, 1] and 270. This method favors the latter.\n     */\n    function getAxisAngle(out_axis, q) {\n        const rad = Math.acos(q[3]) * 2.0;\n        const s = Math.sin(rad / 2.0);\n        if (s !== 0.0) {\n            out_axis[0] = q[0] / s;\n            out_axis[1] = q[1] / s;\n            out_axis[2] = q[2] / s;\n        }\n        else {\n            // If s is zero, return any axis (no rotation - axis does not matter)\n            out_axis[0] = 1;\n            out_axis[1] = 0;\n            out_axis[2] = 0;\n        }\n        return rad;\n    }\n    Quat.getAxisAngle = getAxisAngle;\n    function multiply(out, a, b) {\n        const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n        const bx = b[0], by = b[1], bz = b[2], bw = b[3];\n        out[0] = ax * bw + aw * bx + ay * bz - az * by;\n        out[1] = ay * bw + aw * by + az * bx - ax * bz;\n        out[2] = az * bw + aw * bz + ax * by - ay * bx;\n        out[3] = aw * bw - ax * bx - ay * by - az * bz;\n        return out;\n    }\n    Quat.multiply = multiply;\n    function rotateX(out, a, rad) {\n        rad *= 0.5;\n        const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n        const bx = Math.sin(rad), bw = Math.cos(rad);\n        out[0] = ax * bw + aw * bx;\n        out[1] = ay * bw + az * bx;\n        out[2] = az * bw - ay * bx;\n        out[3] = aw * bw - ax * bx;\n        return out;\n    }\n    Quat.rotateX = rotateX;\n    function rotateY(out, a, rad) {\n        rad *= 0.5;\n        const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n        const by = Math.sin(rad), bw = Math.cos(rad);\n        out[0] = ax * bw - az * by;\n        out[1] = ay * bw + aw * by;\n        out[2] = az * bw + ax * by;\n        out[3] = aw * bw - ay * by;\n        return out;\n    }\n    Quat.rotateY = rotateY;\n    function rotateZ(out, a, rad) {\n        rad *= 0.5;\n        const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n        const bz = Math.sin(rad), bw = Math.cos(rad);\n        out[0] = ax * bw + ay * bz;\n        out[1] = ay * bw - ax * bz;\n        out[2] = az * bw + aw * bz;\n        out[3] = aw * bw - az * bz;\n        return out;\n    }\n    Quat.rotateZ = rotateZ;\n    /**\n     * Calculates the W component of a quat from the X, Y, and Z components.\n     * Assumes that quaternion is 1 unit in length.\n     * Any existing W component will be ignored.\n     */\n    function calculateW(out, a) {\n        const x = a[0], y = a[1], z = a[2];\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\n        return out;\n    }\n    Quat.calculateW = calculateW;\n    /**\n     * Performs a spherical linear interpolation between two quat\n     */\n    function slerp(out, a, b, t) {\n        // benchmarks:\n        //    http://jsperf.com/quaternion-slerp-implementations\n        const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n        let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n        let omega, cosom, sinom, scale0, scale1;\n        // calc cosine\n        cosom = ax * bx + ay * by + az * bz + aw * bw;\n        // adjust signs (if necessary)\n        if (cosom < 0.0) {\n            cosom = -cosom;\n            bx = -bx;\n            by = -by;\n            bz = -bz;\n            bw = -bw;\n        }\n        // calculate coefficients\n        if ((1.0 - cosom) > 0.000001) {\n            // standard case (slerp)\n            omega = Math.acos(cosom);\n            sinom = Math.sin(omega);\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\n            scale1 = Math.sin(t * omega) / sinom;\n        }\n        else {\n            // \"from\" and \"to\" quaternions are very close\n            //  ... so we can do a linear interpolation\n            scale0 = 1.0 - t;\n            scale1 = t;\n        }\n        // calculate final values\n        out[0] = scale0 * ax + scale1 * bx;\n        out[1] = scale0 * ay + scale1 * by;\n        out[2] = scale0 * az + scale1 * bz;\n        out[3] = scale0 * aw + scale1 * bw;\n        return out;\n    }\n    Quat.slerp = slerp;\n    function invert(out, a) {\n        const a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n        const dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n        const invDot = dot ? 1.0 / dot : 0;\n        // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n        out[0] = -a0 * invDot;\n        out[1] = -a1 * invDot;\n        out[2] = -a2 * invDot;\n        out[3] = a3 * invDot;\n        return out;\n    }\n    Quat.invert = invert;\n    /**\n     * Calculates the conjugate of a quat\n     * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\n     */\n    function conjugate(out, a) {\n        out[0] = -a[0];\n        out[1] = -a[1];\n        out[2] = -a[2];\n        out[3] = a[3];\n        return out;\n    }\n    Quat.conjugate = conjugate;\n    function dot(a, b) {\n        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n    }\n    Quat.dot = dot;\n    /**\n     * Creates a quaternion from the given 3x3 rotation matrix.\n     *\n     * NOTE: The resultant quaternion is not normalized, so you should be sure\n     * to renormalize the quaternion yourself where necessary.\n     */\n    function fromMat3(out, m) {\n        // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n        // article \"Quaternion Calculus and Fast Animation\".\n        const fTrace = m[0] + m[4] + m[8];\n        let fRoot;\n        if (fTrace > 0.0) {\n            // |w| > 1/2, may as well choose w > 1/2\n            fRoot = Math.sqrt(fTrace + 1.0); // 2w\n            out[3] = 0.5 * fRoot;\n            fRoot = 0.5 / fRoot; // 1/(4w)\n            out[0] = (m[5] - m[7]) * fRoot;\n            out[1] = (m[6] - m[2]) * fRoot;\n            out[2] = (m[1] - m[3]) * fRoot;\n        }\n        else {\n            // |w| <= 1/2\n            let i = 0;\n            if (m[4] > m[0])\n                i = 1;\n            if (m[8] > m[i * 3 + i])\n                i = 2;\n            const j = (i + 1) % 3;\n            const k = (i + 2) % 3;\n            fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\n            out[i] = 0.5 * fRoot;\n            fRoot = 0.5 / fRoot;\n            out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\n            out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\n            out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\n        }\n        return out;\n    }\n    Quat.fromMat3 = fromMat3;\n    function fromEuler(out, euler, order) {\n        const [x, y, z] = euler;\n        // http://www.mathworks.com/matlabcentral/fileexchange/20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/content/SpinCalc.m\n        const c1 = Math.cos(x / 2);\n        const c2 = Math.cos(y / 2);\n        const c3 = Math.cos(z / 2);\n        const s1 = Math.sin(x / 2);\n        const s2 = Math.sin(y / 2);\n        const s3 = Math.sin(z / 2);\n        switch (order) {\n            case 'XYZ':\n                out[0] = s1 * c2 * c3 + c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 - s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 + s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n            case 'YXZ':\n                out[0] = s1 * c2 * c3 + c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 - s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 - s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n            case 'ZXY':\n                out[0] = s1 * c2 * c3 - c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 + s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 + s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n            case 'ZYX':\n                out[0] = s1 * c2 * c3 - c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 + s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 - s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n            case 'YZX':\n                out[0] = s1 * c2 * c3 + c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 + s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 - s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n            case 'XZY':\n                out[0] = s1 * c2 * c3 - c1 * s2 * s3;\n                out[1] = c1 * s2 * c3 - s1 * c2 * s3;\n                out[2] = c1 * c2 * s3 + s1 * s2 * c3;\n                out[3] = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n            default:\n                assertUnreachable(order);\n        }\n        return out;\n    }\n    Quat.fromEuler = fromEuler;\n    const fromUnitVec3Temp = [0, 0, 0];\n    /** Quaternion from two normalized unit vectors. */\n    function fromUnitVec3(out, a, b) {\n        // assumes a and b are normalized\n        let r = Vec3.dot(a, b) + 1;\n        if (r < EPSILON) {\n            // If u and v are exactly opposite, rotate 180 degrees\n            // around an arbitrary orthogonal axis. Axis normalisation\n            // can happen later, when we normalise the quaternion.\n            r = 0;\n            if (Math.abs(a[0]) > Math.abs(a[2])) {\n                Vec3.set(fromUnitVec3Temp, -a[1], a[0], 0);\n            }\n            else {\n                Vec3.set(fromUnitVec3Temp, 0, -a[2], a[1]);\n            }\n        }\n        else {\n            // Otherwise, build quaternion the standard way.\n            Vec3.cross(fromUnitVec3Temp, a, b);\n        }\n        out[0] = fromUnitVec3Temp[0];\n        out[1] = fromUnitVec3Temp[1];\n        out[2] = fromUnitVec3Temp[2];\n        out[3] = r;\n        normalize(out, out);\n        return out;\n    }\n    Quat.fromUnitVec3 = fromUnitVec3;\n    function clone(a) {\n        const out = zero();\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        return out;\n    }\n    Quat.clone = clone;\n    function toArray(a, out, offset) {\n        out[offset + 0] = a[0];\n        out[offset + 1] = a[1];\n        out[offset + 2] = a[2];\n        out[offset + 3] = a[3];\n        return out;\n    }\n    Quat.toArray = toArray;\n    function fromArray(a, array, offset) {\n        a[0] = array[offset + 0];\n        a[1] = array[offset + 1];\n        a[2] = array[offset + 2];\n        a[3] = array[offset + 3];\n        return a;\n    }\n    Quat.fromArray = fromArray;\n    function copy(out, a) {\n        out[0] = a[0];\n        out[1] = a[1];\n        out[2] = a[2];\n        out[3] = a[3];\n        return out;\n    }\n    Quat.copy = copy;\n    function set(out, x, y, z, w) {\n        out[0] = x;\n        out[1] = y;\n        out[2] = z;\n        out[3] = w;\n        return out;\n    }\n    Quat.set = set;\n    /**\n     * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\n     */\n    function exactEquals(a, b) {\n        return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n    }\n    Quat.exactEquals = exactEquals;\n    /**\n     * Returns whether or not the quaternions have approximately the same elements in the same position.\n     */\n    function equals(a, b) {\n        const a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n        const b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n        return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n            Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n            Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&\n            Math.abs(a3 - b3) <= EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)));\n    }\n    Quat.equals = equals;\n    function add(out, a, b) {\n        out[0] = a[0] + b[0];\n        out[1] = a[1] + b[1];\n        out[2] = a[2] + b[2];\n        out[3] = a[3] + b[3];\n        return out;\n    }\n    Quat.add = add;\n    function normalize(out, a) {\n        const x = a[0];\n        const y = a[1];\n        const z = a[2];\n        const w = a[3];\n        let len = x * x + y * y + z * z + w * w;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out[0] = x * len;\n            out[1] = y * len;\n            out[2] = z * len;\n            out[3] = w * len;\n        }\n        return out;\n    }\n    Quat.normalize = normalize;\n    /**\n     * Sets a quaternion to represent the shortest rotation from one\n     * vector to another.\n     *\n     * Both vectors are assumed to be unit length.\n     */\n    const rotTmpVec3 = [0, 0, 0];\n    const rotTmpVec3UnitX = [1, 0, 0];\n    const rotTmpVec3UnitY = [0, 1, 0];\n    function rotationTo(out, a, b) {\n        const dot = Vec3.dot(a, b);\n        if (dot < -0.999999) {\n            Vec3.cross(rotTmpVec3, rotTmpVec3UnitX, a);\n            if (Vec3.magnitude(rotTmpVec3) < 0.000001)\n                Vec3.cross(rotTmpVec3, rotTmpVec3UnitY, a);\n            Vec3.normalize(rotTmpVec3, rotTmpVec3);\n            setAxisAngle(out, rotTmpVec3, Math.PI);\n            return out;\n        }\n        else if (dot > 0.999999) {\n            out[0] = 0;\n            out[1] = 0;\n            out[2] = 0;\n            out[3] = 1;\n            return out;\n        }\n        else {\n            Vec3.cross(rotTmpVec3, a, b);\n            out[0] = rotTmpVec3[0];\n            out[1] = rotTmpVec3[1];\n            out[2] = rotTmpVec3[2];\n            out[3] = 1 + dot;\n            return normalize(out, out);\n        }\n    }\n    Quat.rotationTo = rotationTo;\n    /**\n     * Performs a spherical linear interpolation with two control points\n     */\n    const sqlerpTemp1 = zero();\n    const sqlerpTemp2 = zero();\n    function sqlerp(out, a, b, c, d, t) {\n        slerp(sqlerpTemp1, a, d, t);\n        slerp(sqlerpTemp2, b, c, t);\n        slerp(out, sqlerpTemp1, sqlerpTemp2, 2 * t * (1 - t));\n        return out;\n    }\n    Quat.sqlerp = sqlerp;\n    /**\n     * Sets the specified quaternion with values corresponding to the given\n     * axes. Each axis is a vec3 and is expected to be unit length and\n     * perpendicular to all other specified axes.\n     */\n    const axesTmpMat = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    function setAxes(out, view, right, up) {\n        axesTmpMat[0] = right[0];\n        axesTmpMat[3] = right[1];\n        axesTmpMat[6] = right[2];\n        axesTmpMat[1] = up[0];\n        axesTmpMat[4] = up[1];\n        axesTmpMat[7] = up[2];\n        axesTmpMat[2] = -view[0];\n        axesTmpMat[5] = -view[1];\n        axesTmpMat[8] = -view[2];\n        return normalize(out, fromMat3(out, axesTmpMat));\n    }\n    Quat.setAxes = setAxes;\n    function toString(a, precision) {\n        return `[${a[0].toPrecision(precision)} ${a[1].toPrecision(precision)} ${a[2].toPrecision(precision)}  ${a[3].toPrecision(precision)}]`;\n    }\n    Quat.toString = toString;\n    Quat.Identity = identity();\n})(Quat || (Quat = {}));\nexport { Quat };\n","import { Mat3 } from './3d/mat3';\n/**\n * Copyright (c) 2017-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Mat4 } from './3d/mat4';\nexport var Tensor;\n(function (Tensor) {\n    function Layout(dimensions, axisOrderSlowToFast, ctor) {\n        // need to reverse the axis order for better access.\n        const axisOrderFastToSlow = [];\n        for (let i = 0; i < axisOrderSlowToFast.length; i++)\n            axisOrderFastToSlow[i] = axisOrderSlowToFast[axisOrderSlowToFast.length - i - 1];\n        const accessDimensions = [1];\n        for (let i = 1; i < dimensions.length; i++)\n            accessDimensions[i] = dimensions[axisOrderFastToSlow[i - 1]];\n        return { dimensions, axisOrderFastToSlow, axisOrderSlowToFast, accessDimensions, defaultCtor: ctor || Float64Array };\n    }\n    function create(space, data) { return { space, data }; }\n    Tensor.create = create;\n    function Space(dimensions, axisOrderSlowToFast, ctor) {\n        const layout = Layout(dimensions, axisOrderSlowToFast, ctor);\n        const { get, set, add, dataOffset, getCoords } = accessors(layout);\n        return { rank: dimensions.length, dimensions, axisOrderSlowToFast, create: creator(layout), get, set, add, dataOffset, getCoords };\n    }\n    Tensor.Space = Space;\n    function Data1(values) { return values; }\n    Tensor.Data1 = Data1;\n    function Vector(d, ctor) { return Space([d], [0], ctor); }\n    Tensor.Vector = Vector;\n    function ColumnMajorMatrix(rows, cols, ctor) { return Space([rows, cols], [1, 0], ctor); }\n    Tensor.ColumnMajorMatrix = ColumnMajorMatrix;\n    function RowMajorMatrix(rows, cols, ctor) { return Space([rows, cols], [0, 1], ctor); }\n    Tensor.RowMajorMatrix = RowMajorMatrix;\n    function toMat4(out, space, data) {\n        if (space.rank !== 2)\n            throw new Error('Invalid tensor rank');\n        const d0 = Math.min(4, space.dimensions[0]), d1 = Math.min(4, space.dimensions[1]);\n        for (let i = 0; i < d0; i++) {\n            for (let j = 0; j < d1; j++)\n                Mat4.setValue(out, i, j, space.get(data, i, j));\n        }\n        return out;\n    }\n    Tensor.toMat4 = toMat4;\n    function toMat3(out, space, data) {\n        if (space.rank !== 2)\n            throw new Error('Invalid tensor rank');\n        const d0 = Math.min(3, space.dimensions[0]), d1 = Math.min(3, space.dimensions[1]);\n        for (let i = 0; i < d0; i++) {\n            for (let j = 0; j < d1; j++)\n                Mat3.setValue(out, i, j, space.get(data, i, j));\n        }\n        return out;\n    }\n    Tensor.toMat3 = toMat3;\n    function toVec3(out, space, data) {\n        if (space.rank !== 1)\n            throw new Error('Invalid tensor rank');\n        const d0 = Math.min(3, space.dimensions[0]);\n        for (let i = 0; i < d0; i++)\n            out[i] = data[i];\n        return out;\n    }\n    Tensor.toVec3 = toVec3;\n    function toVec4(out, space, data) {\n        if (space.rank !== 1)\n            throw new Error('Invalid tensor rank');\n        const d0 = Math.min(4, space.dimensions[0]);\n        for (let i = 0; i < d0; i++)\n            out[i] = data[i];\n        return out;\n    }\n    Tensor.toVec4 = toVec4;\n    function areEqualExact(a, b) {\n        const len = a.length;\n        if (len !== b.length)\n            return false;\n        for (let i = 0; i < len; i++)\n            if (a[i] !== b[i])\n                return false;\n        return true;\n    }\n    Tensor.areEqualExact = areEqualExact;\n    function accessors(layout) {\n        const { dimensions, axisOrderFastToSlow: ao } = layout;\n        switch (dimensions.length) {\n            case 1: return {\n                get: (t, d) => t[d],\n                set: (t, d, x) => t[d] = x,\n                add: (t, d, x) => t[d] += x,\n                dataOffset: (d) => d,\n                getCoords: (o, c) => {\n                    c[0] = o;\n                    return c;\n                }\n            };\n            case 2: {\n                // column major\n                if (ao[0] === 0 && ao[1] === 1) {\n                    const rows = dimensions[0];\n                    return {\n                        get: (t, i, j) => t[j * rows + i],\n                        set: (t, i, j, x) => t[j * rows + i] = x,\n                        add: (t, i, j, x) => t[j * rows + i] += x,\n                        dataOffset: (i, j) => j * rows + i,\n                        getCoords: (o, c) => {\n                            c[0] = o % rows;\n                            c[1] = Math.floor(o / rows);\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 1 && ao[1] === 0) {\n                    const cols = dimensions[1];\n                    return {\n                        get: (t, i, j) => t[i * cols + j],\n                        set: (t, i, j, x) => t[i * cols + j] = x,\n                        add: (t, i, j, x) => t[i * cols + j] += x,\n                        dataOffset: (i, j) => i * cols + j,\n                        getCoords: (o, c) => {\n                            c[0] = Math.floor(o / cols);\n                            c[1] = o % cols;\n                            return c;\n                        }\n                    };\n                }\n                throw new Error('bad axis order');\n            }\n            case 3: {\n                if (ao[0] === 0 && ao[1] === 1 && ao[2] === 2) { // 012 ijk\n                    const u = dimensions[0], v = dimensions[1], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[i + j * u + k * uv],\n                        set: (t, i, j, k, x) => t[i + j * u + k * uv] = x,\n                        add: (t, i, j, k, x) => t[i + j * u + k * uv] += x,\n                        dataOffset: (i, j, k) => i + j * u + k * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = o % u;\n                            c[1] = p % v;\n                            c[2] = Math.floor(p / v);\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 0 && ao[1] === 2 && ao[2] === 1) { // 021 ikj\n                    const u = dimensions[0], v = dimensions[2], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[i + k * u + j * uv],\n                        set: (t, i, j, k, x) => t[i + k * u + j * uv] = x,\n                        add: (t, i, j, k, x) => t[i + k * u + j * uv] += x,\n                        dataOffset: (i, j, k) => i + k * u + j * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = o % u;\n                            c[1] = Math.floor(p / v);\n                            c[2] = p % v;\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 1 && ao[1] === 0 && ao[2] === 2) { // 102 jik\n                    const u = dimensions[1], v = dimensions[0], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[j + i * u + k * uv],\n                        set: (t, i, j, k, x) => t[j + i * u + k * uv] = x,\n                        add: (t, i, j, k, x) => t[j + i * u + k * uv] += x,\n                        dataOffset: (i, j, k) => j + i * u + k * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = p % v;\n                            c[1] = o % u;\n                            c[2] = Math.floor(p / v);\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 1 && ao[1] === 2 && ao[2] === 0) { // 120 jki\n                    const u = dimensions[1], v = dimensions[2], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[j + k * u + i * uv],\n                        set: (t, i, j, k, x) => t[j + k * u + i * uv] = x,\n                        add: (t, i, j, k, x) => t[j + k * u + i * uv] += x,\n                        dataOffset: (i, j, k) => j + k * u + i * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = Math.floor(p / v);\n                            c[1] = o % u;\n                            c[2] = p % v;\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 2 && ao[1] === 0 && ao[2] === 1) { // 201 kij\n                    const u = dimensions[2], v = dimensions[0], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[k + i * u + j * uv],\n                        set: (t, i, j, k, x) => t[k + i * u + j * uv] = x,\n                        add: (t, i, j, k, x) => t[k + i * u + j * uv] += x,\n                        dataOffset: (i, j, k) => k + i * u + j * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = p % v;\n                            c[1] = Math.floor(p / v);\n                            c[2] = o % u;\n                            return c;\n                        }\n                    };\n                }\n                if (ao[0] === 2 && ao[1] === 1 && ao[2] === 0) { // 210 kji\n                    const u = dimensions[2], v = dimensions[1], uv = u * v;\n                    return {\n                        get: (t, i, j, k) => t[k + j * u + i * uv],\n                        set: (t, i, j, k, x) => t[k + j * u + i * uv] = x,\n                        add: (t, i, j, k, x) => t[k + j * u + i * uv] += x,\n                        dataOffset: (i, j, k) => k + j * u + i * uv,\n                        getCoords: (o, c) => {\n                            const p = Math.floor(o / u);\n                            c[0] = Math.floor(p / v);\n                            c[1] = p % v;\n                            c[2] = o % u;\n                            return c;\n                        }\n                    };\n                }\n                throw new Error('bad axis order');\n            }\n            default: return {\n                get: (t, ...c) => t[dataOffset(layout, c)],\n                set: (t, ...c) => t[dataOffset(layout, c)] = c[c.length - 1],\n                add: (t, ...c) => t[dataOffset(layout, c)] += c[c.length - 1],\n                dataOffset: (...c) => dataOffset(layout, c),\n                getCoords: (o, c) => getCoords(layout, o, c),\n            };\n        }\n    }\n    function creator(layout) {\n        const { dimensions: ds } = layout;\n        let size = 1;\n        for (let i = 0, _i = ds.length; i < _i; i++)\n            size *= ds[i];\n        return ctor => new (ctor || layout.defaultCtor)(size);\n    }\n    function dataOffset(layout, coord) {\n        const { accessDimensions: acc, axisOrderFastToSlow: ao } = layout;\n        const d = acc.length - 1;\n        let o = acc[d] * coord[ao[d]];\n        for (let i = d - 1; i >= 0; i--) {\n            o = (o + coord[ao[i]]) * acc[i];\n        }\n        return o;\n    }\n    function getCoords(layout, o, coords) {\n        const { dimensions: dim, axisOrderFastToSlow: ao } = layout;\n        const d = dim.length;\n        let c = o;\n        for (let i = 0; i < d; i++) {\n            const d = dim[ao[i]];\n            coords[ao[i]] = c % d;\n            c = Math.floor(c / d);\n        }\n        coords[ao[d + 1]] = c;\n        return coords;\n    }\n    // Convers \"slow to fast\" axis order to \"fast to slow\" and vice versa.\n    function invertAxisOrder(v) {\n        const ret = [];\n        for (let i = 0; i < v.length; i++) {\n            ret[i] = v[v.length - i - 1];\n        }\n        return ret;\n    }\n    Tensor.invertAxisOrder = invertAxisOrder;\n    function reorder(xs, indices) {\n        const ret = [];\n        for (let i = 0; i < xs.length; i++)\n            ret[i] = xs[indices[i]];\n        return ret;\n    }\n    function convertToCanonicalAxisIndicesFastToSlow(order) {\n        const indices = new Int32Array(order.length);\n        for (let i = 0; i < order.length; i++)\n            indices[order[i]] = i;\n        return (xs) => reorder(xs, indices);\n    }\n    Tensor.convertToCanonicalAxisIndicesFastToSlow = convertToCanonicalAxisIndicesFastToSlow;\n    function convertToCanonicalAxisIndicesSlowToFast(order) {\n        const indices = new Int32Array(order.length);\n        for (let i = 0; i < order.length; i++)\n            indices[order[order.length - i - 1]] = i;\n        return (xs) => reorder(xs, indices);\n    }\n    Tensor.convertToCanonicalAxisIndicesSlowToFast = convertToCanonicalAxisIndicesSlowToFast;\n})(Tensor || (Tensor = {}));\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport * as ColumnHelpers from './column-helpers';\nimport { Tensor as Tensors } from '../../mol-math/linear-algebra';\nimport { parseInt as fastParseInt, parseFloat as fastParseFloat } from '../../mol-io/reader/common/text/number-parser';\nvar Column;\n(function (Column) {\n    let Schema;\n    (function (Schema) {\n        // T also serves as a default value for undefined columns\n        Schema.str = { '@type': 'str', T: '', valueType: 'str' };\n        Schema.ustr = { '@type': 'str', T: '', valueType: 'str', transform: 'uppercase' };\n        Schema.lstr = { '@type': 'str', T: '', valueType: 'str', transform: 'lowercase' };\n        Schema.int = { '@type': 'int', T: 0, valueType: 'int' };\n        Schema.coord = { '@type': 'coord', T: 0, valueType: 'float' };\n        Schema.float = { '@type': 'float', T: 0, valueType: 'float' };\n        function Str(options) { var _a; return { '@type': 'str', T: (_a = options === null || options === void 0 ? void 0 : options.defaultValue) !== null && _a !== void 0 ? _a : '', transform: options === null || options === void 0 ? void 0 : options.transform, valueType: 'str' }; }\n        Schema.Str = Str;\n        ;\n        function Int(defaultValue = 0) { return { '@type': 'int', T: defaultValue, valueType: 'int' }; }\n        Schema.Int = Int;\n        ;\n        function Float(defaultValue = 0) { return { '@type': 'float', T: defaultValue, valueType: 'float' }; }\n        Schema.Float = Float;\n        ;\n        function Tensor(space, baseType = Schema.float) { return { '@type': 'tensor', T: space.create(), space, valueType: 'tensor', baseType }; }\n        Schema.Tensor = Tensor;\n        function Vector(dim, baseType = Schema.float) { return Tensor(Tensors.Vector(dim, baseType['@type'] === 'int' ? Int32Array : Float64Array), baseType); }\n        Schema.Vector = Vector;\n        function Matrix(rows, cols, baseType = Schema.float) { return Tensor(Tensors.ColumnMajorMatrix(rows, cols, baseType['@type'] === 'int' ? Int32Array : Float64Array), baseType); }\n        Schema.Matrix = Matrix;\n        function Aliased(t) {\n            return t;\n        }\n        Schema.Aliased = Aliased;\n        function List(separator, itemParse, defaultValue = []) {\n            return { '@type': 'list', T: defaultValue, separator, itemParse, valueType: 'list' };\n        }\n        Schema.List = List;\n    })(Schema = Column.Schema || (Column.Schema = {}));\n    function is(v) {\n        return !!v && !!v.schema && !!v.value;\n    }\n    Column.is = is;\n    Column.ValueKind = {\n        /** Defined value (= 0) */\n        Present: 0 /* ValueKinds.Present */,\n        /** Expressed in CIF as `.` (= 1) */\n        NotPresent: 1 /* ValueKinds.NotPresent */,\n        /** Expressed in CIF as `?` (= 2) */\n        Unknown: 2 /* ValueKinds.Unknown */\n    };\n    function Undefined(rowCount, schema) {\n        return constColumn(schema['T'], rowCount, schema, 1 /* ValueKinds.NotPresent */);\n    }\n    Column.Undefined = Undefined;\n    function ofConst(v, rowCount, type) {\n        return constColumn(v, rowCount, type, 0 /* ValueKinds.Present */);\n    }\n    Column.ofConst = ofConst;\n    function ofLambda(spec) {\n        return lambdaColumn(spec);\n    }\n    Column.ofLambda = ofLambda;\n    /** values [min, max] (i.e. include both values) */\n    function range(min, max) {\n        return ofLambda({\n            value: i => i + min,\n            rowCount: Math.max(max - min + 1, 0),\n            schema: Schema.int\n        });\n    }\n    Column.range = range;\n    function ofArray(spec) {\n        return arrayColumn(spec);\n    }\n    Column.ofArray = ofArray;\n    function ofIntArray(array) {\n        return arrayColumn({ array, schema: Schema.int });\n    }\n    Column.ofIntArray = ofIntArray;\n    function ofFloatArray(array) {\n        return arrayColumn({ array, schema: Schema.float });\n    }\n    Column.ofFloatArray = ofFloatArray;\n    function ofStringArray(array) {\n        return arrayColumn({ array, schema: Schema.str });\n    }\n    Column.ofStringArray = ofStringArray;\n    function ofStringAliasArray(array) {\n        return arrayColumn({ array, schema: Schema.Aliased(Schema.str) });\n    }\n    Column.ofStringAliasArray = ofStringAliasArray;\n    function ofStringListArray(array, separator = ',') {\n        return arrayColumn({ array, schema: Schema.List(separator, x => x) });\n    }\n    Column.ofStringListArray = ofStringListArray;\n    function ofIntTokens(tokens) {\n        const { count, data, indices } = tokens;\n        return lambdaColumn({\n            value: (row) => fastParseInt(data, indices[2 * row], indices[2 * row + 1]) || 0,\n            rowCount: count,\n            schema: Schema.int,\n        });\n    }\n    Column.ofIntTokens = ofIntTokens;\n    function ofFloatTokens(tokens) {\n        const { count, data, indices } = tokens;\n        return lambdaColumn({\n            value: (row) => fastParseFloat(data, indices[2 * row], indices[2 * row + 1]) || 0,\n            rowCount: count,\n            schema: Schema.float,\n        });\n    }\n    Column.ofFloatTokens = ofFloatTokens;\n    function ofStringTokens(tokens) {\n        const { count, data, indices } = tokens;\n        return lambdaColumn({\n            value: (row) => {\n                const ret = data.substring(indices[2 * row], indices[2 * row + 1]);\n                if (ret === '.' || ret === '?')\n                    return '';\n                return ret;\n            },\n            rowCount: count,\n            schema: Schema.str,\n        });\n    }\n    Column.ofStringTokens = ofStringTokens;\n    function window(column, start, end) {\n        return windowColumn(column, start, end);\n    }\n    Column.window = window;\n    function view(column, indices, checkIndentity = true) {\n        return columnView(column, indices, checkIndentity);\n    }\n    Column.view = view;\n    /** A map of the 1st occurence of each value. */\n    function createFirstIndexMap(column) {\n        return createFirstIndexMapOfColumn(column);\n    }\n    Column.createFirstIndexMap = createFirstIndexMap;\n    function createIndexer(column) {\n        return createIndexerOfColumn(column);\n    }\n    Column.createIndexer = createIndexer;\n    function mapToArray(column, f, ctor) {\n        return mapToArrayImpl(column, f, ctor || Array);\n    }\n    Column.mapToArray = mapToArray;\n    function areEqual(a, b) {\n        return areColumnsEqual(a, b);\n    }\n    Column.areEqual = areEqual;\n    function indicesOf(c, test) {\n        return columnIndicesOf(c, test);\n    }\n    Column.indicesOf = indicesOf;\n    /** Makes the column backed by an array. Useful for columns that are accessed often. */\n    function asArrayColumn(c, array) {\n        if (c.__array)\n            return c;\n        if (!c.isDefined)\n            return Undefined(c.rowCount, c.schema);\n        return arrayColumn({ array: c.toArray({ array }), schema: c.schema, valueKind: c.valueKind });\n    }\n    Column.asArrayColumn = asArrayColumn;\n    function copyToArray(c, array, offset = 0) {\n        if (!c.isDefined)\n            return;\n        const cArray = c.__array;\n        if (cArray) {\n            for (let i = 0, _i = cArray.length; i < _i; i++)\n                array[offset + i] = cArray[i];\n        }\n        else {\n            for (let i = 0, _i = c.rowCount; i < _i; i++)\n                array[offset + i] = c.value(i);\n        }\n    }\n    Column.copyToArray = copyToArray;\n    function isIdentity(c) {\n        for (let i = 0, _i = c.rowCount; i < _i; i++) {\n            if (i !== c.value(i))\n                return false;\n        }\n        return true;\n    }\n    Column.isIdentity = isIdentity;\n})(Column || (Column = {}));\nexport { Column };\nfunction createFirstIndexMapOfColumn(c) {\n    const map = new Map();\n    for (let i = 0, _i = c.rowCount; i < _i; i++) {\n        const v = c.value(i);\n        if (!map.has(v))\n            map.set(c.value(i), i);\n    }\n    return map;\n}\nfunction createIndexerOfColumn(c) {\n    const map = new Map();\n    for (let i = 0, _i = c.rowCount; i < _i; i++) {\n        const v = c.value(i);\n        if (!map.has(v))\n            map.set(c.value(i), i);\n    }\n    return v => map.has(v) ? map.get(v) : -1;\n}\nfunction constColumn(v, rowCount, schema, valueKind) {\n    const value = row => v;\n    return {\n        schema: schema,\n        __array: void 0,\n        isDefined: valueKind === 0 /* Column.ValueKinds.Present */,\n        rowCount,\n        value,\n        valueKind: row => valueKind,\n        toArray: params => {\n            const { array } = ColumnHelpers.createArray(rowCount, params);\n            for (let i = 0, _i = array.length; i < _i; i++)\n                array[i] = v;\n            return array;\n        },\n        areValuesEqual: (rowA, rowB) => true\n    };\n}\nfunction lambdaColumn({ value, valueKind, areValuesEqual, rowCount, schema }) {\n    return {\n        schema: schema,\n        __array: void 0,\n        isDefined: true,\n        rowCount,\n        value,\n        valueKind: valueKind ? valueKind : row => 0 /* Column.ValueKinds.Present */,\n        toArray: params => {\n            const { array, start } = ColumnHelpers.createArray(rowCount, params);\n            for (let i = 0, _i = array.length; i < _i; i++)\n                array[i] = value(i + start);\n            return array;\n        },\n        areValuesEqual: areValuesEqual ? areValuesEqual : (rowA, rowB) => value(rowA) === value(rowB)\n    };\n}\nfunction arrayColumn({ array, schema, valueKind }) {\n    const rowCount = array.length;\n    const defaultValue = schema.T;\n    const value = schema.valueType === 'str'\n        ? schema.transform === 'lowercase'\n            ? row => { const v = array[row]; return typeof v === 'string' ? v.toLowerCase() : `${v !== null && v !== void 0 ? v : defaultValue}`.toLowerCase(); }\n            : schema.transform === 'uppercase'\n                ? row => { const v = array[row]; return typeof v === 'string' ? v.toUpperCase() : `${v !== null && v !== void 0 ? v : defaultValue}`.toUpperCase(); }\n                : row => { const v = array[row]; return typeof v === 'string' ? v : `${v !== null && v !== void 0 ? v : defaultValue}`; }\n        : row => array[row];\n    const isTyped = ColumnHelpers.isTypedArray(array);\n    return {\n        schema: schema,\n        __array: array,\n        isDefined: true,\n        rowCount,\n        value,\n        valueKind: valueKind ? valueKind : row => 0 /* Column.ValueKinds.Present */,\n        toArray: schema.valueType === 'str'\n            ? schema.transform === 'lowercase'\n                ? params => {\n                    const { start, end } = ColumnHelpers.getArrayBounds(rowCount, params);\n                    const ret = new (params && typeof params.array !== 'undefined' ? params.array : array.constructor)(end - start);\n                    for (let i = 0, _i = end - start; i < _i; i++) {\n                        const v = array[start + i];\n                        ret[i] = typeof v === 'string' ? v.toLowerCase() : `${v !== null && v !== void 0 ? v : defaultValue}`.toLowerCase();\n                    }\n                    return ret;\n                }\n                : schema.transform === 'uppercase'\n                    ? params => {\n                        const { start, end } = ColumnHelpers.getArrayBounds(rowCount, params);\n                        const ret = new (params && typeof params.array !== 'undefined' ? params.array : array.constructor)(end - start);\n                        for (let i = 0, _i = end - start; i < _i; i++) {\n                            const v = array[start + i];\n                            ret[i] = typeof v === 'string' ? v.toUpperCase() : `${v !== null && v !== void 0 ? v : defaultValue}`.toUpperCase();\n                        }\n                        return ret;\n                    }\n                    : params => {\n                        const { start, end } = ColumnHelpers.getArrayBounds(rowCount, params);\n                        const ret = new (params && typeof params.array !== 'undefined' ? params.array : array.constructor)(end - start);\n                        for (let i = 0, _i = end - start; i < _i; i++) {\n                            const v = array[start + i];\n                            ret[i] = typeof v === 'string' ? v : `${v !== null && v !== void 0 ? v : defaultValue}`;\n                        }\n                        return ret;\n                    }\n            : isTyped\n                ? params => ColumnHelpers.typedArrayWindow(array, params)\n                : params => {\n                    const { start, end } = ColumnHelpers.getArrayBounds(rowCount, params);\n                    if (start === 0 && end === array.length)\n                        return array;\n                    const ret = new (params && typeof params.array !== 'undefined' ? params.array : array.constructor)(end - start);\n                    for (let i = 0, _i = end - start; i < _i; i++)\n                        ret[i] = array[start + i];\n                    return ret;\n                },\n        areValuesEqual: (rowA, rowB) => array[rowA] === array[rowB]\n    };\n}\nfunction windowColumn(column, start, end) {\n    if (!column.isDefined)\n        return Column.Undefined(end - start, column.schema);\n    if (start === 0 && end === column.rowCount)\n        return column;\n    if (!!column.__array && ColumnHelpers.isTypedArray(column.__array))\n        return windowTyped(column, start, end);\n    return windowFull(column, start, end);\n}\nfunction windowTyped(c, start, end) {\n    const array = ColumnHelpers.typedArrayWindow(c.__array, { start, end });\n    const vk = c.valueKind;\n    return arrayColumn({ array, schema: c.schema, valueKind: row => vk(start + row) });\n}\nfunction windowFull(c, start, end) {\n    const v = c.value, vk = c.valueKind, ave = c.areValuesEqual;\n    const value = start === 0 ? v : row => v(row + start);\n    const rowCount = end - start;\n    return {\n        schema: c.schema,\n        __array: void 0,\n        isDefined: c.isDefined,\n        rowCount,\n        value,\n        valueKind: start === 0 ? vk : row => vk(row + start),\n        toArray: params => {\n            const { array } = ColumnHelpers.createArray(rowCount, params);\n            for (let i = 0, _i = array.length; i < _i; i++)\n                array[i] = v(i + start);\n            return array;\n        },\n        areValuesEqual: start === 0 ? ave : (rowA, rowB) => ave(rowA + start, rowB + start)\n    };\n}\nfunction isIdentity(map, rowCount) {\n    if (map.length !== rowCount)\n        return false;\n    for (let i = 0, _i = map.length; i < _i; i++) {\n        if (map[i] !== i)\n            return false;\n    }\n    return true;\n}\nfunction columnView(c, map, checkIdentity) {\n    if (c.rowCount === 0)\n        return c;\n    if (checkIdentity && isIdentity(map, c.rowCount))\n        return c;\n    if (!!c.__array && typeof c.value(0) === typeof c.__array[0])\n        return arrayView(c, map);\n    return viewFull(c, map);\n}\nfunction arrayView(c, map) {\n    const array = c.__array;\n    const ret = new array.constructor(map.length);\n    for (let i = 0, _i = map.length; i < _i; i++)\n        ret[i] = array[map[i]];\n    const vk = c.valueKind;\n    return arrayColumn({ array: ret, schema: c.schema, valueKind: row => vk(map[row]) });\n}\nfunction viewFull(c, map) {\n    const v = c.value, vk = c.valueKind, ave = c.areValuesEqual;\n    const value = row => v(map[row]);\n    const rowCount = map.length;\n    return {\n        schema: c.schema,\n        __array: void 0,\n        isDefined: c.isDefined,\n        rowCount,\n        value,\n        valueKind: row => vk(map[row]),\n        toArray: params => {\n            const { array } = ColumnHelpers.createArray(rowCount, params);\n            for (let i = 0, _i = array.length; i < _i; i++)\n                array[i] = v(map[i]);\n            return array;\n        },\n        areValuesEqual: (rowA, rowB) => ave(map[rowA], map[rowB])\n    };\n}\nfunction mapToArrayImpl(c, f, ctor) {\n    const ret = new ctor(c.rowCount);\n    for (let i = 0, _i = c.rowCount; i < _i; i++)\n        ret[i] = f(c.value(i));\n    return ret;\n}\nfunction areColumnsEqual(a, b) {\n    if (a === b)\n        return true;\n    if (a.rowCount !== b.rowCount || a.isDefined !== b.isDefined || a.schema.valueType !== b.schema.valueType)\n        return false;\n    if (!!a.__array && !!b.__array)\n        return areArraysEqual(a, b);\n    return areValuesEqual(a, b);\n}\nfunction areArraysEqual(a, b) {\n    const xs = a.__array, ys = b.__array;\n    for (let i = 0, _i = a.rowCount; i < _i; i++) {\n        if (xs[i] !== ys[i])\n            return false;\n    }\n    return true;\n}\nfunction areValuesEqual(a, b) {\n    const va = a.value, vb = b.value;\n    for (let i = 0, _i = a.rowCount; i < _i; i++) {\n        if (va(i) !== vb(i))\n            return false;\n    }\n    return true;\n}\nfunction columnIndicesOf(c, test) {\n    const ret = [], v = c.value;\n    for (let i = 0, _i = c.rowCount; i < _i; i++) {\n        if (test(v(i)))\n            ret[ret.length] = i;\n    }\n    return ret;\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nvar BitFlags;\n(function (BitFlags) {\n    function create(flags) { return flags; }\n    BitFlags.create = create;\n    function has(flags, flag) { return (flags & flag) !== 0; }\n    BitFlags.has = has;\n    /** toCheck must be non-zero */\n    function hasAll(flags, toCheck) { return !!toCheck && (flags & toCheck) === toCheck; }\n    BitFlags.hasAll = hasAll;\n})(BitFlags || (BitFlags = {}));\nexport { BitFlags };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Adapted from CIFTools.js (https://github.com/dsehnal/CIFTools.js)\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nvar StringBuilder;\n(function (StringBuilder) {\n    function create(chunkCapacity = 512) {\n        return {\n            current: [],\n            offset: 0,\n            capacity: chunkCapacity,\n            chunks: []\n        };\n    }\n    StringBuilder.create = create;\n    function getString(builder) {\n        if (!builder.chunks.length) {\n            if (builder.current.length === builder.offset)\n                return builder.current.join('');\n            return builder.current.splice(0, builder.offset).join('');\n        }\n        if (builder.offset > 0) {\n            builder.chunks[builder.chunks.length] = builder.current.length === builder.offset\n                ? builder.current.join('')\n                : builder.current.slice(0, builder.offset).join('');\n        }\n        return builder.chunks.join('');\n    }\n    StringBuilder.getString = getString;\n    function getSize(builder) {\n        let size = 0;\n        for (const c of builder.chunks)\n            size += c.length;\n        for (let i = 0; i < builder.offset; i++)\n            size += builder.current[i].length;\n        return size;\n    }\n    StringBuilder.getSize = getSize;\n    function getChunks(builder) {\n        if (builder.offset > 0) {\n            if (builder.current.length === builder.offset)\n                builder.chunks[builder.chunks.length] = builder.current.join('');\n            else\n                builder.chunks[builder.chunks.length] = builder.current.slice(0, builder.offset).join('');\n            builder.offset = 0;\n        }\n        return builder.chunks;\n    }\n    StringBuilder.getChunks = getChunks;\n    const __paddingSpaces = [];\n    (function () {\n        let s = '';\n        for (let i = 0; i < 512 /* PaddingSpaces.Count */; i++) {\n            __paddingSpaces[i] = s;\n            s = s + ' ';\n        }\n    })();\n    function newline(builder) {\n        writeSafe(builder, '\\n');\n    }\n    StringBuilder.newline = newline;\n    function whitespace(builder, len) {\n        if (len > 0)\n            writeSafe(builder, __paddingSpaces[len]);\n    }\n    StringBuilder.whitespace = whitespace;\n    function whitespace1(builder) {\n        writeSafe(builder, ' ');\n    }\n    StringBuilder.whitespace1 = whitespace1;\n    function write(builder, val) {\n        if (!val)\n            return;\n        if (builder.offset === builder.capacity) {\n            builder.chunks[builder.chunks.length] = builder.current.join('');\n            builder.offset = 0;\n        }\n        builder.current[builder.offset++] = val;\n    }\n    StringBuilder.write = write;\n    /** Write without check. */\n    function writeSafe(builder, val) {\n        if (builder.offset === builder.capacity) {\n            builder.chunks[builder.chunks.length] = builder.current.join('');\n            builder.offset = 0;\n        }\n        builder.current[builder.offset++] = val;\n    }\n    StringBuilder.writeSafe = writeSafe;\n    function writePadLeft(builder, val, totalWidth) {\n        if (!val) {\n            whitespace(builder, totalWidth);\n            return;\n        }\n        const padding = totalWidth - val.length;\n        whitespace(builder, padding);\n        writeSafe(builder, val);\n    }\n    StringBuilder.writePadLeft = writePadLeft;\n    function writePadRight(builder, val, totalWidth) {\n        if (!val) {\n            whitespace(builder, totalWidth);\n            return;\n        }\n        const padding = totalWidth - val.length;\n        writeSafe(builder, val);\n        whitespace(builder, padding);\n    }\n    StringBuilder.writePadRight = writePadRight;\n    function writeInteger(builder, val) {\n        writeSafe(builder, '' + val);\n    }\n    StringBuilder.writeInteger = writeInteger;\n    function writeIntegerAndSpace(builder, val) {\n        writeSafe(builder, '' + val + ' ');\n    }\n    StringBuilder.writeIntegerAndSpace = writeIntegerAndSpace;\n    function writeIntegerPadLeft(builder, val, totalWidth) {\n        const s = '' + val;\n        const padding = totalWidth - s.length;\n        whitespace(builder, padding);\n        writeSafe(builder, s);\n    }\n    StringBuilder.writeIntegerPadLeft = writeIntegerPadLeft;\n    function writeIntegerPadRight(builder, val, totalWidth) {\n        const s = '' + val;\n        const padding = totalWidth - s.length;\n        writeSafe(builder, s);\n        whitespace(builder, padding);\n    }\n    StringBuilder.writeIntegerPadRight = writeIntegerPadRight;\n    /**\n     * @example writeFloat(123.2123, 100) -- 2 decim\n     */\n    function writeFloat(builder, val, precisionMultiplier) {\n        writeSafe(builder, '' + Math.round(precisionMultiplier * val) / precisionMultiplier);\n    }\n    StringBuilder.writeFloat = writeFloat;\n    function writeFloatPadLeft(builder, val, precisionMultiplier, totalWidth) {\n        const s = '' + Math.round(precisionMultiplier * val) / precisionMultiplier;\n        const padding = totalWidth - s.length;\n        whitespace(builder, padding);\n        writeSafe(builder, s);\n    }\n    StringBuilder.writeFloatPadLeft = writeFloatPadLeft;\n    function writeFloatPadRight(builder, val, precisionMultiplier, totalWidth) {\n        const s = '' + Math.round(precisionMultiplier * val) / precisionMultiplier;\n        const padding = totalWidth - s.length;\n        writeSafe(builder, s);\n        whitespace(builder, padding);\n    }\n    StringBuilder.writeFloatPadRight = writeFloatPadRight;\n})(StringBuilder || (StringBuilder = {}));\nexport { StringBuilder };\n","/**\n * Copyright (c) 2017-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n *\n * based in part on https://github.com/dsehnal/CIFTools.js\n */\n/**\n * Efficient integer and float parsers.\n *\n * For the purposes of parsing numbers from the mmCIF data representations,\n * up to 4 times faster than JS parseInt/parseFloat.\n */\nexport function parseIntSkipLeadingWhitespace(str, start, end) {\n    while (start < end && str.charCodeAt(start) === 32)\n        start++;\n    return parseInt(str, start, end);\n}\nexport function parseInt(str, start, end) {\n    let _start = start, ret = 0, neg = 1;\n    if (str.charCodeAt(_start) === 45 /* - */) {\n        neg = -1;\n        ++_start;\n    }\n    else if (str.charCodeAt(_start) === 43 /* + */) {\n        ++_start;\n    }\n    for (; _start < end; _start++) {\n        const c = str.charCodeAt(_start) - 48;\n        if (c > 9 || c < 0)\n            return (neg * ret) | 0;\n        else\n            ret = (10 * ret + c) | 0;\n    }\n    return neg * ret;\n}\nfunction parseScientific(main, str, start, end) {\n    // handle + in '1e+1' separately.\n    if (str.charCodeAt(start) === 43 /* + */)\n        start++;\n    return main * Math.pow(10.0, parseInt(str, start, end));\n}\nexport function parseFloatSkipLeadingWhitespace(str, start, end) {\n    while (start < end && str.charCodeAt(start) === 32)\n        start++;\n    return parseFloat(str, start, end);\n}\nexport function parseFloat(str, start, end) {\n    let _start = start, neg = 1.0, ret = 0.0, point = 0.0, div = 1.0;\n    if (str.charCodeAt(_start) === 45 /* - */) {\n        neg = -1;\n        ++_start;\n    }\n    else if (str.charCodeAt(_start) === 43 /* + */) {\n        ++_start;\n    }\n    while (_start < end) {\n        let c = str.charCodeAt(_start) - 48;\n        if (c >= 0 && c < 10) {\n            ret = ret * 10 + c;\n            ++_start;\n        }\n        else if (c === -2) { // .\n            ++_start;\n            while (_start < end) {\n                c = str.charCodeAt(_start) - 48;\n                if (c >= 0 && c < 10) {\n                    point = 10.0 * point + c;\n                    div = 10.0 * div;\n                    ++_start;\n                }\n                else if (c === 53 || c === 21) { // 'e'/'E'\n                    return parseScientific(neg * (ret + point / div), str, _start + 1, end);\n                }\n                else {\n                    return neg * (ret + point / div);\n                }\n            }\n            return neg * (ret + point / div);\n        }\n        else if (c === 53 || c === 21) { // 'e'/'E'\n            return parseScientific(neg * ret, str, _start + 1, end);\n        }\n        else {\n            break;\n        }\n    }\n    return neg * ret;\n}\nexport const NumberType = {\n    Int: 0 /* NumberTypes.Int */,\n    Float: 1 /* NumberTypes.Float */,\n    Scientific: 2 /* NumberTypes.Scientific */,\n    NaN: 3 /* NumberTypes.NaN */\n};\nfunction isInt(str, start, end) {\n    if (str.charCodeAt(start) === 45 /* - */) {\n        start++;\n    }\n    for (; start < end; start++) {\n        const c = str.charCodeAt(start) - 48;\n        if (c > 9 || c < 0)\n            return false;\n    }\n    return true;\n}\n// TODO: check for \"scientific integers?\"\nfunction getNumberTypeScientific(str, start, end) {\n    // handle + in '1e+1' separately.\n    if (str.charCodeAt(start) === 43 /* + */)\n        start++;\n    return isInt(str, start, end) ? 2 /* NumberTypes.Scientific */ : 3 /* NumberTypes.NaN */;\n}\n/** The whole range must match, otherwise returns NaN */\nexport function getNumberType(str) {\n    let start = 0;\n    const end = str.length;\n    if (str.charCodeAt(start) === 45) { // -\n        ++start;\n    }\n    // string is . or -.\n    if (str.charCodeAt(start) === 46 && end - start === 1) {\n        return 3 /* NumberTypes.NaN */;\n    }\n    while (start < end) {\n        let c = str.charCodeAt(start) - 48;\n        if (c >= 0 && c < 10) {\n            ++start;\n        }\n        else if (c === -2) { // .\n            ++start;\n            let hasDigit = false;\n            while (start < end) {\n                c = str.charCodeAt(start) - 48;\n                if (c >= 0 && c < 10) {\n                    hasDigit = true;\n                    ++start;\n                }\n                else if (c === 53 || c === 21) { // 'e'/'E'\n                    return getNumberTypeScientific(str, start + 1, end);\n                }\n                else {\n                    return 3 /* NumberTypes.NaN */;\n                }\n            }\n            return hasDigit ? 1 /* NumberTypes.Float */ : 0 /* NumberTypes.Int */;\n        }\n        else if (c === 53 || c === 21) { // 'e'/'E'\n            if (start === 0 || start === 1 && str.charCodeAt(0) === 45) {\n                return 3 /* NumberTypes.NaN */; // string starts with e/E or -e/-E\n            }\n            return getNumberTypeScientific(str, start + 1, end);\n        }\n        else {\n            break;\n        }\n    }\n    return start === end ? 0 /* NumberTypes.Int */ : 3 /* NumberTypes.NaN */;\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport function arrayLess(arr, i, j) {\n    return arr[i] - arr[j];\n}\nexport function arraySwap(arr, i, j) {\n    const temp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = temp;\n}\nfunction medianPivotIndex(data, cmp, l, r) {\n    const m = (l + r) >> 1;\n    if (cmp(data, l, r) > 0)\n        return cmp(data, l, m) > 0 ? cmp(data, m, r) > 0 ? m : r : l;\n    else\n        return cmp(data, r, m) > 0 ? cmp(data, m, l) > 0 ? m : l : r;\n}\nfunction partition(ctx, l, r) {\n    const { cmp, swap, data, parts } = ctx;\n    let equals = l + 1, tail = r;\n    // move the median to the 1st spot\n    swap(data, l, medianPivotIndex(data, cmp, l, r));\n    while (cmp(data, tail, l) > 0) {\n        --tail;\n    }\n    for (let i = l + 1; i <= tail; i++) {\n        const c = cmp(data, i, l);\n        if (c > 0) {\n            swap(data, i, tail);\n            --tail;\n            while (cmp(data, tail, l) > 0) {\n                --tail;\n            }\n            i--;\n        }\n        else if (c === 0) {\n            swap(data, i, equals);\n            equals++;\n        }\n    }\n    // move the medians to the correct spots\n    for (let i = l; i < equals; i++) {\n        swap(data, i, l + tail - i);\n    }\n    parts[0] = tail - equals + l + 1;\n    parts[1] = tail;\n}\nfunction insertionSort({ data, cmp, swap }, start, end) {\n    for (let i = start + 1; i <= end; i++) {\n        let j = i - 1;\n        while (j >= start && cmp(data, j, j + 1) > 0) {\n            swap(data, j, j + 1);\n            j = j - 1;\n        }\n    }\n}\nfunction quickSort(ctx, low, high) {\n    const { parts } = ctx;\n    while (low < high) {\n        if (high - low < 16) {\n            insertionSort(ctx, low, high);\n            return;\n        }\n        partition(ctx, low, high);\n        const li = parts[0], ri = parts[1];\n        if (li - low < high - ri) {\n            quickSort(ctx, low, li - 1);\n            low = ri + 1;\n        }\n        else {\n            quickSort(ctx, ri + 1, high);\n            high = li - 1;\n        }\n    }\n}\nfunction partitionArrayAsc(data, parts, l, r) {\n    let equals = l + 1, tail = r;\n    // move the median to the 1st spot\n    arraySwap(data, l, medianPivotIndex(data, arrayLess, l, r));\n    const pivot = data[l];\n    while (data[tail] > pivot) {\n        --tail;\n    }\n    for (let i = l + 1; i <= tail; i++) {\n        const v = data[i];\n        if (v > pivot) {\n            arraySwap(data, i, tail);\n            --tail;\n            while (data[tail] > pivot) {\n                --tail;\n            }\n            i--;\n        }\n        else if (v === pivot) {\n            arraySwap(data, i, equals);\n            ++equals;\n        }\n    }\n    // move all medians to the correct spots\n    for (let i = l; i < equals; i++) {\n        arraySwap(data, i, l + tail - i);\n    }\n    parts[0] = tail - equals + l + 1;\n    parts[1] = tail;\n}\nfunction insertionSortArrayAsc(data, start, end) {\n    for (let i = start + 1; i <= end; i++) {\n        const key = data[i];\n        let j = i - 1;\n        while (j >= start && data[j] > key) {\n            data[j + 1] = data[j];\n            j = j - 1;\n        }\n        data[j + 1] = key;\n    }\n}\nfunction quickSortArrayAsc(data, parts, low, high) {\n    while (low < high) {\n        if (high - low < 16) {\n            insertionSortArrayAsc(data, low, high);\n            return;\n        }\n        partitionArrayAsc(data, parts, low, high);\n        const li = parts[0], ri = parts[1];\n        if (li - low < high - ri) {\n            quickSortArrayAsc(data, parts, low, li - 1);\n            low = ri + 1;\n        }\n        else {\n            quickSortArrayAsc(data, parts, ri + 1, high);\n            high = li - 1;\n        }\n    }\n}\nexport function sortArray(data, cmp = arrayLess) {\n    return sortArrayRange(data, 0, data.length, cmp);\n}\nexport function sortArrayRange(data, start, end, cmp = arrayLess) {\n    if (cmp === arrayLess)\n        quickSortArrayAsc(data, [0, 0], start, end - 1);\n    else\n        quickSort({ data, cmp, swap: arraySwap, parts: [0, 0] }, start, end - 1);\n    return data;\n}\nexport function sort(data, start, end, cmp, swap) {\n    const ctx = { data, cmp, swap, parts: [0, 0] };\n    quickSort(ctx, start, end - 1);\n    return data;\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nconst now = (function () {\n    if (typeof window !== 'undefined' && window.performance) {\n        const perf = window.performance;\n        return () => perf.now();\n    }\n    else if (typeof process !== 'undefined' && process.hrtime !== 'undefined' && typeof process.hrtime === 'function') {\n        return () => {\n            const t = process.hrtime();\n            return t[0] * 1000 + t[1] / 1000000;\n        };\n    }\n    else if (Date.now) {\n        return () => Date.now();\n    }\n    else {\n        return () => +new Date();\n    }\n}());\nfunction formatTimespan(t, includeMsZeroes = true) {\n    if (isNaN(t))\n        return 'n/a';\n    const h = Math.floor(t / (60 * 60 * 1000)), m = Math.floor(t / (60 * 1000) % 60), s = Math.floor(t / 1000 % 60);\n    let ms = Math.floor(t % 1000).toString();\n    while (ms.length < 3)\n        ms = '0' + ms;\n    while (!includeMsZeroes && ms.length > 1 && ms[ms.length - 1] === '0')\n        ms = ms.substr(0, ms.length - 1);\n    if (h > 0)\n        return `${h}h${m}m${s}.${ms}s`;\n    if (m > 0)\n        return `${m}m${s}.${ms}s`;\n    if (s > 0)\n        return `${s}.${ms}s`;\n    return `${t.toFixed(0)}ms`;\n}\nexport { now, formatTimespan };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { now } from '../mol-util/now';\nvar UUID;\n(function (UUID) {\n    const _btoa = typeof btoa !== 'undefined' ? btoa : (s) => Buffer.from(s).toString('base64');\n    const chars = [];\n    /** Creates a 22 characters 'base64' encoded UUID */\n    function create22() {\n        let d = (+new Date()) + now();\n        for (let i = 0; i < 16; i++) {\n            chars[i] = String.fromCharCode((d + Math.random() * 0xff) % 0xff | 0);\n            d = Math.floor(d / 0xff);\n        }\n        return _btoa(chars.join('')).replace(/\\+/g, '-').replace(/\\//g, '_').substr(0, 22);\n    }\n    UUID.create22 = create22;\n    function createv4() {\n        let d = (+new Date()) + now();\n        const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            const r = (d + Math.random() * 16) % 16 | 0;\n            d = Math.floor(d / 16);\n            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n        });\n        return uuid;\n    }\n    UUID.createv4 = createv4;\n    function is(x) {\n        return typeof x === 'string';\n    }\n    UUID.is = is;\n})(UUID || (UUID = {}));\nexport { UUID };\n","/**\n * Copyright (c) 2017 Mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\n// TODO check if the removal of FastSet and the removal of the context object for forEach\n// have any performance implications\nfunction _ascSort(a, b) {\n    return a - b;\n}\nexport function sortAsc(array) {\n    Array.prototype.sort.call(array, _ascSort);\n    return array;\n}\nvar Mask;\n(function (Mask) {\n    class EmptyMask {\n        has(i) { return false; }\n        forEach(f, ctx) { return ctx; }\n        constructor() {\n            this.size = 0;\n        }\n    }\n    class SingletonMask {\n        has(i) { return i === this.idx; }\n        forEach(f, ctx) { f(this.idx, ctx); return ctx; }\n        constructor(idx) {\n            this.idx = idx;\n            this.size = 1;\n        }\n    }\n    class BitMask {\n        has(i) { return i < this.length && !!this.mask[i]; }\n        _forEach(f, ctx) {\n            for (let i = 0; i < this.length; i++) {\n                if (this.mask[i])\n                    f(i, ctx);\n            }\n        }\n        forEach(f, ctx) {\n            this._forEach(f, ctx);\n            return ctx;\n        }\n        constructor(mask, size) {\n            this.mask = mask;\n            this.size = size;\n            this.length = mask.length;\n        }\n    }\n    class AllMask {\n        has(i) { return true; }\n        _forEach(f, ctx) {\n            for (let i = 0; i < this.size; i++) {\n                f(i, ctx);\n            }\n        }\n        forEach(f, ctx) {\n            this._forEach(f, ctx);\n            return ctx;\n        }\n        constructor(size) {\n            this.size = size;\n        }\n    }\n    class SetMask {\n        has(i) { return this.set.has(i); }\n        _forEach(f, ctx) {\n            for (const idx of this.flatten()) {\n                f(idx, ctx);\n            }\n        }\n        flatten() {\n            if (this._flat)\n                return this._flat;\n            const indices = new Int32Array(this.size);\n            let offset = 0;\n            this.set.forEach(i => indices[offset++] = i);\n            sortAsc(indices);\n            this._flat = indices;\n            return this._flat;\n        }\n        forEach(f, ctx) {\n            this._forEach(f, ctx);\n            return ctx;\n        }\n        constructor(set) {\n            this.set = set;\n            this._flat = void 0;\n            this.size = set.size;\n        }\n    }\n    function always(size) { return new AllMask(size); }\n    Mask.always = always;\n    Mask.never = new EmptyMask();\n    function ofSet(set) {\n        return new SetMask(set);\n    }\n    Mask.ofSet = ofSet;\n    function singleton(i) {\n        return new SingletonMask(i);\n    }\n    Mask.singleton = singleton;\n    function ofUniqueIndices(indices) {\n        const len = indices.length;\n        if (len === 0)\n            return new EmptyMask();\n        if (len === 1)\n            return new SingletonMask(indices[0]);\n        let max = 0;\n        for (const i of indices) {\n            if (i > max)\n                max = i;\n        }\n        if (len === max)\n            return new AllMask(len);\n        const f = len / max;\n        if (f < 1 / 12) {\n            const set = new Set();\n            for (const i of indices)\n                set.add(i);\n            return new SetMask(set);\n        }\n        const mask = new Int8Array(max + 1);\n        for (const i of indices) {\n            mask[i] = 1;\n        }\n        return new BitMask(mask, indices.length);\n    }\n    Mask.ofUniqueIndices = ofUniqueIndices;\n    function ofMask(mask, size) {\n        return new BitMask(mask, size);\n    }\n    Mask.ofMask = ofMask;\n    function hasAny(mask, xs) {\n        for (const x of xs) {\n            if (mask.has(x))\n                return true;\n        }\n        return false;\n    }\n    Mask.hasAny = hasAny;\n    function complement(mask, against) {\n        let count = 0;\n        let max = 0;\n        against.forEach(i => {\n            if (!mask.has(i)) {\n                count++;\n                if (i > max)\n                    max = i;\n            }\n        });\n        if (count / max < 1 / 12) {\n            // set based\n            const set = new Set();\n            against.forEach(i => {\n                if (!mask.has(i)) {\n                    set.add(i);\n                }\n            });\n            return ofSet(set);\n        }\n        else {\n            // mask based\n            const target = new Uint8Array(max + 1);\n            against.forEach(i => {\n                if (!mask.has(i)) {\n                    target[i] = 1;\n                }\n            });\n            return ofMask(target, count);\n        }\n    }\n    Mask.complement = complement;\n})(Mask || (Mask = {}));\nexport { Mask };\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { idFactory } from './id-factory';\nvar ValueRef;\n(function (ValueRef) {\n    function create(ref) { return { ref }; }\n    ValueRef.create = create;\n    function set(ref, value) { ref.ref = value; return ref; }\n    ValueRef.set = set;\n})(ValueRef || (ValueRef = {}));\nconst getNextId = idFactory(0, 0x7FFFFFFF);\nvar ValueBox;\n(function (ValueBox) {\n    function create(value, metadata) {\n        return { id: getNextId(), version: 0, value, metadata: metadata };\n    }\n    ValueBox.create = create;\n    /** The box.metadata is carried over from the old box */\n    function withValue(box, value) {\n        return { id: box.id, version: box.version + 1, value, metadata: box.metadata };\n    }\n    ValueBox.withValue = withValue;\n})(ValueBox || (ValueBox = {}));\nvar ValueCell;\n(function (ValueCell) {\n    function create(value, metadata) {\n        return ValueRef.create(ValueBox.create(value, metadata));\n    }\n    ValueCell.create = create;\n    /** The box.metadata is carried over from the old box */\n    function update(cell, value) {\n        return ValueRef.set(cell, ValueBox.withValue(cell.ref, value));\n    }\n    ValueCell.update = update;\n    function set(cell, box) {\n        return ValueRef.set(cell, box);\n    }\n    ValueCell.set = set;\n    /** Updates the cell if the value is has changed, comparing by reference */\n    function updateIfChanged(cell, value) {\n        return cell.ref.value !== value ? update(cell, value) : cell;\n    }\n    ValueCell.updateIfChanged = updateIfChanged;\n})(ValueCell || (ValueCell = {}));\nexport { ValueRef, ValueBox, ValueCell };\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/** Builds id function returning ids within [firstId, maxId) */\nexport function idFactory(firstId = 0, maxId = Number.MAX_SAFE_INTEGER) {\n    let _nextId = firstId;\n    return () => {\n        const ret = _nextId;\n        _nextId = (_nextId + 1) % maxId;\n        return ret;\n    };\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Column } from './column';\nimport { sortArray } from '../util/sort';\nimport { StringBuilder } from '../../mol-util';\n/** An immutable table */\nvar Table;\n(function (Table) {\n    function is(t) {\n        return t && typeof t._rowCount === 'number' && !!t._columns && !!t._schema;\n    }\n    Table.is = is;\n    function pickColumns(schema, table, guard = {}) {\n        const ret = Object.create(null);\n        const keys = Object.keys(schema);\n        ret._rowCount = table._rowCount;\n        ret._columns = keys;\n        ret._schema = schema;\n        for (const k of keys) {\n            if (!!table[k])\n                ret[k] = table[k];\n            else if (!!guard[k])\n                ret[k] = guard[k];\n            else\n                throw Error(`Cannot find column '${k}'.`);\n        }\n        return ret;\n    }\n    Table.pickColumns = pickColumns;\n    function ofColumns(schema, columns) {\n        const _columns = Object.keys(columns);\n        const _rowCount = columns[_columns[0]].rowCount;\n        return { _rowCount, _columns, _schema: schema, ...columns };\n    }\n    Table.ofColumns = ofColumns;\n    function ofPartialColumns(schema, partialColumns, rowCount) {\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = rowCount;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            if (k in partialColumns)\n                ret[k] = partialColumns[k];\n            else\n                ret[k] = Column.Undefined(rowCount, schema[k]);\n        }\n        return ret;\n    }\n    Table.ofPartialColumns = ofPartialColumns;\n    function ofUndefinedColumns(schema, rowCount) {\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = rowCount;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            ret[k] = Column.Undefined(rowCount, schema[k]);\n        }\n        return ret;\n    }\n    Table.ofUndefinedColumns = ofUndefinedColumns;\n    function ofRows(schema, rows) {\n        const ret = Object.create(null);\n        const rowCount = rows.length;\n        const columns = Object.keys(schema);\n        ret._rowCount = rowCount;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            ret[k] = Column.ofLambda({\n                rowCount,\n                schema: schema[k],\n                value: r => rows[r][k],\n                valueKind: r => typeof rows[r][k] === 'undefined' ? 1 /* Column.ValueKinds.NotPresent */ : 0 /* Column.ValueKinds.Present */\n            });\n        }\n        return ret;\n    }\n    Table.ofRows = ofRows;\n    function ofArrays(schema, arrays) {\n        var _a;\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = 0;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            if (typeof arrays[k] !== 'undefined') {\n                ret[k] = Column.ofArray({ array: arrays[k], schema: schema[k] });\n                ret._rowCount = (_a = arrays[k]) === null || _a === void 0 ? void 0 : _a.length;\n            }\n            else {\n                ret[k] = Column.Undefined(ret._rowCount, schema[k]);\n            }\n        }\n        return ret;\n    }\n    Table.ofArrays = ofArrays;\n    function view(table, schema, view) {\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = view.length;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            ret[k] = Column.view(table[k], view);\n        }\n        return ret;\n    }\n    Table.view = view;\n    function pick(table, schema, test) {\n        const _view = [];\n        for (let i = 0, il = table._rowCount; i < il; ++i) {\n            if (test(i))\n                _view.push(i);\n        }\n        return view(table, schema, _view);\n    }\n    Table.pick = pick;\n    function window(table, schema, start, end) {\n        if (start === 0 && end === table._rowCount)\n            return table;\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = end - start;\n        ret._columns = columns;\n        ret._schema = schema;\n        for (const k of columns) {\n            ret[k] = Column.window(table[k], start, end);\n        }\n        return ret;\n    }\n    Table.window = window;\n    function concat(tables, schema) {\n        const ret = Object.create(null);\n        const columns = Object.keys(schema);\n        ret._rowCount = 0;\n        for (const table of tables) {\n            ret._rowCount += table._rowCount;\n        }\n        const arrays = {};\n        for (const column of columns) {\n            arrays[column] = new Array(ret._rowCount);\n        }\n        ret._columns = columns;\n        ret._schema = schema;\n        let offset = 0;\n        for (const table of tables) {\n            for (const k of columns) {\n                Column.copyToArray(table[k], arrays[k], offset);\n            }\n            offset += table._rowCount;\n        }\n        for (const k of columns) {\n            ret[k] = Column.ofArray({ array: arrays[k], schema: schema[k] });\n        }\n        return ret;\n    }\n    Table.concat = concat;\n    function columnToArray(table, name, array) {\n        table[name] = Column.asArrayColumn(table[name], array);\n    }\n    Table.columnToArray = columnToArray;\n    /** Sort and return a new table */\n    function sort(table, cmp) {\n        const indices = new Int32Array(table._rowCount);\n        for (let i = 0, _i = indices.length; i < _i; i++)\n            indices[i] = i;\n        sortArray(indices, (_, i, j) => cmp(i, j));\n        let isIdentity = true;\n        for (let i = 0, _i = indices.length; i < _i; i++) {\n            if (indices[i] !== i) {\n                isIdentity = false;\n                break;\n            }\n        }\n        if (isIdentity)\n            return table;\n        const ret = Object.create(null);\n        ret._rowCount = table._rowCount;\n        ret._columns = table._columns;\n        ret._schema = table._schema;\n        for (const c of table._columns) {\n            ret[c] = Column.view(table[c], indices, false);\n        }\n        return ret;\n    }\n    Table.sort = sort;\n    function areEqual(a, b) {\n        if (a._rowCount !== b._rowCount)\n            return false;\n        if (a._columns.length !== b._columns.length)\n            return false;\n        for (const c of a._columns) {\n            if (!b[c])\n                return false;\n        }\n        for (const c of a._columns) {\n            if (!Column.areEqual(a[c], b[c]))\n                return false;\n        }\n        return true;\n    }\n    Table.areEqual = areEqual;\n    /** Allocate a new object with the given row values. */\n    function getRow(table, index) {\n        const row = Object.create(null);\n        const { _columns: cols } = table;\n        for (let i = 0; i < cols.length; i++) {\n            const c = cols[i];\n            row[c] = table[c].value(index);\n        }\n        return row;\n    }\n    Table.getRow = getRow;\n    /** Pick the first row for which `test` evaluates to true */\n    function pickRow(table, test) {\n        for (let i = 0, il = table._rowCount; i < il; ++i) {\n            if (test(i))\n                return getRow(table, i);\n        }\n    }\n    Table.pickRow = pickRow;\n    function getRows(table) {\n        const ret = [];\n        const { _rowCount: c } = table;\n        for (let i = 0; i < c; i++) {\n            ret[i] = getRow(table, i);\n        }\n        return ret;\n    }\n    Table.getRows = getRows;\n    function toArrays(table) {\n        const arrays = {};\n        const { _columns } = table;\n        for (let i = 0; i < _columns.length; i++) {\n            const c = _columns[i];\n            arrays[c] = table[c].toArray();\n        }\n        return arrays;\n    }\n    Table.toArrays = toArrays;\n    function formatToString(table) {\n        const sb = StringBuilder.create();\n        const { _columns: cols, _rowCount } = table;\n        let headerLength = 1;\n        StringBuilder.write(sb, '|');\n        for (let i = 0; i < cols.length; i++) {\n            StringBuilder.write(sb, cols[i]);\n            StringBuilder.write(sb, '|');\n            headerLength += cols[i].length + 1;\n        }\n        StringBuilder.newline(sb);\n        StringBuilder.write(sb, new Array(headerLength + 1).join('-'));\n        StringBuilder.newline(sb);\n        for (let r = 0; r < _rowCount; r++) {\n            StringBuilder.write(sb, '|');\n            for (let i = 0; i < cols.length; i++) {\n                const c = table[cols[i]];\n                if (c.valueKind(r) === 0 /* Column.ValueKinds.Present */) {\n                    StringBuilder.write(sb, c.value(r));\n                    StringBuilder.write(sb, '|');\n                }\n                else {\n                    StringBuilder.write(sb, '.|');\n                }\n            }\n            StringBuilder.newline(sb);\n        }\n        return StringBuilder.getString(sb);\n    }\n    Table.formatToString = formatToString;\n})(Table || (Table = {}));\nexport { Table };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Table } from './table';\nvar Database;\n(function (Database) {\n    function ofTables(name, schema, tables) {\n        const keys = Object.keys(tables);\n        const ret = Object.create(null);\n        const tableNames = [];\n        ret._name = name;\n        ret._tableNames = tableNames;\n        ret._schema = schema;\n        for (const k of keys) {\n            if (!Table.is(tables[k]))\n                continue;\n            ret[k] = tables[k];\n            tableNames[tableNames.length] = k;\n        }\n        return ret;\n    }\n    Database.ofTables = ofTables;\n    function getTablesAsRows(database) {\n        const ret = {};\n        for (const k of database._tableNames) {\n            ret[k] = Table.getRows(database[k]);\n        }\n        return ret;\n    }\n    Database.getTablesAsRows = getTablesAsRows;\n})(Database || (Database = {}));\nexport { Database };\n","/**\n * Copyright (c) 2017-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Column, ColumnHelpers } from '../../../mol-data/db';\nimport { getNumberType, parseInt as fastParseInt, parseFloat as fastParseFloat } from '../common/text/number-parser';\nimport { areValuesEqualProvider } from '../common/text/column/token';\nexport function CifFile(blocks, name) {\n    return { name, blocks: blocks };\n}\nexport function CifBlock(categoryNames, categories, header, saveFrames = []) {\n    return {\n        categoryNames, header, categories, saveFrames,\n        getField(name) {\n            const [category, field] = name.split('.');\n            return categories[category].getField(field || '');\n        }\n    };\n}\nexport function CifSaveFrame(categoryNames, categories, header) {\n    return { categoryNames, header, categories };\n}\nexport function CifCategory(name, rowCount, fieldNames, fields) {\n    return { rowCount, name, fieldNames: [...fieldNames], getField(name) { return fields[name]; } };\n}\n(function (CifCategory) {\n    function empty(name) {\n        return { rowCount: 0, name, fieldNames: [], getField(name) { return void 0; } };\n    }\n    CifCategory.empty = empty;\n    ;\n    function ofFields(name, fields) {\n        const fieldNames = Object.keys(fields);\n        return {\n            rowCount: fieldNames.length > 0 ? fields[fieldNames[0]].rowCount : 0,\n            name,\n            fieldNames,\n            getField(name) { return fields[name]; }\n        };\n    }\n    CifCategory.ofFields = ofFields;\n    function ofTable(name, table) {\n        const fields = {};\n        for (const name of table._columns) {\n            fields[name] = CifField.ofColumn(table[name]);\n        }\n        return ofFields(name, fields);\n    }\n    CifCategory.ofTable = ofTable;\n})(CifCategory || (CifCategory = {}));\nexport var CifField;\n(function (CifField) {\n    function ofString(value) {\n        return ofStrings([value]);\n    }\n    CifField.ofString = ofString;\n    function ofStrings(values) {\n        const rowCount = values.length;\n        const str = row => { const ret = values[row]; if (!ret || ret === '.' || ret === '?')\n            return ''; return ret; };\n        const int = row => { const v = values[row]; return fastParseInt(v, 0, v.length) || 0; };\n        const float = row => { const v = values[row]; return fastParseFloat(v, 0, v.length) || 0; };\n        const valueKind = row => {\n            const v = values[row], l = v.length;\n            if (l > 1)\n                return 0 /* Column.ValueKinds.Present */;\n            if (l === 0)\n                return 1 /* Column.ValueKinds.NotPresent */;\n            const c = v.charCodeAt(0);\n            if (c === 46 /* . */)\n                return 1 /* Column.ValueKinds.NotPresent */;\n            if (c === 63 /* ? */)\n                return 2 /* Column.ValueKinds.Unknown */;\n            return 0 /* Column.ValueKinds.Present */;\n        };\n        return {\n            __array: void 0,\n            binaryEncoding: void 0,\n            isDefined: true,\n            rowCount,\n            str,\n            int,\n            float,\n            valueKind,\n            areValuesEqual: (rowA, rowB) => values[rowA] === values[rowB],\n            toStringArray: params => params ? ColumnHelpers.createAndFillArray(rowCount, str, params) : values,\n            toIntArray: params => ColumnHelpers.createAndFillArray(rowCount, int, params),\n            toFloatArray: params => ColumnHelpers.createAndFillArray(rowCount, float, params)\n        };\n    }\n    CifField.ofStrings = ofStrings;\n    function ofNumbers(values) {\n        const rowCount = values.length;\n        const str = row => { return '' + values[row]; };\n        const float = row => values[row];\n        const valueKind = row => 0 /* Column.ValueKinds.Present */;\n        const toFloatArray = (params) => {\n            if (!params || params.array && values instanceof params.array) {\n                return values;\n            }\n            else {\n                return ColumnHelpers.createAndFillArray(rowCount, float, params);\n            }\n        };\n        return {\n            __array: void 0,\n            binaryEncoding: void 0,\n            isDefined: true,\n            rowCount,\n            str,\n            int: float,\n            float,\n            valueKind,\n            areValuesEqual: (rowA, rowB) => values[rowA] === values[rowB],\n            toStringArray: params => ColumnHelpers.createAndFillArray(rowCount, str, params),\n            toIntArray: toFloatArray,\n            toFloatArray\n        };\n    }\n    CifField.ofNumbers = ofNumbers;\n    function ofTokens(tokens) {\n        const { data, indices, count: rowCount } = tokens;\n        const str = row => {\n            const ret = data.substring(indices[2 * row], indices[2 * row + 1]);\n            if (ret === '.' || ret === '?')\n                return '';\n            return ret;\n        };\n        const int = row => {\n            return fastParseInt(data, indices[2 * row], indices[2 * row + 1]) || 0;\n        };\n        const float = row => {\n            return fastParseFloat(data, indices[2 * row], indices[2 * row + 1]) || 0;\n        };\n        const valueKind = row => {\n            const s = indices[2 * row], l = indices[2 * row + 1] - s;\n            if (l > 1)\n                return 0 /* Column.ValueKinds.Present */;\n            if (l === 0)\n                return 1 /* Column.ValueKinds.NotPresent */;\n            const v = data.charCodeAt(s);\n            if (v === 46 /* . */)\n                return 1 /* Column.ValueKinds.NotPresent */;\n            if (v === 63 /* ? */)\n                return 2 /* Column.ValueKinds.Unknown */;\n            return 0 /* Column.ValueKinds.Present */;\n        };\n        return {\n            __array: void 0,\n            binaryEncoding: void 0,\n            isDefined: true,\n            rowCount,\n            str,\n            int,\n            float,\n            valueKind,\n            areValuesEqual: areValuesEqualProvider(tokens),\n            toStringArray: params => ColumnHelpers.createAndFillArray(rowCount, str, params),\n            toIntArray: params => ColumnHelpers.createAndFillArray(rowCount, int, params),\n            toFloatArray: params => ColumnHelpers.createAndFillArray(rowCount, float, params)\n        };\n    }\n    CifField.ofTokens = ofTokens;\n    function ofColumn(column) {\n        const { rowCount, valueKind, areValuesEqual, isDefined } = column;\n        let str;\n        let int;\n        let float;\n        switch (column.schema.valueType) {\n            case 'float':\n            case 'int':\n                str = row => { return '' + column.value(row); };\n                int = column.value;\n                float = column.value;\n                break;\n            case 'str':\n                str = column.value;\n                int = row => { const v = column.value(row); return fastParseInt(v, 0, v.length) || 0; };\n                float = row => { const v = column.value(row); return fastParseFloat(v, 0, v.length) || 0; };\n                break;\n            case 'list':\n                const { separator } = column.schema;\n                str = row => column.value(row).join(separator);\n                int = row => NaN;\n                float = row => NaN;\n                break;\n            default:\n                throw new Error(`unsupported valueType '${column.schema.valueType}'`);\n        }\n        return {\n            __array: void 0,\n            binaryEncoding: void 0,\n            isDefined,\n            rowCount,\n            str,\n            int,\n            float,\n            valueKind,\n            areValuesEqual,\n            toStringArray: params => ColumnHelpers.createAndFillArray(rowCount, str, params),\n            toIntArray: params => ColumnHelpers.createAndFillArray(rowCount, int, params),\n            toFloatArray: params => ColumnHelpers.createAndFillArray(rowCount, float, params)\n        };\n    }\n    CifField.ofColumn = ofColumn;\n    function ofUndefined(rowCount, schema) {\n        return ofColumn(Column.Undefined(rowCount, schema));\n    }\n    CifField.ofUndefined = ofUndefined;\n})(CifField || (CifField = {}));\nexport function tensorFieldNameGetter(field, rank, zeroIndexed, namingVariant) {\n    const offset = zeroIndexed ? 0 : 1;\n    switch (rank) {\n        case 1:\n            return namingVariant === 'brackets'\n                ? (i) => `${field}[${i + offset}]`\n                : (i) => `${field}_${i + offset}`;\n        case 2:\n            return namingVariant === 'brackets'\n                ? (i, j) => `${field}[${i + offset}][${j + offset}]`\n                : (i, j) => `${field}_${i + offset}${j + offset}`;\n        case 3:\n            return namingVariant === 'brackets'\n                ? (i, j, k) => `${field}[${i + offset}][${j + offset}][${k + offset}]`\n                : (i, j, k) => `${field}_${i + offset}${j + offset}${k + offset}`;\n        default:\n            throw new Error('Tensors with rank > 3 or rank 0 are currently not supported.');\n    }\n}\nexport function getTensor(category, space, row, getName) {\n    const ret = space.create();\n    if (space.rank === 1) {\n        const rows = space.dimensions[0];\n        for (let i = 0; i < rows; i++) {\n            const f = category.getField(getName(i));\n            space.set(ret, i, !!f ? f.float(row) : 0.0);\n        }\n    }\n    else if (space.rank === 2) {\n        const rows = space.dimensions[0], cols = space.dimensions[1];\n        for (let i = 0; i < rows; i++) {\n            for (let j = 0; j < cols; j++) {\n                const f = category.getField(getName(i, j));\n                space.set(ret, i, j, !!f ? f.float(row) : 0.0);\n            }\n        }\n    }\n    else if (space.rank === 3) {\n        const d0 = space.dimensions[0], d1 = space.dimensions[1], d2 = space.dimensions[2];\n        for (let i = 0; i < d0; i++) {\n            for (let j = 0; j < d1; j++) {\n                for (let k = 0; k < d2; k++) {\n                    const f = category.getField(getName(i, j, k));\n                    space.set(ret, i, j, k, !!f ? f.float(row) : 0.0);\n                }\n            }\n        }\n    }\n    else {\n        throw new Error('Tensors with rank > 3 or rank 0 are currently not supported.');\n    }\n    return ret;\n}\nexport function getCifFieldType(field) {\n    let floatCount = 0, hasStringOrScientific = false, undefinedCount = 0;\n    for (let i = 0, _i = field.rowCount; i < _i; i++) {\n        const k = field.valueKind(i);\n        if (k !== 0 /* Column.ValueKinds.Present */) {\n            undefinedCount++;\n            continue;\n        }\n        const type = getNumberType(field.str(i));\n        if (type === 0 /* NumberTypes.Int */)\n            continue;\n        else if (type === 1 /* NumberTypes.Float */)\n            floatCount++;\n        else {\n            hasStringOrScientific = true;\n            break;\n        }\n    }\n    // numbers in scientific notation and plain text are not distinguishable\n    if (hasStringOrScientific || undefinedCount === field.rowCount)\n        return Column.Schema.str;\n    if (floatCount > 0)\n        return Column.Schema.float;\n    return Column.Schema.int;\n}\n","/**\n * Copyright (c) 2017-2021 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { ColumnHelpers } from '../../../../../mol-data/db';\nimport { parseInt as fastParseInt, parseFloat as fastParseFloat } from '../number-parser';\nexport function TokenColumnProvider(tokens) {\n    return function (type) {\n        return TokenColumn(tokens, type);\n    };\n}\nexport function TokenColumn(tokens, schema) {\n    const { data, indices, count: rowCount } = tokens;\n    const { valueType: type } = schema;\n    const value = type === 'str'\n        ? row => data.substring(indices[2 * row], indices[2 * row + 1])\n        : type === 'int'\n            ? row => fastParseInt(data, indices[2 * row], indices[2 * row + 1]) || 0\n            : row => fastParseFloat(data, indices[2 * row], indices[2 * row + 1]) || 0;\n    return {\n        schema: schema,\n        __array: void 0,\n        isDefined: true,\n        rowCount,\n        value,\n        valueKind: row => 0 /* Column.ValueKinds.Present */,\n        toArray: params => ColumnHelpers.createAndFillArray(rowCount, value, params),\n        areValuesEqual: areValuesEqualProvider(tokens)\n    };\n}\nexport function areValuesEqualProvider(tokens) {\n    const { data, indices } = tokens;\n    return function (rowA, rowB) {\n        const aS = indices[2 * rowA], bS = indices[2 * rowB];\n        const len = indices[2 * rowA + 1] - aS;\n        if (len !== indices[2 * rowB + 1] - bS)\n            return false;\n        for (let i = 0; i < len; i++) {\n            if (data.charCodeAt(i + aS) !== data.charCodeAt(i + bS)) {\n                return false;\n            }\n        }\n        return true;\n    };\n}\nexport function areTokensEmpty(tokens) {\n    const { count, indices } = tokens;\n    for (let i = 0; i < count; ++i) {\n        if (indices[2 * i] !== indices[2 * i + 1])\n            return false;\n    }\n    return true;\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nfunction createImmediateActions() {\n    const thisGlobal = (function () {\n        const _window = typeof window !== 'undefined' && window;\n        const _self = typeof self !== 'undefined' && typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope && self;\n        const _global = typeof global !== 'undefined' && global;\n        return _window || _global || _self;\n    })();\n    const tasksByHandle = {};\n    const doc = typeof document !== 'undefined' ? document : void 0;\n    let nextHandle = 1; // Spec says greater than zero\n    let registerImmediate;\n    function setImmediate(callback, ...args) {\n        // Callback can either be a function or a string\n        if (typeof callback !== 'function') {\n            callback = new Function('' + callback);\n        }\n        // Store and register the task\n        const task = { callback: callback, args: args };\n        tasksByHandle[nextHandle] = task;\n        registerImmediate(nextHandle);\n        return nextHandle++;\n    }\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n    function run(task) {\n        const callback = task.callback;\n        const args = task.args;\n        switch (args.length) {\n            case 0:\n                callback();\n                break;\n            case 1:\n                callback(args[0]);\n                break;\n            case 2:\n                callback(args[0], args[1]);\n                break;\n            case 3:\n                callback(args[0], args[1], args[2]);\n                break;\n            default:\n                callback.apply(undefined, args);\n                break;\n        }\n    }\n    function runIfPresent(handle) {\n        const task = tasksByHandle[handle];\n        clearImmediate(handle);\n        run(task);\n    }\n    function installNextTickImplementation() {\n        registerImmediate = function (handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n    function canUsePostMessage() {\n        if (thisGlobal && thisGlobal.postMessage && !thisGlobal.importScripts) {\n            let postMessageIsAsynchronous = true;\n            const oldOnMessage = thisGlobal.onmessage;\n            thisGlobal.onmessage = function () {\n                postMessageIsAsynchronous = false;\n            };\n            thisGlobal.postMessage('', '*');\n            thisGlobal.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n        const messagePrefix = 'setImmediate$' + Math.random() + '$';\n        const onGlobalMessage = function (event) {\n            if (event.source === thisGlobal &&\n                typeof event.data === 'string' &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n        if (window.addEventListener) {\n            window.addEventListener('message', onGlobalMessage, false);\n        }\n        else {\n            window.attachEvent('onmessage', onGlobalMessage);\n        }\n        registerImmediate = function (handle) {\n            window.postMessage(messagePrefix + handle, '*');\n        };\n    }\n    function installMessageChannelImplementation() {\n        const channel = new MessageChannel();\n        channel.port1.onmessage = function (event) {\n            const handle = event.data;\n            runIfPresent(handle);\n        };\n        registerImmediate = function (handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n    function installReadyStateChangeImplementation() {\n        const html = doc.documentElement;\n        registerImmediate = function (handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            let script = doc.createElement('script');\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n    function installSetTimeoutImplementation() {\n        registerImmediate = function (handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n    // Don't get fooled by e.g. browserify environments.\n    if (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n    }\n    else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n    }\n    else if (typeof MessageChannel !== 'undefined') {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n    }\n    else if (doc && 'onreadystatechange' in doc.createElement('script')) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n    }\n    else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n    return {\n        setImmediate,\n        clearImmediate\n    };\n}\nconst immediateActions = (function () {\n    if (typeof setImmediate !== 'undefined') {\n        if (typeof window !== 'undefined') {\n            return {\n                setImmediate: (handler, ...args) => window.setImmediate(handler, ...args),\n                clearImmediate: (handle) => window.clearImmediate(handle)\n            };\n        }\n        else {\n            return { setImmediate, clearImmediate };\n        }\n    }\n    return createImmediateActions();\n}());\nfunction resolveImmediate(res) {\n    immediateActions.setImmediate(res);\n}\nconst Scheduler = {\n    setImmediate: immediateActions.setImmediate,\n    clearImmediate: immediateActions.clearImmediate,\n    immediatePromise() { return new Promise(resolveImmediate); },\n    delay(timeout, value = void 0) { return new Promise(r => setTimeout(r, timeout, value)); }\n};\nexport { Scheduler };\n","/**\n * Copyright (c) 2019-2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/**\n * on node `process.env.NODE_ENV` is available, in webpack build it is automatically set\n * by the DefinePlugin to the webpack `mode` value\n */\nlet isProductionMode = function () {\n    try {\n        return process.env.NODE_ENV === 'production';\n    }\n    catch (_a) {\n        return false;\n    }\n}();\n/**\n * set to true to enable more comprehensive checks and assertions,\n * mostly used in `mol-gl` and in valence-model calculation\n */\nlet isDebugMode = function getIsDebug() {\n    try {\n        const val = process.env.DEBUG;\n        return val === '*' || val === 'molstar';\n    }\n    catch (_a) {\n        return false;\n    }\n}();\n/**\n * set to true to gather timings, mostly used in `mol-gl`\n */\nlet isTimingMode = false;\nexport { isProductionMode, isDebugMode, isTimingMode };\nexport function setProductionMode(value) {\n    if (typeof value !== 'undefined')\n        isProductionMode = value;\n}\nexport function setDebugMode(value) {\n    if (typeof value !== 'undefined')\n        isDebugMode = value;\n}\nexport function setTimingMode(value) {\n    if (typeof value !== 'undefined')\n        isTimingMode = value;\n}\nconst consoleStatsProviders = [];\nexport function addConsoleStatsProvider(p) {\n    if (!consoleStatsProviders.includes(p))\n        consoleStatsProviders.push(p);\n}\nexport function removeConsoleStatsProvider(p) {\n    const idx = consoleStatsProviders.indexOf(p);\n    if (idx !== -1)\n        consoleStatsProviders.splice(idx, 1);\n}\nexport function consoleStats() {\n    for (const p of consoleStatsProviders) {\n        p();\n    }\n}\n","/**\n * Copyright (c) 2018-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { isTimingMode } from '../../mol-util/debug';\nconst hasPerformance = (typeof performance !== 'undefined') && !!performance.mark && performance.measure;\nconst timingEnabled = hasPerformance && isTimingMode;\nexport var UserTiming;\n(function (UserTiming) {\n    function startMarkName(task) { return `startTask${task.id}`; }\n    function endMarkName(task) { return `endTask${task.id}`; }\n    function markStart(task) {\n        if (timingEnabled)\n            performance.mark(startMarkName(task));\n    }\n    UserTiming.markStart = markStart;\n    function markEnd(task) {\n        if (timingEnabled)\n            performance.mark(endMarkName(task));\n    }\n    UserTiming.markEnd = markEnd;\n    function measure(task) {\n        if (timingEnabled)\n            performance.measure(` ${task.name}`, startMarkName(task), endMarkName(task));\n    }\n    UserTiming.measure = measure;\n})(UserTiming || (UserTiming = {}));\n","/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Task } from '../task';\nimport { now } from '../../mol-util/now';\nimport { Scheduler } from '../util/scheduler';\nimport { UserTiming } from '../util/user-timing';\nexport function ExecuteObservable(task, observer, updateRateMs = 250) {\n    const info = ProgressInfo(task, observer, updateRateMs);\n    const ctx = new ObservableRuntimeContext(info, info.root);\n    return execute(task, ctx);\n}\nexport function CreateObservableCtx(task, observer, updateRateMs = 250) {\n    const info = ProgressInfo(task, observer, updateRateMs);\n    return new ObservableRuntimeContext(info, info.root);\n}\nexport function ExecuteInContext(ctx, task) {\n    return execute(task, ctx);\n}\nexport function ExecuteObservableChild(ctx, task, progress) {\n    return ctx.runChild(task, progress);\n}\nfunction defaultProgress(task) {\n    return {\n        taskId: task.id,\n        taskName: task.name,\n        message: '',\n        startedTime: 0,\n        canAbort: true,\n        isIndeterminate: true,\n        current: 0,\n        max: 0\n    };\n}\nfunction ProgressInfo(task, observer, updateRateMs) {\n    const abortToken = { abortRequested: false, treeAborted: false, reason: '' };\n    return {\n        updateRateMs,\n        lastNotified: now(),\n        observer,\n        abortToken,\n        taskId: task.id,\n        root: { progress: defaultProgress(task), children: [] },\n        tryAbort: createAbortFunction(abortToken)\n    };\n}\nfunction createAbortFunction(token) {\n    return (reason) => {\n        token.abortRequested = true;\n        token.reason = reason || token.reason;\n    };\n}\nfunction cloneTree(root) {\n    return { progress: { ...root.progress }, children: root.children.map(cloneTree) };\n}\nfunction canAbort(root) {\n    return root.progress.canAbort && root.children.every(canAbort);\n}\nfunction snapshotProgress(info) {\n    return { root: cloneTree(info.root), canAbort: canAbort(info.root), requestAbort: info.tryAbort };\n}\nasync function execute(task, ctx) {\n    UserTiming.markStart(task);\n    ctx.node.progress.startedTime = now();\n    try {\n        const ret = await task.f(ctx);\n        UserTiming.markEnd(task);\n        UserTiming.measure(task);\n        if (ctx.info.abortToken.abortRequested) {\n            abort(ctx.info);\n        }\n        return ret;\n    }\n    catch (e) {\n        if (Task.isAbort(e)) {\n            ctx.isAborted = true;\n            // wait for all child computations to go thru the abort phase.\n            if (ctx.node.children.length > 0) {\n                await new Promise(res => { ctx.onChildrenFinished = res; });\n            }\n            if (task.onAbort) {\n                task.onAbort();\n            }\n        }\n        throw e;\n    }\n}\nfunction abort(info) {\n    if (!info.abortToken.treeAborted) {\n        info.abortToken.treeAborted = true;\n        abortTree(info.root);\n        notifyObserver(info, now());\n    }\n    throw Task.Aborted(info.abortToken.reason);\n}\nfunction abortTree(root) {\n    const progress = root.progress;\n    progress.isIndeterminate = true;\n    progress.canAbort = false;\n    progress.message = 'Aborting...';\n    for (const c of root.children)\n        abortTree(c);\n}\n// function shouldNotify(info: ProgressInfo, time: number) {\n//     return time - info.lastNotified > info.updateRateMs;\n// }\nfunction notifyObserver(info, time) {\n    info.lastNotified = time;\n    const snapshot = snapshotProgress(info);\n    info.observer(snapshot);\n}\nclass ObservableRuntimeContext {\n    checkAborted() {\n        if (this.info.abortToken.abortRequested) {\n            this.isAborted = true;\n            abort(this.info);\n        }\n    }\n    get shouldUpdate() {\n        this.checkAborted();\n        return now() - this.lastUpdatedTime > this.info.updateRateMs;\n    }\n    updateProgress(update) {\n        this.checkAborted();\n        if (!update)\n            return;\n        const progress = this.node.progress;\n        if (typeof update === 'string') {\n            progress.message = update;\n            progress.isIndeterminate = true;\n        }\n        else {\n            if (typeof update.canAbort !== 'undefined')\n                progress.canAbort = update.canAbort;\n            if (typeof update.message !== 'undefined')\n                progress.message = update.message;\n            if (typeof update.current !== 'undefined')\n                progress.current = update.current;\n            if (typeof update.max !== 'undefined')\n                progress.max = update.max;\n            progress.isIndeterminate = typeof progress.current === 'undefined' || typeof progress.max === 'undefined';\n            if (typeof update.isIndeterminate !== 'undefined')\n                progress.isIndeterminate = update.isIndeterminate;\n        }\n    }\n    update(progress, dontNotify) {\n        // The progress tracking and observer notification are separated\n        // because the computation can have a tree structure.\n        // All nodes of the tree should be regualarly updated at the specified frequency,\n        // however, the notification should only be invoked once per the whole tree.\n        this.lastUpdatedTime = now();\n        this.updateProgress(progress);\n        // TODO: do the shouldNotify check here?\n        if (!!dontNotify /* || !shouldNotify(this.info, this.lastUpdatedTime)*/)\n            return;\n        notifyObserver(this.info, this.lastUpdatedTime);\n        // The computation could have been aborted during the notifycation phase.\n        this.checkAborted();\n        return Scheduler.immediatePromise();\n    }\n    async runChild(task, progress) {\n        this.updateProgress(progress);\n        // Create a new child context and add it to the progress tree.\n        // When the child task finishes, remove the tree node.\n        const node = { progress: defaultProgress(task), children: [] };\n        const children = this.node.children;\n        children.push(node);\n        const ctx = new ObservableRuntimeContext(this.info, node);\n        try {\n            return await execute(task, ctx);\n        }\n        catch (e) {\n            if (Task.isAbort(e)) {\n                // need to catch the error here because otherwise\n                // promises for running child tasks in a tree-like computation\n                // will get orphaned and cause \"uncaught error in Promise\".\n                if (this.isAborted)\n                    return void 0;\n            }\n            throw e;\n        }\n        finally {\n            // remove the progress node after the computation has finished.\n            const idx = children.indexOf(node);\n            if (idx >= 0) {\n                for (let i = idx, _i = children.length - 1; i < _i; i++) {\n                    children[i] = children[i + 1];\n                }\n                children.pop();\n            }\n            if (children.length === 0 && this.onChildrenFinished)\n                this.onChildrenFinished();\n        }\n    }\n    constructor(info, node) {\n        this.isSynchronous = false;\n        this.isExecuting = true;\n        this.lastUpdatedTime = 0;\n        // used for waiting for cancelled computation trees\n        this.onChildrenFinished = void 0;\n        this.node = node;\n        this.info = info;\n    }\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport class SynchronousRuntimeContext {\n    constructor() {\n        this.shouldUpdate = false;\n        this.isSynchronous = true;\n    }\n    update(progress, dontNotify) { }\n}\nexport const SyncRuntimeContext = new SynchronousRuntimeContext();\n","/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { ExecuteObservable, ExecuteObservableChild, ExecuteInContext } from './execution/observable';\nimport { SyncRuntimeContext } from './execution/synchronous';\nimport { idFactory } from '../mol-util/id-factory';\nvar Task;\n(function (Task) {\n    class Impl {\n        run(observer, updateRateMs = 250) {\n            if (observer)\n                return ExecuteObservable(this, observer, updateRateMs);\n            return this.f(SyncRuntimeContext);\n        }\n        runAsChild(ctx, progress) {\n            if (ctx.isSynchronous)\n                return this.f(SyncRuntimeContext);\n            return ExecuteObservableChild(ctx, this, progress);\n        }\n        runInContext(ctx) {\n            if (ctx.isSynchronous)\n                return this.f(SyncRuntimeContext);\n            return ExecuteInContext(ctx, this);\n        }\n        constructor(name, f, onAbort) {\n            this.name = name;\n            this.f = f;\n            this.onAbort = onAbort;\n            this.id = getNextId();\n        }\n    }\n    function is(t) {\n        const _t = t;\n        return !!t && typeof _t.id === 'number' && typeof _t.name === 'string' && !!_t.run;\n    }\n    Task.is = is;\n    function isAbort(e) { return !!e && !!e.isAborted; }\n    Task.isAbort = isAbort;\n    function Aborted(reason) { return { isAborted: true, reason, toString() { return `Aborted${reason ? ': ' + reason : ''}`; } }; }\n    Task.Aborted = Aborted;\n    function create(name, f, onAbort) {\n        return new Impl(name, f, onAbort);\n    }\n    Task.create = create;\n    function constant(name, value) { return create(name, async (ctx) => value); }\n    Task.constant = constant;\n    function empty() { return create('', async (ctx) => { }); }\n    Task.empty = empty;\n    function fail(name, reason) { return create(name, async (ctx) => { throw new Error(reason); }); }\n    Task.fail = fail;\n    function resolveInContext(object, ctx) {\n        if (is(object))\n            return ctx ? object.runInContext(ctx) : object.run();\n        return object;\n    }\n    Task.resolveInContext = resolveInContext;\n    const getNextId = idFactory(0, 0x3fffffff);\n})(Task || (Task = {}));\nexport { Task };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { SyncRuntimeContext } from './synchronous';\nvar RuntimeContext;\n(function (RuntimeContext) {\n    RuntimeContext.Synchronous = SyncRuntimeContext;\n})(RuntimeContext || (RuntimeContext = {}));\nexport { RuntimeContext };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nvar Progress;\n(function (Progress) {\n    function _format(root, prefix = '') {\n        const p = root.progress;\n        if (!root.children.length) {\n            if (p.isIndeterminate)\n                return `${prefix}${p.taskName}: ${p.message}`;\n            return `${prefix}${p.taskName}: [${p.current}/${p.max}] ${p.message}`;\n        }\n        const newPrefix = prefix + '  |_ ';\n        const subTree = root.children.map(c => _format(c, newPrefix));\n        if (p.isIndeterminate)\n            return `${prefix}${p.taskName}: ${p.message}\\n${subTree.join('\\n')}`;\n        return `${prefix}${p.taskName}: [${p.current}/${p.max}] ${p.message}\\n${subTree.join('\\n')}`;\n    }\n    function format(p) { return _format(p.root); }\n    Progress.format = format;\n})(Progress || (Progress = {}));\nexport { Progress };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * mostly from https://github.com/dsehnal/CIFTools.js\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { chunkedSubtask } from '../../../../mol-task';\nexport { Tokenizer };\nfunction Tokenizer(data) {\n    return {\n        data,\n        position: 0,\n        length: data.length,\n        lineNumber: 1,\n        tokenStart: 0,\n        tokenEnd: 0\n    };\n}\n(function (Tokenizer) {\n    function getTokenString(state) {\n        return state.data.substring(state.tokenStart, state.tokenEnd);\n    }\n    Tokenizer.getTokenString = getTokenString;\n    /** Resets the state */\n    function reset(state) {\n        state.position = 0;\n        state.lineNumber = 1;\n        state.tokenStart = 0;\n        state.tokenEnd = 0;\n    }\n    Tokenizer.reset = reset;\n    /**\n     * Eat everything until a newline occurs.\n     */\n    function eatLine(state) {\n        const { data } = state;\n        while (state.position < state.length) {\n            switch (data.charCodeAt(state.position)) {\n                case 10: // \\n\n                    state.tokenEnd = state.position;\n                    ++state.position;\n                    ++state.lineNumber;\n                    return true;\n                case 13: // \\r\n                    state.tokenEnd = state.position;\n                    ++state.position;\n                    ++state.lineNumber;\n                    if (data.charCodeAt(state.position) === 10) {\n                        ++state.position;\n                    }\n                    return true;\n                default:\n                    ++state.position;\n                    break;\n            }\n        }\n        state.tokenEnd = state.position;\n        return state.tokenStart !== state.tokenEnd;\n    }\n    Tokenizer.eatLine = eatLine;\n    /** Sets the current token start to the current position */\n    function markStart(state) {\n        state.tokenStart = state.position;\n    }\n    Tokenizer.markStart = markStart;\n    /** Sets the current token start to current position and moves to the next line. */\n    function markLine(state) {\n        state.tokenStart = state.position;\n        return eatLine(state);\n    }\n    Tokenizer.markLine = markLine;\n    /** Advance the state and return line as string. */\n    function readLine(state) {\n        markLine(state);\n        return getTokenString(state);\n    }\n    Tokenizer.readLine = readLine;\n    /** Advance the state and return trimmed line as string. */\n    function readLineTrim(state) {\n        markLine(state);\n        const position = state.position;\n        trim(state, state.tokenStart, state.tokenEnd);\n        state.position = position;\n        return getTokenString(state);\n    }\n    Tokenizer.readLineTrim = readLineTrim;\n    function readLinesChunk(state, count, tokens) {\n        let read = 0;\n        for (let i = 0; i < count; i++) {\n            if (!markLine(state))\n                return read;\n            TokenBuilder.addUnchecked(tokens, state.tokenStart, state.tokenEnd);\n            read++;\n        }\n        return read;\n    }\n    /** Advance the state by the given number of lines and return them*/\n    function markLines(state, count) {\n        const lineTokens = TokenBuilder.create(state.data, count * 2);\n        readLinesChunk(state, count, lineTokens);\n        return lineTokens;\n    }\n    Tokenizer.markLines = markLines;\n    /** Advance the state by the given number of lines and return them */\n    function readLines(state, count) {\n        const ret = [];\n        for (let i = 0; i < count; i++) {\n            ret.push(Tokenizer.readLine(state));\n        }\n        return ret;\n    }\n    Tokenizer.readLines = readLines;\n    /** Advance the state by the given number of lines and return line starts/ends as tokens. */\n    async function readLinesAsync(state, count, ctx, initialLineCount = 100000) {\n        const lineTokens = TokenBuilder.create(state.data, count * 2);\n        let linesAlreadyRead = 0;\n        await chunkedSubtask(ctx, initialLineCount, state, (chunkSize, state) => {\n            const linesToRead = Math.min(count - linesAlreadyRead, chunkSize);\n            readLinesChunk(state, linesToRead, lineTokens);\n            linesAlreadyRead += linesToRead;\n            return linesToRead;\n        }, (ctx, state) => ctx.update({ message: 'Parsing...', current: state.position, max: state.length }));\n        return lineTokens;\n    }\n    Tokenizer.readLinesAsync = readLinesAsync;\n    function readAllLines(data) {\n        const state = Tokenizer(data);\n        const tokens = TokenBuilder.create(state.data, Math.max(data.length / 80, 2));\n        while (markLine(state)) {\n            TokenBuilder.add(tokens, state.tokenStart, state.tokenEnd);\n        }\n        return tokens;\n    }\n    Tokenizer.readAllLines = readAllLines;\n    function readLinesChunkChecked(state, count, tokens) {\n        let read = 0;\n        for (let i = 0; i < count; i++) {\n            if (!markLine(state))\n                return read;\n            TokenBuilder.add(tokens, state.tokenStart, state.tokenEnd);\n            read++;\n        }\n        return read;\n    }\n    async function readAllLinesAsync(data, ctx, chunkSize = 100000) {\n        const state = Tokenizer(data);\n        const tokens = TokenBuilder.create(state.data, Math.max(data.length / 80, 2));\n        await chunkedSubtask(ctx, chunkSize, state, (chunkSize, state) => {\n            readLinesChunkChecked(state, chunkSize, tokens);\n            return state.position < state.length ? chunkSize : 0;\n        }, (ctx, state) => ctx.update({ message: 'Parsing...', current: state.position, max: state.length }));\n        return tokens;\n    }\n    Tokenizer.readAllLinesAsync = readAllLinesAsync;\n    /**\n     * Eat everything until a whitespace/newline occurs.\n     */\n    function eatValue(state) {\n        while (state.position < state.length) {\n            switch (state.data.charCodeAt(state.position)) {\n                case 9: // \\t\n                case 10: // \\n\n                case 13: // \\r\n                case 32: // ' '\n                    state.tokenEnd = state.position;\n                    return;\n                default:\n                    ++state.position;\n                    break;\n            }\n        }\n        state.tokenEnd = state.position;\n    }\n    Tokenizer.eatValue = eatValue;\n    /**\n     * Skips all the whitespace - space, tab, newline, CR\n     * Handles incrementing line count.\n     */\n    function skipWhitespace(state) {\n        let prev = -1;\n        while (state.position < state.length) {\n            const c = state.data.charCodeAt(state.position);\n            switch (c) {\n                case 9: // '\\t'\n                case 32: // ' '\n                    prev = c;\n                    ++state.position;\n                    break;\n                case 10: // \\n\n                    // handle \\r\\n\n                    if (prev !== 13) {\n                        ++state.lineNumber;\n                    }\n                    prev = c;\n                    ++state.position;\n                    break;\n                case 13: // \\r\n                    prev = c;\n                    ++state.position;\n                    ++state.lineNumber;\n                    break;\n                default:\n                    return prev;\n            }\n        }\n        return prev;\n    }\n    Tokenizer.skipWhitespace = skipWhitespace;\n    /** Trims spaces and tabs */\n    function trim(state, start, end) {\n        const { data } = state;\n        let s = start, e = end - 1;\n        let c = data.charCodeAt(s);\n        while ((c === 9 || c === 32) && s <= e)\n            c = data.charCodeAt(++s);\n        c = data.charCodeAt(e);\n        while ((c === 9 || c === 32) && e >= s)\n            c = data.charCodeAt(--e);\n        state.tokenStart = s;\n        state.tokenEnd = e + 1;\n        state.position = end;\n        return state;\n    }\n    Tokenizer.trim = trim;\n})(Tokenizer || (Tokenizer = {}));\nexport function trimStr(data, start, end) {\n    let s = start, e = end - 1;\n    let c = data.charCodeAt(s);\n    while ((c === 9 || c === 32) && s <= e)\n        c = data.charCodeAt(++s);\n    c = data.charCodeAt(e);\n    while ((c === 9 || c === 32) && e >= s)\n        c = data.charCodeAt(--e);\n    return data.substring(s, e + 1);\n}\nexport var TokenBuilder;\n(function (TokenBuilder) {\n    function resize(builder) {\n        // scale the size using golden ratio, because why not.\n        const newBuffer = new Uint32Array((1.61 * builder.indices.length) | 0);\n        newBuffer.set(builder.indices);\n        builder.indices = newBuffer;\n        builder.indicesLenMinus2 = (newBuffer.length - 2) | 0;\n    }\n    function add(tokens, start, end) {\n        const builder = tokens;\n        if (builder.offset > builder.indicesLenMinus2) {\n            resize(builder);\n        }\n        builder.indices[builder.offset++] = start;\n        builder.indices[builder.offset++] = end;\n        tokens.count++;\n    }\n    TokenBuilder.add = add;\n    function addToken(tokens, tokenizer) {\n        add(tokens, tokenizer.tokenStart, tokenizer.tokenEnd);\n    }\n    TokenBuilder.addToken = addToken;\n    function addUnchecked(tokens, start, end) {\n        tokens.indices[tokens.offset++] = start;\n        tokens.indices[tokens.offset++] = end;\n        tokens.count++;\n    }\n    TokenBuilder.addUnchecked = addUnchecked;\n    function create(data, size) {\n        size = Math.max(10, size);\n        return {\n            data,\n            indicesLenMinus2: (size - 2) | 0,\n            count: 0,\n            offset: 0,\n            indices: new Uint32Array(size)\n        };\n    }\n    TokenBuilder.create = create;\n})(TokenBuilder || (TokenBuilder = {}));\n","/*\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * from https://github.com/dsehnal/CIFTools.js\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nvar ReaderResult;\n(function (ReaderResult) {\n    function error(message, line = -1) {\n        return new Error(message, line);\n    }\n    ReaderResult.error = error;\n    function success(result, warnings = []) {\n        return new Success(result, warnings);\n    }\n    ReaderResult.success = success;\n    class Error {\n        toString() {\n            if (this.line >= 0) {\n                return `[Line ${this.line}] ${this.message}`;\n            }\n            return this.message;\n        }\n        constructor(message, line) {\n            this.message = message;\n            this.line = line;\n            this.isError = true;\n        }\n    }\n    ReaderResult.Error = Error;\n    class Success {\n        constructor(result, warnings) {\n            this.result = result;\n            this.warnings = warnings;\n            this.isError = false;\n        }\n    }\n    ReaderResult.Success = Success;\n})(ReaderResult || (ReaderResult = {}));\nexport { ReaderResult };\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * From CIFTools.js\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport const VERSION = '0.3.0';\nexport var Encoding;\n(function (Encoding) {\n    let IntDataType;\n    (function (IntDataType) {\n        IntDataType[IntDataType[\"Int8\"] = 1] = \"Int8\";\n        IntDataType[IntDataType[\"Int16\"] = 2] = \"Int16\";\n        IntDataType[IntDataType[\"Int32\"] = 3] = \"Int32\";\n        IntDataType[IntDataType[\"Uint8\"] = 4] = \"Uint8\";\n        IntDataType[IntDataType[\"Uint16\"] = 5] = \"Uint16\";\n        IntDataType[IntDataType[\"Uint32\"] = 6] = \"Uint32\";\n    })(IntDataType = Encoding.IntDataType || (Encoding.IntDataType = {}));\n    let FloatDataType;\n    (function (FloatDataType) {\n        FloatDataType[FloatDataType[\"Float32\"] = 32] = \"Float32\";\n        FloatDataType[FloatDataType[\"Float64\"] = 33] = \"Float64\";\n    })(FloatDataType = Encoding.FloatDataType || (Encoding.FloatDataType = {}));\n    function getDataType(data) {\n        let srcType;\n        if (data instanceof Int8Array)\n            srcType = Encoding.IntDataType.Int8;\n        else if (data instanceof Int16Array)\n            srcType = Encoding.IntDataType.Int16;\n        else if (data instanceof Int32Array)\n            srcType = Encoding.IntDataType.Int32;\n        else if (data instanceof Uint8Array)\n            srcType = Encoding.IntDataType.Uint8;\n        else if (data instanceof Uint16Array)\n            srcType = Encoding.IntDataType.Uint16;\n        else if (data instanceof Uint32Array)\n            srcType = Encoding.IntDataType.Uint32;\n        else if (data instanceof Float32Array)\n            srcType = Encoding.FloatDataType.Float32;\n        else if (data instanceof Float64Array)\n            srcType = Encoding.FloatDataType.Float64;\n        else\n            srcType = Encoding.IntDataType.Int32; // throw new Error('Unsupported integer data type.');\n        return srcType;\n    }\n    Encoding.getDataType = getDataType;\n    function isSignedIntegerDataType(data) {\n        if (data instanceof Int8Array || data instanceof Int16Array || data instanceof Int32Array)\n            return true;\n        for (let i = 0, _i = data.length; i < _i; i++) {\n            if (i < 0)\n                return false;\n        }\n        return true;\n    }\n    Encoding.isSignedIntegerDataType = isSignedIntegerDataType;\n})(Encoding || (Encoding = {}));\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { now } from '../../mol-util/now';\nasync function chunkedSubtask(ctx, initialChunk, state, f, update) {\n    let chunkSize = Math.max(initialChunk, 0);\n    let globalProcessed = 0, globalTime = 0;\n    if (ctx.isSynchronous) {\n        f(Number.MAX_SAFE_INTEGER, state);\n        return state;\n    }\n    let start = now();\n    let lastSize = 0, currentTime = 0;\n    while ((lastSize = f(chunkSize, state)) > 0) {\n        globalProcessed += lastSize;\n        const delta = now() - start;\n        currentTime += delta;\n        globalTime += delta;\n        if (ctx.shouldUpdate) {\n            await update(ctx, state, globalProcessed);\n            chunkSize = Math.round(currentTime * globalProcessed / globalTime) + 1;\n            start = now();\n            currentTime = 0;\n        }\n    }\n    if (ctx.shouldUpdate) {\n        await update(ctx, state, globalProcessed);\n    }\n    return state;\n}\nexport { chunkedSubtask };\n","/**\n * Copyright (c) 2017-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/**\n * mmCIF parser.\n *\n * Trying to be as close to the specification http://www.iucr.org/resources/cif/spec/version1.1/cifsyntax\n *\n * Differences I'm aware of:\n * - Except keywords (data_, loop_, save_) everything is case sensitive.\n * - The tokens . and ? are treated the same as the values '.' and '?'.\n * - Ignores \\ in the multiline values:\n *     ;abc\\\n *     efg\n *     ;\n *   should have the value 'abcefg' but will have the value 'abc\\\\nefg' instead.\n *   Post processing of this is left to the consumer of the data.\n * - Similarly, things like punctuation (\\', ..) are left to be processed by the user if needed.\n *\n */\nimport * as Data from '../data-model';\nimport { TokenBuilder, Tokenizer } from '../../common/text/tokenizer';\nimport { ReaderResult as Result } from '../../result';\nimport { Task, chunkedSubtask } from '../../../../mol-task';\n/**\n * Eat everything until a whitespace/newline occurs.\n */\nfunction eatValue(state) {\n    while (state.position < state.length) {\n        switch (state.data.charCodeAt(state.position)) {\n            case 9: // \\t\n            case 10: // \\n\n            case 13: // \\r\n            case 32: // ' '\n                state.tokenEnd = state.position;\n                return;\n            default:\n                ++state.position;\n                break;\n        }\n    }\n    state.tokenEnd = state.position;\n}\n/**\n * Eats an escaped value. Handles the \"degenerate\" cases as well.\n *\n * \"Degenerate\" cases:\n * - 'xx'x' => xx'x\n * - 'xxxNEWLINE => 'xxx\n *\n */\nfunction eatEscaped(state, esc) {\n    let next, c;\n    ++state.position;\n    while (state.position < state.length) {\n        c = state.data.charCodeAt(state.position);\n        if (c === esc) {\n            next = state.data.charCodeAt(state.position + 1);\n            switch (next) {\n                case 9: // \\t\n                case 10: // \\n\n                case 13: // \\r\n                case 32: // ' '\n                    // get rid of the quotes.\n                    state.tokenStart++;\n                    state.tokenEnd = state.position;\n                    state.isEscaped = true;\n                    ++state.position;\n                    return;\n                default:\n                    if (next === void 0) { // = \"end of stream\"\n                        // get rid of the quotes.\n                        state.tokenStart++;\n                        state.tokenEnd = state.position;\n                        state.isEscaped = true;\n                        ++state.position;\n                        return;\n                    }\n                    ++state.position;\n                    break;\n            }\n        }\n        else {\n            // handle 'xxxNEWLINE => 'xxx\n            if (c === 10 || c === 13) {\n                state.tokenEnd = state.position;\n                return;\n            }\n            ++state.position;\n        }\n    }\n    state.tokenEnd = state.position;\n}\n/**\n * Eats an escaped value \"triple quote\" (''') value.\n */\nfunction eatTripleQuote(state) {\n    // skip the '''\n    state.position += 3;\n    while (state.position < state.length) {\n        if (state.data.charCodeAt(state.position) === 39 /* ' */ && isTripleQuoteAtPosition(state)) {\n            // get rid of the quotes.\n            state.tokenStart += 3;\n            state.tokenEnd = state.position;\n            state.isEscaped = true;\n            state.position += 3;\n            return;\n        }\n        ++state.position;\n    }\n    state.tokenEnd = state.position;\n}\n/**\n * Eats a multiline token of the form NL;....NL;\n */\nfunction eatMultiline(state) {\n    let prev = 59, pos = state.position + 1, c;\n    while (pos < state.length) {\n        c = state.data.charCodeAt(pos);\n        if (c === 59 && (prev === 10 || prev === 13)) { // ;, \\n \\r\n            state.position = pos + 1;\n            // get rid of the ;\n            state.tokenStart++;\n            // remove trailing newlines\n            pos--;\n            c = state.data.charCodeAt(pos);\n            while (c === 10 || c === 13) {\n                pos--;\n                c = state.data.charCodeAt(pos);\n            }\n            state.tokenEnd = pos + 1;\n            state.isEscaped = true;\n            return;\n        }\n        else {\n            // handle line numbers\n            if (c === 13) { // \\r\n                state.lineNumber++;\n            }\n            else if (c === 10 && prev !== 13) { // \\r\\n\n                state.lineNumber++;\n            }\n            prev = c;\n            ++pos;\n        }\n    }\n    state.position = pos;\n    return prev;\n}\nfunction eatImportGet(state) {\n    // _import.get [{'save':orient_matrix  'file':templ_attr.cif}]\n    // skipWhitespace(state)\n    while (state.position < state.length) {\n        switch (state.data.charCodeAt(state.position)) {\n            case 93: // ]\n                ++state.position;\n                state.tokenEnd = state.position;\n                state.isImportGet = false;\n                return;\n            default:\n                ++state.position;\n                break;\n        }\n    }\n}\n/**\n * Skips until \\n or \\r occurs -- therefore the newlines get handled by the \"skipWhitespace\" function.\n */\nfunction skipCommentLine(state) {\n    while (state.position < state.length) {\n        const c = state.data.charCodeAt(state.position);\n        if (c === 10 || c === 13) {\n            return;\n        }\n        ++state.position;\n    }\n}\n/**\n * Skips all the whitespace - space, tab, newline, CR\n * Handles incrementing line count.\n */\nfunction skipWhitespace(state) {\n    let prev = 10;\n    while (state.position < state.length) {\n        const c = state.data.charCodeAt(state.position);\n        switch (c) {\n            case 9: // '\\t'\n            case 32: // ' '\n                prev = c;\n                ++state.position;\n                break;\n            case 10: // \\n\n                // handle \\r\\n\n                if (prev !== 13) {\n                    ++state.lineNumber;\n                }\n                prev = c;\n                ++state.position;\n                break;\n            case 13: // \\r\n                prev = c;\n                ++state.position;\n                ++state.lineNumber;\n                break;\n            default:\n                return prev;\n        }\n    }\n    return prev;\n}\n/**\n * Returns true if there are two consecutive ' in +1 and +2 positions.\n */\nfunction isTripleQuoteAtPosition(state) {\n    if (state.length - state.position < 2)\n        return false;\n    if (state.data.charCodeAt(state.position + 1) !== 39)\n        return false; // '\n    if (state.data.charCodeAt(state.position + 2) !== 39)\n        return false; // '\n    return true;\n}\nfunction isData(state) {\n    // here we already assume the 5th char is _ and that the length >= 5\n    // d/D\n    let c = state.data.charCodeAt(state.tokenStart);\n    if (c !== 68 && c !== 100)\n        return false;\n    // a/A\n    c = state.data.charCodeAt(state.tokenStart + 1);\n    if (c !== 65 && c !== 97)\n        return false;\n    // t/t\n    c = state.data.charCodeAt(state.tokenStart + 2);\n    if (c !== 84 && c !== 116)\n        return false;\n    // a/A\n    c = state.data.charCodeAt(state.tokenStart + 3);\n    if (c !== 65 && c !== 97)\n        return false;\n    return true;\n}\nfunction isSave(state) {\n    // here we already assume the 5th char is _ and that the length >= 5\n    // s/S\n    let c = state.data.charCodeAt(state.tokenStart);\n    if (c !== 83 && c !== 115)\n        return false;\n    // a/A\n    c = state.data.charCodeAt(state.tokenStart + 1);\n    if (c !== 65 && c !== 97)\n        return false;\n    // v/V\n    c = state.data.charCodeAt(state.tokenStart + 2);\n    if (c !== 86 && c !== 118)\n        return false;\n    // e/E\n    c = state.data.charCodeAt(state.tokenStart + 3);\n    if (c !== 69 && c !== 101)\n        return false;\n    return true;\n}\nfunction isLoop(state) {\n    // here we already assume the 5th char is _ and that the length >= 5\n    if (state.tokenEnd - state.tokenStart !== 5)\n        return false;\n    // l/L\n    let c = state.data.charCodeAt(state.tokenStart);\n    if (c !== 76 && c !== 108)\n        return false;\n    // o/O\n    c = state.data.charCodeAt(state.tokenStart + 1);\n    if (c !== 79 && c !== 111)\n        return false;\n    // o/O\n    c = state.data.charCodeAt(state.tokenStart + 2);\n    if (c !== 79 && c !== 111)\n        return false;\n    // p/P\n    c = state.data.charCodeAt(state.tokenStart + 3);\n    if (c !== 80 && c !== 112)\n        return false;\n    return true;\n}\nfunction isImportGet(state) {\n    // _import.get [{'save':orient_matrix  'file':templ_attr.cif}]\n    if (state.tokenEnd - state.tokenStart !== 11)\n        return false;\n    if (state.data.charCodeAt(state.tokenStart + 1) !== 105)\n        return false; // i\n    if (state.data.charCodeAt(state.tokenStart + 2) !== 109)\n        return false; // m\n    if (state.data.charCodeAt(state.tokenStart + 3) !== 112)\n        return false; // p\n    if (state.data.charCodeAt(state.tokenStart + 4) !== 111)\n        return false; // o\n    if (state.data.charCodeAt(state.tokenStart + 5) !== 114)\n        return false; // r\n    if (state.data.charCodeAt(state.tokenStart + 6) !== 116)\n        return false; // t\n    if (state.data.charCodeAt(state.tokenStart + 7) !== 46)\n        return false; // .\n    if (state.data.charCodeAt(state.tokenStart + 8) !== 103)\n        return false; // g\n    if (state.data.charCodeAt(state.tokenStart + 9) !== 101)\n        return false; // e\n    if (state.data.charCodeAt(state.tokenStart + 10) !== 116)\n        return false; // t\n    return true;\n}\n/**\n * Checks if the current token shares the namespace with string at <start,end).\n */\nfunction isNamespace(state, start, end) {\n    let i;\n    const nsLen = end - start;\n    const offset = state.tokenStart - start;\n    const tokenLen = state.tokenEnd - state.tokenStart;\n    if (tokenLen < nsLen)\n        return false;\n    for (i = start; i < end; ++i) {\n        if (state.data.charCodeAt(i) !== state.data.charCodeAt(i + offset))\n            return false;\n    }\n    if (nsLen === tokenLen)\n        return true;\n    if (state.data.charCodeAt(i + offset) === 46) { // .\n        return true;\n    }\n    return false;\n}\n/**\n * Returns the index of '.' in the current token. If no '.' is present, returns currentTokenEnd.\n */\nfunction getNamespaceEnd(state) {\n    let i;\n    for (i = state.tokenStart; i < state.tokenEnd; ++i) {\n        if (state.data.charCodeAt(i) === 46)\n            return i;\n    }\n    return i;\n}\n/**\n * Get the namespace string. endIndex is obtained by the getNamespaceEnd() function.\n */\nfunction getNamespace(state, endIndex) {\n    return state.data.substring(state.tokenStart, endIndex);\n}\n/**\n * Returns true if the current token contain no '.', otherwise returns false.\n */\nfunction isFlatNamespace(state) {\n    let i;\n    for (i = state.tokenStart; i < state.tokenEnd; ++i) {\n        if (state.data.charCodeAt(i) === 46)\n            return false;\n    }\n    return true;\n}\n/**\n * String representation of the current token.\n */\nfunction getTokenString(state) {\n    return state.data.substring(state.tokenStart, state.tokenEnd);\n}\n/**\n * Move to the next token.\n */\nfunction moveNextInternal(state) {\n    const prev = skipWhitespace(state);\n    if (state.position >= state.length) {\n        state.tokenType = 6 /* CifTokenType.End */;\n        return;\n    }\n    state.tokenStart = state.position;\n    state.tokenEnd = state.position;\n    state.isEscaped = false;\n    const c = state.data.charCodeAt(state.position);\n    switch (c) {\n        case 35: // #, comment\n            skipCommentLine(state);\n            state.tokenType = 5 /* CifTokenType.Comment */;\n            break;\n        case 39: // ', escaped value\n            if (isTripleQuoteAtPosition(state)) {\n                eatTripleQuote(state);\n                state.tokenType = 3 /* CifTokenType.Value */;\n                break;\n            }\n        case 34: // \", escaped value\n            eatEscaped(state, c);\n            state.tokenType = 3 /* CifTokenType.Value */;\n            break;\n        case 59: // ;, possible multiline value\n            // multiline value must start at the beginning of the line.\n            if (prev === 10 || prev === 13) { // /n or /r\n                eatMultiline(state);\n            }\n            else {\n                eatValue(state);\n            }\n            state.tokenType = 3 /* CifTokenType.Value */;\n            break;\n        default:\n            if (state.isImportGet) {\n                eatImportGet(state);\n            }\n            else {\n                eatValue(state);\n            }\n            // escaped is always Value\n            if (state.isEscaped) {\n                state.tokenType = 3 /* CifTokenType.Value */;\n                // _ means column name, including _import.get\n            }\n            else if (state.data.charCodeAt(state.tokenStart) === 95) { // _\n                if (state.inSaveFrame && isImportGet(state)) {\n                    state.isImportGet = true;\n                }\n                state.tokenType = 4 /* CifTokenType.ColumnName */;\n                // 5th char needs to be _ for data_, save_ or loop_\n            }\n            else if (state.tokenEnd - state.tokenStart >= 5 && state.data.charCodeAt(state.tokenStart + 4) === 95) {\n                if (isData(state))\n                    state.tokenType = 0 /* CifTokenType.Data */;\n                else if (isSave(state))\n                    state.tokenType = 1 /* CifTokenType.Save */;\n                else if (isLoop(state))\n                    state.tokenType = 2 /* CifTokenType.Loop */;\n                else\n                    state.tokenType = 3 /* CifTokenType.Value */;\n                // all other tests failed, we are at Value token.\n            }\n            else {\n                state.tokenType = 3 /* CifTokenType.Value */;\n            }\n            break;\n    }\n}\n/**\n * Moves to the next non-comment token.\n */\nfunction moveNext(state) {\n    moveNextInternal(state);\n    while (state.tokenType === 5 /* CifTokenType.Comment */)\n        moveNextInternal(state);\n}\nfunction createTokenizer(data, runtimeCtx) {\n    return {\n        data,\n        length: data.length,\n        position: 0,\n        tokenStart: 0,\n        tokenEnd: 0,\n        tokenType: 6 /* CifTokenType.End */,\n        lineNumber: 1,\n        isEscaped: false,\n        isImportGet: false,\n        inSaveFrame: false,\n        runtimeCtx\n    };\n}\nfunction FrameContext() {\n    return { categoryNames: [], categoryData: Object.create(null) };\n}\nfunction CifCategories(categoryNames, categoryData) {\n    const categories = Object.create(null);\n    for (const name of categoryNames) {\n        const d = categoryData[name];\n        categories[name] = Data.CifCategory(d.name, d.rowCount, d.fieldNames, d.fields);\n    }\n    return categories;\n}\nfunction CifBlock(ctx, header, saveFrames) {\n    return Data.CifBlock(ctx.categoryNames, CifCategories(ctx.categoryNames, ctx.categoryData), header, saveFrames);\n}\nfunction CifSaveFrame(ctx, header) {\n    return Data.CifBlock(ctx.categoryNames, CifCategories(ctx.categoryNames, ctx.categoryData), header);\n}\nfunction addFields(ctx, name, rowCount, fieldNames, fields) {\n    if (name in ctx.categoryData) {\n        const cat = ctx.categoryData[name];\n        cat.fieldNames.push(...fieldNames);\n        Object.assign(cat.fields, fields);\n    }\n    else {\n        ctx.categoryData[name] = { name, rowCount, fieldNames, fields };\n        ctx.categoryNames.push(name);\n    }\n}\n/**\n * Reads a category containing a single row.\n */\nfunction handleSingle(tokenizer, ctx) {\n    const nsStart = tokenizer.tokenStart, nsEnd = getNamespaceEnd(tokenizer);\n    const name = getNamespace(tokenizer, nsEnd);\n    const fields = Object.create(null);\n    const fieldNames = [];\n    let readingNames = true;\n    while (readingNames) {\n        if (tokenizer.tokenType !== 4 /* CifTokenType.ColumnName */ || !isNamespace(tokenizer, nsStart, nsEnd)) {\n            readingNames = false;\n            break;\n        }\n        const fieldName = getTokenString(tokenizer).substring(name.length + 1);\n        moveNext(tokenizer);\n        if (tokenizer.tokenType !== 3 /* CifTokenType.Value */) {\n            return {\n                hasError: true,\n                errorLine: tokenizer.lineNumber,\n                errorMessage: 'Expected value.'\n            };\n        }\n        fields[fieldName] = Data.CifField.ofTokens({ data: tokenizer.data, indices: [tokenizer.tokenStart, tokenizer.tokenEnd], count: 1 });\n        fieldNames[fieldNames.length] = fieldName;\n        moveNext(tokenizer);\n    }\n    addFields(ctx, name.substr(1), 1, fieldNames, fields);\n    return {\n        hasError: false,\n        errorLine: 0,\n        errorMessage: ''\n    };\n}\nfunction readLoopChunk(chunkSize, state) {\n    const { tokenizer, tokens, fieldCount } = state;\n    let tokenCount = state.tokenCount;\n    let counter = 0;\n    while (tokenizer.tokenType === 3 /* CifTokenType.Value */ && counter < chunkSize) {\n        TokenBuilder.add(tokens[(tokenCount++) % fieldCount], tokenizer.tokenStart, tokenizer.tokenEnd);\n        moveNext(tokenizer);\n        counter++;\n    }\n    state.tokenCount = tokenCount;\n    return counter;\n}\nfunction updateLoopChunk(ctx, state) {\n    return ctx.update({ message: 'Parsing...', current: state.tokenizer.position, max: state.tokenizer.data.length });\n}\n// const readLoopChunks = ChunkedSubtask(1000000,\n//     (size, state: LoopReadState) => readLoopChunk(state, size),\n//     (ctx, state) => ctx.update({ message: 'Parsing...', current: state.tokenizer.position, max: state.tokenizer.data.length }));\n/**\n * Reads a loop.\n */\nasync function handleLoop(tokenizer, ctx) {\n    const loopLine = tokenizer.lineNumber;\n    moveNext(tokenizer);\n    const name = getNamespace(tokenizer, getNamespaceEnd(tokenizer));\n    const isFlat = isFlatNamespace(tokenizer);\n    const fieldNames = [];\n    while (tokenizer.tokenType === 4 /* CifTokenType.ColumnName */) {\n        fieldNames[fieldNames.length] = isFlat\n            ? getTokenString(tokenizer)\n            : getTokenString(tokenizer).substring(name.length + 1);\n        moveNext(tokenizer);\n    }\n    const rowCountEstimate = name === '_atom_site' ? (tokenizer.data.length / 100) | 0 : 32;\n    const tokens = [];\n    const fieldCount = fieldNames.length;\n    for (let i = 0; i < fieldCount; i++)\n        tokens[i] = TokenBuilder.create(tokenizer.data, rowCountEstimate);\n    const state = {\n        fieldCount,\n        tokenCount: 0,\n        tokenizer,\n        tokens\n    };\n    await chunkedSubtask(tokenizer.runtimeCtx, 1000000, state, readLoopChunk, updateLoopChunk);\n    if (state.tokenCount % fieldCount !== 0) {\n        return {\n            hasError: true,\n            errorLine: tokenizer.lineNumber,\n            errorMessage: `The number of values for loop starting at line ${loopLine} is not a multiple of the number of columns.`\n        };\n    }\n    const rowCount = (state.tokenCount / fieldCount) | 0;\n    if (isFlat) {\n        for (let i = 0; i < fieldCount; i++) {\n            const fields = { '': Data.CifField.ofTokens(tokens[i]) };\n            addFields(ctx, fieldNames[i].substr(1), rowCount, [''], fields);\n        }\n    }\n    else {\n        const fields = Object.create(null);\n        for (let i = 0; i < fieldCount; i++) {\n            fields[fieldNames[i]] = Data.CifField.ofTokens(tokens[i]);\n        }\n        addFields(ctx, name.substr(1), rowCount, fieldNames, fields);\n    }\n    return {\n        hasError: false,\n        errorLine: 0,\n        errorMessage: ''\n    };\n}\n/**\n * Creates an error result.\n */\nfunction error(line, message) {\n    return Result.error(message, line);\n}\n/**\n * Creates a data result.\n */\nfunction result(data) {\n    return Result.success(data);\n}\n/**\n * Parses an mmCIF file.\n *\n * @returns CifParserResult wrapper of the result.\n */\nasync function parseInternal(data, runtimeCtx) {\n    const dataBlocks = [];\n    const tokenizer = createTokenizer(data, runtimeCtx);\n    let blockHeader = '';\n    let blockCtx = FrameContext();\n    // the next three initial values are never used in valid files\n    let saveFrames = [];\n    let saveCtx = FrameContext();\n    const saveFrame = Data.CifSaveFrame(saveCtx.categoryNames, CifCategories(saveCtx.categoryNames, saveCtx.categoryData), '');\n    let saveHeader = '';\n    runtimeCtx.update({ message: 'Parsing...', current: 0, max: data.length });\n    moveNext(tokenizer);\n    while (tokenizer.tokenType !== 6 /* CifTokenType.End */) {\n        const token = tokenizer.tokenType;\n        // Data block\n        if (token === 0 /* CifTokenType.Data */) {\n            if (tokenizer.inSaveFrame) {\n                return error(tokenizer.lineNumber, 'Unexpected data block inside a save frame.');\n            }\n            if (blockCtx.categoryNames.length > 0) {\n                dataBlocks.push(CifBlock(blockCtx, blockHeader, saveFrames));\n            }\n            blockHeader = data.substring(tokenizer.tokenStart + 5, tokenizer.tokenEnd);\n            blockCtx = FrameContext();\n            saveFrames = [];\n            moveNext(tokenizer);\n            // Save frame\n        }\n        else if (token === 1 /* CifTokenType.Save */) {\n            if (tokenizer.tokenEnd - tokenizer.tokenStart === 5) { // end of save frame\n                if (saveCtx.categoryNames.length > 0) {\n                    saveFrames[saveFrames.length] = CifSaveFrame(saveCtx, saveHeader);\n                }\n                tokenizer.inSaveFrame = false;\n            }\n            else { // start of save frame\n                if (tokenizer.inSaveFrame) {\n                    return error(tokenizer.lineNumber, 'Save frames cannot be nested.');\n                }\n                tokenizer.inSaveFrame = true;\n                saveHeader = data.substring(tokenizer.tokenStart + 5, tokenizer.tokenEnd);\n                saveCtx = FrameContext();\n                // saveFrame = CifSaveFrame(saveCtx, saveHeader);\n            }\n            moveNext(tokenizer);\n            // Loop\n        }\n        else if (token === 2 /* CifTokenType.Loop */) {\n            const cat = await handleLoop(tokenizer, tokenizer.inSaveFrame ? saveCtx : blockCtx);\n            if (cat.hasError) {\n                return error(cat.errorLine, cat.errorMessage);\n            }\n            // Single row\n        }\n        else if (token === 4 /* CifTokenType.ColumnName */) {\n            const cat = handleSingle(tokenizer, tokenizer.inSaveFrame ? saveCtx : blockCtx);\n            if (cat.hasError) {\n                return error(cat.errorLine, cat.errorMessage);\n            }\n            // Out of options\n        }\n        else {\n            console.log(tokenizer.tokenType, Tokenizer.getTokenString(tokenizer));\n            return error(tokenizer.lineNumber, 'Unexpected token. Expected data_, loop_, or data name.');\n        }\n    }\n    // Check if the latest save frame was closed.\n    if (tokenizer.inSaveFrame) {\n        return error(tokenizer.lineNumber, `Unfinished save frame (${saveFrame.header}).`);\n    }\n    if (blockCtx.categoryNames.length > 0 || saveFrames.length > 0) {\n        dataBlocks.push(CifBlock(blockCtx, blockHeader, saveFrames));\n    }\n    return result(Data.CifFile(dataBlocks));\n}\nexport function parseCifText(data) {\n    return Task.create('Parse CIF', async (ctx) => {\n        return await parseInternal(data, ctx);\n    });\n}\n","/**\n * Copyright (c) 2017-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport const IsNativeEndianLittle = new Uint16Array(new Uint8Array([0x12, 0x34]).buffer)[0] === 0x3412;\nexport function flipByteOrder(data, bytes) {\n    const buffer = new ArrayBuffer(data.length);\n    const ret = new Uint8Array(buffer);\n    for (let i = 0, n = data.length; i < n; i += bytes) {\n        for (let j = 0; j < bytes; j++) {\n            ret[i + bytes - j - 1] = data[i + j];\n        }\n    }\n    return buffer;\n}\nconst ChunkSize = 0x7000;\nexport function uint8ToString(array) {\n    if (array.length > ChunkSize) {\n        const c = [];\n        for (let i = 0; i < array.length; i += ChunkSize) {\n            c.push(String.fromCharCode.apply(null, array.subarray(i, i + ChunkSize)));\n        }\n        return c.join('');\n    }\n    else {\n        return String.fromCharCode.apply(null, array);\n    }\n}\n","/**\n * Copyright (c) 2017-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * From CIFTools.js\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Encoding } from './encoding';\nimport { IsNativeEndianLittle, flipByteOrder } from '../binary';\nimport { assertUnreachable } from '../../../mol-util/type-helpers';\n/**\n * Fixed point, delta, RLE, integer packing adopted from https://github.com/rcsb/mmtf-javascript/\n * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016\n */\nexport function decode(data) {\n    let current = data.data;\n    for (let i = data.encoding.length - 1; i >= 0; i--) {\n        current = decodeStep(current, data.encoding[i]);\n    }\n    return current;\n}\nfunction decodeStep(data, encoding) {\n    switch (encoding.kind) {\n        case 'ByteArray': {\n            switch (encoding.type) {\n                case Encoding.IntDataType.Uint8: return data;\n                case Encoding.IntDataType.Int8: return int8(data);\n                case Encoding.IntDataType.Int16: return int16(data);\n                case Encoding.IntDataType.Uint16: return uint16(data);\n                case Encoding.IntDataType.Int32: return int32(data);\n                case Encoding.IntDataType.Uint32: return uint32(data);\n                case Encoding.FloatDataType.Float32: return float32(data);\n                case Encoding.FloatDataType.Float64: return float64(data);\n                default: assertUnreachable(encoding.type);\n            }\n        }\n        case 'FixedPoint': return fixedPoint(data, encoding);\n        case 'IntervalQuantization': return intervalQuantization(data, encoding);\n        case 'RunLength': return runLength(data, encoding);\n        case 'Delta': return delta(data, encoding);\n        case 'IntegerPacking': return integerPacking(data, encoding);\n        case 'StringArray': return stringArray(data, encoding);\n    }\n}\nfunction getIntArray(type, size) {\n    switch (type) {\n        case Encoding.IntDataType.Int8: return new Int8Array(size);\n        case Encoding.IntDataType.Int16: return new Int16Array(size);\n        case Encoding.IntDataType.Int32: return new Int32Array(size);\n        case Encoding.IntDataType.Uint8: return new Uint8Array(size);\n        case Encoding.IntDataType.Uint16: return new Uint16Array(size);\n        case Encoding.IntDataType.Uint32: return new Uint32Array(size);\n        default: return new Int32Array(size);\n    }\n}\nfunction getFloatArray(type, size) {\n    switch (type) {\n        case Encoding.FloatDataType.Float32: return new Float32Array(size);\n        case Encoding.FloatDataType.Float64: return new Float64Array(size);\n        default: return new Float64Array(size);\n    }\n}\nfunction int8(data) { return new Int8Array(data.buffer, data.byteOffset); }\nfunction view(data, byteSize, c) {\n    if (IsNativeEndianLittle)\n        return new c(data.buffer);\n    return new c(flipByteOrder(data, byteSize));\n}\nfunction int16(data) { return view(data, 2, Int16Array); }\nfunction uint16(data) { return view(data, 2, Uint16Array); }\nfunction int32(data) { return view(data, 4, Int32Array); }\nfunction uint32(data) { return view(data, 4, Uint32Array); }\nfunction float32(data) { return view(data, 4, Float32Array); }\nfunction float64(data) { return view(data, 8, Float64Array); }\nfunction fixedPoint(data, encoding) {\n    const n = data.length;\n    const output = getFloatArray(encoding.srcType, n);\n    const f = 1 / encoding.factor;\n    for (let i = 0; i < n; i++) {\n        output[i] = f * data[i];\n    }\n    return output;\n}\nfunction intervalQuantization(data, encoding) {\n    const n = data.length;\n    const output = getFloatArray(encoding.srcType, n);\n    const delta = (encoding.max - encoding.min) / (encoding.numSteps - 1);\n    const min = encoding.min;\n    for (let i = 0; i < n; i++) {\n        output[i] = min + delta * data[i];\n    }\n    return output;\n}\nfunction runLength(data, encoding) {\n    const output = getIntArray(encoding.srcType, encoding.srcSize);\n    let dataOffset = 0;\n    for (let i = 0, il = data.length; i < il; i += 2) {\n        const value = data[i]; // value to be repeated\n        const length = data[i + 1]; // number of repeats\n        for (let j = 0; j < length; ++j) {\n            output[dataOffset++] = value;\n        }\n    }\n    return output;\n}\nfunction delta(data, encoding) {\n    const n = data.length;\n    const output = getIntArray(encoding.srcType, n);\n    if (!n)\n        return data;\n    output[0] = data[0] + (encoding.origin | 0);\n    for (let i = 1; i < n; ++i) {\n        output[i] = data[i] + output[i - 1];\n    }\n    return output;\n}\nfunction integerPackingSigned(data, encoding) {\n    const upperLimit = encoding.byteCount === 1 ? 0x7F : 0x7FFF;\n    const lowerLimit = -upperLimit - 1;\n    const n = data.length;\n    const output = new Int32Array(encoding.srcSize);\n    let i = 0;\n    let j = 0;\n    while (i < n) {\n        let value = 0, t = data[i];\n        while (t === upperLimit || t === lowerLimit) {\n            value += t;\n            i++;\n            t = data[i];\n        }\n        value += t;\n        output[j] = value;\n        i++;\n        j++;\n    }\n    return output;\n}\nfunction integerPackingUnsigned(data, encoding) {\n    const upperLimit = encoding.byteCount === 1 ? 0xFF : 0xFFFF;\n    const n = data.length;\n    const output = new Int32Array(encoding.srcSize);\n    let i = 0;\n    let j = 0;\n    while (i < n) {\n        let value = 0, t = data[i];\n        while (t === upperLimit) {\n            value += t;\n            i++;\n            t = data[i];\n        }\n        value += t;\n        output[j] = value;\n        i++;\n        j++;\n    }\n    return output;\n}\nfunction integerPacking(data, encoding) {\n    if (data.length === encoding.srcSize)\n        return data;\n    return encoding.isUnsigned ? integerPackingUnsigned(data, encoding) : integerPackingSigned(data, encoding);\n}\nfunction stringArray(data, encoding) {\n    const offsets = decode({ encoding: encoding.offsetEncoding, data: encoding.offsets });\n    const indices = decode({ encoding: encoding.dataEncoding, data });\n    const str = encoding.stringData;\n    const strings = new Array(offsets.length);\n    strings[0] = '';\n    for (let i = 1, _i = offsets.length; i < _i; i++) {\n        strings[i] = str.substring(offsets[i - 1], offsets[i]);\n    }\n    let offset = 0;\n    const result = new Array(indices.length);\n    for (let i = 0, _i = indices.length; i < _i; i++) {\n        result[offset++] = strings[indices[i] + 1];\n    }\n    return result;\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * from https://github.com/dsehnal/CIFTools.js\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nvar ChunkedArray;\n(function (ChunkedArray) {\n    function is(x) {\n        return x.creator && x.chunkSize;\n    }\n    ChunkedArray.is = is;\n    function allocateNext(array) {\n        const nextSize = array.growBy * array.elementSize;\n        array.currentSize = nextSize;\n        array.currentIndex = 0;\n        array.currentChunk = new array.ctor(nextSize);\n        array.allocatedSize += nextSize;\n        array.chunks[array.chunks.length] = array.currentChunk;\n    }\n    function add4(array, x, y, z, w) {\n        if (array.currentIndex >= array.currentSize)\n            allocateNext(array);\n        const c = array.currentChunk;\n        const i = array.currentIndex;\n        c[i] = x;\n        c[i + 1] = y;\n        c[i + 2] = z;\n        c[i + 3] = w;\n        array.currentIndex += 4;\n        return array.elementCount++;\n    }\n    ChunkedArray.add4 = add4;\n    function add3(array, x, y, z) {\n        if (array.currentIndex >= array.currentSize)\n            allocateNext(array);\n        const c = array.currentChunk;\n        const i = array.currentIndex;\n        c[i] = x;\n        c[i + 1] = y;\n        c[i + 2] = z;\n        array.currentIndex += 3;\n        return array.elementCount++;\n    }\n    ChunkedArray.add3 = add3;\n    function add2(array, x, y) {\n        if (array.currentIndex >= array.currentSize)\n            allocateNext(array);\n        const c = array.currentChunk;\n        const i = array.currentIndex;\n        c[i] = x;\n        c[i + 1] = y;\n        array.currentIndex += 2;\n        return array.elementCount++;\n    }\n    ChunkedArray.add2 = add2;\n    function add(array, x) {\n        if (array.currentIndex >= array.currentSize)\n            allocateNext(array);\n        array.currentChunk[array.currentIndex] = x;\n        array.currentIndex += 1;\n        return array.elementCount++;\n    }\n    ChunkedArray.add = add;\n    function addRepeat(array, n, x) {\n        for (let i = 0; i < n; i++) {\n            if (array.currentIndex >= array.currentSize)\n                allocateNext(array);\n            array.currentChunk[array.currentIndex++] = x;\n            array.elementCount++;\n        }\n        return array.elementCount;\n    }\n    ChunkedArray.addRepeat = addRepeat;\n    function addMany(array, data) {\n        const { elementSize } = array;\n        for (let i = 0, _i = data.length; i < _i; i += elementSize) {\n            if (array.currentIndex >= array.currentSize)\n                allocateNext(array);\n            const { currentChunk } = array;\n            for (let j = 0; j < elementSize; j++) {\n                currentChunk[array.currentIndex++] = data[i + j];\n            }\n            array.elementCount++;\n        }\n        return array.elementCount;\n    }\n    ChunkedArray.addMany = addMany;\n    /** If doNotResizeSingleton = true and the data fit into a single chunk, do not resize it. */\n    function compact(array, doNotResizeSingleton = false) {\n        return _compact(array, doNotResizeSingleton);\n    }\n    ChunkedArray.compact = compact;\n    function _compact(array, doNotResizeSingleton) {\n        const { ctor, chunks, currentIndex } = array;\n        if (!chunks.length)\n            return new ctor(0);\n        if (chunks.length === 1) {\n            if (doNotResizeSingleton || currentIndex === array.allocatedSize) {\n                return chunks[0];\n            }\n        }\n        let size = 0;\n        for (let i = 0, _i = chunks.length - 1; i < _i; i++)\n            size += chunks[i].length;\n        size += array.currentIndex;\n        const ret = new ctor(size);\n        let offset = 0;\n        if (ret.buffer) {\n            for (let i = 0, _i = chunks.length - 1; i < _i; i++) {\n                ret.set(chunks[i], offset);\n                offset += chunks[i].length;\n            }\n        }\n        else {\n            for (let i = 0, _i = chunks.length - 1; i < _i; i++) {\n                const chunk = chunks[i];\n                for (let j = 0, _j = chunk.length; j < _j; j++)\n                    ret[offset + j] = chunk[j];\n                offset += chunk.length;\n            }\n        }\n        const lastChunk = chunks[chunks.length - 1];\n        if (ret.buffer && currentIndex >= array.currentSize) {\n            ret.set(lastChunk, offset);\n        }\n        else {\n            for (let j = 0, _j = lastChunk.length; j < _j; j++)\n                ret[offset + j] = lastChunk[j];\n        }\n        return ret;\n    }\n    ChunkedArray._compact = _compact;\n    /**\n     * The size of the initial chunk is elementSize * initialCount.\n     * Use the provided array as the initial chunk. The size of the array must be divisible by the elementSize.\n     */\n    function create(ctor, elementSize, chunkSize, initialChunkOrCount) {\n        const ret = {\n            ctor,\n            elementSize,\n            growBy: Math.max(1, Math.ceil(chunkSize)),\n            allocatedSize: 0,\n            elementCount: 0,\n            currentSize: 0,\n            currentChunk: void 0,\n            currentIndex: 0,\n            chunks: []\n        };\n        if (typeof initialChunkOrCount === 'undefined')\n            return ret;\n        if (typeof initialChunkOrCount === 'number') {\n            ret.currentChunk = new ctor(initialChunkOrCount * elementSize);\n            ret.allocatedSize = initialChunkOrCount * elementSize;\n            ret.currentSize = ret.currentChunk.length;\n            ret.chunks[0] = ret.currentChunk;\n            return ret;\n        }\n        const initialChunk = initialChunkOrCount;\n        if (initialChunk.length % elementSize !== 0)\n            throw new Error('initialChunk length must be a multiple of the element size.');\n        ret.currentChunk = initialChunk;\n        ret.allocatedSize = initialChunk.length;\n        ret.currentSize = initialChunk.length;\n        ret.chunks[0] = initialChunk;\n        return ret;\n    }\n    ChunkedArray.create = create;\n})(ChunkedArray || (ChunkedArray = {}));\nexport { ChunkedArray };\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { ArrayEncoding as E } from './array-encoder';\nimport { getArrayDigitCount } from '../../../mol-util/number';\nimport { assertUnreachable } from '../../../mol-util/type-helpers';\nexport function classifyIntArray(xs) {\n    return IntClassifier.classify(xs);\n}\nexport function classifyFloatArray(xs) {\n    return FloatClassifier.classify(xs);\n}\nvar IntClassifier;\n(function (IntClassifier) {\n    function packSize(value, upperLimit) {\n        return value >= 0\n            ? Math.ceil((value + 1) / upperLimit)\n            : Math.ceil((value + 1) / (-upperLimit - 1));\n    }\n    function getInfo(data) {\n        let signed = false;\n        for (let i = 0, n = data.length; i < n; i++) {\n            if (data[i] < 0) {\n                signed = true;\n                break;\n            }\n        }\n        return signed ? { signed, limit8: 0x7F, limit16: 0x7FFF } : { signed, limit8: 0xFF, limit16: 0xFFFF };\n    }\n    function SizeInfo() { return { pack8: 0, pack16: 0, count: 0 }; }\n    ;\n    function incSize({ limit8, limit16 }, info, value) {\n        info.pack8 += packSize(value, limit8);\n        info.pack16 += packSize(value, limit16);\n        info.count += 1;\n    }\n    function incSizeSigned(info, value) {\n        info.pack8 += packSize(value, 0x7F);\n        info.pack16 += packSize(value, 0x7FFF);\n        info.count += 1;\n    }\n    function byteSize(info) {\n        if (info.count * 4 < info.pack16 * 2)\n            return { length: info.count * 4, elem: 4 };\n        if (info.pack16 * 2 < info.pack8)\n            return { length: info.pack16 * 2, elem: 2 };\n        return { length: info.pack8, elem: 1 };\n    }\n    function packingSize(data, info) {\n        const size = SizeInfo();\n        for (let i = 0, n = data.length; i < n; i++) {\n            incSize(info, size, data[i]);\n        }\n        return { ...byteSize(size), kind: 'pack' };\n    }\n    function deltaSize(data, info) {\n        const size = SizeInfo();\n        let prev = data[0];\n        for (let i = 1, n = data.length; i < n; i++) {\n            incSizeSigned(size, data[i] - prev);\n            prev = data[i];\n        }\n        return { ...byteSize(size), kind: 'delta' };\n    }\n    function rleSize(data, info) {\n        const size = SizeInfo();\n        let run = 1;\n        for (let i = 1, n = data.length; i < n; i++) {\n            if (data[i - 1] !== data[i]) {\n                incSize(info, size, data[i - 1]);\n                incSize(info, size, run);\n                run = 1;\n            }\n            else {\n                run++;\n            }\n        }\n        incSize(info, size, data[data.length - 1]);\n        incSize(info, size, run);\n        return { ...byteSize(size), kind: 'rle' };\n    }\n    function deltaRleSize(data, info) {\n        const size = SizeInfo();\n        let run = 1, prev = 0, prevValue = 0;\n        for (let i = 1, n = data.length; i < n; i++) {\n            const v = data[i] - prev;\n            if (prevValue !== v) {\n                incSizeSigned(size, prevValue);\n                incSizeSigned(size, run);\n                run = 1;\n            }\n            else {\n                run++;\n            }\n            prevValue = v;\n            prev = data[i];\n        }\n        incSizeSigned(size, prevValue);\n        incSizeSigned(size, run);\n        return { ...byteSize(size), kind: 'delta-rle' };\n    }\n    function getSize(data) {\n        const info = getInfo(data);\n        const sizes = [packingSize(data, info), rleSize(data, info), deltaSize(data, info), deltaRleSize(data, info)];\n        sizes.sort((a, b) => a.length - b.length);\n        return sizes;\n    }\n    IntClassifier.getSize = getSize;\n    function classify(data) {\n        if (data.length < 2)\n            return E.by(E.byteArray);\n        const sizes = getSize(data);\n        const size = sizes[0];\n        switch (size.kind) {\n            case 'pack': return E.by(E.integerPacking);\n            case 'rle': return E.by(E.runLength).and(E.integerPacking);\n            case 'delta': return E.by(E.delta).and(E.integerPacking);\n            case 'delta-rle': return E.by(E.delta).and(E.runLength).and(E.integerPacking);\n            default: assertUnreachable(size);\n        }\n    }\n    IntClassifier.classify = classify;\n})(IntClassifier || (IntClassifier = {}));\nvar FloatClassifier;\n(function (FloatClassifier) {\n    const delta = 1e-6;\n    function classify(data) {\n        const maxDigits = 4;\n        const { mantissaDigits, integerDigits } = getArrayDigitCount(data, maxDigits, delta);\n        // TODO: better check for overflows here?\n        if (mantissaDigits < 0 || mantissaDigits + integerDigits > 10)\n            return E.by(E.byteArray);\n        // TODO: this needs a conversion to Int?Array?\n        if (mantissaDigits === 0)\n            return IntClassifier.classify(data);\n        const multiplier = getMultiplier(mantissaDigits);\n        const intArray = new Int32Array(data.length);\n        for (let i = 0, n = data.length; i < n; i++) {\n            intArray[i] = Math.round(multiplier * data[i]);\n            // TODO: enable this again?\n            // const v = Math.round(multiplier * data[i]);\n            // if (Math.abs(Math.round(v) / multiplier - intArray[i] / multiplier) > delta) {\n            //     return E.by(E.byteArray);\n            // }\n        }\n        const sizes = IntClassifier.getSize(intArray);\n        const size = sizes[0];\n        const fp = E.by(E.fixedPoint(multiplier));\n        switch (size.kind) {\n            case 'pack': return fp.and(E.integerPacking);\n            case 'rle': return fp.and(E.runLength).and(E.integerPacking);\n            case 'delta': return fp.and(E.delta).and(E.integerPacking);\n            case 'delta-rle': return fp.and(E.delta).and(E.runLength).and(E.integerPacking);\n            default: assertUnreachable(size);\n        }\n    }\n    FloatClassifier.classify = classify;\n    function getMultiplier(mantissaDigits) {\n        let m = 1;\n        for (let i = 0; i < mantissaDigits; i++)\n            m *= 10;\n        return m;\n    }\n})(FloatClassifier || (FloatClassifier = {}));\n","/**\n * Copyright (c) 2017-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Adapted from CIFTools.js (https://github.com/dsehnal/CIFTools.js; MIT) and MMTF (https://github.com/rcsb/mmtf-javascript/; MIT)\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { ChunkedArray } from '../../../mol-data/util';\nimport { Encoding } from './encoding';\nimport { classifyIntArray } from './classifier';\nexport class ArrayEncoderImpl {\n    and(f) {\n        return new ArrayEncoderImpl(this.providers.concat([f]));\n    }\n    encode(data) {\n        const encoding = [];\n        for (const p of this.providers) {\n            const t = p(data);\n            if (!t.encodings.length) {\n                throw new Error('Encodings must be non-empty.');\n            }\n            data = t.data;\n            for (const e of t.encodings) {\n                encoding.push(e);\n            }\n        }\n        if (!(data instanceof Uint8Array)) {\n            throw new Error('The encoding must result in a Uint8Array. Fix your encoding chain.');\n        }\n        return {\n            encoding,\n            data\n        };\n    }\n    constructor(providers) {\n        this.providers = providers;\n    }\n}\nexport var ArrayEncoder;\n(function (ArrayEncoder) {\n    function by(f) {\n        return new ArrayEncoderImpl([f]);\n    }\n    ArrayEncoder.by = by;\n    function fromEncoding(encoding) {\n        let e = by(getProvider(encoding[0]));\n        for (let i = 1; i < encoding.length; i++) {\n            if (encoding[i - 1].kind === 'IntegerPacking')\n                break;\n            e = e.and(getProvider(encoding[i]));\n        }\n        return e;\n    }\n    ArrayEncoder.fromEncoding = fromEncoding;\n    function getProvider(e) {\n        switch (e.kind) {\n            case 'ByteArray': return ArrayEncoding.byteArray;\n            case 'FixedPoint': return ArrayEncoding.fixedPoint(e.factor);\n            case 'IntervalQuantization': return ArrayEncoding.intervalQuantizaiton(e.min, e.max, e.numSteps);\n            case 'RunLength': return ArrayEncoding.runLength;\n            case 'Delta': return ArrayEncoding.delta;\n            case 'IntegerPacking': return ArrayEncoding.integerPacking;\n            case 'StringArray': return ArrayEncoding.stringArray;\n        }\n    }\n})(ArrayEncoder || (ArrayEncoder = {}));\nexport var ArrayEncoding;\n(function (ArrayEncoding) {\n    function by(f) {\n        return new ArrayEncoderImpl([f]);\n    }\n    ArrayEncoding.by = by;\n    function uint8(data) {\n        return {\n            encodings: [{ kind: 'ByteArray', type: Encoding.IntDataType.Uint8 }],\n            data\n        };\n    }\n    function int8(data) {\n        return {\n            encodings: [{ kind: 'ByteArray', type: Encoding.IntDataType.Int8 }],\n            data: new Uint8Array(data.buffer, data.byteOffset)\n        };\n    }\n    const writers = {\n        [Encoding.IntDataType.Int16]: function (v, i, a) { v.setInt16(2 * i, a, true); },\n        [Encoding.IntDataType.Uint16]: function (v, i, a) { v.setUint16(2 * i, a, true); },\n        [Encoding.IntDataType.Int32]: function (v, i, a) { v.setInt32(4 * i, a, true); },\n        [Encoding.IntDataType.Uint32]: function (v, i, a) { v.setUint32(4 * i, a, true); },\n        [Encoding.FloatDataType.Float32]: function (v, i, a) { v.setFloat32(4 * i, a, true); },\n        [Encoding.FloatDataType.Float64]: function (v, i, a) { v.setFloat64(8 * i, a, true); }\n    };\n    const byteSizes = {\n        [Encoding.IntDataType.Int16]: 2,\n        [Encoding.IntDataType.Uint16]: 2,\n        [Encoding.IntDataType.Int32]: 4,\n        [Encoding.IntDataType.Uint32]: 4,\n        [Encoding.FloatDataType.Float32]: 4,\n        [Encoding.FloatDataType.Float64]: 8\n    };\n    function byteArray(data) {\n        const type = Encoding.getDataType(data);\n        if (type === Encoding.IntDataType.Int8)\n            return int8(data);\n        else if (type === Encoding.IntDataType.Uint8)\n            return uint8(data);\n        const result = new Uint8Array(data.length * byteSizes[type]);\n        const w = writers[type];\n        const view = new DataView(result.buffer);\n        for (let i = 0, n = data.length; i < n; i++) {\n            w(view, i, data[i]);\n        }\n        return {\n            encodings: [{ kind: 'ByteArray', type }],\n            data: result\n        };\n    }\n    ArrayEncoding.byteArray = byteArray;\n    function _fixedPoint(data, factor) {\n        const srcType = Encoding.getDataType(data);\n        const result = new Int32Array(data.length);\n        for (let i = 0, n = data.length; i < n; i++) {\n            result[i] = Math.round(data[i] * factor);\n        }\n        return {\n            encodings: [{ kind: 'FixedPoint', factor, srcType }],\n            data: result\n        };\n    }\n    function fixedPoint(factor) { return data => _fixedPoint(data, factor); }\n    ArrayEncoding.fixedPoint = fixedPoint;\n    function _intervalQuantizaiton(data, min, max, numSteps, arrayType) {\n        const srcType = Encoding.getDataType(data);\n        if (!data.length) {\n            return {\n                encodings: [{ kind: 'IntervalQuantization', min, max, numSteps, srcType }],\n                data: new Int32Array(0)\n            };\n        }\n        if (max < min) {\n            const t = min;\n            min = max;\n            max = t;\n        }\n        const delta = (max - min) / (numSteps - 1);\n        const output = new arrayType(data.length);\n        for (let i = 0, n = data.length; i < n; i++) {\n            const v = data[i];\n            if (v <= min)\n                output[i] = 0;\n            else if (v >= max)\n                output[i] = numSteps - 1;\n            else\n                output[i] = (Math.round((v - min) / delta)) | 0;\n        }\n        return {\n            encodings: [{ kind: 'IntervalQuantization', min, max, numSteps, srcType }],\n            data: output\n        };\n    }\n    function intervalQuantizaiton(min, max, numSteps, arrayType = Int32Array) {\n        return data => _intervalQuantizaiton(data, min, max, numSteps, arrayType);\n    }\n    ArrayEncoding.intervalQuantizaiton = intervalQuantizaiton;\n    function runLength(data) {\n        let srcType = Encoding.getDataType(data);\n        if (srcType === void 0) {\n            data = new Int32Array(data);\n            srcType = Encoding.IntDataType.Int32;\n        }\n        if (!data.length) {\n            return {\n                encodings: [{ kind: 'RunLength', srcType, srcSize: 0 }],\n                data: new Int32Array(0)\n            };\n        }\n        // calculate output size\n        let fullLength = 2;\n        for (let i = 1, il = data.length; i < il; i++) {\n            if (data[i - 1] !== data[i]) {\n                fullLength += 2;\n            }\n        }\n        const output = new Int32Array(fullLength);\n        let offset = 0;\n        let runLength = 1;\n        for (let i = 1, il = data.length; i < il; i++) {\n            if (data[i - 1] !== data[i]) {\n                output[offset] = data[i - 1];\n                output[offset + 1] = runLength;\n                runLength = 1;\n                offset += 2;\n            }\n            else {\n                ++runLength;\n            }\n        }\n        output[offset] = data[data.length - 1];\n        output[offset + 1] = runLength;\n        return {\n            encodings: [{ kind: 'RunLength', srcType, srcSize: data.length }],\n            data: output\n        };\n    }\n    ArrayEncoding.runLength = runLength;\n    function delta(data) {\n        if (!Encoding.isSignedIntegerDataType(data)) {\n            throw new Error('Only signed integer types can be encoded using delta encoding.');\n        }\n        let srcType = Encoding.getDataType(data);\n        if (srcType === void 0) {\n            data = new Int32Array(data);\n            srcType = Encoding.IntDataType.Int32;\n        }\n        if (!data.length) {\n            return {\n                encodings: [{ kind: 'Delta', origin: 0, srcType }],\n                data: new data.constructor(0)\n            };\n        }\n        const output = new data.constructor(data.length);\n        const origin = data[0];\n        output[0] = data[0];\n        for (let i = 1, n = data.length; i < n; i++) {\n            output[i] = data[i] - data[i - 1];\n        }\n        output[0] = 0;\n        return {\n            encodings: [{ kind: 'Delta', origin, srcType }],\n            data: output\n        };\n    }\n    ArrayEncoding.delta = delta;\n    function isSigned(data) {\n        for (let i = 0, n = data.length; i < n; i++) {\n            if (data[i] < 0)\n                return true;\n        }\n        return false;\n    }\n    function packingSizeUnsigned(data, upperLimit) {\n        let size = 0;\n        for (let i = 0, n = data.length; i < n; i++) {\n            size += (data[i] / upperLimit) | 0;\n        }\n        size += data.length;\n        return size;\n    }\n    function packingSizeSigned(data, upperLimit) {\n        const lowerLimit = -upperLimit - 1;\n        let size = 0;\n        for (let i = 0, n = data.length; i < n; i++) {\n            const value = data[i];\n            if (value >= 0) {\n                size += (value / upperLimit) | 0;\n            }\n            else {\n                size += (value / lowerLimit) | 0;\n            }\n        }\n        size += data.length;\n        return size;\n    }\n    function determinePacking(data) {\n        const signed = isSigned(data);\n        const size8 = signed ? packingSizeSigned(data, 0x7F) : packingSizeUnsigned(data, 0xFF);\n        const size16 = signed ? packingSizeSigned(data, 0x7FFF) : packingSizeUnsigned(data, 0xFFFF);\n        if (data.length * 4 < size16 * 2) {\n            // 4 byte packing is the most effective\n            return {\n                isSigned: signed,\n                size: data.length,\n                bytesPerElement: 4\n            };\n        }\n        else if (size16 * 2 < size8) {\n            // 2 byte packing is the most effective\n            return {\n                isSigned: signed,\n                size: size16,\n                bytesPerElement: 2\n            };\n        }\n        else {\n            // 1 byte packing is the most effective\n            return {\n                isSigned: signed,\n                size: size8,\n                bytesPerElement: 1\n            };\n        }\n        ;\n    }\n    function _integerPacking(data, packing) {\n        const upperLimit = packing.isSigned\n            ? (packing.bytesPerElement === 1 ? 0x7F : 0x7FFF)\n            : (packing.bytesPerElement === 1 ? 0xFF : 0xFFFF);\n        const lowerLimit = -upperLimit - 1;\n        const n = data.length;\n        const packed = packing.isSigned\n            ? packing.bytesPerElement === 1 ? new Int8Array(packing.size) : new Int16Array(packing.size)\n            : packing.bytesPerElement === 1 ? new Uint8Array(packing.size) : new Uint16Array(packing.size);\n        let j = 0;\n        for (let i = 0; i < n; i++) {\n            let value = data[i];\n            if (value >= 0) {\n                while (value >= upperLimit) {\n                    packed[j] = upperLimit;\n                    ++j;\n                    value -= upperLimit;\n                }\n            }\n            else {\n                while (value <= lowerLimit) {\n                    packed[j] = lowerLimit;\n                    ++j;\n                    value -= lowerLimit;\n                }\n            }\n            packed[j] = value;\n            ++j;\n        }\n        const result = byteArray(packed);\n        return {\n            encodings: [{\n                    kind: 'IntegerPacking',\n                    byteCount: packing.bytesPerElement,\n                    isUnsigned: !packing.isSigned,\n                    srcSize: n\n                },\n                result.encodings[0]\n            ],\n            data: result.data\n        };\n    }\n    /**\n     * Packs Int32 array. The packing level is determined automatically to either 1-, 2-, or 4-byte words.\n     */\n    function integerPacking(data) {\n        // if (!(data instanceof Int32Array)) {\n        //     throw new Error('Integer packing can only be applied to Int32 data.');\n        // }\n        const packing = determinePacking(data);\n        if (packing.bytesPerElement === 4) {\n            // no packing done, Int32 encoding will be used\n            return byteArray(data);\n        }\n        return _integerPacking(data, packing);\n    }\n    ArrayEncoding.integerPacking = integerPacking;\n    function stringArray(data) {\n        const map = Object.create(null);\n        const strings = [];\n        const output = new Int32Array(data.length);\n        const offsets = ChunkedArray.create(Int32Array, 1, Math.min(1024, data.length < 32 ? data.length + 1 : Math.round(data.length / 8) + 1));\n        ChunkedArray.add(offsets, 0);\n        let accLength = 0;\n        let i = 0;\n        for (const s of data) {\n            // handle null strings.\n            if (s === null || s === void 0) {\n                output[i++] = -1;\n                continue;\n            }\n            let index = map[s];\n            if (index === void 0) {\n                // increment the length\n                accLength += s.length;\n                // store the string and index\n                index = strings.length;\n                strings[index] = s;\n                map[s] = index;\n                // write the offset\n                ChunkedArray.add(offsets, accLength);\n            }\n            output[i++] = index;\n        }\n        const offsetArray = ChunkedArray.compact(offsets);\n        const offsetEncoding = classifyIntArray(offsetArray);\n        const encodedOddsets = offsetEncoding.encode(offsetArray);\n        const dataEncoding = classifyIntArray(output);\n        const encodedData = dataEncoding.encode(output);\n        return {\n            encodings: [{ kind: 'StringArray', dataEncoding: encodedData.encoding, stringData: strings.join(''), offsetEncoding: encodedOddsets.encoding, offsets: encodedOddsets.data }],\n            data: encodedData.data\n        };\n    }\n    ArrayEncoding.stringArray = stringArray;\n})(ArrayEncoding || (ArrayEncoding = {}));\n","/**\n * Copyright (c) 2018-2019 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n/**\n * Determine the number of digits in a floating point number\n * Find a number M such that round(M * v) - M * v <= delta.\n * If no such M exists, return -1.\n */\nexport function getMantissaMultiplier(v, maxDigits, delta) {\n    let m = 1, i;\n    for (i = 0; i < maxDigits; i++) {\n        const mv = m * v;\n        if (Math.abs(Math.round(mv) - mv) <= delta)\n            return i;\n        m *= 10;\n    }\n    return -1;\n}\nexport function integerDigitCount(v, delta) {\n    const f = Math.abs(v);\n    if (f < delta)\n        return 0;\n    return Math.floor(Math.log10(Math.abs(v))) + 1;\n}\n/**\n * Determine the maximum number of digits in a floating point array.\n * Find a number M such that round(M * v) - M * v <= delta.\n * If no such M exists, return -1.\n */\nexport function getArrayDigitCount(xs, maxDigits, delta) {\n    let mantissaDigits = 1;\n    let integerDigits = 0;\n    for (let i = 0, _i = xs.length; i < _i; i++) {\n        if (mantissaDigits >= 0) {\n            const t = getMantissaMultiplier(xs[i], maxDigits, delta);\n            if (t < 0)\n                mantissaDigits = -1;\n            else if (t > mantissaDigits)\n                mantissaDigits = t;\n        }\n        const abs = Math.abs(xs[i]);\n        if (abs > delta) {\n            const d = Math.floor(Math.log10(Math.abs(abs))) + 1;\n            if (d > integerDigits)\n                integerDigits = d;\n        }\n    }\n    return { mantissaDigits, integerDigits };\n}\nexport function isInteger(s) {\n    s = s.trim();\n    const n = parseInt(s, 10);\n    return isNaN(n) ? false : n.toString() === s;\n}\nexport function getPrecision(v) {\n    if (!isFinite(v))\n        return 0;\n    let e = 1;\n    let p = 0;\n    while (Math.round(v * e) / e !== v) {\n        e *= 10;\n        ++p;\n    }\n    return p;\n}\nexport function toPrecision(v, precision) {\n    return parseFloat(v.toPrecision(precision));\n}\nexport function toFixed(v, fractionDigits) {\n    return parseFloat(v.toFixed(fractionDigits));\n}\n","/**\n * Copyright (c) 2017-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Adapted from https://github.com/rcsb/mmtf-javascript\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport function utf8Write(data, offset, str) {\n    for (let i = 0, l = str.length; i < l; i++) {\n        const codePoint = str.charCodeAt(i);\n        // One byte of UTF-8\n        if (codePoint < 0x80) {\n            data[offset++] = codePoint >>> 0 & 0x7f | 0x00;\n            continue;\n        }\n        // Two bytes of UTF-8\n        if (codePoint < 0x800) {\n            data[offset++] = codePoint >>> 6 & 0x1f | 0xc0;\n            data[offset++] = codePoint >>> 0 & 0x3f | 0x80;\n            continue;\n        }\n        // Three bytes of UTF-8.\n        if (codePoint < 0x10000) {\n            data[offset++] = codePoint >>> 12 & 0x0f | 0xe0;\n            data[offset++] = codePoint >>> 6 & 0x3f | 0x80;\n            data[offset++] = codePoint >>> 0 & 0x3f | 0x80;\n            continue;\n        }\n        // Four bytes of UTF-8\n        if (codePoint < 0x110000) {\n            data[offset++] = codePoint >>> 18 & 0x07 | 0xf0;\n            data[offset++] = codePoint >>> 12 & 0x3f | 0x80;\n            data[offset++] = codePoint >>> 6 & 0x3f | 0x80;\n            data[offset++] = codePoint >>> 0 & 0x3f | 0x80;\n            continue;\n        }\n        throw new Error('bad codepoint ' + codePoint);\n    }\n}\nconst __chars = function () {\n    const data = [];\n    for (let i = 0; i < 1024; i++)\n        data[i] = String.fromCharCode(i);\n    return data;\n}();\nfunction throwError(err) {\n    throw new Error(err);\n}\nfunction _utf8Read(data, offset, length) {\n    const chars = __chars;\n    let str = void 0, chunkOffset = 0;\n    const chunk = [], chunkSize = 512;\n    for (let i = offset, end = offset + length; i < end; i++) {\n        const byte = data[i];\n        if ((byte & 0x80) === 0x00) {\n            // One byte character\n            chunk[chunkOffset++] = chars[byte];\n        }\n        else if ((byte & 0xe0) === 0xc0) {\n            // Two byte character\n            chunk[chunkOffset++] = chars[((byte & 0x0f) << 6) | (data[++i] & 0x3f)];\n        }\n        else if ((byte & 0xf0) === 0xe0) {\n            // Three byte character\n            chunk[chunkOffset++] = String.fromCharCode(((byte & 0x0f) << 12) |\n                ((data[++i] & 0x3f) << 6) |\n                ((data[++i] & 0x3f) << 0));\n        }\n        else if ((byte & 0xf8) === 0xf0) {\n            // Four byte character\n            chunk[chunkOffset++] = String.fromCharCode(((byte & 0x07) << 18) |\n                ((data[++i] & 0x3f) << 12) |\n                ((data[++i] & 0x3f) << 6) |\n                ((data[++i] & 0x3f) << 0));\n        }\n        else\n            throwError('Invalid byte ' + byte.toString(16));\n        if (chunkOffset === chunkSize) {\n            str = str || [];\n            str[str.length] = chunk.join('');\n            chunkOffset = 0;\n        }\n    }\n    if (!str)\n        return chunk.slice(0, chunkOffset).join('');\n    if (chunkOffset > 0) {\n        str[str.length] = chunk.slice(0, chunkOffset).join('');\n    }\n    return str.join('');\n}\nconst utf8Decoder = (typeof TextDecoder !== 'undefined') ? new TextDecoder() : undefined;\nexport function utf8Read(data, offset, length) {\n    if (utf8Decoder) {\n        const input = (offset || length !== data.length) ? data.subarray(offset, offset + length) : data;\n        return utf8Decoder.decode(input);\n    }\n    else {\n        return _utf8Read(data, offset, length);\n    }\n}\nexport function utf8ByteCount(str) {\n    let count = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        const codePoint = str.charCodeAt(i);\n        if (codePoint < 0x80) {\n            count += 1;\n            continue;\n        }\n        if (codePoint < 0x800) {\n            count += 2;\n            continue;\n        }\n        if (codePoint < 0x10000) {\n            count += 3;\n            continue;\n        }\n        if (codePoint < 0x110000) {\n            count += 4;\n            continue;\n        }\n        throwError('bad codepoint ' + codePoint);\n    }\n    return count;\n}\n","/*\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Adapted from https://github.com/rcsb/mmtf-javascript\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { utf8Read } from '../utf8';\nexport function decodeMsgPack(buffer) {\n    return parse({ buffer, offset: 0, dataView: new DataView(buffer.buffer) });\n}\n/**\n * decode all key-value pairs of a map into an object\n */\nfunction map(state, length) {\n    const value = {};\n    for (let i = 0; i < length; i++) {\n        const key = parse(state);\n        value[key] = parse(state);\n    }\n    return value;\n}\n/**\n * decode binary array\n */\nfunction bin(state, length) {\n    // This approach to binary parsing wastes a bit of memory to trade for speed compared to:\n    //\n    //   let value = buffer.subarray(offset, offset + length); //new Uint8Array(buffer.buffer, offset, length);\n    //\n    // It turns out that using the view created by subarray probably uses DataView\n    // in the background, which causes the element access to be several times slower\n    // than creating the new byte array.\n    const value = new Uint8Array(length);\n    const o = state.offset;\n    for (let i = 0; i < length; i++)\n        value[i] = state.buffer[i + o];\n    state.offset += length;\n    return value;\n}\n/**\n * decode string\n */\nfunction str(state, length) {\n    const value = utf8Read(state.buffer, state.offset, length);\n    state.offset += length;\n    return value;\n}\n/**\n * decode array\n */\nfunction array(state, length) {\n    const value = new Array(length);\n    for (let i = 0; i < length; i++) {\n        value[i] = parse(state);\n    }\n    return value;\n}\n/**\n * recursively parse the MessagePack data and return decoded MessagePack data\n */\nfunction parse(state) {\n    const type = state.buffer[state.offset];\n    let value, length;\n    // Positive FixInt\n    if ((type & 0x80) === 0x00) {\n        state.offset++;\n        return type;\n    }\n    // FixMap\n    if ((type & 0xf0) === 0x80) {\n        length = type & 0x0f;\n        state.offset++;\n        return map(state, length);\n    }\n    // FixArray\n    if ((type & 0xf0) === 0x90) {\n        length = type & 0x0f;\n        state.offset++;\n        return array(state, length);\n    }\n    // FixStr\n    if ((type & 0xe0) === 0xa0) {\n        length = type & 0x1f;\n        state.offset++;\n        return str(state, length);\n    }\n    // Negative FixInt\n    if ((type & 0xe0) === 0xe0) {\n        value = state.dataView.getInt8(state.offset);\n        state.offset++;\n        return value;\n    }\n    switch (type) {\n        // nil\n        case 0xc0:\n            state.offset++;\n            return null;\n        // false\n        case 0xc2:\n            state.offset++;\n            return false;\n        // true\n        case 0xc3:\n            state.offset++;\n            return true;\n        // bin 8\n        case 0xc4:\n            length = state.dataView.getUint8(state.offset + 1);\n            state.offset += 2;\n            return bin(state, length);\n        // bin 16\n        case 0xc5:\n            length = state.dataView.getUint16(state.offset + 1);\n            state.offset += 3;\n            return bin(state, length);\n        // bin 32\n        case 0xc6:\n            length = state.dataView.getUint32(state.offset + 1);\n            state.offset += 5;\n            return bin(state, length);\n        // float 32\n        case 0xca:\n            value = state.dataView.getFloat32(state.offset + 1);\n            state.offset += 5;\n            return value;\n        // float 64\n        case 0xcb:\n            value = state.dataView.getFloat64(state.offset + 1);\n            state.offset += 9;\n            return value;\n        // uint8\n        case 0xcc:\n            value = state.buffer[state.offset + 1];\n            state.offset += 2;\n            return value;\n        // uint 16\n        case 0xcd:\n            value = state.dataView.getUint16(state.offset + 1);\n            state.offset += 3;\n            return value;\n        // uint 32\n        case 0xce:\n            value = state.dataView.getUint32(state.offset + 1);\n            state.offset += 5;\n            return value;\n        // int 8\n        case 0xd0:\n            value = state.dataView.getInt8(state.offset + 1);\n            state.offset += 2;\n            return value;\n        // int 16\n        case 0xd1:\n            value = state.dataView.getInt16(state.offset + 1);\n            state.offset += 3;\n            return value;\n        // int 32\n        case 0xd2:\n            value = state.dataView.getInt32(state.offset + 1);\n            state.offset += 5;\n            return value;\n        // str 8\n        case 0xd9:\n            length = state.dataView.getUint8(state.offset + 1);\n            state.offset += 2;\n            return str(state, length);\n        // str 16\n        case 0xda:\n            length = state.dataView.getUint16(state.offset + 1);\n            state.offset += 3;\n            return str(state, length);\n        // str 32\n        case 0xdb:\n            length = state.dataView.getUint32(state.offset + 1);\n            state.offset += 5;\n            return str(state, length);\n        // array 16\n        case 0xdc:\n            length = state.dataView.getUint16(state.offset + 1);\n            state.offset += 3;\n            return array(state, length);\n        // array 32\n        case 0xdd:\n            length = state.dataView.getUint32(state.offset + 1);\n            state.offset += 5;\n            return array(state, length);\n        // map 16:\n        case 0xde:\n            length = state.dataView.getUint16(state.offset + 1);\n            state.offset += 3;\n            return map(state, length);\n        // map 32\n        case 0xdf:\n            length = state.dataView.getUint32(state.offset + 1);\n            state.offset += 5;\n            return map(state, length);\n    }\n    throw new Error('Unknown type 0x' + type.toString(16));\n}\n","/**\n * Copyright (c) 2017 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport * as Data from '../data-model';\nimport { Field } from './field';\nimport { ReaderResult as Result } from '../../result';\nimport { decodeMsgPack } from '../../../common/msgpack/decode';\nimport { Task } from '../../../../mol-task';\nfunction checkVersions(min, current) {\n    for (let i = 0; i < 2; i++) {\n        if (min[i] > current[i])\n            return false;\n    }\n    return true;\n}\nfunction Category(data) {\n    const map = Object.create(null);\n    const cache = Object.create(null);\n    for (const col of data.columns)\n        map[col.name] = col;\n    return {\n        rowCount: data.rowCount,\n        name: data.name.substr(1),\n        fieldNames: data.columns.map(c => c.name),\n        getField(name) {\n            const col = map[name];\n            if (!col)\n                return void 0;\n            if (!!cache[name])\n                return cache[name];\n            cache[name] = Field(col);\n            return cache[name];\n        }\n    };\n}\nexport function parseCifBinary(data) {\n    return Task.create('Parse BinaryCIF', async (ctx) => {\n        const minVersion = [0, 3];\n        try {\n            const unpacked = decodeMsgPack(data);\n            if (!checkVersions(minVersion, unpacked.version.match(/(\\d)\\.(\\d)\\.\\d/).slice(1).map(v => +v))) {\n                return Result.error(`Unsupported format version. Current ${unpacked.version}, required ${minVersion.join('.')}.`);\n            }\n            const file = Data.CifFile(unpacked.dataBlocks.map(block => {\n                const cats = Object.create(null);\n                for (const cat of block.categories)\n                    cats[cat.name.substr(1)] = Category(cat);\n                return Data.CifBlock(block.categories.map(c => c.name.substr(1)), cats, block.header);\n            }));\n            return Result.success(file);\n        }\n        catch (e) {\n            return Result.error('' + e);\n        }\n    });\n}\n","/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { ColumnHelpers } from '../../../../mol-data/db';\nimport { decode } from '../../../common/binary-cif';\nimport { parseInt as fastParseInt, parseFloat as fastParseFloat } from '../../common/text/number-parser';\nexport function Field(column) {\n    const mask = column.mask ? decode(column.mask) : void 0;\n    const data = decode(column.data);\n    const isNumeric = ColumnHelpers.isTypedArray(data);\n    const str = isNumeric\n        ? mask\n            ? row => mask[row] === 0 /* Column.ValueKinds.Present */ ? '' + data[row] : ''\n            : row => '' + data[row]\n        : mask\n            ? row => mask[row] === 0 /* Column.ValueKinds.Present */ ? data[row] : ''\n            : row => data[row];\n    const int = isNumeric\n        ? row => data[row]\n        : row => { const v = data[row]; return fastParseInt(v, 0, v.length); };\n    const float = isNumeric\n        ? row => data[row]\n        : row => { const v = data[row]; return fastParseFloat(v, 0, v.length); };\n    const valueKind = mask\n        ? row => mask[row]\n        : row => 0 /* Column.ValueKinds.Present */;\n    const rowCount = data.length;\n    return {\n        __array: data,\n        binaryEncoding: column.data.encoding,\n        isDefined: true,\n        rowCount,\n        str,\n        int,\n        float,\n        valueKind,\n        areValuesEqual: (rowA, rowB) => data[rowA] === data[rowB],\n        toStringArray: params => ColumnHelpers.createAndFillArray(rowCount, str, params),\n        toIntArray: isNumeric\n            ? params => ColumnHelpers.typedArrayWindow(data, params)\n            : params => ColumnHelpers.createAndFillArray(rowCount, int, params),\n        toFloatArray: isNumeric\n            ? params => ColumnHelpers.typedArrayWindow(data, params)\n            : params => ColumnHelpers.createAndFillArray(rowCount, float, params)\n    };\n}\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Database, Column, ColumnHelpers } from '../../../mol-data/db';\nimport { Tensor } from '../../../mol-math/linear-algebra';\nimport { arrayEqual } from '../../../mol-util';\nimport * as Data from './data-model';\nexport var FieldPath;\n(function (FieldPath) {\n    function canonical(path) {\n        return path.replace('.', '_').replace(/\\[/, '_').replace(/(\\[|\\])/g, '');\n    }\n    FieldPath.canonical = canonical;\n    function equal(pathA, pathB) {\n        return canonical(pathA) === canonical(pathB);\n    }\n    FieldPath.equal = equal;\n    function create(category, field, asCanonical = false) {\n        const p = `${category}${field ? `.${field}` : ''}`;\n        return asCanonical ? canonical(p) : p;\n    }\n    FieldPath.create = create;\n})(FieldPath || (FieldPath = {}));\nexport function toDatabaseCollection(schema, file, aliases) {\n    const dbc = {};\n    for (const data of file.blocks) {\n        dbc[data.header] = toDatabase(schema, data, aliases);\n    }\n    return dbc;\n}\nexport function toDatabase(schema, frame, aliases) {\n    return createDatabase(schema, frame, aliases);\n}\nexport function toTable(schema, category) {\n    return new CategoryTable(category, schema, true);\n}\nfunction getColumnCtor(t) {\n    switch (t.valueType) {\n        case 'str': return (f, c, k) => createStringColumn(t, f, f.str, f.toStringArray);\n        case 'int': return (f, c, k) => createColumn(t, f, f.int, f.toIntArray);\n        case 'float': return (f, c, k) => createColumn(t, f, f.float, f.toFloatArray);\n        case 'list': throw new Error('Use createListColumn instead.');\n        case 'tensor': throw new Error('Use createTensorColumn instead.');\n    }\n}\nfunction createStringColumn(schema, field, value, toArray) {\n    return {\n        schema,\n        __array: field.__array,\n        isDefined: field.isDefined,\n        rowCount: field.rowCount,\n        value: schema.transform === 'lowercase'\n            ? row => value(row).toLowerCase()\n            : schema.transform === 'uppercase'\n                ? row => value(row).toUpperCase()\n                : value,\n        valueKind: field.valueKind,\n        areValuesEqual: field.areValuesEqual,\n        toArray: schema.transform === 'lowercase'\n            ? p => Array.from(toArray(p)).map(x => x.toLowerCase())\n            : schema.transform === 'uppercase'\n                ? p => Array.from(toArray(p)).map(x => x.toUpperCase())\n                : toArray,\n    };\n}\nfunction createColumn(schema, field, value, toArray) {\n    return {\n        schema,\n        __array: field.__array,\n        isDefined: field.isDefined,\n        rowCount: field.rowCount,\n        value,\n        valueKind: field.valueKind,\n        areValuesEqual: field.areValuesEqual,\n        toArray\n    };\n}\nfunction createListColumn(schema, category, key) {\n    const separator = schema.separator;\n    const itemParse = schema.itemParse;\n    const f = category.getField(key);\n    const value = f ? (row) => f.str(row).split(separator).map(x => itemParse(x.trim())).filter(x => !!x) : (row) => [];\n    const toArray = params => ColumnHelpers.createAndFillArray(category.rowCount, value, params);\n    return {\n        schema,\n        __array: void 0,\n        isDefined: !!f,\n        rowCount: category.rowCount,\n        value,\n        valueKind: f ? f.valueKind : () => 1 /* Column.ValueKinds.NotPresent */,\n        areValuesEqual: (rowA, rowB) => arrayEqual(value(rowA), value(rowB)),\n        toArray\n    };\n}\nfunction createTensorColumn(schema, category, key) {\n    const space = schema.space;\n    const zeroOffset = (category.fieldNames.includes(`${key}[0]`) ||\n        category.fieldNames.includes(`${key}[0][0]`) ||\n        category.fieldNames.includes(`${key}[0][0][0]`));\n    const fst = zeroOffset ? 0 : 1;\n    const namingVariant = (category.fieldNames.includes(`${key}_1`) ||\n        category.fieldNames.includes(`${key}_11`) ||\n        category.fieldNames.includes(`${key}_111`)) ? 'underscore' : 'brackets';\n    const getName = Data.tensorFieldNameGetter(key, space.rank, zeroOffset, namingVariant);\n    const first = category.getField(getName(fst, fst, fst)) || Column.Undefined(category.rowCount, schema);\n    const value = (row) => Data.getTensor(category, space, row, getName);\n    const toArray = params => ColumnHelpers.createAndFillArray(category.rowCount, value, params);\n    return {\n        schema,\n        __array: void 0,\n        isDefined: first.isDefined,\n        rowCount: category.rowCount,\n        value,\n        valueKind: first.valueKind,\n        areValuesEqual: (rowA, rowB) => Tensor.areEqualExact(value(rowA), value(rowB)),\n        toArray\n    };\n}\nclass CategoryTable {\n    constructor(category, schema, _isDefined) {\n        this._isDefined = _isDefined;\n        const fieldKeys = Object.keys(schema);\n        this._rowCount = category.rowCount;\n        this._columns = fieldKeys;\n        this._schema = schema;\n        const cache = Object.create(null);\n        for (const k of fieldKeys) {\n            Object.defineProperty(this, k, {\n                get: function () {\n                    if (cache[k])\n                        return cache[k];\n                    const fType = schema[k];\n                    if (fType.valueType === 'list') {\n                        cache[k] = createListColumn(fType, category, k);\n                    }\n                    else if (fType.valueType === 'tensor') {\n                        cache[k] = createTensorColumn(fType, category, k);\n                    }\n                    else {\n                        const ctor = getColumnCtor(fType);\n                        const field = category.getField(k);\n                        cache[k] = !!field ? ctor(field, category, k) : Column.Undefined(category.rowCount, fType);\n                    }\n                    return cache[k];\n                },\n                enumerable: true,\n                configurable: false\n            });\n        }\n    }\n}\nfunction createDatabase(schema, frame, aliases) {\n    const tables = Object.create(null);\n    for (const k of Object.keys(schema)) {\n        tables[k] = createTable(k, schema[k], frame, aliases);\n    }\n    return Database.ofTables(frame.header, schema, tables);\n}\nfunction flattenFrame(frame) {\n    const flatFrame = Object.create(null);\n    for (const c of Object.keys(frame.categories)) {\n        for (const f of frame.categories[c].fieldNames) {\n            const p = FieldPath.create(c, f, true);\n            flatFrame[p] = frame.categories[c].getField(f);\n        }\n    }\n    return flatFrame;\n}\nfunction getField(field, category, flatFrame, aliases) {\n    const path = FieldPath.create(category, field);\n    const canonicalPath = FieldPath.canonical(path);\n    if (canonicalPath in flatFrame)\n        return flatFrame[canonicalPath];\n    if (aliases && path in aliases) {\n        for (const aliased of aliases[path]) {\n            const canonicalAliased = FieldPath.canonical(aliased);\n            if (canonicalAliased in flatFrame)\n                return flatFrame[canonicalAliased];\n        }\n    }\n}\nfunction createTable(key, schema, frame, aliases) {\n    let cat = frame.categories[key];\n    if (aliases) {\n        const flatFrame = flattenFrame(frame);\n        const fields = Object.create(null);\n        const fieldNames = [];\n        let rowCount = 0;\n        for (const k of Object.keys(schema)) {\n            const field = getField(k, key, flatFrame, aliases);\n            if (field) {\n                fields[k] = field;\n                fieldNames.push(k);\n                rowCount = field.rowCount;\n            }\n        }\n        cat = {\n            rowCount,\n            name: key,\n            fieldNames: [...fieldNames],\n            getField(name) {\n                return fields[name];\n            }\n        };\n    }\n    return new CategoryTable(cat || Data.CifCategory.empty(key), schema, !!cat);\n}\n","/**\n * Copyright (c) 2017-2020 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { BitFlags } from './bit-flags';\nimport { StringBuilder } from './string-builder';\nimport { UUID } from './uuid';\nimport { Mask } from './mask';\nexport * from './value-cell';\nexport { BitFlags, StringBuilder, UUID, Mask };\nexport const noop = function () { };\nexport function round(n, d) {\n    const f = Math.pow(10, d);\n    return Math.round(f * n) / f;\n}\nexport function arrayEqual(arr1, arr2) {\n    const length = arr1.length;\n    if (length !== arr2.length)\n        return false;\n    for (let i = 0; i < length; i++) {\n        if (arr1[i] !== arr2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nexport function deepEqual(a, b) {\n    // from https://github.com/epoberezkin/fast-deep-equal MIT\n    if (a === b)\n        return true;\n    const arrA = Array.isArray(a);\n    const arrB = Array.isArray(b);\n    if (arrA && arrB) {\n        if (a.length !== b.length)\n            return false;\n        for (let i = 0; i < a.length; i++) {\n            if (!deepEqual(a[i], b[i]))\n                return false;\n        }\n        return true;\n    }\n    if (arrA !== arrB)\n        return false;\n    if (a && b && typeof a === 'object' && typeof b === 'object') {\n        const keys = Object.keys(a);\n        if (keys.length !== Object.keys(b).length)\n            return false;\n        const dateA = a instanceof Date;\n        const dateB = b instanceof Date;\n        if (dateA && dateB)\n            return a.getTime() === b.getTime();\n        if (dateA !== dateB)\n            return false;\n        const regexpA = a instanceof RegExp;\n        const regexpB = b instanceof RegExp;\n        if (regexpA && regexpB)\n            return a.toString() === b.toString();\n        if (regexpA !== regexpB)\n            return false;\n        for (let i = 0; i < keys.length; i++) {\n            if (!hasOwnProperty.call(b, keys[i]))\n                return false;\n        }\n        for (let i = 0; i < keys.length; i++) {\n            if (!deepEqual(a[keys[i]], b[keys[i]]))\n                return false;\n        }\n        return true;\n    }\n    return false;\n}\nexport function shallowEqual(a, b) {\n    if (a === b)\n        return true;\n    const arrA = Array.isArray(a);\n    const arrB = Array.isArray(b);\n    if (arrA && arrB)\n        return shallowEqualArrays(a, b);\n    if (arrA !== arrB)\n        return false;\n    if (a && b && typeof a === 'object' && typeof b === 'object') {\n        return shallowEqualObjects(a, b);\n    }\n    return false;\n}\nexport function shallowEqualObjects(a, b) {\n    if (a === b)\n        return true;\n    if (!a || !b)\n        return false;\n    const keys = Object.keys(a);\n    if (Object.keys(b).length !== keys.length)\n        return false;\n    for (const k of keys) {\n        if (!hasOwnProperty.call(a, k) || a[k] !== b[k])\n            return false;\n    }\n    return true;\n}\nexport function shallowEqualArrays(a, b) {\n    if (a === b)\n        return true;\n    if (!a || !b)\n        return false;\n    if (a.length !== b.length)\n        return false;\n    for (let i = 0, il = a.length; i < il; ++i) {\n        if (a[i] !== b[i])\n            return false;\n    }\n    return true;\n}\n/** Returns `value` if not `undefined`, otherwise returns `defaultValue` */\nexport function defaults(value, defaultValue) {\n    return value !== undefined ? value : defaultValue;\n}\nexport function extend(object, source, guard) {\n    let v;\n    const s = source;\n    const o = object;\n    const g = guard;\n    for (const k of Object.keys(source)) {\n        v = s[k];\n        if (v !== void 0)\n            o[k] = v;\n        else if (guard)\n            o[k] = g[k];\n    }\n    if (guard) {\n        for (const k of Object.keys(guard)) {\n            v = o[k];\n            if (v === void 0)\n                o[k] = g[k];\n        }\n    }\n    return object;\n}\nexport function shallowClone(o) {\n    return extend({}, o);\n}\nfunction _assign(target) {\n    for (let s = 1; s < arguments.length; s++) {\n        const from = arguments[s];\n        for (const key of Object.keys(from)) {\n            if (hasOwnProperty.call(from, key)) {\n                target[key] = from[key];\n            }\n        }\n    }\n    return target;\n}\nexport const assign = Object.assign || _assign;\nfunction _shallowMerge1(source, update) {\n    let changed = false;\n    for (const k of Object.keys(update)) {\n        if (!hasOwnProperty.call(update, k))\n            continue;\n        if (update[k] !== source[k]) {\n            changed = true;\n            break;\n        }\n    }\n    if (!changed)\n        return source;\n    return assign(shallowClone(source), update);\n}\nfunction _shallowMerge(source) {\n    let ret = source;\n    for (let s = 1; s < arguments.length; s++) {\n        if (!arguments[s])\n            continue;\n        ret = _shallowMerge1(source, arguments[s]);\n        if (ret !== source) {\n            for (let i = s + 1; i < arguments.length; i++) {\n                ret = assign(ret, arguments[i]);\n            }\n            break;\n        }\n    }\n    return ret;\n}\nexport const merge = _shallowMerge;\nfunction padTime(n) { return (n < 10 ? '0' : '') + n; }\nexport function formatTime(d) {\n    const h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();\n    return `${h}:${padTime(m)}:${padTime(s)}`;\n}\nexport function formatProgress(p) {\n    const tp = p.root.progress;\n    if (tp.isIndeterminate)\n        return tp.message;\n    const x = (100 * tp.current / tp.max).toFixed(2);\n    return `${tp.message} ${x}%`;\n}\nexport function formatBytes(count) {\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    const i = Math.floor(Math.log(count) / Math.log(1024));\n    return `${(count / Math.pow(1024, i)).toFixed(2)} ${units[i]}`;\n}\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Code-generated 'mmCIF' schema file. Dictionary versions: mmCIF 5.391, IHM 1.25, MA 1.4.6.\n *\n * @author molstar/ciftools package\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst str = Schema.str;\nconst int = Schema.int;\nconst float = Schema.float;\nconst coord = Schema.coord;\nconst Aliased = Schema.Aliased;\nconst Matrix = Schema.Matrix;\nconst Vector = Schema.Vector;\nconst lstr = Schema.lstr;\nconst List = Schema.List;\nexport const mmCIF_Schema = {\n    /**\n     * Data items in the ATOM_SITE category record details about\n     * the atom sites in a macromolecular crystal structure, such as\n     * the positional coordinates, atomic displacement parameters,\n     * magnetic moments and directions.\n     *\n     * The data items for describing anisotropic atomic\n     * displacement factors are only used if the corresponding items\n     * are not given in the ATOM_SITE_ANISOTROP category.\n     *\n     * wwPDB recommends wwPDB-assigned residue number, residue ID,\n     * and chain ID, _atom_site.auth_seq_id _atom_site.auth_comp_id, and\n     * _atom_site.auth_asym_id, respectively, to be used for publication\n     * materials.\n     */\n    atom_site: {\n        /**\n         * An alternative identifier for _atom_site.label_asym_id that\n         * may be provided by an author in order to match the identification\n         * used in the publication that describes the structure.\n         */\n        auth_asym_id: str,\n        /**\n         * An alternative identifier for _atom_site.label_atom_id that\n         * may be provided by an author in order to match the identification\n         * used in the publication that describes the structure.\n         */\n        auth_atom_id: str,\n        /**\n         * An alternative identifier for _atom_site.label_comp_id that\n         * may be provided by an author in order to match the identification\n         * used in the publication that describes the structure.\n         */\n        auth_comp_id: str,\n        /**\n         * An alternative identifier for _atom_site.label_seq_id that\n         * may be provided by an author in order to match the identification\n         * used in the publication that describes the structure.\n         *\n         * Note that this is not necessarily a number, that the values do\n         * not have to be positive, and that the value does not have to\n         * correspond to the value of _atom_site.label_seq_id. The value\n         * of _atom_site.label_seq_id is required to be a sequential list\n         * of positive integers.\n         *\n         * The author may assign values to _atom_site.auth_seq_id in any\n         * desired way. For instance, the values may be used to relate\n         * this structure to a numbering scheme in a homologous structure,\n         * including sequence gaps or insertion codes. Alternatively, a\n         * scheme may be used for a truncated polymer that maintains the\n         * numbering scheme of the full length polymer. In all cases, the\n         * scheme used here must match the scheme used in the publication\n         * that describes the structure.\n         */\n        auth_seq_id: int,\n        /**\n         * Isotropic atomic displacement parameter, or equivalent isotropic\n         * atomic displacement parameter, B~eq~, calculated from the\n         * anisotropic displacement parameters.\n         *\n         * B~eq~ = (1/3) sum~i~[sum~j~(B^ij^ A~i~ A~j~ a*~i~ a*~j~)]\n         *\n         * A     = the real space cell lengths\n         * a*    = the reciprocal space cell lengths\n         * B^ij^ = 8 pi^2^ U^ij^\n         *\n         * Ref: Fischer, R. X. & Tillmanns, E. (1988). Acta Cryst. C44,\n         * 775-776.\n         *\n         * The IUCr Commission on Nomenclature recommends against the use\n         * of B for reporting atomic displacement parameters. U, being\n         * directly proportional to B, is preferred.\n         *\n         * Note -\n         *\n         * The particular type of ADP stored in this item is qualified\n         * by item _refine.pdbx_adp_type.\n         */\n        B_iso_or_equiv: float,\n        /**\n         * The x atom-site coordinate in angstroms specified according to\n         * a set of orthogonal Cartesian axes related to the cell axes as\n         * specified by the description given in\n         * _atom_sites.Cartn_transform_axes.\n         */\n        Cartn_x: coord,\n        /**\n         * The y atom-site coordinate in angstroms specified according to\n         * a set of orthogonal Cartesian axes related to the cell axes as\n         * specified by the description given in\n         * _atom_sites.Cartn_transform_axes.\n         */\n        Cartn_y: coord,\n        /**\n         * The z atom-site coordinate in angstroms specified according to\n         * a set of orthogonal Cartesian axes related to the cell axes as\n         * specified by the description given in\n         * _atom_sites.Cartn_transform_axes.\n         */\n        Cartn_z: coord,\n        /**\n         * The group of atoms to which the atom site belongs. This data\n         * item is provided for compatibility with the original Protein\n         * Data Bank format, and only for that purpose.\n         */\n        group_PDB: Aliased(str),\n        /**\n         * The value of _atom_site.id must uniquely identify a record in the\n         * ATOM_SITE list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         *\n         * This data item was introduced to provide compatibility between\n         * small-molecule and macromolecular CIFs. In a small-molecule\n         * CIF, _atom_site_label is the identifier for the atom. In a\n         * macromolecular CIF, the atom identifier is the aggregate of\n         * _atom_site.label_alt_id, _atom_site.label_asym_id,\n         * _atom_site.label_atom_id, _atom_site.label_comp_id and\n         * _atom_site.label_seq_id. For the two types of files to be\n         * compatible, a formal identifier for the category had to be\n         * introduced that was independent of the different modes of\n         * identifying the atoms. For compatibility with older CIFs,\n         * _atom_site_label is aliased to _atom_site.id.\n         *\n         * In general, this aggregate identifier does not uniquely\n         * identify an atom site as for non-polymers _atom_site.label_seq_id\n         * is '.'.\n         */\n        id: int,\n        /**\n         * A place holder to indicate alternate conformation. The alternate conformation\n         * can be an entire polymer chain, or several residues or\n         * partial residue (several atoms within one residue). If\n         * an atom is provided in more than one position, then a\n         * non-blank alternate location indicator must be used for\n         * each of the atomic positions.\n         */\n        label_alt_id: str,\n        /**\n         * A component of the identifier for this atom site.\n         * For further details, see the definition of the STRUCT_ASYM\n         * category.\n         *\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        label_asym_id: str,\n        /**\n         * A component of the identifier for this atom site.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        label_atom_id: str,\n        /**\n         * A component of the identifier for this atom site.\n         *\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        label_comp_id: str,\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        label_entity_id: str,\n        /**\n         * This data item is a pointer to _entity_poly_seq.num in the\n         * ENTITY_POLY_SEQ category.\n         */\n        label_seq_id: int,\n        /**\n         * The fraction of the atom type present at this site.\n         * The sum of the occupancies of all the atom types at this site\n         * may not exceed 1.0 unless it is a dummy site.\n         */\n        occupancy: float,\n        /**\n         * This data item is a pointer to _atom_type.symbol in the\n         * ATOM_TYPE category.\n         */\n        type_symbol: str,\n        /**\n         * PDB insertion code.\n         */\n        pdbx_PDB_ins_code: str,\n        /**\n         * PDB model number.\n         */\n        pdbx_PDB_model_num: int,\n        /**\n         * The net integer charge assigned to this atom. This is the\n         * formal charge assignment normally found in chemical diagrams.\n         */\n        pdbx_formal_charge: int,\n        /**\n         * This data item is an ordinal which identifies distinct chemical components in the atom_site category, both\n         * polymeric and non-polymeric.\n         */\n        pdbx_label_index: int,\n        /**\n         * The name of additional external databases with residue level mapping.\n         */\n        pdbx_sifts_xref_db_name: str,\n        /**\n         * The accession code related to the additional external database entry.\n         */\n        pdbx_sifts_xref_db_acc: str,\n        /**\n         * The sequence position of the external database entry that corresponds\n         * to the residue mapping defined by the SIFTS process.\n         */\n        pdbx_sifts_xref_db_num: str,\n        /**\n         * Describes the residue type of the given UniProt match\n         */\n        pdbx_sifts_xref_db_res: str,\n        /**\n         * The model id corresponding to the atom site.\n         * This data item is a pointer to _ihm_model_list.model_id\n         * in the IHM_MODEL_LIST category.\n         */\n        ihm_model_id: int,\n    },\n    /**\n     * Data items in the ATOM_SITE_ANISOTROP category record details\n     * about anisotropic displacement parameters.\n     * If the ATOM_SITE_ANISOTROP category is used for storing these\n     * data, the corresponding ATOM_SITE data items are not used.\n     */\n    atom_site_anisotrop: {\n        /**\n         * This data item is a pointer to _atom_site.id in the ATOM_SITE\n         * category.\n         */\n        id: int,\n        /**\n         * This data item is a pointer to _atom_type.symbol in the\n         * ATOM_TYPE category.\n         */\n        type_symbol: str,\n        /**\n         * The elements of the standard anisotropic atomic\n         * displacement matrix U, which appears in the structure-factor\n         * term as:\n         *\n         * T = exp{-2 pi^2^ sum~i~[sum~j~(U^ij^ h~i~ h~j~ a*~i~ a*~j~)]}\n         *\n         * h  = the Miller indices\n         * a* = the reciprocal space cell lengths\n         *\n         * These matrix elements may appear with atomic coordinates\n         * in the ATOM_SITE category, or they may appear in the separate\n         * ATOM_SITE_ANISOTROP category, but they may not appear in both\n         * places. Similarly, anisotropic displacements may appear as\n         * either B's or U's, but not as both.\n         *\n         * The unique elements of the real symmetric matrix are\n         * entered by row.\n         */\n        U: Matrix(3, 3),\n        /**\n         * The standard uncertainty (estimated standard deviation)\n         * of _atom_site_anisotrop.U.\n         */\n        U_esd: Matrix(3, 3),\n        /**\n         * Pointer to _atom_site.auth_seq_id\n         */\n        pdbx_auth_seq_id: str,\n        /**\n         * Pointer to _atom_site.auth_asym_id\n         */\n        pdbx_auth_asym_id: str,\n        /**\n         * Pointer to _atom_site.auth_atom_id\n         */\n        pdbx_auth_atom_id: str,\n        /**\n         * Pointer to _atom_site.auth_comp_id\n         */\n        pdbx_auth_comp_id: str,\n        /**\n         * Pointer to _atom_site.label_seq_id\n         */\n        pdbx_label_seq_id: int,\n        /**\n         * Pointer to _atom_site.label_alt_id.\n         */\n        pdbx_label_alt_id: str,\n        /**\n         * Pointer to _atom_site.label_asym_id\n         */\n        pdbx_label_asym_id: str,\n        /**\n         * Pointer to _atom_site.label_atom_id\n         */\n        pdbx_label_atom_id: str,\n        /**\n         * Pointer to _atom_site.label_comp_id\n         */\n        pdbx_label_comp_id: str,\n        /**\n         * Pointer to _atom_site.pdbx_PDB_ins_code\n         */\n        pdbx_PDB_ins_code: str,\n    },\n    /**\n     * Data items in the ATOM_SITES category record details about\n     * the crystallographic cell and cell transformations, which are\n     * common to all atom sites.\n     */\n    atom_sites: {\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * The elements of the 3x3 matrix used to transform Cartesian\n         * coordinates in the ATOM_SITE category to fractional coordinates\n         * in the same category. The axial alignments of this\n         * transformation are described in _atom_sites.Cartn_transform_axes.\n         * The 3x1 translation is defined in\n         * _atom_sites.fract_transf_vector[].\n         *\n         * |x'|               |11 12 13| |x|              |1|\n         * |y'|~fractional~ = |21 22 23| |y|~Cartesian~ + |2|\n         * |z'|               |31 32 33| |z|              |3|\n         */\n        fract_transf_matrix: Matrix(3, 3),\n        /**\n         * The elements of the three-element vector used to transform\n         * Cartesian coordinates in the ATOM_SITE category to fractional\n         * coordinates in the same category. The axial alignments of this\n         * transformation are described in _atom_sites.Cartn_transform_axes.\n         * The 3x3 rotation is defined in\n         * _atom_sites.fract_transf_matrix[][].\n         *\n         * |x'|               |11 12 13| |x|              |1|\n         * |y'|~fractional~ = |21 22 23| |y|~Cartesian~ + |2|\n         * |z'|               |31 32 33| |z|              |3|\n         */\n        fract_transf_vector: Vector(3),\n    },\n    /**\n     * Data items in the AUDIT_AUTHOR category record details about\n     * the author(s) of the data block.\n     */\n    audit_author: {\n        /**\n         * The name of an author of this data block. If there are multiple\n         * authors, _audit_author.name is looped with _audit_author.address.\n         * The family name(s), followed by a comma and including any\n         * dynastic components, precedes the first name(s) or initial(s).\n         */\n        name: str,\n        /**\n         * This data item defines the order of the author's name in the\n         * list of audit authors.\n         */\n        pdbx_ordinal: int,\n        /**\n         * The Open Researcher and Contributor ID (ORCID).\n         */\n        identifier_ORCID: str,\n    },\n    /**\n     * Data items in the AUDIT_CONFORM category describe the\n     * dictionary versions against which the data names appearing in\n     * the current data block are conformant.\n     */\n    audit_conform: {\n        /**\n         * A file name or uniform resource locator (URL) for the\n         * dictionary to which the current data block conforms.\n         */\n        dict_location: str,\n        /**\n         * The string identifying the highest-level dictionary defining\n         * data names used in this file.\n         */\n        dict_name: str,\n        /**\n         * The version number of the dictionary to which the current\n         * data block conforms.\n         */\n        dict_version: str,\n    },\n    /**\n     * Data items in the CELL category record details about the\n     * crystallographic cell parameters.\n     */\n    cell: {\n        /**\n         * Unit-cell angle alpha of the reported structure in degrees.\n         */\n        angle_alpha: float,\n        /**\n         * Unit-cell angle beta of the reported structure in degrees.\n         */\n        angle_beta: float,\n        /**\n         * Unit-cell angle gamma of the reported structure in degrees.\n         */\n        angle_gamma: float,\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * Unit-cell length a corresponding to the structure reported in\n         * angstroms.\n         */\n        length_a: float,\n        /**\n         * Unit-cell length b corresponding to the structure reported in\n         * angstroms.\n         */\n        length_b: float,\n        /**\n         * Unit-cell length c corresponding to the structure reported in\n         * angstroms.\n         */\n        length_c: float,\n        /**\n         * The number of the polymeric chains in a unit cell. In the case\n         * of heteropolymers, Z is the number of occurrences of the most\n         * populous chain.\n         *\n         * This data item is provided for compatibility with the original\n         * Protein Data Bank format, and only for that purpose.\n         */\n        Z_PDB: int,\n        /**\n         * To further identify unique axis if necessary.  E.g., P 21 with\n         * an unique C axis will have 'C' in this field.\n         */\n        pdbx_unique_axis: str,\n    },\n    /**\n     * Data items in the CHEM_COMP category give details about each\n     * of the chemical components from which the relevant chemical\n     * structures can be constructed, such as name, mass or charge.\n     *\n     * The related categories CHEM_COMP_ATOM, CHEM_COMP_BOND,\n     * CHEM_COMP_ANGLE etc. describe the detailed geometry of these\n     * chemical components.\n     */\n    chem_comp: {\n        /**\n         * The formula for the chemical component. Formulae are written\n         * according to the following rules:\n         *\n         * (1) Only recognized element symbols may be used.\n         *\n         * (2) Each element symbol is followed by a 'count' number. A count\n         * of '1' may be omitted.\n         *\n         * (3) A space or parenthesis must separate each cluster of\n         * (element symbol + count), but in general parentheses are\n         * not used.\n         *\n         * (4) The order of elements depends on whether carbon is\n         * present or not. If carbon is present, the order should be:\n         * C, then H, then the other elements in alphabetical order\n         * of their symbol. If carbon is not present, the elements\n         * are listed purely in alphabetic order of their symbol. This\n         * is the 'Hill' system used by Chemical Abstracts.\n         */\n        formula: str,\n        /**\n         * Formula mass in daltons of the chemical component.\n         */\n        formula_weight: float,\n        /**\n         * The value of _chem_comp.id must uniquely identify each item in\n         * the CHEM_COMP list.\n         *\n         * For protein polymer entities, this is the three-letter code for\n         * the amino acid.\n         *\n         * For nucleic acid polymer entities, this is the one-letter code\n         * for the base.\n         */\n        id: str,\n        /**\n         * 'yes' indicates that this is a 'standard' monomer, 'no'\n         * indicates that it is 'nonstandard'. Nonstandard monomers\n         * should be described in more detail using the\n         * _chem_comp.mon_nstd_parent, _chem_comp.mon_nstd_class and\n         * _chem_comp.mon_nstd_details data items.\n         */\n        mon_nstd_flag: Aliased(lstr),\n        /**\n         * The full name of the component.\n         */\n        name: str,\n        /**\n         * For standard polymer components, the type of the monomer.\n         * Note that monomers that will form polymers are of three types:\n         * linking monomers, monomers with some type of N-terminal (or 5')\n         * cap and monomers with some type of C-terminal (or 3') cap.\n         */\n        type: Aliased(lstr),\n        /**\n         * Synonym list for the component.\n         */\n        pdbx_synonyms: List(';', x => x),\n    },\n    /**\n     * Data items in the CHEM_COMP_BOND category record details about\n     * the bonds between atoms in a chemical component. Target values\n     * may be specified as bond orders, as a distance between the two\n     * atoms, or both.\n     */\n    chem_comp_bond: {\n        /**\n         * The ID of the first of the two atoms that define the bond.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_1: str,\n        /**\n         * The ID of the second of the two atoms that define the bond.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_2: str,\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * The value that should be taken as the target for the chemical\n         * bond associated with the specified atoms, expressed as a bond\n         * order.\n         */\n        value_order: Aliased(lstr),\n        /**\n         * Ordinal index for the component bond list.\n         */\n        pdbx_ordinal: int,\n        /**\n         * Stereochemical configuration across a double bond.\n         */\n        pdbx_stereo_config: Aliased(lstr),\n        /**\n         * A flag indicating an aromatic bond.\n         */\n        pdbx_aromatic_flag: Aliased(lstr),\n    },\n    /**\n     * Data items in the CITATION category record details about the\n     * literature cited as being relevant to the contents of the data\n     * block.\n     */\n    citation: {\n        /**\n         * The name of the publisher of the citation; relevant\n         * for books or book chapters.\n         */\n        book_publisher: str,\n        /**\n         * The country/region of publication; relevant for books\n         * and book chapters.\n         */\n        country: str,\n        /**\n         * The value of _citation.id must uniquely identify a record in the\n         * CITATION list.\n         *\n         * The _citation.id 'primary' should be used to indicate the\n         * citation that the author(s) consider to be the most pertinent to\n         * the contents of the data block.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * Abbreviated name of the cited journal as given in the\n         * Chemical Abstracts Service Source Index.\n         */\n        journal_abbrev: str,\n        /**\n         * The American Society for Testing and Materials (ASTM) code\n         * assigned to the journal cited (also referred to as the CODEN\n         * designator of the Chemical Abstracts Service); relevant for\n         * journal articles.\n         */\n        journal_id_ASTM: str,\n        /**\n         * The Cambridge Structural Database (CSD) code assigned to the\n         * journal cited; relevant for journal articles. This is also the\n         * system used at the Protein Data Bank (PDB).\n         */\n        journal_id_CSD: str,\n        /**\n         * The International Standard Serial Number (ISSN) code assigned to\n         * the journal cited; relevant for journal articles.\n         */\n        journal_id_ISSN: str,\n        /**\n         * Volume number of the journal cited; relevant for journal\n         * articles.\n         */\n        journal_volume: str,\n        /**\n         * The first page of the citation; relevant for journal\n         * articles, books and book chapters.\n         */\n        page_first: str,\n        /**\n         * The last page of the citation; relevant for journal\n         * articles, books and book chapters.\n         */\n        page_last: str,\n        /**\n         * The title of the citation; relevant for journal articles, books\n         * and book chapters.\n         */\n        title: str,\n        /**\n         * The year of the citation; relevant for journal articles, books\n         * and book chapters.\n         */\n        year: int,\n        /**\n         * Document Object Identifier used by doi.org to uniquely\n         * specify bibliographic entry.\n         */\n        pdbx_database_id_DOI: str,\n        /**\n         * Ascession number used by PubMed to categorize a specific\n         * bibliographic entry.\n         */\n        pdbx_database_id_PubMed: int,\n    },\n    /**\n     * Data items in the CITATION_AUTHOR category record details\n     * about the authors associated with the citations in the\n     * CITATION list.\n     */\n    citation_author: {\n        /**\n         * This data item is a pointer to _citation.id in the CITATION\n         * category.\n         */\n        citation_id: str,\n        /**\n         * Name of an author of the citation; relevant for journal\n         * articles, books and book chapters.\n         *\n         * The family name(s), followed by a comma and including any\n         * dynastic components, precedes the first name(s) or initial(s).\n         */\n        name: str,\n        /**\n         * This data item defines the order of the author's name in the\n         * list of authors of a citation.\n         */\n        ordinal: int,\n    },\n    /**\n     * Data items in the DATABASE_2 category record details about the\n     * database identifiers of the data block.\n     *\n     * These data items are assigned by database managers and should\n     * only appear in a data block if they originate from that source.\n     *\n     * The name of this category, DATABASE_2, arose because the\n     * category name DATABASE was already in use in the core CIF\n     * dictionary, but was used differently from the way it needed\n     * to be used in the mmCIF dictionary. Since CIF data names\n     * cannot be changed once they have been adopted, a new category\n     * had to be created.\n     */\n    database_2: {\n        /**\n         * An abbreviation that identifies the database.\n         */\n        database_id: Aliased(lstr),\n        /**\n         * The code assigned by the database identified in\n         * _database_2.database_id.\n         */\n        database_code: str,\n    },\n    /**\n     * Data items in the ENTITY category record details (such as\n     * chemical composition, name and source) about the molecular\n     * entities that are present in the crystallographic structure.\n     *\n     * Items in the various ENTITY subcategories provide a full\n     * chemical description of these molecular entities.\n     *\n     * Entities are of three types:  polymer, non-polymer and water.\n     * Note that the water category includes only water;  ordered\n     * solvent such as sulfate ion or acetone would be described as\n     * individual non-polymer entities.\n     *\n     * The ENTITY category is specific to macromolecular CIF\n     * applications and replaces the function of the CHEMICAL category\n     * in the CIF core.\n     *\n     * It is important to remember that the ENTITY data are not the\n     * result of the crystallographic experiment;  those results are\n     * represented by the ATOM_SITE data items. ENTITY data items\n     * describe the chemistry of the molecules under investigation\n     * and can most usefully be thought of as the ideal groups to which\n     * the structure is restrained or constrained during refinement.\n     *\n     * It is also important to remember that entities do not correspond\n     * directly to the enumeration of the contents of the asymmetric\n     * unit. Entities are described only once, even in those structures\n     * that contain multiple observations of an entity. The\n     * STRUCT_ASYM data items, which reference the entity list,\n     * describe and label the contents of the asymmetric unit.\n     */\n    entity: {\n        /**\n         * A description of special aspects of the entity.\n         */\n        details: str,\n        /**\n         * Formula mass in daltons of the entity.\n         */\n        formula_weight: float,\n        /**\n         * The value of _entity.id must uniquely identify a record in the\n         * ENTITY list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * The method by which the sample for the entity was produced.\n         * Entities isolated directly from natural sources (tissues, soil\n         * samples etc.) are expected to have further information in the\n         * ENTITY_SRC_NAT category. Entities isolated from genetically\n         * manipulated sources are expected to have further information in\n         * the ENTITY_SRC_GEN category.\n         */\n        src_method: Aliased(lstr),\n        /**\n         * Defines the type of the entity.\n         *\n         * Polymer entities are expected to have corresponding\n         * ENTITY_POLY and associated entries.\n         *\n         * Non-polymer entities are expected to have corresponding\n         * CHEM_COMP and associated entries.\n         *\n         * Water entities are not expected to have corresponding\n         * entries in the ENTITY category.\n         */\n        type: Aliased(lstr),\n        /**\n         * A description of the entity.\n         *\n         * Corresponds to the compound name in the PDB format.\n         */\n        pdbx_description: List(',', x => x),\n        /**\n         * A place holder for the number of molecules of the entity in\n         * the entry.\n         */\n        pdbx_number_of_molecules: int,\n        /**\n         * Details about any entity mutation(s).\n         */\n        pdbx_mutation: str,\n        /**\n         * Entity fragment description(s).\n         */\n        pdbx_fragment: str,\n        /**\n         * Enzyme Commission (EC) number(s)\n         */\n        pdbx_ec: List(',', x => x),\n    },\n    /**\n     * Data items in the ENTITY_POLY category record details about the\n     * polymer, such as the type of the polymer, the number of\n     * monomers and whether it has nonstandard features.\n     */\n    entity_poly: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A flag to indicate whether the polymer contains at least\n         * one monomer-to-monomer link different from that implied by\n         * _entity_poly.type.\n         */\n        nstd_linkage: Aliased(lstr),\n        /**\n         * A flag to indicate whether the polymer contains at least\n         * one monomer that is not considered standard.\n         */\n        nstd_monomer: Aliased(lstr),\n        /**\n         * The type of the polymer.\n         */\n        type: Aliased(str),\n        /**\n         * The PDB strand/chain id(s) corresponding to this polymer entity.\n         */\n        pdbx_strand_id: List(',', x => x),\n        /**\n         * Sequence of protein or nucleic acid polymer in standard one-letter\n         * codes of amino acids or nucleotides. Non-standard amino\n         * acids/nucleotides are represented by their Chemical\n         * Component Dictionary (CCD) codes in\n         * parenthesis. Deoxynucleotides are represented by the\n         * specially-assigned 2-letter CCD codes in parenthesis,\n         * with 'D' prefix added to their ribonucleotide\n         * counterparts. For hybrid polymer, each residue is\n         * represented by the code of its individual type. A\n         * cyclic polymer is represented in linear sequence from\n         * the chosen start to end.\n         *\n         * A for Alanine or Adenosine-5'-monophosphate\n         * C for Cysteine or Cytidine-5'-monophosphate\n         * D for Aspartic acid\n         * E for Glutamic acid\n         * F for Phenylalanine\n         * G for Glycine or Guanosine-5'-monophosphate\n         * H for Histidine\n         * I for Isoleucine or Inosinic Acid\n         * L for Leucine\n         * K for Lysine\n         * M for Methionine\n         * N for Asparagine  or Unknown ribonucleotide\n         * O for Pyrrolysine\n         * P for Proline\n         * Q for Glutamine\n         * R for Arginine\n         * S for Serine\n         * T for Threonine\n         * U for Selenocysteine or Uridine-5'-monophosphate\n         * V for Valine\n         * W for Tryptophan\n         * Y for Tyrosine\n         * (DA) for 2'-deoxyadenosine-5'-monophosphate\n         * (DC) for 2'-deoxycytidine-5'-monophosphate\n         * (DG) for 2'-deoxyguanosine-5'-monophosphate\n         * (DT) for Thymidine-5'-monophosphate\n         * (MSE) for Selenomethionine\n         * (SEP) for Phosphoserine\n         * (PTO) for Phosphothreonine\n         * (PTR) for Phosphotyrosine\n         * (PCA) for Pyroglutamic acid\n         * (UNK) for Unknown amino acid\n         * (ACE) for Acetylation cap\n         * (NH2) for Amidation cap\n         */\n        pdbx_seq_one_letter_code: str,\n        /**\n         * Canonical sequence of protein or nucleic acid polymer in standard\n         * one-letter codes of amino acids or nucleotides,\n         * corresponding to the sequence in\n         * _entity_poly.pdbx_seq_one_letter_code. Non-standard\n         * amino acids/nucleotides are represented by the codes of\n         * their parents if parent is specified in\n         * _chem_comp.mon_nstd_parent_comp_id, or by letter 'X' if\n         * parent is not specified. Deoxynucleotides are\n         * represented by their canonical one-letter codes of A,\n         * C, G, or T.\n         *\n         * For modifications with several parent amino acids,\n         * all corresponding parent amino acid codes will be listed\n         * (ex. chromophores).\n         */\n        pdbx_seq_one_letter_code_can: str,\n        /**\n         * For Structural Genomics entries, the sequence's target identifier registered at the TargetTrack database.\n         */\n        pdbx_target_identifier: str,\n    },\n    /**\n     * Data items in the ENTITY_POLY_SEQ category specify the sequence\n     * of monomers in a polymer. Allowance is made for the possibility\n     * of microheterogeneity in a sample by allowing a given sequence\n     * number to be correlated with more than one monomer ID. The\n     * corresponding ATOM_SITE entries should reflect this\n     * heterogeneity.\n     */\n    entity_poly_seq: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A flag to indicate whether this monomer in the polymer is\n         * heterogeneous in sequence.\n         */\n        hetero: Aliased(lstr),\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        mon_id: str,\n        /**\n         * The value of _entity_poly_seq.num must uniquely and sequentially\n         * identify a record in the ENTITY_POLY_SEQ list.\n         *\n         * Note that this item must be a number and that the sequence\n         * numbers must progress in increasing numerical order.\n         */\n        num: int,\n    },\n    /**\n     * There is only one item in the ENTRY category, _entry.id. This\n     * data item gives a name to this entry and is indirectly a key to\n     * the categories (such as CELL, GEOM, EXPTL) that describe\n     * information pertinent to the entire data block.\n     */\n    entry: {\n        /**\n         * The value of _entry.id identifies the data block.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n    },\n    /**\n     * Data items in the EXPTL category record details about the\n     * experimental work prior to the intensity measurements and\n     * details about the absorption-correction technique employed.\n     */\n    exptl: {\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * The method used in the experiment.\n         */\n        method: Aliased(str),\n    },\n    /**\n     * Data items in the SOFTWARE category record details about\n     * the software used in the structure analysis, which implies\n     * any software used in the generation of any data items\n     * associated with the structure determination and\n     * structure representation.\n     *\n     * These data items allow computer programs to be referenced\n     * in more detail than data items in the COMPUTING category do.\n     */\n    software: {\n        /**\n         * The classification of the program according to its\n         * major function.\n         */\n        classification: str,\n        /**\n         * The date the software was released.\n         */\n        date: str,\n        /**\n         * Description of the software.\n         */\n        description: str,\n        /**\n         * The name of the software.\n         */\n        name: str,\n        /**\n         * The classification of the software according to the most\n         * common types.\n         */\n        type: Aliased(lstr),\n        /**\n         * The version of the software.\n         */\n        version: str,\n        /**\n         * An ordinal index for this category\n         */\n        pdbx_ordinal: int,\n    },\n    /**\n     * Data items in the STRUCT category record details about the\n     * description of the crystallographic structure.\n     */\n    struct: {\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * A title for the data block. The author should attempt to convey\n         * the essence of the structure archived in the CIF in the title,\n         * and to distinguish this structural result from others.\n         */\n        title: str,\n        /**\n         * An automatically generated descriptor for an NDB structure or\n         * the unstructured content of the PDB COMPND record.\n         */\n        pdbx_descriptor: str,\n    },\n    /**\n     * Data items in the STRUCT_ASYM category record details about the\n     * structural elements in the asymmetric unit.\n     */\n    struct_asym: {\n        /**\n         * A description of special aspects of this portion of the contents\n         * of the asymmetric unit.\n         */\n        details: str,\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The value of _struct_asym.id must uniquely identify a record in\n         * the STRUCT_ASYM list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * This data item indicates whether the structural elements are modified.\n         */\n        pdbx_modified: str,\n        /**\n         * A flag indicating that this entity was originally labeled\n         * with a blank PDB chain id.\n         */\n        pdbx_blank_PDB_chainid_flag: Aliased(str),\n    },\n    /**\n     * Data items in the STRUCT_CONF category record details about\n     * the backbone conformation of a segment of polymer.\n     *\n     * Data items in the STRUCT_CONF_TYPE category define the\n     * criteria used to identify the backbone conformations.\n     */\n    struct_conf: {\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        beg_label_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in\n         * the ATOM_SITE category.\n         */\n        beg_label_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        beg_label_seq_id: int,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        beg_auth_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in\n         * the ATOM_SITE category.\n         */\n        beg_auth_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment begins.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        beg_auth_seq_id: int,\n        /**\n         * This data item is a pointer to _struct_conf_type.id in the\n         * STRUCT_CONF_TYPE category.\n         */\n        conf_type_id: Aliased(lstr),\n        /**\n         * A description of special aspects of the conformation assignment.\n         */\n        details: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        end_label_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        end_label_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        end_label_seq_id: int,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_seq_id: int,\n        /**\n         * The value of _struct_conf.id must uniquely identify a record in\n         * the STRUCT_CONF list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment starts.\n         */\n        pdbx_beg_PDB_ins_code: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * conformation segment ends.\n         */\n        pdbx_end_PDB_ins_code: str,\n        /**\n         * This item is a place holder for the helix class used in the PDB\n         * HELIX record.\n         */\n        pdbx_PDB_helix_class: str,\n        /**\n         * A placeholder for the lengths of the helix of the PDB\n         * HELIX record.\n         */\n        pdbx_PDB_helix_length: int,\n        /**\n         * A placeholder for the helix identifier of the PDB\n         * HELIX record.\n         */\n        pdbx_PDB_helix_id: str,\n    },\n    /**\n     * Data items in the STRUCT_CONN category record details about\n     * the connections between portions of the structure. These can be\n     * hydrogen bonds, salt bridges, disulfide bridges and so on.\n     *\n     * The STRUCT_CONN_TYPE records define the criteria used to\n     * identify these connections.\n     */\n    struct_conn: {\n        /**\n         * This data item is a pointer to _struct_conn_type.id in the\n         * STRUCT_CONN_TYPE category.\n         */\n        conn_type_id: Aliased(lstr),\n        /**\n         * A description of special aspects of the connection.\n         */\n        details: str,\n        /**\n         * The value of _struct_conn.id must uniquely identify a record in\n         * the STRUCT_CONN list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_label_asym_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        ptnr1_label_atom_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_label_comp_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_label_seq_id: int,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_auth_asym_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_auth_comp_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        ptnr1_auth_seq_id: int,\n        /**\n         * Describes the symmetry operation that should be applied to the\n         * atom set specified by _struct_conn.ptnr1_label* to generate the\n         * first partner in the structure connection.\n         */\n        ptnr1_symmetry: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_label_asym_id: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        ptnr2_label_atom_id: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_label_comp_id: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_label_seq_id: int,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_auth_asym_id: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_auth_comp_id: str,\n        /**\n         * A component of the identifier for partner 2 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        ptnr2_auth_seq_id: int,\n        /**\n         * Describes the symmetry operation that should be applied to the\n         * atom set specified by _struct_conn.ptnr2_label* to generate the\n         * second partner in the structure connection.\n         */\n        ptnr2_symmetry: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.pdbx_PDB_ins_code in the\n         * ATOM_SITE category.\n         */\n        pdbx_ptnr1_PDB_ins_code: str,\n        /**\n         * A component of the identifier for partner 1 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_alt_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr1_label_alt_id: str,\n        /**\n         * A placeholder for the standard residue name found in\n         * the MODRES record of a PDB file.\n         */\n        pdbx_ptnr1_standard_comp_id: str,\n        /**\n         * A component of the identifier for partner 1 of the structure\n         * connection.\n         *\n         * This data item is a pointer to _atom_site.pdbx_PDB_ins_code in the\n         * ATOM_SITE category.\n         */\n        pdbx_ptnr2_PDB_ins_code: str,\n        /**\n         * A component of the identifier for partner 2 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_alt_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr2_label_alt_id: str,\n        /**\n         * A component of the identifier for partner 3 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.pdbx_PDB_ins_code in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_PDB_ins_code: str,\n        /**\n         * A component of the identifier for partner 3 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_alt_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_label_alt_id: str,\n        /**\n         * A component of the identifier for partner 3 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_asym_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_label_asym_id: str,\n        /**\n         * A component of the identifier for partner 3 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_atom_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_label_atom_id: str,\n        /**\n         * A component of the identifier for partner 3 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_comp_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_label_comp_id: str,\n        /**\n         * A component of the identifier for partner 1 of the\n         * structure connection. This data item is a pointer to\n         * _atom_site.label_seq_id in the ATOM_SITE category.\n         */\n        pdbx_ptnr3_label_seq_id: int,\n        /**\n         * A placeholder for the PDB id in the case the category\n         * is used to hold the information of the MODRES record of\n         * a PDB file.\n         */\n        pdbx_PDB_id: str,\n        /**\n         * Distance value for this contact.\n         */\n        pdbx_dist_value: float,\n        /**\n         * The chemical bond order associated with the specified atoms in\n         * this contact.\n         */\n        pdbx_value_order: Aliased(lstr),\n    },\n    /**\n     * Data items in the STRUCT_CONN_TYPE category record details\n     * about the criteria used to identify interactions between\n     * portions of the structure.\n     */\n    struct_conn_type: {\n        /**\n         * The criteria used to define the interaction.\n         */\n        criteria: str,\n        /**\n         * The chemical or structural type of the interaction.\n         */\n        id: Aliased(lstr),\n        /**\n         * A reference that specifies the criteria used to define the\n         * interaction.\n         */\n        reference: str,\n    },\n    /**\n     * Data items in the STRUCT_KEYWORDS category specify keywords\n     * that describe the chemical structure in this entry.\n     */\n    struct_keywords: {\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * Keywords describing this structure.\n         */\n        text: List(',', x => x),\n        /**\n         * Terms characterizing the macromolecular structure.\n         */\n        pdbx_keywords: str,\n    },\n    /**\n     * Data items in the STRUCT_NCS_OPER category describe the\n     * noncrystallographic symmetry operations.\n     *\n     * Each operator is specified as a matrix and a subsequent\n     * translation vector. Operators need not represent proper\n     * rotations.\n     */\n    struct_ncs_oper: {\n        /**\n         * A code to indicate whether this operator describes a\n         * relationship between coordinates all of which are given in the\n         * data block (in which case the value of code is 'given'), or\n         * whether the operator is used to generate new coordinates from\n         * those that are given in the data block (in which case the value\n         * of code is 'generate').\n         */\n        code: Aliased(str),\n        /**\n         * A description of special aspects of the noncrystallographic\n         * symmetry operator.\n         */\n        details: str,\n        /**\n         * The value of _struct_ncs_oper.id must uniquely identify a\n         * record in the STRUCT_NCS_OPER list.\n         *\n         * Note that for PDB _struct_ncs_oper.id must be a number.\n         */\n        id: int,\n        /**\n         * The elements of the 3x3 matrix component of a\n         * noncrystallographic symmetry operation.\n         */\n        matrix: Matrix(3, 3),\n        /**\n         * The elements of the three-element vector component of a\n         * noncrystallographic symmetry operation.\n         */\n        vector: Vector(3),\n    },\n    /**\n     * Data items in the STRUCT_SHEET_RANGE category record details\n     * about the residue ranges that form a beta-sheet. Residues are\n     * included in a range if they made beta-sheet-type hydrogen-bonding\n     * interactions with at least one adjacent strand and if there are\n     * at least two residues in the range.\n     */\n    struct_sheet_range: {\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        beg_label_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        beg_label_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        beg_label_seq_id: int,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        end_label_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        end_label_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        end_label_seq_id: int,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        beg_auth_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in\n         * the ATOM_SITE category.\n         */\n        beg_auth_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range begins.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        beg_auth_seq_id: int,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_asym_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_comp_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta-sheet range ends.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        end_auth_seq_id: int,\n        /**\n         * The value of _struct_sheet_range.id must uniquely identify a\n         * range in a given sheet in the STRUCT_SHEET_RANGE list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * This data item is a pointer to _struct_sheet.id in the\n         * STRUCT_SHEET category.\n         */\n        sheet_id: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta sheet range begins.  Insertion code.\n         */\n        pdbx_beg_PDB_ins_code: str,\n        /**\n         * A component of the identifier for the residue at which the\n         * beta sheet range ends. Insertion code.\n         */\n        pdbx_end_PDB_ins_code: str,\n    },\n    /**\n     * Data items in the STRUCT_SITE category record details about\n     * portions of the structure that contribute to structurally\n     * relevant sites (e.g. active sites, substrate-binding subsites,\n     * metal-coordination sites).\n     */\n    struct_site: {\n        /**\n         * A description of special aspects of the site.\n         */\n        details: str,\n        /**\n         * The value of _struct_site.id must uniquely identify a record in\n         * the STRUCT_SITE list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * Number of residues in the site.\n         */\n        pdbx_num_residues: int,\n        /**\n         * Source of evidence supporting the assignment of this site.\n         */\n        pdbx_evidence_code: str,\n        /**\n         * A component of the identifier for the ligand in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        pdbx_auth_asym_id: str,\n        /**\n         * A component of the identifier for the ligand in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        pdbx_auth_comp_id: str,\n        /**\n         * A component of the identifier for the ligand in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        pdbx_auth_seq_id: str,\n        /**\n         * PDB insertion code for the ligand in the site.\n         */\n        pdbx_auth_ins_code: str,\n    },\n    /**\n     * Data items in the STRUCT_SITE_GEN category record details about\n     * the generation of portions of the structure that contribute to\n     * structurally relevant sites.\n     */\n    struct_site_gen: {\n        /**\n         * A description of special aspects of the symmetry generation of\n         * this portion of the structural site.\n         */\n        details: str,\n        /**\n         * The value of _struct_site_gen.id must uniquely identify a record\n         * in the STRUCT_SITE_GEN list.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_sites_alt.id in the\n         * ATOM_SITES_ALT category.\n         */\n        label_alt_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        label_asym_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        label_atom_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        label_comp_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        label_seq_id: int,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        auth_asym_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        auth_comp_id: str,\n        /**\n         * A component of the identifier for participants in the site.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        auth_seq_id: str,\n        /**\n         * This data item is a pointer to _struct_site.id in the STRUCT_SITE\n         * category.\n         */\n        site_id: str,\n        /**\n         * Describes the symmetry operation that should be applied to the\n         * atom set specified by _struct_site_gen.label* to generate a\n         * portion of the site.\n         */\n        symmetry: str,\n        /**\n         * PDB insertion code.\n         */\n        pdbx_auth_ins_code: str,\n        /**\n         * Number of residues in the site.\n         */\n        pdbx_num_res: int,\n    },\n    /**\n     * Data items in the SYMMETRY category record details about the\n     * space-group symmetry.\n     */\n    symmetry: {\n        /**\n         * This data item is a pointer to _entry.id in the ENTRY category.\n         */\n        entry_id: str,\n        /**\n         * The cell settings for this space-group symmetry.\n         */\n        cell_setting: Aliased(lstr),\n        /**\n         * Space-group number from International Tables for Crystallography\n         * Vol. A (2002).\n         */\n        Int_Tables_number: int,\n        /**\n         * Space-group symbol as described by Hall (1981). This symbol\n         * gives the space-group setting explicitly. Leave spaces between\n         * the separate components of the symbol.\n         *\n         * Ref: Hall, S. R. (1981). Acta Cryst. A37, 517-525; erratum\n         * (1981) A37, 921.\n         */\n        space_group_name_Hall: str,\n        /**\n         * Hermann-Mauguin space-group symbol. Note that the\n         * Hermann-Mauguin symbol does not necessarily contain complete\n         * information about the symmetry and the space-group origin. If\n         * used, always supply the FULL symbol from International Tables\n         * for Crystallography Vol. A (2002) and indicate the origin and\n         * the setting if it is not implicit. If there is any doubt that\n         * the equivalent positions can be uniquely deduced from this\n         * symbol, specify the  _symmetry_equiv.pos_as_xyz or\n         * _symmetry.space_group_name_Hall  data items as well. Leave\n         * spaces between symbols referring to\n         * different axes.\n         */\n        'space_group_name_H-M': str,\n    },\n    /**\n     * These are internal RCSB records to keep track of data processing\n     * and status of the entry.\n     */\n    pdbx_database_status: {\n        /**\n         * Code for status of file.\n         */\n        status_code: Aliased(str),\n        /**\n         * Code for status of structure factor file.\n         */\n        status_code_sf: Aliased(str),\n        /**\n         * Code for status of NMR constraints file.\n         */\n        status_code_mr: Aliased(str),\n        /**\n         * The value of _pdbx_database_status.entry_id identifies the data block.\n         */\n        entry_id: str,\n        /**\n         * The date of initial deposition.  (The first message for\n         * deposition has been received.)\n         */\n        recvd_initial_deposition_date: str,\n        /**\n         * This code indicates whether the entry belongs to\n         * Structural Genomics Project.\n         */\n        SG_entry: Aliased(lstr),\n        /**\n         * The site where the file was deposited.\n         */\n        deposit_site: Aliased(str),\n        /**\n         * The site where the file was deposited.\n         */\n        process_site: Aliased(str),\n        /**\n         * Code for status of chemical shift data file.\n         */\n        status_code_cs: Aliased(str),\n        /**\n         * The methods development category in which this\n         * entry has been placed.\n         */\n        methods_development_category: Aliased(str),\n        /**\n         * A flag indicating that the entry is compatible with the PDB format.\n         *\n         * A value of 'N' indicates that the no PDB format data file is\n         * corresponding to this entry is available in the PDB archive.\n         */\n        pdb_format_compatible: Aliased(lstr),\n    },\n    /**\n     * The PDBX_NONPOLY_SCHEME category provides residue level nomenclature\n     * mapping for non-polymer entities.\n     */\n    pdbx_nonpoly_scheme: {\n        /**\n         * Pointer to _atom_site.label_asym_id.\n         */\n        asym_id: str,\n        /**\n         * Pointer to _atom_site.label_entity_id.\n         */\n        entity_id: str,\n        /**\n         * Pointer to _atom_site.label_comp_id.\n         */\n        mon_id: str,\n        /**\n         * PDB strand/chain id.\n         */\n        pdb_strand_id: str,\n        /**\n         * NDB/RCSB residue number.\n         */\n        ndb_seq_num: str,\n        /**\n         * PDB residue number.\n         */\n        pdb_seq_num: str,\n        /**\n         * Author provided residue numbering.   This value may differ from the PDB residue\n         * number and may not correspond to residue numbering within the coordinate records.\n         */\n        auth_seq_num: str,\n        /**\n         * PDB residue identifier.\n         */\n        pdb_mon_id: str,\n        /**\n         * Author provided residue identifier.   This value may differ from the PDB residue\n         * identifier and may not correspond to residue identification within the coordinate records.\n         */\n        auth_mon_id: str,\n        /**\n         * PDB insertion code.\n         */\n        pdb_ins_code: str,\n    },\n    /**\n     * Data items in PDBX_DATABASE_RELATED contain references to entries\n     * that are related to the this entry.\n     */\n    pdbx_database_related: {\n        /**\n         * The name of the database containing the related entry.\n         */\n        db_name: str,\n        /**\n         * A description of the related entry.\n         */\n        details: str,\n        /**\n         * The identifying code in the related database.\n         */\n        db_id: str,\n        /**\n         * The identifying content type of the related entry.\n         */\n        content_type: Aliased(str),\n    },\n    /**\n     * The PDBX_ENTITY_NONPOLY category provides a mapping between\n     * entity and the nonpolymer component\n     */\n    pdbx_entity_nonpoly: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP category.\n         */\n        comp_id: str,\n        /**\n         * A name for the non-polymer entity\n         */\n        name: str,\n    },\n    /**\n     * PDBX_CHEM_COMP_SYNONYMS holds chemical name and synonym correspondences.\n     */\n    pdbx_chem_comp_synonyms: {\n        /**\n         * The synonym of this particular chemical component.\n         */\n        name: str,\n        /**\n         * The chemical component for which this synonym applies.\n         */\n        comp_id: str,\n        /**\n         * The provenance of this synonym.\n         */\n        provenance: Aliased(str),\n    },\n    /**\n     * Data items in the CHEM_COMP_IDENTIFIER category provide\n     * identifiers for chemical components.\n     */\n    pdbx_chem_comp_identifier: {\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * This data item contains the identifier value for this\n         * component.\n         */\n        identifier: str,\n        /**\n         * This data item contains the identifier type.\n         */\n        type: Aliased(str),\n        /**\n         * This data item contains the name of the program\n         * or library used to compute the identifier.\n         */\n        program: str,\n        /**\n         * This data item contains the version of the program\n         * or library used to compute the identifier.\n         */\n        program_version: str,\n    },\n    /**\n     * Data items in the PDBX_UNOBS_OR_ZERO_OCC_RESIDUES category list the\n     * residues within the entry that are not observed or have zero occupancy.\n     */\n    pdbx_unobs_or_zero_occ_residues: {\n        /**\n         * The value of _pdbx_unobs_or_zero_occ_residues.id must uniquely identify\n         * each item in the PDBX_UNOBS_OR_ZERO_OCC_RESIDUES list.\n         *\n         * This is an integer serial number.\n         */\n        id: int,\n        /**\n         * The value of polymer flag indicates whether the unobserved or\n         * zero occupancy residue is part of a polymer chain or not\n         */\n        polymer_flag: Aliased(lstr),\n        /**\n         * The value of occupancy flag indicates whether the residue\n         * is unobserved (= 1) or the coordinates have an occupancy of zero (=0)\n         */\n        occupancy_flag: Aliased(int),\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.pdbx_PDB_model_num in the\n         * ATOM_SITE category.\n         */\n        PDB_model_num: int,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        auth_asym_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        auth_comp_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        auth_seq_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.pdbx_PDB_ins_code in the\n         * ATOM_SITE category.\n         */\n        PDB_ins_code: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        label_asym_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        label_comp_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        label_seq_id: int,\n    },\n    /**\n     * Data items in the PDBX_STRUCT_MOD_RESIDUE category list the\n     * modified polymer components in the entry and provide some\n     * details describing the nature of the modification.\n     */\n    pdbx_struct_mod_residue: {\n        /**\n         * The value of _pdbx_struct_mod_residue.id must uniquely identify\n         * each item in the PDBX_STRUCT_MOD_RESIDUE list.\n         *\n         * This is an integer serial number.\n         */\n        id: int,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        auth_asym_id: str,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        auth_comp_id: str,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        auth_seq_id: int,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.pdbx_PDB_ins_code in the\n         * ATOM_SITE category.\n         */\n        PDB_ins_code: str,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.label_asym_id in the\n         * ATOM_SITE category.\n         */\n        label_asym_id: str,\n        /**\n         * Part of the identifier for the modified polymer component.\n         *\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * ATOM_SITE category.\n         */\n        label_comp_id: str,\n        /**\n         * Part of the identifier for the unobserved or zero occupancy residue.\n         *\n         * This data item is a pointer to _atom_site.label_seq_id in the\n         * ATOM_SITE category.\n         */\n        label_seq_id: int,\n        /**\n         * The parent component identifier for this modified polymer component.\n         */\n        parent_comp_id: str,\n        /**\n         * Details of the modification for this polymer component.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the PDBX_STRUCT_OPER_LIST category describe\n     * Cartesian rotation and translation operations required to\n     * generate or transform the coordinates deposited with this entry.\n     */\n    pdbx_struct_oper_list: {\n        /**\n         * This identifier code must uniquely identify a\n         * record in the PDBX_STRUCT_OPER_LIST list.\n         */\n        id: str,\n        /**\n         * A code to indicate the type of operator.\n         */\n        type: Aliased(str),\n        /**\n         * A descriptive name for the transformation operation.\n         */\n        name: str,\n        /**\n         * The symmetry operation corresponding to the transformation operation.\n         */\n        symmetry_operation: str,\n        /**\n         * The elements of the 3x3 matrix component of the\n         * transformation operation.\n         */\n        matrix: Matrix(3, 3),\n        /**\n         * The elements of the three-element vector component of the\n         * transformation operation.\n         */\n        vector: Vector(3),\n    },\n    /**\n     * Data items in the PDBX_STRUCT_ASSEMBLY category record details about\n     * the structural elements that form macromolecular assemblies.\n     */\n    pdbx_struct_assembly: {\n        /**\n         * Provides details of the method used to determine or\n         * compute the assembly.\n         */\n        method_details: str,\n        /**\n         * Provides the details of the oligomeric state of the assembly.\n         */\n        oligomeric_details: str,\n        /**\n         * The number of polymer molecules in the assembly.\n         */\n        oligomeric_count: int,\n        /**\n         * A description of special aspects of the macromolecular assembly.\n         *\n         * In the PDB, 'representative helical assembly', 'complete point assembly',\n         * 'complete icosahedral assembly', 'software_defined_assembly', 'author_defined_assembly',\n         * and 'author_and_software_defined_assembly' are considered \"biologically relevant assemblies.\n         */\n        details: str,\n        /**\n         * The value of _pdbx_struct_assembly.id must uniquely identify a record in\n         * the PDBX_STRUCT_ASSEMBLY list.\n         */\n        id: str,\n    },\n    /**\n     * Data items in the PDBX_STRUCT_ASSEMBLY_GEN category record details about\n     * the generation of each macromolecular assemblies. The PDBX_STRUCT_ASSEMBLY_GEN\n     * data items provide the specifications of the components that\n     * constitute that assembly in terms of cartesian transformations.\n     */\n    pdbx_struct_assembly_gen: {\n        /**\n         * This data item is a pointer to _struct_asym.id in\n         * the STRUCT_ASYM category.\n         *\n         * This item may be expressed as a comma separated list of identifiers.\n         */\n        asym_id_list: List(',', x => x),\n        /**\n         * This data item is a pointer to _pdbx_struct_assembly.id in the\n         * PDBX_STRUCT_ASSEMBLY category.\n         */\n        assembly_id: str,\n        /**\n         * Identifies the operation of collection of operations\n         * from category PDBX_STRUCT_OPER_LIST.\n         *\n         * Operation expressions may have the forms:\n         *\n         * (1)        the single operation 1\n         * (1,2,5)    the operations 1, 2, 5\n         * (1-4)      the operations 1,2,3 and 4\n         * (1,2)(3,4) the combinations of operations\n         * 3 and 4 followed by 1 and 2 (i.e.\n         * the cartesian product of parenthetical\n         * groups applied from right to left)\n         */\n        oper_expression: str,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_LIST category record\n     * the list of entities within each reference molecule.\n     */\n    pdbx_reference_entity_list: {\n        /**\n         * The value of _pdbx_reference_entity_list.prd_id is a reference\n         * _pdbx_reference_molecule.prd_id in the PDBX_REFERENCE_MOLECULE category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_list.ref_entity_id is a unique identifier\n         * the a constituent entity within this reference molecule.\n         */\n        ref_entity_id: str,\n        /**\n         * Defines the polymer characteristic of the entity.\n         */\n        type: Aliased(lstr),\n        /**\n         * Additional details about this entity.\n         */\n        details: str,\n        /**\n         * The component number of this entity within the molecule.\n         */\n        component_id: int,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_LINK category give details about\n     * the linkages between entities within reference molecules.\n     */\n    pdbx_reference_entity_link: {\n        /**\n         * The value of _pdbx_reference_entity_link.link_id uniquely identifies\n         * linkages between entities with a molecule.\n         */\n        link_id: int,\n        /**\n         * The value of _pdbx_reference_entity_link.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * A description of special aspects of a linkage between\n         * chemical components in the structure.\n         */\n        details: str,\n        /**\n         * The reference entity id of the first of the two entities joined by the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_list.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id_1: str,\n        /**\n         * The reference entity id of the second of the two entities joined by the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_list.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id_2: str,\n        /**\n         * For a polymer entity, the sequence number in the first of\n         * the two entities containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_1: int,\n        /**\n         * For a polymer entity, the sequence number in the second of\n         * the two entities containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_2: int,\n        /**\n         * The component identifier in the first of the two entities containing the linkage.\n         *\n         * For polymer entities, this data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         *\n         * For non-polymer entities, this data item is a pointer to\n         * _pdbx_reference_entity_nonpoly.chem_comp_id in the\n         * PDBX_REFERENCE_ENTITY_NONPOLY category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier in the second of the two entities containing the linkage.\n         *\n         * For polymer entities, this data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         *\n         * For non-polymer entities, this data item is a pointer to\n         * _pdbx_reference_entity_nonpoly.chem_comp_id in the\n         * PDBX_REFERENCE_ENTITY_NONPOLY category.\n         */\n        comp_id_2: str,\n        /**\n         * The atom identifier/name in the first of the two entities containing the linkage.\n         */\n        atom_id_1: str,\n        /**\n         * The atom identifier/name in the second of the two entities containing the linkage.\n         */\n        atom_id_2: str,\n        /**\n         * The bond order target for the chemical linkage.\n         */\n        value_order: Aliased(lstr),\n        /**\n         * The entity component identifier for the first of two entities containing the linkage.\n         */\n        component_1: int,\n        /**\n         * The entity component identifier for the second of two entities containing the linkage.\n         */\n        component_2: int,\n        /**\n         * A code indicating the entity types involved in the linkage.\n         */\n        link_class: Aliased(str),\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_POLY_LINK category give details about\n     * polymer linkages including both standard and non-standard linkages between\n     * polymer componnents.\n     */\n    pdbx_reference_entity_poly_link: {\n        /**\n         * The value of _pdbx_reference_entity_poly_link.link_id uniquely identifies\n         * a linkage within a polymer entity.\n         */\n        link_id: int,\n        /**\n         * The value of _pdbx_reference_entity_poly_link.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        prd_id: str,\n        /**\n         * The reference entity id of the polymer entity containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        ref_entity_id: str,\n        /**\n         * The entity component identifier entity containing the linkage.\n         */\n        component_id: int,\n        /**\n         * For a polymer entity, the sequence number in the first of\n         * the two components making the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_1: int,\n        /**\n         * For a polymer entity, the sequence number in the second of\n         * the two components making the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_2: int,\n        /**\n         * The component identifier in the first of the two components making the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier in the second of the two components making the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        comp_id_2: str,\n        /**\n         * The atom identifier/name in the first of the two components making\n         * the linkage.\n         */\n        atom_id_1: str,\n        /**\n         * The atom identifier/name in the second of the two components making\n         * the linkage.\n         */\n        atom_id_2: str,\n        /**\n         * The bond order target for the non-standard linkage.\n         */\n        value_order: Aliased(lstr),\n    },\n    /**\n     * Data items in the PDBX_MOLECULE category identify reference molecules\n     * within a PDB entry.\n     */\n    pdbx_molecule: {\n        /**\n         * The value of _pdbx_molecule.prd_id is the PDB accession code for this\n         * reference molecule.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_molecule.instance_id is identifies a particular molecule\n         * in the molecule list.\n         */\n        instance_id: int,\n        /**\n         * A reference to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n    },\n    /**\n     * Data items in the PDBX_MOLECULE_FEATURES category record features of molecules\n     * within a PDB entry.\n     */\n    pdbx_molecule_features: {\n        /**\n         * The value of _pdbx_molecule_features.prd_id is the accession code for this\n         * reference molecule.\n         */\n        prd_id: str,\n        /**\n         * Broadly defines the function of the molecule.\n         */\n        class: Aliased(lstr),\n        /**\n         * Defines the structural classification of the molecule.\n         */\n        type: Aliased(lstr),\n        /**\n         * A name of the molecule.\n         */\n        name: str,\n        /**\n         * Additional details describing the molecule.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the ENTITY_SRC_NAT category record details of\n     * the source from which the entity was obtained in cases\n     * where the entity was isolated directly from a natural tissue.\n     */\n    entity_src_nat: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * Scientific name of the organism of the natural source.\n         */\n        pdbx_organism_scientific: str,\n        /**\n         * The plasmid containing the gene.\n         */\n        pdbx_plasmid_name: str,\n        /**\n         * This data item is an ordinal identifier for entity_src_nat data records.\n         */\n        pdbx_src_id: int,\n        /**\n         * The beginning polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_beg_seq_num: int,\n        /**\n         * The ending polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_end_seq_num: int,\n    },\n    /**\n     * Data items in the ENTITY_SRC_GEN category record details of\n     * the source from which the entity was obtained in cases\n     * where the source was genetically manipulated.  The\n     * following are treated separately:  items pertaining to the tissue\n     * from which the gene was obtained, items pertaining to the host\n     * organism for gene expression and items pertaining to the actual\n     * producing organism (plasmid).\n     */\n    entity_src_gen: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * Identifies the gene.\n         */\n        pdbx_gene_src_gene: List(',', x => x),\n        /**\n         * Scientific name of the organism.\n         */\n        pdbx_gene_src_scientific_name: str,\n        /**\n         * The name of the plasmid that produced the entity in the host\n         * organism. Where full details of the protein production are available\n         * it would be expected that this item would be derived from\n         * _pdbx_construct.name of the construct pointed to from\n         * _entity_src_gen_express.plasmid_id.\n         */\n        plasmid_name: str,\n        /**\n         * This data item is an ordinal identifier for entity_src_gen data records.\n         */\n        pdbx_src_id: int,\n        /**\n         * The beginning polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_beg_seq_num: int,\n        /**\n         * The ending polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_end_seq_num: int,\n    },\n    /**\n     * The data items in category PDBX_ENTITY_SRC_SYN record the source details\n     * about chemically synthesized molecules.\n     */\n    pdbx_entity_src_syn: {\n        /**\n         * The scientific name of the organism from which the sequence of\n         * the synthetic entity was derived.\n         */\n        organism_scientific: str,\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * This data item is an ordinal identifier for pdbx_entity_src_syn data records.\n         */\n        pdbx_src_id: int,\n        /**\n         * The beginning polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_beg_seq_num: int,\n        /**\n         * The ending polymer sequence position for the polymer section corresponding\n         * to this source.\n         *\n         * A reference to the sequence position in the entity_poly category.\n         */\n        pdbx_end_seq_num: int,\n    },\n    /**\n     * Data items in the PDBX_ENTITY_BRANCH_DESCRIPTOR category provide\n     * string descriptors of entity chemical structure.\n     */\n    pdbx_entity_branch_descriptor: {\n        /**\n         * This data item is a pointer to _entity_poly.entity_id in the ENTITY\n         * category.\n         */\n        entity_id: str,\n        /**\n         * This data item contains the descriptor value for this\n         * entity.\n         */\n        descriptor: str,\n        /**\n         * This data item contains the descriptor type.\n         */\n        type: Aliased(lstr),\n        /**\n         * This data item contains the name of the program\n         * or library used to compute the descriptor.\n         */\n        program: str,\n        /**\n         * This data item contains the version of the program\n         * or library used to compute the descriptor.\n         */\n        program_version: str,\n        /**\n         * Ordinal index for this category.\n         */\n        ordinal: int,\n    },\n    /**\n     * Data items in the pdbx_entity_instance_feature category records\n     * special features of selected entity instances.\n     */\n    pdbx_entity_instance_feature: {\n        /**\n         * Special structural details about this entity instance.\n         */\n        details: str,\n        /**\n         * A feature type associated with entity instance.\n         */\n        feature_type: Aliased(str),\n        /**\n         * Author instance identifier (formerly PDB Chain ID)\n         */\n        auth_asym_id: str,\n        /**\n         * Instance identifier for this entity.\n         */\n        asym_id: str,\n        /**\n         * Author provided residue number.\n         */\n        auth_seq_num: str,\n        /**\n         * Position in the sequence.\n         */\n        seq_num: int,\n        /**\n         * Chemical component identifier\n         */\n        comp_id: str,\n        /**\n         * The author provided chemical component identifier\n         */\n        auth_comp_id: str,\n        /**\n         * An ordinal index for this category\n         */\n        ordinal: int,\n    },\n    /**\n     * Data items in the PDBX_ENTITY_BRANCH_LIST category specify the list\n     * of monomers in a branched entity.  Allowance is made for the possibility\n     * of microheterogeneity in a sample by allowing a given sequence\n     * number to be correlated with more than one monomer ID. The\n     * corresponding ATOM_SITE entries should reflect this\n     * heterogeneity.\n     */\n    pdbx_entity_branch_list: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A flag to indicate whether this monomer in the entity is\n         * heterogeneous in sequence.\n         */\n        hetero: Aliased(lstr),\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * The value pair  _pdbx_entity_branch_list.num and _pdbx_entity_branch_list.comp_id\n         * must uniquely identify a record in the PDBX_ENTITY_BRANCH_LIST list.\n         */\n        num: int,\n    },\n    /**\n     * Data items in the PDBX_ENTITY_BRANCH_LINK category give details about\n     * the linkages between components within a branched entity.\n     */\n    pdbx_entity_branch_link: {\n        /**\n         * The value of _pdbx_entity_branch_link.link_id uniquely identifies\n         * linkages within the branched entity.\n         */\n        link_id: int,\n        /**\n         * A description of special aspects of this linkage.\n         */\n        details: str,\n        /**\n         * The entity id for this branched entity.\n         *\n         * This data item is a pointer to _pdbx_entity_branch_list.entity_id\n         * in the PDBX_ENTITY_BRANCH_LIST category.\n         */\n        entity_id: str,\n        /**\n         * The component number for the first component making the linkage.\n         *\n         * This data item is a pointer to _pdbx_entity_branch_list.num\n         * in the PDBX_ENTITY_BRANCH_LIST category.\n         */\n        entity_branch_list_num_1: int,\n        /**\n         * The component number for the second component making the linkage.\n         *\n         * This data item is a pointer to _pdbx_entity_branch_list.num\n         * in the PDBX_ENTITY_BRANCH_LIST category.\n         */\n        entity_branch_list_num_2: int,\n        /**\n         * The component identifier for the first component making the linkage.\n         *\n         * This data item is a pointer to _pdbx_entity_branch_list.comp_id\n         * in the PDBX_ENTITY_BRANCH_LIST category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier for the second component making the linkage.\n         *\n         * This data item is a pointer to _pdbx_entity_branch_list.comp_id\n         * in the PDBX_ENTITY_BRANCH_LIST category.\n         */\n        comp_id_2: str,\n        /**\n         * The atom identifier/name for the first atom making the linkage.\n         */\n        atom_id_1: str,\n        /**\n         * The leaving atom identifier/name bonded to the first atom making the linkage.\n         */\n        leaving_atom_id_1: str,\n        /**\n         * The chiral configuration of the first atom making the linkage.\n         */\n        atom_stereo_config_1: Aliased(lstr),\n        /**\n         * The atom identifier/name for the second atom making the linkage.\n         */\n        atom_id_2: str,\n        /**\n         * The leaving atom identifier/name bonded to the second atom making the linkage.\n         */\n        leaving_atom_id_2: str,\n        /**\n         * The chiral configuration of the second atom making the linkage.\n         */\n        atom_stereo_config_2: Aliased(lstr),\n        /**\n         * The bond order target for the chemical linkage.\n         */\n        value_order: Aliased(lstr),\n    },\n    /**\n     * Data items in the PDBX_ENTITY_BRANCH category specify the list\n     * of branched entities and the type.\n     */\n    pdbx_entity_branch: {\n        /**\n         * The entity id for this branched entity.\n         *\n         * This data item is a pointer to _entity.id\n         */\n        entity_id: str,\n        /**\n         * The type of this branched oligosaccharide.\n         */\n        type: Aliased(str),\n    },\n    /**\n     * The PDBX_BRANCH_SCHEME category provides residue level nomenclature\n     * mapping for branch chain entities.\n     */\n    pdbx_branch_scheme: {\n        /**\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A flag to indicate whether this monomer in the entity is\n         * heterogeneous in sequence.\n         */\n        hetero: Aliased(lstr),\n        /**\n         * Pointer to _atom_site.label_asym_id.\n         */\n        asym_id: str,\n        /**\n         * This data item is a pointer to _atom_site.label_comp_id in the\n         * PDBX_ENTITY_BRANCH_LIST category.\n         */\n        mon_id: str,\n        /**\n         * This data item is a pointer to _pdbx_entity_branch_list.num in the\n         * PDBX_ENTITY_BRANCH_LIST category.\n         */\n        num: int,\n        /**\n         * This data item is a pointer to _atom_site.auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        pdb_asym_id: str,\n        /**\n         * This data item is a pointer to _atom_site.auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        pdb_seq_num: str,\n        /**\n         * This data item is a pointer to _atom_site.auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        pdb_mon_id: str,\n        /**\n         * This data item is a pointer to _atom_site.pdbx_auth_asym_id in the\n         * ATOM_SITE category.\n         */\n        auth_asym_id: str,\n        /**\n         * This data item is a pointer to _atom_site.pdbx_auth_seq_id in the\n         * ATOM_SITE category.\n         */\n        auth_seq_num: str,\n        /**\n         * This data item is a pointer to _atom_site.pdbx_auth_comp_id in the\n         * ATOM_SITE category.\n         */\n        auth_mon_id: str,\n    },\n    /**\n     * PDBX_CHEM_COMP_RELATED describes the relationship between two chemical components.\n     */\n    pdbx_chem_comp_related: {\n        /**\n         * The chemical component for which this relationship applies.\n         */\n        comp_id: str,\n        /**\n         * The related chemical component for which this chemical component is based.\n         */\n        related_comp_id: str,\n        /**\n         * Describes the type of relationship\n         */\n        relationship_type: Aliased(str),\n        /**\n         * Describes the type of relationship\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_STARTING_MODEL_DETAILS category records the\n     * details about structural models used as starting inputs in\n     * the integrative model building process.\n     */\n    ihm_starting_model_details: {\n        /**\n         * A unique identifier for the starting structural model.\n         */\n        starting_model_id: str,\n        /**\n         * A unique identifier for the distinct molecular entities.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A text description of the molecular entity\n         */\n        entity_description: str,\n        /**\n         * An asym/strand identifier for the entity molecule.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The identifier for the polymeric segment modeled using this starting model.\n         * This data item is a pointer to _ihm_entity_poly_segment.id in the\n         * IHM_ENTITY_POLY_SEGMENT category.\n         */\n        entity_poly_segment_id: int,\n        /**\n         * The source of the starting model.\n         */\n        starting_model_source: Aliased(str),\n        /**\n         * The author assigned chainId/auth_asym_id corresponding to this starting model.\n         * This corresponds to the chainId/auth_asym_id of the experimental models in the\n         * PDB or comparative models in the Model Archive or the starting models referenced\n         * via a DOI. If starting models are included in IHM_STARTING_MODEL_COORD, then\n         * this will be the same as _ihm_starting_model_details.asym_id.\n         */\n        starting_model_auth_asym_id: str,\n        /**\n         * The offset in residue numbering between the starting model and the deposited I/H model, if applicable.\n         * I/H model residue number = Starting model residue number + offset\n         */\n        starting_model_sequence_offset: int,\n        /**\n         * Identifier to the starting model (comparative, experimental or integrative)\n         * used as input in the integrative modeling.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n    },\n    /**\n     * Data items in the IHM_STARTING_COMPARATIVE_MODELS category records\n     * additional details about comparative models used as starting inputs in\n     * the integrative model building process.\n     */\n    ihm_starting_comparative_models: {\n        /**\n         * A unique identifier for the starting comparative model.\n         */\n        id: int,\n        /**\n         * The identifier for the starting structural model.\n         * This data item is a pointer to _ihm_starting_model_details.starting_model_id\n         * in the IHM_STARTING_MODEL_DETAILS category.\n         */\n        starting_model_id: str,\n        /**\n         * The chainId/auth_asym_id corresponding to the starting model.\n         */\n        starting_model_auth_asym_id: str,\n        /**\n         * The starting residue index of the starting model.\n         */\n        starting_model_seq_id_begin: int,\n        /**\n         * The ending residue index of the starting model.\n         */\n        starting_model_seq_id_end: int,\n        /**\n         * The chainId/auth_asym_id corresponding to the template.\n         */\n        template_auth_asym_id: str,\n        /**\n         * The starting residue index of the template.\n         */\n        template_seq_id_begin: int,\n        /**\n         * The ending residue index of the template.\n         */\n        template_seq_id_end: int,\n        /**\n         * The percentage sequence identity between the template sequence and the comparative model sequence.\n         */\n        template_sequence_identity: float,\n        /**\n         * The denominator used while calculating the sequence identity provided in\n         * _ihm_starting_comparative_models.template_sequence_identity.\n         */\n        template_sequence_identity_denominator: Aliased(int),\n        /**\n         * The dataset list id corresponding to the template used to obtain the comparative model.\n         * This data item is a pointer to _ihm_dataset_list.id in the IHM_DATASET_LIST category.\n         */\n        template_dataset_list_id: int,\n        /**\n         * The file id corresponding to the sequence alignment of the template sequence and the comparative model sequence.\n         * This data item is a pointer to _ihm_external_files.id in the IHM_EXTERNAL_FILES category.\n         */\n        alignment_file_id: int,\n    },\n    /**\n     * Data items in the IHM_STARTING_MODEL_SEQ_DIF category provide a\n     * mechanism for indicating and annotating point differences\n     * between the sequence of the entity or biological unit described\n     * in the data block and the sequence of the starting model used in\n     * the integrative modeling referenced from a database. The point\n     * differences may be due to point mutations introduced in the\n     * starting model or the presence of modified amino acid residues.\n     */\n    ihm_starting_model_seq_dif: {\n        /**\n         * A unique identifier for the entry.\n         */\n        id: int,\n        /**\n         * A unique identifier for the distinct molecular entities.\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY category.\n         */\n        entity_id: str,\n        /**\n         * An asym/strand identifier for the entity molecule.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The residue index.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id: int,\n        /**\n         * The component identifier for the residue.\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id: str,\n        /**\n         * Unique identifier for the starting model record.\n         * This data item is a pointer to _ihm_starting_model_details.starting_model_id in the\n         * IHM_STARTING_MODEL_DETAILS category.\n         */\n        starting_model_id: str,\n        /**\n         * The asym/strand identifier for the entity molecule of the database starting model.\n         */\n        db_asym_id: str,\n        /**\n         * The corresponding residue index of the database starting model.\n         */\n        db_seq_id: int,\n        /**\n         * The correspinding component identifier for the residue in the database starting model.\n         */\n        db_comp_id: str,\n        /**\n         * A description of special aspects of the point differences\n         * between the sequence of the entity or biological unit described\n         * in the data block and that in the starting model referenced\n         * from a database.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_MODEL_REPRESENTATION category lists the\n     * various mono or multi-scale model representations used in the\n     * integrative modeling study.\n     */\n    ihm_model_representation: {\n        /**\n         * A unique identifier for the model representation.\n         */\n        id: int,\n        /**\n         * Name/brief description for the model representation.\n         */\n        name: str,\n        /**\n         * Additional details about the model representation.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_MODEL_REPRESENTATION_DETAILS category records the\n     * details about the architecture and representation of structural\n     * models involved in the integrative modeling study.\n     */\n    ihm_model_representation_details: {\n        /**\n         * A unique identifier for the category.\n         */\n        id: int,\n        /**\n         * An identifier that collects or groups together a set of representations.\n         * This data item is a pointer to _ihm_model_representation.id in the\n         * IHM_MODEL_REPRESENTATION category.\n         */\n        representation_id: int,\n        /**\n         * The identifier for the polymeric segment in the representation.\n         * This data item is a pointer to _ihm_entity_poly_segment.id in the\n         * IHM_ENTITY_POLY_SEGMENT category.\n         */\n        entity_poly_segment_id: int,\n        /**\n         * A unique identifier distinct molecular entities.\n         * This data item is a pointer to _entity.id in the\n         * ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * A text description of the molecular entity\n         */\n        entity_description: str,\n        /**\n         * An asym/strand identifier for the entity molecule.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        entity_asym_id: str,\n        /**\n         * The primitive object used to model this segment.\n         */\n        model_object_primitive: Aliased(str),\n        /**\n         * The identifier for the starting structural model.\n         * This data item is a pointer to _ihm_starting_model_details.starting_model_id\n         * in the IHM_STARTING_MODEL_DETAILS category.\n         */\n        starting_model_id: str,\n        /**\n         * The manner in which the segment is modeled.\n         */\n        model_mode: Aliased(str),\n        /**\n         * The level of detail at which model primitive objects are applied to the structure.\n         */\n        model_granularity: Aliased(str),\n        /**\n         * The number of primitive objects used to model a feature in the case of 'by-feature' granularity.\n         */\n        model_object_count: int,\n    },\n    /**\n     * Data items in the IHM_STRUCT_ASSEMBLY_DETAILS category records\n     * the details of the structural assemblies and used in the\n     * integrative modeling.\n     */\n    ihm_struct_assembly_details: {\n        /**\n         * A unique identifier for the structural assembly description.\n         */\n        id: int,\n        /**\n         * An identifier for the structural assembly.\n         * This data item will remain the same for all components\n         * of an assembly.\n         * This data item is a pointer to _ihm_struct_assembly.id\n         * in the IHM_STRUCT_ASSEMBLY category.\n         */\n        assembly_id: int,\n        /**\n         * The parent of this assembly in a hierarchy.\n         * This data item is a pointer to _ihm_struct_assembly.id in the\n         * IHM_STRUCT_ASSEMBLY category.\n         * This data item should point to the assembly id of the immediate\n         * parent in a hierarchy.\n         * By convention, the full assembly (top of hierarchy) is assigned parent id 0 (zero).\n         * In case of assemblies that do not conform to a hierarchy,\n         * _ihm_struct_assembly_details.parent_assembly_id is the same as\n         * _ihm_struct_assembly_details.assembly_id indicating a self-parent.\n         */\n        parent_assembly_id: int,\n        /**\n         * A text description of the molecular entity\n         */\n        entity_description: str,\n        /**\n         * A unique identifier for distinct molecular entities.\n         * This data item is a pointer to _entity.id in the\n         * ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * An asym/strand identifier for the component in the assembly.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The identifier for the polymeric segment in the assembly.\n         * This data item is a pointer to _ihm_entity_poly_segment.id in the\n         * IHM_ENTITY_POLY_SEGMENT category.\n         */\n        entity_poly_segment_id: int,\n    },\n    /**\n     * Data items in the IHM_STRUCT_ASSEMBLY category lists\n     * all the structural assemblies used in the integrative\n     * modeling study.\n     */\n    ihm_struct_assembly: {\n        /**\n         * A unique identifier for the structural assembly.\n         */\n        id: int,\n        /**\n         * A name for the structural assembly.\n         */\n        name: str,\n        /**\n         * Description of the structural assembly.\n         */\n        description: str,\n    },\n    /**\n     * Data items in the IHM_MODELING_PROTOCOL category lists all\n     * modeling protocols used in the integrative modeling study.\n     */\n    ihm_modeling_protocol: {\n        /**\n         * A unique identifier for the modeling protocol.\n         */\n        id: int,\n        /**\n         * Number of independent steps in the modeling protocol.\n         */\n        num_steps: int,\n        /**\n         * The name for the modeling protocol.\n         */\n        protocol_name: str,\n    },\n    /**\n     * Data items in the IHM_MODELING_PROTOCOL_DETAILS category records the\n     * step-wise details of the integrative modeling workflow.\n     */\n    ihm_modeling_protocol_details: {\n        /**\n         * A unique identifier for the modeling protocol/step combination.\n         */\n        id: int,\n        /**\n         * An index for the modeling protocol carried out.\n         * This data item is a pointer to _ihm_modeling_protocol.id in the\n         * IHM_MODELING_PROTOCOL category.\n         */\n        protocol_id: int,\n        /**\n         * An index for a particular step within the modeling protocol.\n         */\n        step_id: int,\n        /**\n         * An index for the structural assembly being modeled.\n         * This is an indicator to whether the whole assembly is modeled\n         * or if only a subset of the structural assembly is modeled.\n         * This data item is a pointer to _ihm_struct_assembly.id in the\n         * IHM_STRUCT_ASSEMBLY category. The IHM_STRUCT_ASSEMBLY category provides the\n         * details regarding the different structural assemblies used in the modeling.\n         * The default value for this data item is \"1\", indicating that the entire\n         * assembly is being modeled.\n         */\n        struct_assembly_id: int,\n        /**\n         * An index for the dataset group being used in the modeling protocol.\n         * This data item is a pointer to the _ihm_dataset_group.id in the\n         * IHM_DATASET_GROUP category.\n         */\n        dataset_group_id: int,\n        /**\n         * A textual description of the structural assembly being modeled.\n         */\n        struct_assembly_description: str,\n        /**\n         * The name or type of the modeling step.\n         */\n        step_name: str,\n        /**\n         * Description of the method involved in the modeling step.\n         */\n        step_method: str,\n        /**\n         * The number of models in the beginning of the step.\n         */\n        num_models_begin: int,\n        /**\n         * The number of models at the end of the step.\n         */\n        num_models_end: int,\n        /**\n         * A flag to indicate if the modeling is multi scale.\n         */\n        multi_scale_flag: Aliased(lstr),\n        /**\n         * A flag to indicate if the modeling is multi state.\n         */\n        multi_state_flag: Aliased(lstr),\n        /**\n         * A flag to indicate if the modeling involves an ensemble ordered by time or other order.\n         */\n        ordered_flag: Aliased(lstr),\n        /**\n         * The file id corresponding to the script used in the modeling protocol step.\n         * This data item is a pointer to _ihm_external_files.id in the IHM_EXTERNAL_FILES category.\n         */\n        script_file_id: int,\n        /**\n         * Identifier to the software used in the modeling protocol step.\n         * This data item is a pointer to the _software.pdbx_ordinal in the\n         * SOFTWARE category.\n         */\n        software_id: int,\n    },\n    /**\n     * Data items in the IHM_MULTI_STATE_MODELING category records the\n     * details of the multi-state modeling protocol, if applicable.\n     */\n    ihm_multi_state_modeling: {\n        /**\n         * A unique identifier for a particular state in the multi-state modeling.\n         */\n        state_id: int,\n        /**\n         * An identifier for a collections of states in the multi-state modeling.\n         * This data item can be used when structural models belong to diffent\n         * multi-state modeling types.\n         */\n        state_group_id: int,\n        /**\n         * A fraction representing the population of the particular state.\n         */\n        population_fraction: float,\n        /**\n         * The standard deviation of the population fraction.\n         */\n        population_fraction_sd: float,\n        /**\n         * The type that the multiple states being modeled belong to.\n         */\n        state_type: str,\n        /**\n         * A descriptive name for the state.\n         */\n        state_name: str,\n        /**\n         * The type of multi-state modeling experiment carried out.\n         */\n        experiment_type: Aliased(str),\n        /**\n         * Additional textual details of the multi-state modeling, if required.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_MODELING_POST_PROCESS category records\n     * the details of the post processing of the models/results of\n     * the modeling protocol.\n     */\n    ihm_modeling_post_process: {\n        /**\n         * A unique identifier for the post modeling analysis/step combination.\n         */\n        id: int,\n        /**\n         * An identifier for the modeling protocol, whose post modeling analysis\n         * is being carried out.\n         * This data item is a pointer to the _ihm_modeling_protocol.id\n         * in the IHM_MODELING_PROTOCOL category.\n         */\n        protocol_id: int,\n        /**\n         * An identifier for the post modeling analysis. This data item accounts for\n         * multiple post-modeling analyses that can be carried out.\n         */\n        analysis_id: int,\n        /**\n         * In a multi-step process, this identifier denotes the particular\n         * step in the post modeling analysis.\n         */\n        step_id: int,\n        /**\n         * The type of post modeling analysis being carried out.\n         */\n        type: Aliased(str),\n        /**\n         * The parameter/feature used in the post modeling analysis.\n         */\n        feature: Aliased(str),\n        /**\n         * The number of models at the beginning of the post processing step.\n         */\n        num_models_begin: int,\n        /**\n         * The number of models the the end of the post processing step.\n         */\n        num_models_end: int,\n    },\n    /**\n     * Data items in the IHM_ENSEMBLE_INFO category records the\n     * details of the model clusters or ensembles obtained after\n     * sampling.\n     */\n    ihm_ensemble_info: {\n        /**\n         * A unique id for the ensemble.\n         */\n        ensemble_id: int,\n        /**\n         * An optional name for the cluster or ensemble for better description.\n         */\n        ensemble_name: str,\n        /**\n         * An identifier for the post modeling analyses carried out.\n         * This data item is a pointer to _ihm_modeling_post_process.id in\n         * the IHM_MODELING_POST_PROCESS category.\n         */\n        post_process_id: int,\n        /**\n         * An identifier for the cluster or group of models being deposited.\n         * This data item is a pointer to the _ihm_model_group.id\n         * in the IHM_MODEL_GROUP category.\n         */\n        model_group_id: int,\n        /**\n         * The clustering method used to obtain the ensemble, if applicable.\n         */\n        ensemble_clustering_method: Aliased(str),\n        /**\n         * The parameter/feature used for clustering the models, if applicable.\n         */\n        ensemble_clustering_feature: Aliased(str),\n        /**\n         * The number of models in the current ensemble being described.\n         */\n        num_ensemble_models: int,\n        /**\n         * The number of models from the current ensemble that is deposited.\n         */\n        num_ensemble_models_deposited: int,\n        /**\n         * The precision of each cluster or ensemble is calculated as dRMSD, which\n         * is the average C-alpha distance root mean square deviation (dRMSD)\n         * between the individual models in the cluster and the cluster centroid.\n         * The cluster centroid is defined as the model with the minimal sum of\n         * dRMSDs to the other models in the cluster or ensemble.\n         */\n        ensemble_precision_value: float,\n        /**\n         * A reference to the external file containing the structural models\n         * in the ensemble. The number of models in the external file should\n         * correspond to the number of models in the ensemble. This data item\n         * is a pointer to _ihm_external_files.id in the IHM_EXTERNAL_FILES\n         * category.\n         * It is recommended that the large ensemble files be stored as separate\n         * zip files within the same DOI. It is also recommended that large sphere\n         * model ensembles be in binary format, which facilitates faster access.\n         * Currently, a binary dump of co-ordinates in dcd format is suggested.\n         * The topology can be inferred from the IHM_SPHERE_OBJ_SITE and the\n         * ATOM_SITE categories in the corresponding mmCIF file.\n         */\n        ensemble_file_id: int,\n    },\n    /**\n     * Data items in the IHM_MODEL_LIST category record the\n     * details of the models being deposited.\n     */\n    ihm_model_list: {\n        /**\n         * A unique identifier for the structural model being deposited.\n         */\n        model_id: int,\n        /**\n         * A decsriptive name for the model.\n         */\n        model_name: str,\n        /**\n         * An identifier to the structure assembly corresponding to the model.\n         * This data item is a pointer to the _ihm_struct_assembly.id\n         * in the IHM_STRUCT_ASSEMBLY category.\n         */\n        assembly_id: int,\n        /**\n         * An identifier to the modeling protocol that produced the model.\n         * This data item is a pointer to the _ihm_modeling_protocol.id\n         * in the IHM_MODELING_PROTOCOL category.\n         */\n        protocol_id: int,\n        /**\n         * An identifier to the multi-scale model representation id of the model.\n         * This data item is a pointer to the _ihm_model_representation.id\n         * in the IHM_MODEL_REPRESENTATION category.\n         */\n        representation_id: int,\n    },\n    /**\n     * IHM_MODEL_GROUP category defines collections or groups of integrative\n     * structural models.\n     */\n    ihm_model_group: {\n        /**\n         * A unique identifier for a collection or group of structural models.\n         * This data item can be used to group models into structural clusters\n         * or using other criteria based on experimental data or other\n         * relationships such as those belonging to the same state or time stamp.\n         * An ensemble of models and its representative can either be grouped together\n         * or can be separate groups in the ihm_model_group table. The choice between\n         * the two options should be decided based on how the modeling was carried out\n         * and how the representative was chosen. If the representative is a member of\n         * the ensemble (i.e., best scoring model), then it is recommended that the\n         * representative and the ensemble belong to the same model group. If the\n         * representative is calculated from the ensemble (i.e., centroid), then it is\n         * recommended that the representative be separated into a different group.\n         */\n        id: int,\n        /**\n         * A name for the collection of models.\n         */\n        name: str,\n        /**\n         * Additional details about the collection of models.\n         */\n        details: str,\n    },\n    /**\n     * IHM_MODEL_GROUP_LINK category provides the list of models present in\n     * a particular model group.\n     */\n    ihm_model_group_link: {\n        /**\n         * An identifier for the structural model.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * An identifier for the structural model group.\n         * This data item is a pointer to _ihm_model_group.id in the\n         * IHM_MODEL_GROUP category.\n         */\n        group_id: int,\n    },\n    /**\n     * Data items in the IHM_MODEL_REPRESENTATIVE category record the\n     * details of the representative model in an ensemble or cluster.\n     */\n    ihm_model_representative: {\n        /**\n         * A unique identifier for the representative of the model group.\n         */\n        id: int,\n        /**\n         * The model group identifier corresponding to the representative model.\n         * This data item is a pointer to _ihm_model_group.id in the\n         * IHM_MODEL_GROUP category.\n         */\n        model_group_id: int,\n        /**\n         * The model identifier corresponding to the representative model.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * The selection criteria based on which the representative is chosen.\n         */\n        selection_criteria: Aliased(str),\n    },\n    /**\n     * Category holds the list of all datasets used in the IHM modeling.\n     * These can be datasets archived in other related databases such as\n     * BMRB, EMDB, EMPIAR, SASBDB, PRIDE etc., or can be hosted in other\n     * places such as the authors website, github etc. These datasets are\n     * elaborated in detail in the IHM_DATASET_RELATED_DB_REFERENCE and/or\n     * the IHM_DATASET_EXTERNAL_REFERENCE categories. This category\n     * holds the list of all datasets used.\n     */\n    ihm_dataset_list: {\n        /**\n         * A unique identifier for the dataset.\n         */\n        id: int,\n        /**\n         * The type of data held in the dataset.\n         */\n        data_type: Aliased(str),\n        /**\n         * A flag that indicates whether the dataset is archived in\n         * an IHM related database or elsewhere.\n         */\n        database_hosted: Aliased(lstr),\n    },\n    /**\n     * Category to define groups or collections of input datasets.\n     */\n    ihm_dataset_group: {\n        /**\n         * A unique identifier for the dataset group.\n         */\n        id: int,\n        /**\n         * A name for the dataset group.\n         */\n        name: str,\n        /**\n         * The application / utilization of the dataset group in modeling.\n         */\n        application: Aliased(str),\n        /**\n         * Additional details regarding the dataset group.\n         */\n        details: str,\n    },\n    /**\n     * IHM_DATASET_GROUP_LINK category provides the list of datasets present in\n     * a particular group.\n     */\n    ihm_dataset_group_link: {\n        /**\n         * An identifier for the dataset.\n         * This data item is a pointer to _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * An identifier for the dataset group.\n         * This data item is a pointer to _ihm_dataset_group.id in the\n         * IHM_DATASET_GROUP category.\n         */\n        group_id: int,\n    },\n    /**\n     * Category holds information about related datasets, where one is derived from the other.\n     */\n    ihm_related_datasets: {\n        /**\n         * The dataset list id corresponding to the derived dataset.\n         * This data item is a pointer to _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id_derived: int,\n        /**\n         * The primary dataset list id from which the corresponding derived dataset is obtained.\n         * This data item is a pointer to _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id_primary: int,\n    },\n    /**\n     * Category holds information related to data sources for the entry.\n     * These can be datasets archived in other related databases such as\n     * BMRB, EMDB, EMPIAR, SASBDB, PRIDE etc.\n     */\n    ihm_dataset_related_db_reference: {\n        /**\n         * A unique identifier for the related database entry.\n         */\n        id: int,\n        /**\n         * Identifier to the dataset list used in the IHM modeling.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * The name of the database containing the dataset entry.\n         */\n        db_name: Aliased(str),\n        /**\n         * The accession code for the database entry.\n         */\n        accession_code: str,\n        /**\n         * Version of the database entry, if the database allows versioning.\n         */\n        version: str,\n        /**\n         * Details regarding the dataset entry.\n         */\n        details: str,\n    },\n    /**\n     * Category holds links to other external data sources for the I/H model entry.\n     * Input datasets held in other databases such as EMDB, BMRB, SASBDB etc.\n     * are referenced in the IHM_DATASET_RELATED_DB_REFERENCE category.\n     * This data category, along with IHM_EXTERNAL_FILES category, holds information\n     * regarding other non-database external data sources, such as  DOIs (digital\n     * object identifiers) or supplementary files stored locally. The DOIs can either\n     * lead to the external data file(s) directly (as in case of DOIs provided by the PDB)\n     * or might lead to an HTML landing page (as provided by Zenodo). In the latter case,\n     * additional URL (Uniform Resource Locator) information is required to retrieve\n     * the external data file(s).\n     */\n    ihm_external_reference_info: {\n        /**\n         * A unique identifier for the external reference.\n         */\n        reference_id: int,\n        /**\n         * The name of the reference provider.\n         */\n        reference_provider: str,\n        /**\n         * The type of external reference.\n         * Currently, only Digital Object Identifiers (DOIs) and supplementary files\n         * stored locally are supported.\n         */\n        reference_type: Aliased(str),\n        /**\n         * The external reference or the Digital Object Identifier (DOI).\n         * This field is not relevant for local files.\n         */\n        reference: str,\n        /**\n         * The type of object that the external reference points to, usually\n         * a single file or an archive.\n         */\n        refers_to: Aliased(str),\n        /**\n         * The Uniform Resource Locator (URL) corresponding to the external reference (DOI).\n         * This URL should link to the corresponding downloadable file or archive and is provided\n         * to enable automated software to download the referenced file or archive.\n         */\n        associated_url: str,\n    },\n    /**\n     * Category provides details regarding external files. The IHM_EXTERNAL_REFERENCE_INFO\n     * category captures the top-level details regarding external data sources.\n     * This category captures the specific details regarding externally stored files\n     * related to the particular I/H model entry.\n     */\n    ihm_external_files: {\n        /**\n         * A unique identifier for each external file.\n         */\n        id: int,\n        /**\n         * A pointer to the source of the external file - either DOI or locally stored.\n         * This data item is a pointer to _ihm_external_reference_info.reference_id in the\n         * IHM_EXTERNAL_REFERENCE_INFO category.\n         */\n        reference_id: int,\n        /**\n         * The relative path (including filename) for each external file.\n         * Absolute paths (starting with \"/\") are not permitted.\n         * This is required for identifying individual files from within\n         * a tar-zipped archive file or for identifying supplementary local\n         * files organized within a directory structure.\n         * This data item assumes a POSIX-like directory structure or file path.\n         */\n        file_path: str,\n        /**\n         * The type of content in the file.\n         */\n        content_type: Aliased(str),\n        /**\n         * Storage size of the external file in bytes.\n         */\n        file_size_bytes: float,\n        /**\n         * Additional textual details regarding the external file.\n         */\n        details: str,\n    },\n    /**\n     * Category provides additional details regarding input data hosted externally\n     * at other resources.\n     */\n    ihm_dataset_external_reference: {\n        /**\n         * A unique identifier for the external data.\n         */\n        id: int,\n        /**\n         * Identifier to the dataset list used in the I/H modeling.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * The file id corresponding to this external data file.\n         * This data item is a pointer to _ihm_external_files.id\n         * in the IHM_EXTERNAL_FILES category.\n         */\n        file_id: int,\n    },\n    /**\n     * Data items in the IHM_LOCALIZATION_DENSITY_FILES category records the\n     * details of files that provide information regarding localization densities\n     * of ensembles. These may be stored externally as local files or linked via\n     * DOI and can be in any accepted format that provides volume information\n     * (CCP4, MRC, etc.).\n     */\n    ihm_localization_density_files: {\n        /**\n         * A unique identifier.\n         */\n        id: int,\n        /**\n         * The file id for the externally stored localization density file.\n         * This data item is a pointer to _ihm_external_files.id\n         * in the IHM_EXTERNAL_FILES category.\n         */\n        file_id: int,\n        /**\n         * The ensemble identifier for the ensemble, for which the localization density is provided.\n         * This data item is a pointer to _ihm_ensemble_info.ensemble_id in the IHM_ENSEMBLE_INFO category.\n         */\n        ensemble_id: int,\n        /**\n         * The entity identifier corresponding to this localization density.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The identifier for the polymeric segment corresponding to this\n         * localization density.\n         * This data item is a pointer to _ihm_entity_poly_segment.id in the\n         * IHM_ENTITY_POLY_SEGMENT category.\n         */\n        entity_poly_segment_id: int,\n        /**\n         * An asym/strand identifier corresponding to this localization density.\n         * This data item is a pointer to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n    },\n    /**\n     * Data items in the IHM_PREDICTED_CONTACT_RESTRAINT category records the\n     * list of predicted contacts used in the integrative modeling experiment.\n     * This has been adapted from the widely used CASP RR format\n     * (http://www.predictioncenter.org/casp8/index.cgi?page=format#RR).\n     * These contacts may be derived from various computational tools.\n     * The software information can be provided in the SOFTWARE category.\n     */\n    ihm_predicted_contact_restraint: {\n        /**\n         * A unique identifier for the predicted contact restraint.\n         */\n        id: int,\n        /**\n         * An identifier to group the predicted contacts.\n         */\n        group_id: int,\n        /**\n         * The entity identifier for the first monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category.\n         */\n        entity_id_1: str,\n        /**\n         * The entity identifier for the second monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category.\n         */\n        entity_id_2: str,\n        /**\n         * An asym/strand identifier for the first monomer partner in the predicted contact.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id_1: str,\n        /**\n         * An asym/strand identifier for the second monomer partner in the predicted contact.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id_2: str,\n        /**\n         * The component identifier for the first monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier for the second monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_2: str,\n        /**\n         * The sequence index for the first monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_1: int,\n        /**\n         * The sequence index for the second monomer partner in the predicted contact.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_2: int,\n        /**\n         * If _ihm_predicted_contact_restraint.model_granularity is by-residue, then indicate the atom\n         * used to represent the first monomer partner in three-dimension. Default is the C-alpha atom.\n         */\n        rep_atom_1: Aliased(str),\n        /**\n         * If _ihm_predicted_contact_restraint.model_granularity is by-residue, then indicate the atom\n         * used to represent the second monomer partner in three-dimension. Default is the C-alpha atom.\n         */\n        rep_atom_2: Aliased(str),\n        /**\n         * The lower limit to the distance threshold applied to this predicted contact restraint\n         * in the integrative modeling task.\n         */\n        distance_lower_limit: float,\n        /**\n         * The upper limit to the distance threshold applied to this predicted contact restraint\n         * in the integrative modeling task.\n         */\n        distance_upper_limit: float,\n        /**\n         * The real number that indicates the probability that the predicted distance restraint\n         * is correct. This number should fall between 0.0 and 1.0.\n         */\n        probability: float,\n        /**\n         * The type of distance restraint applied.\n         */\n        restraint_type: Aliased(str),\n        /**\n         * The granularity of the predicted contact as applied to the multi-scale model.\n         */\n        model_granularity: Aliased(str),\n        /**\n         * Identifier to the predicted contacts dataset.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * Identifier to the software used to obtain the predicted contacts dataset.\n         * This data item is a pointer to the _software.pdbx_ordinal in the\n         * SOFTWARE category.\n         */\n        software_id: int,\n    },\n    /**\n     * Data items in the IHM_CROSS_LINK_LIST category records the\n     * list of spatial restraints derived from chemical crosslinking\n     * experiment.\n     */\n    ihm_cross_link_list: {\n        /**\n         * A unique identifier for the cross link restraint.\n         */\n        id: int,\n        /**\n         * An identifier for a set of ambiguous crosslink restraints.\n         * Handles experimental uncertainties in the identities of\n         * crosslinked residues.\n         */\n        group_id: int,\n        /**\n         * A text description of molecular entity 1.\n         */\n        entity_description_1: str,\n        /**\n         * A text description of molecular entity 2.\n         */\n        entity_description_2: str,\n        /**\n         * The entity identifier for the first monomer partner in the cross link\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category.\n         */\n        entity_id_1: str,\n        /**\n         * The entity identifier for the second monomer partner in the cross link\n         *\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category.\n         */\n        entity_id_2: str,\n        /**\n         * The component identifier for the first monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier for the second monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_2: str,\n        /**\n         * The sequence index for the first monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_1: int,\n        /**\n         * The sequence index for the second monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_2: int,\n        /**\n         * The type of crosslinker used.\n         */\n        linker_type: Aliased(str),\n        /**\n         * Identifier to the crosslinking dataset.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n    },\n    /**\n     * Data items in the IHM_CROSS_LINK_RESTRAINT category enumerates the\n     * implementation details of the chemical crosslinking restraints in\n     * the integrative modeling. This category holds the details of how\n     * the experimentally derived crosslinks are applied in the modeling.\n     */\n    ihm_cross_link_restraint: {\n        /**\n         * A unique identifier for the cross link record.\n         */\n        id: int,\n        /**\n         * An identifier for a set of ambiguous cross-links.\n         * Handles implementation uncertainties related to multiple copies of subunit.\n         * This data item is a pointer to _ihm_cross_link_list.id in the\n         * IHM_CROSS_LINK_LIST category.\n         */\n        group_id: int,\n        /**\n         * The entity identifier for the first monomer partner in the cross link\n         *\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.entity_id_1 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        entity_id_1: str,\n        /**\n         * The entity identifier for the second monomer partner in the cross link\n         *\n         * This data item is a pointer to _entity_poly_seq.entity_id in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.entity_id_2 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        entity_id_2: str,\n        /**\n         * An asym/strand identifier for the first monomer partner in the cross-link.\n         *\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id_1: str,\n        /**\n         * An asym/strand identifier for the second monomer partner in the cross-link.\n         *\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id_2: str,\n        /**\n         * The component identifier for the first monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.comp_id_1 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier for the second monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.comp_id_2 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        comp_id_2: str,\n        /**\n         * The sequence index for the first monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.seq_id_1 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        seq_id_1: int,\n        /**\n         * The sequence index for the second monomer partner in the cross link.\n         *\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category\n         * and the _ihm_cross_link_restraint.seq_id_2 in the IHM_CROSS_LINK_RESTRAINT category.\n         */\n        seq_id_2: int,\n        /**\n         * The atom identifier for the first monomer partner in the cross link.\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_1: str,\n        /**\n         * The atom identifier for the second monomer partner in the cross link.\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_2: str,\n        /**\n         * The type of the cross link restraint applied.\n         */\n        restraint_type: Aliased(str),\n        /**\n         * The cross link conditionality.\n         */\n        conditional_crosslink_flag: Aliased(str),\n        /**\n         * The coarse-graining information for the crosslink implementation.\n         */\n        model_granularity: Aliased(str),\n        /**\n         * The distance threshold applied to this crosslink in the integrative modeling task.\n         */\n        distance_threshold: float,\n        /**\n         * The uncertainty in the crosslinking experimental data;\n         * may be approximated to the false positive rate.\n         */\n        psi: float,\n        /**\n         * The uncertainty in the position of residue 1 in the crosslink\n         * arising due to the multi-scale nature of the model represention.\n         */\n        sigma_1: float,\n        /**\n         * The uncertainty in the position of residue 2 in the crosslink\n         * arising due to the multi-scale nature of the model represention.\n         */\n        sigma_2: float,\n    },\n    /**\n     * Data items in the IHM_CROSS_LINK_RESULT_PARAMETERS category records the\n     * results of the crosslinking restraint parameters in the IHM modeling.\n     */\n    ihm_cross_link_result_parameters: {\n        /**\n         * A unique identifier for the restraint/model combination.\n         */\n        id: int,\n        /**\n         * An identifier for the crosslink restraint between a pair of residues.\n         * This data item is a pointer to _ihm_cross_link_restraint.id in the\n         * IHM_CROSS_LINK_RESTRAINT category.\n         */\n        restraint_id: int,\n        /**\n         * The model number corresponding to the cross link result presented.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * The uncertainty in the crosslinking experimental data;\n         * May be approximated to the false positive rate.\n         */\n        psi: float,\n        /**\n         * The uncertainty in the position of residue 1 in the crosslink\n         * arising due to the multi-scale nature of the model represention.\n         */\n        sigma_1: float,\n        /**\n         * The uncertainty in the position of residue 2 in the crosslink\n         * arising due to the multi-scale nature of the model represention.\n         */\n        sigma_2: float,\n    },\n    /**\n     * Data items in the IHM_2DEM_CLASS_AVERAGE_RESTRAINT category records the\n     * details of the 2DEM class averages used in the IHM modeling.\n     */\n    ihm_2dem_class_average_restraint: {\n        /**\n         * A unique identifier for the 2dem class average.\n         */\n        id: int,\n        /**\n         * Identifier to the 2dem class average dataset.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * The number of raw micrographs used to obtain the class average.\n         */\n        number_raw_micrographs: int,\n        /**\n         * Pixel size width of the 2dem class average image.\n         * While fitting the model to the image, _ihm_2dem_class_average_restraint.pixel_size_width\n         * is used along with _ihm_2dem_class_average_restraint.pixel_size_height to scale the image.\n         */\n        pixel_size_width: float,\n        /**\n         * Pixel size height of the 2dem class average image.\n         * While fitting the model to the image, _ihm_2dem_class_average_restraint.pixel_size_height\n         * is used along with _ihm_2dem_class_average_restraint.pixel_size_width to scale the image.\n         */\n        pixel_size_height: float,\n        /**\n         * Resolution of the 2dem class average.\n         */\n        image_resolution: float,\n        /**\n         * A flag that indicates whether or not the 2DEM class average image is segmented i.e.,\n         * whether the whole image is used or only a portion of it is used (by masking\n         * or by other means) as restraint in the modeling.\n         */\n        image_segment_flag: Aliased(lstr),\n        /**\n         * Number of 2D projections of the model used in the fitting.\n         */\n        number_of_projections: int,\n        /**\n         * An indicator to whether the whole assembly that is modeled is fit into the image\n         * or if only a subset of the structural assembly is fit into the image.\n         * This data item is a pointer to _ihm_struct_assembly.id in the\n         * IHM_STRUCT_ASSEMBLY category. The IHM_STRUCT_ASSEMBLY category provides the\n         * details regarding the different structural assemblies used in the modeling.\n         * The default value for this data item is \"1\" indicating that the entire assembly\n         * being modeled is fit into the EM data.\n         */\n        struct_assembly_id: int,\n        /**\n         * Details of how the 2DEM restraint is applied in the modeling algorithm.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_2DEM_CLASS_AVERAGE_FITTING category records the\n     * details of the fitting of the model to the 2DEM class averages\n     * used in the IHM modeling. The following conventions are recommended\n     * while generating the rotation matrix and translation vector for\n     * transformation.\n     *\n     * - The model is rotated and translated to fit to the 2DEM image.\n     * - The 2DEM image should be in the XY plane.\n     * - The lower left image corner (image pixel index 0,0) should be at x,y,z = (0,0,0).\n     * - The 2D image is scaled by the _ihm_2dem_class_average_restraint.pixel_size_width\n     * and _ihm_2dem_class_average_restraint.pixel_size_height from the\n     * IHM_2DEM_CLASS_AVERAGE_RESTRAINT table.\n     * - The transformation is applied after the scaling and hence the translation vector\n     * should account for the scaling.\n     * - There are no specifications for Z translations i.e., how far the image should be\n     * from the model while projecting. It may be set to zero.\n     */\n    ihm_2dem_class_average_fitting: {\n        /**\n         * A unique identifier for the 2dem class average fitting data.\n         */\n        id: int,\n        /**\n         * Identifier to the 2dem class average restraint.\n         * This data item is a pointer to the _ihm_2dem_class_average_restraint.id in the\n         * IHM_2DEM_CLASS_AVERAGE_RESTRAINT category.\n         */\n        restraint_id: int,\n        /**\n         * The model number corresponding to the 2DEM fitting result presented.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * The cross correlation coefficient corresponding to the model to image fitting.\n         */\n        cross_correlation_coefficient: float,\n        /**\n         * Data item  of the rotation matrix used in the fitting of the model to the image.\n         */\n        rot_matrix: Matrix(3, 3),\n        /**\n         * Data item  of the tranlation vector used in the fitting of the model to the image.\n         */\n        tr_vector: Vector(3),\n    },\n    /**\n     * Data items in the IHM_3DEM_RESTRAINT category records the\n     * details of the 3DEM maps used as restraints in the\n     * IHM modeling.\n     */\n    ihm_3dem_restraint: {\n        /**\n         * A unique identifier for the 3DEM restraint description.\n         */\n        id: int,\n        /**\n         * Identifier to the 3DEM map used.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * The model number corresponding to the 3DEM fitting result presented.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * An indicator to whether the whole assembly that is modeled is fit into the 3DEM map\n         * or if only a subset of the structural assembly is fit into the map.\n         * This data item is a pointer to _ihm_struct_assembly.id in the\n         * IHM_STRUCT_ASSEMBLY category. The IHM_STRUCT_ASSEMBLY category provides the\n         * details regarding the different structural assemblies used in the modeling.\n         * The default value for this data item is \"1\" indicating that the entire assembly\n         * being modeled is fit into the EM map.\n         */\n        struct_assembly_id: int,\n        /**\n         * Method used to fit the model to the 3DEM map.\n         */\n        fitting_method: str,\n        /**\n         * In case of Gaussian mixture models, the number of gaussians\n         * is a parameter used to covert the 3DEM maps and models into\n         * GMMs. This captures the level of granularity used in\n         * representing the maps and/or models as 3D Gaussians.\n         */\n        number_of_gaussians: int,\n        /**\n         * The cross correlation coefficient corresponding to the model to map fitting.\n         */\n        cross_correlation_coefficient: float,\n    },\n    /**\n     * Data items in the IHM_SAS_RESTRAINT category records the\n     * details of the SAS data used as restraints in the\n     * IHM modeling.\n     */\n    ihm_sas_restraint: {\n        /**\n         * A unique identifier for the SAS restraint description.\n         */\n        id: int,\n        /**\n         * Identifier to the SAS data used.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         */\n        dataset_list_id: int,\n        /**\n         * The model number corresponding to the SAS fitting result presented.\n         * This data item is a pointer to _ihm_model_list.model_id in the\n         * IHM_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * An indicator to whether the whole assembly that is modeled is fit into the SAS data\n         * or if only a subset of the structural assembly is fit into the data.\n         * This data item is a pointer to _ihm_struct_assembly.id in the\n         * IHM_STRUCT_ASSEMBLY category. The IHM_STRUCT_ASSEMBLY category provides the\n         * details regarding the different structural assemblies used in the modeling.\n         * The default value for this data item is \"1\" indicating that the entire assembly\n         * being modeled is fit into the SAS data.\n         */\n        struct_assembly_id: int,\n        /**\n         * A flag that indicates whether or not the SAS profile is segmented i.e.,\n         * whether the whole SAS profile is used or only a portion of it is used\n         * (by masking or by other means) as restraint in the modeling.\n         */\n        profile_segment_flag: Aliased(lstr),\n        /**\n         * The type of atoms in the model fit to the SAS data.\n         */\n        fitting_atom_type: str,\n        /**\n         * The method used for fitting the model to the SAS data.\n         */\n        fitting_method: str,\n        /**\n         * An indicator to single or multiple state fitting.\n         */\n        fitting_state: Aliased(str),\n        /**\n         * Radius of gyration obtained from the SAS profile, if used as input restraint.\n         */\n        radius_of_gyration: float,\n        /**\n         * The chi value resulting from fitting the model to the SAS data.\n         */\n        chi_value: float,\n        /**\n         * Additional details regarding the SAS restraint used.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the IHM_STARTING_MODEL_COORD category records the coordinates\n     * for structural templates used as starting inputs in the integrative model\n     * building tasks.\n     */\n    ihm_starting_model_coord: {\n        /**\n         * A unique identifier for this coordinate position.\n         */\n        ordinal_id: int,\n        /**\n         * The identifier for the starting structural model.\n         * This data item is a pointer to _ihm_starting_model_details.starting_model_id\n         * in the IHM_STARTING_MODEL_DETAILS category.\n         */\n        starting_model_id: str,\n        /**\n         * The group of atoms to which the atom site in the starting model belongs. This data\n         * item is provided for compatibility with the original Protein Data Bank format,\n         * and only for that purpose.\n         */\n        group_PDB: Aliased(str),\n        /**\n         * The serial number for this coordinate position.\n         */\n        id: int,\n        /**\n         * The atom type symbol(element symbol) corresponding to this coordinate position.\n         */\n        type_symbol: str,\n        /**\n         * The entity identifier corresponding to this coordinate position.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The atom identifier/name corresponding to this coordinate position.\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id: str,\n        /**\n         * The component identifier corresponding to this coordinate position.\n         * This data item is a pointer to _chem_comp.id in the\n         * CHEM_COMP category.\n         */\n        comp_id: str,\n        /**\n         * The sequence index corresponding this to coordinate position.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id: int,\n        /**\n         * The asym/strand id corresponding to this coordinate position.\n         *\n         * This data item is a pointer to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The Cartesian X component corresponding to this coordinate position.\n         */\n        Cartn_x: float,\n        /**\n         * The Cartesian Y component corresponding to this coordinate position.\n         */\n        Cartn_y: float,\n        /**\n         * The Cartesian Z component corresponding to this coordinate position.\n         */\n        Cartn_z: float,\n        /**\n         * The isotropic temperature factor corresponding to this coordinate position.\n         */\n        B_iso_or_equiv: float,\n    },\n    /**\n     * Data items in the IHM_SPHERE_OBJ_SITE category records the details\n     * of the spherical objects modeled in the integrative structural model.\n     */\n    ihm_sphere_obj_site: {\n        /**\n         * A unique identifier for this pseudo atom / sphere object.\n         */\n        id: int,\n        /**\n         * The entity identifier corresponding to this sphere object.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The leading sequence index corresponding to this sphere object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_begin: int,\n        /**\n         * The trailing sequence index corresponding to this sphere object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_end: int,\n        /**\n         * An asym/strand identifier corresponding to this sphere object.\n         * This data item is a pointer to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The Cartesian X component corresponding to this sphere object.\n         */\n        Cartn_x: float,\n        /**\n         * The Cartesian Y component corresponding to this sphere object.\n         */\n        Cartn_y: float,\n        /**\n         * The Cartesian Z component corresponding to this sphere object.\n         */\n        Cartn_z: float,\n        /**\n         * The radius associated with the primitive sphere object at this position.\n         */\n        object_radius: float,\n        /**\n         * The Root Mean Square Fluctuation (RMSF) observed in the primitive\n         * sphere object at this position.\n         */\n        rmsf: float,\n        /**\n         * The model id corresponding to the sphere object.\n         * This data item is a pointer to _ihm_model_list.model_id\n         * in the IHM_MODEL_LIST category.\n         */\n        model_id: int,\n    },\n    /**\n     * Data items in the IHM_GAUSSIAN_OBJ_SITE category records the details\n     * of the gaussian objects modeled in the integrative structural model.\n     */\n    ihm_gaussian_obj_site: {\n        /**\n         * A unique identifier for this gaussian object in the model.\n         */\n        id: int,\n        /**\n         * The entity identifier corresponding to this gaussian object.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The leading sequence index corresponding to this gaussian object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_begin: int,\n        /**\n         * The trailing sequence index corresponding to this gaussian object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_end: int,\n        /**\n         * An asym/strand identifier corresponding to this gaussian object.\n         * This data item is a pointer to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The mean Cartesian X component corresponding to this gaussian object.\n         */\n        mean_Cartn_x: float,\n        /**\n         * The mean Cartesian Y component corresponding to this gaussian object.\n         */\n        mean_Cartn_y: float,\n        /**\n         * The mean Cartesian Z component corresponding to this gaussian object.\n         */\n        mean_Cartn_z: float,\n        /**\n         * The weight of the gaussian object.\n         */\n        weight: float,\n        /**\n         * Data item  of the covariance matrix representing the Gaussian object.\n         */\n        covariance_matrix: Matrix(3, 3),\n        /**\n         * The model id corresponding to the gaussian object.\n         * This data item is a pointer to _ihm_model_list.model_id\n         * in the IHM_MODEL_LIST category.\n         */\n        model_id: int,\n    },\n    /**\n     * Data items in the IHM_GAUSSIAN_OBJ_ENSEMBLE category records the details\n     * of the gaussian objects representing an ensemble or cluster of models.\n     */\n    ihm_gaussian_obj_ensemble: {\n        /**\n         * A unique identifier for this gaussian object.\n         */\n        id: int,\n        /**\n         * The entity identifier corresponding to this gaussian object.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The leading sequence index corresponding to this gaussian object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_begin: int,\n        /**\n         * The trailing sequence index corresponding to this gaussian object.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_end: int,\n        /**\n         * An asym/strand identifier corresponding to this gaussian object.\n         * This data item is a pointer to _struct_asym.id in the STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The mean Cartesian X component corresponding to this gaussian object.\n         */\n        mean_Cartn_x: float,\n        /**\n         * The mean Cartesian Y component corresponding to this gaussian object.\n         */\n        mean_Cartn_y: float,\n        /**\n         * The mean Cartesian Z component corresponding to this gaussian object.\n         */\n        mean_Cartn_z: float,\n        /**\n         * The weight of the gaussian object.\n         */\n        weight: float,\n        /**\n         * Data item  of the covariance matrix representing the Gaussian object.\n         */\n        covariance_matrix: Matrix(3, 3),\n        /**\n         * The ensemble id corresponding to the gaussian object.\n         * This data item is a pointer to _ihm_ensemble_info.ensemble_id\n         * in the IHM_ENSEMBLE_INFO category.\n         */\n        ensemble_id: int,\n    },\n    /**\n     * IHM_FEATURE_LIST is the high level category that provides defintions\n     * to select atoms/residues from polymeric and non-polymeric entities.\n     */\n    ihm_feature_list: {\n        /**\n         * A unique identifier for the feature.\n         */\n        feature_id: int,\n        /**\n         * The type of feature.\n         */\n        feature_type: Aliased(str),\n        /**\n         * The type of entity.\n         */\n        entity_type: Aliased(str),\n    },\n    /**\n     * Data items in the IHM_POLY_RESIDUE_FEATURE category provides the defintions\n     * required to select a specific residue or a set of residues that may or may not be\n     * in a contiguous range.\n     */\n    ihm_poly_residue_feature: {\n        /**\n         * A unique identifier for the category.\n         */\n        ordinal_id: int,\n        /**\n         * An identifier for the selected residue / residue range feature.\n         * This data item is a pointer to _ihm_feature_list.feature_id in the\n         * IHM_FEATURE_LIST category.\n         */\n        feature_id: int,\n        /**\n         * The entity identifier for residue / residue range.\n         * This data item is a pointer to _entity_poly_seq.entity_id in the\n         * ENTITY_POLY_SEQ category.\n         */\n        entity_id: str,\n        /**\n         * An asym/strand identifier for the residue / residue range, if applicable.\n         * This data item is a pointer to _struct_asym.id in the\n         * STRUCT_ASYM category.\n         */\n        asym_id: str,\n        /**\n         * The component identifier of the beginning residue / residue range.\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_begin: str,\n        /**\n         * The component identifier of the ending residue / residue range.\n         * This data item is a pointer to _entity_poly_seq.mon_id in the ENTITY_POLY_SEQ category.\n         */\n        comp_id_end: str,\n        /**\n         * The sequence index of the beginning residue / residue range.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_begin: int,\n        /**\n         * The sequence index of the ending residue / residue range.\n         * This data item is a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category.\n         */\n        seq_id_end: int,\n    },\n    /**\n     * Data items in the IHM_DERIVED_DISTANCE_RESTRAINT category records the\n     * list of distance restraints used in the integrative modeling experiment.\n     * These distance redistance restraints may be derived from various kinds of experiments.\n     */\n    ihm_derived_distance_restraint: {\n        /**\n         * A unique identifier for the derived distance restraint.\n         */\n        id: int,\n        /**\n         * An identifier to group the distance restraints.\n         * This can be the same as the _ihm_derived_distance_restraint.id in case\n         * the some of the restraints are not grouped.\n         */\n        group_id: int,\n        /**\n         * The feature identifier for the first partner in the distance restraint.\n         * This data item is a pointer to _ihm_feature_list.feature_id in the\n         * IHM_FEATURE_LIST category.\n         */\n        feature_id_1: int,\n        /**\n         * The feature identifier for the second partner in the distance restraint.\n         * This data item is a pointer to _ihm_feature_list.feature_id in the\n         * IHM_FEATURE_LIST category.\n         */\n        feature_id_2: int,\n        /**\n         * If a group of atoms or residues are restrained, this data item defines\n         * the conditionality based on which the restraint is applied in the modeling.\n         */\n        group_conditionality: Aliased(str),\n        /**\n         * The fraction of randomly excluded distance restraints during modeling.\n         * In HADDOCK, this is used along with ambiguous interface restraints (AIRs)\n         * to account for uncertainties in AIRs.\n         */\n        random_exclusion_fraction: float,\n        /**\n         * The upper limit to the distance threshold applied to this distance restraint\n         * in the integrative modeling task.\n         */\n        distance_upper_limit: float,\n        /**\n         * The type of distance restraint applied.\n         */\n        restraint_type: Aliased(str),\n        /**\n         * Identifier to the input data from which the distance restraint is derived.\n         * This data item is a pointer to the _ihm_dataset_list.id in the\n         * IHM_DATASET_LIST category.\n         * This data item may not be applicable for all cases. For example, in case of\n         * ambiguous interface restraints where the interface residues are identified\n         * from multiple experiments, the reference to the _ihm_dataset_list.id is\n         * handled in the IHM_INTERFACE_RESIDUE_FEATURE category rather than here.\n         */\n        dataset_list_id: int,\n    },\n    /**\n     * Data items in the MA_MODEL_LIST category record the\n     * details of the models being deposited.\n     */\n    ma_model_list: {\n        /**\n         * A unique identifier for the model / model group combination.\n         */\n        ordinal_id: int,\n        /**\n         * A unique identifier for the structural model being deposited.\n         */\n        model_id: int,\n        /**\n         * An identifier to group structural models into collections or sets.\n         * A cluster of models and its representative can either be grouped together\n         * or can be separate groups in the ma_model_list table. The choice between\n         * the two options should be decided based on how the modeling was carried out\n         * and how the representative was chosen. If the representative is a member of\n         * the ensemble (i.e., best scoring model), then it is recommended that the\n         * representative and the ensemble belong to the same model group. If the\n         * representative is calculated from the ensemble (i.e., centroid), then it is\n         * recommended that the representative be separated into a different group.\n         * If the models do not need to be grouped into collections, then the\n         * _ma_model_list.model_group_id is the same as _ma_model_list.model_id.\n         */\n        model_group_id: int,\n        /**\n         * A decsriptive name for the model.\n         */\n        model_name: str,\n        /**\n         * A decsriptive name for the model group.\n         */\n        model_group_name: str,\n        /**\n         * The type of model.\n         */\n        model_type: Aliased(str),\n        /**\n         * The data_id identifier. This data item is a pointer to\n         * _ma_data.id in the MA_DATA category.\n         */\n        data_id: int,\n    },\n    /**\n     * Data items in the MA_TARGET_ENTITY category record details about\n     * the target entities. The details are provided for each entity\n     * being modeled.\n     */\n    ma_target_entity: {\n        /**\n         * A unique identifier for the distinct molecular entity of the target.\n         * This data item is a pointer to _entity.id in the ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * The data_id identifier. This data item is a pointer to\n         * _ma_data.id in the MA_DATA category.\n         */\n        data_id: int,\n        /**\n         * The origin of the target entity.\n         */\n        origin: Aliased(str),\n    },\n    /**\n     * Data items in the MA_TARGET_ENTITY_INSTANCE category record details about\n     * the instances of target entities modeled.\n     */\n    ma_target_entity_instance: {\n        /**\n         * A unique identifier for the instance of the entity.\n         */\n        asym_id: str,\n        /**\n         * A unique identifier for the distinct molecular entity of the target.\n         * This data item is a pointer to _ma_target_entity.entity_id in the\n         * MA_TARGET_ENTITY category.\n         */\n        entity_id: str,\n        /**\n         * Additional details about the entity instance.\n         */\n        details: str,\n    },\n    /**\n     * Data items in the MA_TARGET_REF_DB_DETAILS category record details about\n     * the reference databases for the target sequences.\n     */\n    ma_target_ref_db_details: {\n        /**\n         * An identifier for the target entity.\n         */\n        target_entity_id: str,\n        /**\n         * The name of the database containing reference information about\n         * this entity or biological unit.\n         */\n        db_name: Aliased(str),\n        /**\n         * The code for this entity or biological unit or for a closely\n         * related entity or biological unit in the named database.\n         * This can include the version number.\n         */\n        db_code: str,\n        /**\n         * Accession code assigned by the reference database.\n         */\n        db_accession: str,\n        /**\n         * Database code assigned by the reference database for a sequence isoform.   An isoform sequence is an\n         * alternative protein sequence that can be generated from the same gene by a single or by a combination of\n         * biological events such as: alternative promoter usage, alternative splicing, alternative initiation\n         * and ribosomal frameshifting.\n         */\n        seq_db_isoform: str,\n        /**\n         * Beginning index in the chemical sequence from the\n         * reference database.\n         */\n        seq_db_align_begin: str,\n        /**\n         * Ending index in the chemical sequence from the\n         * reference database.\n         */\n        seq_db_align_end: str,\n        /**\n         * Taxonomy identifier provided by NCBI.\n         */\n        ncbi_taxonomy_id: str,\n        /**\n         * Scientific name of the organism.\n         */\n        organism_scientific: str,\n    },\n    /**\n     * Data items in the MA_DATA category capture the different kinds of\n     * data used in the modeling. These can be multiple sequence\n     * alignments, spatial restraints, template structures etc.\n     */\n    ma_data: {\n        /**\n         * A unique identifier for the data.\n         */\n        id: int,\n        /**\n         * The type of data held in the dataset.\n         */\n        content_type: Aliased(str),\n        /**\n         * Details for other content types.\n         */\n        content_type_other_details: str,\n        /**\n         * An author-given name for the content held in the dataset.\n         */\n        name: str,\n    },\n    /**\n     * Data items in the MA_SOFTWARE_GROUP category describes the\n     * collection of software into groups so that they can be used\n     * efficiently in the MA_PROTOCOL_STEP category.\n     */\n    ma_software_group: {\n        /**\n         * A unique identifier for the category.\n         */\n        ordinal_id: int,\n        /**\n         * An identifier for the group entry.\n         * If data does not need to be grouped, then _ma_software_group.group_id\n         * is the same as _ma_software_group.software_id.\n         */\n        group_id: int,\n        /**\n         * The identifier for the software.\n         * This data item is a pointer to _software.pdbx_ordinal\n         * in the SOFTWARE category.\n         */\n        software_id: int,\n    },\n    /**\n     * Data items in the MA_QA_METRIC category record the\n     * details of the metrics use to assess model quality.\n     */\n    ma_qa_metric: {\n        /**\n         * An identifier for the QA metric.\n         */\n        id: int,\n        /**\n         * Name of the QA metric.\n         */\n        name: str,\n        /**\n         * The type of QA metric.\n         */\n        type: Aliased(str),\n        /**\n         * The mode of calculation of the QA metric.\n         */\n        mode: Aliased(str),\n        /**\n         * Identifier to the set of software used to calculate the QA metric.\n         * This data item is a pointer to the _ma_software_group.group_id in the\n         * MA_SOFTWARE_GROUP category.\n         */\n        software_group_id: int,\n    },\n    /**\n     * Data items in the MA_QA_METRIC_GLOBAL category captures the\n     * details of the global QA metrics, calculated at the model-level.\n     */\n    ma_qa_metric_global: {\n        /**\n         * A unique identifier for the category.\n         */\n        ordinal_id: int,\n        /**\n         * The identifier for the structural model, for which global QA metric is provided.\n         * This data item is a pointer to _ma_model_list.model_id\n         * in the MA_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * The identifier for the QA metric.\n         * This data item is a pointer to _ma_qa_metric.id in the\n         * MA_QA_METRIC category.\n         */\n        metric_id: int,\n        /**\n         * The value of the global QA metric.\n         */\n        metric_value: float,\n    },\n    /**\n     * Data items in the MA_QA_METRIC_LOCAL category captures the\n     * details of the local QA metrics, calculated at the residue-level.\n     */\n    ma_qa_metric_local: {\n        /**\n         * A unique identifier for the category.\n         */\n        ordinal_id: int,\n        /**\n         * The identifier for the structural model, for which local QA metric is provided.\n         * This data item is a pointer to _ma_model_list.model_id\n         * in the MA_MODEL_LIST category.\n         */\n        model_id: int,\n        /**\n         * The identifier for the asym id of the residue in the\n         * structural model, for which local QA metric is provided.\n         * This data item is a pointer to _atom_site.label_asym_id\n         * in the ATOM_SITE category.\n         */\n        label_asym_id: str,\n        /**\n         * The identifier for the sequence index of the residue\n         * in the structural model, for which local QA metric is provided.\n         * This data item is a pointer to _atom_site.label_seq_id\n         * in the ATOM_SITE category.\n         */\n        label_seq_id: int,\n        /**\n         * The component identifier for the residue in the\n         * structural model, for which local QA metric is provided.\n         * This data item is a pointer to _atom_site.label_comp_id\n         * in the ATOM_SITE category.\n         */\n        label_comp_id: str,\n        /**\n         * The identifier for the QA metric.\n         * This data item is a pointer to _ma_qa_metric.id in the\n         * MA_QA_METRIC category.\n         */\n        metric_id: int,\n        /**\n         * The value of the local QA metric.\n         */\n        metric_value: float,\n    },\n};\n;\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Code-generated 'CCD' schema file. Dictionary versions: mmCIF 5.391, IHM 1.25, MA 1.4.6.\n *\n * @author molstar/ciftools package\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst str = Schema.str;\nconst float = Schema.float;\nconst List = Schema.List;\nconst lstr = Schema.lstr;\nconst Aliased = Schema.Aliased;\nconst int = Schema.int;\nconst coord = Schema.coord;\nexport const CCD_Schema = {\n    /**\n     * Data items in the CHEM_COMP category give details about each\n     * of the chemical components from which the relevant chemical\n     * structures can be constructed, such as name, mass or charge.\n     *\n     * The related categories CHEM_COMP_ATOM, CHEM_COMP_BOND,\n     * CHEM_COMP_ANGLE etc. describe the detailed geometry of these\n     * chemical components.\n     */\n    chem_comp: {\n        /**\n         * The formula for the chemical component. Formulae are written\n         * according to the following rules:\n         *\n         * (1) Only recognized element symbols may be used.\n         *\n         * (2) Each element symbol is followed by a 'count' number. A count\n         * of '1' may be omitted.\n         *\n         * (3) A space or parenthesis must separate each cluster of\n         * (element symbol + count), but in general parentheses are\n         * not used.\n         *\n         * (4) The order of elements depends on whether carbon is\n         * present or not. If carbon is present, the order should be:\n         * C, then H, then the other elements in alphabetical order\n         * of their symbol. If carbon is not present, the elements\n         * are listed purely in alphabetic order of their symbol. This\n         * is the 'Hill' system used by Chemical Abstracts.\n         */\n        formula: str,\n        /**\n         * Formula mass in daltons of the chemical component.\n         */\n        formula_weight: float,\n        /**\n         * The value of _chem_comp.id must uniquely identify each item in\n         * the CHEM_COMP list.\n         *\n         * For protein polymer entities, this is the three-letter code for\n         * the amino acid.\n         *\n         * For nucleic acid polymer entities, this is the one-letter code\n         * for the base.\n         */\n        id: str,\n        /**\n         * The identifier for the parent component of the nonstandard\n         * component. May be be a comma separated list if this component\n         * is derived from multiple components.\n         *\n         * Items in this indirectly point to _chem_comp.id in\n         * the CHEM_COMP category.\n         */\n        mon_nstd_parent_comp_id: List(',', x => x),\n        /**\n         * The full name of the component.\n         */\n        name: str,\n        /**\n         * For standard polymer components, the one-letter code for\n         * the component.   For non-standard polymer components, the\n         * one-letter code for parent component if this exists;\n         * otherwise, the one-letter code should be given as 'X'.\n         *\n         * Components that derived from multiple parents components\n         * are described by a sequence of one-letter-codes.\n         */\n        one_letter_code: str,\n        /**\n         * For standard polymer components, the common three-letter code for\n         * the component.   Non-standard polymer components and non-polymer\n         * components are also assigned three-letter-codes.\n         *\n         * For ambiguous polymer components three-letter code should\n         * be given as 'UNK'.  Ambiguous ions are assigned the code 'UNX'.\n         * Ambiguous non-polymer components are assigned the code 'UNL'.\n         */\n        three_letter_code: str,\n        /**\n         * For standard polymer components, the type of the monomer.\n         * Note that monomers that will form polymers are of three types:\n         * linking monomers, monomers with some type of N-terminal (or 5')\n         * cap and monomers with some type of C-terminal (or 3') cap.\n         */\n        type: Aliased(lstr),\n        /**\n         * Synonym list for the component.\n         */\n        pdbx_synonyms: List(';', x => x),\n        /**\n         * A preliminary classification used by PDB.\n         */\n        pdbx_type: str,\n        /**\n         * A preliminary classification used by PDB to indicate\n         * that the chemistry of this component while described\n         * as clearly as possible is still ambiguous.  Software\n         * tools may not be able to process this component\n         * definition.\n         */\n        pdbx_ambiguous_flag: str,\n        /**\n         * Identifies the _chem_comp.id of the component that\n         * has replaced this component.\n         */\n        pdbx_replaced_by: str,\n        /**\n         * Identifies the _chem_comp.id's of the components\n         * which have been replaced by this component.\n         * Multiple id codes should be separated by commas.\n         */\n        pdbx_replaces: str,\n        /**\n         * The net integer charge assigned to this component. This is the\n         * formal charge assignment normally found in chemical diagrams.\n         */\n        pdbx_formal_charge: int,\n        /**\n         * This data item provides additional details about the model coordinates\n         * in the component definition.\n         */\n        pdbx_model_coordinates_details: str,\n        /**\n         * This data item identifies the PDB database code from which the heavy\n         * atom model coordinates were obtained.\n         */\n        pdbx_model_coordinates_db_code: str,\n        /**\n         * This data item identifies the source of the ideal coordinates in the\n         * component definition.\n         */\n        pdbx_ideal_coordinates_details: str,\n        /**\n         * This data item identifies if ideal coordinates are missing in this definition.\n         */\n        pdbx_ideal_coordinates_missing_flag: Aliased(lstr),\n        /**\n         * This data item identifies if model coordinates are missing in this definition.\n         */\n        pdbx_model_coordinates_missing_flag: Aliased(lstr),\n        /**\n         * Date component was added to database.\n         */\n        pdbx_initial_date: str,\n        /**\n         * Date component was last modified.\n         */\n        pdbx_modified_date: str,\n        /**\n         * This data item holds the current release status for the component.\n         */\n        pdbx_release_status: Aliased(str),\n        /**\n         * This data item identifies the deposition site that processed\n         * this chemical component defintion.\n         */\n        pdbx_processing_site: Aliased(str),\n    },\n    /**\n     * Data items in the CHEM_COMP_ATOM category record details about\n     * the atoms in a chemical component. Specifying the atomic\n     * coordinates for the components in this category is an\n     * alternative to specifying the structure of the component\n     * via bonds, angles, planes etc. in the appropriate\n     * CHEM_COMP subcategories.\n     */\n    chem_comp_atom: {\n        /**\n         * An alternative identifier for the atom. This data item would be\n         * used in cases where alternative nomenclatures exist for labelling\n         * atoms in a group.\n         */\n        alt_atom_id: str,\n        /**\n         * The value of _chem_comp_atom.atom_id must uniquely identify\n         * each atom in each monomer in the CHEM_COMP_ATOM list.\n         *\n         * The atom identifiers need not be unique over all atoms in the\n         * data block; they need only be unique for each atom in a\n         * component.\n         *\n         * Note that this item need not be a number; it can be any unique\n         * identifier.\n         */\n        atom_id: str,\n        /**\n         * The net integer charge assigned to this atom. This is the\n         * formal charge assignment normally found in chemical diagrams.\n         */\n        charge: int,\n        /**\n         * The x component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms. The choice of\n         * reference axis frame for the coordinates is arbitrary.\n         *\n         * The set of coordinates input for the entity here is intended to\n         * correspond to the atomic model used to generate restraints for\n         * structure refinement, not to atom sites in the ATOM_SITE\n         * list.\n         */\n        model_Cartn_x: coord,\n        /**\n         * The y component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms. The choice of\n         * reference axis frame for the coordinates is arbitrary.\n         *\n         * The set of coordinates input for the entity here is intended to\n         * correspond to the atomic model used to generate restraints for\n         * structure refinement, not to atom sites in the ATOM_SITE\n         * list.\n         */\n        model_Cartn_y: coord,\n        /**\n         * The z component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms. The choice of\n         * reference axis frame for the coordinates is arbitrary.\n         *\n         * The set of coordinates input for the entity here is intended to\n         * correspond to the atomic model used to generate restraints for\n         * structure refinement, not to atom sites in the ATOM_SITE\n         * list.\n         */\n        model_Cartn_z: coord,\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * The code used to identify the atom species representing\n         * this atom type. Normally this code is the element\n         * symbol.\n         */\n        type_symbol: str,\n        /**\n         * Atom name alignment offset in PDB atom field.\n         */\n        pdbx_align: int,\n        /**\n         * Ordinal index for the component atom list.\n         */\n        pdbx_ordinal: int,\n        /**\n         * An alternative x component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms.\n         */\n        pdbx_model_Cartn_x_ideal: coord,\n        /**\n         * An alternative y component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms.\n         */\n        pdbx_model_Cartn_y_ideal: coord,\n        /**\n         * An alternative z component of the coordinates for this atom in this\n         * component specified as orthogonal angstroms.\n         */\n        pdbx_model_Cartn_z_ideal: coord,\n        /**\n         * The chiral configuration of the atom that is a chiral center.\n         */\n        pdbx_stereo_config: Aliased(lstr),\n        /**\n         * A flag indicating an aromatic atom.\n         */\n        pdbx_aromatic_flag: Aliased(lstr),\n        /**\n         * A flag indicating a leaving atom.\n         */\n        pdbx_leaving_atom_flag: Aliased(lstr),\n    },\n    /**\n     * Data items in the CHEM_COMP_BOND category record details about\n     * the bonds between atoms in a chemical component. Target values\n     * may be specified as bond orders, as a distance between the two\n     * atoms, or both.\n     */\n    chem_comp_bond: {\n        /**\n         * The ID of the first of the two atoms that define the bond.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_1: str,\n        /**\n         * The ID of the second of the two atoms that define the bond.\n         *\n         * This data item is a pointer to _chem_comp_atom.atom_id in the\n         * CHEM_COMP_ATOM category.\n         */\n        atom_id_2: str,\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * The value that should be taken as the target for the chemical\n         * bond associated with the specified atoms, expressed as a bond\n         * order.\n         */\n        value_order: Aliased(lstr),\n        /**\n         * Ordinal index for the component bond list.\n         */\n        pdbx_ordinal: int,\n        /**\n         * Stereochemical configuration across a double bond.\n         */\n        pdbx_stereo_config: Aliased(lstr),\n        /**\n         * A flag indicating an aromatic bond.\n         */\n        pdbx_aromatic_flag: Aliased(lstr),\n    },\n    /**\n     * Data items in the CHEM_COMP_DESCRIPTOR category provide\n     * string descriptors of component chemical structure.\n     */\n    pdbx_chem_comp_descriptor: {\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * This data item contains the descriptor value for this\n         * component.\n         */\n        descriptor: str,\n        /**\n         * This data item contains the descriptor type.\n         */\n        type: Aliased(lstr),\n        /**\n         * This data item contains the name of the program\n         * or library used to compute the descriptor.\n         */\n        program: str,\n        /**\n         * This data item contains the version of the program\n         * or library used to compute the descriptor.\n         */\n        program_version: str,\n    },\n    /**\n     * Data items in the CHEM_COMP_IDENTIFIER category provide\n     * identifiers for chemical components.\n     */\n    pdbx_chem_comp_identifier: {\n        /**\n         * This data item is a pointer to _chem_comp.id in the CHEM_COMP\n         * category.\n         */\n        comp_id: str,\n        /**\n         * This data item contains the identifier value for this\n         * component.\n         */\n        identifier: str,\n        /**\n         * This data item contains the identifier type.\n         */\n        type: Aliased(str),\n        /**\n         * This data item contains the name of the program\n         * or library used to compute the identifier.\n         */\n        program: str,\n        /**\n         * This data item contains the version of the program\n         * or library used to compute the identifier.\n         */\n        program_version: str,\n    },\n};\n;\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Code-generated 'BIRD' schema file. Dictionary versions: mmCIF 5.391, IHM 1.25, MA 1.4.6.\n *\n * @author molstar/ciftools package\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst str = Schema.str;\nconst float = Schema.float;\nconst lstr = Schema.lstr;\nconst Aliased = Schema.Aliased;\nconst int = Schema.int;\nexport const BIRD_Schema = {\n    /**\n     * Data items in the PDBX_REFERENCE_MOLECULE category record\n     * reference information about small polymer molecules.\n     */\n    pdbx_reference_molecule: {\n        /**\n         * The value of _pdbx_reference_molecule.prd_id is the unique identifier\n         * for the reference molecule in this family.\n         *\n         * By convention this ID uniquely identifies the reference molecule in\n         * in the PDB reference dictionary.\n         *\n         * The ID has the template form PRD_dddddd (e.g. PRD_000001)\n         */\n        prd_id: str,\n        /**\n         * Formula mass in daltons of the entity.\n         */\n        formula_weight: float,\n        /**\n         * The formula for the reference entity. Formulae are written\n         * according to the rules:\n         *\n         * 1. Only recognised element symbols may be used.\n         *\n         * 2. Each element symbol is followed by a 'count' number. A count\n         * of '1' may be omitted.\n         *\n         * 3. A space or parenthesis must separate each element symbol and\n         * its count, but in general parentheses are not used.\n         *\n         * 4. The order of elements depends on whether or not carbon is\n         * present. If carbon is present, the order should be: C, then\n         * H, then the other elements in alphabetical order of their\n         * symbol. If carbon is not present, the elements are listed\n         * purely in alphabetic order of their symbol. This is the\n         * 'Hill' system used by Chemical Abstracts.\n         */\n        formula: str,\n        /**\n         * Defines the structural classification of the entity.\n         */\n        type: Aliased(lstr),\n        /**\n         * Evidence for the assignment of _pdbx_reference_molecule.type\n         */\n        type_evidence_code: str,\n        /**\n         * Broadly defines the function of the entity.\n         */\n        class: Aliased(lstr),\n        /**\n         * Evidence for the assignment of _pdbx_reference_molecule.class\n         */\n        class_evidence_code: str,\n        /**\n         * A name of the entity.\n         */\n        name: str,\n        /**\n         * Defines how this entity is represented in PDB data files.\n         */\n        represent_as: Aliased(lstr),\n        /**\n         * For entities represented as single molecules, the identifier\n         * corresponding to the chemical definition for the molecule.\n         */\n        chem_comp_id: str,\n        /**\n         * Special details about this molecule.\n         */\n        compound_details: str,\n        /**\n         * Description of this molecule.\n         */\n        description: str,\n        /**\n         * The PDB accession code for the entry containing a representative example of this molecule.\n         */\n        representative_PDB_id_code: str,\n        /**\n         * Defines the current PDB release status for this molecule definition.\n         */\n        release_status: Aliased(lstr),\n        /**\n         * Assigns the identifier for the reference molecule which have been replaced\n         * by this reference molecule.\n         * Multiple molecule identifier codes should be separated by commas.\n         */\n        replaces: str,\n        /**\n         * Assigns the identifier of the reference molecule that has replaced this molecule.\n         */\n        replaced_by: str,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_LIST category record\n     * the list of entities within each reference molecule.\n     */\n    pdbx_reference_entity_list: {\n        /**\n         * The value of _pdbx_reference_entity_list.prd_id is a reference\n         * _pdbx_reference_molecule.prd_id in the PDBX_REFERENCE_MOLECULE category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_list.ref_entity_id is a unique identifier\n         * the a constituent entity within this reference molecule.\n         */\n        ref_entity_id: str,\n        /**\n         * Defines the polymer characteristic of the entity.\n         */\n        type: Aliased(lstr),\n        /**\n         * Additional details about this entity.\n         */\n        details: str,\n        /**\n         * The component number of this entity within the molecule.\n         */\n        component_id: int,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_NONPOLY category record\n     * the list of entities within each reference molecule.\n     */\n    pdbx_reference_entity_nonpoly: {\n        /**\n         * The value of _pdbx_reference_entity_nonpoly.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_nonpoly.ref_entity_id is a reference\n         * to _pdbx_reference_entity_list.ref_entity_id in PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id: str,\n        /**\n         * A name of the non-polymer entity.\n         */\n        name: str,\n        /**\n         * For non-polymer entities, the identifier corresponding\n         * to the chemical definition for the molecule.\n         */\n        chem_comp_id: str,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_LINK category give details about\n     * the linkages between entities within reference molecules.\n     */\n    pdbx_reference_entity_link: {\n        /**\n         * The value of _pdbx_reference_entity_link.link_id uniquely identifies\n         * linkages between entities with a molecule.\n         */\n        link_id: int,\n        /**\n         * The value of _pdbx_reference_entity_link.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * A description of special aspects of a linkage between\n         * chemical components in the structure.\n         */\n        details: str,\n        /**\n         * The reference entity id of the first of the two entities joined by the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_list.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id_1: str,\n        /**\n         * The reference entity id of the second of the two entities joined by the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_list.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id_2: str,\n        /**\n         * For a polymer entity, the sequence number in the first of\n         * the two entities containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_1: int,\n        /**\n         * For a polymer entity, the sequence number in the second of\n         * the two entities containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_2: int,\n        /**\n         * The component identifier in the first of the two entities containing the linkage.\n         *\n         * For polymer entities, this data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         *\n         * For non-polymer entities, this data item is a pointer to\n         * _pdbx_reference_entity_nonpoly.chem_comp_id in the\n         * PDBX_REFERENCE_ENTITY_NONPOLY category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier in the second of the two entities containing the linkage.\n         *\n         * For polymer entities, this data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         *\n         * For non-polymer entities, this data item is a pointer to\n         * _pdbx_reference_entity_nonpoly.chem_comp_id in the\n         * PDBX_REFERENCE_ENTITY_NONPOLY category.\n         */\n        comp_id_2: str,\n        /**\n         * The atom identifier/name in the first of the two entities containing the linkage.\n         */\n        atom_id_1: str,\n        /**\n         * The atom identifier/name in the second of the two entities containing the linkage.\n         */\n        atom_id_2: str,\n        /**\n         * The bond order target for the chemical linkage.\n         */\n        value_order: Aliased(lstr),\n        /**\n         * The entity component identifier for the first of two entities containing the linkage.\n         */\n        component_1: int,\n        /**\n         * The entity component identifier for the second of two entities containing the linkage.\n         */\n        component_2: int,\n        /**\n         * A code indicating the entity types involved in the linkage.\n         */\n        link_class: Aliased(str),\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_POLY_LINK category give details about\n     * polymer linkages including both standard and non-standard linkages between\n     * polymer componnents.\n     */\n    pdbx_reference_entity_poly_link: {\n        /**\n         * The value of _pdbx_reference_entity_poly_link.link_id uniquely identifies\n         * a linkage within a polymer entity.\n         */\n        link_id: int,\n        /**\n         * The value of _pdbx_reference_entity_poly_link.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        prd_id: str,\n        /**\n         * The reference entity id of the polymer entity containing the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly.ref_entity_id\n         * in the PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        ref_entity_id: str,\n        /**\n         * The entity component identifier entity containing the linkage.\n         */\n        component_id: int,\n        /**\n         * For a polymer entity, the sequence number in the first of\n         * the two components making the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_1: int,\n        /**\n         * For a polymer entity, the sequence number in the second of\n         * the two components making the linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.num\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        entity_seq_num_2: int,\n        /**\n         * The component identifier in the first of the two components making the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        comp_id_1: str,\n        /**\n         * The component identifier in the second of the two components making the\n         * linkage.\n         *\n         * This data item is a pointer to _pdbx_reference_entity_poly_seq.mon_id\n         * in the PDBX_REFERENCE_ENTITY_POLY_SEQ category.\n         */\n        comp_id_2: str,\n        /**\n         * The atom identifier/name in the first of the two components making\n         * the linkage.\n         */\n        atom_id_1: str,\n        /**\n         * The atom identifier/name in the second of the two components making\n         * the linkage.\n         */\n        atom_id_2: str,\n        /**\n         * The bond order target for the non-standard linkage.\n         */\n        value_order: Aliased(lstr),\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_POLY category record details about\n     * the polymer, such as the type of the polymer, the number of\n     * monomers and whether it has nonstandard features.\n     */\n    pdbx_reference_entity_poly: {\n        /**\n         * The value of _pdbx_reference_entity_poly.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the  PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_poly.ref_entity_id is a reference\n         * to _pdbx_reference_entity_list.ref_entity_id in PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id: str,\n        /**\n         * The type of the polymer.\n         */\n        type: Aliased(str),\n        /**\n         * The database code for this source information\n         */\n        db_code: str,\n        /**\n         * The database name for this source information\n         */\n        db_name: str,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_POLY_SEQ category specify the sequence\n     * of monomers in a polymer.\n     */\n    pdbx_reference_entity_poly_seq: {\n        /**\n         * The value of _pdbx_reference_entity_poly_seq.prd_id is a reference\n         * _pdbx_reference_entity_poly.prd_id in the  PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_poly_seq.ref_entity_id is a reference\n         * to _pdbx_reference_entity_poly.ref_entity_id in PDBX_REFERENCE_ENTITY_POLY category.\n         */\n        ref_entity_id: str,\n        /**\n         * This data item is the chemical component identifier of monomer.\n         */\n        mon_id: str,\n        /**\n         * This data item is the chemical component identifier for the parent component corresponding to this monomer.\n         */\n        parent_mon_id: str,\n        /**\n         * The value of _pdbx_reference_entity_poly_seq.num must uniquely and sequentially\n         * identify a record in the PDBX_REFERENCE_ENTITY_POLY_SEQ list.\n         *\n         * This value is conforms to author numbering conventions and does not map directly\n         * to the numbering conventions used for _entity_poly_seq.num.\n         */\n        num: int,\n        /**\n         * A flag to indicate that this monomer is observed in the instance example.\n         */\n        observed: Aliased(lstr),\n        /**\n         * A flag to indicate that sequence heterogeneity at this monomer position.\n         */\n        hetero: Aliased(lstr),\n    },\n    /**\n     * Additional features associated with the reference entity.\n     */\n    pdbx_reference_entity_sequence: {\n        /**\n         * The value of _pdbx_reference_entity_sequence.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the  PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_sequence.ref_entity_id is a reference\n         * to _pdbx_reference_entity_list.ref_entity_id in PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id: str,\n        /**\n         * The monomer type for the sequence.\n         */\n        type: Aliased(str),\n        /**\n         * A flag to indicate a non-ribosomal entity.\n         */\n        NRP_flag: Aliased(str),\n        /**\n         * The one-letter-code sequence for this entity.  Non-standard monomers are represented as 'X'.\n         */\n        one_letter_codes: str,\n    },\n    /**\n     * Data items in the PDBX_REFERENCE_ENTITY_SRC_NAT category record\n     * details of the source from which the entity was obtained.\n     */\n    pdbx_reference_entity_src_nat: {\n        /**\n         * The value of _pdbx_reference_entity_src_nat.prd_id is a reference\n         * _pdbx_reference_entity_list.prd_id in the  PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        prd_id: str,\n        /**\n         * The value of _pdbx_reference_entity_src_nat.ref_entity_id is a reference\n         * to _pdbx_reference_entity_list.ref_entity_id in PDBX_REFERENCE_ENTITY_LIST category.\n         */\n        ref_entity_id: str,\n        /**\n         * The value of _pdbx_reference_entity_src_nat.ordinal distinguishes\n         * source details for this entity.\n         */\n        ordinal: int,\n        /**\n         * The scientific name of the organism from which the entity was isolated.\n         */\n        organism_scientific: str,\n        /**\n         * The NCBI TaxId of the organism from which the entity was isolated.\n         */\n        taxid: str,\n        /**\n         * The database code for this source information\n         */\n        db_code: str,\n        /**\n         * The database name for this source information\n         */\n        db_name: str,\n    },\n    /**\n     * Data items in the PDBX_PRD_AUDIT category records\n     * the status and tracking information for this molecule.\n     */\n    pdbx_prd_audit: {\n        /**\n         * This data item is a pointer to _pdbx_reference_molecule.prd_id in the\n         * pdbx_reference_molecule category.\n         */\n        prd_id: str,\n        /**\n         * The date associated with this audit record.\n         */\n        date: str,\n        /**\n         * An identifier for the wwPDB site creating or modifying the molecule.\n         */\n        processing_site: Aliased(str),\n        /**\n         * The action associated with this audit record.\n         */\n        action_type: Aliased(str),\n    },\n};\n;\n","/**\n * Copyright (c) 2017-2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst str = Schema.str;\nconst float = Schema.float;\nconst datablock = {\n    id: str,\n    description: str\n};\nconst dictionary = {\n    title: str,\n    datablock_id: str,\n    version: str\n};\nconst dictionary_history = {\n    version: str,\n    update: str,\n    revision: str\n};\nconst sub_category = {\n    id: str,\n    description: str\n};\nconst category_group_list = {\n    id: str,\n    parent_id: str,\n    description: str\n};\nconst item_type_list = {\n    code: str,\n    primitive_code: str,\n    construct: str,\n    detail: str\n};\nconst item_units_list = {\n    code: str,\n    detail: str\n};\nconst item_units_conversion = {\n    from_code: str,\n    to_code: str,\n    operator: str,\n    factor: float\n};\n// TODO save frame dic schema\nexport const dic_Schema = {\n    datablock,\n    dictionary,\n    dictionary_history,\n    sub_category,\n    category_group_list,\n    item_type_list,\n    item_units_list,\n    item_units_conversion\n};\n","/**\n * Copyright (c) 2018 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst str = Schema.str;\nconst int = Schema.int;\nconst float = Schema.float;\nconst Aliased = Schema.Aliased;\nconst Vector = Schema.Vector;\nexport const DensityServer_Header_Schema = {\n    density_server_result: {\n        'server_version': str,\n        'datetime_utc': str,\n        'guid': str,\n        'is_empty': Aliased(str),\n        'has_error': Aliased(str),\n        'error': str,\n        'query_source_id': str,\n        'query_type': Aliased(str),\n        'query_box_type': Aliased(str),\n        'query_box_a': Vector(3),\n        'query_box_b': Vector(3)\n    }\n};\nexport const DensityServer_Data_Schema = {\n    volume_data_3d_info: {\n        'name': str,\n        // zero indexed axis order of the data\n        'axis_order': Vector(3, int),\n        // Origin in fractional coords\n        'origin': Vector(3),\n        // Dimension in fractional coords\n        'dimensions': Vector(3),\n        'sample_rate': int,\n        // number of samples along each axis\n        'sample_count': Vector(3, int),\n        'spacegroup_number': int,\n        'spacegroup_cell_size': Vector(3),\n        // angles in degrees\n        'spacegroup_cell_angles': Vector(3),\n        'mean_source': float,\n        'mean_sampled': float,\n        'sigma_source': float,\n        'sigma_sampled': float,\n        'min_source': float,\n        'min_sampled': float,\n        'max_source': float,\n        'max_sampled': float\n    },\n    volume_data_3d: {\n        values: float\n    }\n};\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * Code-generated 'CifCore' schema file. Dictionary versions: CifCore 3.3.0.\n *\n * @author molstar/ciftools package\n */\nimport { Column } from '../../../../mol-data/db';\nvar Schema = Column.Schema;\nconst float = Schema.float;\nconst int = Schema.int;\nconst str = Schema.str;\nconst Matrix = Schema.Matrix;\nexport const CifCore_Schema = {\n    /**\n     * The CATEGORY of data items used to describe the parameters of\n     * the crystal unit cell.\n     */\n    cell: {\n        /**\n         * The angle between the bounding cell axes.\n         */\n        angle_alpha: float,\n        /**\n         * The angle between the bounding cell axes.\n         */\n        angle_beta: float,\n        /**\n         * The angle between the bounding cell axes.\n         */\n        angle_gamma: float,\n        /**\n         * The number of the formula units in the unit cell as specified\n         * by _chemical_formula.structural, _chemical_formula.moiety or\n         * _chemical_formula.sum.\n         */\n        formula_units_z: int,\n        /**\n         * The length of each cell axis.\n         */\n        length_a: float,\n        /**\n         * The length of each cell axis.\n         */\n        length_b: float,\n        /**\n         * The length of each cell axis.\n         */\n        length_c: float,\n        /**\n         * Volume of the crystal unit cell.\n         */\n        volume: float,\n    },\n    /**\n     * The CATEGORY of data items which describe the composition and\n     * chemical properties of the compound under study. The formula data\n     * items must be consistent with the density, unit-cell and Z values.\n     */\n    chemical: {\n        /**\n         * The temperature at which a crystalline solid changes to a liquid.\n         */\n        melting_point: float,\n        /**\n         * Trivial name by which the compound is commonly known.\n         */\n        name_common: str,\n        /**\n         * IUPAC or Chemical Abstracts full name of compound.\n         */\n        name_systematic: str,\n    },\n    /**\n     * The CATEGORY of data items which specify the composition and chemical\n     * properties of the compound. The formula data items must agree\n     * with those that specify the density, unit-cell and Z values.\n     *\n     * The following rules apply to the construction of the data items\n     * _chemical_formula.analytical, *.structural and *.sum. For the\n     * data item *.moiety the formula construction is broken up into\n     * residues or moieties, i.e. groups of atoms that form a molecular\n     * unit or molecular ion. The rules given below apply within each\n     * moiety, but different requirements apply to the way that moieties\n     * are connected (see _chemical_formula.moiety).\n     *\n     * 1. Only recognized element symbols may be used.\n     *\n     * 2. Each element symbol is followed by a 'count' number. A count of\n     * '1' may be omitted.\n     *\n     * 3. A space or parenthesis must separate each cluster of (element\n     * symbol + count).\n     *\n     * 4. Where a group of elements is enclosed in parentheses, the\n     * multiplier for the group must follow the closing parentheses.\n     * That is, all element and group multipliers are assumed to be\n     * printed as subscripted numbers. [An exception to this rule\n     * exists for *.moiety formulae where pre- and post-multipliers\n     * are permitted for molecular units].\n     *\n     * 5. Unless the elements are ordered in a manner that corresponds to\n     * their chemical structure, as in _chemical_formula.structural,\n     * the order of the elements within any group or moiety\n     * depends on whether or not carbon is present. If carbon is\n     * present, the order should be: C, then H, then the other\n     * elements in alphabetical order of their symbol. If carbon is\n     * not present, the elements are listed purely in alphabetical order\n     * of their symbol. This is the 'Hill' system used by Chemical\n     * Abstracts. This ordering is used in _chemical_formula.moiety\n     * and _chemical_formula.sum.\n     *\n     * _chemical_formula.IUPAC      '[Mo (C O)4 (C18 H33 P)2]'\n     * _chemical_formula.moiety     'C40 H66 Mo O4 P2'\n     * _chemical_formula.structural '((C O)4 (P (C6 H11)3)2)Mo'\n     * _chemical_formula.sum         'C40 H66 Mo O4 P2'\n     * _chemical_formula.weight      768.81\n     */\n    chemical_formula: {\n        /**\n         * Formula with each discrete bonded residue or ion shown as a\n         * separate moiety. See above CHEMICAL_FORMULA for rules\n         * for writing chemical formulae. In addition to the general\n         * formulae requirements, the following rules apply:\n         * 1. Moieties are separated by commas ','.\n         * 2. The order of elements within a moiety follows general rule\n         * 5 in CHEMICAL_FORMULA.\n         * 3. Parentheses are not used within moieties but may surround\n         * a moiety. Parentheses may not be nested.\n         * 4. Charges should be placed at the end of the moiety. The\n         * Singlege '+' or '-' may be preceded by a numerical multiplier\n         * and should be separated from the last (element symbol +\n         * count) by a space. Pre- or post-multipliers may be used for\n         * individual moieties.\n         */\n        moiety: str,\n        /**\n         * Chemical formulae in which all discrete bonded residues and ions are\n         * summed over the constituent elements, following the ordering given\n         * in rule 5 of the CATEGORY description. Parentheses normally not used.\n         */\n        sum: str,\n        /**\n         * Mass corresponding to the formulae _chemical_formula.structural,\n         * *_IUPAC, *_moiety or *_sum and, together with the Z value and cell\n         * parameters yield the density given as _exptl_crystal.density_diffrn.\n         */\n        weight: float,\n    },\n    /**\n     * The CATEGORY of data items used to specify space group\n     * information about the crystal used in the diffraction measurements.\n     *\n     * Space-group types are identified by their number as listed in\n     * International Tables for Crystallography Volume A, or by their\n     * Schoenflies symbol. Specific settings of the space groups can\n     * be identified by their Hall symbol, by specifying their\n     * symmetry operations or generators, or by giving the\n     * transformation that relates the specific setting to the\n     * reference setting based on International Tables Volume A and\n     * stored in this dictionary.\n     *\n     * The commonly used Hermann-Mauguin symbol determines the\n     * space-group type uniquely, but several different Hermann-Mauguin\n     * symbols may refer to the same space-group type. A\n     * Hermann-Mauguin symbol contains information on the choice of\n     * the basis, but not on the choice of origin.\n     *\n     * Ref: International Tables for Crystallography (2002). Volume A,\n     * Space-group symmetry, edited by Th. Hahn, 5th ed.\n     * Dordrecht: Kluwer Academic Publishers.\n     */\n    space_group: {\n        /**\n         * The name of the system of geometric crystal classes of space\n         * groups (crystal system) to which the space group belongs.\n         * Note that rhombohedral space groups belong to the\n         * trigonal system.\n         */\n        crystal_system: str,\n        /**\n         * The number as assigned in International Tables for Crystallography\n         * Vol. A, specifying the proper affine class (i.e. the orientation\n         * preserving affine class) of space groups (crystallographic space\n         * group type) to which the space group belongs. This number defines\n         * the space group type but not the coordinate system expressed.\n         */\n        it_number: int,\n        /**\n         * The full international Hermann-Mauguin space-group symbol as\n         * defined in Section 2.2.3 and given as the second item of the\n         * second line of each of the space-group tables of Part 7 of\n         * International Tables for Crystallography Volume A (2002).\n         *\n         * Each component of the space-group name is separated by a\n         * space or an underscore character. The use of a space is\n         * strongly recommended.  The underscore is only retained\n         * because it was used in old CIFs. It should not be used in\n         * new CIFs.\n         *\n         * Subscripts should appear without special symbols. Bars should\n         * be given as negative signs before the numbers to which they\n         * apply. The commonly used Hermann-Mauguin symbol determines the\n         * space-group type uniquely, but a given space-group type may\n         * be described by more than one Hermann-Mauguin symbol. The\n         * space-group type is best described using\n         * _space_group.IT_number or _space_group.name_Schoenflies. The\n         * full international Hermann-Mauguin symbol contains information\n         * about the choice of basis for monoclinic and orthorhombic\n         * space groups, but does not give information about the choice\n         * of origin. To define the setting uniquely use\n         * _space_group.name_Hall, or list the symmetry operations\n         * or generators.\n         *\n         * Ref: International Tables for Crystallography (2002). Volume A,\n         * Space-group symmetry, edited by Th. Hahn, 5th ed.\n         * Dordrecht: Kluwer Academic Publishers.\n         */\n        'name_h-m_full': str,\n    },\n    /**\n     * The CATEGORY of data items used to describe symmetry equivalent sites\n     * in the crystal unit cell.\n     */\n    space_group_symop: {\n        /**\n         * A parsable string giving one of the symmetry operations of the\n         * space group in algebraic form.  If W is a matrix representation\n         * of the rotational part of the symmetry operation defined by the\n         * positions and signs of x, y and z, and w is a column of\n         * translations defined by fractions, an equivalent position\n         * X' is generated from a given position X by the equation\n         *\n         * X' = WX + w\n         *\n         * (Note: X is used to represent bold_italics_x in International\n         * Tables for Crystallography Vol. A, Part 5)\n         *\n         * When a list of symmetry operations is given, it must contain\n         * a complete set of coordinate representatives which generates\n         * all the operations of the space group by the addition of\n         * all primitive translations of the space group. Such\n         * representatives are to be found as the coordinates of\n         * the general-equivalent position in International Tables for\n         * Crystallography Vol. A (2002), to which it is necessary to\n         * add any centring translations shown above the\n         * general-equivalent position.\n         *\n         * That is to say, it is necessary to list explicitly all the\n         * symmetry operations required to generate all the atoms in\n         * the unit cell defined by the setting used.\n         */\n        operation_xyz: str,\n    },\n    /**\n     * The CATEGORY of data items used to specify the geometry bonds in the\n     * structural model as derived from the atomic sites.\n     */\n    geom_bond: {\n        /**\n         * This label is a unique identifier for a particular site in the\n         * asymmetric unit of the crystal unit cell.\n         */\n        atom_site_label_1: str,\n        /**\n         * This label is a unique identifier for a particular site in the\n         * asymmetric unit of the crystal unit cell.\n         */\n        atom_site_label_2: str,\n        /**\n         * Intramolecular bond distance between the sites identified\n         * by _geom_bond.id\n         */\n        distance: float,\n        /**\n         * This code signals whether the angle is referred to in a\n         * publication or should be placed in a table of significant angles.\n         */\n        publ_flag: str,\n        /**\n         * Data item specifying the symmetry operation codes applied to the atom\n         * sites involved in a specific geometric configuration.\n         *\n         * The symmetry code of each atom site as the symmetry-equivalent position\n         * number 'n' and the cell translation number 'pqr'. These numbers are\n         * combined to form the code 'n pqr' or n_pqr.\n         *\n         * The character string n_pqr is composed as follows:\n         *\n         * n refers to the symmetry operation that is applied to the\n         * coordinates stored in _atom_site.fract_xyz. It must match\n         * a number given in _space_group_symop.id (or one of its\n         * aliases, such as _symmetry_equiv_pos_site_id).\n         *\n         * p, q and r refer to the translations that are subsequently\n         * applied to the symmetry transformed coordinates to generate\n         * the atom used in calculating the angle. These translations\n         * (x,y,z) are related to (p,q,r) by the relations\n         * p = 5 + x\n         * q = 5 + y\n         * r = 5 + z\n         */\n        site_symmetry_1: str,\n        /**\n         * Data item specifying the symmetry operation codes applied to the atom\n         * sites involved in a specific geometric configuration.\n         *\n         * The symmetry code of each atom site as the symmetry-equivalent position\n         * number 'n' and the cell translation number 'pqr'. These numbers are\n         * combined to form the code 'n pqr' or n_pqr.\n         *\n         * The character string n_pqr is composed as follows:\n         *\n         * n refers to the symmetry operation that is applied to the\n         * coordinates stored in _atom_site.fract_xyz. It must match\n         * a number given in _space_group_symop.id (or one of its\n         * aliases, such as _symmetry_equiv_pos_site_id).\n         *\n         * p, q and r refer to the translations that are subsequently\n         * applied to the symmetry transformed coordinates to generate\n         * the atom used in calculating the angle. These translations\n         * (x,y,z) are related to (p,q,r) by the relations\n         * p = 5 + x\n         * q = 5 + y\n         * r = 5 + z\n         */\n        site_symmetry_2: str,\n        /**\n         * Bond valence calculated from the bond distance.\n         */\n        valence: float,\n    },\n    /**\n     * The CATEGORY of data items used to record details about the\n     * creation and subsequent updating of the data block.\n     */\n    audit: {\n        /**\n         * The digital object identifier (DOI) registered to identify\n         * the data set publication represented by the current\n         * data block. This can be used as a unique identifier for\n         * the data block so long as the code used is a valid DOI\n         * (i.e. begins with a valid publisher prefix assigned by a\n         * Registration Agency and a suffix guaranteed to be unique\n         * by the publisher) and has had its metadata deposited\n         * with a DOI Registration Agency.\n         *\n         * A DOI is a unique character string identifying any\n         * object of intellectual property. It provides a\n         * persistent identifier for an object on a digital network\n         * and permits the association of related current data in a\n         * structured extensible way. A DOI is an implementation\n         * of the Internet concepts of Uniform Resource Name and\n         * Universal Resource Locator managed according to the\n         * specifications of the International DOI Foundation\n         * (see https://www.doi.org/).\n         */\n        block_doi: str,\n    },\n    /**\n     * The CATEGORY of data items recording database deposition. These data items\n     * are assigned by database managers and should only appear in a CIF if they\n     * originate from that source.\n     */\n    database_code: {\n        /**\n         * Code assigned by the Crystallography Open Database (COD).\n         */\n        cod: str,\n        /**\n         * Code assigned by the Cambridge Structural Database.\n         */\n        csd: str,\n        /**\n         * Deposition numbers assigned by the Cambridge Crystallographic\n         * Data Centre (CCDC) to files containing structural information\n         * archived by the CCDC.\n         */\n        depnum_ccdc_archive: str,\n        /**\n         * Deposition numbers assigned by the Fachinformationszentrum\n         * Karlsruhe (FIZ) to files containing structural information\n         * archived by the Cambridge Crystallographic Data Centre (CCDC).\n         */\n        depnum_ccdc_fiz: str,\n        /**\n         * Code assigned by the Inorganic Crystal Structure Database.\n         */\n        icsd: str,\n        /**\n         * Code assigned in the Metals Data File.\n         */\n        mdf: str,\n        /**\n         * Code assigned by the NBS (NIST) Crystal Data Database.\n         */\n        nbs: str,\n    },\n    /**\n     * The CATEGORY of data items used to describe atom site information\n     * used in crystallographic structure studies.\n     */\n    atom_site: {\n        /**\n         * Code for type of atomic displacement parameters used for the site.\n         */\n        adp_type: str,\n        /**\n         * A standard code to signal if the site coordinates have been\n         * determined from the intensities or calculated from the geometry\n         * of surrounding sites, or have been assigned dummy coordinates.\n         */\n        calc_flag: str,\n        /**\n         * A code which identifies a cluster of atoms that show long range disorder\n         * but are locally ordered. Within each such cluster of atoms,\n         * _atom_site.disorder_group is used to identify the sites that are\n         * simultaneously occupied. This field is only needed if there is more than\n         * one cluster of disordered atoms showing independent local order.\n         */\n        disorder_assembly: str,\n        /**\n         * A code that identifies a group of disordered atom sites that are locally\n         * simultaneously occupied. Atoms that are positionally disordered over two or\n         * more sites (e.g. the H atoms of a methyl group that exists in two\n         * orientations) should be assigned to two or more groups. Similarly, atoms\n         * that describe a specific alternative composition of a compositionally\n         * disordered site should be assigned to a distinct disorder group (e.g. a site\n         * that is partially occupied by Mg and Mn atoms should be described by\n         * assigning the Mg atom to one group and the Mn atom to another group). Sites\n         * belonging to the same group are simultaneously occupied, but those belonging\n         * to different groups are not. A minus prefix (e.g. \"-1\") is used to indicate\n         * sites disordered about a special position.\n         */\n        disorder_group: str,\n        /**\n         * Atom site coordinates as fractions of the cell length values.\n         */\n        fract_x: float,\n        /**\n         * Atom site coordinates as fractions of the cell length values.\n         */\n        fract_y: float,\n        /**\n         * Atom site coordinates as fractions of the cell length values.\n         */\n        fract_z: float,\n        /**\n         * This label is a unique identifier for a particular site in the\n         * asymmetric unit of the crystal unit cell. It is made up of\n         * components, _atom_site.label_component_0 to *_6, which may be\n         * specified as separate data items. Component 0 usually matches one\n         * of the specified _atom_type.symbol codes. This is not mandatory\n         * if an _atom_site.type_symbol item is included in the atom site\n         * list. The _atom_site.type_symbol always takes precedence over\n         * an _atom_site.label in the identification of the atom type. The\n         * label components 1 to 6 are optional, and normally only\n         * components 0 and 1 are used. Note that components 0 and 1 are\n         * concatenated, while all other components, if specified, are\n         * separated by an underline character. Underline separators are\n         * only used if higher-order components exist. If an intermediate\n         * component is not used it may be omitted provided the underline\n         * separators are inserted. For example the label 'C233__ggg' is\n         * acceptable and represents the components C, 233, '', and ggg.\n         * Each label may have a different number of components.\n         */\n        label: str,\n        /**\n         * The fraction of the atom type present at this site.\n         * The sum of the occupancies of all the atom types at this site\n         * may not significantly exceed 1.0 unless it is a dummy site. The\n         * value must lie in the 99.97% Gaussian confidence interval\n         * -3u =< x =< 1 + 3u. The _enumeration.range of 0.0:1.0 is thus\n         * correctly interpreted as meaning (0.0 - 3u) =< x =< (1.0 + 3u).\n         */\n        occupancy: float,\n        /**\n         * A concatenated series of single-letter codes which indicate the\n         * refinement restraints or constraints applied to this site. This\n         * item should not be used. It has been replaced by\n         * _atom_site.refinement_flags_posn, _ADP and _occupancy. It is\n         * retained in this dictionary only to provide compatibility with\n         * legacy CIFs.\n         */\n        refinement_flags: str,\n        /**\n         * The number of different sites that are generated by the\n         * application of the space-group symmetry to the coordinates\n         * given for this site. It is equal to the multiplicity given\n         * for this Wyckoff site in International Tables for Cryst.\n         * Vol. A (2002). It is equal to the multiplicity of the general\n         * position divided by the order of the site symmetry given in\n         * _atom_site.site_symmetry_order.\n         *\n         * The _atom_site_symmetry_multiplicity form of this data name is\n         * deprecated because of historical inconsistencies in practice among\n         * structure refinement software packages and should not be used.\n         */\n        site_symmetry_multiplicity: int,\n        /**\n         * A code to identify the atom specie(s) occupying this site.\n         * This code must match a corresponding _atom_type.symbol. The\n         * specification of this code is optional if component_0 of the\n         * _atom_site.label is used for this purpose. See _atom_type.symbol.\n         */\n        type_symbol: str,\n        /**\n         * Isotropic atomic displacement parameter, or equivalent isotropic\n         * atomic displacement parameter, U(equiv), in angstroms squared,\n         * calculated from anisotropic atomic displacement parameters.\n         *\n         * U(equiv) = (1/3) sum~i~[sum~j~(U^ij^ a*~i~ a*~j~ a~i~.a~j~)]\n         *\n         * a  = the real-space cell vectors\n         * a* = the reciprocal-space cell lengths\n         * Ref: Fischer, R. X. & Tillmanns, E. (1988). Acta Cryst. C44, 775-776.\n         */\n        u_iso_or_equiv: float,\n    },\n    /**\n     * The CATEGORY of data items used to describe the anisotropic atomic\n     * displacement parameters of the atomic sites in a crystal structure.\n     */\n    atom_site_aniso: {\n        /**\n         * Anisotropic atomic displacement parameters are usually looped in\n         * a separate list. If this is the case, this code must match the\n         * _atom_site.label of the associated atom in the atom coordinate\n         * list and conform with the same rules described in _atom_site.label.\n         */\n        label: str,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_11: float,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u: Matrix(3, 3),\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_12: float,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_13: float,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_22: float,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_23: float,\n        /**\n         * These are the standard anisotropic atomic displacement components, in\n         * angstroms squared, which appear in the structure factor term:\n         *\n         * T = exp{ -2^2^ sum~i~ [ sum~j~ (U^ij^ h~i~ h~j~ a*~i~ a*~j~) ] }\n         *\n         * h = the Miller indices\n         * a* = the reciprocal-space cell lengths\n         *\n         * The unique elements of the real symmetric matrix are entered by row.\n         *\n         * The IUCr Commission on Nomenclature recommends the use of U for reporting\n         * atomic displacement parameters .\n         *\n         * Note that U^ij^ = ^ij^/(2 ^2^ a*~i~ a*~j~) = B^ij^/(8 ^2^) [1].\n         *\n         * [1] Trueblood, K. N. et al. (1996). Acta Crystallogr. A52(5), 770-781.\n         */\n        u_33: float,\n    },\n    /**\n     * The CATEGORY of data items used to describe atomic type information\n     * used in crystallographic structure studies.\n     */\n    atom_type: {\n        /**\n         * A description of the atom(s) designated by this atom type. In\n         * most cases this will be the element name and oxidation state of\n         * a single atom species. For disordered or nonstoichiometric\n         * structures it will describe a combination of atom species.\n         */\n        description: str,\n        /**\n         * The identity of the atom specie(s) representing this atom type.\n         * Normally this code is the element symbol followed by the charge\n         * if there is one. The symbol may be composed of any character except\n         * an underline or a blank, with the proviso that digits designate an\n         * oxidation state and must be followed by a + or - character.\n         */\n        symbol: str,\n    },\n    /**\n     * The CATEGORY of data items used to describe atomic scattering\n     * information used in crystallographic structure studies.\n     */\n    atom_type_scat: {\n        /**\n         * The imaginary component of the anomalous dispersion scattering factors\n         * for this atom type and radiation by _diffrn_radiation_wavelength.value\n         */\n        dispersion_imag: float,\n        /**\n         * The real component of the anomalous dispersion scattering factors\n         * for this atom type and radiation by _diffrn_radiation_wavelength.value\n         */\n        dispersion_real: float,\n        /**\n         * Reference to source of scattering factors used for this atom type.\n         */\n        source: str,\n    },\n};\nexport const CifCore_Aliases = {\n    'cell.formula_units_z': [\n        'cell_formula_units_Z',\n    ],\n    'space_group.it_number': [\n        'space_group_IT_number',\n        'symmetry_Int_Tables_number',\n    ],\n    'space_group.name_h-m_full': [\n        'symmetry_space_group_name_H-M',\n    ],\n    'space_group_symop.operation_xyz': [\n        'symmetry_equiv_pos_as_xyz',\n    ],\n    'geom_bond.atom_site_label_1': [\n        'geom_bond_atom_site_id_1',\n    ],\n    'geom_bond.atom_site_label_2': [\n        'geom_bond_atom_site_id_2',\n    ],\n    'geom_bond.distance': [\n        'geom_bond_dist',\n    ],\n    'audit.block_doi': [\n        'audit_block_DOI',\n    ],\n    'database_code.cod': [\n        'database_code_COD',\n    ],\n    'database_code.csd': [\n        'database_code_CSD',\n    ],\n    'database_code.depnum_ccdc_archive': [\n        'database_code_depnum_CCDC_archive',\n    ],\n    'database_code.depnum_ccdc_fiz': [\n        'database_code_depnum_CCDC_fiz',\n    ],\n    'database_code.icsd': [\n        'database_code_ICSD',\n    ],\n    'database_code.mdf': [\n        'database_code_MDF',\n    ],\n    'database_code.nbs': [\n        'database_code_NBS',\n    ],\n    'atom_site.adp_type': [\n        'atom_site_ADP_type',\n        'atom_site_thermal_displace_type',\n    ],\n    'atom_site.label': [\n        'atom_site_id',\n    ],\n    'atom_site.site_symmetry_multiplicity': [\n        'atom_site_symmetry_multiplicity',\n    ],\n    'atom_site.u_iso_or_equiv': [\n        'atom_site_U_iso_or_equiv',\n    ],\n    'atom_site_aniso.label': [\n        'atom_site_anisotrop_id',\n    ],\n    'atom_site_aniso.u_11': [\n        'atom_site_aniso_U_11',\n        'atom_site_anisotrop_U_11',\n    ],\n    'atom_site_aniso.u_12': [\n        'atom_site_aniso_U_12',\n        'atom_site_anisotrop_U_12',\n    ],\n    'atom_site_aniso.u_13': [\n        'atom_site_aniso_U_13',\n        'atom_site_anisotrop_U_13',\n    ],\n    'atom_site_aniso.u_22': [\n        'atom_site_aniso_U_22',\n        'atom_site_anisotrop_U_22',\n    ],\n    'atom_site_aniso.u_23': [\n        'atom_site_aniso_U_23',\n        'atom_site_anisotrop_U_23',\n    ],\n    'atom_site_aniso.u_33': [\n        'atom_site_aniso_U_33',\n        'atom_site_anisotrop_U_33',\n    ],\n};\n;\n","/**\n * Copyright (c) 2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { Column } from '../../../../mol-data/db';\nimport { DensityServer_Data_Schema } from './density-server';\nvar Schema = Column.Schema;\nconst int = Schema.int;\nexport const Segmentation_Data_Schema = {\n    volume_data_3d_info: DensityServer_Data_Schema.volume_data_3d_info,\n    segmentation_data_table: {\n        set_id: int,\n        segment_id: int,\n    },\n    segmentation_data_3d: {\n        values: int\n    }\n};\n","/**\n * Copyright (c) 2017-2022 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\nimport { parseCifText } from './cif/text/parser';\nimport { parseCifBinary } from './cif/binary/parser';\nimport { toDatabaseCollection, toDatabase } from './cif/schema';\nimport { mmCIF_Schema } from './cif/schema/mmcif';\nimport { CCD_Schema } from './cif/schema/ccd';\nimport { BIRD_Schema } from './cif/schema/bird';\nimport { dic_Schema } from './cif/schema/dic';\nimport { DensityServer_Data_Schema } from './cif/schema/density-server';\nimport { CifCore_Schema, CifCore_Aliases } from './cif/schema/cif-core';\nimport { Segmentation_Data_Schema } from './cif/schema/segmentation';\nexport const CIF = {\n    parse: (data) => typeof data === 'string' ? parseCifText(data) : parseCifBinary(data),\n    parseText: parseCifText,\n    parseBinary: parseCifBinary,\n    toDatabaseCollection,\n    toDatabase,\n    schema: {\n        mmCIF: (frame) => toDatabase(mmCIF_Schema, frame),\n        CCD: (frame) => toDatabase(CCD_Schema, frame),\n        BIRD: (frame) => toDatabase(BIRD_Schema, frame),\n        dic: (frame) => toDatabase(dic_Schema, frame),\n        cifCore: (frame) => toDatabase(CifCore_Schema, frame, CifCore_Aliases),\n        densityServer: (frame) => toDatabase(DensityServer_Data_Schema, frame),\n        segmentation: (frame) => toDatabase(Segmentation_Data_Schema, frame),\n    }\n};\nexport * from './cif/data-model';\n","/**\n * @file Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log } from '../globals'\nimport { defaults } from '../utils'\nimport Streamer from '../streamer/streamer';\n\nexport interface ParserParameters {\n  name: string\n  path: string\n}\n\nclass Parser {\n  streamer: Streamer\n  name: string\n  path: string\n  [k: string]: any\n  \n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    var p = params || {}\n\n    this.streamer = streamer\n\n    this.name = defaults(p.name, '')\n    this.path = defaults(p.path, '')\n  }\n\n  get type () { return '' }\n  get __objName () { return '' }\n  get isBinary () { return false }\n  get isJson () { return false }\n  get isXml () { return false }\n\n  parse () {\n    return this.streamer.read().then(async () => {\n      await this._beforeParse()\n      await this._parse()\n      await this._afterParse()\n      return this[ this.__objName ]\n    })\n  }\n\n  _parse () {}\n\n  _beforeParse () {}\n\n  _afterParse () {\n    if (Debug) Log.log(this[ this.__objName ])\n  }\n}\n\nexport default Parser\n","/**\n * @file Structure Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Structure from '../structure/structure'\nimport StructureBuilder from '../structure/structure-builder'\nimport Streamer from '../streamer/streamer';\n\nexport interface StructureParserParameters extends ParserParameters {\n  firstModelOnly: boolean\n  asTrajectory: boolean\n  cAlphaOnly: boolean\n}\nclass StructureParser extends Parser {\n\n  structure: Structure\n  structureBuilder: StructureBuilder\n\n  constructor (streamer: Streamer, params?: Partial<StructureParserParameters>) {\n    var p = params || {}\n\n    super(streamer, p)\n\n    this.firstModelOnly = defaults(p.firstModelOnly, false)\n    this.asTrajectory = defaults(p.asTrajectory, false)\n    this.cAlphaOnly = defaults(p.cAlphaOnly, false)\n\n    this.structure = new Structure(this.name, this.path)\n    this.structureBuilder = new StructureBuilder(this.structure)\n  }\n\n  get type () { return 'structure' }\n  get __objName () { return 'structure' }\n}\n\nexport default StructureParser\n","/**\n * @file Entity\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from './structure'\nimport {\n    UnknownEntity, PolymerEntity, NonPolymerEntity, MacrolideEntity, WaterEntity\n} from './structure-constants'\nimport ChainProxy from '../proxy/chain-proxy'\n\nfunction entityTypeFromString (string: string) {\n  string = string.toLowerCase()\n  switch (string) {\n    case 'polymer':\n      return PolymerEntity\n    case 'non-polymer':\n      return NonPolymerEntity\n    case 'macrolide':\n      return MacrolideEntity\n    case 'water':\n      return WaterEntity\n    default:\n      return UnknownEntity\n  }\n}\n\nfunction entityFromType (type: number) {\n  switch (type) {\n    case PolymerEntity:\n      return 'polymer'\n    case NonPolymerEntity:\n      return 'non-polymer'\n    case MacrolideEntity:\n      return 'macrolide'\n    case WaterEntity:\n      return 'water'\n    default:\n      return undefined\n  }\n}\n\nexport const EntityTypeString = {\n  'polymer': PolymerEntity,\n  'non-polymer': NonPolymerEntity,\n  'macrolide': MacrolideEntity,\n  'water': WaterEntity,\n}\nexport type EntityTypeString = keyof typeof EntityTypeString\n\n/**\n * Entity of a {@link Structure}\n */\nexport default class Entity {\n  structure: Structure\n  index: number\n  description: string\n  entityType: number\n  chainIndexList: number[]\n\n  /**\n   * @param {Structure} structure - structure the entity belongs to\n   * @param {Integer} index - index within structure.entityList\n   * @param {String} description - entity description\n   * @param {String} type - entity type\n   * @param {Array} chainIndexList - entity chainIndexList\n   */\n  constructor (structure: Structure, index: number, description = '', type?: EntityTypeString, chainIndexList: number[] = []) {\n    this.structure = structure\n    this.index = index\n    this.description = description\n    this.entityType = entityTypeFromString(type || '')\n    this.chainIndexList = chainIndexList\n\n    chainIndexList.forEach(function (ci: number) {\n      structure.chainStore.entityIndex[ ci ] = index\n    })\n  }\n\n  get type () { return entityFromType(this.entityType) }\n\n  getEntityType () {\n    return this.entityType\n  }\n\n  isPolymer () {\n    return this.entityType === PolymerEntity\n  }\n\n  isNonPolymer () {\n    return this.entityType === NonPolymerEntity\n  }\n\n  isMacrolide () {\n    return this.entityType === MacrolideEntity\n  }\n\n  isWater () {\n    return this.entityType === WaterEntity\n  }\n\n  eachChain (callback: (cp: ChainProxy) => any) {\n    const cp = this.structure.getChainProxy()\n\n    this.chainIndexList.forEach(function (index) {\n      cp.index = index\n      callback(cp)\n    })\n  }\n}","/**\n * @file Unitcell\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport { defaults } from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport {\n  uniformArray, uniformArray3, centerArray3\n} from '../math/array-utils'\nimport { UnitcellPicker } from '../utils/picker'\nimport Structure from '../structure/structure'\n\nexport interface UnitcellParams {\n  a: number\n  b: number\n  c: number\n  alpha: number\n  beta: number\n  gamma: number\n  spacegroup: string\n  cartToFrac?: Matrix4\n}\n\nconst DefaultBoxParams = {\n  a: 1,\n  b: 1,\n  c: 1,\n  alpha: 90,\n  beta: 90,\n  gamma: 90,\n  spacegroup: 'P 1'\n}\n\nexport interface UnitcellDataParams {\n  colorValue?: string|number,\n  radius?: number\n}\n\n/**\n * Unitcell class\n */\nclass Unitcell {\n  a: number\n  b: number\n  c: number\n  alpha: number\n  beta: number\n  gamma: number\n\n  spacegroup: string\n\n  cartToFrac = new Matrix4()\n  fracToCart = new Matrix4()\n\n  volume: number\n\n  /**\n   * @param  {Object} params - unitcell parameters\n   * @param  {Number} params.a - length a\n   * @param  {Number} params.b - length b\n   * @param  {Number} params.c - length c\n   * @param  {Number} params.alpha - angle alpha\n   * @param  {Number} params.beta - angle beta\n   * @param  {Number} params.gamma - angle gamma\n   * @param  {String} params.spacegroup - spacegroup\n   * @param  {Matrix4} [params.cartToFrac] - transformation matrix from\n   *                                         cartesian to fractional coordinates\n   * @param  {Matrix4} [params.scale] - alias for `params.cartToFrac`\n   */\n  constructor (params: UnitcellParams = DefaultBoxParams) {\n    this.a = params.a\n    this.b = params.b\n    this.c = params.c\n    this.alpha = params.alpha\n    this.beta = params.beta\n    this.gamma = params.gamma\n    this.spacegroup = params.spacegroup\n\n    const alphaRad = degToRad(this.alpha)\n    const betaRad = degToRad(this.beta)\n    const gammaRad = degToRad(this.gamma)\n    const cosAlpha = Math.cos(alphaRad)\n    const cosBeta = Math.cos(betaRad)\n    const cosGamma = Math.cos(gammaRad)\n    const sinBeta = Math.sin(betaRad)\n    const sinGamma = Math.sin(gammaRad)\n\n    this.volume = (\n      this.a * this.b * this.c *\n      Math.sqrt(\n        1 - cosAlpha * cosAlpha - cosBeta * cosBeta - cosGamma * cosGamma +\n        2.0 * cosAlpha * cosBeta * cosGamma\n      )\n    )\n\n    if (params.cartToFrac === undefined) {\n      // https://github.com/biojava/biojava/blob/master/biojava-structure/src/main/java/org/biojava/nbio/structure/xtal/CrystalCell.java\n\n      const cStar = (this.a * this.b * sinGamma) / this.volume\n      const cosAlphaStar = (\n        (cosBeta * cosGamma - cosAlpha) / (sinBeta * sinGamma)\n      )\n\n      this.fracToCart.set(\n        this.a, 0, 0, 0,\n        this.b * cosGamma, this.b * sinGamma, 0, 0,\n        this.c * cosBeta, -this.c * sinBeta * cosAlphaStar, 1.0 / cStar, 0,\n        0, 0, 0, 1\n      ).transpose()\n      this.cartToFrac.copy(this.fracToCart).invert()\n    } else {\n      this.cartToFrac.copy(params.cartToFrac)\n      this.fracToCart.copy(this.cartToFrac).invert()\n    }\n  }\n\n  getPosition (structure: Structure): Float32Array {\n    const vertexPosition = new Float32Array(3 * 8)\n\n    if (structure.unitcell) {\n      const uc = structure.unitcell\n      const centerFrac = structure.center.clone().applyMatrix4(uc.cartToFrac).floor()\n      const v = new Vector3()\n\n      let cornerOffset = 0\n      const addCorner = function (x: number, y: number, z: number) {\n        v.set(x, y, z)\n          .add(centerFrac)\n          .applyMatrix4(uc.fracToCart)\n          .toArray(vertexPosition as any, cornerOffset)\n        cornerOffset += 3\n      }\n      addCorner(0, 0, 0)\n      addCorner(1, 0, 0)\n      addCorner(0, 1, 0)\n      addCorner(0, 0, 1)\n      addCorner(1, 1, 0)\n      addCorner(1, 0, 1)\n      addCorner(0, 1, 1)\n      addCorner(1, 1, 1)\n    }\n\n    return vertexPosition\n  }\n\n  getCenter (structure: Structure) {\n    return centerArray3(this.getPosition(structure))\n  }\n\n  getData (structure: Structure, params: UnitcellDataParams = {}) {\n    const colorValue = defaults(params.colorValue, 'orange')\n    const radius = defaults(params.radius, Math.cbrt(this.volume) / 200)\n\n    const c = new Color(colorValue)\n    const v = new Vector3()\n\n    const vertexPosition = this.getPosition(structure)\n    const vertexColor = uniformArray3(8, c.r, c.g, c.b)\n    const vertexRadius = uniformArray(8, radius)\n\n    const edgePosition1 = new Float32Array(3 * 12)\n    const edgePosition2 = new Float32Array(3 * 12)\n    const edgeColor = uniformArray3(12, c.r, c.g, c.b)\n    const edgeRadius = uniformArray(12, radius)\n\n    let edgeOffset = 0\n    function addEdge (a: number, b: number) {\n      v.fromArray(vertexPosition as any, a * 3)\n        .toArray(edgePosition1 as any, edgeOffset)\n      v.fromArray(vertexPosition as any, b * 3)\n        .toArray(edgePosition2 as any, edgeOffset)\n      edgeOffset += 3\n    }\n    addEdge(0, 1)\n    addEdge(0, 2)\n    addEdge(0, 3)\n    addEdge(1, 4)\n    addEdge(1, 5)\n    addEdge(2, 6)\n    addEdge(3, 5)\n    addEdge(4, 7)\n    addEdge(5, 7)\n    addEdge(2, 4)\n    addEdge(7, 6)\n    addEdge(3, 6)\n\n    const picker = new UnitcellPicker(this, structure)\n\n    return {\n      vertex: {\n        position: vertexPosition,\n        color: vertexColor,\n        radius: vertexRadius,\n        picking: picker\n      },\n      edge: {\n        position1: edgePosition1,\n        position2: edgePosition2,\n        color: edgeColor,\n        color2: edgeColor,\n        radius: edgeRadius,\n        picking: picker\n      }\n    }\n  }\n}\n\nexport default Unitcell\n","/**\n * @file Pdb Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureParser from './structure-parser'\nimport Entity, { EntityTypeString } from '../structure/entity'\nimport Unitcell, { UnitcellParams } from '../symmetry/unitcell'\nimport Assembly, { AssemblyPart } from '../symmetry/assembly'\nimport { PDBQTSpecialElements, WaterNames } from '../structure/structure-constants'\nimport {\n  assignSecondaryStructure, InferBondsOptions, buildUnitcellAssembly,\n  calculateBonds, calculateChainnames, calculateSecondaryStructure\n} from '../structure/structure-utils'\nimport Streamer from '../streamer/streamer';\nimport { ParserParameters } from './parser';\nimport { NumberArray } from '../types';\nimport { Structure } from '../ngl';\n\n// PDB helix record encoding\nconst HelixTypes: {[k: number]: string} = {\n  1: 'h', // Right-handed alpha (default)\n  2: 'h', // Right-handed omega\n  3: 'i', // Right-handed pi\n  4: 'h', // Right-handed gamma\n  5: 'g', // Right-handed 310\n  6: 'h', // Left-handed alpha\n  7: 'h', // Left-handed omega\n  8: 'h', // Left-handed gamma\n  9: 'h', // 27 ribbon/helix\n  10: 'h', // Polyproline\n  0: 'h' //Used to be ''\n}\n\nconst dAminoAcids = [\n  'DAL', // D-ALANINE\n  'DAR', // D-ARGININE\n  'DSG', // D-ASPARAGINE\n  'DAS', // D-ASPARTIC ACID\n  'DCY', // D-CYSTEINE\n  'DGL', // D-GLUTAMIC ACID\n  'DGN', // D-GLUTAMINE\n  'DHI', // D-HISTIDINE\n  'DIL', // D-ISOLEUCINE\n  'DLE', // D-LEUCINE\n  'DLY', // D-LYSINE\n  'MED', // D-METHIONINE\n  'DPN', // D-PHENYLALANINE\n  'DPR', // D-PROLINE\n  'DSN', // D-SERINE\n  'DTH', // D-THREONINE\n  'DTR', // D-TRYPTOPHAN\n  'DTY', // D-TYROSINE\n  'DVA', // D-VALINE\n\n  'DNE' // D-NORLEUCINE\n\n  // ???  // D-SELENOCYSTEINE\n]\n\nconst entityKeyList = [\n  'MOL_ID', 'MOLECULE', 'CHAIN', 'FRAGMENT', 'SYNONYM',\n  'EC', 'ENGINEERED', 'MUTATION', 'OTHER_DETAILS'\n]\n\nconst reWhitespace = /\\s+/\n\nfunction getModresId (resno: number, chainname?: string, inscode?: string) {\n  let id = `${resno}`\n  if (chainname) id += `:${chainname}`\n  if (inscode) id += `^${inscode}`\n  return id\n}\n\nexport interface PdbParserParameters extends ParserParameters {\n  hex: boolean\n  inferBonds: InferBondsOptions\n}\n\nclass PdbParser extends StructureParser {\n\n  hex: boolean\n  inferBonds: InferBondsOptions\n\n  /**\n   * Create a pdb parser\n   * @param  {Streamer} streamer - streamer object\n   * @param  {Object} params - params object\n   * @param  {Boolean} params.hex - hexadecimal parsing of\n   *                                atom numbers >99.999 and\n   *                                residue numbers >9.999\n   * @param  {InferBondsOptions} params.inferBonds: 'all': use explicit bonds and detect by distance\n   *                                               'auto': If a hetgroup residue has explicit bonds, don't auto-detect\n   *                                               'none': Don't add any bonds automatically\n   * @return {undefined}\n   */\n  constructor (streamer: Streamer, params?: Partial<PdbParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.hex = defaults(p.hex, false)\n    this.inferBonds = defaults(p.inferBonds, 'all')\n  }\n\n  get type () { return 'pdb' }\n\n  _parse () {\n    // http://www.wwpdb.org/documentation/file-format.php\n\n    if (Debug) Log.time('PdbParser._parse ' + this.name)\n\n    let isLegacy = false\n    const headerLine = this.streamer.peekLines(1)[ 0 ]\n    const headerId = headerLine.substr(62, 4)\n    const legacyId = headerLine.substr(72, 4)\n    if (headerId === legacyId && legacyId.trim()) {\n      isLegacy = true\n    }\n\n    const isPqr = this.type === 'pqr'\n    const isPdbqt = this.type === 'pdbqt'\n\n    const s: Structure = this.structure\n    const sb = this.structureBuilder\n\n    const hex = this.hex\n    let serialRadix = 10\n    let resnoRadix = 10\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n    const cAlphaOnly = this.cAlphaOnly\n\n    const frames = s.frames\n    const boxes = s.boxes\n    let doFrames = false\n    let currentFrame: NumberArray, currentCoord: number\n\n    const biomolDict = s.biomolDict\n    let currentBiomol: Assembly\n    let currentPart: AssemblyPart\n    let currentMatrix: Matrix4\n\n    let line, recordName\n    let serial, chainname: string, resno: number, resname: string, occupancy: number\n    let inscode: string, atomname, hetero: boolean, bfactor: number, altloc\n    let formalCharge: number\n\n    let startChain, startResi, startIcode\n    let endChain, endResi, endIcode\n\n    let serialDict: {[k: number]: number} = {}\n    const unitcellDict: Partial<{\n      origx: Matrix4\n      scale: Matrix4\n      a: number\n      b: number\n      c: number\n      alpha: number\n      beta: number\n      gamma: number\n      spacegroup: string\n    }> = {}\n    const bondDict: {[k: string]: boolean} = {}\n\n    const entityDataList: {chainList: string[], name: string}[] = []\n    let currentEntityData: {chainList: string[], name: string}\n    let currentEntityKey: 'MOL_ID'|'MOLECULE'|'CHAIN'|'FRAGMENT'|'SYNONYM'|'EC'|'ENGINEERED'|'MUTATION'|'OTHER_DETAILS'\n    // MOL_ID                 Numbers each component; also used in  SOURCE to associate\n    //                        the information.\n    // MOLECULE               Name of the macromolecule.\n    // CHAIN                  Comma-separated list of chain  identifier(s).\n    // FRAGMENT               Specifies a domain or region of the  molecule.\n    // SYNONYM                Comma-separated list of synonyms for  the MOLECULE.\n    // EC                     The Enzyme Commission number associated  with the molecule.\n    //                        If there is more than one EC number,  they are presented\n    //                        as a comma-separated list.\n    // ENGINEERED             Indicates that the molecule was  produced using\n    //                        recombinant technology or by purely  chemical synthesis.\n    // MUTATION               Indicates if there is a mutation.\n    // OTHER_DETAILS          Additional comments.\n\n    const hetnameDict: {[k: string]: string} = {}\n    const modresDict: {[k: string]: any} = {}\n\n    const chainDict: {[k: string]: number} = {}\n    let chainIdx: number, chainid: string, newChain: boolean\n    let currentChainname: string, currentResno: number, currentResname: string, currentInscode: string\n\n    const seqresDict: {[k: string]: string[]} = {}\n    let currentSeqresChainname: string\n\n    const secStruct = {\n      helices: [] as any[],\n      sheets: [] as any[]\n    }\n    const helices = secStruct.helices\n    const sheets = secStruct.sheets\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 80))\n    if (isPqr || isPdbqt) atomStore.addField('partialCharge', 1, 'float32')\n    if (isPqr) atomStore.addField('radius', 1, 'float32')\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    let idx = 0\n    let modelIdx = 0\n    let pendingStart = true\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        line = lines[ i ]\n        recordName = line.substr(0, 6)\n\n        if (recordName === 'ATOM  ' || recordName === 'HETATM') {\n          // http://www.wwpdb.org/documentation/file-format-content/format33/sect9.html#ATOM\n          // PQR: Field_name Atom_number Atom_name Residue_name Chain_ID Residue_number X Y Z Charge Radius\n\n          if (pendingStart) {\n            if (asTrajectory) {\n              if (doFrames) {\n                currentFrame = new Float32Array(atomStore.count * 3)\n                frames.push(currentFrame)\n              } else {\n                currentFrame = []\n              }\n              currentCoord = 0\n            } else {\n              if (!firstModelOnly) serialDict = {}\n            }\n\n            chainIdx = 1\n            chainid = chainIdx.toString()\n            newChain = true\n\n            pendingStart = false\n          }\n\n          if (firstModelOnly && modelIdx > 0) continue\n\n          let x, y, z, ls: string[], dd = 0\n\n          if (isPqr) {\n            ls = line.split(reWhitespace)\n            dd = ls.length === 10 ? 1 : 0\n\n            atomname = ls[ 2 ]\n            if (cAlphaOnly && atomname !== 'CA') continue\n\n            x = parseFloat(ls[ 6 - dd ])\n            y = parseFloat(ls[ 7 - dd ])\n            z = parseFloat(ls[ 8 - dd ])\n          } else {\n            atomname = line.substr(12, 4).trim()\n            if (cAlphaOnly && atomname !== 'CA') continue\n\n            x = parseFloat(line.substr(30, 8))\n            y = parseFloat(line.substr(38, 8))\n            z = parseFloat(line.substr(46, 8))\n          }\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          let element\n\n          if (isPqr) {\n            serial = parseInt(ls![ 1 ])\n            element = ''\n            hetero = (line[ 0 ] === 'H')\n            chainname = dd ? '' : ls![ 4 ]\n            resno = parseInt(ls![ 5 - dd! ])\n            inscode = ''\n            resname = ls![ 3 ]\n            altloc = ''\n            occupancy = 1.0\n          } else {\n            serial = parseInt(line.substr(6, 5), serialRadix)\n            if (hex && serial === 99999) {\n              serialRadix = 16\n            }\n            hetero = (line[ 0 ] === 'H')\n            chainname = line[ 21 ].trim()\n            resno = parseInt(line.substr(22, 4), resnoRadix)\n            if (hex && resno === 9999) {\n              resnoRadix = 16\n            }\n            inscode = line[ 26 ].trim()\n            resname = line.substr(17, 4).trim() || 'MOL'\n            bfactor = parseFloat(line.substr(60, 6))\n            altloc = line[ 16 ].trim()\n            occupancy = parseFloat(line.substr(54, 6))\n\n            if (!isLegacy) {\n              if (isPdbqt) {\n                element = line.substr(76, 3).trim()\n                // @ts-expect-error TS limitation on narrowing indexes types with `in`\n                if (element in PDBQTSpecialElements) element = PDBQTSpecialElements[element]\n              } else {\n                element = line.substr(76, 2).trim()\n                if (!chainname) {\n                  chainname = line.substr(72, 4).trim() // segid\n                }\n              }\n              // Where specified, formalCharge is of form \"2-\" or \"1+\"\n              formalCharge = parseInt((line.substr(79,1) + line.substr(78, 1)).trim())\n            }\n          }\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = serial\n          atomStore.altloc[ idx ] = altloc.charCodeAt(0)\n          atomStore.occupancy[ idx ] = isNaN(occupancy) ? 0 : occupancy\n\n          if (isPqr) {\n            atomStore.partialCharge![ idx ] = parseFloat(ls![ 9 - dd! ])\n            atomStore.radius[ idx ] = parseFloat(ls![ 10 - dd! ])\n          } else {\n            atomStore.bfactor[ idx ] = isNaN(bfactor) ? 0 : bfactor\n            if (isPdbqt) {\n              atomStore.partialCharge![ idx ] = parseFloat(line.substr(70, 6))\n            }\n            // isFinite check will reject undefined (in legacy case) and NaN values\n            if (isFinite(formalCharge)) {\n              if (!atomStore.formalCharge) {\n                atomStore.addField('formalCharge', 1, 'int8')\n              }\n              atomStore.formalCharge![ idx ] = formalCharge\n            }\n          }\n\n          const modresId = getModresId(resno, chainname, inscode)\n\n          // TODO instead of looking at MODRES look at SEQRES and\n          //      missing residues in REMARK 465\n          if (hetero && !modresDict[modresId] && !dAminoAcids.includes(resname)) {\n            if (currentChainname !== chainname || currentResname !== resname ||\n                (!WaterNames.includes(resname) &&\n                  (currentResno !== resno || currentInscode !== inscode))\n            ) {\n              chainIdx += 1\n              chainid = chainIdx.toString()\n\n              currentResno = resno\n              currentResname = resname\n              currentInscode = inscode\n            }\n          } else if (!newChain && currentChainname !== chainname) {\n            chainIdx += 1\n            chainid = chainIdx.toString()\n          }\n\n          sb.addAtom(modelIdx, chainname, chainid, resname, resno, hetero, undefined, inscode)\n\n          serialDict[ serial ] = idx\n          idx += 1\n          newChain = false\n          currentChainname = chainname\n        } else if (recordName === 'CONECT') {\n          const fromIdx = serialDict[ parseInt(line.substr(6, 5)) ]\n          const pos = [ 11, 16, 21, 26 ]\n          const bondIndex: {[k: number]: number} = {}\n\n          if (fromIdx === undefined) {\n            // Log.log( \"missing CONNECT serial\" );\n            continue\n          }\n\n          for (let j = 0; j < 4; ++j) {\n            let toIdx = parseInt(line.substr(pos[ j ], 5))\n            if (Number.isNaN(toIdx)) continue\n            toIdx = serialDict[ toIdx ]\n            if (toIdx === undefined) {\n              // Log.log( \"missing CONNECT serial\" );\n              continue\n            }/* else if( toIdx < fromIdx ){\n                // likely a duplicate in standard PDB format\n                // but not necessarily, so better remove duplicates\n                // in a pass after parsing (and auto bonding)\n                continue;\n            } */\n\n            if (fromIdx < toIdx) {\n              ap1.index = fromIdx\n              ap2.index = toIdx\n            } else {\n              ap1.index = toIdx\n              ap2.index = fromIdx\n            }\n\n            // interpret records where a 'toIdx' atom is given multiple times\n            // as double/triple bonds, e.g. CONECT 1529 1528 1528 is a double bond\n            if (bondIndex[ toIdx ] !== undefined) {\n              s.bondStore.bondOrder[ bondIndex[ toIdx ] ] += 1\n            } else {\n              const hash = ap1.index + '|' + ap2.index\n              if (bondDict[ hash ] === undefined) {\n                bondDict[ hash ] = true\n                bondIndex[ toIdx ] = s.bondStore.count\n                s.bondStore.addBond(ap1, ap2, 1) // start/assume with single bond\n              }\n            }\n          }\n        } else if (recordName === 'HELIX ') {\n          startChain = line[ 19 ].trim()\n          startResi = parseInt(line.substr(21, 4))\n          startIcode = line[ 25 ].trim()\n          endChain = line[ 31 ].trim()\n          endResi = parseInt(line.substr(33, 4))\n          endIcode = line[ 37 ].trim()\n          let helixType = parseInt(line.substr(39, 1))\n          helixType = (HelixTypes[ helixType ] || HelixTypes[0]).charCodeAt(0)\n          helices.push([\n            startChain, startResi, startIcode,\n            endChain, endResi, endIcode,\n            helixType\n          ])\n        } else if (recordName === 'SHEET ') {\n          startChain = line[ 21 ].trim()\n          startResi = parseInt(line.substr(22, 4))\n          startIcode = line[ 26 ].trim()\n          endChain = line[ 32 ].trim()\n          endResi = parseInt(line.substr(33, 4))\n          endIcode = line[ 37 ].trim()\n          sheets.push([\n            startChain, startResi, startIcode,\n            endChain, endResi, endIcode\n          ])\n        } else if (recordName === 'HETNAM') {\n          hetnameDict[ line.substr(11, 3) ] = line.substr(15).trim()\n        } else if (recordName === 'SEQRES') {\n          const seqresChainname = line[11].trim()\n          if (seqresChainname !== currentSeqresChainname) {\n            seqresDict[ seqresChainname ] = []\n            currentSeqresChainname = seqresChainname\n          }\n          seqresDict[ seqresChainname ].push(\n            ...line.substr(19).trim().split(reWhitespace)\n          )\n        } else if (recordName === 'MODRES') {\n          // MODRES 2SRC PTR A  527  TYR  O-PHOSPHOTYROSINE\n          const resname = line.substr(12, 3).trim()\n          const chainname = line[16].trim()\n          const inscode = line[22].trim()\n          const resno = parseInt(line.substr(18, 4).trim())\n          const id = getModresId(resno, chainname, inscode)\n          modresDict[ id ] = { resname, chainname, inscode, resno }\n        } else if (recordName === 'COMPND') {\n          const comp = line.substr(10, 70).trim()\n          const keyEnd = comp.indexOf(':')\n          const key = comp.substring(0, keyEnd)\n          let value\n\n          if (entityKeyList.includes(key)) {\n            currentEntityKey = key as 'MOL_ID'|'MOLECULE'|'CHAIN'|'FRAGMENT'|'SYNONYM'|'EC'|'ENGINEERED'|'MUTATION'|'OTHER_DETAILS'\n            value = comp.substring(keyEnd + 2)\n          } else {\n            value = comp\n          }\n          value = value.replace(/;$/, '')\n\n          if (currentEntityKey === 'MOL_ID') {\n            currentEntityData = {\n              chainList: [],\n              name: ''\n            }\n            entityDataList.push(currentEntityData)\n          } else if (currentEntityKey === 'MOLECULE') {\n            if (currentEntityData.name) currentEntityData.name += ' '\n            currentEntityData.name += value\n          } else if (currentEntityKey === 'CHAIN') {\n            Array.prototype.push.apply(\n              currentEntityData.chainList,\n              value.split(/\\s*,\\s*/)\n            )\n          }\n        } else if (line.startsWith('TER')) {\n          const cp = s.getChainProxy(s.chainStore.count - 1)\n          chainDict[ cp.chainname ] = cp.index\n          chainIdx += 1\n          chainid = chainIdx.toString()\n          newChain = true\n        } else if (recordName === 'REMARK' && line.substr(7, 3) === '350') {\n          if (line.substr(11, 12) === 'BIOMOLECULE:') {\n            let name = line.substr(23).trim()\n            if (/^(0|[1-9][0-9]*)$/.test(name)) name = 'BU' + name\n\n            currentBiomol = new Assembly(name)\n            biomolDict[ name ] = currentBiomol\n          } else if (line.substr(13, 5) === 'BIOMT') {\n            const biomt = line.split(/\\s+/)\n            const row = parseInt(line[ 18 ]) - 1\n\n            if (row === 0) {\n              currentMatrix = new Matrix4()\n              currentPart.matrixList.push(currentMatrix)\n            }\n\n            const biomtElms = currentMatrix.elements\n\n            biomtElms[ 4 * 0 + row ] = parseFloat(biomt[ 4 ])\n            biomtElms[ 4 * 1 + row ] = parseFloat(biomt[ 5 ])\n            biomtElms[ 4 * 2 + row ] = parseFloat(biomt[ 6 ])\n            biomtElms[ 4 * 3 + row ] = parseFloat(biomt[ 7 ])\n          } else if (\n            line.substr(11, 30) === 'APPLY THE FOLLOWING TO CHAINS:' ||\n            line.substr(11, 30) === '                   AND CHAINS:'\n          ) {\n            if (line.substr(11, 5) === 'APPLY') {\n              currentPart = currentBiomol.addPart()\n            }\n\n            const chainList = line.substr(41, 30).split(',')\n            for (let j = 0, jl = chainList.length; j < jl; ++j) {\n              const c = chainList[ j ].trim()\n              if (c) currentPart.chainList.push(c)\n            }\n          }\n        } else if (recordName === 'HEADER') {\n          s.id = line.substr(62, 4)\n        } else if (recordName === 'TITLE ') {\n          s.title += (s.title ? ' ' : '') + line.substr(10, 70).trim()\n        } else if (recordName === 'MODEL ') {\n          pendingStart = true\n        } else if (recordName === 'ENDMDL' || line.trim() === 'END') {\n          if (pendingStart) continue\n\n          if (asTrajectory && !doFrames) {\n            frames.push(new Float32Array(currentFrame))\n            doFrames = true\n          }\n\n          modelIdx += 1\n          pendingStart = true\n        } else if (line.substr(0, 5) === 'MTRIX') {\n          // ignore 'given' operators\n          if (line[ 59 ] === '1') continue\n\n          if (!currentBiomol || currentBiomol.name !== 'NCS') {\n            const ncsName = 'NCS'\n            currentBiomol = new Assembly(ncsName)\n            biomolDict[ ncsName ] = currentBiomol\n            currentPart = currentBiomol.addPart()\n          }\n\n          const ncs = line.split(/\\s+/)\n          const ncsRow = parseInt(line[ 5 ]) - 1\n\n          if (ncsRow === 0) {\n            currentMatrix = new Matrix4()\n            currentPart.matrixList.push(currentMatrix)\n          }\n\n          const ncsElms = currentMatrix.elements\n\n          ncsElms[ 4 * 0 + ncsRow ] = parseFloat(ncs[ 2 ])\n          ncsElms[ 4 * 1 + ncsRow ] = parseFloat(ncs[ 3 ])\n          ncsElms[ 4 * 2 + ncsRow ] = parseFloat(ncs[ 4 ])\n          ncsElms[ 4 * 3 + ncsRow ] = parseFloat(ncs[ 5 ])\n        } else if (line.substr(0, 5) === 'ORIGX') {\n          if (!unitcellDict.origx) {\n            unitcellDict.origx = new Matrix4()\n          }\n\n          const orgix = line.split(/\\s+/)\n          const origxRow = parseInt(line[ 5 ]) - 1\n          const origxElms = unitcellDict.origx.elements\n\n          origxElms[ 4 * 0 + origxRow ] = parseFloat(orgix[ 1 ])\n          origxElms[ 4 * 1 + origxRow ] = parseFloat(orgix[ 2 ])\n          origxElms[ 4 * 2 + origxRow ] = parseFloat(orgix[ 3 ])\n          origxElms[ 4 * 3 + origxRow ] = parseFloat(orgix[ 4 ])\n        } else if (line.substr(0, 5) === 'SCALE') {\n          if (!unitcellDict.scale) {\n            unitcellDict.scale = new Matrix4()\n          }\n\n          const scale = line.split(/\\s+/)\n          const scaleRow = parseInt(line[ 5 ]) - 1\n          const scaleElms = unitcellDict.scale.elements\n\n          scaleElms[ 4 * 0 + scaleRow ] = parseFloat(scale[ 1 ])\n          scaleElms[ 4 * 1 + scaleRow ] = parseFloat(scale[ 2 ])\n          scaleElms[ 4 * 2 + scaleRow ] = parseFloat(scale[ 3 ])\n          scaleElms[ 4 * 3 + scaleRow ] = parseFloat(scale[ 4 ])\n        } else if (recordName === 'CRYST1') {\n          // CRYST1   55.989   55.989   55.989  90.00  90.00  90.00 P 1           1\n          //  7 - 15       Real(9.3)      a (Angstroms)\n          // 16 - 24       Real(9.3)      b (Angstroms)\n          // 25 - 33       Real(9.3)      c (Angstroms)\n          // 34 - 40       Real(7.2)      alpha         alpha (degrees).\n          // 41 - 47       Real(7.2)      beta          beta (degrees).\n          // 48 - 54       Real(7.2)      gamma         gamma (degrees).\n          // 56 - 66       LString        sGroup        Space group.\n          // 67 - 70       Integer        z             Z value.\n\n          const aLength = parseFloat(line.substr(6, 9))\n          const bLength = parseFloat(line.substr(15, 9))\n          const cLength = parseFloat(line.substr(24, 9))\n\n          const alpha = parseFloat(line.substr(33, 7))\n          const beta = parseFloat(line.substr(40, 7))\n          const gamma = parseFloat(line.substr(47, 7))\n\n          const sGroup = line.substr(55, 11).trim()\n          // const zValue = parseInt( line.substr( 66, 4 ) );\n\n          const box = new Float32Array(9)\n          box[ 0 ] = aLength\n          box[ 4 ] = bLength\n          box[ 8 ] = cLength\n          boxes.push(box)\n\n          if (modelIdx === 0) {\n            unitcellDict.a = aLength\n            unitcellDict.b = bLength\n            unitcellDict.c = cLength\n            unitcellDict.alpha = alpha\n            unitcellDict.beta = beta\n            unitcellDict.gamma = gamma\n            unitcellDict.spacegroup = sGroup\n          }\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n\n    // finalize ensures resname will be defined for all rp.resname\n    // (required in entity handling below)\n    sb.finalize()\n\n    //\n\n    const en = entityDataList.length\n\n    if (en) {\n      s.eachChain(function (cp) {\n        cp.entityIndex = en\n      })\n\n      entityDataList.forEach(function (e, i) {\n        const chainIndexList = e.chainList.map(function (chainname) {\n          return chainDict[ chainname ]\n        })\n        s.entityList.push(new Entity(\n          s, i, e.name, 'polymer', chainIndexList\n        ))\n      })\n\n      let ei = entityDataList.length\n      const rp = s.getResidueProxy()\n      const residueDict: {[k: string]: number[]} = {}\n\n      s.eachChain(function (cp) {\n        if (cp.entityIndex === en) {\n          rp.index = cp.residueOffset\n          if (!residueDict[ rp.resname ]) {\n            residueDict[ rp.resname ] = []\n          }\n          residueDict[ rp.resname ].push(cp.index)\n        }\n      })\n\n      Object.keys(residueDict).forEach(function (resname) {\n        const chainList = residueDict[ resname ]\n        let type: EntityTypeString = 'non-polymer'\n        let name = hetnameDict[ resname ] || resname\n        if (WaterNames.includes(resname)) {\n          name = 'water'\n          type = 'water'\n        }\n        s.entityList.push(new Entity(\n          s, ei, name, type, chainList\n        ))\n        ei += 1\n      })\n    }\n\n    //\n\n    if (unitcellDict.a !== undefined) {\n      s.unitcell = new Unitcell(unitcellDict as UnitcellParams)\n    } else {\n      s.unitcell = undefined\n    }\n\n    if (helices.length || sheets.length) {\n      assignSecondaryStructure(s, secStruct)\n    }\n\n    s.finalizeAtoms()\n    if (!isLegacy) calculateChainnames(s)\n    calculateBonds(s, this.inferBonds)\n    s.finalizeBonds()\n\n    if (!helices.length && !sheets.length) {\n      calculateSecondaryStructure(s)\n    }\n    buildUnitcellAssembly(s)\n\n    if (Debug) Log.timeEnd('PdbParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('pdb', PdbParser)\nParserRegistry.add('pdb1', PdbParser)\nParserRegistry.add('ent', PdbParser)\n\nexport default PdbParser\n\nexport {\n  HelixTypes\n}\n","/**\n * @file ChemComp Map\n * @author Paul Pillot <paul.pillot@tandemai.com>\n * @private\n */\n\nimport Structure from \"../structure/structure\"\nimport { ResidueBonds } from \"../structure/structure-utils\"\n\ninterface ChemCompBonds {\n    atom1: string[]\n    atom2: string[] \n    bondOrders: number[]\n}\n\nclass ChemCompMap {\n    dict: { [resname: string]: { chemCompType: string, bonds?: ChemCompBonds}} = {}\n\n    constructor (readonly structure: Structure) {\n        this.structure = structure\n    }\n\n    add (resname: string, chemCompType: string, bonds?: ChemCompBonds) {\n        this.dict[resname] = { chemCompType }\n        if (bonds) {\n            this.dict[resname].bonds = bonds\n        }\n    }\n\n    addBond (resname: string, atom1: string, atom2: string, bondOrder: number) {\n        const d = this.dict[resname]\n        if (!d) return;\n        if (!d.bonds) {\n            d.bonds = {atom1: [], atom2: [], bondOrders: []}\n        }\n        const b = d.bonds\n        b.atom1.push(atom1)\n        b.atom2.push(atom2)\n        b.bondOrders.push(bondOrder)\n    }\n\n    getBonds (resname: string, atomList: number[]): ResidueBonds | undefined {\n        const bonds = this.dict[resname]?.bonds\n        if (!bonds) return undefined\n\n        const atomMap = this.structure.atomMap\n        const atomsToListindex = new Map<string, number>(atomList.map((val, key) => [ atomMap.get(val)?.atomname, key ]))\n\n        const atomIndices1: number[] = []\n        const atomIndices2: number[] = []\n        const bondOrders: number[] = []\n        let a1\n        let a2\n\n        for (let i = 0; i < bonds.atom1.length; i++ ) {\n            if ((a1 = atomsToListindex.get(bonds.atom1[i])) !== undefined \n                && (a2 = atomsToListindex.get(bonds.atom2[i])) !== undefined) {\n                atomIndices1.push(a1)\n                atomIndices2.push(a2)\n                bondOrders.push(bonds.bondOrders[i])\n            }\n        }\n\n        return {\n            atomIndices1,\n            atomIndices2,\n            bondOrders\n        }\n    }\n}\n\nexport default ChemCompMap\n","/**\n * @file Cif Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Paul Pillot <paul.pillot@tandemai.com>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\nimport { CIF, CifBlock, CifCategories, CifCategory, CifField } from 'molstar/lib/mol-io/reader/cif'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport { HelixTypes } from './pdb-parser'\nimport Entity, { EntityTypeString } from '../structure/entity'\nimport Unitcell, { UnitcellParams } from '../symmetry/unitcell'\nimport Assembly from '../symmetry/assembly'\nimport Selection from '../selection/selection'\nimport {\n  assignResidueTypeBonds, assignSecondaryStructure, buildUnitcellAssembly,\n  calculateBonds, calculateSecondaryStructure\n} from '../structure/structure-utils'\nimport { Structure } from '../ngl';\nimport StructureBuilder from '../structure/structure-builder';\nimport { NumberArray } from '../types'\nimport ChemCompMap from '../store/chemcomp-map'\nimport { uint8ToString } from '../utils'\n\nconst reAtomSymbol = /^\\D{1,2}/ // atom symbol in atom_site_label\n\n// source: dssp man page\nconst cif2dssp = {\n  HELX_RH_AL_P: 'h',  // Alpha helix\n  STRN: 'e',          // Strand. Note Betabridge has the same mmcif code and is encoded with 'e' too instead of 'b'.\n  HELX_RH_3T_P: 'g',  // Helix 3-10\n  HELX_RH_PI_P: 'i',  // Pi Helix (5 turn)\n  HELX_LH_PP_P: 'e',  // Left handed polyproline Helix. Note, should be 'p', but encoded 'h' for consistency with PDB parsing\n  TURN_TY1_P: 't',    // Hydrogen bonded turn\n  BEND: 's',          // Bend\n  OTHER: ' ',         // Coil\n}\n\nconst valueOrder2bondOrder: Record<string, number> = {\n  AROM: 1,      // Same as in Mol2Parser and SdfParser\n  DELO: 2,\n  DIRECTED: 0,  // Ignore\n  DOUB: 2,\n  PI: 0,        // Ignore\n  POLY: 0,      // Ignore\n  QUAD: 4,\n  SING: 1,\n  TRIP: 3\n}\n\nfunction getBondOrder (valueOrder: string) {\n  switch (valueOrder.toLowerCase()) {\n    case '?': // assume single bond\n    case 'sing':\n      return 1\n    case 'doub':\n      return 2\n    case 'trip':\n      return 3\n    case 'quad':\n      return 4\n  }\n  return 0\n}\n\nfunction parseChemComp (cif: CifCategories, structure: Structure, structureBuilder: StructureBuilder) {\n  const atomStore = structure.atomStore\n  const atomMap = structure.atomMap\n\n  let i: number, n: number\n  const cc = cif.chem_comp\n  const cca = cif.chem_comp_atom\n  const ccb = cif.chem_comp_bond\n  let field: CifField | undefined\n\n  if (cc) {\n    if (field = cc.getField('name')) {\n      structure.title = field.str(0)\n    }\n    if (field = cc.getField('id')) {\n      structure.id = field.str(0)\n    }\n  }\n\n  const atomnameDict: {[k: string]: number} = {}\n\n  if (cca) {\n\n    let atomname, element, resname, resno\n    n = cca.rowCount\n    atomStore.resize(n * 2)\n\n    const atomnameField = cca.getField('atom_id')!\n    const elementField = cca.getField('type_symbol')!\n    const resnameField = cca.getField('pdbx_component_comp_id')!\n    const resnoField = cca.getField('pdbx_residue_numbering');\n\n    [\n      ['model_Cartn_x','model_Cartn_y','model_Cartn_z'], \n      ['pdbx_model_Cartn_x_ideal','pdbx_model_Cartn_y_ideal','pdbx_model_Cartn_z_ideal',]\n    ].forEach(([xFieldName, yFieldName, zFieldName], modelindex) => {\n      const xField = cca.getField(xFieldName)!\n      const yField = cca.getField(yFieldName)!\n      const zField = cca.getField(zFieldName)!\n      const atomOffset = modelindex * n\n\n      for (let i = 0; i < n; ++i) {\n        const asindex = i + atomOffset\n        atomStore.growIfFull()\n  \n        atomname = atomnameField?.str(i)\n        element = elementField?.str(i)\n  \n        atomnameDict[ atomname ] = i\n        atomStore.atomTypeId[ asindex ] = atomMap.add(atomname, element)\n  \n        atomStore.x[ asindex ] = xField.float(i)\n        atomStore.y[ asindex ] = yField.float(i)\n        atomStore.z[ asindex ] = zField.float(i)\n        atomStore.serial[ asindex ] = i\n  \n        resname = resnameField.str(i)\n        resno = resnoField?.int(i) ?? 1\n  \n        structureBuilder.addAtom(modelindex, '', '', resname, resno, true)\n      }\n    })\n  }\n\n  if (cca && ccb) {\n    let atomname1, atomname2, bondOrder\n    n = ccb.rowCount\n    const na = cca.rowCount\n\n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n\n    const atomname1Field = ccb.getField('atom_id_1')!\n    const atomname2Field = ccb.getField('atom_id_2')!\n    const bondOrderField = ccb.getField('value_order')!\n\n    for (i = 0; i < n; ++i) {\n      atomname1 = atomname1Field.str(i)\n      atomname2 = atomname2Field.str(i)\n      bondOrder = getBondOrder(bondOrderField.str(i))\n\n      ap1.index = atomnameDict[ atomname1 ]\n      ap2.index = atomnameDict[ atomname2 ]\n      structure.bondStore.growIfFull()\n      structure.bondStore.addBond(ap1, ap2, bondOrder)\n\n      ap1.index += na\n      ap2.index += na\n      structure.bondStore.growIfFull()\n      structure.bondStore.addBond(ap1, ap2, bondOrder)\n    }\n  }\n}\n\nfunction parseCore (cif: CifBlock, structure: Structure, structureBuilder: StructureBuilder) {\n  var atomStore = structure.atomStore\n  var atomMap = structure.atomMap\n\n  if (cif.header) {\n    structure.id = cif.header\n    structure.name = cif.header\n  }\n  \n\n  structure.unitcell = new Unitcell({\n    a: cif.getField('cell_length_a')!.float(0),\n    b: cif.getField('cell_length_b')!.float(0), \n    c: cif.getField('cell_length_c')!.float(0), \n    alpha: cif.getField('cell_angle_alpha')!.float(0), \n    beta: cif.getField('cell_angle_beta')!.float(0), \n    gamma: cif.getField('cell_angle_gamma')!.float(0), \n    spacegroup: cif.getField('symmetry_space_group_name_H-M')!.str(0)\n  })\n\n  const v = new Vector3()\n  const c = new Vector3()\n\n  const typeSymbolField = cif.getField('atom_site_type_symbol')\n  if (!typeSymbolField) return;\n\n  const n = typeSymbolField.rowCount ?? 0\n  const atomnameField = cif.getField('atom_site_type_symbol')!\n  const fractXField = cif.getField('atom_site_fract_x')!\n  const fractYField = cif.getField('atom_site_fract_y')!\n  const fractZField = cif.getField('atom_site_fract_z')!\n  const occField = cif.getField('atom_site_occupancy')\n\n  const typeSymbolMap: Record<string, string> = {}\n\n  for (let i = 0; i < n; ++i) {\n    atomStore.growIfFull()\n\n    const atomname = atomnameField.str(i)\n    const typeSymbol = typeSymbolField!.str(i)\n\n    // typeSymbol can be like `Al2.5+`. Retain element symbol only.\n    let element = typeSymbolMap[typeSymbol]\n    if (!element) {\n      const match = typeSymbol.match(reAtomSymbol)\n      typeSymbolMap[typeSymbol] = element = match?.[0] ?? typeSymbol\n    }\n\n    atomStore.atomTypeId[ i ] = atomMap.add(atomname, element)\n\n    v.set(\n      fractXField.float(i),\n      fractYField.float(i),\n      fractZField.float(i)\n    )\n    v.applyMatrix4(structure.unitcell.fracToCart)\n    c.add(v)\n\n    atomStore.x[ i ] = v.x\n    atomStore.y[ i ] = v.y\n    atomStore.z[ i ] = v.z\n    if (occField) {\n      atomStore.occupancy[ i ] = occField.float(i)\n    }\n    atomStore.serial[ i ] = i\n\n    structureBuilder.addAtom(0, '', '', 'HET', 1, true)\n  }\n\n  c.divideScalar(n)\n  structure.center = c\n  buildUnitcellAssembly(structure)\n\n  const v2 = new Vector3()\n  const v3 = new Vector3()\n  const ml = structure.biomolDict.SUPERCELL.partList[ 0 ].matrixList\n\n  let k = n\n\n  function covalent (idx: number) {\n    return atomMap.get(atomStore.atomTypeId[ idx ]).covalent\n  }\n  const identityMatrix = new Matrix4()\n\n  for (let i = 0; i < n; ++i) {\n    const covalentI = covalent(i)\n\n    v.set(\n      atomStore.x[ i ],\n      atomStore.y[ i ],\n      atomStore.z[ i ]\n    )\n\n    ml.forEach(function (m) {\n      if (identityMatrix.equals(m)) return\n\n      v2.copy(v)\n      v2.applyMatrix4(m)\n\n      for (let j = 0; j < n; ++j) {\n        v3.set(\n          atomStore.x[ j ],\n          atomStore.y[ j ],\n          atomStore.z[ j ]\n        )\n\n        const distSquared = v2.distanceToSquared(v3)\n        const d = covalent(j) + covalentI\n        const d1 = d + 0.3\n        const d2 = d - 0.5\n\n        if (distSquared < (d1 * d1) && distSquared > (d2 * d2)) {\n          atomStore.growIfFull()\n\n          atomStore.atomTypeId[ k ] = atomStore.atomTypeId[ i ]\n          atomStore.x[ k ] = v2.x\n          atomStore.y[ k ] = v2.y\n          atomStore.z[ k ] = v2.z\n          atomStore.occupancy[ k ] = atomStore.occupancy[ i ]\n          atomStore.serial[ k ] = k\n          atomStore.altloc[ k ] = 'A'.charCodeAt(0)\n\n          structureBuilder.addAtom(0, '', '', 'HET', 1, true)\n\n          k += 1\n          return\n        }\n      }\n    })\n  }\n}\n\nfunction processSecondaryStructure (cif: CifCategories, structure: Structure, asymIdDict: {[k: string]: string}) {\n  const helices: [string, number, string, string, number, string, number][] = []\n  const sheets: [string, number, string, string, number, string][] = []\n\n  let i, il, begIcode, endIcode\n\n  // get helices\n  const sc = cif.struct_conf\n\n  if (sc?.fieldNames.includes('pdbx_PDB_helix_class')) {\n    const begIcodeField = sc.getField('pdbx_beg_PDB_ins_code')\n    const endIcodeField = sc.getField('pdbx_end_PDB_ins_code')\n    const helixClassField = sc.getField('pdbx_PDB_helix_class')\n    const begAsymIdField = sc.getField('beg_label_asym_id')\n    const endAsymIdField = sc.getField('end_label_asym_id')\n    const begSeqIdField = sc.getField('beg_auth_seq_id')\n    const endSeqIdField = sc.getField('end_auth_seq_id')\n\n    for (i = 0, il = sc.rowCount; i < il; ++i) {\n      const helixType = helixClassField?.int(i)\n      if (Number.isFinite(helixType)) {\n        begIcode = begIcodeField?.str(i) ?? ''\n        endIcode = endIcodeField?.str(i) ?? ''\n        helices.push([\n          asymIdDict[ begAsymIdField!.str(i) ],\n          begSeqIdField!.int(i),\n          begIcode,\n          asymIdDict[ endAsymIdField!.str(i) ],\n          endSeqIdField!.int(i),\n          endIcode,\n          (HelixTypes[ helixType! ] || HelixTypes[0]).charCodeAt(0)\n        ])\n      }\n    }\n  }\n  // AlphaFold mmCifs have their secondary structures assigned from DSSP \n  // entirely defined in the `struct_conf` category  \n  else if (sc?.fieldNames.includes('conf_type_id')) {\n    const conftypeField = sc.getField('conf_type_id')!\n    const begIcodeField = sc.getField('pdbx_beg_PDB_ins_code')\n    const endIcodeField = sc.getField('pdbx_end_PDB_ins_code')\n    const begAsymIdField = sc.getField('beg_label_asym_id')\n    const endAsymIdField = sc.getField('end_label_asym_id')\n    const begSeqIdField = sc.getField('beg_auth_seq_id')\n    const endSeqIdField = sc.getField('end_auth_seq_id')\n    let dsspcode: string\n\n    for (i = 0, il = sc.rowCount; i < il; ++i) {\n      const conftype = conftypeField.str(i) as keyof typeof cif2dssp\n      if (dsspcode = cif2dssp[conftype]) {\n        begIcode = begIcodeField?.str(i) ?? ''\n        endIcode = endIcodeField?.str(i) ?? ''\n\n        if (dsspcode === 'h' || dsspcode === 'g' || dsspcode === 'i') {\n          helices.push([\n            asymIdDict[ begAsymIdField!.str(i) ],\n            begSeqIdField!.int(i),\n            begIcode,\n            asymIdDict[ endAsymIdField!.str(i) ],\n            endSeqIdField!.int(i),\n            endIcode,\n            dsspcode.charCodeAt(0)\n          ])\n        } else if (dsspcode === 'e') {\n          sheets.push([\n            asymIdDict[ begAsymIdField!.str(i) ],\n            begSeqIdField!.int(i),\n            begIcode,\n            asymIdDict[ endAsymIdField!.str(i) ],\n            endSeqIdField!.int(i),\n            endIcode\n          ])\n        }\n      }\n    }\n  }\n\n  // get sheets\n  const ssr = cif.struct_sheet_range\n\n  if (ssr && sheets.length === 0) {\n    const begIcodeField = ssr.getField('pdbx_beg_PDB_ins_code')\n    const endIcodeField = ssr.getField('pdbx_end_PDB_ins_code')\n    const begAsymIdField = ssr.getField('beg_label_asym_id')\n    const endAsymIdField = ssr.getField('end_label_asym_id')\n    const begSeqIdField = ssr.getField('beg_auth_seq_id')\n    const endSeqIdField = ssr.getField('end_auth_seq_id')\n\n    for (i = 0, il = ssr.rowCount; i < il; ++i) {\n      begIcode = begIcodeField?.str(i) ?? ''\n      endIcode = endIcodeField?.str(i) ?? ''\n      sheets.push([\n        asymIdDict[ begAsymIdField!.str(i) ],\n          begSeqIdField!.int(i),\n          begIcode,\n          asymIdDict[ endAsymIdField!.str(i) ],\n          endSeqIdField!.int(i),\n          endIcode\n      ])\n    }\n  }\n\n  if (sc || ssr) {\n    return {\n      helices: helices,\n      sheets: sheets\n    }\n  } else {\n    return false\n  }\n}\n\nfunction processSymmetry (cif: CifCategories, structure: Structure, asymIdDict: {[k: string]: string}) {\n  // biomol & ncs processing\n  const operDict: {[k: string]: Matrix4} = {}\n  const biomolDict = structure.biomolDict\n\n  if (cif.pdbx_struct_oper_list) {\n    const biomolOp = cif.pdbx_struct_oper_list\n\n    const idField = biomolOp.getField('id')!\n    const mat_1_1Field = biomolOp.getField('matrix[1][1]')!\n    const mat_1_2Field = biomolOp.getField('matrix[1][2]')!\n    const mat_1_3Field = biomolOp.getField('matrix[1][3]')!\n    const mat_2_1Field = biomolOp.getField('matrix[2][1]')!\n    const mat_2_2Field = biomolOp.getField('matrix[2][2]')!\n    const mat_2_3Field = biomolOp.getField('matrix[2][3]')!\n    const mat_3_1Field = biomolOp.getField('matrix[3][1]')!\n    const mat_3_2Field = biomolOp.getField('matrix[3][2]')!\n    const mat_3_3Field = biomolOp.getField('matrix[3][3]')!\n    const vec1Field = biomolOp.getField('vector[1]')!\n    const vec2Field = biomolOp.getField('vector[2]')!\n    const vec3Field = biomolOp.getField('vector[3]')!\n    \n    \n    for (let i = 0; i < biomolOp.rowCount; i ++) {\n      const m = new Matrix4()\n      const elms = m.elements\n\n      elms[ 0 ] = mat_1_1Field.float(i)\n      elms[ 1 ] = mat_1_2Field.float(i)\n      elms[ 2 ] = mat_1_3Field.float(i)\n      \n      elms[ 4 ] = mat_2_1Field.float(i)\n      elms[ 5 ] = mat_2_2Field.float(i)\n      elms[ 6 ] = mat_2_3Field.float(i)\n\n      elms[ 8 ] = mat_3_1Field.float(i)\n      elms[ 9 ] = mat_3_2Field.float(i)\n      elms[ 10 ] = mat_3_3Field.float(i)\n\n      elms[ 3 ] = vec1Field.float(i)\n      elms[ 7 ] = vec2Field.float(i)\n      elms[ 11 ] = vec3Field.float(i)\n\n      m.transpose()\n\n      operDict[ idField.str(i) ] = m\n    }\n  }\n\n  if (cif.pdbx_struct_assembly_gen) {\n    const gen = cif.pdbx_struct_assembly_gen\n\n    const getMatrixDict = function (expr: string) {\n      const matDict: {[k: string]: Matrix4} = {}\n\n      const l = expr.replace(/[()']/g, '').split(',')\n\n      l.forEach(function (e) {\n        if (e.includes('-')) {\n          var es = e.split('-')\n\n          var j = parseInt(es[ 0 ])\n          var m = parseInt(es[ 1 ])\n\n          for (; j <= m; ++j) {\n            matDict[ j ] = operDict[ j ]\n          }\n        } else {\n          matDict[ e ] = operDict[ e ]\n        }\n      })\n\n      return matDict\n    }\n\n    const assemblyIdField = gen.getField('assembly_id')!\n    const operExpressionField = gen.getField('oper_expression')!\n    const asymIds = gen.getField('asym_id_list')!\n\n    for (let i = 0; i < gen.rowCount; i++) {\n      const id = assemblyIdField.int(i)\n      let md:{[k: string]: Matrix4} = {}\n      let oe = operExpressionField.str(i).replace(/['\"]\\(|['\"]/g, '')\n\n      // Example: '(1,2,6,10,23,24)' and '(X0)(1-60)' in 6CGV\n      if (oe.includes(')(') || oe.indexOf('(') > 0) {\n        const [oe1, oe2] = oe.split('(').filter(piece => !!piece)\n\n        const md1 = getMatrixDict(oe1)\n        const md2 = getMatrixDict(oe2)\n\n        Object.keys(md1).forEach(function (k1) {\n          Object.keys(md2).forEach(function (k2) {\n            const mat = new Matrix4()\n\n            mat.multiplyMatrices(md1[ k1 ], md2[ k2 ])\n            md[ k1 + 'x' + k2 ] = mat\n          })\n        })\n      } else {\n        md = getMatrixDict(oe)\n      }\n\n      const matrixList = []\n      for (let k in md) {\n        matrixList.push(md[ k ])\n      }\n\n      let name = '' + id\n      if (/^(0|[1-9][0-9]*)$/.test(name)) name = 'BU' + name\n\n      const chainList = asymIds.str(i).split(',').map(ch => asymIdDict[ch])\n\n      if (biomolDict[ name ] === undefined) {\n        biomolDict[ name ] = new Assembly(name)\n      }\n      biomolDict[ name ].addPart(matrixList, chainList)\n    }\n  }\n\n  // non-crystallographic symmetry operations\n  if (cif.struct_ncs_oper) {\n    const ncsOp = cif.struct_ncs_oper\n\n    const  ncsName = 'NCS'\n    biomolDict[ ncsName ] = new Assembly(ncsName)\n    const ncsPart = biomolDict[ ncsName ].addPart()\n\n    const codeField = ncsOp.getField('code')!\n    const mat_1_1Field = ncsOp.getField('matrix[1][1]')!\n    const mat_1_2Field = ncsOp.getField('matrix[1][2]')!\n    const mat_1_3Field = ncsOp.getField('matrix[1][3]')!\n    const mat_2_1Field = ncsOp.getField('matrix[2][1]')!\n    const mat_2_2Field = ncsOp.getField('matrix[2][2]')!\n    const mat_2_3Field = ncsOp.getField('matrix[2][3]')!\n    const mat_3_1Field = ncsOp.getField('matrix[3][1]')!\n    const mat_3_2Field = ncsOp.getField('matrix[3][2]')!\n    const mat_3_3Field = ncsOp.getField('matrix[3][3]')!\n    const vec1Field = ncsOp.getField('vector[1]')!\n    const vec2Field = ncsOp.getField('vector[2]')!\n    const vec3Field = ncsOp.getField('vector[3]')!\n\n    for (let i = 0; i < ncsOp.rowCount; i++) {\n      // ignore 'given' operators\n      if (codeField.str(i) === 'given') return\n\n      const m = new Matrix4()\n      const elms = m.elements\n\n      elms[ 0 ] = mat_1_1Field.float(i)\n      elms[ 1 ] = mat_1_2Field.float(i)\n      elms[ 2 ] = mat_1_3Field.float(i)\n      \n      elms[ 4 ] = mat_2_1Field.float(i)\n      elms[ 5 ] = mat_2_2Field.float(i)\n      elms[ 6 ] = mat_2_3Field.float(i)\n\n      elms[ 8 ] = mat_3_1Field.float(i)\n      elms[ 9 ] = mat_3_2Field.float(i)\n      elms[ 10 ] = mat_3_3Field.float(i)\n\n      elms[ 3 ] = vec1Field.float(i)\n      elms[ 7 ] = vec2Field.float(i)\n      elms[ 11 ] = vec3Field.float(i)\n\n      m.transpose()\n\n      ncsPart.matrixList.push(m)\n    }\n\n    if (ncsPart.matrixList.length === 0) {\n      delete biomolDict[ ncsName ]\n    }\n  }\n\n  // cell & symmetry\n  const unitcellDict: {\n    a?: number\n    b?: number\n    c?: number\n    alpha?: number\n    beta?: number\n    gamma?: number\n    spacegroup?: string\n    origx?: Matrix4\n    scale?: Matrix4\n  } = {}\n\n  if (cif.cell) {\n    const cell = cif.cell\n\n    const a = cell.getField('length_a')!.float(0)\n    const b = cell.getField('length_b')!.float(0)\n    const c = cell.getField('length_c')!.float(0)\n\n    const box = new Float32Array(9)\n    box[ 0 ] = a\n    box[ 4 ] = b\n    box[ 8 ] = c\n    structure.boxes.push(box)\n\n    unitcellDict.a = a\n    unitcellDict.b = b\n    unitcellDict.c = c\n    unitcellDict.alpha = cell.getField('angle_alpha')!.float(0)\n    unitcellDict.beta = cell.getField('angle_beta')!.float(0)\n    unitcellDict.gamma = cell.getField('angle_gamma')!.float(0)\n  }\n\n  if (cif.symmetry) {\n    unitcellDict.spacegroup = cif.symmetry.getField('space_group_name_H-M')!.str(0)\n    \n  }\n\n  // origx\n  const origx = new Matrix4()\n\n  if (cif.database_PDB_matrix) {\n    const origxMat = cif.database_PDB_matrix\n    const origxElms = origx.elements\n\n    const mat_1_1Field = origxMat.getField('origx[1][1]')!\n    const mat_1_2Field = origxMat.getField('origx[1][2]')!\n    const mat_1_3Field = origxMat.getField('origx[1][3]')!\n    const mat_2_1Field = origxMat.getField('origx[2][1]')!\n    const mat_2_2Field = origxMat.getField('origx[2][2]')!\n    const mat_2_3Field = origxMat.getField('origx[2][3]')!\n    const mat_3_1Field = origxMat.getField('origx[3][1]')!\n    const mat_3_2Field = origxMat.getField('origx[3][2]')!\n    const mat_3_3Field = origxMat.getField('origx[3][3]')!\n    const vec1Field = origxMat.getField('origx_vector[1]')!\n    const vec2Field = origxMat.getField('origx_vector[2]')!\n    const vec3Field = origxMat.getField('origx_vector[3]')!\n\n    origxElms[ 0 ] = mat_1_1Field.float(0)\n    origxElms[ 1 ] = mat_1_2Field.float(0)\n    origxElms[ 2 ] = mat_1_3Field.float(0)\n\n    origxElms[ 4 ] = mat_2_1Field.float(0)\n    origxElms[ 5 ] = mat_2_2Field.float(0)\n    origxElms[ 6 ] = mat_2_3Field.float(0)\n\n    origxElms[ 8 ] = mat_3_1Field.float(0)\n    origxElms[ 9 ] = mat_3_2Field.float(0)\n    origxElms[ 10 ] = mat_3_3Field.float(0)\n\n    origxElms[ 3 ] = vec1Field.float(0)\n    origxElms[ 7 ] = vec2Field.float(0)\n    origxElms[ 11 ] = vec3Field.float(0)\n\n    origx.transpose()\n\n    unitcellDict.origx = origx\n  }\n\n  // scale\n  const scale = new Matrix4()\n\n  if (cif.atom_sites) {\n    const scaleMat = cif.atom_sites\n    const scaleElms = scale.elements\n\n    const mat_1_1Field = scaleMat.getField('fract_transf_matrix[1][1]')!\n    const mat_1_2Field = scaleMat.getField('fract_transf_matrix[1][2]')!\n    const mat_1_3Field = scaleMat.getField('fract_transf_matrix[1][3]')!\n    const mat_2_1Field = scaleMat.getField('fract_transf_matrix[2][1]')!\n    const mat_2_2Field = scaleMat.getField('fract_transf_matrix[2][2]')!\n    const mat_2_3Field = scaleMat.getField('fract_transf_matrix[2][3]')!\n    const mat_3_1Field = scaleMat.getField('fract_transf_matrix[3][1]')!\n    const mat_3_2Field = scaleMat.getField('fract_transf_matrix[3][2]')!\n    const mat_3_3Field = scaleMat.getField('fract_transf_matrix[3][3]')!\n    const vec1Field = scaleMat.getField('fract_transf_vector[1]')!\n    const vec2Field = scaleMat.getField('fract_transf_vector[2]')!\n    const vec3Field = scaleMat.getField('fract_transf_vector[3]')!\n\n    scaleElms[ 0 ] = mat_1_1Field.float(0)\n    scaleElms[ 1 ] = mat_1_2Field.float(0)\n    scaleElms[ 2 ] = mat_1_3Field.float(0)\n\n    scaleElms[ 4 ] = mat_2_1Field.float(0)\n    scaleElms[ 5 ] = mat_2_2Field.float(0)\n    scaleElms[ 6 ] = mat_2_3Field.float(0)\n\n    scaleElms[ 8 ] = mat_3_1Field.float(0)\n    scaleElms[ 9 ] = mat_3_2Field.float(0)\n    scaleElms[ 10 ] = mat_3_3Field.float(0)\n\n    scaleElms[ 3 ] = vec1Field.float(0)\n    scaleElms[ 7 ] = vec2Field.float(0)\n    scaleElms[ 11 ] = vec3Field.float(0)\n\n    scale.transpose()\n\n    unitcellDict.scale = scale\n  }\n\n  if (unitcellDict.a !== undefined) {\n    structure.unitcell = new Unitcell(unitcellDict as UnitcellParams)\n  } else {\n    structure.unitcell = undefined\n  }\n}\n\nfunction processConnections (cif: CifCategories, structure: Structure, asymIdDict: {[k: string]: string}) {\n  // add connections\n  const sc = cif.struct_conn\n\n  if (sc) {\n    \n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n    const atomIndicesCache: {[k: string]: Uint32Array|undefined} = {}\n\n    const connTypeIdField = sc.getField('conn_type_id')!\n    const ptnr1SymmetryField = sc.getField('ptnr1_symmetry')!\n    const ptnr1InsCodeField = sc.getField('pdbx_ptnr1_PDB_ins_code')!\n    const ptnr1AltLocField = sc.getField('pdbx_ptnr1_label_alt_id')!\n    const ptnr1SeqIdField = sc.getField('ptnr1_auth_seq_id')!\n    const ptnr1AsymIdField = sc.getField('ptnr1_label_asym_id')!\n    const ptnr1AtomIdField = sc.getField('ptnr1_label_atom_id')!\n    const ptnr2SymmetryField = sc.getField('ptnr2_symmetry')!\n    const ptnr2InsCodeField = sc.getField('pdbx_ptnr2_PDB_ins_code')!\n    const ptnr2AltLocField = sc.getField('pdbx_ptnr2_label_alt_id')!\n    const ptnr2SeqIdField = sc.getField('ptnr2_auth_seq_id')!\n    const ptnr2AsymIdField = sc.getField('ptnr2_label_asym_id')!\n    const ptnr2AtomIdField = sc.getField('ptnr2_label_atom_id')!\n    const bondOrderField = sc.getField('pdbx_value_order')!\n    \n\n    for (let i = 0, il = sc.rowCount; i < il; ++i) {\n      // ignore:\n      // hydrog - hydrogen bond\n      // mismat - mismatched base pairs\n      // saltbr - ionic interaction\n\n      const connTypeId = connTypeIdField.str(i)\n      if (connTypeId === 'hydrog' ||\n          connTypeId === 'mismat' ||\n          connTypeId === 'saltbr') continue\n\n      // ignore bonds between symmetry mates\n      if (ptnr1SymmetryField.str(i) !== '1_555' ||\n          ptnr2SymmetryField.str(i) !== '1_555') continue\n\n      // process:\n      // covale - covalent bond\n      // covale_base -\n      //      covalent modification of a nucleotide base\n      // covale_phosphate -\n      //      covalent modification of a nucleotide phosphate\n      // covale_sugar -\n      //      covalent modification of a nucleotide sugar\n      // disulf - disulfide bridge\n      // metalc - metal coordination\n      // modres - covalent residue modification\n\n      const inscode1 = ptnr1InsCodeField.str(i)\n      const altloc1 = ptnr1AltLocField.str(i)\n      const sele1 = (\n        ptnr1SeqIdField.str(i) +\n        (inscode1 ? ('^' + inscode1) : '') +\n        ':' + asymIdDict[ ptnr1AsymIdField.str(i) ] +\n        '.' + ptnr1AtomIdField.str(i) +\n        (altloc1 ? ('%' + altloc1) : '')\n      )\n      let atomIndices1 = atomIndicesCache[ sele1 ]\n      if (!atomIndices1) {\n        const selection1 = new Selection(sele1)\n        if (selection1.selection.error) {\n          if (Debug) Log.warn('invalid selection for connection', sele1)\n          continue\n        }\n        atomIndices1 = structure.getAtomIndices(selection1)\n        atomIndicesCache[ sele1 ] = atomIndices1\n      }\n\n      const inscode2 = ptnr2InsCodeField.str(i)\n      const altloc2 = ptnr2AltLocField.str(i)\n      const sele2 = (\n        ptnr2SeqIdField.str(i) +\n        (inscode2 ? ('^' + inscode2) : '') +\n        ':' + asymIdDict[ ptnr2AsymIdField.str(i) ] +\n        '.' + ptnr2AtomIdField.str(i) +\n        (altloc2 ? ('%' + altloc2) : '')\n      )\n      let atomIndices2 = atomIndicesCache[ sele2 ]\n      if (!atomIndices2) {\n        const selection2 = new Selection(sele2)\n        if (selection2.selection.error) {\n          if (Debug) Log.warn('invalid selection for connection', sele2)\n          continue\n        }\n        atomIndices2 = structure.getAtomIndices(selection2)\n        atomIndicesCache[ sele2 ] = atomIndices2\n      }\n\n      // cases with more than one atom per selection\n      // - #altloc1 to #altloc2\n      // - #model to #model\n      // - #altloc1 * #model to #altloc2 * #model\n\n      var k = atomIndices1!.length\n      var l = atomIndices2!.length\n\n      if (k > l) {\n        [ k , l ] = [ l , k ];\n        [atomIndices1, atomIndices2] = [atomIndices2, atomIndices1]\n      }\n\n      // console.log( k, l );\n\n      if (k === 0 || l === 0) {\n        if (Debug) Log.warn('no atoms found for', sele1, sele2)\n        continue\n      }\n\n      for (let j = 0; j < l; ++j) {\n        ap1.index = atomIndices1![ j % k ]\n        ap2.index = atomIndices2![ j ]\n\n        if (ap1 && ap2) {\n          structure.bondStore.addBond(\n            ap1, ap2, getBondOrder(bondOrderField.str(i))\n          )\n        } else {\n          Log.log('atoms for connection not found')\n        }\n      }\n    }\n  }\n}\n\nfunction processEntities (cif: CifCategories, structure: Structure, chainIndexDict: {[k: string]: Set<number>}) {\n  if (cif.entity) {\n    const e = cif.entity\n\n    const idField = e.getField('id')!\n    const descriptionField = e.getField('pdbx_description')!\n    const typeField = e.getField('type')!\n    const n = e.rowCount\n    for (let i = 0; i < n; ++i) { \n      // 7a4p has a missing entity in chainIndexDict (entity 20 has no coordinates)\n      const chainIndexList: number[] = Array.from(chainIndexDict[ idField.int(i) ] ?? [])\n      structure.entityList[ i ] = new Entity(\n        structure, i, descriptionField?.str(i), typeField.str(i) as EntityTypeString, chainIndexList\n      )\n    }\n  }\n}\n\n//\n\nclass CifParser extends StructureParser {\n  get type () { return 'cif' }\n  get isBinary () { return false }\n\n  async _parse () {\n    // http://mmcif.wwpdb.org/\n\n    Log.time('CifParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n    //@TODO add back the cAlphaOnly property\n    //const cAlphaOnly = this.cAlphaOnly\n\n    const frames = s.frames\n    let currentFrame: NumberArray\n    let currentCoord: number\n    \n    // CIF library expects a string for regular cif/mmCIF files and an ArrayBuffer for binary CIF files.\n    // As compressed CIF files are returned as an ArrayBuffer from Streamer.read(), they need to be \n    // explicitly converted to a string.\n    const data = this.isBinary\n      ? CIF.parseBinary(this.streamer.data)\n      : CIF.parseText(this.streamer.compressed \n        ? uint8ToString(this.streamer.data)\n        : this.streamer.data\n      )\n    const parsed = await data.run()\n    if (parsed.isError) {\n      throw parsed;\n    }\n\n    const cif = parsed.result.blocks[0]\n\n    // PDB chemcomp dictionary schema\n    // (This is how the PDB dictionary for ligands is distributed)\n    if ('chem_comp' in cif.categories \n      && 'chem_comp_atom' in cif.categories \n      && !('struct' in cif.categories)\n    ) {\n      parseChemComp(cif.categories, s, sb)\n      sb.finalize()\n      s.finalizeAtoms()\n      s.finalizeBonds()\n      assignResidueTypeBonds(s)\n    } \n    // IUCr core CIF schema\n    // (This format is used in IUCr publications, or databases such as COD)\n    else if ('atom_site_type_symbol' in cif.categories && 'atom_site_label' in cif.categories && 'atom_site_fract_x' in cif.categories) {\n      parseCore(cif, s, sb)\n      sb.finalize()\n      s.finalizeAtoms()\n      calculateBonds(s)\n      s.finalizeBonds()\n      // assignResidueTypeBonds( s );\n    } \n    // PDBx/mmCIF schema\n    // (Preferred format from wwPDB for macromolecular data. PDBe also distributes \n    // \"Updated mmCif files\" that notably contain intra-residue connectivities - chem_comp_bond records -)\n    else {\n      const asymIdDict: {[k: string]: string} = {}\n      const chainIndexDict:{[k: string]: Set<number>} = {}\n      const atomMap = s.atomMap\n      const atomStore = s.atomStore\n\n      // Find atom count (depending on asTrajectory and firstModelOnly flags)\n      const atomSite = cif.categories.atom_site\n      let numAtoms = atomSite.rowCount\n      const modelNumField = atomSite.getField('pdbx_PDB_model_num')\n      const hasSingleModel = modelNumField?.areValuesEqual(0, numAtoms - 1) ?? true\n\n      if (!hasSingleModel && (asTrajectory || firstModelOnly)) {\n        const firstModel = modelNumField!.int(0)\n        for (let i = 0 ; i < numAtoms; i++) {\n          if (modelNumField!.int(i) > firstModel) {\n            numAtoms = i\n            break;\n          }\n        }\n      }\n\n      // Collect chem_comp data for intra-residues connectivity if present\n      s.chemCompMap = new ChemCompMap(s)\n      const cc = cif.categories.chem_comp\n      let resnameField = cc.getField('id')!\n      const ccTypeField = cc.getField('type')!\n\n      for (let i = 0; i < cc.rowCount; i++) {\n        s.chemCompMap.add(resnameField.str(i), ccTypeField.str(i).toUpperCase())\n      }\n\n      // \"Updated\" mmcif files from PDBe also contain connectivity from PDB chemcomp dictionary\n      if (cif.categoryNames.includes('chem_comp_bond')) {\n        const ccb = cif.categories.chem_comp_bond\n        resnameField = ccb.getField('comp_id')!\n        const atom1Field = ccb.getField('atom_id_1')!\n        const atom2Field = ccb.getField('atom_id_2')!\n        const bondOrderField = ccb.getField('value_order')!\n\n        for (let i = 0; i < ccb.rowCount; i++) {\n          const order = valueOrder2bondOrder[bondOrderField.str(i)]\n          if (!order) continue;\n          s.chemCompMap.addBond(resnameField.str(i), atom1Field.str(i), atom2Field.str(i), order)\n        }\n      }\n\n      const getFieldAsFloat32 = (cat: CifCategory, field: string, endAtom: number) => {\n        const cifField = cat.getField(field)\n        if (!cifField) {\n          return new Float32Array(endAtom)\n        }\n        return cifField.toFloatArray({array: Float32Array, start:0, end: endAtom}) as unknown as Float32Array\n      }\n\n      atomStore.resize(numAtoms)\n      atomStore.x = getFieldAsFloat32(atomSite, 'Cartn_x', numAtoms)\n      atomStore.y = getFieldAsFloat32(atomSite, 'Cartn_y', numAtoms)\n      atomStore.z = getFieldAsFloat32(atomSite, 'Cartn_z', numAtoms)\n      atomStore.serial = atomSite.getField('id')!.toIntArray({start: 0, end: numAtoms}) as unknown as Int32Array\n      atomStore.bfactor = getFieldAsFloat32(atomSite, 'B_iso_or_equiv', numAtoms)\n      atomStore.occupancy = getFieldAsFloat32(atomSite, 'occupancy', numAtoms)\n      \n      const altlocField = atomSite.getField('label_alt_id')\n      if (altlocField?.isDefined) {\n        atomStore.altloc = Uint8Array.from(altlocField.toStringArray(), c => c.charCodeAt(0))\n      }\n      \n      const atomnameField = atomSite.getField('label_atom_id')\n      const elementField = atomSite.getField('type_symbol')\n      resnameField = atomSite.getField('label_comp_id')!\n      const resnoField = atomSite.getField('auth_seq_id') ?? atomSite.getField('label_seq_id')\n      const inscodeField = atomSite.getField('pdbx_PDB_ins_code')\n      const chainnameField = atomSite.getField('auth_asym_id')\n      const chainidField = atomSite.getField('label_asym_id')\n      const heteroField = atomSite.getField('group_PDB')\n      const entityIdField = atomSite.getField('label_entity_id')\n      \n\n      for (let row = 0; row < numAtoms; row ++) {\n        const modelNum = modelNumField?.int(row) ?? 1\n        const chainname = chainnameField?.str(row) ?? ''\n        const chainid = chainidField?.str(row) ?? ''\n        const resname = resnameField?.str(row) ?? ''\n        const resno = resnoField?.int(row) ?? 0\n        const hetero = heteroField?.str(row)[0] === 'H'\n        const inscode = inscodeField?.str(row) ?? ''\n        const entityId = entityIdField?.int(row) ?? 1\n\n        atomStore.atomTypeId[ row ] = atomMap.add(atomnameField?.str(row) || '', elementField?.str(row))\n        sb.addAtom(modelNum - 1, chainname, chainid, resname, resno, hetero, undefined, inscode)\n\n        // chainname mapping: label_asym_id -> auth_asym_id\n        asymIdDict[ chainid ] = chainname\n\n        // entity mapping: chainIndex -> label_entity_id\n        if (!chainIndexDict[ entityId ]) {\n          chainIndexDict[ entityId ] = new Set()\n        }\n        chainIndexDict[ entityId ].add(s.chainStore.count - 1)\n\n      }\n\n      if (asTrajectory) {\n        const nbFrames = (atomSite.rowCount / numAtoms) | 0\n        const xField = atomSite.getField('Cartn_x')!\n        const yField = atomSite.getField('Cartn_y')!\n        const zField = atomSite.getField('Cartn_z')!\n        for (let f  = 0; f < nbFrames; f ++) {\n          currentFrame = new Float32Array(numAtoms * 3);\n          const start = f * numAtoms\n          const end = start + numAtoms\n          currentCoord = 0\n          for (let i = start; i < end; i++) {\n            currentFrame[ currentCoord + 0 ] = xField.float(i)\n            currentFrame[ currentCoord + 1 ] = yField.float(i)\n            currentFrame[ currentCoord + 2 ] = zField.float(i)\n\n            currentCoord += 3\n          }\n          frames.push(currentFrame)\n        }\n      }\n\n      const secStruct = processSecondaryStructure(cif.categories, s, asymIdDict)\n      processSymmetry(cif.categories, s, asymIdDict)\n      processConnections(cif.categories, s, asymIdDict)\n      processEntities(cif.categories, s, chainIndexDict)\n\n      let field: CifField | undefined\n      let valData: string | number | undefined\n\n      if (field = cif.categories.struct?.getField('title')) {\n        if (valData = field.str(0)) s.title = valData\n      }\n      if (field = cif.categories.entry?.getField('id')) {\n        if (valData = field.str(0)) s.id = valData\n      }\n\n      // structure header (mimicking biojava)\n      if (cif.categories.pdbx_audit_revision_history) {\n        if (field = cif.categories.pdbx_audit_revision_history?.getField('revision_date')) {\n          for (let i = 0; i < field.rowCount; i++) {\n            if (valData = field.str(i)) {\n              s.header.releaseDate = valData\n              break\n            }\n          }\n        }\n        if (field = cif.categories.pdbx_database_status?.getField('recvd_initial_deposition_date')) {\n          for (let i = 0; i < field.rowCount; i++) {\n            if (valData = field.str(i)) {\n              s.header.depositionDate = valData\n              break\n            }\n          }\n        }\n      } else if (cif.categories.database_PDB_rev) {\n        if (field = cif.categories.database_PDB_rev?.getField('date')) {\n          for (let i = 0; i < field.rowCount; i++) {\n            if (valData = field.str(i)) {\n              s.header.releaseDate = valData\n              break\n            }\n          }\n        }\n        if (field = cif.categories.database_PDB_rev?.getField('date_original')) {\n          for (let i = 0; i < field.rowCount; i++) {\n            if (valData = field.str(i)) {\n              s.header.depositionDate = valData\n              break\n            }\n          }\n        }\n      }\n\n      if (field = cif.categories.reflns?.getField('d_resolution_high') ?? cif.categories.refine?.getField('ls_d_res_high')) {\n        if (field.valueKind(0) === 0) { // is value present?\n          s.header.resolution = field.float(0)\n        }\n      }\n\n      if ( field = cif.categories.refine?.getField('ls_R_factor_R_free')) {\n        if (field.valueKind(0) === 0) { // is value present?\n          s.header.rFree = field.float(0)\n        }\n      }\n\n      if ( field = cif.categories.refine?.getField('ls_R_factor_R_work')) {\n        if (field.valueKind(0) === 0) { // is value present?\n          s.header.rFree = field.float(0)\n        }\n      }\n\n      if ( field = cif.categories.exptl?.getField('method')) {\n        s.header.experimentalMethods = field.toStringArray().slice()\n      }\n\n      sb.finalize()\n      s.finalizeAtoms()\n      calculateBonds(s)\n      s.finalizeBonds()\n\n      if (!secStruct) {\n        calculateSecondaryStructure(s)\n      } else {\n        assignSecondaryStructure(s, secStruct)\n      }\n      buildUnitcellAssembly(s)\n\n      s.extraData.cif = cif\n    }\n\n    if (Debug) Log.timeEnd('CifParser._parse ' + this.name)\n  }\n}\n\nclass BinaryCifParser extends CifParser {\n  get type () { return 'bcif' }\n  get isBinary () { return true }\n}\n\nParserRegistry.add('bcif', BinaryCifParser)\nParserRegistry.add('cif', CifParser)\nParserRegistry.add('mcif', CifParser)\nParserRegistry.add('mmcif', CifParser)\n\nexport default CifParser\n","/**\n * @file Gro Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  calculateBonds, calculateChainnames, calculateSecondaryStructure\n} from '../structure/structure-utils'\n\nclass GroParser extends StructureParser {\n  get type () { return 'gro' }\n\n  _parse () {\n    // http://manual.gromacs.org/current/online/gro.html\n\n    if (Debug) Log.time('GroParser._parse ' + this.name)\n\n    var s = this.structure\n    var sb = this.structureBuilder\n\n    var firstModelOnly = this.firstModelOnly\n    var asTrajectory = this.asTrajectory\n    var cAlphaOnly = this.cAlphaOnly\n\n    var frames = s.frames\n    var boxes = s.boxes\n    var currentFrame: Float32Array, currentCoord: number\n\n    var firstLines = this.streamer.peekLines(3)\n\n    s.title = firstLines[ 0 ].trim()\n\n    // determine number of decimal places\n    var ndec = firstLines[ 2 ].length - firstLines[ 2 ].lastIndexOf('.') - 1\n    var lpos = 5 + ndec\n    var xpos = 20\n    var ypos = 20 + lpos\n    var zpos = 20 + 2 * lpos\n\n    //\n\n    var atomname, resname, resno, serial\n\n    var atomCount = parseInt(firstLines[ 1 ])\n    var modelLineCount = atomCount + 3\n\n    var atomMap = s.atomMap\n    var atomStore = s.atomStore\n    atomStore.resize(atomCount)\n\n    var idx = 0\n    var modelIdx = 0\n    var lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (var i = _i; i < _n; ++i) {\n        ++lineNo\n        var l = lineNo - 1\n\n        var line = lines[ i ]\n\n        if (!line) continue\n\n        if (l % modelLineCount === 0) {\n          // Log.log( \"title\", line )\n\n          if (asTrajectory) {\n            currentFrame = new Float32Array(atomCount * 3)\n            frames.push(currentFrame)\n            currentCoord = 0\n          }\n        } else if (l % modelLineCount === 1) {\n\n          // Log.log( \"atomCount\", line )\n\n        } else if (l % modelLineCount === modelLineCount - 1) {\n          var str = line.trim().split(/\\s+/)\n          var box = new Float32Array(9)\n          box[ 0 ] = parseFloat(str[ 0 ]) * 10\n          box[ 4 ] = parseFloat(str[ 1 ]) * 10\n          box[ 8 ] = parseFloat(str[ 2 ]) * 10\n          boxes.push(box)\n\n          if (firstModelOnly) {\n            return true\n          }\n\n          modelIdx += 1\n        } else {\n          atomname = line.substr(10, 5).trim()\n          if (cAlphaOnly && atomname !== 'CA') continue\n\n          var x = parseFloat(line.substr(xpos, lpos)) * 10\n          var y = parseFloat(line.substr(ypos, lpos)) * 10\n          var z = parseFloat(line.substr(zpos, lpos)) * 10\n\n          if (asTrajectory) {\n            var j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (l > modelLineCount) continue\n          }\n\n          resname = line.substr(5, 5).trim()\n          resno = parseInt(line.substr(0, 5))\n          serial = parseInt(line.substr(15, 5))\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = serial\n\n          sb.addAtom(modelIdx, '', '', resname, resno, false, 'l')\n\n          idx += 1\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    calculateChainnames(s)\n    calculateBonds(s)\n    s.finalizeBonds()\n\n    calculateSecondaryStructure(s)\n\n    if (Debug) Log.timeEnd('GroParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('gro', GroParser)\n\nexport default GroParser\n","/**\n * @file utf8-utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * mostly copied from https://github.com/creationix/msgpack-js-browser\n * by Tim Caswell <tim@creationix.com>, MIT License, Copyright (c) 2013\n */\n\n\n// Encode string as utf8 into dataview at offset\nfunction utf8Write(view, offset, string) {\n  var byteLength = view.byteLength;\n  for(var i = 0, l = string.length; i < l; i++) {\n    var codePoint = string.charCodeAt(i);\n\n    // One byte of UTF-8\n    if (codePoint < 0x80) {\n      view.setUint8(offset++, codePoint >>> 0 & 0x7f | 0x00);\n      continue;\n    }\n\n    // Two bytes of UTF-8\n    if (codePoint < 0x800) {\n      view.setUint8(offset++, codePoint >>> 6 & 0x1f | 0xc0);\n      view.setUint8(offset++, codePoint >>> 0 & 0x3f | 0x80);\n      continue;\n    }\n\n    // Three bytes of UTF-8.\n    if (codePoint < 0x10000) {\n      view.setUint8(offset++, codePoint >>> 12 & 0x0f | 0xe0);\n      view.setUint8(offset++, codePoint >>> 6  & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 0  & 0x3f | 0x80);\n      continue;\n    }\n\n    // Four bytes of UTF-8\n    if (codePoint < 0x110000) {\n      view.setUint8(offset++, codePoint >>> 18 & 0x07 | 0xf0);\n      view.setUint8(offset++, codePoint >>> 12 & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 6  & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 0  & 0x3f | 0x80);\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n}\n\nfunction utf8ByteCount(string) {\n  var count = 0;\n  for(var i = 0, l = string.length; i < l; i++) {\n    var codePoint = string.charCodeAt(i);\n    if (codePoint < 0x80) {\n      count += 1;\n      continue;\n    }\n    if (codePoint < 0x800) {\n      count += 2;\n      continue;\n    }\n    if (codePoint < 0x10000) {\n      count += 3;\n      continue;\n    }\n    if (codePoint < 0x110000) {\n      count += 4;\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n  return count;\n}\n\n/**\n * encode data value (recursively) into binary encoded MessagePack v5 (http://msgpack.org/)\n * @param  {Object|Array|String|Number|Boolean|null} value  [description]\n * @param  {DataView} view   [description]\n * @param  {Integer} offset [description]\n * @return {Integer} number of bytes written into view\n */\nfunction encode$1(value, view, offset) {\n  var type = typeof value;\n\n  // Strings Bytes\n  if (type === \"string\") {\n    var length = utf8ByteCount(value);\n    // fix str\n    if (length < 0x20) {\n      view.setUint8(offset, length | 0xa0);\n      utf8Write(view, offset + 1, value);\n      return 1 + length;\n    }\n    // str 8\n    if (length < 0x100) {\n      view.setUint8(offset, 0xd9);\n      view.setUint8(offset + 1, length);\n      utf8Write(view, offset + 2, value);\n      return 2 + length;\n    }\n    // str 16\n    if (length < 0x10000) {\n      view.setUint8(offset, 0xda);\n      view.setUint16(offset + 1, length);\n      utf8Write(view, offset + 3, value);\n      return 3 + length;\n    }\n    // str 32\n    if (length < 0x100000000) {\n      view.setUint8(offset, 0xdb);\n      view.setUint32(offset + 1, length);\n      utf8Write(view, offset + 5, value);\n      return 5 + length;\n    }\n  }\n\n  if (value instanceof Uint8Array) {\n    var length = value.byteLength;\n    var bytes = new Uint8Array(view.buffer);\n    // bin 8\n    if (length < 0x100) {\n      view.setUint8(offset, 0xc4);\n      view.setUint8(offset + 1, length);\n      bytes.set(value, offset + 2);\n      return 2 + length;\n    }\n    // bin 16\n    if (length < 0x10000) {\n      view.setUint8(offset, 0xc5);\n      view.setUint16(offset + 1, length);\n      bytes.set(value, offset + 3);\n      return 3 + length;\n    }\n    // bin 32\n    if (length < 0x100000000) {\n      view.setUint8(offset, 0xc6);\n      view.setUint32(offset + 1, length);\n      bytes.set(value, offset + 5);\n      return 5 + length;\n    }\n  }\n\n  if (type === \"number\") {\n    if (!isFinite(value)) {\n        throw new Error(\"Number not finite: \" + value);\n    }\n\n    // Floating point\n    if (Math.floor(value) !== value) {\n      view.setUint8(offset, 0xcb);\n      view.setFloat64(offset + 1, value);\n      return 9;\n    }\n\n    // Integers\n    if (value >=0) {\n      // positive fixnum\n      if (value < 0x80) {\n        view.setUint8(offset, value);\n        return 1;\n      }\n      // uint 8\n      if (value < 0x100) {\n        view.setUint8(offset, 0xcc);\n        view.setUint8(offset + 1, value);\n        return 2;\n      }\n      // uint 16\n      if (value < 0x10000) {\n        view.setUint8(offset, 0xcd);\n        view.setUint16(offset + 1, value);\n        return 3;\n      }\n      // uint 32\n      if (value < 0x100000000) {\n        view.setUint8(offset, 0xce);\n        view.setUint32(offset + 1, value);\n        return 5;\n      }\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    // negative fixnum\n    if (value >= -0x20) {\n      view.setInt8(offset, value);\n      return 1;\n    }\n    // int 8\n    if (value >= -0x80) {\n      view.setUint8(offset, 0xd0);\n      view.setInt8(offset + 1, value);\n      return 2;\n    }\n    // int 16\n    if (value >= -0x8000) {\n      view.setUint8(offset, 0xd1);\n      view.setInt16(offset + 1, value);\n      return 3;\n    }\n    // int 32\n    if (value >= -0x80000000) {\n      view.setUint8(offset, 0xd2);\n      view.setInt32(offset + 1, value);\n      return 5;\n    }\n    throw new Error(\"Number too small -0x\" + (-value).toString(16).substr(1));\n  }\n\n  // null\n  if (value === null) {\n    view.setUint8(offset, 0xc0);\n    return 1;\n  }\n\n  // Boolean\n  if (type === \"boolean\") {\n    view.setUint8(offset, value ? 0xc3 : 0xc2);\n    return 1;\n  }\n\n  // Container Types\n  if (type === \"object\") {\n    var length, size = 0;\n    var isArray = Array.isArray(value);\n\n    if (isArray) {\n      length = value.length;\n    }\n    else {\n      var keys = Object.keys(value);\n      length = keys.length;\n    }\n\n    var size;\n    if (length < 0x10) {\n      view.setUint8(offset, length | (isArray ? 0x90 : 0x80));\n      size = 1;\n    }\n    else if (length < 0x10000) {\n      view.setUint8(offset, isArray ? 0xdc : 0xde);\n      view.setUint16(offset + 1, length);\n      size = 3;\n    }\n    else if (length < 0x100000000) {\n      view.setUint8(offset, isArray ? 0xdd : 0xdf);\n      view.setUint32(offset + 1, length);\n      size = 5;\n    }\n\n    if (isArray) {\n      for (var i = 0; i < length; i++) {\n        size += encode$1(value[i], view, offset + size);\n      }\n    }\n    else {\n      for (var i = 0; i < length; i++) {\n        var key = keys[i];\n        size += encode$1(key, view, offset + size);\n        size += encode$1(value[key], view, offset + size);\n      }\n    }\n\n    return size;\n  }\n  throw new Error(\"Unknown type \" + type);\n}\n\nfunction encodedSize(value) {\n  var type = typeof value;\n\n  // Raw Bytes\n  if (type === \"string\") {\n    var length = utf8ByteCount(value);\n    if (length < 0x20) {\n      return 1 + length;\n    }\n    if (length < 0x100) {\n      return 2 + length;\n    }\n    if (length < 0x10000) {\n      return 3 + length;\n    }\n    if (length < 0x100000000) {\n      return 5 + length;\n    }\n  }\n\n  if (value instanceof Uint8Array) {\n    var length = value.byteLength;\n    if (length < 0x100) {\n      return 2 + length;\n    }\n    if (length < 0x10000) {\n      return 3 + length;\n    }\n    if (length < 0x100000000) {\n      return 5 + length;\n    }\n  }\n\n  if (type === \"number\") {\n    // Floating Point\n    // double\n    if (Math.floor(value) !== value) return 9;\n\n    // Integers\n    if (value >=0) {\n      // positive fixnum\n      if (value < 0x80) return 1;\n      // uint 8\n      if (value < 0x100) return 2;\n      // uint 16\n      if (value < 0x10000) return 3;\n      // uint 32\n      if (value < 0x100000000) return 5;\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    // negative fixnum\n    if (value >= -0x20) return 1;\n    // int 8\n    if (value >= -0x80) return 2;\n    // int 16\n    if (value >= -0x8000) return 3;\n    // int 32\n    if (value >= -0x80000000) return 5;\n    throw new Error(\"Number too small -0x\" + value.toString(16).substr(1));\n  }\n\n  // Boolean, null\n  if (type === \"boolean\" || value === null) return 1;\n\n  // Container Types\n  if (type === \"object\") {\n    var length, size = 0;\n    if (Array.isArray(value)) {\n      length = value.length;\n      for (var i = 0; i < length; i++) {\n        size += encodedSize(value[i]);\n      }\n    }\n    else {\n      var keys = Object.keys(value);\n      length = keys.length;\n      for (var i = 0; i < length; i++) {\n        var key = keys[i];\n        size += encodedSize(key) + encodedSize(value[key]);\n      }\n    }\n    if (length < 0x10) {\n      return 1 + size;\n    }\n    if (length < 0x10000) {\n      return 3 + size;\n    }\n    if (length < 0x100000000) {\n      return 5 + size;\n    }\n    throw new Error(\"Array or object too long 0x\" + length.toString(16));\n  }\n  throw new Error(\"Unknown type \" + type);\n}\n\nfunction encodeMsgpack(value) {\n  var buffer = new ArrayBuffer(encodedSize(value));\n  var view = new DataView(buffer);\n  encode$1(value, view, 0);\n  return new Uint8Array(buffer);\n}\n\n/**\n * @file mmtf-constants\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n\nvar PassThroughFields = [\n    \"mmtfVersion\", \"mmtfProducer\",\n    \"unitCell\", \"spaceGroup\", \"structureId\", \"title\",\n    \"depositionDate\", \"releaseDate\",\n    \"experimentalMethods\", \"resolution\", \"rFree\", \"rWork\",\n    \"bioAssemblyList\", \"ncsOperatorList\", \"entityList\", \"groupList\",\n    \"numBonds\", \"numAtoms\", \"numGroups\", \"numChains\", \"numModels\",\n    \"groupsPerChain\", \"chainsPerModel\",\n];\n\nvar EncodedFields = [\n\t// required\n    \"xCoordList\", \"yCoordList\", \"zCoordList\",\n    \"groupIdList\", \"groupTypeList\",\n    \"chainIdList\",\n    // optional\n    \"bFactorList\", \"atomIdList\", \"altLocList\", \"occupancyList\",\n    \"secStructList\", \"insCodeList\", \"sequenceIndexList\",\n    \"chainNameList\",\n    \"bondAtomList\", \"bondOrderList\"\n];\n\nvar AllFields = PassThroughFields.concat( EncodedFields );\n\n/**\n * @file mmtf-utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * mmtf utils module.\n * @module MmtfUtils\n */\n\n\nfunction getView( ctor, typedArray, elemSize ){\n    return typedArray ? new ctor(\n        typedArray.buffer,\n        typedArray.byteOffset,\n        typedArray.byteLength / ( elemSize || 1 )\n    ) : undefined;\n}\n\nfunction getDataView( typedArray ){\n    return getView( DataView, typedArray );\n}\n\n/**\n * get an Uint8Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Uint8Array} new view on the input array memory\n */\nfunction getUint8View( typedArray ){\n    return getView( Uint8Array, typedArray );\n}\n\n/**\n * get an Int8Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Int8Array} new view on the input array memory\n */\nfunction getInt8View( typedArray ){\n    return getView( Int8Array, typedArray );\n}\n\n/**\n * get an Int32Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Int32Array} new view on the input array memory\n */\nfunction getInt32View( typedArray ){\n    return getView( Int32Array, typedArray, 4 );\n}\n\nfunction getFloat32View( typedArray ){\n    return getView( Float32Array, typedArray, 4 );\n}\n\n\n/**\n * get an Int16Array copy of the the input array data\n * @static\n * @param  {TypedArray} view - input data in big endian format\n * @param  {Int16Array} [dataArray] - pre-allocated output array\n * @return {Int16Array} copy of the input array data\n */\nfunction decodeInt16( bytes, output ){\n    var n = bytes.length / 2;\n    if( !output ) output = new Int16Array( n );\n    for( var i = 0, i2 = 0; i < n; ++i, i2 += 2 ){\n        output[ i ] = bytes[ i2 ] << 8 ^ bytes[ i2 + 1 ] << 0;\n    }\n    return output;\n}\n\n/**\n * make big endian buffer of an int16 array\n * @static\n * @param  {Array|TypedArray} array - array of int16 values\n * @return {ArrayBuffer} big endian buffer\n */\nfunction encodeInt16( array, output ){\n    var n = array.length;\n    if( !output ) output = new Uint8Array( 2 * n );\n    var dv = getDataView( output );\n    for( var i = 0; i < n; ++i ){\n        dv.setInt16( 2 * i, array[ i ] );\n    }\n    return getUint8View( output );\n}\n\n/**\n * get an Int32Array copy of the the input array data\n * @static\n * @param  {TypedArray} view - input data in big endian format\n * @param  {Int32Array} [dataArray] - pre-allocated output array\n * @return {Int32Array} copy of the input array data\n */\nfunction decodeInt32( bytes, output ){\n    var n = bytes.length / 4;\n    if( !output ) output = new Int32Array( n );\n    for( var i = 0, i4 = 0; i < n; ++i, i4 += 4 ){\n        output[ i ] = (\n            bytes[ i4     ] << 24 ^ bytes[ i4 + 1 ] << 16 ^\n            bytes[ i4 + 2 ] <<  8 ^ bytes[ i4 + 3 ] <<  0\n        );\n    }\n    return output;\n}\n\n/**\n * make big endian buffer of an int32 array\n * @static\n * @param  {Array|TypedArray} array - array of int32 values\n * @return {ArrayBuffer} big endian buffer\n */\nfunction encodeInt32( array, output ){\n    var n = array.length;\n    if( !output ) output = new Uint8Array( 4 * n );\n    var dv = getDataView( output );\n    for( var i = 0; i < n; ++i ){\n        dv.setInt32( 4 * i, array[ i ] );\n    }\n    return getUint8View( output );\n}\n\nfunction decodeFloat32( bytes, output ){\n    var n = bytes.length;\n    if( !output ) output = new Float32Array( n / 4 );\n    var dvOut = getDataView( output );\n    var dvIn = getDataView( bytes );\n    for( var i = 0, i4 = 0, il = n / 4; i < il; ++i, i4 += 4 ){\n        dvOut.setFloat32( i4, dvIn.getFloat32( i4 ), true );\n    }\n    return output;\n}\n\n/**\n * decode integers into floats using given divisor\n * example:\n *     intArray: [ 12, 34, 543, 687, 2, 0, 4689 ]\n *     divisor: 100\n *     return: [ 0.12, 0.34, 5.43, 6.87, 0.02, 0.00, 46.89 ]\n * @static\n * @param  {TypedArray|Array} intArray - input array containing integers\n * @param  {Number} divisor - number to devide the integers to obtain floats\n * @param  {Float32Array} [dataArray] - pre-allocated output array\n * @return {Float32Array} decoded array\n */\nfunction decodeInteger( intArray, divisor, output ){\n    var n = intArray.length;\n    var invDiv = 1/divisor;\n    if( !output ) output = new Float32Array( n );\n    for( var i = 0; i < n; ++i ){\n        // multiply by inverse of the divisor which is faster then division\n        output[ i ] = intArray[ i ] * invDiv;\n    }\n    return output;\n}\n\nfunction encodeInteger( floatArray, factor, output ){\n    var n = floatArray.length;\n    if( !output ) output = new Int32Array( n );\n    for( var i = 0; i < n; ++i ){\n        output[ i ] = Math.round( floatArray[ i ] * factor );\n    }\n    return output;\n}\n\n\n\n/**\n * perform run-length decoding of input array\n * example:\n *     array: [ 0, 2, 3, 5 ]  // pairs of values and length of a run\n *     return: [ 0, 0, 3, 3, 3, 3, 3 ]\n * @static\n * @param  {TypedArray|Array} array - run-length encoded input array\n * @param  {TypedArray|Array} [dataArray] - pre-allocated output array\n * @return {TypedArray|Array} decoded array\n */\nfunction decodeRun( array, output ){\n    var i, il;\n    if( !output ){\n        // calculate the length the decoded array will have\n        var fullLength = 0;\n        for( i = 0, il = array.length; i < il; i+=2 ){\n            fullLength += array[ i + 1 ];\n        }\n        // create a new array of the same type of the input array\n        output = new array.constructor( fullLength );\n    }\n    var dataOffset = 0;\n    for( i = 0, il = array.length; i < il; i+=2 ){\n        var value = array[ i ];  // value to be repeated\n        var length = array[ i + 1 ];  // number of repeats\n        for( var j = 0; j < length; ++j ){\n            output[ dataOffset ] = value;\n            ++dataOffset;\n        }\n    }\n    return output;\n}\n\nfunction encodeRun( array ){\n    if( array.length === 0 ) return new Int32Array();\n    var i, il;\n    // calculate output size\n    var fullLength = 2;\n    for( i = 1, il = array.length; i < il; ++i ){\n        if( array[ i - 1 ] !== array[ i ] ){\n            fullLength += 2;\n        }\n    }\n    var output = new Int32Array( fullLength );\n    var offset = 0;\n    var runLength = 1;\n    for( i = 1, il = array.length; i < il; ++i ){\n        if( array[ i - 1 ] !== array[ i ] ){\n            output[ offset ] = array[ i - 1 ];\n            output[ offset + 1 ] = runLength;\n            runLength = 1;\n            offset += 2;\n        }else{\n            ++runLength;\n        }\n    }\n    output[ offset ] = array[ array.length - 1 ];\n    output[ offset + 1 ] = runLength;\n    return output;\n}\n\n\n\n/**\n * perform delta decoding of the input array\n * by iterativly adding the ith element's value to the i+1th\n * example:\n *     dataArray: [ 0, 2, 1, 2, 1, 1, -4, -2, 9 ]\n *     return: [ 0, 2, 3, 5, 6, 7, 3, 1, 10 ]\n * @static\n * @param  {TypedArray|Array} dataArray - delta encoded input array\n * @return {TypedArray|Array} decoded array\n */\nfunction decodeDelta( array, output ){\n    var n = array.length;\n    if( !output ) output = new array.constructor( n );\n    if( n ) output[ 0 ] = array[ 0 ];\n    for( var i = 1; i < n; ++i ){\n        output[ i ] = array[ i ] + output[ i - 1 ];\n    }\n    return output;\n}\n\nfunction encodeDelta( array, output ){\n    var n = array.length;\n    if( !output ) output = new array.constructor( n );\n    output[ 0 ] = array[ 0 ];\n    for( var i = 1; i < n; ++i ){\n        output[ i ] = array[ i ] - array[ i - 1 ];\n    }\n    return output;\n}\n\n\n\n/**\n * [decodePacking description]\n * @param  {Int16Array|Int8Array} int16or8 [description]\n * @param  {Int32Array} output   [description]\n * @return {Int32Array}          [description]\n */\nfunction decodePacking( int16or8, output ){\n    var upperLimit = int16or8 instanceof Int8Array ? 0x7F : 0x7FFF;\n    var lowerLimit = -upperLimit - 1;\n    var n = int16or8.length;\n    var i, j;\n    if( !output ){\n        var fullLength = 0;\n        for( i = 0; i < n; ++i ){\n            if( int16or8[ i ] < upperLimit && int16or8[ i ] > lowerLimit ){\n                ++fullLength;\n            }\n        }\n        output = new Int32Array( fullLength );\n    }\n    i = 0;\n    j = 0;\n    while( i < n ){\n        var value = 0;\n        while( int16or8[ i ] === upperLimit || int16or8[ i ] === lowerLimit ){\n            value += int16or8[ i ];\n            ++i;\n        }\n        value += int16or8[ i ];\n        ++i;\n        output[ j ] = value;\n        ++j;\n    }\n    return output;\n}\n\n/**\n * integer packing using recursive indexing\n * @param  {Array|TyepedArray} intArray [description]\n * @param  {Boolean} useInt8  [description]\n * @return {Int16Array|Int8Array}          [description]\n */\nfunction encodePacking( intArray, useInt8 ){\n    var upperLimit = useInt8 ? 0x7F : 0x7FFF;\n    var lowerLimit = -upperLimit - 1;\n    var i;\n    var n = intArray.length;\n    var size = 0;\n    for( i = 0; i < n; ++i ){\n        var value = intArray[ i ];\n        if( value === 0 ){\n            ++size;\n        }else if( value === upperLimit || value === lowerLimit ){\n            size += 2;\n        }else if( value > 0) {\n            size += Math.ceil( value / upperLimit );\n        }else {\n            size += Math.ceil( value / lowerLimit );\n        }\n    }\n    var output = useInt8 ? new Int8Array( size ) : new Int16Array( size );\n    var j = 0;\n    for( i = 0; i < n; ++i ){\n        var value = intArray[ i ];\n        if( value >= 0) {\n            while( value >= upperLimit ){\n                output[ j ] = upperLimit;\n                ++j;\n                value -= upperLimit;\n            }\n        }else{\n            while( value <= lowerLimit ){\n                output[ j ] = lowerLimit;\n                ++j;\n                value -= lowerLimit;\n            }\n        }\n        output[ j ] = value;\n        ++j;\n    }\n    return output;\n}\n\n\n\nfunction decodeDeltaRun( array, output ){\n    return decodeDelta( decodeRun( array ), output );\n}\n\nfunction encodeDeltaRun( array ){\n    return encodeRun( encodeDelta( array ) );\n}\n\n\n\n/**\n * perform run-length decoding followed (@see decodeRunLength)\n * by decoding integers into floats using given divisor (@see decodeIntegerToFloat)\n * example:\n *     array: [ 320, 3, 100, 2 ]\n *     divisor: 100\n *     return: [ 3.20, 3.20, 3.20, 1.00, 1.00 ]\n * @static\n * @param  {Uint8Array} array - run-length encoded int32 array as bytes in big endian format\n * @param  {Integer} divisor - number to devide the integers to obtain floats\n * @param  {Float32Array} dataArray - pre-allocated output array\n * @return {Float32Array} decoded array\n */\nfunction decodeIntegerRun( intArray, divisor, output ){\n    return decodeInteger(\n        decodeRun( intArray, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction encodeIntegerRun( floatArray, factor ){\n    return encodeRun( encodeInteger( floatArray, factor ) );\n}\n\n\n\nfunction decodeIntegerDelta( intArray, divisor, output ){\n    return decodeInteger(\n        decodeDelta( intArray, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction encodeIntegerDelta( floatArray, factor, output ){\n    return encodeDelta( encodeInteger( floatArray, factor ), output );\n}\n\n\n\nfunction decodeIntegerPacking( int16or8, divisor, output ){\n    return decodeInteger(\n        decodePacking( int16or8, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction decodeIntegerDeltaPacking( int16or8, divisor, output ){\n    var unpacked = decodePacking( int16or8, getInt32View( output ) );\n    return decodeIntegerDelta( unpacked, divisor, getFloat32View( unpacked ) );\n}\n\nfunction encodeIntegerDeltaPacking( floatArray, factor, useInt8 ){\n    return encodePacking( encodeIntegerDelta( floatArray, factor ), useInt8 );\n}\n\n\n\nfunction decodeBytes( bytes ){\n    var dv = getDataView( bytes );\n    var type = dv.getInt32( 0 );\n    var size = dv.getInt32( 4 );\n    var param = bytes.subarray( 8, 12 );\n    var bytes = bytes.subarray( 12 );\n    return [ type, bytes, size, param ];\n}\n\nfunction encodeBytes( type, size, param, bytes ){\n    var buffer = new ArrayBuffer( 12 + bytes.byteLength );\n    var out = new Uint8Array( buffer );\n    var dv = new DataView( buffer );\n    dv.setInt32( 0, type );\n    dv.setInt32( 4, size );\n    if( param ) out.set( param, 8 );\n    out.set( bytes, 12 );\n    return out;\n}\n\nfunction passInt8( int8 ){\n    var size = int8.length;\n    var bytes = getUint8View( int8 );\n    return encodeBytes( 2, size, undefined, bytes );\n}\n\nfunction passInt32( int32 ){\n    var size = int32.length;\n    var bytes = encodeInt32( int32 );\n    return encodeBytes( 4, size, undefined, bytes );\n}\n\nfunction passString( stringBytes, length ){\n    var size = stringBytes.length / length;\n    var param = encodeInt32([ length ]);\n    var bytes = getUint8View( stringBytes );\n    return encodeBytes( 5, size, param, bytes );\n}\n\nfunction runChar( charBytes ){\n    var size = charBytes.length;\n    var bytes = encodeInt32( encodeRun( charBytes ) );\n    return encodeBytes( 6, size, undefined, bytes );\n}\n\nfunction deltaRun( int32 ){\n    var size = int32.length;\n    var bytes = encodeInt32( encodeDeltaRun( int32 ) );\n    return encodeBytes( 8, size, undefined, bytes );\n}\n\nfunction integerRun( float32, factor ){\n    var size = float32.length;\n    var param = encodeInt32([ factor ]);\n    var bytes = encodeInt32( encodeIntegerRun( float32, factor ) );\n    return encodeBytes( 9, size, param, bytes );\n}\n\nfunction integerDeltaPacking16( float32, factor ){\n    var size = float32.length;\n    var param = encodeInt32([ factor ]);\n    var bytes = encodeInt16( encodeIntegerDeltaPacking( float32, factor ) );\n    return encodeBytes( 10, size, param, bytes );\n}\n\nfunction encodeMmtf( inputDict ){\n\n    var outputDict = {};\n\n    // copy some fields over from the input dict\n    PassThroughFields.forEach( function( name ){\n        if( inputDict[ name ] !== undefined ){\n            outputDict[ name ] = inputDict[ name ];\n        }\n    } );\n\n    //////////////\n    // bond data\n\n    // encode inter group bond atom indices, i.e. get bytes in big endian order\n    if( inputDict.bondAtomList ){\n        outputDict.bondAtomList = passInt32( inputDict.bondAtomList );\n    }\n\n    // encode inter group bond orders, i.e. get bytes\n    if( inputDict.bondOrderList ){\n        outputDict.bondOrderList = passInt8( inputDict.bondOrderList );\n    }\n\n    //////////////\n    // atom data\n\n    // split-list delta & integer encode x, y, z atom coords\n    outputDict.xCoordList = integerDeltaPacking16( inputDict.xCoordList, 1000 );\n    outputDict.yCoordList = integerDeltaPacking16( inputDict.yCoordList, 1000 );\n    outputDict.zCoordList = integerDeltaPacking16( inputDict.zCoordList, 1000 );\n\n    // split-list delta & integer encode b-factors\n    if( inputDict.bFactorList ){\n        outputDict.bFactorList = integerDeltaPacking16( inputDict.bFactorList, 100 );\n    }\n\n    // delta & run-length encode atom ids\n    if( inputDict.atomIdList ){\n        outputDict.atomIdList = deltaRun( inputDict.atomIdList );\n    }\n\n    // run-length encode alternate labels\n    if( inputDict.altLocList ){\n        outputDict.altLocList = runChar( inputDict.altLocList );\n    }\n\n    // run-length & integer encode occupancies\n    if( inputDict.occupancyList ){\n        outputDict.occupancyList = integerRun( inputDict.occupancyList, 100 );\n    }\n\n    ///////////////\n    // group data\n\n    // run-length & delta encode group numbers\n    outputDict.groupIdList = deltaRun( inputDict.groupIdList );\n\n    // encode group types, i.e. get int32 array\n    outputDict.groupTypeList = passInt32( inputDict.groupTypeList );\n\n    // encode secondary structure, i.e. get bytes\n    if( inputDict.secStructList ){\n        outputDict.secStructList = passInt8( inputDict.secStructList, 1 );\n    }\n\n    // run-length encode insertion codes\n    if( inputDict.insCodeList ){\n        outputDict.insCodeList = runChar( inputDict.insCodeList );\n    }\n\n    // run-length & delta encode sequence indices\n    if( inputDict.sequenceIndexList ){\n        outputDict.sequenceIndexList = deltaRun( inputDict.sequenceIndexList );\n    }\n\n    ///////////////\n    // chain data\n\n    // encode chain ids, i.e. get bytes\n    outputDict.chainIdList = passString( inputDict.chainIdList, 4 );\n\n    // encode chain names, i.e. get bytes\n    if( inputDict.chainNameList ){\n        outputDict.chainNameList = passString( inputDict.chainNameList, 4 );\n    }\n\n    return outputDict;\n\n}\n\n/**\n * @file msgpack-decode\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * msgpack decode module.\n * @module MsgpackDecode\n */\n\n/**\n * decode binary encoded MessagePack v5 (http://msgpack.org/) data\n * @static\n * @param  {Uint8Array} buffer - binary encoded MessagePack data\n * @return {Object|Array|String|Number|Boolean|null} decoded Messagepack data\n */\nfunction decodeMsgpack(buffer) {\n  // Loosely based on\n  // The MIT License (MIT)\n  // Copyright (c) 2013 Tim Caswell <tim@creationix.com>\n  // https://github.com/creationix/msgpack-js\n  var offset = 0;\n  var dataView = new DataView(buffer.buffer);\n\n  /**\n   * decode all key-value pairs of a map into an object\n   * @param  {Integer} length - number of key-value pairs\n   * @return {Object} decoded map\n   */\n  function map(length) {\n    var value = {};\n    for (var i = 0; i < length; i++) {\n      var key = parse();\n      value[key] = parse();\n    }\n    return value;\n  }\n\n  /**\n   * decode binary array\n   * @param  {Integer} length - number of elements in the array\n   * @return {Uint8Array} decoded array\n   */\n  function bin(length) {\n    var value = buffer.subarray(offset, offset + length);\n    offset += length;\n    return value;\n  }\n\n  /**\n   * decode string\n   * @param  {Integer} length - number string characters\n   * @return {String} decoded string\n   */\n  function str(length) {\n    var array = buffer.subarray(offset, offset + length);\n    offset += length;\n    // limit number of arguments to String.fromCharCode to something\n    // browsers can handle, see http://stackoverflow.com/a/22747272\n    var chunkSize = 0xffff;\n    if(length > chunkSize){\n      var c = [];\n      for(var i = 0; i < array.length; i += chunkSize) {\n        c.push(String.fromCharCode.apply(\n          null, array.subarray(i, i + chunkSize)\n        ));\n      }\n      return c.join(\"\");\n    }else{\n      return String.fromCharCode.apply(null, array);\n    }\n  }\n\n  /**\n   * decode array\n   * @param  {Integer} length - number of array elements\n   * @return {Array} decoded array\n   */\n  function array(length) {\n    var value = new Array(length);\n    for (var i = 0; i < length; i++) {\n      value[i] = parse();\n    }\n    return value;\n  }\n\n  /**\n   * recursively parse the MessagePack data\n   * @return {Object|Array|String|Number|Boolean|null} decoded MessagePack data\n   */\n  function parse() {\n    var type = buffer[offset];\n    var value, length, extType;\n    // Positive FixInt\n    if ((type & 0x80) === 0x00) {\n      offset++;\n      return type;\n    }\n    // FixMap\n    if ((type & 0xf0) === 0x80) {\n      length = type & 0x0f;\n      offset++;\n      return map(length);\n    }\n    // FixArray\n    if ((type & 0xf0) === 0x90) {\n      length = type & 0x0f;\n      offset++;\n      return array(length);\n    }\n    // FixStr\n    if ((type & 0xe0) === 0xa0) {\n      length = type & 0x1f;\n      offset++;\n      return str(length);\n    }\n    // Negative FixInt\n    if ((type & 0xe0) === 0xe0) {\n      value = dataView.getInt8(offset);\n      offset++;\n      return value;\n    }\n    switch (type) {\n    // nil\n    case 0xc0:\n      offset++;\n      return null;\n    // 0xc1: (never used, could be employed for padding)\n    // false\n    case 0xc2:\n      offset++;\n      return false;\n    // true\n    case 0xc3:\n      offset++;\n      return true;\n    // bin 8\n    case 0xc4:\n      length = dataView.getUint8(offset + 1);\n      offset += 2;\n      return bin(length);\n    // bin 16\n    case 0xc5:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return bin(length);\n    // bin 32\n    case 0xc6:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return bin(length);\n    // // ext 8\n    // case 0xc7:\n    //   length = dataView.getUint8(offset + 1);\n    //   extType = dataView.getUint8(offset + 2);\n    //   offset += 3;\n    //   return [extType, bin(length)];\n    // // ext 16\n    // case 0xc8:\n    //   length = dataView.getUint16(offset + 1);\n    //   extType = dataView.getUint8(offset + 3);\n    //   offset += 4;\n    //   return [extType, bin(length)];\n    // // ext 32\n    // case 0xc9:\n    //   length = dataView.getUint32(offset + 1);\n    //   extType = dataView.getUint8(offset + 5);\n    //   offset += 6;\n    //   return [extType, bin(length)];\n    // float 32\n    case 0xca:\n      value = dataView.getFloat32(offset + 1);\n      offset += 5;\n      return value;\n    // float 64\n    case 0xcb:\n      value = dataView.getFloat64(offset + 1);\n      offset += 9;\n      return value;\n    // uint8\n    case 0xcc:\n      value = buffer[offset + 1];\n      offset += 2;\n      return value;\n    // uint 16\n    case 0xcd:\n      value = dataView.getUint16(offset + 1);\n      offset += 3;\n      return value;\n    // uint 32\n    case 0xce:\n      value = dataView.getUint32(offset + 1);\n      offset += 5;\n      return value;\n    // // uint64\n    // case 0xcf:\n    //   // FIXME not available/representable in JS\n    //   // largest possible int in JS is 2^53\n    //   // value = dataView.getUint64(offset + 1);\n    //   offset += 9;\n    //   return 0;\n    // int 8\n    case 0xd0:\n      value = dataView.getInt8(offset + 1);\n      offset += 2;\n      return value;\n    // int 16\n    case 0xd1:\n      value = dataView.getInt16(offset + 1);\n      offset += 3;\n      return value;\n    // int 32\n    case 0xd2:\n      value = dataView.getInt32(offset + 1);\n      offset += 5;\n      return value;\n    // // int 64\n    // case 0xd3:\n    //   // FIXME not available/representable in JS\n    //   // largest possible int in JS is 2^53\n    //   // value = dataView.getInt64(offset + 1);\n    //   offset += 9;\n    //   return 0;\n\n    // // fixext 1\n    // case 0xd4:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(1)];\n    // // fixext 2\n    // case 0xd5:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(2)];\n    // // fixext 4\n    // case 0xd6:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(4)];\n    // // fixext 8\n    // case 0xd7:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(8)];\n    // // fixext 16\n    // case 0xd8:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(16)];\n    // str 8\n    case 0xd9:\n      length = dataView.getUint8(offset + 1);\n      offset += 2;\n      return str(length);\n    // str 16\n    case 0xda:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return str(length);\n    // str 32\n    case 0xdb:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return str(length);\n    // array 16\n    case 0xdc:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return array(length);\n    // array 32\n    case 0xdd:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return array(length);\n    // map 16:\n    case 0xde:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return map(length);\n    // map 32\n    case 0xdf:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return map(length);\n    }\n\n    throw new Error(\"Unknown type 0x\" + type.toString(16));\n  }\n\n  // start the recursive parsing\n  return parse();\n}\n\n/**\n * Fields shared in encoded and decoded mmtf data objects.\n * @typedef {Object} module:MmtfDecode.SharedMmtfData\n * @property {String} mmtfVersion - MMTF specification version\n * @property {String} mmtfProducer - Program that created the file\n * @property {Float[]} [unitCell] - Crystallographic unit cell\n * @property {Float} unitCell.0 - x length\n * @property {Float} unitCell.1 - y length\n * @property {Float} unitCell.2 - z length\n * @property {Float} unitCell.3 - alpha angle\n * @property {Float} unitCell.4 - beta angle\n * @property {Float} unitCell.5 - gamma angle\n * @property {String} [spaceGroup] - Hermann-Mauguin symbol\n * @property {String} [structureId] - Some reference, e.g. a PDB ID\n * @property {String} [title] - Short description\n * @property {String} [depositionDate] - Deposition date in YYYY-MM-DD format\n * @property {String} [releaseDate] - Release date in YYYY-MM-DD format\n * @property {String[]} [experimentalMethods] - Structure determination methods\n * @property {Float} [resolution] - Resolution in \n * @property {Float} [rFree] - R-free value\n * @property {Float} [rWork] - R-work value\n * @property {Integer} numBonds - Number of bonds\n * @property {Integer} numAtoms - Number of atoms\n * @property {Integer} numGroups - Number of groups (residues)\n * @property {Integer} numChains - Number of chains\n * @property {Integer} numModels - Number of models\n * @property {Integer[]} chainsPerModel - List of number of chains in each model\n * @property {Integer[]} groupsPerChain - List of number of groups in each chain\n * @property {Entity[]} [entityList] - List of entity objects\n * @property {Integer[]} entityList.chainIndexList - Pointers into chain data fields\n * @property {String} entityList.description - Description of the entity\n * @property {String} entityList.type - Name of the entity type\n * @property {String} entityList.sequence - One letter code sequence\n * @property {Assembly[]} [bioAssemblyList] - List of assembly objects\n * @property {Transform[]} bioAssemblyList.transformList - List of transform objects\n * @property {Integer[]} bioAssemblyList.transformList.chainIndexList - Pointers into chain data fields\n * @property {Float[]} bioAssemblyList.transformList.matrix - 4x4 transformation matrix\n * @property {Array[]} [ncsOperatorList] - List of ncs operator matrices\n * @property {Float[]} ncsOperatorList. - 4x4 transformation matrix\n * @property {GroupType[]} groupList - List of groupType objects\n * @property {Integer[]} groupList.formalChargeList - List of atom formal charges\n * @property {String[]} groupList.elementList - List of elements\n * @property {String[]} groupList.atomNameList - List of atom names\n * @property {Integer[]} groupList.bondAtomList - List of bonded atom indices\n * @property {Integer[]} groupList.bondOrderList - List of bond orders\n * @property {String} groupList.groupName - The name of the group\n * @property {String} groupList.singleLetterCode - The single letter code\n * @property {String} groupList.chemCompType -  The chemical component type\n */\n\n/**\n * Encoded mmtf data object. Also includes the fields from {@link module:MmtfDecode.SharedMmtfData}. See MMTF specification on how they are encoded.\n * @typedef {Object} module:MmtfDecode.EncodedMmtfData\n * @mixes module:MmtfDecode.SharedMmtfData\n * @property {Uint8Array} [bondAtomList] - Encoded bonded atom indices\n * @property {Uint8Array} [bondOrderList] - Encoded bond orders\n * @property {Uint8Array} xCoordBig - Encoded x coordinates in , part 1\n * @property {Uint8Array} xCoordSmall - Encoded x coordinates in , part 2\n * @property {Uint8Array} yCoordBig - Encoded y coordinates in , part 1\n * @property {Uint8Array} yCoordSmall - Encoded y coordinates in , part 2\n * @property {Uint8Array} yCoordBig - Encoded y coordinates in , part 1\n * @property {Uint8Array} yCoordSmall - Encoded y coordinates in , part 2\n * @property {Uint8Array} [bFactorBig] - Encoded B-factors in ^2, part 1\n * @property {Uint8Array} [bFactorSmall] - Encoded B-factors in ^2, part 2\n * @property {Uint8Array} [atomIdList] - Encoded  atom ids\n * @property {Uint8Array} [altLocList] - Encoded alternate location labels\n * @property {Uint8Array} [occupancyList] - Encoded occupancies\n * @property {Uint8Array} groupIdList - Encoded group ids\n * @property {Uint8Array} groupTypeList - Encoded group types\n * @property {Uint8Array} [secStructList] - Encoded secondary structure codes\n * @property {Uint8Array} [insCodeList] - Encoded insertion codes\n * @property {Uint8Array} [seuenceIdList] - Encoded sequence ids\n * @property {Uint8Array} chainIdList - Encoded chain ids\n * @property {Uint8Array} [chainNameList] - Encoded chain names\n */\n\n/**\n * Decoded mmtf data object. Also includes fields the from {@link module:MmtfDecode.SharedMmtfData}.\n * @typedef {Object} module:MmtfDecode.MmtfData\n * @mixes module:MmtfDecode.SharedMmtfData\n * @property {Int32Array} [bondAtomList] - List of bonded atom indices\n * @property {Uint8Array} [bondOrderList] - List of bond orders\n * @property {Float32Array} xCoordList - List of x coordinates in \n * @property {Float32Array} yCoordList - List of y coordinates in \n * @property {Float32Array} zCoordList - List of z coordinates in \n * @property {Float32Array} [bFactorList] - List of B-factors in ^2\n * @property {Int32Array} [atomIdList] - List of atom ids\n * @property {Uint8Array} [altLocList] - List of alternate location labels\n * @property {Float32Array} [occupancyList] - List of occupancies\n * @property {Int32Array} groupIdList - List of group ids\n * @property {Int32Array} groupTypeList - List of group types\n * @property {Int8Array} [secStructList] - List of secondary structure codes, encoding\n *    0: pi helix, 1: bend, 2: alpha helix, 3: extended,\n *    4: 3-10 helix, 5: bridge, 6: turn, 7: coil, -1: undefined\n * @property {Uint8Array} [insCodeList] - List of insertion codes\n * @property {Int32Array} [seuenceIdList] - List of sequence ids\n * @property {Uint8Array} chainIdList - List of chain ids\n * @property {Uint8Array} [chainNameList] - List of chain names\n */\n\n\n/**\n * [performDecoding description]\n * @param  {Integer} bytes [description]\n * @param  {Integer} size  [description]\n * @param  {Uint8Array} param [description]\n * @return {TypedArray}       [description]\n */\nfunction performDecoding( type, bytes, size, param ){\n\n    switch( type ){\n        case 1:\n            return decodeFloat32( bytes );\n        case 2:\n            return getInt8View( bytes );\n        case 3:\n            return decodeInt16( bytes );\n        case 4:\n            return decodeInt32( bytes );\n        case 5:\n            // var length = decodeInt32( param )[ 0 ];\n            return getUint8View( bytes );  // interpret as string array\n        case 6:\n            // interpret as char array\n            return decodeRun( decodeInt32( bytes ), new Uint8Array( size ) );\n        case 7:\n            return decodeRun( decodeInt32( bytes ) )\n        case 8:\n            return decodeDeltaRun( decodeInt32( bytes ) );\n        case 9:\n            return decodeIntegerRun( decodeInt32( bytes ), decodeInt32( param )[ 0 ] );\n        case 10:\n            return decodeIntegerDeltaPacking( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 11:\n            return decodeInteger( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 12:\n            return decodeIntegerPacking( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 13:\n            return decodeIntegerPacking( getInt8View( bytes ), decodeInt32( param )[ 0 ] );\n        case 14:\n            return decodePacking( decodeInt16( bytes ) );\n        case 15:\n            return decodePacking( getInt8View( bytes ) );\n    }\n\n};\n\n\n/**\n * Decode MMTF fields\n * @static\n * @param  {Object} inputDict - encoded MMTF data\n * @param  {Object} [params] - decoding parameters\n * @param  {String[]} params.ignoreFields - names of optional fields not to decode\n * @return {module:MmtfDecode.MmtfData} mmtfData\n */\nfunction decodeMmtf( inputDict, params ){\n\n    params = params || {};\n    var ignoreFields = params.ignoreFields;\n    var outputDict = {};\n\n    AllFields.forEach( function( name ){\n        var ignore = ignoreFields ? ignoreFields.indexOf( name ) !== -1 : false;\n        var data = inputDict[ name ];\n        if( !ignore && data !== undefined ){\n            if( data instanceof Uint8Array ){\n                outputDict[ name ] = performDecoding.apply( null, decodeBytes( data ) );\n            }else{\n                outputDict[ name ] = data;\n            }\n        }\n    } );\n\n    return outputDict;\n\n}\n\n/**\n * @file mmtf-traverse\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * mmtf traverse module.\n * @module MmtfTraverse\n */\n\n/**\n * Converts an array of ASCII codes trimming '\\0' bytes\n * @private\n * @param  {Array} charCodeArray - array of ASCII char codes\n * @return {String} '\\0' trimmed string\n */\nfunction fromCharCode( charCodeArray ){\n    return String.fromCharCode.apply( null, charCodeArray ).replace(/\\0/g, '');\n}\n\n\n/**\n * @callback module:MmtfTraverse.onModel\n * @param {Object} modelData\n * @param {Integer} modelData.chainCount - number of chains in the model\n * @param {Integer} modelData.modelIndex - index of the model\n */\n\n/**\n * @callback module:MmtfTraverse.onChain\n * @param {Object} chainData\n * @param {Integer} chainData.groupCount - number of groups in the chain\n * @param {Integer} chainData.chainIndex - index of the chain\n * @param {Integer} chainData.modelIndex - index of the parent model\n * @param {String} chainData.chainId - chain id\n * @param {?String} chainData.chainName - additional chain name\n */\n\n/**\n * @callback module:MmtfTraverse.onGroup\n * @param {Object} groupData\n * @param {Integer} groupData.atomCount - number of atoms in the group\n * @param {Integer} groupData.groupIndex - index of the group\n * @param {Integer} groupData.chainIndex - index of the parent chain\n * @param {Integer} groupData.modelIndex - index of the parent model\n * @param {Integer} groupData.groupId - group id (residue number)\n * @param {Integer} groupData.groupType - index to an entry in {@link module:MmtfDecode.MmtfData}#groupList\n * @param {String} groupData.groupName - name of the group, 0 to 5 characters\n * @param {Char} groupData.singleLetterCode - IUPAC single letter code, otherwise 'X', 1 character\n * @param {String} groupData.chemCompType - chemical component type from the mmCIF dictionary\n * @param {?Integer} groupData.secStruct - sencoded secondary structure |\n *    0: pi helix, 1: bend, 2: alpha helix, 3: extended,\n *    4: 3-10 helix, 5: bridge, 6: turn, 7: coil, -1: undefined\n * @param {?Char} groupData.insCode - insertion code\n * @param {?Integer} groupData.sequenceIndex - index to the `sequence` property of\n *    the corresponding entity, -1 when the entity has no sequence\n */\n\n/**\n * @callback module:MmtfTraverse.onAtom\n * @param {Object} atomData\n * @param {Integer} atomData.atomIndex - index of the atom\n * @param {Integer} atomData.groupIndex - index of the parent group\n * @param {Integer} atomData.chainIndex - index of the parent chain\n * @param {Integer} atomData.modelIndex - index of the parent model\n * @param {?Integer} atomData.atomId - atom id\n * @param {String} atomData.element - IUPAC element name, 0 to 3 characters\n * @param {String} atomData.atomName - name of the atom, 0 to 5 characters\n * @param {Integer} atomData.formalCharge - formal charge of the atom\n * @param {Float} atomData.xCoord - x coordinate in \n * @param {Float} atomData.yCoord - y coordinate in \n * @param {Float} atomData.zCoord - z coordinate in \n * @param {?Float} atomData.bFactor - B-factor in in ^2\n * @param {?Char} atomData.altLoc - alternate location identifier\n * @param {?Float} atomData.occupancy - occupancy of the atom\n */\n\n/**\n * @callback module:MmtfTraverse.onBond\n * @param {Object} bondData\n * @param {Integer} bondData.atomIndex1 - index of the first atom\n * @param {Integer} bondData.atomIndex2 - index of the secound atom\n * @param {Integer} bondData.bondOrder - bond order, allowed values are 1 to 3\n */\n\n\n/**\n * Traverse the MMTF structure data.\n * @static\n * @param {module:MmtfDecode.MmtfData} mmtfData - decoded mmtf data\n * @param {Object} eventCallbacks\n * @param {module:MmtfTraverse.onModel} [eventCallbacks.onModel] - called for each model\n * @param {module:MmtfTraverse.onChain} [eventCallbacks.onChain] - called for each chain\n * @param {module:MmtfTraverse.onGroup} [eventCallbacks.onGroup] - called for each group\n * @param {module:MmtfTraverse.onAtom} [eventCallbacks.onAtom] - called for each atom\n * @param {module:MmtfTraverse.onBond} [eventCallbacks.onBond] - called for each bond\n * @param {Object} [params] - traversal parameters\n * @param {Boolean} [params.firstModelOnly] - traverse only the first model\n */\nfunction traverseMmtf( mmtfData, eventCallbacks, params ){\n\n    params = params || {};\n\n    var firstModelOnly = params.firstModelOnly;\n\n    // setup callbacks\n    var onModel = eventCallbacks.onModel;\n    var onChain = eventCallbacks.onChain;\n    var onGroup = eventCallbacks.onGroup;\n    var onAtom = eventCallbacks.onAtom;\n    var onBond = eventCallbacks.onBond;\n\n    // setup index counters\n    var modelIndex = 0;\n    var chainIndex = 0;\n    var groupIndex = 0;\n    var atomIndex = 0;\n\n    var modelFirstAtomIndex = 0;\n    var modelLastAtomIndex = -1;\n\n    // setup optional fields\n    var chainNameList = mmtfData.chainNameList;\n    var secStructList = mmtfData.secStructList;\n    var insCodeList = mmtfData.insCodeList;\n    var sequenceIndexList = mmtfData.sequenceIndexList;\n    var atomIdList = mmtfData.atomIdList;\n    var bFactorList = mmtfData.bFactorList;\n    var altLocList = mmtfData.altLocList;\n    var occupancyList = mmtfData.occupancyList;\n    var bondAtomList = mmtfData.bondAtomList;\n    var bondOrderList = mmtfData.bondOrderList;\n\n    // hoisted loop variables\n    var o, ol, i, j, k, kl;\n\n    // loop over all models\n    for( o = 0, ol = mmtfData.chainsPerModel.length; o < ol; ++o ){\n\n        if( firstModelOnly && modelIndex > 0 ) break;\n\n        var modelChainCount = mmtfData.chainsPerModel[ modelIndex ];\n\n        if( onModel ){\n            onModel({\n                chainCount: modelChainCount,\n                modelIndex: modelIndex\n            });\n        }\n\n        for( i = 0; i < modelChainCount; ++i ){\n\n            var chainGroupCount = mmtfData.groupsPerChain[ chainIndex ];\n            if( onChain ){\n                var chainId = fromCharCode(\n                    mmtfData.chainIdList.subarray( chainIndex * 4, chainIndex * 4 + 4 )\n                );\n                var chainName = null;\n                if( chainNameList ){\n                    chainName = fromCharCode(\n                        chainNameList.subarray( chainIndex * 4, chainIndex * 4 + 4 )\n                    );\n                }\n                onChain({\n                    groupCount: chainGroupCount,\n                    chainIndex: chainIndex,\n                    modelIndex: modelIndex,\n                    chainId: chainId,\n                    chainName: chainName\n                });\n            }\n\n            for( j = 0; j < chainGroupCount; ++j ){\n\n                var groupData = mmtfData.groupList[ mmtfData.groupTypeList[ groupIndex ] ];\n                var groupAtomCount = groupData.atomNameList.length;\n                if( onGroup ){\n                    var secStruct = null;\n                    if( secStructList ){\n                        secStruct = secStructList[ groupIndex ];\n                    }\n                    var insCode = null;\n                    if( mmtfData.insCodeList ){\n                        insCode = String.fromCharCode( insCodeList[ groupIndex ] );\n                    }\n                    var sequenceIndex = null;\n                    if( sequenceIndexList ){\n                        sequenceIndex = sequenceIndexList[ groupIndex ];\n                    }\n                    onGroup({\n                        atomCount: groupAtomCount,\n                        groupIndex: groupIndex,\n                        chainIndex: chainIndex,\n                        modelIndex: modelIndex,\n                        groupId: mmtfData.groupIdList[ groupIndex ],\n                        groupType: mmtfData.groupTypeList[ groupIndex ],\n                        groupName: groupData.groupName,\n                        singleLetterCode: groupData.singleLetterCode,\n                        chemCompType: groupData.chemCompType,\n                        secStruct: secStruct,\n                        insCode: insCode,\n                        sequenceIndex: sequenceIndex\n                    });\n                }\n\n                for( k = 0; k < groupAtomCount; ++k ){\n\n                    if( onAtom ){\n                        var atomId = null;\n                        if( atomIdList ){\n                            atomId = atomIdList[ atomIndex ];\n                        }\n                        var bFactor = null;\n                        if( bFactorList ){\n                            bFactor = bFactorList[ atomIndex ];\n                        }\n                        var altLoc = null;\n                        if( altLocList ){\n                            altLoc = String.fromCharCode( altLocList[ atomIndex ] );\n                        }\n                        var occupancy = null;\n                        if( occupancyList ){\n                            occupancy = occupancyList[ atomIndex ];\n                        }\n                        onAtom({\n                            atomIndex: atomIndex,\n                            groupIndex: groupIndex,\n                            chainIndex: chainIndex,\n                            modelIndex: modelIndex,\n                            atomId: atomId,\n                            element: groupData.elementList[ k ],\n                            atomName: groupData.atomNameList[ k ],\n                            formalCharge: groupData.formalChargeList[ k ],\n                            xCoord: mmtfData.xCoordList[ atomIndex ],\n                            yCoord: mmtfData.yCoordList[ atomIndex ],\n                            zCoord: mmtfData.zCoordList[ atomIndex ],\n                            bFactor: bFactor,\n                            altLoc: altLoc,\n                            occupancy: occupancy\n                        });\n                    }\n\n                    atomIndex += 1;\n                }\n\n                if( onBond ){\n                    // intra group bonds\n                    var groupBondAtomList = groupData.bondAtomList;\n                    for( k = 0, kl = groupData.bondOrderList.length; k < kl; ++k ){\n                        onBond({\n                            atomIndex1: atomIndex - groupAtomCount + groupBondAtomList[ k * 2 ],\n                            atomIndex2: atomIndex - groupAtomCount + groupBondAtomList[ k * 2 + 1 ],\n                            bondOrder: groupData.bondOrderList[ k ]\n                        });\n                    }\n                }\n\n                groupIndex += 1;\n            }\n\n            chainIndex += 1;\n        }\n\n        modelFirstAtomIndex = modelLastAtomIndex + 1;\n        modelLastAtomIndex = atomIndex - 1;  // subtract one as it already has been incremented\n\n        if( onBond ){\n            // inter group bonds\n            if( bondAtomList ){\n                for( k = 0, kl = bondAtomList.length; k < kl; k += 2 ){\n                    var atomIndex1 = bondAtomList[ k ];\n                    var atomIndex2 = bondAtomList[ k + 1 ];\n                    if( ( atomIndex1 >= modelFirstAtomIndex && atomIndex1 <= modelLastAtomIndex ) ||\n                        ( atomIndex2 >= modelFirstAtomIndex && atomIndex2 <= modelLastAtomIndex )\n                    ){\n                        onBond({\n                            atomIndex1: atomIndex1,\n                            atomIndex2: atomIndex2,\n                            bondOrder: bondOrderList ? bondOrderList[ k / 2 ] : null\n                        });\n                    }\n                }\n            }\n        }\n\n        modelIndex += 1;\n    }\n\n}\n\n/**\n * Version name\n * @static\n * @type {String}\n */\nvar version = \"v1.1.0dev\";\n\n/**\n * Version name\n * @private\n * @type {String}\n */\nvar baseUrl = \"//mmtf.rcsb.org/v1.0/\";\n\n/**\n * URL of the RCSB webservice to obtain MMTF files\n * @static\n * @type {String}\n */\nvar fetchUrl = baseUrl + \"full/\";\n\n/**\n * URL of the RCSB webservice to obtain reduced MMTF files\n * @static\n * @type {String}\n */\nvar fetchReducedUrl = baseUrl + \"reduced/\";\n\n/**\n * Encode MMTF fields\n * @static\n * @param  {module:MmtfDecode.MmtfData} mmtfData - mmtf data\n * @return {Uint8Array} encoded MMTF fields\n */\nfunction encode( mmtfData ){\n    return encodeMsgpack( encodeMmtf( mmtfData ) );\n}\n\n/**\n * Decode MMTF fields\n * @static\n * @example\n * // bin is Uint8Array containing the mmtf msgpack\n * var mmtfData = MMTF.decode( bin );\n * console.log( mmtfData.numAtoms );\n *\n * @param  {Uint8Array|ArrayBuffer|module:MmtfDecode.EncodedMmtfData} binOrDict - binary MessagePack or encoded MMTF data\n * @param  {Object} [params] - decoding parameters\n * @param {String[]} params.ignoreFields - names of optional fields not to decode\n * @return {module:MmtfDecode.MmtfData} mmtfData\n */\nfunction decode( binOrDict, params ){\n\t// make sure binOrDict is not a plain Arraybuffer\n    if( binOrDict instanceof ArrayBuffer ){\n        binOrDict = new Uint8Array( binOrDict );\n    }\n\n    var inputDict;\n    if( binOrDict instanceof Uint8Array ){\n        // get dict from msgpack\n        inputDict = decodeMsgpack( binOrDict );\n    }else{\n        // already a dict\n        inputDict = binOrDict;\n    }\n\n    return decodeMmtf( inputDict, params );\n}\n\n/**\n * @callback module:MMTF.onLoad\n * @param {module:MmtfDecode.MmtfData} mmtfData - decoded mmtf data object\n */\n\n/**\n * helper method to fetch binary files from an URL\n * @private\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {String} baseUrl - URL to fetch from\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction _fetch( pdbid, baseUrl, onLoad, onError ){\n    var xhr = new XMLHttpRequest();\n    function _onLoad(){\n        try{\n            var mmtfData = decode( xhr.response );\n            onLoad( mmtfData );\n        }catch( error ){\n            onError( error );\n        }\n    }\n    xhr.addEventListener( \"load\", _onLoad, true );\n    xhr.addEventListener( \"error\", onError, true );\n    xhr.responseType = \"arraybuffer\";\n    xhr.open( \"GET\", baseUrl + pdbid.toUpperCase() );\n    xhr.send();\n}\n\n/**\n * Fetch MMTF file from RCSB webservice which contains\n * @static\n * @example\n * MMTF.fetch(\n *     \"3PQR\",\n *     // onLoad callback\n *     function( mmtfData ){ console.log( mmtfData ) },\n *     // onError callback\n *     function( error ){ console.error( error ) }\n * );\n *\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction fetch( pdbid, onLoad, onError ){\n    _fetch( pdbid, fetchUrl, onLoad, onError );\n}\n\n/**\n * Fetch reduced MMTF file from RCSB webservice which contains\n * protein C-alpha, nucleotide phosphate and ligand atoms\n * @static\n * @example\n * MMTF.fetchReduced(\n *     \"3PQR\",\n *     // onLoad callback\n *     function( mmtfData ){ console.log( mmtfData ) },\n *     // onError callback\n *     function( error ){ console.error( error ) }\n * );\n *\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction fetchReduced( pdbid, onLoad, onError ){\n    _fetch( pdbid, fetchReducedUrl, onLoad, onError );\n}\n\nexport { encode, decode, traverseMmtf as traverse, fetch, fetchReduced, version, fetchUrl, fetchReducedUrl, encodeMsgpack, encodeMmtf, decodeMsgpack, decodeMmtf };","/**\n * @file Mmtf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  buildUnitcellAssembly, calculateBondsBetween, calculateBondsWithin\n} from '../structure/structure-utils'\nimport { ChemCompHetero } from '../structure/structure-constants'\nimport Entity from '../structure/entity'\nimport Unitcell from '../symmetry/unitcell'\nimport Assembly, { AssemblyPart } from '../symmetry/assembly'\n\nimport { decodeMsgpack, decodeMmtf } from '../../lib/mmtf.es6'\nimport type { Structure } from '../ngl'\n\nconst SstrucMap: {[k: string]: number} = {\n  '0': 'i'.charCodeAt(0), // pi helix\n  '1': 's'.charCodeAt(0), // bend\n  '2': 'h'.charCodeAt(0), // alpha helix\n  '3': 'e'.charCodeAt(0), // extended\n  '4': 'g'.charCodeAt(0), // 3-10 helix\n  '5': 'b'.charCodeAt(0), // bridge\n  '6': 't'.charCodeAt(0), // turn\n  '7': 'l'.charCodeAt(0), // coil\n  '-1': ''.charCodeAt(0) // NA\n}\n\nclass MmtfParser extends StructureParser {\n  get type () { return 'mmtf' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/rcsb/mmtf\n\n    if (Debug) Log.time('MmtfParser._parse ' + this.name)\n\n    let i, il, j, jl, groupData\n\n    const s = this.structure\n    const sd: {[k: string]: any} = decodeMmtf(decodeMsgpack(this.streamer.data))\n\n    // structure header\n    const headerFields: (keyof Structure['header'])[] = [\n      'depositionDate', 'releaseDate', 'resolution',\n      'rFree', 'rWork', 'experimentalMethods'\n    ]\n    headerFields.forEach(function (name) {\n      if (sd[ name ] !== undefined) {\n        s.header[ name ] = sd[ name ]\n      }\n    })\n\n    let numBonds, numAtoms, numGroups, numChains, numModels\n    let chainsPerModel\n\n    s.id = sd.structureId\n    s.title = sd.title\n\n    s.atomStore.addField('formalCharge', 1, 'int8')\n\n    if (this.firstModelOnly || this.asTrajectory) {\n      numModels = 1\n      numChains = sd.chainsPerModel[ 0 ]\n\n      numGroups = 0\n      for (i = 0, il = numChains; i < il; ++i) {\n        numGroups += sd.groupsPerChain[ i ]\n      }\n\n      numAtoms = 0\n      for (i = 0, il = numGroups; i < il; ++i) {\n        groupData = sd.groupList[ sd.groupTypeList[ i ] ]\n        numAtoms += groupData.atomNameList.length\n      }\n\n      numBonds = sd.numBonds\n\n      chainsPerModel = [ numChains ]\n    } else {\n      numBonds = sd.numBonds\n      numAtoms = sd.numAtoms\n      numGroups = sd.numGroups\n      numChains = sd.numChains\n      numModels = sd.numModels\n\n      chainsPerModel = sd.chainsPerModel\n    }\n\n    numBonds += numGroups // add numGroups to have space for polymer bonds\n\n    //\n\n    if (this.asTrajectory) {\n      for (i = 0, il = sd.numModels; i < il; ++i) {\n        const frame = new Float32Array(numAtoms * 3)\n        const frameAtomOffset = numAtoms * i\n\n        for (j = 0; j < numAtoms; ++j) {\n          const j3 = j * 3\n          const offset = j + frameAtomOffset\n          frame[ j3 ] = sd.xCoordList[ offset ]\n          frame[ j3 + 1 ] = sd.yCoordList[ offset ]\n          frame[ j3 + 2 ] = sd.zCoordList[ offset ]\n        }\n\n        s.frames.push(frame)\n      }\n    }\n\n    // bondStore\n    const bAtomIndex1 = new Uint32Array(numBonds)\n    const bAtomIndex2 = new Uint32Array(numBonds)\n    const bBondOrder = new Uint8Array(numBonds)\n\n    const aGroupIndex = new Uint32Array(numAtoms)\n    const aFormalCharge = new Int8Array(numAtoms)\n\n    const gChainIndex = new Uint32Array(numGroups)\n    const gAtomOffset = new Uint32Array(numGroups)\n    const gAtomCount = new Uint32Array(numGroups)\n\n    const cModelIndex = new Uint16Array(numChains)\n    const cGroupOffset = new Uint32Array(numChains)\n    const cGroupCount = new Uint32Array(numChains)\n\n    const mChainOffset = new Uint32Array(numModels)\n    const mChainCount = new Uint32Array(numModels)\n\n    // set-up model-chain relations\n    let chainOffset = 0\n    for (i = 0, il = numModels; i < il; ++i) {\n      const modelChainCount = chainsPerModel[ i ]\n      mChainOffset[ i ] = chainOffset\n      mChainCount[ i ] = modelChainCount\n      for (j = 0; j < modelChainCount; ++j) {\n        cModelIndex[ j + chainOffset ] = i\n      }\n      chainOffset += modelChainCount\n    }\n\n    // set-up chain-residue relations\n    const groupsPerChain = sd.groupsPerChain\n    let groupOffset = 0\n    for (i = 0, il = numChains; i < il; ++i) {\n      const chainGroupCount = groupsPerChain[ i ]\n      cGroupOffset[ i ] = groupOffset\n      cGroupCount[ i ] = chainGroupCount\n      for (j = 0; j < chainGroupCount; ++j) {\n        gChainIndex[ j + groupOffset ] = i\n      }\n      groupOffset += chainGroupCount\n    }\n\n    /// ///\n    // get data from group map\n\n    let atomOffset = 0\n    let bondOffset = 0\n\n    for (i = 0, il = numGroups; i < il; ++i) {\n      groupData = sd.groupList[ sd.groupTypeList[ i ] ]\n      const groupAtomCount = groupData.atomNameList.length\n      const groupFormalChargeList = groupData.formalChargeList\n\n      const groupBondAtomList = groupData.bondAtomList\n      const groupBondOrderList = groupData.bondOrderList\n\n      for (j = 0, jl = groupBondOrderList.length; j < jl; ++j) {\n        bAtomIndex1[ bondOffset ] = atomOffset + groupBondAtomList[ j * 2 ]\n        bAtomIndex2[ bondOffset ] = atomOffset + groupBondAtomList[ j * 2 + 1 ]\n        bBondOrder[ bondOffset ] = groupBondOrderList[ j ]\n        bondOffset += 1\n      }\n\n      //\n\n      gAtomOffset[ i ] = atomOffset\n      gAtomCount[ i ] = groupAtomCount\n\n      for (j = 0; j < groupAtomCount; ++j) {\n        aGroupIndex[ atomOffset ] = i\n        aFormalCharge[ atomOffset ] = groupFormalChargeList[ j ]\n        atomOffset += 1\n      }\n    }\n\n    // extra bonds\n\n    const bondAtomList = sd.bondAtomList\n    if (bondAtomList) {\n      if (sd.bondOrderList) {\n        bBondOrder.set(sd.bondOrderList, bondOffset)\n      }\n\n      for (i = 0, il = bondAtomList.length; i < il; i += 2) {\n        const atomIndex1 = bondAtomList[ i ]\n        const atomIndex2 = bondAtomList[ i + 1 ]\n        if (atomIndex1 < numAtoms && atomIndex2 < numAtoms) {\n          bAtomIndex1[ bondOffset ] = atomIndex1\n          bAtomIndex2[ bondOffset ] = atomIndex2\n          bondOffset += 1\n        }\n      }\n    }\n\n    //\n\n    s.bondStore.length = bBondOrder.length\n    s.bondStore.count = bondOffset\n    s.bondStore.atomIndex1 = bAtomIndex1\n    s.bondStore.atomIndex2 = bAtomIndex2\n    s.bondStore.bondOrder = bBondOrder\n\n    s.atomStore.length = numAtoms\n    s.atomStore.count = numAtoms\n    s.atomStore.residueIndex = aGroupIndex\n    s.atomStore.atomTypeId = new Uint16Array(numAtoms)\n    s.atomStore.x = sd.xCoordList.subarray(0, numAtoms)\n    s.atomStore.y = sd.yCoordList.subarray(0, numAtoms)\n    s.atomStore.z = sd.zCoordList.subarray(0, numAtoms)\n    s.atomStore.serial = sd.atomIdList.subarray(0, numAtoms)\n    s.atomStore.bfactor = sd.bFactorList.subarray(0, numAtoms)\n    s.atomStore.altloc = sd.altLocList.subarray(0, numAtoms)\n    s.atomStore.occupancy = sd.occupancyList.subarray(0, numAtoms)\n    s.atomStore.formalCharge = aFormalCharge\n\n    s.residueStore.length = numGroups\n    s.residueStore.count = numGroups\n    s.residueStore.chainIndex = gChainIndex\n    s.residueStore.residueTypeId = sd.groupTypeList\n    s.residueStore.atomOffset = gAtomOffset\n    s.residueStore.atomCount = gAtomCount\n    s.residueStore.resno = sd.groupIdList.subarray(0, numGroups)\n    s.residueStore.sstruc = sd.secStructList.subarray(0, numGroups)\n    s.residueStore.inscode = sd.insCodeList.subarray(0, numGroups)\n\n    s.chainStore.length = numChains\n    s.chainStore.count = numChains\n    s.chainStore.entityIndex = new Uint16Array(numChains)\n    s.chainStore.modelIndex = cModelIndex\n    s.chainStore.residueOffset = cGroupOffset\n    s.chainStore.residueCount = cGroupCount\n    s.chainStore.chainname = sd.chainNameList.subarray(0, numChains * 4)\n    s.chainStore.chainid = sd.chainIdList.subarray(0, numChains * 4)\n\n    s.modelStore.length = numModels\n    s.modelStore.count = numModels\n    s.modelStore.chainOffset = mChainOffset\n    s.modelStore.chainCount = mChainCount\n\n    //\n\n    let groupTypeDict: {[k: number]: any} = {}\n    for (i = 0, il = sd.groupList.length; i < il; ++i) {\n      const groupType = sd.groupList[ i ]\n      const atomTypeIdList: number[] = []\n      for (j = 0, jl = groupType.atomNameList.length; j < jl; ++j) {\n        const element = groupType.elementList[ j ].toUpperCase()\n        const atomname = groupType.atomNameList[ j ]\n        atomTypeIdList.push(s.atomMap.add(atomname, element))\n      }\n      const chemCompType = groupType.chemCompType.toUpperCase()\n      const hetFlag = ChemCompHetero.includes(chemCompType)\n\n      const numGroupBonds = groupType.bondOrderList.length\n      const atomIndices1 = new Array(numGroupBonds)\n      const atomIndices2 = new Array(numGroupBonds)\n      for (j = 0; j < numGroupBonds; ++j) {\n        atomIndices1[ j ] = groupType.bondAtomList[ j * 2 ]\n        atomIndices2[ j ] = groupType.bondAtomList[ j * 2 + 1 ]\n      }\n      const bonds = {\n        atomIndices1: atomIndices1,\n        atomIndices2: atomIndices2,\n        bondOrders: groupType.bondOrderList\n      }\n\n      groupTypeDict[ i ] = s.residueMap.add(\n        groupType.groupName, atomTypeIdList, hetFlag, chemCompType, bonds\n      )\n    }\n\n    for (i = 0, il = numGroups; i < il; ++i) {\n      s.residueStore.residueTypeId[ i ] = groupTypeDict[ s.residueStore.residueTypeId[ i ] ]\n    }\n\n    for (i = 0, il = s.atomStore.count; i < il; ++i) {\n      const residueIndex = s.atomStore.residueIndex[ i ]\n      const residueType = s.residueMap.list[ s.residueStore.residueTypeId[ residueIndex ] ]\n      const resAtomOffset = s.residueStore.atomOffset[ residueIndex ]\n      s.atomStore.atomTypeId[ i ] = residueType.atomTypeIdList[ i - resAtomOffset ]\n    }\n\n    if (sd.secStructList) {\n      const secStructLength: number = sd.secStructList.length\n      for (i = 0, il = s.residueStore.count; i < il; ++i) {\n        // with ( i % secStructLength ) secStruct entries are reused\n        const sstruc = SstrucMap[ s.residueStore.sstruc[ i % secStructLength ] ]\n        if (sstruc !== undefined) s.residueStore.sstruc[ i ] = sstruc\n      }\n    }\n\n    //\n\n    if (sd.entityList) {\n      sd.entityList.forEach(function (e: Entity, i: number) {\n        s.entityList[ i ] = new Entity(\n          s, i, e.description, e.type, e.chainIndexList\n        )\n      })\n    }\n\n    if (sd.bioAssemblyList) {\n      sd.bioAssemblyList.forEach(function (_assembly: any, k: number) {\n        const id = k + 1\n        const assembly = new Assembly('' + id)\n        s.biomolDict[ 'BU' + id ] = assembly\n        let chainToPart: {[k: string]: AssemblyPart} = {}\n        _assembly.transformList.forEach(function (_transform: any) {\n          const matrix = new Matrix4().fromArray(_transform.matrix).transpose()\n          const chainList: string[] = _transform.chainIndexList.map(function (chainIndex: number) {\n            let chainname = ''\n            for (let k = 0; k < 4; ++k) {\n              const code = sd.chainNameList[ chainIndex * 4 + k ]\n              if (code) {\n                chainname += String.fromCharCode(code)\n              } else {\n                break\n              }\n            }\n            return chainname\n          })\n          const part = chainToPart[ chainList.toString() ]\n          if (part) {\n            part.matrixList.push(matrix)\n          } else {\n            chainToPart[ chainList.toString() ] = assembly.addPart([ matrix ], chainList)\n          }\n        })\n      })\n    }\n\n    if (sd.ncsOperatorList) {\n      const ncsName = 'NCS'\n      const ncsAssembly = new Assembly(ncsName)\n      const ncsPart = ncsAssembly.addPart()\n      sd.ncsOperatorList.forEach(function (_operator: number[]) {\n        const matrix = new Matrix4().fromArray(_operator).transpose()\n        ncsPart.matrixList.push(matrix)\n      })\n      if (ncsPart.matrixList.length > 0) {\n        s.biomolDict[ ncsName ] = ncsAssembly\n      }\n    }\n\n    const uc = sd.unitCell\n    if (uc && Array.isArray(uc) && uc[ 0 ]) {\n      s.unitcell = new Unitcell({\n        a: uc[ 0 ],\n        b: uc[ 1 ],\n        c: uc[ 2 ],\n        alpha: uc[ 3 ],\n        beta: uc[ 4 ],\n        gamma: uc[ 5 ],\n        spacegroup: sd.spaceGroup\n      })\n    } else {\n      s.unitcell = undefined\n    }\n\n    // calculate backbone bonds\n    calculateBondsBetween(s, true)\n\n    // calculate rung bonds\n    calculateBondsWithin(s, true)\n\n    s.finalizeAtoms()\n    s.finalizeBonds()\n\n    buildUnitcellAssembly(s)\n\n    if (Debug) Log.timeEnd('MmtfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('mmtf', MmtfParser)\n\nexport default MmtfParser\n","/**\n * @file Mol2 Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport {\n  assignResidueTypeBonds,\n  calculateChainnames, calculateSecondaryStructure,\n  calculateBondsBetween, calculateBondsWithin\n} from '../structure/structure-utils'\nimport StructureParser from './structure-parser'\n\nconst reWhitespace = /\\s+/\nconst bondTypes: {[k: string]: number} = {\n  '1': 1,\n  '2': 2,\n  '3': 3,\n  'am': 1, // amide\n  'ar': 1, // aromatic\n  'du': 1, // dummy\n  'un': 1, // unknown\n  'nc': 0 // not connected\n}\n\nclass Mol2Parser extends StructureParser {\n  get type () { return 'mol2' }\n\n  _parse () {\n    // http://paulbourke.net/dataformats/mol2/\n\n    if (Debug) Log.time('Mol2Parser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n\n    const frames = s.frames\n    let doFrames = false\n    let currentFrame: Float32Array, currentCoord: number\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 60))\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    let idx = 0\n    let moleculeLineNo = 0\n    let modelAtomIdxStart = 0\n    let modelIdx = -1\n    let numAtoms = 0\n\n    let currentRecordType = 0\n    let moleculeRecordType = 1\n    let atomRecordType = 2\n    let bondRecordType = 3\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (line === '' || line[ 0 ] === '#') continue\n\n        if (line[ 0 ] === '@') {\n          if (line === '@<TRIPOS>MOLECULE') {\n            currentRecordType = moleculeRecordType\n            moleculeLineNo = 0\n\n            ++modelIdx\n          } else if (line === '@<TRIPOS>ATOM') {\n            currentRecordType = atomRecordType\n            modelAtomIdxStart = atomStore.count\n\n            if (asTrajectory) {\n              currentCoord = 0\n              currentFrame = new Float32Array(numAtoms * 3)\n              frames.push(currentFrame)\n\n              if (modelIdx > 0) doFrames = true\n            }\n          } else if (line === '@<TRIPOS>BOND') {\n            currentRecordType = bondRecordType\n          } else {\n            currentRecordType = 0\n          }\n        } else if (currentRecordType === moleculeRecordType) {\n          if (moleculeLineNo === 0) {\n            s.title = line\n            s.id = line\n          } else if (moleculeLineNo === 1) {\n            const ls = line.split(reWhitespace)\n            numAtoms = parseInt(ls[ 0 ])\n            // num_atoms [num_bonds [num_subst [num_feat [num_sets]]]]\n          } else if (moleculeLineNo === 2) {\n\n            // const molType = line;\n            // SMALL, BIOPOLYMER, PROTEIN, NUCLEIC_ACID, SACCHARIDE\n\n          } else if (moleculeLineNo === 3) {\n\n            // const chargeType = line;\n            // NO_CHARGES, DEL_RE, GASTEIGER, GAST_HUCK, HUCKEL,\n            // PULLMAN, GAUSS80_CHARGES, AMPAC_CHARGES,\n            // MULLIKEN_CHARGES, DICT_ CHARGES, MMFF94_CHARGES,\n            // USER_CHARGES\n\n          } else if (moleculeLineNo === 4) {\n\n            // const statusBits = line;\n\n          } else if (moleculeLineNo === 5) {\n\n            // const molComment = line;\n\n          }\n\n          ++moleculeLineNo\n        } else if (currentRecordType === atomRecordType) {\n          const ls = line.split(reWhitespace)\n\n          if (firstModelOnly && modelIdx > 0) continue\n\n          const x = parseFloat(ls[ 2 ])\n          const y = parseFloat(ls[ 3 ])\n          const z = parseFloat(ls[ 4 ])\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          const serial = ls[ 0 ]\n          const atomname = ls[ 1 ]\n          const element = ls[ 5 ].split('.')[ 0 ]\n          const resno = ls[ 6 ] ? parseInt(ls[ 6 ]) : 1\n          const resname = ls[ 7 ] ? ls[ 7 ] : ''\n          const partialCharge = ls[ 8 ] ? parseFloat(ls[ 8 ]) : 0.0\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = + serial\n          atomStore.partialCharge![ idx ] = partialCharge\n\n          sb.addAtom(modelIdx, '', '', resname, resno, true)\n\n          idx += 1\n        } else if (currentRecordType === bondRecordType) {\n          if (firstModelOnly && modelIdx > 0) continue\n          if (asTrajectory && modelIdx > 0) continue\n\n          const ls = line.split(reWhitespace)\n\n          // ls[ 0 ] is bond id\n          ap1.index = parseInt(ls[ 1 ]) - 1 + modelAtomIdxStart\n          ap2.index = parseInt(ls[ 2 ]) - 1 + modelAtomIdxStart\n          const order = bondTypes[ ls[ 3 ] ]\n\n          s.bondStore.addBond(ap1, ap2, order)\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    calculateChainnames(s)\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true)\n    s.finalizeBonds()\n    assignResidueTypeBonds(s)\n    calculateSecondaryStructure(s)\n\n    if (Debug) Log.timeEnd('Mol2Parser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('mol2', Mol2Parser)\n\nexport default Mol2Parser\n","/**\n * @file Pdbqt Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport PdbParser from './pdb-parser'\n\n// autodock variant of PDB format with\n// - atom partial charges (empty column in pdb format)\n// - atom types (bfactor column in pdb format)\n// http://autodock.scripps.edu/faqs-help/faq/what-is-the-format-of-a-pdbqt-file\n\nclass PdbqtParser extends PdbParser {\n  get type () { return 'pdbqt' }\n}\n\nParserRegistry.add('pdbqt', PdbqtParser)\n\nexport default PdbqtParser\n","/**\n * @file Pqr Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport PdbParser from './pdb-parser'\n\n// http://www.poissonboltzmann.org/docs/file-format-info/\n\nclass PqrParser extends PdbParser {\n  get type () { return 'pqr' }\n}\n\nParserRegistry.add('pqr', PqrParser)\n\nexport default PqrParser\n","/**\n * @file Sdf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { assignResidueTypeBonds } from '../structure/structure-utils'\nimport StructureParser from './structure-parser'\n\nconst reItem = /> +<(.+)>/\n\nclass SdfParser extends StructureParser {\n  get type () { return 'sdf' }\n\n  _parse () {\n    // https://en.wikipedia.org/wiki/Chemical_table_file#SDF\n    // http://download.accelrys.com/freeware/ctfile-formats/ctfile-formats.zip\n\n    if (Debug) Log.time('SdfParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n\n    const headerLines = this.streamer.peekLines(2)\n\n    s.id = headerLines[ 0 ].trim()\n    s.title = headerLines[ 1 ].trim()\n\n    const frames = s.frames\n    let doFrames = false\n    let currentFrame: Float32Array, currentCoord: number\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 50))\n    atomStore.addField('formalCharge', 1, 'int8')\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    let idx = 0\n    let lineNo = 0  // for V2000: current line number in currently parsed Mol file\n    let modelIdx = 0\n    let modelAtomIdxStart = 0\n\n    const sdfData: {[k: string]: string[]}[] = []\n    let currentItem: string|boolean = false\n    let currentData: {[k: string]: string[]} = {}\n    let mItem: RegExpMatchArray | null\n    s.extraData.sdf = sdfData\n\n    let atomCount, bondCount, atomStart: number, atomEnd: number, bondStart: number, bondEnd: number, x: number, y: number, z: number, atomname: string, element: string, atomindex: number, order: number\n    let isV3000 = false, isAtomBlock = false, isBondBlock = false\n    let tokens: string[] = [], acc: string[] = []\n    const atomindexToStoreindex = new Map<number, number>()\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (isV3000 && line) {\n          tokens = line.substring(7).split(' ')\n\n          // Entity properties may extend over multiple lines (hanging line finishes with '-')\n          // Tokens are accumulated to be processed at the same time for a given entity\n          if (acc.length) {\n            tokens = [...acc, ...tokens]\n            acc = []\n          }\n          if (tokens[tokens.length - 1] === '-') {\n            tokens.pop();\n            acc = tokens;\n            continue;\n          }\n        }\n\n        if (line.substr(0, 4) === '$$$$') {\n          lineNo = -1\n          ++modelIdx\n          modelAtomIdxStart = atomStore.count\n          sdfData.push(currentData)\n          currentData = {}\n          currentItem = false\n          isV3000 = false\n        } else if (lineNo === 3) {\n          isV3000 = line.indexOf(' V3000') > -1\n\n          if (isV3000) {\n            atomindexToStoreindex.clear()\n          } else {\n\n            atomCount = parseInt(line.substr(0, 3))\n            bondCount = parseInt(line.substr(3, 3))\n\n            atomStart = 4\n            atomEnd = atomStart + atomCount\n            bondStart = atomEnd\n            bondEnd = bondStart + bondCount\n\n            if (asTrajectory) {\n              currentCoord = 0\n              currentFrame = new Float32Array(atomCount * 3)\n              frames.push(currentFrame)\n\n              if (modelIdx > 0) doFrames = true\n            }\n          }\n        } else if (isV3000 && tokens[0] === 'COUNTS') {\n          atomCount = parseInt(tokens[1]);\n\n          if (asTrajectory) {\n            currentCoord = 0\n            currentFrame = new Float32Array(atomCount * 3)\n            frames.push(currentFrame)\n\n            if (modelIdx > 0) doFrames = true\n          }\n        } else if (isV3000 && tokens.length == 2) {\n          if (tokens[1] === 'ATOM') {\n            if (tokens[0] === 'BEGIN') isAtomBlock = true\n            else if (tokens[0] === 'END') isAtomBlock = false\n          } else if (tokens[1] === 'BOND') {\n            if (tokens[0] === 'BEGIN') isBondBlock = true\n            else if (tokens[0] === 'END') isBondBlock = false\n          }\n        } else if (\n          isAtomBlock \n          || (!isV3000 && lineNo >= atomStart && lineNo < atomEnd)\n        ) {\n          if (firstModelOnly && modelIdx > 0) continue\n\n          let charge = 0\n          if (isV3000) {\n            x = parseFloat(tokens[2])\n            y = parseFloat(tokens[3])\n            z = parseFloat(tokens[4])\n\n            element = tokens[1]\n            atomindex = parseInt(tokens[0])\n            atomindexToStoreindex.set(atomindex, idx)\n            atomname = element + atomindex\n\n            if (tokens.length > 6) {\n              let chgTok = tokens.slice(6).find(t => t.indexOf('CHG=') === 0);\n              if (chgTok) {\n                charge = parseInt(chgTok.substring(4))\n              }\n            }\n          } else {\n            x = parseFloat(line.substr(0, 10))\n            y = parseFloat(line.substr(10, 10))\n            z = parseFloat(line.substr(20, 10))\n\n            element = line.substr(31, 3).trim()\n            atomname = element + (idx - modelAtomIdxStart + 1)\n          }\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = isV3000 ? atomindex : idx\n          atomStore.formalCharge![ idx ] = charge\n\n          sb.addAtom(modelIdx, '', '', 'HET', 1, true)\n\n          idx += 1\n        } else if (\n          isBondBlock \n          || (!isV3000 && lineNo >= bondStart && lineNo < bondEnd)\n        ) {\n          if (firstModelOnly && modelIdx > 0) continue\n          if (asTrajectory && modelIdx > 0) continue\n\n          if (isV3000) {\n            ap1.index = atomindexToStoreindex.get(parseInt(tokens[2]))!\n            ap2.index = atomindexToStoreindex.get(parseInt(tokens[3]))!\n            order = parseInt(tokens[1])\n          } else {\n            ap1.index = parseInt(line.substr(0, 3)) - 1 + modelAtomIdxStart\n            ap2.index = parseInt(line.substr(3, 3)) - 1 + modelAtomIdxStart\n            order = parseInt(line.substr(6, 3))\n          }\n\n          s.bondStore.addBond(ap1, ap2, order)\n        } else if (line.substr(0, 6) === 'M  CHG') {\n          const chargeCount = parseInt(line.substr(6, 3))\n          for (let ci = 0, coffset = 10; ci < chargeCount; ++ci, coffset += 8) {\n            const aToken = parseInt(line.substr(coffset, 3))\n            const atomIdx = aToken - 1 + modelAtomIdxStart\n            const cToken = parseInt(line.substr(coffset + 4, 3))\n            atomStore.formalCharge![ atomIdx ] = cToken\n          }\n        // eslint-disable-next-line no-cond-assign\n        } else if (line.charAt(0) === '>' && (mItem = line.match(reItem))) {\n          currentItem = mItem[ 1 ]\n          currentData[ currentItem ] = []\n        } else if (currentItem !== false && line) {\n          currentData[ <string>currentItem ].push(line)\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('SdfParser._parse ' + this.name)\n  }\n\n  _postProcess () {\n    assignResidueTypeBonds(this.structure)\n  }\n}\n\nParserRegistry.add('sdf', SdfParser)\nParserRegistry.add('sd', SdfParser)\nParserRegistry.add('mol', SdfParser)\n\nexport default SdfParser\n","/**\n * @file Prmtop Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, calculateChainnames\n} from '../structure/structure-utils'\n\nconst amberChargeUnitFactor = 18.2223\n\nconst enum Mode {\n  Title,\n  Pointers,\n  AtomName,\n  Charge,\n  Mass,\n  ResidueLabel,\n  ResiduePointer,\n  BondsIncHydrogen,\n  BondsWithoutHydrogen,\n  Radii\n}\n\nfunction parseIntSubstr (line: string, start: number, length: number) {\n  return parseInt(line.substr(start, length).trim())\n}\n\nclass PrmtopParser extends StructureParser {\n  get type () { return 'prmtop' }\n\n  _parse () {\n    // http://ambermd.org/prmtop.pdf\n    // http://ambermd.org/formats.html#topology\n\n    if (Debug) Log.time('PrmtopParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n    atomStore.addField('radius', 1, 'float32')\n\n    const title: string[] = []\n    const pointersDict: {[k: string]: number} = {}\n    const pointers = [\n      'NATOM', 'NTYPES', 'NBONH', 'MBONA', 'NTHETH', 'MTHETA',\n      'NPHIH', 'MPHIA', 'NHPARM', 'NPARM', 'NNB', 'NRES',\n      'NBONA', 'NTHETA', 'NPHIA', 'NUMBND', 'NUMANG', 'NPTRA',\n      'NATYP', 'NPHB', 'IFPERT', 'NBPER', 'NGPER', 'NDPER',\n      'MBPER', 'MGPER', 'MDPER', 'IFBOX', 'NMXRS', 'IFCAP',\n      'NUMEXTRA', 'NCOPY'\n    ]\n    pointers.forEach(name => { pointersDict[ name ] = 0 })\n\n    let atomNames: string[]\n    let charges: Float32Array\n    let radii: Float32Array\n    let bAtomIndex1: Uint32Array\n    let bAtomIndex2: Uint32Array\n    let bBondOrder: Uint8Array = new Uint8Array(0)\n    let residueLabels: string[]\n    let residuePointers: Uint32Array\n\n    let mode: number|undefined\n    // let currentFormat\n    let curIdx: number\n    let bondIdx: number\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n        const lt = line.trim()\n\n        if (!lt) {\n          continue\n        } else if (line.startsWith('%FORMAT')) {\n          // currentFormat = lt.substring(8, lt.length - 1)\n        } else if (line.startsWith('%FLAG')) {\n          const flag = line.substr(5).trim()\n          curIdx = 0\n\n          if (flag === 'TITLE') {\n            mode = Mode.Title\n          } else if (flag === 'POINTERS') {\n            mode = Mode.Pointers\n          } else if (flag === 'ATOM_NAME') {\n            mode = Mode.AtomName\n          } else if (flag === 'CHARGE') {\n            mode = Mode.Charge\n          } else if (flag === 'MASS') {\n            mode = Mode.Mass\n          } else if (flag === 'RESIDUE_LABEL') {\n            mode = Mode.ResidueLabel\n          } else if (flag === 'RESIDUE_POINTER') {\n            mode = Mode.ResiduePointer\n          } else if (flag === 'BONDS_INC_HYDROGEN') {\n            bondIdx = 0\n            mode = Mode.BondsIncHydrogen\n          } else if (flag === 'BONDS_WITHOUT_HYDROGEN') {\n            bondIdx = pointersDict['NBONH']\n            mode = Mode.BondsWithoutHydrogen\n          } else if (flag === 'RADII') {\n            mode = Mode.Radii\n          } else {\n            mode = undefined\n          }\n        } else if (mode === Mode.Title) {\n          title.push(lt)\n        } else if (mode === Mode.Pointers) {\n          const n = Math.min(curIdx + 10, 32)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            pointersDict[pointers[curIdx]] = parseInt(\n              line.substr(i * 8, 8).trim()\n            )\n          }\n          atomNames = new Array(pointersDict.NATOM)\n          charges = new Float32Array(pointersDict.NATOM)\n          radii = new Float32Array(pointersDict.NATOM)\n          atomStore.resize(pointersDict.NATOM)\n          const bondCount = pointersDict.NBONH + pointersDict.MBONA\n          bAtomIndex1 = new Uint32Array(bondCount)\n          bAtomIndex2 = new Uint32Array(bondCount)\n          bBondOrder = new Uint8Array(bondCount)\n          residueLabels = new Array(pointersDict.NRES)\n          residuePointers = new Uint32Array(pointersDict.NRES)\n        } else if (mode === Mode.AtomName) {\n          const n = Math.min(curIdx + 20, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            atomNames[curIdx] = line.substr(i * 4, 4).trim()\n          }\n        } else if (mode === Mode.Charge) {\n          const n = Math.min(curIdx + 5, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            charges[curIdx] = parseFloat(line.substr(i * 16, 16)) / amberChargeUnitFactor\n          }\n        } else if (mode === Mode.Mass) {\n\n          // not currently used\n\n        } else if (mode === Mode.ResidueLabel) {\n          const n = Math.min(curIdx + 20, pointersDict.NRES)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            residueLabels[curIdx] = line.substr(i * 4, 4).trim()\n          }\n        } else if (mode === Mode.ResiduePointer) {\n          const n = Math.min(curIdx + 10, pointersDict.NRES)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            residuePointers[curIdx] = parseIntSubstr(line, i * 8, 8)\n          }\n        } else if (mode === Mode.BondsIncHydrogen) {\n          const n = Math.min(curIdx + 10, pointersDict.NBONH * 3)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            const r = curIdx % 3\n            if (r === 0) {\n              bAtomIndex1[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n            } if (r === 1) {\n              bAtomIndex2[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n              bBondOrder[bondIdx] = 1\n              ++bondIdx\n            }\n          }\n        } else if (mode === Mode.BondsWithoutHydrogen) {\n          const n = Math.min(curIdx + 10, pointersDict.MBONA * 3)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            const r = curIdx % 3\n            if (r === 0) {\n              bAtomIndex1[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n            } if (r === 1) {\n              bAtomIndex2[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n              bBondOrder[bondIdx] = 1\n              ++bondIdx\n            }\n          }\n        } else if (mode === Mode.Radii) {\n          const n = Math.min(curIdx + 5, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            radii[curIdx] = parseFloat(line.substr(i * 16, 16))\n          }\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    s.title = title.join(' ')\n\n    const atomCount = pointersDict.NATOM\n    let curResIdx = 0\n    let curResname = residueLabels![0]\n    let curResno = 1\n    for (let i = 0; i < atomCount; ++i) {\n      if (i + 1 === residuePointers![curResIdx + 1]) {\n        ++curResIdx\n        curResname = residueLabels![curResIdx]\n        curResno = curResIdx + 1\n      }\n      atomStore.atomTypeId[i] = atomMap.add(atomNames![i])\n      atomStore.serial[i] = i + 1\n      sb.addAtom(0, '', '', curResname, curResno, false)\n    }\n\n    atomStore.partialCharge!.set(charges!)\n    atomStore.radius.set(radii!)\n\n    s.bondStore.length = bBondOrder!.length\n    s.bondStore.count = bBondOrder!.length\n    s.bondStore.atomIndex1 = bAtomIndex1!\n    s.bondStore.atomIndex2 = bAtomIndex2!\n    s.bondStore.bondOrder = bBondOrder\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    calculateChainnames(s, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('PrmtopParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('prmtop', PrmtopParser)\nParserRegistry.add('parm7', PrmtopParser)\n\nexport default PrmtopParser\n","/**\n * @file Psf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, getChainname\n} from '../structure/structure-utils'\n\nconst TitleMode = 1\nconst AtomMode = 2\nconst BondMode = 3\nconst AngleMode = 4\nconst DihedralMode = 5\nconst ImproperMode = 6\n\nconst reWhitespace = /\\s+/\nconst reTitle = /(^\\*|REMARK)*/\n\nclass PsfParser extends StructureParser {\n  get type () { return 'psf' }\n\n  _parse () {\n    // http://www.ks.uiuc.edu/Training/Tutorials/namd/namd-tutorial-unix-html/node23.html\n\n    if (Debug) Log.time('PsfParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    const title: string[] = []\n\n    let mode: number|undefined\n    let chainid: string\n    let lastSegid: string\n    let idx = 0\n    let chainIdx = 0\n    let bondIdx = 0\n    let bAtomIndex1: Uint32Array, bAtomIndex2: Uint32Array, bBondOrder: Uint8Array\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (!line) {\n          mode = undefined\n          continue\n        }\n\n        if (mode === AtomMode) {\n          const ls = line.split(reWhitespace)\n\n          const serial = parseInt(ls[ 0 ])\n          const segid = ls[ 1 ]\n          const resno = parseInt(ls[ 2 ])\n          const resname = ls[ 3 ]\n          const atomname = ls[ 4 ]\n          const charge = parseFloat(ls[ 6 ])\n\n          if (segid !== lastSegid) {\n            chainid = getChainname(chainIdx)\n            ++chainIdx\n          }\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname)\n\n          atomStore.serial[ idx ] = serial\n          atomStore.partialCharge![ idx ] = charge\n\n          sb.addAtom(0, chainid, chainid, resname, resno, false)\n\n          idx += 1\n          lastSegid = segid\n        } else if (mode === BondMode) {\n          const ls = line.split(reWhitespace)\n\n          for (let j = 0, m = ls.length; j < m; j += 2) {\n            bAtomIndex1[ bondIdx ] = parseInt(ls[ j ]) - 1\n            bAtomIndex2[ bondIdx ] = parseInt(ls[ j + 1 ]) - 1\n            bBondOrder[ bondIdx ] = 1\n            bondIdx += 1\n          }\n        } else if (mode === TitleMode) {\n          title.push(line.replace(reTitle, '').trim())\n        } else if (mode === AngleMode) {\n\n          // currently not used\n\n        } else if (mode === DihedralMode) {\n\n          // currently not used\n\n        } else if (mode === ImproperMode) {\n\n          // currently not used\n\n        } else if (line.includes('!NATOM')) {\n          mode = AtomMode\n\n          const numAtoms = parseInt(line.split(reWhitespace)[ 0 ])\n          atomStore.resize(numAtoms)\n        } else if (line.includes('!NBOND')) {\n          mode = BondMode\n\n          const numBonds = parseInt(line.split(reWhitespace)[ 0 ])\n          bAtomIndex1 = new Uint32Array(numBonds)\n          bAtomIndex2 = new Uint32Array(numBonds)\n          bBondOrder = new Uint8Array(numBonds)\n        } else if (line.includes('!NTITLE')) {\n          mode = TitleMode\n        } else if (line.includes('!NTHETA')) {\n          mode = AngleMode\n        } else if (line.includes('!NPHI')) {\n          mode = DihedralMode\n        } else if (line.includes('!NIMPHI')) {\n          mode = ImproperMode\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    s.title = title.join(' ')\n\n    s.bondStore.length = bBondOrder!.length\n    s.bondStore.count = bondIdx\n    s.bondStore.atomIndex1 = bAtomIndex1!\n    s.bondStore.atomIndex2 = bAtomIndex2!\n    s.bondStore.bondOrder = bBondOrder!\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('PsfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('psf', PsfParser)\n\nexport default PsfParser\n","/**\n * @file Top Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport { WaterNames } from '../structure/structure-constants'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, getChainname\n} from '../structure/structure-utils'\n\nconst enum Mode {\n  System,\n  Molecules,\n  Moleculetype,\n  Atoms,\n  Bonds\n}\n\nconst reField = /\\[ (.+) \\]/\nconst reWhitespace = /\\s+/\n\nclass TopParser extends StructureParser {\n  get type () { return 'top' }\n\n  _parse () {\n    // http://manual.gromacs.org/online/top.html\n\n    if (Debug) Log.time('TopParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const bondStore = s.bondStore\n\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    const molecules: [string, number][] = []\n    const moleculetypeDict: {[k: string]: {atoms: any[], bonds: any[] }} = {}\n\n    let currentMoleculetype: {\n      atoms: [number, string, string, number][],\n      bonds: [number, number][]\n    }\n    let mode: number|undefined\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n        let lt = line.trim()\n\n        if (!lt || lt[0] === '*' || lt[0] === ';') {\n          continue\n        }\n\n        if (lt.startsWith('#include')) {\n          throw new Error('TopParser: #include statements not allowed')\n        }\n\n        const fieldMatch = line.match(reField)\n        if (fieldMatch !== null) {\n          const name = fieldMatch[1]\n          if (name === 'moleculetype') {\n            mode = Mode.Moleculetype\n            currentMoleculetype = {\n              atoms: [],\n              bonds: []\n            }\n          } else if (name === 'atoms') {\n            mode = Mode.Atoms\n          } else if (name === 'bonds') {\n            mode = Mode.Bonds\n          } else if (name === 'system') {\n            mode = Mode.System\n          } else if (name === 'molecules') {\n            mode = Mode.Molecules\n          } else {\n            mode = undefined\n          }\n          continue\n        }\n\n        const cIdx = lt.indexOf(';')\n        if (cIdx !== -1) {\n          lt = lt.substring(0, cIdx).trim()\n        }\n        if (mode === Mode.Moleculetype) {\n          const molName = lt.split(reWhitespace)[0]\n          moleculetypeDict[molName] = currentMoleculetype\n        } else if (mode === Mode.Atoms) {\n          const ls = lt.split(reWhitespace)\n          currentMoleculetype.atoms.push([\n            parseInt(ls[2]), // resnr\n            ls[3], // residue\n            ls[4], // atom\n            parseFloat(ls[6]) // charge\n          ])\n        } else if (mode === Mode.Bonds) {\n          const ls = lt.split(reWhitespace)\n          currentMoleculetype.bonds.push([\n            parseInt(ls[0]), // ai\n            parseInt(ls[1]) // aj\n          ])\n        } else if (mode === Mode.System) {\n          s.title = lt\n        } else if (mode === Mode.Molecules) {\n          const ls = lt.split(reWhitespace)\n          molecules.push([\n            ls[0], // name\n            parseInt(ls[1]) // count\n          ])\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    let atomCount = 0\n    let bondCount = 0\n    molecules.forEach(function (val) {\n      const [name, molCount] = val\n      const molType = moleculetypeDict[name]\n      atomCount += molCount * molType.atoms.length\n      bondCount += molCount * molType.bonds.length\n    })\n\n    atomStore.resize(atomCount)\n    bondStore.resize(bondCount)\n\n    let atomIdx = 0\n    let resIdx = 0\n    let chainidIdx = 0\n    let chainnameIdx = 0\n    let bondIdx = 0\n    let atomOffset = 0\n    let lastResno: number\n\n    molecules.forEach(function (val) {\n      const [name, molCount] = val\n      const molType = moleculetypeDict[name]\n      const chainname = getChainname(chainnameIdx)\n      for (let i = 0; i < molCount; ++i) {\n        lastResno = -1\n        const chainid = WaterNames.includes(name) ? chainname : getChainname(chainidIdx)\n        molType.atoms.forEach(function (atomData) {\n          const [resno, resname, atomname, charge] = atomData\n          if (resno !== lastResno) {\n            ++resIdx\n          }\n          atomStore.atomTypeId[atomIdx] = atomMap.add(atomname)\n          atomStore.serial[atomIdx] = atomIdx + 1\n          atomStore.partialCharge![atomIdx] = charge\n          sb.addAtom(0, chainname, chainid, resname, resIdx + 1, false)\n          ++atomIdx\n          lastResno = resno\n        })\n        molType.bonds.forEach(function (bondData) {\n          bondStore.atomIndex1[bondIdx] = atomOffset + bondData[0] - 1\n          bondStore.atomIndex2[bondIdx] = atomOffset + bondData[1] - 1\n          ++bondIdx\n        })\n        ++chainidIdx\n        atomOffset += molType.atoms.length\n      }\n      ++chainnameIdx\n    })\n\n    bondStore.count = bondCount\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('TopParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('top', TopParser)\n\nexport default TopParser\n","/**\n * @file Trajectory Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Parser, { ParserParameters } from './parser'\nimport Frames from '../trajectory/frames'\nimport Streamer from '../streamer/streamer';\n\nclass TrajectoryParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.frames = new Frames(this.name, this.path)\n  }\n\n  get type () { return 'trajectory' }\n  get __objName () { return 'frames' }\n}\n\nexport default TrajectoryParser\n","/**\n * @file Netcdf Reader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n *\n * Adapted from https://github.com/cheminfo-js/netcdfjs\n * MIT License, Copyright (c) 2016 cheminfo\n */\n\nimport IOBuffer from './io-buffer'\n\nexport interface NetCDFRecordDimension {\n  length: number,\n  id?: number,\n  name?: string,\n  recordStep?: number\n}\n\nexport interface NetCDFHeader {\n  recordDimension: NetCDFRecordDimension,\n  version: number,\n  dimensions: any[],\n  globalAttributes: any[],\n  variables: any[]\n}\n\nexport interface NetCDFDimension {\n  name: string,\n  size: number\n}\n\n/**\n * Throws a non-valid NetCDF exception if the statement it's true\n * @ignore\n * @param {boolean} statement - Throws if true\n * @param {string} reason - Reason to throw\n */\nfunction notNetcdf (statement: boolean, reason: string) {\n  if (statement) {\n    throw new TypeError('Not a valid NetCDF v3.x file: ' + reason)\n  }\n}\n\n/**\n * Moves 1, 2, or 3 bytes to next 4-byte boundary\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n */\nfunction padding (buffer: IOBuffer) {\n  if ((buffer.offset % 4) !== 0) {\n    buffer.skip(4 - (buffer.offset % 4))\n  }\n}\n\n/**\n * Reads the name\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {string} - Name\n */\nfunction readName (buffer: IOBuffer) {\n  // Read name\n  const nameLength = buffer.readUint32()\n  const name = buffer.readChars(nameLength)\n\n  // validate name\n  // TODO\n\n  // Apply padding\n  padding(buffer)\n  return name\n}\n\nconst types = {\n  BYTE: 1,\n  CHAR: 2,\n  SHORT: 3,\n  INT: 4,\n  FLOAT: 5,\n  DOUBLE: 6\n}\n\n/**\n * Parse a number into their respective type\n * @ignore\n * @param {number} type - integer that represents the type\n * @return {string} - parsed value of the type\n */\nfunction num2str (type: number) {\n  switch (Number(type)) {\n    case types.BYTE:\n      return 'byte'\n    case types.CHAR:\n      return 'char'\n    case types.SHORT:\n      return 'short'\n    case types.INT:\n      return 'int'\n    case types.FLOAT:\n      return 'float'\n    case types.DOUBLE:\n      return 'double'\n    default:\n      return 'undefined'\n  }\n}\n\n/**\n * Parse a number type identifier to his size in bytes\n * @ignore\n * @param {number} type - integer that represents the type\n * @return {number} -size of the type\n */\nfunction num2bytes (type: number) {\n  switch (Number(type)) {\n    case types.BYTE:\n      return 1\n    case types.CHAR:\n      return 1\n    case types.SHORT:\n      return 2\n    case types.INT:\n      return 4\n    case types.FLOAT:\n      return 4\n    case types.DOUBLE:\n      return 8\n    default:\n      return -1\n  }\n}\n\n/**\n * Reverse search of num2str\n * @ignore\n * @param {string} type - string that represents the type\n * @return {number} - parsed value of the type\n */\nfunction str2num (type: string) {\n  switch (String(type)) {\n    case 'byte':\n      return types.BYTE\n    case 'char':\n      return types.CHAR\n    case 'short':\n      return types.SHORT\n    case 'int':\n      return types.INT\n    case 'float':\n      return types.FLOAT\n    case 'double':\n      return types.DOUBLE\n    default:\n      return -1\n  }\n}\n\n/**\n * Auxiliary function to read numeric data\n * @ignore\n * @param {number} size - Size of the element to read\n * @param {function} bufferReader - Function to read next value\n * @return {Array<number>|number}\n */\nfunction readNumber (size: number, bufferReader: Function) {\n  if (size !== 1) {\n    const numbers = new Array(size)\n    for (let i = 0; i < size; i++) {\n      numbers[i] = bufferReader()\n    }\n    return numbers\n  } else {\n    return bufferReader()\n  }\n}\n\n/**\n * Given a type and a size reads the next element\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} type - Type of the data to read\n * @param {number} size - Size of the element to read\n * @return {string|Array<number>|number}\n */\nfunction readType (buffer: IOBuffer, type: number, size: number) {\n  switch (type) {\n    case types.BYTE:\n      return buffer.readBytes(size)\n    case types.CHAR:\n      return trimNull(buffer.readChars(size))\n    case types.SHORT:\n      return readNumber(size, buffer.readInt16.bind(buffer))\n    case types.INT:\n      return readNumber(size, buffer.readInt32.bind(buffer))\n    case types.FLOAT:\n      return readNumber(size, buffer.readFloat32.bind(buffer))\n    case types.DOUBLE:\n      return readNumber(size, buffer.readFloat64.bind(buffer))\n    default:\n      notNetcdf(true, 'non valid type ' + type)\n      return undefined\n  }\n}\n\n/**\n * Removes null terminate value\n * @ignore\n * @param {string} value - String to trim\n * @return {string} - Trimmed string\n */\nfunction trimNull (value: string) {\n  if (value.charCodeAt(value.length - 1) === 0) {\n    return value.substring(0, value.length - 1)\n  }\n  return value\n}\n\n// const STREAMING = 4294967295;\n\n/**\n * Read data for the given non-record variable\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {object} variable - Variable metadata\n * @return {Array} - Data of the element\n */\nfunction nonRecord (buffer: IOBuffer, variable: {type: string, size: number}) {\n  // variable type\n  const type = str2num(variable.type)\n\n  // size of the data\n  const size = variable.size / num2bytes(type)\n\n  // iterates over the data\n  const data = new Array(size)\n  for (let i = 0; i < size; i++) {\n    data[i] = readType(buffer, type, 1)\n  }\n\n  return data\n}\n\n/**\n * Read data for the given record variable\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {object} variable - Variable metadata\n * @param {object} recordDimension - Record dimension metadata\n * @return {Array} - Data of the element\n */\nfunction record (buffer:IOBuffer, variable: {type: string, size: number}, recordDimension: NetCDFRecordDimension) {\n  // variable type\n  const type = str2num(variable.type)\n  const width = variable.size ? variable.size / num2bytes(type) : 1\n\n  // size of the data\n  // TODO streaming data\n  const size = recordDimension.length\n\n  // iterates over the data\n  const data = new Array(size)\n  const step = recordDimension.recordStep\n\n  for (let i = 0; i < size; i++) {\n    const currentOffset = buffer.offset\n    data[i] = readType(buffer, type, width)\n    buffer.seek(currentOffset + step!)\n  }\n\n  return data\n}\n\n// Grammar constants\nconst ZERO = 0\nconst NC_DIMENSION = 10\nconst NC_VARIABLE = 11\nconst NC_ATTRIBUTE = 12\n\n/**\n * Read the header of the file\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} version - Version of the file\n * @return {object} - Object with the fields:\n *  * `recordDimension`: Number with the length of record dimension\n *  * `dimensions`: List of dimensions\n *  * `globalAttributes`: List of global attributes\n *  * `variables`: List of variables\n */\nfunction header (buffer: IOBuffer, version: number) {\n  // Length of record dimension\n  // sum of the varSize's of all the record variables.\n  const header: Partial<NetCDFHeader> = {recordDimension: {length: buffer.readUint32()}}\n\n  // Version\n  header.version = version\n\n  // List of dimensions\n  const dimList = dimensionsList(buffer) as {dimensions: NetCDFDimension[], recordId: number, recordName: string}\n  header.recordDimension!.id = dimList.recordId\n  header.recordDimension!.name = dimList.recordName\n  header.dimensions = dimList.dimensions\n\n  // List of global attributes\n  header.globalAttributes = attributesList(buffer)\n\n  // List of variables\n  const variables = variablesList(buffer, dimList.recordId, version) as {variables: any[], recordStep: number}\n  header.variables = variables.variables\n  header.recordDimension!.recordStep = variables.recordStep\n\n  return header\n}\n\n/**\n * List of dimensions\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {object} - List of dimensions and record dimension with:\n *  * `name`: String with the name of the dimension\n *  * `size`: Number with the size of the dimension\n */\nfunction dimensionsList (buffer: IOBuffer) {\n  let dimensions: NetCDFDimension[], recordId, recordName\n  const dimList = buffer.readUint32()\n  if (dimList === ZERO) {\n    notNetcdf((buffer.readUint32() !== ZERO), 'wrong empty tag for list of dimensions')\n    return []\n  } else {\n    notNetcdf((dimList !== NC_DIMENSION), 'wrong tag for list of dimensions')\n\n    // Length of dimensions\n    const dimensionSize = buffer.readUint32()\n    dimensions = new Array(dimensionSize)\n    for (let dim = 0; dim < dimensionSize; dim++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read dimension size\n      const size = buffer.readUint32()\n      if (size === 0) {\n        recordId = dim\n        recordName = name\n      }\n\n      dimensions[dim] = {\n        name: name,\n        size: size\n      }\n    }\n    return {\n      dimensions: dimensions,\n      recordId: recordId,\n      recordName: recordName\n    }\n  }\n}\n\n/**\n * List of attributes\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {Array<object>} - List of attributes with:\n *  * `name`: String with the name of the attribute\n *  * `type`: String with the type of the attribute\n *  * `value`: A number or string with the value of the attribute\n */\nfunction attributesList (buffer: IOBuffer) {\n  let attributes\n  const gAttList = buffer.readUint32()\n  if (gAttList === ZERO) {\n    notNetcdf((buffer.readUint32() !== ZERO), 'wrong empty tag for list of attributes')\n    return []\n  } else {\n    notNetcdf((gAttList !== NC_ATTRIBUTE), 'wrong tag for list of attributes')\n\n    // Length of attributes\n    const attributeSize = buffer.readUint32()\n    attributes = new Array(attributeSize)\n    for (let gAtt = 0; gAtt < attributeSize; gAtt++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read type\n      const type = buffer.readUint32()\n      notNetcdf(((type < 1) || (type > 6)), 'non valid type ' + type)\n\n      // Read attribute\n      const size = buffer.readUint32()\n      const value = readType(buffer, type, size)\n\n      // Apply padding\n      padding(buffer)\n\n      attributes[gAtt] = {\n        name: name,\n        type: num2str(type),\n        value: value\n      }\n    }\n  }\n  return attributes\n}\n\n/**\n * List of variables\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} recordId - Id if the record dimension\n * @param {number} version - Version of the file\n * @return {object} - Number of recordStep and list of variables with:\n *  * `name`: String with the name of the variable\n *  * `dimensions`: Array with the dimension IDs of the variable\n *  * `attributes`: Array with the attributes of the variable\n *  * `type`: String with the type of the variable\n *  * `size`: Number with the size of the variable\n *  * `offset`: Number with the offset where of the variable begins\n *  * `record`: True if is a record variable, false otherwise\n */\nfunction variablesList (buffer: IOBuffer, recordId: number, version: number) {\n  const varList = buffer.readUint32()\n  let recordStep = 0\n  let variables\n  if (varList === ZERO) {\n    notNetcdf(\n      (buffer.readUint32() !== ZERO),\n      'wrong empty tag for list of variables'\n    )\n    return []\n  } else {\n    notNetcdf((varList !== NC_VARIABLE), 'wrong tag for list of variables')\n\n    // Length of variables\n    const variableSize = buffer.readUint32()\n    variables = new Array(variableSize)\n    for (let v = 0; v < variableSize; v++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read dimensionality of the variable\n      const dimensionality = buffer.readUint32()\n\n      // Index into the list of dimensions\n      const dimensionsIds = new Array(dimensionality)\n      for (let dim = 0; dim < dimensionality; dim++) {\n        dimensionsIds[dim] = buffer.readUint32()\n      }\n\n      // Read variables size\n      const attributes = attributesList(buffer)\n\n      // Read type\n      const type = buffer.readUint32()\n      notNetcdf(((type < 1) && (type > 6)), 'non valid type ' + type)\n\n      // Read variable size\n      // The 32-bit varSize field is not large enough to contain the\n      // size of variables that require more than 2^32 - 4 bytes,\n      // so 2^32 - 1 is used in the varSize field for such variables.\n      const varSize = buffer.readUint32()\n\n      // Read offset\n      let offset = buffer.readUint32()\n      if (version === 2) {\n        notNetcdf((offset > 0), 'offsets larger than 4GB not supported')\n        offset = buffer.readUint32()\n      }\n\n      // Count amount of record variables\n      if (dimensionsIds[0] === recordId) {\n        recordStep += varSize\n      }\n\n      variables[v] = {\n        name: name,\n        dimensions: dimensionsIds,\n        attributes: attributes,\n        type: num2str(type),\n        size: varSize,\n        offset: offset,\n        record: (dimensionsIds[0] === recordId)\n      }\n    }\n  }\n\n  return {\n    variables: variables,\n    recordStep: recordStep\n  }\n}\n\n/**\n * Reads a NetCDF v3.x file\n * https://www.unidata.ucar.edu/software/netcdf/docs/file_format_specifications.html\n */\nclass NetcdfReader {\n  header: Partial<NetCDFHeader>\n  buffer: IOBuffer\n  /**\n   * @param {ArrayBuffer} data - ArrayBuffer or any Typed Array with the data\n   */\n  constructor (data: ArrayBuffer) {\n    const buffer = new IOBuffer(data)\n    buffer.setBigEndian()\n\n    // Validate that it's a NetCDF file\n    notNetcdf((buffer.readChars(3) !== 'CDF'), 'should start with CDF')\n\n    // Check the NetCDF format\n    const version = buffer.readByte()\n    notNetcdf((version > 2), 'unknown version')\n\n    // Read the header\n    this.header = header(buffer, version)\n    this.buffer = buffer\n  }\n\n  /**\n   * @return {string} - Version for the NetCDF format\n   */\n  get version () {\n    if (this.header.version === 1) {\n      return 'classic format'\n    } else {\n      return '64-bit offset format'\n    }\n  }\n\n  /**\n   * @return {object} - Metadata for the record dimension\n   *  * `length`: Number of elements in the record dimension\n   *  * `id`: Id number in the list of dimensions for the record dimension\n   *  * `name`: String with the name of the record dimension\n   *  * `recordStep`: Number with the record variables step size\n   */\n  get recordDimension () {\n    return this.header.recordDimension\n  }\n\n  /**\n   * @return {Array<object>} - List of dimensions with:\n   *  * `name`: String with the name of the dimension\n   *  * `size`: Number with the size of the dimension\n   */\n  get dimensions () {\n    return this.header.dimensions\n  }\n\n  /**\n   * @return {Array<object>} - List of global attributes with:\n   *  * `name`: String with the name of the attribute\n   *  * `type`: String with the type of the attribute\n   *  * `value`: A number or string with the value of the attribute\n   */\n  get globalAttributes () {\n    return this.header.globalAttributes\n  }\n\n  /**\n   * @return {Array<object>} - List of variables with:\n   *  * `name`: String with the name of the variable\n   *  * `dimensions`: Array with the dimension IDs of the variable\n   *  * `attributes`: Array with the attributes of the variable\n   *  * `type`: String with the type of the variable\n   *  * `size`: Number with the size of the variable\n   *  * `offset`: Number with the offset where of the variable begins\n   *  * `record`: True if is a record variable, false otherwise\n   */\n  get variables () {\n    return this.header.variables\n  }\n\n  /**\n   * Checks if a variable is available\n   * @param {string|object} variableName - Name of the variable to check\n   * @return {Boolean} - Variable existence\n   */\n  hasDataVariable (variableName: string) {\n    return this.header.variables!.findIndex(function (val) {\n      return val.name === variableName\n    }) !== -1\n  }\n\n  /**\n   * Retrieves the data for a given variable\n   * @param {string|object} variableName - Name of the variable to search or variable object\n   * @return {Array} - List with the variable values\n   */\n  getDataVariable (variableName: string|{}) {\n    let variable\n    if (typeof variableName === 'string') {\n      // search the variable\n      variable = this.header.variables!.find(function (val) {\n        return val.name === variableName\n      })\n    } else {\n      variable = variableName\n    }\n\n    // throws if variable not found\n    notNetcdf((variable === undefined), 'variable not found')\n\n    // go to the offset position\n    this.buffer.seek(variable.offset)\n\n    if (variable.record) {\n      // record variable case\n      return record(this.buffer, variable, this.header.recordDimension!)\n    } else {\n      // non-record variable case\n      return nonRecord(this.buffer, variable)\n    }\n  }\n}\n\nexport default NetcdfReader\n","/**\n * @file Dcd Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { uint8ToString, ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\n\nconst charmmTimeUnitFactor = 20.45482949774598\n\ninterface DcdHeader {\n  NSET: number,\n  ISTART: number,\n  NSAVC: number,\n  NAMNF: number,\n  DELTA: number,\n  TITLE: string,\n  NATOM: number\n}\n\nclass DcdParser extends TrajectoryParser {\n  get type () { return 'dcd' }\n  get isBinary () { return true }\n\n  _parse () {\n    // http://www.ks.uiuc.edu/Research/vmd/plugins/molfile/dcdplugin.html\n\n    // The DCD format is structured as follows\n    //   (FORTRAN UNFORMATTED, with Fortran data type descriptions):\n    // HDR     NSET    ISTRT   NSAVC   5-ZEROS NATOM-NFREAT    DELTA   9-ZEROS\n    // `CORD'  #files  step 1  step    zeroes  (zero)          timestep  (zeroes)\n    //                         interval\n    // C*4     INT     INT     INT     5INT    INT             DOUBLE  9INT\n    // ==========================================================================\n    // NTITLE          TITLE\n    // INT (=2)        C*MAXTITL\n    //                 (=32)\n    // ==========================================================================\n    // NATOM\n    // #atoms\n    // INT\n    // ==========================================================================\n    // X(I), I=1,NATOM         (DOUBLE)\n    // Y(I), I=1,NATOM\n    // Z(I), I=1,NATOM\n    // ==========================================================================\n\n    if (Debug) Log.time('DcdParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const header: Partial<DcdHeader> = {}\n\n    let nextPos = 0\n\n    // header block\n\n    const intView = new Int32Array(bin, 0, 23)\n    const ef = intView[ 0 ] !== dv.getInt32(0) // endianess flag\n    // swap byte order when big endian (84 indicates little endian)\n    if (intView[ 0 ] !== 84) {\n      const n = bin.byteLength\n      for (let i = 0; i < n; i += 4) {\n        dv.setFloat32(i, dv.getFloat32(i), true)\n      }\n    }\n    if (intView[ 0 ] !== 84) {\n      Log.error('dcd bad format, header block start')\n    }\n    // format indicator, should read 'CORD'\n    const formatString = String.fromCharCode(\n      dv.getUint8(4), dv.getUint8(5),\n      dv.getUint8(6), dv.getUint8(7)\n    )\n    if (formatString !== 'CORD') {\n      Log.error('dcd bad format, format string')\n    }\n    let isCharmm = false\n    let extraBlock = false\n    let fourDims = false\n    // version field in charmm, unused in X-PLOR\n    if (intView[ 22 ] !== 0) {\n      isCharmm = true\n      if (intView[ 12 ] !== 0) extraBlock = true\n      if (intView[ 13 ] === 1) fourDims = true\n    }\n    header.NSET = intView[ 2 ]\n    header.ISTART = intView[ 3 ]\n    header.NSAVC = intView[ 4 ]\n    header.NAMNF = intView[ 10 ]\n    if (isCharmm) {\n      header.DELTA = dv.getFloat32(44, ef)\n    } else {\n      header.DELTA = dv.getFloat64(44, ef)\n    }\n    if (intView[ 22 ] !== 84) {\n      Log.error('dcd bad format, header block end')\n    }\n    nextPos = nextPos + 21 * 4 + 8\n\n    // title block\n\n    const titleLength = dv.getInt32(nextPos, ef)\n    const titlePos = nextPos + 1\n    if ((titleLength - 4) % 80 !== 0) {\n      Log.error('dcd bad format, title block start')\n    }\n    header.TITLE = uint8ToString(\n      new Uint8Array(bin, titlePos, titleLength)\n    )\n    if (dv.getInt32(titlePos + titleLength + 4 - 1, ef) !== titleLength) {\n      Log.error('dcd bad format, title block end')\n    }\n    nextPos = nextPos + titleLength + 8\n\n    // natom block\n\n    if (dv.getInt32(nextPos, ef) !== 4) {\n      Log.error('dcd bad format, natom block start')\n    }\n    header.NATOM = dv.getInt32(nextPos + 4, ef)\n    if (dv.getInt32(nextPos + 8, ef) !== 4) {\n      Log.error('dcd bad format, natom block end')\n    }\n    nextPos = nextPos + 4 + 8\n\n    // fixed atoms block\n\n    if (header.NAMNF > 0) {\n      // TODO read coordinates and indices of fixed atoms\n      Log.error('dcd format with fixed atoms unsupported, aborting')\n      return\n    }\n\n    // frames\n\n    const natom = header.NATOM\n    const natom4 = natom * 4\n\n    for (let i = 0, n = header.NSET; i < n; ++i) {\n      if (extraBlock) {\n        nextPos += 4 // block start\n        // unitcell: A, alpha, B, beta, gamma, C (doubles)\n        const box = new Float32Array(9)\n        box[ 0 ] = dv.getFloat64(nextPos, ef)\n        box[ 4 ] = dv.getFloat64(nextPos + 2 * 8, ef)\n        box[ 8 ] = dv.getFloat64(nextPos + 5 * 8, ef)\n        boxes.push(box)\n        nextPos += 48\n        nextPos += 4 // block end\n      }\n\n      // xyz coordinates\n      const coord = new Float32Array(natom * 3)\n      for (let j = 0; j < 3; ++j) {\n        if (dv.getInt32(nextPos, ef) !== natom4) {\n          Log.error('dcd bad format, coord block start', i, j)\n        }\n        nextPos += 4 // block start\n        const c = new Float32Array(bin, nextPos, natom)\n        for (let k = 0; k < natom; ++k) {\n          coord[ 3 * k + j ] = c[ k ]\n        }\n        nextPos += natom4\n        if (dv.getInt32(nextPos, ef) !== natom4) {\n          Log.error('dcd bad format, coord block end', i, j)\n        }\n        nextPos += 4 // block end\n      }\n      coordinates.push(coord)\n\n      if (fourDims) {\n        const bytes = dv.getInt32(nextPos, ef)\n        nextPos += 4 + bytes + 4 // block start + skip + block end\n      }\n    }\n\n    if (header.DELTA) {\n      f.deltaTime = header.DELTA * charmmTimeUnitFactor\n    }\n    if (header.ISTART >= 1) {\n      f.timeOffset = (header.ISTART - 1) * f.deltaTime\n    }\n\n    // console.log(header)\n    // console.log(header.TITLE)\n    // console.log('isCharmm', isCharmm, 'extraBlock', extraBlock, 'fourDims, fourDims)\n\n    if (Debug) Log.timeEnd('DcdParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('dcd', DcdParser)\n\nexport default DcdParser\n","/**\n * @file Nctraj Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport TrajectoryParser from './trajectory-parser'\nimport NetcdfReader from '../utils/netcdf-reader'\n\nclass NctrajParser extends TrajectoryParser {\n  get type () { return 'nctraj' }\n  get isBinary () { return true }\n\n  _parse () {\n    // http://ambermd.org/netcdf/nctraj.xhtml\n\n    if (Debug) Log.time('NctrajParser._parse ' + this.name)\n\n    const netcdfReader = new NetcdfReader(this.streamer.data)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    netcdfReader.getDataVariable('coordinates').forEach(function (c) {\n      coordinates.push(new Float32Array(c))\n    })\n\n    if (netcdfReader.hasDataVariable('cell_lengths')) {\n      netcdfReader.getDataVariable('cell_lengths').forEach(function (b) {\n        boxes.push(new Float32Array(b))\n      })\n    }\n\n    if (netcdfReader.hasDataVariable('time')) {\n      netcdfReader.getDataVariable('time').forEach(function (t) {\n        times.push(t)\n      })\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('NctrajParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('nctraj', NctrajParser)\nParserRegistry.add('ncdf', NctrajParser)\nParserRegistry.add('nc', NctrajParser)\n\nexport default NctrajParser\n","/**\n * @file Trr Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\n\nclass TrrParser extends TrajectoryParser {\n  get type () { return 'trr' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/trrio.cpp\n\n    if (Debug) Log.time('TrrParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    let offset = 0\n\n    while (true) {\n      // const magicnum = dv.getInt32(offset)\n      // const i1 = dv.getFloat32(offset + 4)\n      offset += 8\n\n      const versionSize = dv.getInt32(offset)\n      offset += 4\n      offset += versionSize\n\n      // const irSize = dv.getInt32(offset)\n      // const eSize = dv.getInt32(offset + 4)\n      const boxSize = dv.getInt32(offset + 8)\n      const virSize = dv.getInt32(offset + 12)\n      const presSize = dv.getInt32(offset + 16)\n      // const topSize = dv.getInt32(offset + 20)\n      // const symSize = dv.getInt32(offset + 24)\n      const coordSize = dv.getInt32(offset + 28)\n      const velocitySize = dv.getInt32(offset + 32)\n      const forceSize = dv.getInt32(offset + 36)\n      const natoms = dv.getInt32(offset + 40)\n      // const step = dv.getInt32(offset + 44)\n      // const nre = dv.getInt32(offset + 48)\n      offset += 52\n\n      const floatSize = boxSize / 9\n      const natoms3 = natoms * 3\n\n      // let lambda\n      if (floatSize === 8) {\n        times.push(dv.getFloat64(offset))\n        // lambda = dv.getFloat64(offset + 8)\n      } else {\n        times.push(dv.getFloat32(offset))\n        // lambda = dv.getFloat32(offset + 4)\n      }\n      offset += 2 * floatSize\n\n      if (boxSize) {\n        const box = new Float32Array(9)\n        if (floatSize === 8) {\n          for (let i = 0; i < 9; ++i) {\n            box[i] = dv.getFloat64(offset) * 10\n            offset += 8\n          }\n        } else {\n          for (let i = 0; i < 9; ++i) {\n            box[i] = dv.getFloat32(offset) * 10\n            offset += 4\n          }\n        }\n        boxes.push(box)\n      }\n\n      // ignore, unused\n      offset += virSize\n\n      // ignore, unused\n      offset += presSize\n\n      if (coordSize) {\n        let frameCoords\n        if (floatSize === 8) {\n          frameCoords = new Float32Array(natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            frameCoords[i] = dv.getFloat64(offset) * 10\n            offset += 8\n          }\n        } else {\n          const tmp = new Uint32Array(bin, offset, natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            const value = tmp[i]\n            tmp[i] = (\n              ((value & 0xFF) << 24) | ((value & 0xFF00) << 8) |\n              ((value >> 8) & 0xFF00) | ((value >> 24) & 0xFF)\n            )\n          }\n          frameCoords = new Float32Array(bin, offset, natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            frameCoords[i] *= 10\n            offset += 4\n          }\n        }\n        coordinates.push(frameCoords)\n      }\n\n      // ignore, unused\n      offset += velocitySize\n\n      // ignore, unused\n      offset += forceSize\n\n      if (offset >= bin.byteLength) break\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('TrrParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('trr', TrrParser)\n\nexport default TrrParser\n","/**\n * @file Xtc Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\nimport { NumberArray } from '../types';\n\nconst MagicInts = new Uint32Array([\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 10, 12, 16, 20, 25, 32, 40, 50, 64,\n  80, 101, 128, 161, 203, 256, 322, 406, 512, 645, 812, 1024, 1290,\n  1625, 2048, 2580, 3250, 4096, 5060, 6501, 8192, 10321, 13003,\n  16384, 20642, 26007, 32768, 41285, 52015, 65536, 82570, 104031,\n  131072, 165140, 208063, 262144, 330280, 416127, 524287, 660561,\n  832255, 1048576, 1321122, 1664510, 2097152, 2642245, 3329021,\n  4194304, 5284491, 6658042, 8388607, 10568983, 13316085, 16777216\n])\nconst FirstIdx = 9\n// const LastIdx = MagicInts.length\n\nfunction sizeOfInt (size: number) {\n  let num = 1\n  let numOfBits = 0\n  while (size >= num && numOfBits < 32) {\n    numOfBits++\n    num <<= 1\n  }\n  return numOfBits\n}\n\nconst _tmpBytes = new Uint8Array(32)\n\nfunction sizeOfInts (numOfInts: number, sizes: Int32Array) {\n  let numOfBytes = 1\n  let numOfBits = 0\n  _tmpBytes[0] = 1\n  for (let i = 0; i < numOfInts; i++) {\n    let bytecnt\n    let tmp = 0\n    for (bytecnt = 0; bytecnt < numOfBytes; bytecnt++) {\n      tmp += _tmpBytes[bytecnt] * sizes[i]\n      _tmpBytes[bytecnt] = tmp & 0xff\n      tmp >>= 8\n    }\n    while (tmp !== 0) {\n      _tmpBytes[bytecnt++] = tmp & 0xff\n      tmp >>= 8\n    }\n    numOfBytes = bytecnt\n  }\n  let num = 1\n  numOfBytes--\n  while (_tmpBytes[numOfBytes] >= num) {\n    numOfBits++\n    num *= 2\n  }\n  return numOfBits + numOfBytes * 8\n}\n\nfunction decodeBits (buf: Int32Array, cbuf: Uint8Array, numOfBits: number, buf2: Uint32Array) {\n  const mask = (1 << numOfBits) - 1\n  let lastBB0 = buf2[1]\n  let lastBB1 = buf2[2]\n  let cnt = buf[0]\n  let num = 0\n\n  while (numOfBits >= 8) {\n    lastBB1 = (lastBB1 << 8) | cbuf[cnt++]\n    num |= (lastBB1 >> lastBB0) << (numOfBits - 8)\n    numOfBits -= 8\n  }\n\n  if (numOfBits > 0) {\n    if (lastBB0 < numOfBits) {\n      lastBB0 += 8\n      lastBB1 = (lastBB1 << 8) | cbuf[cnt++]\n    }\n    lastBB0 -= numOfBits\n    num |= (lastBB1 >> lastBB0) & ((1 << numOfBits) - 1)\n  }\n\n  num &= mask\n  buf[0] = cnt\n  buf[1] = lastBB0\n  buf[2] = lastBB1\n\n  return num\n}\n\nconst _tmpIntBytes = new Int32Array(32)\n\nfunction decodeInts (buf: Int32Array, cbuf: Uint8Array, numOfInts: number, numOfBits: number, sizes: NumberArray, nums: Float32Array, buf2: Uint32Array) {\n  let numOfBytes = 0\n  _tmpIntBytes[1] = 0\n  _tmpIntBytes[2] = 0\n  _tmpIntBytes[3] = 0\n\n  while (numOfBits > 8) {\n    // this is inversed??? why??? because of the endiannness???\n    _tmpIntBytes[numOfBytes++] = decodeBits(buf, cbuf, 8, buf2)\n    numOfBits -= 8\n  }\n\n  if (numOfBits > 0) {\n    _tmpIntBytes[numOfBytes++] = decodeBits(buf, cbuf, numOfBits, buf2)\n  }\n\n  for (let i = numOfInts - 1; i > 0; i--) {\n    let num = 0\n    for (let j = numOfBytes - 1; j >= 0; j--) {\n      num = (num << 8) | _tmpIntBytes[j]\n      const p = (num / sizes[i]) | 0\n      _tmpIntBytes[j] = p\n      num = num - p * sizes[i]\n    }\n    nums[i] = num\n  }\n  nums[0] = (\n    _tmpIntBytes[0] |\n    (_tmpIntBytes[1] << 8) |\n    (_tmpIntBytes[2] << 16) |\n    (_tmpIntBytes[3] << 24)\n  )\n}\n\nclass XtcParser extends TrajectoryParser {\n  get type () { return 'xtc' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/xtcio.cpp\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/libxdrf.cpp\n\n    if (Debug) Log.time('XtcParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    const minMaxInt = new Int32Array(6)\n    const sizeint = new Int32Array(3)\n    const bitsizeint = new Int32Array(3)\n    const sizesmall = new Uint32Array(3)\n    const thiscoord = new Float32Array(3)\n    const prevcoord = new Float32Array(3)\n\n    let offset = 0\n    const buf = new Int32Array(3)\n    const buf2 = new Uint32Array(buf.buffer)\n\n    while (true) {\n      let frameCoords: NumberArray\n\n      // const magicnum = dv.getInt32(offset)\n      const natoms = dv.getInt32(offset + 4)\n      // const step = dv.getInt32(offset + 8)\n      offset += 12\n\n      const natoms3 = natoms * 3\n\n      times.push(dv.getFloat32(offset))\n      offset += 4\n\n      const box = new Float32Array(9)\n      for (let i = 0; i < 9; ++i) {\n        box[i] = dv.getFloat32(offset) * 10\n        offset += 4\n      }\n      boxes.push(box)\n\n      if (natoms <= 9) { // no compression\n        frameCoords = new Float32Array(natoms)\n        for (let i = 0; i < natoms; ++i) {\n          frameCoords[i] = dv.getFloat32(offset)\n          offset += 4\n        }\n      } else {\n        buf[0] = buf[1] = buf[2] = 0.0\n        sizeint[0] = sizeint[1] = sizeint[2] = 0\n        sizesmall[0] = sizesmall[1] = sizesmall[2] = 0\n        bitsizeint[0] = bitsizeint[1] = bitsizeint[2] = 0\n        thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n        prevcoord[0] = prevcoord[1] = prevcoord[2] = 0\n\n        frameCoords = new Float32Array(natoms3)\n        let lfp = 0\n\n        const lsize = dv.getInt32(offset)\n        offset += 4\n        const precision = dv.getFloat32(offset)\n        offset += 4\n\n        minMaxInt[0] = dv.getInt32(offset)\n        minMaxInt[1] = dv.getInt32(offset + 4)\n        minMaxInt[2] = dv.getInt32(offset + 8)\n        minMaxInt[3] = dv.getInt32(offset + 12)\n        minMaxInt[4] = dv.getInt32(offset + 16)\n        minMaxInt[5] = dv.getInt32(offset + 20)\n        sizeint[0] = minMaxInt[3] - minMaxInt[0] + 1\n        sizeint[1] = minMaxInt[4] - minMaxInt[1] + 1\n        sizeint[2] = minMaxInt[5] - minMaxInt[2] + 1\n        offset += 24\n\n        let bitsize\n        if ((sizeint[0] | sizeint[1] | sizeint[2]) > 0xffffff) {\n          bitsizeint[0] = sizeOfInt(sizeint[0])\n          bitsizeint[1] = sizeOfInt(sizeint[1])\n          bitsizeint[2] = sizeOfInt(sizeint[2])\n          bitsize = 0 // flag the use of large sizes\n        } else {\n          bitsize = sizeOfInts(3, sizeint)\n        }\n\n        let smallidx = dv.getInt32(offset)\n        offset += 4\n        // if (smallidx == 0) {alert(\"Undocumented error 1\"); return;}\n\n        // let tmpIdx = smallidx + 8\n        // const maxidx = (LastIdx < tmpIdx) ? LastIdx : tmpIdx\n        // const minidx = maxidx - 8  // often this equal smallidx\n        let tmpIdx = smallidx - 1\n        tmpIdx = (FirstIdx > tmpIdx) ? FirstIdx : tmpIdx\n        let smaller = (MagicInts[tmpIdx] / 2) | 0\n        let smallnum = (MagicInts[smallidx] / 2) | 0\n\n        sizesmall[0] = sizesmall[1] = sizesmall[2] = MagicInts[smallidx]\n        // larger = MagicInts[maxidx]\n\n        let adz = Math.ceil(dv.getInt32(offset) / 4) * 4\n        offset += 4\n        // if (tmpIdx == 0) {alert(\"Undocumented error 2\"); return;}\n\n        // buf = new Int32Array(bin, offset);\n        // buf8 = new Uint8Array(bin, offset);\n\n        // tmpIdx += 3; rndup = tmpIdx%4;\n        // for (i=tmpIdx+rndup-1; i>=tmpIdx; i--) buf8[i] = 0;\n\n        // now unpack buf2...\n\n        const invPrecision = 1.0 / precision\n        let run = 0\n        let i = 0\n\n        const buf8 = new Uint8Array(bin, offset) // 229...\n\n        thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n\n        while (i < lsize) {\n          if (bitsize === 0) {\n            thiscoord[0] = decodeBits(buf, buf8, bitsizeint[0], buf2)\n            thiscoord[1] = decodeBits(buf, buf8, bitsizeint[1], buf2)\n            thiscoord[2] = decodeBits(buf, buf8, bitsizeint[2], buf2)\n          } else {\n            decodeInts(buf, buf8, 3, bitsize, sizeint, thiscoord, buf2)\n          }\n\n          i++\n\n          thiscoord[0] += minMaxInt[0]\n          thiscoord[1] += minMaxInt[1]\n          thiscoord[2] += minMaxInt[2]\n\n          prevcoord[0] = thiscoord[0]\n          prevcoord[1] = thiscoord[1]\n          prevcoord[2] = thiscoord[2]\n\n          const flag = decodeBits(buf, buf8, 1, buf2)\n          let isSmaller = 0\n\n          if (flag === 1) {\n            run = decodeBits(buf, buf8, 5, buf2)\n            isSmaller = run % 3\n            run -= isSmaller\n            isSmaller--\n          }\n\n          // if ((lfp-ptrstart)+run > size3){\n          //   fprintf(stderr, \"(xdrfile error) Buffer overrun during decompression.\\n\");\n          //   return 0;\n          // }\n\n          if (run > 0) {\n            thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n\n            for (let k = 0; k < run; k += 3) {\n              decodeInts(buf, buf8, 3, smallidx, sizesmall, thiscoord, buf2)\n              i++\n\n              thiscoord[0] += prevcoord[0] - smallnum\n              thiscoord[1] += prevcoord[1] - smallnum\n              thiscoord[2] += prevcoord[2] - smallnum\n\n              if (k === 0) {\n                // interchange first with second atom for\n                // better compression of water molecules\n                let tmpSwap = thiscoord[0]\n                thiscoord[0] = prevcoord[0]\n                prevcoord[0] = tmpSwap\n\n                tmpSwap = thiscoord[1]\n                thiscoord[1] = prevcoord[1]\n                prevcoord[1] = tmpSwap\n\n                tmpSwap = thiscoord[2]\n                thiscoord[2] = prevcoord[2]\n                prevcoord[2] = tmpSwap\n\n                frameCoords[lfp++] = prevcoord[0] * invPrecision\n                frameCoords[lfp++] = prevcoord[1] * invPrecision\n                frameCoords[lfp++] = prevcoord[2] * invPrecision\n              } else {\n                prevcoord[0] = thiscoord[0]\n                prevcoord[1] = thiscoord[1]\n                prevcoord[2] = thiscoord[2]\n              }\n              frameCoords[lfp++] = thiscoord[0] * invPrecision\n              frameCoords[lfp++] = thiscoord[1] * invPrecision\n              frameCoords[lfp++] = thiscoord[2] * invPrecision\n            }\n          } else {\n            frameCoords[lfp++] = thiscoord[0] * invPrecision\n            frameCoords[lfp++] = thiscoord[1] * invPrecision\n            frameCoords[lfp++] = thiscoord[2] * invPrecision\n          }\n\n          smallidx += isSmaller\n\n          if (isSmaller < 0) {\n            smallnum = smaller\n            if (smallidx > FirstIdx) {\n              smaller = (MagicInts[smallidx - 1] / 2) | 0\n            } else {\n              smaller = 0\n            }\n          } else if (isSmaller > 0) {\n            smaller = smallnum\n            smallnum = (MagicInts[smallidx] / 2) | 0\n          }\n          sizesmall[0] = sizesmall[1] = sizesmall[2] = MagicInts[smallidx]\n\n          if (sizesmall[0] === 0 || sizesmall[1] === 0 || sizesmall[2] === 0) {\n            console.error('(xdrfile error) Undefined error.')\n            return\n          }\n        }\n        offset += adz\n      }\n\n      for (let c = 0; c < natoms3; c++) {\n        frameCoords[c] *= 10\n      }\n\n      coordinates.push(frameCoords)\n\n      if (offset >= bin.byteLength) break\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('XtcParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('xtc', XtcParser)\n\nexport default XtcParser\n","/**\n * @file Volume Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Volume from '../surface/volume'\nimport Streamer from '../streamer/streamer';\n\nexport interface VolumeParserParameters extends ParserParameters {\n  voxelSize: number\n}\n\nclass VolumeParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<VolumeParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.volume = new Volume(this.name, this.path)\n    this.voxelSize = defaults(p.voxelSize, 1)\n  }\n\n  get type () { return 'volume' }\n  get __objName () { return 'volume' }\n\n  _afterParse () {\n    this.volume.setMatrix(this.getMatrix())\n    super._afterParse()\n  }\n\n  getMatrix () {\n    return new Matrix4()\n  }\n}\n\nexport default VolumeParser\n","/**\n * @file Cube Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport VolumeParser from './volume-parser'\n\n// @author Johanna Tiemann <johanna.tiemann@googlemail.com>\n// @author Alexander Rose <alexander.rose@weirdbyte.de>\n\nconst reWhitespace = /\\s+/\nconst reScientificNotation = /-?\\d+(?:\\.\\d*)?(?:[eE][+-]?\\d+)?/g\nconst bohrToAngstromFactor = 0.529177210859\ninterface Header {\n  atomCount: number,\n  originX: number,\n  originY: number,\n  originZ: number,\n  NVX: number,\n  NVY: number,\n  NVZ: number,\n  basisX: Vector3,\n  basisY: Vector3,\n  basisZ: Vector3\n}\n\nclass CubeParser extends VolumeParser {\n  get type () { return 'cube' }\n\n  _parse () {\n    // http://paulbourke.net/dataformats/cube/\n\n    if (Debug) Log.time('CubeParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(6)\n    const header: Partial<Header> = {}\n\n    const scaleFactor = bohrToAngstromFactor * this.voxelSize\n\n    function h (k: number, l: number) {\n      var field = headerLines[ k ].trim().split(reWhitespace)[ l ]\n      return parseFloat(field)\n    }\n\n    header.atomCount = Math.abs(h(2, 0)) // Number of atoms\n    header.originX = h(2, 1) * bohrToAngstromFactor // Position of origin of volumetric data\n    header.originY = h(2, 2) * bohrToAngstromFactor\n    header.originZ = h(2, 3) * bohrToAngstromFactor\n    header.NVX = h(3, 0) // Number of voxels\n    header.NVY = h(4, 0)\n    header.NVZ = h(5, 0)\n\n    header.basisX = new Vector3(h(3, 1), h(3, 2), h(3, 3))\n      .multiplyScalar(scaleFactor)\n    header.basisY = new Vector3(h(4, 1), h(4, 2), h(4, 3))\n      .multiplyScalar(scaleFactor)\n    header.basisZ = new Vector3(h(5, 1), h(5, 2), h(5, 3))\n      .multiplyScalar(scaleFactor)\n\n    const data = new Float32Array(header.NVX * header.NVY * header.NVZ)\n    let count = 0\n    let lineNo = 0\n    const oribitalFlag = h(2, 0) > 0 ? 0 : 1\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (line !== '' && lineNo >= header.atomCount! + 6 + oribitalFlag) {\n          const m = line.match(reScientificNotation) as RegExpMatchArray\n          for (let j = 0, lj = m.length; j < lj; ++j) {\n            data[ count ] = parseFloat(m[ j ])\n            ++count\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.header = header\n    v.setData(data, header.NVZ, header.NVY, header.NVX)\n\n    if (Debug) Log.timeEnd('CubeParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n    const matrix = new Matrix4()\n\n    matrix.multiply(\n      new Matrix4().makeTranslation(\n        h.originX, h.originY, h.originZ\n      )\n    )\n\n    matrix.multiply(\n      new Matrix4().makeBasis(\n        h.basisZ, h.basisY, h.basisX\n      )\n    )\n\n    return matrix\n  }\n}\n\nParserRegistry.add('cub', CubeParser)\nParserRegistry.add('cube', CubeParser)\n\nexport default CubeParser\n","/**\n * @file Dsn6 Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport VolumeParser from './volume-parser'\n\ninterface Dsn6Header {\n  xStart: number,\n  yStart: number,\n  zStart: number,\n  xExtent: number,\n  yExtent: number,\n  zExtent: number,\n  xRate: number,\n  yRate: number,\n  zRate: number,\n  xlen: number,\n  ylen: number,\n  zlen: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  sigma: number\n}\n\nclass Dsn6Parser extends VolumeParser {\n  get type () { return 'dsn6' }\n  get isBinary () { return true }\n\n  _parse () {\n    // DSN6 http://www.uoxray.uoregon.edu/tnt/manual/node104.html\n    // BRIX http://svn.cgl.ucsf.edu/svn/chimera/trunk/libs/VolumeData/dsn6/brix-1.html\n\n    if (Debug) Log.time('Dsn6Parser._parse ' + this.name)\n\n    const v = this.volume\n    const header: Partial<Dsn6Header> = {}\n    let divisor, summand\n\n    const bin = ensureBuffer(this.streamer.data)\n    const intView = new Int16Array(bin)\n    const byteView = new Uint8Array(bin)\n    const brixStr = String.fromCharCode.apply(null, byteView.subarray(0, 512))\n\n    if (brixStr.startsWith(':-)')) {\n      header.xStart = parseInt(brixStr.substr(10, 5)) // NXSTART\n      header.yStart = parseInt(brixStr.substr(15, 5))\n      header.zStart = parseInt(brixStr.substr(20, 5))\n\n      header.xExtent = parseInt(brixStr.substr(32, 5)) // NX\n      header.yExtent = parseInt(brixStr.substr(38, 5))\n      header.zExtent = parseInt(brixStr.substr(42, 5))\n\n      header.xRate = parseInt(brixStr.substr(52, 5)) // MX\n      header.yRate = parseInt(brixStr.substr(58, 5))\n      header.zRate = parseInt(brixStr.substr(62, 5))\n\n      header.xlen = parseFloat(brixStr.substr(73, 10)) * this.voxelSize\n      header.ylen = parseFloat(brixStr.substr(83, 10)) * this.voxelSize\n      header.zlen = parseFloat(brixStr.substr(93, 10)) * this.voxelSize\n\n      header.alpha = parseFloat(brixStr.substr(103, 10))\n      header.beta = parseFloat(brixStr.substr(113, 10))\n      header.gamma = parseFloat(brixStr.substr(123, 10))\n\n      divisor = parseFloat(brixStr.substr(138, 12)) / 100\n      summand = parseInt(brixStr.substr(155, 8))\n\n      header.sigma = parseFloat(brixStr.substr(170, 12)) * 100\n    } else {\n      // swap byte order when big endian\n      if (intView[ 18 ] !== 100) {\n        for (let i = 0, n = intView.length; i < n; ++i) {\n          const val = intView[ i ]\n          intView[ i ] = ((val & 0xff) << 8) | ((val >> 8) & 0xff)\n        }\n      }\n\n      header.xStart = intView[ 0 ] // NXSTART\n      header.yStart = intView[ 1 ]\n      header.zStart = intView[ 2 ]\n\n      header.xExtent = intView[ 3 ] // NX\n      header.yExtent = intView[ 4 ]\n      header.zExtent = intView[ 5 ]\n\n      header.xRate = intView[ 6 ] // MX\n      header.yRate = intView[ 7 ]\n      header.zRate = intView[ 8 ]\n\n      const factor = 1 / intView[ 17 ]\n      const scalingFactor = factor * this.voxelSize\n\n      header.xlen = intView[ 9 ] * scalingFactor\n      header.ylen = intView[ 10 ] * scalingFactor\n      header.zlen = intView[ 11 ] * scalingFactor\n\n      header.alpha = intView[ 12 ] * factor\n      header.beta = intView[ 13 ] * factor\n      header.gamma = intView[ 14 ] * factor\n\n      divisor = intView[ 15 ] / 100\n      summand = intView[ 16 ]\n      header.gamma = intView[ 14 ] * factor\n    }\n\n    v.header = header\n\n    if (Debug) Log.log(header, divisor, summand)\n\n    const data = new Float32Array(\n      header.xExtent * header.yExtent * header.zExtent\n    )\n\n    let offset = 512\n    const xBlocks = Math.ceil(header.xExtent / 8)\n    const yBlocks = Math.ceil(header.yExtent / 8)\n    const zBlocks = Math.ceil(header.zExtent / 8)\n\n    // loop over blocks\n    for (var zz = 0; zz < zBlocks; ++zz) {\n      for (var yy = 0; yy < yBlocks; ++yy) {\n        for (var xx = 0; xx < xBlocks; ++xx) {\n          // loop inside block\n          for (var k = 0; k < 8; ++k) {\n            var z = 8 * zz + k\n            for (var j = 0; j < 8; ++j) {\n              var y = 8 * yy + j\n              for (var i = 0; i < 8; ++i) {\n                var x = 8 * xx + i\n\n                // check if remaining slice-part contains data\n                if (x < header.xExtent && y < header.yExtent && z < header.zExtent) {\n                  var idx = ((((x * header.yExtent) + y) * header.zExtent) + z)\n                  data[ idx ] = (byteView[ offset ] - summand) / divisor\n                  ++offset\n                } else {\n                  offset += 8 - i\n                  break\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    v.setData(data, header.zExtent, header.yExtent, header.xExtent)\n    if (header.sigma) {\n      v.setStats(undefined, undefined, undefined, header.sigma)\n    }\n\n    if (Debug) Log.timeEnd('Dsn6Parser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h: Dsn6Header = this.volume.header\n\n    const basisX = [\n      h.xlen as number,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.ylen * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.ylen * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.zlen * Math.cos(Math.PI / 180.0 * h.beta),\n      h.zlen * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.zlen * h.zlen * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.xRate, h.yRate, h.zRate ]\n    const mapcrs = [ 0, 1, 2, 3 ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.multiply(\n      new Matrix4().makeRotationY(degToRad(90))\n    )\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      -h.zStart, h.yStart, h.xStart\n    ))\n\n    matrix.multiply(new Matrix4().makeScale(\n      -1, 1, 1\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('dsn6', Dsn6Parser)\nParserRegistry.add('brix', Dsn6Parser)\n\nexport default Dsn6Parser\n","/**\n * @file Dx Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { degToRad } from '../math/math-utils'\nimport VolumeParser from './volume-parser'\n\nconst reWhitespace = /\\s+/\n\ninterface DxHeader {\n  nx: number,\n  ny: number,\n  nz: number,\n  xmin: number,\n  ymin: number,\n  zmin: number,\n  hx: number,\n  hy: number,\n  hz: number\n}\n\nclass DxParser extends VolumeParser {\n  get type () { return 'dx' }\n\n  _parse () {\n    // http://apbs.readthedocs.io/en/latest/formats/opendx.html\n\n    if (Debug) Log.time('DxParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(30)\n    const headerInfo = this.parseHeaderLines(headerLines)\n    const header = this.volume.header\n    const dataLineStart = headerInfo.dataLineStart\n\n    const size = header.nx * header.ny * header.nz\n    const data = new Float32Array(size)\n    let count = 0\n    let lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string []) {\n      for (let i = _i; i < _n; ++i) {\n        if (count < size && lineNo > dataLineStart) {\n          const line = lines[ i ].trim()\n\n          if (line !== '') {\n            const ls = line.split(reWhitespace)\n\n            for (let j = 0, lj = ls.length; j < lj; ++j) {\n              data[ count ] = parseFloat(ls[ j ])\n              ++count\n            }\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.setData(data, header.nz, header.ny, header.nx)\n\n    if (Debug) Log.timeEnd('DxParser._parse ' + this.name)\n  }\n\n  parseHeaderLines (headerLines: string []) {\n    const header: Partial<DxHeader> = {}\n    const n = headerLines.length\n\n    let dataLineStart = 0\n    let headerByteCount = 0\n    let deltaLineCount = 0\n\n    for (let i = 0; i < n; ++i) {\n      let ls\n      const line = headerLines[ i ]\n\n      if (line.startsWith('object 1')) {\n        ls = line.split(reWhitespace)\n\n        header.nx = parseInt(ls[ 5 ])\n        header.ny = parseInt(ls[ 6 ])\n        header.nz = parseInt(ls[ 7 ])\n      } else if (line.startsWith('origin')) {\n        ls = line.split(reWhitespace)\n\n        header.xmin = parseFloat(ls[ 1 ])\n        header.ymin = parseFloat(ls[ 2 ])\n        header.zmin = parseFloat(ls[ 3 ])\n      } else if (line.startsWith('delta')) {\n        ls = line.split(reWhitespace)\n\n        if (deltaLineCount === 0) {\n          header.hx = parseFloat(ls[ 1 ]) * this.voxelSize\n        } else if (deltaLineCount === 1) {\n          header.hy = parseFloat(ls[ 2 ]) * this.voxelSize\n        } else if (deltaLineCount === 2) {\n          header.hz = parseFloat(ls[ 3 ]) * this.voxelSize\n        }\n\n        deltaLineCount += 1\n      } else if (line.startsWith('object 3')) {\n        dataLineStart = i\n        headerByteCount += line.length + 1\n        break\n      }\n\n      headerByteCount += line.length + 1\n    }\n\n    this.volume.header = header\n\n    return {\n      dataLineStart: dataLineStart,\n      headerByteCount: headerByteCount\n    }\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n    const matrix = new Matrix4()\n\n    matrix.multiply(\n      new Matrix4().makeRotationY(degToRad(90))\n    )\n\n    matrix.multiply(\n      new Matrix4().makeTranslation(\n        -h.zmin, h.ymin, h.xmin\n      )\n    )\n\n    matrix.multiply(\n      new Matrix4().makeScale(\n        -h.hz, h.hy, h.hx\n      )\n    )\n\n    return matrix\n  }\n}\n\nParserRegistry.add('dx', DxParser)\n\nexport default DxParser\n","/**\n * @file Dxbin Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { uint8ToLines, ensureBuffer } from '../utils'\nimport DxParser from './dx-parser'\n\nclass DxbinParser extends DxParser {\n  get type () { return 'dxbin' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/Electrostatics/apbs-pdb2pqr/issues/216\n\n    if (Debug) Log.time('DxbinParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const headerLines = uint8ToLines(new Uint8Array(bin, 0, 1000))\n    const headerInfo = this.parseHeaderLines(headerLines)\n    const header = this.volume.header\n    const headerByteCount = headerInfo.headerByteCount\n\n    const size = header.nx * header.ny * header.nz\n    const dv = new DataView(bin)\n    const data = new Float32Array(size)\n\n    for (let i = 0; i < size; ++i) {\n      data[ i ] = dv.getFloat64(i * 8 + headerByteCount, true)\n    }\n\n    this.volume.setData(data, header.nz, header.ny, header.nx)\n\n    if (Debug) Log.timeEnd('DxbinParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('dxbin', DxbinParser)\n\nexport default DxbinParser\n","/**\n * @file Mrc Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport VolumeParser from './volume-parser'\n\ninterface MrcHeader {\n  MAP: string,\n  MACHST: number [],\n  NX: number,\n  NY: number,\n  NZ: number,\n  MODE: number,\n  NXSTART: number,\n  NYSTART: number,\n  NZSTART: number,\n  MX: number,\n  MY: number,\n  MZ: number,\n  xlen: number,\n  ylen: number,\n  zlen: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  MAPC: number,\n  MAPR: number,\n  MAPS: number,\n  DMIN: number,\n  DMAX: number,\n  DMEAN: number,\n  ISPG: number,\n  NSYMBT: number,\n  LSKFLG: number,\n  originX: number,\n  originY: number,\n  originZ: number,\n  ARMS: number\n}\n\nclass MrcParser extends VolumeParser {\n  get type () { return 'mrc' }\n  get isBinary () { return true }\n\n  _parse () {\n    // MRC\n    // http://ami.scripps.edu/software/mrctools/mrc_specification.php\n    // http://www2.mrc-lmb.cam.ac.uk/research/locally-developed-software/image-processing-software/#image\n    // http://bio3d.colorado.edu/imod/doc/mrc_format.txt\n\n    // CCP4 (MAP)\n    // http://www.ccp4.ac.uk/html/maplib.html\n\n    // MRC format does not use the skew transformation header records (words 25-37)\n    // CCP4 format does not use the ORIGIN header records (words 50-52)\n\n    if (Debug) Log.time('MrcParser._parse ' + this.name)\n\n    const v = this.volume\n    const header: Partial<MrcHeader> = {}\n\n    const bin = ensureBuffer(this.streamer.data)\n    const intView = new Int32Array(bin, 0, 56)\n    const floatView = new Float32Array(bin, 0, 56)\n    const dv = new DataView(bin)\n\n    // 53  MAP         Character string 'MAP ' to identify file type\n    header.MAP = String.fromCharCode(\n      dv.getUint8(52 * 4), dv.getUint8(52 * 4 + 1),\n      dv.getUint8(52 * 4 + 2), dv.getUint8(52 * 4 + 3)\n    )\n\n    // 54  MACHST      Machine stamp indicating machine type which wrote file\n    //                 17 and 17 for big-endian or 68 and 65 for little-endian\n    header.MACHST = [ dv.getUint8(53 * 4), dv.getUint8(53 * 4 + 1) ]\n\n    // swap byte order when big endian\n    if (header.MACHST[ 0 ] === 17 && header.MACHST[ 1 ] === 17) {\n      const n = bin.byteLength\n      for (let i = 0; i < n; i += 4) {\n        dv.setFloat32(i, dv.getFloat32(i), true)\n      }\n    }\n\n    header.NX = intView[ 0 ] // NC - columns (fastest changing)\n    header.NY = intView[ 1 ] // NR - rows\n    header.NZ = intView[ 2 ] // NS - sections (slowest changing)\n\n    // mode\n    //  0 image : signed 8-bit bytes range -128 to 127\n    //  1 image : 16-bit halfwords\n    //  2 image : 32-bit reals\n    //  3 transform : complex 16-bit integers\n    //  4 transform : complex 32-bit reals\n    //  6 image : unsigned 16-bit range 0 to 65535\n    // 16 image: unsigned char * 3 (for rgb data, non-standard)\n    //\n    // Note: Mode 2 is the normal mode used in the CCP4 programs.\n    //       Other modes than 2 and 0 may NOT WORK\n    header.MODE = intView[ 3 ]\n\n    // start\n    header.NXSTART = intView[ 4 ] // NCSTART - first column\n    header.NYSTART = intView[ 5 ] // NRSTART - first row\n    header.NZSTART = intView[ 6 ] // NSSTART - first section\n\n    // intervals\n    header.MX = intView[ 7 ] // intervals along x\n    header.MY = intView[ 8 ] // intervals along y\n    header.MZ = intView[ 9 ] // intervals along z\n\n    // cell length (Angstroms in CCP4)\n    header.xlen = floatView[ 10 ] * this.voxelSize\n    header.ylen = floatView[ 11 ] * this.voxelSize\n    header.zlen = floatView[ 12 ] * this.voxelSize\n\n    // cell angle (Degrees)\n    header.alpha = floatView[ 13 ]\n    header.beta = floatView[ 14 ]\n    header.gamma = floatView[ 15 ]\n\n    // axis correspondence (1,2,3 for X,Y,Z)\n    header.MAPC = intView[ 16 ] // column\n    header.MAPR = intView[ 17 ] // row\n    header.MAPS = intView[ 18 ] // section\n\n    // density statistics\n    header.DMIN = floatView[ 19 ]\n    header.DMAX = floatView[ 20 ]\n    header.DMEAN = floatView[ 21 ]\n\n    // space group number 0 or 1 (default=0)\n    header.ISPG = intView[ 22 ]\n\n    // number of bytes used for symmetry data (0 or 80)\n    header.NSYMBT = intView[ 23 ]\n\n    // Flag for skew transformation, =0 none, =1 if foll\n    header.LSKFLG = intView[ 24 ]\n\n    // 26-34  SKWMAT  Skew matrix S (in order S11, S12, S13, S21 etc) if\n    //                LSKFLG .ne. 0.\n    // 35-37  SKWTRN  Skew translation t if LSKFLG != 0.\n    //                Skew transformation is from standard orthogonal\n    //                coordinate frame (as used for atoms) to orthogonal\n    //                map frame, as Xo(map) = S * (Xo(atoms) - t)\n\n    // 38      future use       (some of these are used by the MSUBSX routines\n    //  .          \"              in MAPBRICK, MAPCONT and FRODO)\n    //  .          \"   (all set to zero by default)\n    //  .          \"\n    // 52          \"\n\n    // 50-52 origin in X,Y,Z used for transforms\n    header.originX = floatView[ 49 ]\n    header.originY = floatView[ 50 ]\n    header.originZ = floatView[ 51 ]\n\n    // 53  MAP         Character string 'MAP ' to identify file type\n    // => see top of this parser\n\n    // 54  MACHST      Machine stamp indicating machine type which wrote file\n    // => see top of this parser\n\n    // Rms deviation of map from mean density\n    header.ARMS = floatView[ 54 ]\n\n    // 56      NLABL           Number of labels being used\n    // 57-256  LABEL(20,10)    10  80 character text labels (ie. A4 format)\n\n    v.header = header\n\n    // Log.log( header );\n\n    let data\n    if (header.MODE === 2) {\n      data = new Float32Array(\n        bin, 256 * 4 + header.NSYMBT,\n        header.NX * header.NY * header.NZ\n      )\n    } else if (header.MODE === 0) {\n      data = new Float32Array(new Int8Array(\n        bin, 256 * 4 + header.NSYMBT,\n        header.NX * header.NY * header.NZ\n      ))\n\n      // based on uglymol (https://github.com/uglymol/uglymol) by Marcin Wojdyr (wojdyr)\n      // if the file was converted by mapmode2to0 - scale the data\n      if (intView[ 39 ] === -128 && intView[ 40 ] === 127) {\n        // scaling f(x)=b1*x+b0 such that f(-128)=min and f(127)=max\n        const b1 = (header.DMAX - header.DMIN) / 255.0\n        const b0 = 0.5 * (header.DMIN + header.DMAX + b1)\n        for (let j = 0, jl = data.length; j < jl; ++j) {\n          data[ j ] = b1 * data[ j ] + b0\n        }\n      }\n    } else {\n      Log.error('MrcParser unknown mode', header.MODE)\n    }\n\n    v.setData(data, header.NX, header.NY, header.NZ)\n    if (header.ARMS !== 0) {\n      v.setStats(header.DMIN, header.DMAX, header.DMEAN, header.ARMS)\n    }\n\n    if (Debug) Log.timeEnd('MrcParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n\n    const basisX = [\n      h.xlen,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.ylen * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.ylen * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.zlen * Math.cos(Math.PI / 180.0 * h.beta),\n      h.zlen * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.zlen * h.zlen * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.MX, h.MY, h.MZ ]\n    const mapcrs = [ 0, h.MAPC, h.MAPR, h.MAPS ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.setPosition(new Vector3(\n      h.originX, h.originY, h.originZ\n    ))\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      h.NXSTART, h.NYSTART, h.NZSTART\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('mrc', MrcParser)\nParserRegistry.add('ccp4', MrcParser)\nParserRegistry.add('map', MrcParser)\n\nexport default MrcParser\n","/**\n * @file Xplor Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport VolumeParser from './volume-parser'\n\nconst reWhitespace = /\\s+/\n\nfunction parseNumberLine (line: string) {\n  return line.trim().split(reWhitespace).map(parseFloat)\n}\n\ninterface XplorHeader {\n  NA: number,\n  AMIN: number,\n  AMAX: number,\n  NB: number,\n  BMIN: number,\n  BMAX: number,\n  NC: number,\n  CMIN: number,\n  CMAX: number,\n  a: number,\n  b: number,\n  c: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  RAVE: number,\n  RSIGMA: number\n}\n\nclass XplorParser extends VolumeParser {\n  get type () { return 'xplor' }\n\n  _parse () {\n    // http://hincklab.uthscsa.edu/html/soft_packs/msi_docs/insight980/xplor/formats.html\n    // http://www.mrc-lmb.cam.ac.uk/public/xtal/doc/cns/cns_1.3/tutorial/formats/maps/text.html\n\n    if (Debug) Log.time('XplorParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(8)\n    const header: Partial<XplorHeader> = {}\n\n    let infoStart\n    if (headerLines[ 2 ].startsWith('REMARKS')) {\n      infoStart = parseInt(headerLines[ 1 ].substring(0, 8)) + 2\n    } else {\n      infoStart = 5\n    }\n    const dataStart = infoStart + 3\n\n    const gridInfo = parseNumberLine(headerLines[ infoStart ])\n    header.NA = gridInfo[ 0 ]\n    header.AMIN = gridInfo[ 1 ]\n    header.AMAX = gridInfo[ 2 ]\n    header.NB = gridInfo[ 3 ]\n    header.BMIN = gridInfo[ 4 ]\n    header.BMAX = gridInfo[ 5 ]\n    header.NC = gridInfo[ 6 ]\n    header.CMIN = gridInfo[ 7 ]\n    header.CMAX = gridInfo[ 8 ]\n\n    const cellInfo = parseNumberLine(headerLines[ infoStart + 1 ])\n    header.a = cellInfo[ 0 ] * this.voxelSize\n    header.b = cellInfo[ 1 ] * this.voxelSize\n    header.c = cellInfo[ 2 ] * this.voxelSize\n    header.alpha = cellInfo[ 3 ]\n    header.beta = cellInfo[ 4 ]\n    header.gamma = cellInfo[ 5 ]\n\n    const na = header.AMAX - header.AMIN + 1\n    const nb = header.BMAX - header.BMIN + 1\n    const nc = header.CMAX - header.CMIN + 1\n    const n = na * nb * nc\n\n    const data = new Float32Array(n)\n    const lineSection = Math.ceil(1 + (na * nb) / 6)\n    let count = 0\n    let lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (lineNo >= dataStart && (lineNo - dataStart) % lineSection !== 0 && count < n) {\n          for (let j = 0, lj = 6; j < lj; ++j) {\n            const value = parseFloat(line.substr(12 * j, 12))\n            if (isNaN(value)) { break } // Last line of map section\n            data[count++] = value\n          }\n        } else if (count === n) {\n          const lt = line.trim()\n          if (lt && lt !== '-9999') {\n            const ls = parseNumberLine(line)\n            header.RAVE = ls[0]\n            header.RSIGMA = ls[1]\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.header = header\n    v.setData(data, na, nb, nc)\n    if (header.RAVE !== 0 && header.RSIGMA !== 1) {\n      v.setStats(undefined, undefined, header.RAVE, header.RSIGMA)\n    }\n\n    if (Debug) Log.timeEnd('XplorParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n\n    const basisX = [\n      h.a,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.b * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.b * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.c * Math.cos(Math.PI / 180.0 * h.beta),\n      h.c * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.c * h.c * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.NA, h.NB, h.NC ]\n    const mapcrs = [ 0, 1, 2, 3 ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      h.AMIN, h.BMIN, h.CMIN\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('xplor', XplorParser)\nParserRegistry.add('cns', XplorParser)\n\nexport default XplorParser\n","/**\n * @file Kin Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { Vector3 } from 'three'\nimport Parser from './parser'\n\nfunction hsvToRgb (h: number, s: number, v: number) {\n  h /= 360\n  s /= 100\n  v /= 100\n  let r, g, b\n  const i = Math.floor(h * 6)\n  const f = h * 6 - i\n  const p = v * (1 - s)\n  const q = v * (1 - f * s)\n  const t = v * (1 - (1 - f) * s)\n  switch (i % 6) {\n    case 0: r = v; g = t; b = p; break\n    case 1: r = q; g = v; b = p; break\n    case 2: r = p; g = v; b = t; break\n    case 3: r = p; g = q; b = v; break\n    case 4: r = t; g = p; b = v; break\n    case 5: r = v; g = p; b = q; break\n  }\n  return [ r, g, b ] as number []\n}\n\nconst ColorDict: {[k: string]: number[]} = {\n  red: hsvToRgb(0, 100, 100),\n  orange: hsvToRgb(20, 100, 100),\n  gold: hsvToRgb(40, 100, 100),\n  yellow: hsvToRgb(60, 100, 100),\n  lime: hsvToRgb(80, 100, 100),\n  green: hsvToRgb(120, 80, 100),\n  sea: hsvToRgb(150, 100, 100),\n  cyan: hsvToRgb(180, 100, 85),\n  sky: hsvToRgb(210, 75, 95),\n  blue: hsvToRgb(240, 70, 100),\n  purple: hsvToRgb(275, 75, 100),\n  magenta: hsvToRgb(300, 95, 100),\n  hotpink: hsvToRgb(335, 100, 100),\n  pink: hsvToRgb(350, 55, 100),\n  peach: hsvToRgb(25, 75, 100),\n  lilac: hsvToRgb(275, 55, 100),\n  pinktint: hsvToRgb(340, 30, 100),\n  peachtint: hsvToRgb(25, 50, 100),\n  yellowtint: hsvToRgb(60, 50, 100),\n  greentint: hsvToRgb(135, 40, 100),\n  bluetint: hsvToRgb(220, 40, 100),\n  lilactint: hsvToRgb(275, 35, 100),\n  white: hsvToRgb(0, 0, 100),\n  gray: hsvToRgb(0, 0, 50),\n  brown: hsvToRgb(20, 45, 75),\n  deadwhite: [ 1, 1, 1 ],\n  deadblack: [ 0, 0, 0 ],\n  invisible: [ 0, 0, 0 ]\n}\n\nconst reWhitespaceComma = /[\\s,]+/\nconst reCurlyWhitespace = /[^{}\\s]*{[^{}]+}|[^{}\\s]+/g\nconst reTrimCurly = /^{+|}+$/g\nconst reTrimQuotes = /^['\"]+|['\"]+$/g\nconst reCollapseEqual = /\\s*=\\s*/g\n\nfunction parseListDef (line: string) {\n  let name\n  let defaultColor\n  let master = []\n  let width\n\n  line = line.replace(reCollapseEqual, '=')\n\n  const lm = line.match(reCurlyWhitespace) as RegExpMatchArray\n  for (let j = 1; j < lm.length; ++j) {\n    const e = lm[ j ]\n    if (e[ 0 ] === '{') {\n      name = e.substring(1, e.length - 1)\n    } else {\n      const es = e.split('=')\n      if (es.length === 2) {\n        if (es[ 0 ] === 'color') {\n          defaultColor = ColorDict[ es[ 1 ] ]\n        } else if (es[ 0 ] === 'width') {\n          width = parseInt(es[ 1 ])\n        } else if (es[ 0 ] === 'master') {\n          master.push(es[ 1 ].replace(reTrimCurly, ''))\n        }\n      }\n    }\n  }\n\n  return {\n    listName: name,\n    listColor: defaultColor,\n    listMasters: master,\n    listWidth: width\n  }\n}\n\nfunction parseListElm (line: string) {\n  line = line.trim()\n\n  const idx1 = line.indexOf('{')\n  const idx2 = line.indexOf('}')\n  const ls = line.substr(idx2 + 1).split(reWhitespaceComma)\n\n  const label = line.substr(idx1 + 1, idx2 - 1)\n  const position = [\n    parseFloat(ls[ ls.length - 3 ]),\n    parseFloat(ls[ ls.length - 2 ]),\n    parseFloat(ls[ ls.length - 1 ])\n  ]\n  let color, width, radius\n  let lineBreak = false\n  let triangleBreak = false\n  for (let lsindex = 4; lsindex <= ls.length; lsindex++) {\n    const literal = ls[ ls.length - lsindex ]\n    if (literal in ColorDict) {\n      color = ColorDict[ ls[ ls.length - lsindex ] ]\n    }\n    if (literal.startsWith('width')) {\n      width = parseInt(literal.substring(5))\n    }\n    if (literal.startsWith('r=')) {\n      radius = parseFloat(literal.split('=')[1])\n    }\n    if (literal.startsWith('P')) {\n      lineBreak = true\n    }\n    if (literal.startsWith('X')) {\n      triangleBreak = true\n    }\n  }\n  // const color = line[ idx2 + 1 ] === ' ' ? undefined : ColorDict[ ls[ 0 ] ]\n\n  return {\n    label: label,\n    position: position,\n    color: color,\n    radius: radius,\n    width: width,\n    isLineBreak: lineBreak,\n    isTriangleBreak: triangleBreak\n  }\n}\n\nfunction parseStr (line: string) {\n  const start = line.indexOf('{')\n  const end = line.indexOf('}')\n  return line.substring(\n    start !== -1 ? start + 1 : 0,\n    end !== -1 ? end : undefined\n  ).trim()\n}\n\nfunction parseFlag (line: string) {\n  const end = line.indexOf('}')\n  return end === -1 ? undefined : line.substr(end + 1).trim()\n}\n\nfunction parseGroup (line: string) {\n  let name:string = ''\n  let master:string[] = []\n  let flags: {[k: string]: string|boolean} = {}\n\n  line = line.replace(reCollapseEqual, '=')\n\n  const lm = line.match(reCurlyWhitespace)  as RegExpMatchArray\n  for (let j = 1; j < lm.length; ++j) {\n    const e = lm[ j ]\n    if (e[ 0 ] === '{') {\n      name = e.substring(1, e.length - 1)\n    } else {\n      const es = e.split('=')\n      if (es.length === 2) {\n        if (es[ 0 ] === 'master') {\n          master.push(es[ 1 ].replace(reTrimCurly, ''))\n        } else {\n          flags[ es[ 0 ] ] = es[ 1 ].replace(reTrimCurly, '')\n        }\n      } else {\n        flags[ es[ 0 ] ] = true\n      }\n    }\n  }\n\n  return { groupName: name,\n           groupFlags: flags,\n           groupMasters: master\n  }\n}\ninterface RibbonObject {\n  labelArray: string[],\n  positionArray: number[],\n  breakArray: boolean[],\n  colorArray: number[],\n  name?: string,\n  masterArray: any[]\n}\nfunction convertKinTriangleArrays (ribbonObject: RibbonObject) {\n  // have to convert ribbons/triangle lists from stripdrawmode to normal drawmode\n  // index                    [ 0 1 2 3 4 5 6 7 8 91011 ]\n  // label [ 0 1 2 3 4 5 ] to [ 0 1 2 1 2 3 2 3 4 3 4 5 ]\n  // convertedindex                                      [ 0 1 2 3 4 5 6 7 8 91011121314151617181920212223242526 ]\n  // index          [ 0 1 2 3 4 5 6 7 8 91011121314 ]    [ 0 1 2 3 4 5 6 7 8 3 4 5 6 7 8 91011 6 7 8 91011121314 ]\n  // position/color [ 0 0 0 1 1 1 2 2 2 3 3 3 4 4 4 ] to [ 0 0 0 1 1 1 2 2 2 1 1 1 2 2 2 3 3 3 2 2 2 3 3 3 4 4 4 ]\n  let { labelArray, positionArray, colorArray, breakArray } = ribbonObject\n  let convertedLabels = []\n  for (let i = 0; i < (labelArray.length - 2) * 3; ++i) {\n    convertedLabels[i] = labelArray[i - Math.floor(i / 3) * 2]\n  }\n  let convertedBreaks = []\n  for (let i = 0; i < (breakArray.length - 2) * 3; ++i) {\n    convertedBreaks[i] = breakArray[i - Math.floor(i / 3) * 2]\n  }\n  let convertedPositions = []\n  for (let i = 0; i < (positionArray.length / 3 - 2) * 9; ++i) {\n    convertedPositions[i] = positionArray[i - Math.floor(i / 9) * 6]\n  }\n  let convertedColors = []\n  for (let i = 0; i < (colorArray.length / 3 - 2) * 9; ++i) {\n    convertedColors[i] = colorArray[i - Math.floor(i / 9) * 6]\n  }\n  let vector3Positions = []\n  for (let i = 0; i < (convertedPositions.length) / 3; ++i) {\n    vector3Positions.push(new Vector3(convertedPositions[i * 3], convertedPositions[i * 3] + 1, convertedPositions[i * 3] + 2))\n  }\n  //let normals = []\n  //for (let i = 0; i < vector3Positions.length - 1; ++i) {\n  //  let normalVec3 = vector3Positions[i].cross(vector3Positions[i + 1])\n  //  normals.push(normalVec3.x)\n  //  normals.push(normalVec3.y)\n  //  normals.push(normalVec3.z)\n  //}\n  return {\n    name: ribbonObject.name,\n    masterArray: ribbonObject.masterArray,\n    labelArray: convertedLabels,\n    positionArray: convertedPositions,\n    breakArray: convertedBreaks,\n    colorArray: convertedColors\n  }\n}\n\nfunction removePointBreaksTriangleArrays (convertedRibbonObject: RibbonObject) {\n  // after converting ribbon/triangle arrys to drawmode, removed point break triangles\n  // label [ 0 1 2 3 4 5 ] to [ 0 1 2 1 2 3 2 3 4 3 4 5 ]\n  // position/color [ 0 0 0 1 1 1 2 2 2 3 3 3 4 4 4 ] to [ 0 0 0 1 1 1 2 2 2 1 1 1 2 2 2 3 3 3 2 2 2 3 3 3 4 4 4 ]\n  let { labelArray, positionArray, colorArray, breakArray } = convertedRibbonObject\n  let editedLabels = []\n  let editedPositions = []\n  let editedColors = []\n  let editedBreaks = []\n  for (let i = 0; i < breakArray.length / 3; i++) {\n    let breakPointer = i * 3\n    let positionPointer = i * 9\n    if (!breakArray[breakPointer+1]&&!breakArray[breakPointer+2]) {\n      editedLabels.push(labelArray[breakPointer])\n      editedLabels.push(labelArray[breakPointer+1])\n      editedLabels.push(labelArray[breakPointer+2])\n      editedBreaks.push(breakArray[breakPointer])\n      editedBreaks.push(breakArray[breakPointer+1])\n      editedBreaks.push(breakArray[breakPointer+2])\n      editedPositions.push(positionArray[positionPointer])\n      editedPositions.push(positionArray[positionPointer+1])\n      editedPositions.push(positionArray[positionPointer+2])\n      editedPositions.push(positionArray[positionPointer+3])\n      editedPositions.push(positionArray[positionPointer+4])\n      editedPositions.push(positionArray[positionPointer+5])\n      editedPositions.push(positionArray[positionPointer+6])\n      editedPositions.push(positionArray[positionPointer+7])\n      editedPositions.push(positionArray[positionPointer+8])\n      editedColors.push(colorArray[positionPointer])\n      editedColors.push(colorArray[positionPointer+1])\n      editedColors.push(colorArray[positionPointer+2])\n      editedColors.push(colorArray[positionPointer+3])\n      editedColors.push(colorArray[positionPointer+4])\n      editedColors.push(colorArray[positionPointer+5])\n      editedColors.push(colorArray[positionPointer+6])\n      editedColors.push(colorArray[positionPointer+7])\n      editedColors.push(colorArray[positionPointer+8])\n    } else {\n      //console.log('X triangle break found')\n      //console.log('skipping: '+positionArray[positionPointer]+','+positionArray[positionPointer+1]+','+positionArray[positionPointer+2]+','\n      //                        +positionArray[positionPointer+3]+','+positionArray[positionPointer+4]+','+positionArray[positionPointer+5]+','\n      //                        +positionArray[positionPointer+6]+','+positionArray[positionPointer+7]+','+positionArray[positionPointer+8])\n    }\n  }\n  return {\n    name: convertedRibbonObject.name,\n    masterArray: convertedRibbonObject.masterArray,\n    labelArray: editedLabels,\n    positionArray: editedPositions,\n    breakArray: editedBreaks,\n    colorArray: editedColors\n  }\n}\n\ninterface Kinemage {\n  kinemage?: number,\n  onewidth?: any,\n  '1viewid'?: string,\n  pdbfile?: string,\n  text: string,\n  texts: string[],\n  captions: string[],\n  caption: string,\n  groupDict: {[k:string]: {[k:string]: boolean}},\n  subgroupDict: {[k: string]: any},\n  masterDict: {[k:string]: {indent: boolean, visible: boolean}},\n  pointmasterDict: {[k: string]: any},\n  dotLists: DotList[],\n  vectorLists: VectorList[],\n  ballLists: any[],\n  ribbonLists: RibbonObject[]\n}\n\ninterface DotList {\n  name?: string,\n  masterArray: any[],\n  labelArray: any[],\n  positionArray: any[],\n  colorArray: any[]\n}\n\ninterface VectorList {\n  name?: string,\n  masterArray: any[],\n  label1Array: string[],\n  label2Array: string[],\n  position1Array: number[],\n  position2Array: number[],\n  color1Array: number[],\n  color2Array: number[],\n  width: number[]\n}\n\nclass KinParser extends Parser {\n  kinemage: Kinemage\n  get type () { return 'kin' }\n  get __objName () { return 'kinemage' }\n\n  _parse () {\n    // http://kinemage.biochem.duke.edu/software/king.php\n\n    if (Debug) Log.time(`KinParser._parse ${this.name}`)\n\n    const kinemage: Kinemage = {\n      kinemage: undefined,\n      onewidth: undefined,\n      '1viewid': undefined,\n      pdbfile: undefined,\n      texts: [],\n      text: '',\n      captions: [],\n      caption: '',\n      groupDict: {},\n      subgroupDict: {},\n      masterDict: {},\n      pointmasterDict: {},\n      dotLists: [],\n      vectorLists: [],\n      ballLists: [],\n      ribbonLists: []\n    }\n    this.kinemage = kinemage\n\n    let currentGroupMasters: string[]\n    let currentSubgroupMasters: string[]\n\n    let isDotList = false\n    let prevDotLabel = ''\n    let dotDefaultColor: number[]\n    let dotLabel: string[], dotPosition: number[], dotColor: number[]\n\n    let isVectorList = false\n    let prevVecLabel = ''\n    let prevVecPosition: number[]|null = null\n    let prevVecColor: number[]|null = null\n    let vecDefaultColor: number[], vecDefaultWidth: number[]\n    let vecLabel1: string[], vecLabel2: string[], vecPosition1: number[], vecPosition2: number[], vecColor1: number[], vecColor2: number[]\n\n    let isBallList = false\n    let prevBallLabel = ''\n    let ballRadius: number[], ballDefaultColor: number[]\n    let ballLabel: string[], ballPosition: number[], ballColor: number[]\n\n    let isRibbonList = false\n    let prevRibbonPointLabel = ''\n\n    let ribbonListDefaultColor: number[]\n    let ribbonPointLabelArray: string[], ribbonPointPositionArray: number[], ribbonPointBreakArray: boolean[], ribbonPointColorArray: number[]\n\n    let isText = false\n    let isCaption = false\n\n    // @vectorlist {mc} color= white  master= {mainchain}\n    // { n   thr A   1  B13.79 1crnFH} P 17.047, 14.099, 3.625 { n   thr A   1  B13.79 1crnFH} L 17.047, 14.099, 3.625\n\n    // @dotlist {x} color=white master={vdw contact} master={dots}\n    // { CB  THR   1  A}sky  'P' 18.915,14.199,5.024\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (line[ 0 ] === '@') {\n          isDotList = false\n          isVectorList = false\n          isBallList = false\n          isRibbonList = false\n          isText = false\n          isCaption = false\n        }\n\n        if (!line) {\n          isDotList = false\n          isVectorList = false\n          isBallList = false\n          isRibbonList = false\n        } else if (line.startsWith('@dotlist')) {\n          // @dotlist {x} color=white master={vdw contact} master={dots}\n\n          let { listColor, listName, listMasters } = parseListDef(line)\n\n          isDotList = true\n          prevDotLabel = ''\n          dotLabel = []\n          dotPosition = []\n          dotColor = []\n          dotDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.dotLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: dotLabel,\n            positionArray: dotPosition,\n            colorArray: dotColor\n          })\n        } else if (line.startsWith('@vectorlist')) {\n          // @vectorlist {x} color=white master={small overlap} master={dots}\n\n          let { listMasters, listName, listWidth, listColor } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          isVectorList = true\n          prevVecLabel = ''\n          prevVecPosition = null\n          prevVecColor = null\n          vecLabel1 = []\n          vecLabel2 = []\n          vecPosition1 = []\n          vecPosition2 = []\n          vecColor1 = []\n          vecColor2 = []\n          vecDefaultColor = listColor as number[]\n          vecDefaultWidth = []\n          if (listWidth) {\n            vecDefaultWidth.push(listWidth)\n          }\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.vectorLists.push({\n            name: listName,\n            masterArray: listMasters,\n            label1Array: vecLabel1,\n            label2Array: vecLabel2,\n            position1Array: vecPosition1,\n            position2Array: vecPosition2,\n            color1Array: vecColor1,\n            color2Array: vecColor2,\n            width: vecDefaultWidth\n          })\n        } else if (line.startsWith('@balllist')) {\n          let { listName, listColor, listMasters } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          isBallList = true\n\n          prevBallLabel = ''\n          ballLabel = []\n          ballRadius = []\n          ballPosition = []\n          ballColor = []\n          ballDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.ballLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: ballLabel,\n            radiusArray: ballRadius,\n            positionArray: ballPosition,\n            colorArray: ballColor\n          })\n        } else if (line.startsWith('@ribbonlist')||line.startsWith('@trianglelist')) {\n          let { listMasters, listName, listColor } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n          isRibbonList = true\n          prevRibbonPointLabel = ''\n          ribbonPointLabelArray = []\n          ribbonPointPositionArray = []\n          ribbonPointBreakArray = []\n          ribbonPointColorArray = []\n          ribbonListDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.ribbonLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: ribbonPointLabelArray,\n            positionArray: ribbonPointPositionArray,\n            breakArray: ribbonPointBreakArray,\n            colorArray: ribbonPointColorArray\n          })\n        } else if (line.startsWith('@text')) {\n          isText = true\n          kinemage.texts.push(line.substr(5))\n        } else if (line.startsWith('@caption')) {\n          isCaption = true\n          kinemage.captions.push(line.substr(8))\n        } else if (isDotList) {\n          // { CB  THR   1  A}sky  'P' 18.915,14.199,5.024\n\n          let { label, color, position } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevDotLabel\n          } else {\n            prevDotLabel = label\n          }\n\n          if (color === undefined) {\n            color = dotDefaultColor\n          }\n\n          dotLabel.push(label)\n          dotPosition.push(...position)\n          dotColor.push(...color)\n        } else if (isVectorList) {\n          // { n   thr A   1  B13.79 1crnFH} P 17.047, 14.099, 3.625 { n   thr A   1  B13.79 1crnFH} L 17.047, 14.099, 3.625\n\n          let doubleLine = line.replace(/(?!^){/g, '\\n{')\n          let splitLine = doubleLine.split(/\\n/)\n\n          for (var i2 = 0; i2 < splitLine.length; i2++) {\n            let singlePointLine = splitLine[i2]\n            let { label, color, width, position, isLineBreak } = parseListElm(singlePointLine)\n\n            if (label === '\"') {\n              label = prevVecLabel\n            } else {\n              prevVecLabel = label\n            }\n\n            if (color === undefined) {\n              color = vecDefaultColor\n            }\n\n            if (!isLineBreak) {\n              if (prevVecPosition !== null) {\n                if (width) {\n                  vecDefaultWidth.push(width)\n                }\n\n                vecLabel1.push(prevVecLabel)\n                vecPosition1.push(...prevVecPosition)\n                vecColor1.push(...prevVecColor as number[])\n\n                vecLabel2.push(label)\n                vecPosition2.push(...position)\n                vecColor2.push(...color)\n\n              }\n            }\n\n            prevVecLabel = label\n            prevVecPosition = position\n            prevVecColor = color\n          }\n        } else if (isBallList) {\n          // {cb arg A   1   1.431 -106.80} r=1.431  39.085, 8.083, 22.182\n\n          let { label, radius, color, position } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevBallLabel\n          } else {\n            prevBallLabel = label\n          }\n\n          if (radius === undefined) {\n            radius = 1 // temporary default radius\n          }\n\n          if (color === undefined) {\n            color = ballDefaultColor\n          }\n\n          ballLabel.push(label)\n          ballRadius.push(radius)\n          ballPosition.push(...position)\n          ballColor.push(...color)\n        } else if (isRibbonList) {\n          let { label, color, position, isTriangleBreak } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevRibbonPointLabel\n          } else {\n            prevRibbonPointLabel = label\n          }\n\n          if (color === undefined) {\n            color = ribbonListDefaultColor\n          }\n\n          ribbonPointLabelArray.push(label)\n          ribbonPointPositionArray.push(...position)\n          ribbonPointBreakArray.push(isTriangleBreak)\n          ribbonPointColorArray.push(...color)\n        } else if (isText) {\n          kinemage.texts.push(line)\n        } else if (isCaption) {\n          kinemage.captions.push(line)\n        } else if (line.startsWith('@kinemage')) {\n          kinemage.kinemage = parseInt(line.substr(9).trim())\n        } else if (line.startsWith('@onewidth')) {\n          kinemage.onewidth = true\n        } else if (line.startsWith('@1viewid')) {\n          kinemage[ '1viewid' ] = parseStr(line)\n        } else if (line.startsWith('@pdbfile')) {\n          kinemage.pdbfile = parseStr(line)\n        } else if (line.startsWith('@group')) {\n          let { groupName, groupFlags, groupMasters } = parseGroup(line)\n          if (!kinemage.groupDict[ groupName as string ]) {\n            kinemage.groupDict[ groupName as string ] = {\n              dominant: false,\n              animate: false\n            }\n            currentGroupMasters = groupMasters\n          }\n\n          if (currentGroupMasters) {\n            currentGroupMasters.forEach(function (master) {\n              if (!kinemage.masterDict[ master ]) {\n                kinemage.masterDict[ master ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          for (let key in groupFlags as {[k: string]: boolean}) {\n            kinemage.groupDict[ groupName as string ][ key ] = (groupFlags as {[k: string]: boolean})[ key ]\n          }\n        } else if (line.startsWith('@subgroup')) {\n          const { groupName, groupFlags, groupMasters } = parseGroup(line)\n\n          if (!kinemage.subgroupDict[ groupName as string ]) {\n            kinemage.subgroupDict[ groupName as string ] = {\n              dominant: false,\n              animate: false\n            }\n            currentSubgroupMasters = groupMasters\n          }\n\n          if (currentSubgroupMasters) {\n            currentSubgroupMasters.forEach(function (master) {\n              if (!kinemage.masterDict[ master ]) {\n                kinemage.masterDict[ master ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          for (let key in groupFlags as {[k: string]: boolean}) {\n            kinemage.subgroupDict[ groupName as string ][ key ] = (groupFlags as {[k: string]: boolean})[ key ]\n          }\n        } else if (line.startsWith('@master')) {\n          const name = parseStr(line)\n          const flag = parseFlag(line)\n\n          if (!kinemage.masterDict[ name ]) {\n            kinemage.masterDict[ name ] = {\n              indent: false,\n              visible: false\n            }\n          }\n\n          if (flag === 'on') {\n            kinemage.masterDict[ name ].visible = true\n          } else if (flag === 'off') {\n            kinemage.masterDict[ name ].visible = false\n          } else if (flag === 'indent') {\n            kinemage.masterDict[ name ].indent = true\n          } else if (!flag) {\n            // nothing to do\n          }\n        } else if (line.startsWith('@pointmaster')) {\n          const { groupName, groupFlags } = parseGroup(line)\n\n          kinemage.pointmasterDict[ groupName as string] = {\n            id: Object.keys(groupFlags as {[k: string]: boolean})[ 0 ].replace(reTrimQuotes, '')\n          }\n        } else {\n          console.log(line)\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    kinemage.text = kinemage.texts.join('\\n').trim()\n    kinemage.caption = kinemage.captions.join('\\n').trim()\n    if (kinemage.ribbonLists) {\n      let convertedLists: RibbonObject[] = []\n      kinemage.ribbonLists.forEach(function (listObject) {\n        convertedLists.push(removePointBreaksTriangleArrays(convertKinTriangleArrays(listObject)))\n      })\n      kinemage.ribbonLists = convertedLists\n    }\n\n    if (Debug) Log.timeEnd(`KinParser._parse ${this.name}`)\n  }\n}\n\nParserRegistry.add('kin', KinParser)\n\nexport default KinParser\n","/**\n * @file Surface Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Parser, { ParserParameters } from './parser'\nimport Surface from '../surface/surface'\nimport Streamer from '../streamer/streamer';\n\nclass SurfaceParser extends Parser {\n  constructor (streamer: Streamer, params?:Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.loader = this.getLoader()\n    this.surface = new Surface(this.name, this.path)\n  }\n\n  get type () { return 'surface' }\n  get __objName () { return 'surface' }\n\n  _parse () {\n    var geometry = this.loader.parse(this.streamer.asText())\n\n    this.surface.fromGeometry(geometry)\n  }\n}\n\nexport default SurfaceParser\n","/**\n * @file Obj Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferGeometry, BufferAttribute } from 'three'\n\nimport { ParserRegistry } from '../globals'\nimport SurfaceParser from './surface-parser'\n\nexport interface _OBJLoader {\n  regexp: {[k: string]: RegExp}\n}\n\ninterface _OBJLoaderConstructor {\n  (this: _OBJLoader): void\n  new(): _OBJLoader\n}\n\ninterface ObjectType {\n  name: string,\n  fromDeclaration: boolean,\n  geometry: {\n    vertices: number[],\n    normals: number[],\n    type?: string\n  }\n}\n/**\n * OBJLoader\n * @class\n * @private\n * @author mrdoob / http://mrdoob.com/\n */\nconst OBJLoader = (function OBJLoader (this: _OBJLoader) {\n  this.regexp = {\n    // v float float float\n    vertex_pattern: /^v\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // vn float float float\n    normal_pattern: /^vn\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // vt float float\n    uv_pattern: /^vt\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // f vertex vertex vertex\n    face_vertex: /^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,\n    // f vertex/uv vertex/uv vertex/uv\n    face_vertex_uv: /^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,\n    // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n    face_vertex_uv_normal: /^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,\n    // f vertex//normal vertex//normal vertex//normal\n    face_vertex_normal: /^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,\n    // o object_name | g group_name\n    object_pattern: /^[og]\\s*(.+)?/,\n    // s boolean\n    smoothing_pattern: /^s\\s+(\\d+|on|off)/,\n    // mtllib file_reference\n    material_library_pattern: /^mtllib /,\n    // usemtl material_name\n    material_use_pattern: /^usemtl /\n  }\n}) as _OBJLoaderConstructor\n\nOBJLoader.prototype = {\n\n  constructor: OBJLoader,\n\n  setPath: function (value: string) {\n    this.path = value\n  },\n\n  _createParserState: function () {\n    var state = {\n      objects: [] as ObjectType[],\n      object: {} as ObjectType,\n\n      vertices: [],\n      normals: [],\n\n      startObject: function (name: string, fromDeclaration: boolean) {\n        // If the current object (initial from reset) is not from a g/o declaration in the parsed\n        // file. We need to use it for the first parsed g/o to keep things in sync.\n        if (this.object && this.object.fromDeclaration === false) {\n          this.object.name = name\n          this.object.fromDeclaration = (fromDeclaration !== false)\n          return\n        }\n\n        this.object = {\n          name: name || '',\n          geometry: {\n            vertices: [],\n            normals: []\n          },\n          fromDeclaration: (fromDeclaration !== false)\n        }\n\n        this.objects.push(this.object)\n      },\n\n      parseVertexIndex: function (value: string, len: number) {\n        var index = parseInt(value, 10)\n        return (index >= 0 ? index - 1 : index + len / 3) * 3\n      },\n\n      parseNormalIndex: function (value: string, len: number) {\n        var index = parseInt(value, 10)\n        return (index >= 0 ? index - 1 : index + len / 3) * 3\n      },\n\n      addVertex: function (a: number, b: number, c: number) {\n        var src = this.vertices\n        var dst = this.object.geometry.vertices\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n        dst.push(src[ b + 0 ])\n        dst.push(src[ b + 1 ])\n        dst.push(src[ b + 2 ])\n        dst.push(src[ c + 0 ])\n        dst.push(src[ c + 1 ])\n        dst.push(src[ c + 2 ])\n      },\n\n      addVertexLine: function (a: number) {\n        var src = this.vertices\n        var dst = this.object.geometry.vertices\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n      },\n\n      addNormal: function (a: number, b: number, c: number) {\n        var src = this.normals\n        var dst = this.object.geometry.normals\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n        dst.push(src[ b + 0 ])\n        dst.push(src[ b + 1 ])\n        dst.push(src[ b + 2 ])\n        dst.push(src[ c + 0 ])\n        dst.push(src[ c + 1 ])\n        dst.push(src[ c + 2 ])\n      },\n\n      addFace: function (a: string, b: string, c: string, d?: string, na?: string, nb?: string, nc?: string, nd?: string) {\n        var vLen = this.vertices.length\n\n        var ia = this.parseVertexIndex(a, vLen)\n        var ib = this.parseVertexIndex(b, vLen)\n        var ic = this.parseVertexIndex(c, vLen)\n        var id\n\n        if (d === undefined) {\n          this.addVertex(ia, ib, ic)\n        } else {\n          id = this.parseVertexIndex(d, vLen)\n\n          this.addVertex(ia, ib, id)\n          this.addVertex(ib, ic, id)\n        }\n\n        if (na !== undefined) {\n          // Normals are many times the same. If so, skip function call and parseInt.\n          var nLen = this.normals.length\n          ia = this.parseNormalIndex(na, nLen)\n\n          ib = na === nb ? ia : this.parseNormalIndex(nb!, nLen)\n          ic = na === nc ? ia : this.parseNormalIndex(nc!, nLen)\n\n          if (d === undefined) {\n            this.addNormal(ia, ib, ic)\n          } else {\n            id = this.parseNormalIndex(nd!, nLen)\n\n            this.addNormal(ia, ib, id)\n            this.addNormal(ib, ic, id)\n          }\n        }\n      },\n\n      addLineGeometry: function (vertices: string[]) {\n        this.object.geometry.type = 'Line'\n\n        var vLen = this.vertices.length\n\n        for (var vi = 0, l = vertices.length; vi < l; vi++) {\n          this.addVertexLine(this.parseVertexIndex(vertices[ vi ], vLen))\n        }\n      }\n\n    }\n\n    state.startObject('', false)\n\n    return state\n  },\n\n  parse: function (text: string) {\n    var state = this._createParserState()\n\n    if (text.indexOf('\\r\\n') !== -1) {\n      // This is faster than String.split with regex that splits on both\n      text = text.replace(/\\r\\n/g, '\\n')\n    }\n\n    if (text.indexOf('\\\\\\n') !== -1) {\n      // join lines separated by a line continuation character (\\)\n      text = text.replace(/\\\\\\n/g, '')\n    }\n\n    var i, l\n    var lines = text.split('\\n')\n    var line = ''\n    var lineFirstChar = ''\n    var lineSecondChar = ''\n    var lineLength = 0\n    var result = []\n\n    // Faster to just trim left side of the line. Use if available.\n    var trimLeft = (typeof ''.trimLeft === 'function')\n\n    for (i = 0, l = lines.length; i < l; i++) {\n      line = lines[ i ]\n\n      line = trimLeft ? line.trimLeft() : line.trim()\n\n      lineLength = line.length\n\n      if (lineLength === 0) continue\n\n      lineFirstChar = line.charAt(0)\n\n      // @todo invoke passed in handler if any\n      if (lineFirstChar === '#') continue\n\n      if (lineFirstChar === 'v') {\n        lineSecondChar = line.charAt(1)\n\n        if (lineSecondChar === ' ' && (result = this.regexp.vertex_pattern.exec(line)) !== null) {\n          // 0                  1      2      3\n          // [\"v 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n          state.vertices.push(\n            parseFloat(result[ 1 ]),\n            parseFloat(result[ 2 ]),\n            parseFloat(result[ 3 ])\n          )\n        } else if (lineSecondChar === 'n' && (result = this.regexp.normal_pattern.exec(line)) !== null) {\n          // 0                   1      2      3\n          // [\"vn 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n          state.normals.push(\n            parseFloat(result[ 1 ]),\n            parseFloat(result[ 2 ]),\n            parseFloat(result[ 3 ])\n          )\n        } else if (lineSecondChar === 't' && this.regexp.uv_pattern.exec(line) !== null) {\n\n          // ignore uv line\n\n        } else {\n          throw new Error(\"Unexpected vertex/normal/uv line: '\" + line + \"'\")\n        }\n      } else if (lineFirstChar === 'f') {\n        if ((result = this.regexp.face_vertex_uv_normal.exec(line)) !== null) {\n          // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n          // 0                        1    2    3    4    5    6    7    8    9   10         11         12\n          // [\"f 1/1/1 2/2/2 3/3/3\", \"1\", \"1\", \"1\", \"2\", \"2\", \"2\", \"3\", \"3\", \"3\", undefined, undefined, undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 4 ], result[ 7 ], result[ 10 ],\n            // result[ 2 ], result[ 5 ], result[ 8 ], result[ 11 ],  // ignore uv part\n            result[ 3 ], result[ 6 ], result[ 9 ], result[ 12 ]\n          )\n        } else if (this.regexp.face_vertex_uv.exec(line) !== null) {\n\n          // ignore uv line\n\n        } else if ((result = this.regexp.face_vertex_normal.exec(line)) !== null) {\n          // f vertex//normal vertex//normal vertex//normal\n          // 0                     1    2    3    4    5    6   7          8\n          // [\"f 1//1 2//2 3//3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 3 ], result[ 5 ], result[ 7 ],\n            result[ 2 ], result[ 4 ], result[ 6 ], result[ 8 ]\n          )\n        } else if ((result = this.regexp.face_vertex.exec(line)) !== null) {\n          // f vertex vertex vertex\n          // 0            1    2    3   4\n          // [\"f 1 2 3\", \"1\", \"2\", \"3\", undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 2 ], result[ 3 ], result[ 4 ]\n          )\n        } else {\n          throw new Error(\"Unexpected face line: '\" + line + \"'\")\n        }\n      } else if (lineFirstChar === 'l') {\n        var lineParts = line.substring(1).trim().split(' ')\n        var lineVertices = []\n        var lineUVs = []\n\n        if (line.indexOf('/') === -1) {\n          lineVertices = lineParts\n        } else {\n          for (var li = 0, llen = lineParts.length; li < llen; li++) {\n            var parts = lineParts[ li ].split('/')\n\n            if (parts[ 0 ] !== '') lineVertices.push(parts[ 0 ])\n            if (parts[ 1 ] !== '') lineUVs.push(parts[ 1 ])\n          }\n        }\n        state.addLineGeometry(lineVertices, lineUVs)\n      } else if ((result = this.regexp.object_pattern.exec(line)) !== null) {\n        // o object_name\n        // or\n        // g group_name\n\n        var name = result[ 0 ].substr(1).trim()\n        state.startObject(name)\n\n        // ignore material related lines\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.material_use_pattern.test(line)) {\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.material_library_pattern.test(line)) {\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.smoothing_pattern.exec(line) !== null) {\n      } else {\n        // Handle null terminated files without exception\n        if (line === '\\0') continue\n\n        throw new Error(\"Unexpected line: '\" + line + \"'\")\n      }\n    }\n\n    var container = []\n\n    for (i = 0, l = state.objects.length; i < l; i++) {\n      var object = state.objects[ i ]\n      var geometry = object.geometry\n\n      // Skip o/g line declarations that did not follow with any faces\n      if (geometry.vertices.length === 0) continue\n\n      var buffergeometry = new BufferGeometry()\n\n      buffergeometry.setAttribute('position', new BufferAttribute(new Float32Array(geometry.vertices), 3))\n\n      if (geometry.normals.length > 0) {\n        buffergeometry.setAttribute('normal', new BufferAttribute(new Float32Array(geometry.normals), 3))\n      } else {\n        buffergeometry.computeVertexNormals()\n      }\n\n      container.push(buffergeometry)\n    }\n\n    return container\n  }\n\n}\n\nclass ObjParser extends SurfaceParser {\n  get type () { return 'obj' }\n\n  getLoader () {\n    return new OBJLoader()\n  }\n}\n\nParserRegistry.add('obj', ObjParser)\n\nexport default ObjParser\n","/**\n * @file Csv Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface CsvParserParameters extends ParserParameters {\n  delimiter: string\n  comment: string\n  columnNames: boolean\n}\n/**\n * CSV parser\n */\nclass CsvParser extends Parser {\n  /**\n     * [constructor description]\n     * @param  {Streamer} streamer - the streamer object\n     * @param  {Object} params - parameter object\n     * @param  {Char} params.delimiter - delimiter character\n     * @param  {Char} params.comment - comment character\n     * @param  {Boolean} params.columnNames - use first data line as column names\n     */\n  constructor (streamer: Streamer, params?: Partial<CsvParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.delimiter = defaults(p.delimiter, ',')\n    this.comment = defaults(p.comment, '#')\n    this.columnNames = defaults(p.columnNames, false)\n\n    this.table = {\n      name: this.name,\n      path: this.path,\n      columnNames: [],\n      data: []\n    }\n  }\n\n  get type () { return 'csv' }\n  get __objName () { return 'table' }\n\n  _parse () {\n    const data = this.table.data\n    const reDelimiter = new RegExp('\\\\s*' + this.delimiter + '\\\\s*')\n\n    let j = 0\n\n    this.streamer.eachChunkOfLines(chunk => {\n      const n = chunk.length\n\n      for (let i = 0; i < n; ++i) {\n        const line = chunk[ i ].trim()\n        if (line.startsWith(this.comment)) continue\n        const values = line.split(reDelimiter)\n\n        if (j === 0) {\n          this.table.columnNames = values\n        } else if (line) {\n          data.push(values)\n        }\n        ++j\n      }\n    })\n  }\n}\n\nParserRegistry.add('csv', CsvParser)\n\nexport default CsvParser\n","/**\n * @file Json Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface JsonParserParameters extends ParserParameters {\n  string: boolean\n}\n\nclass JsonParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<JsonParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.string = defaults(p.string, false)\n\n    this.json = {\n      name: this.name,\n      path: this.path,\n      data: {}\n    }\n  }\n\n  get type () { return 'json' }\n  get __objName () { return 'json' }\n  get isJson () { return true }\n\n  _parse () {\n    if (this.streamer.isBinary() || this.string) {\n      this.json.data = JSON.parse(this.streamer.asText())\n    } else {\n      this.json.data = this.streamer.data\n    }\n  }\n}\n\nParserRegistry.add('json', JsonParser)\n\nexport default JsonParser\n","/**\n * @file Msgpack Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\n\nimport { decodeMsgpack } from '../../lib/mmtf.es6'\nimport Streamer from '../streamer/streamer';\n\nclass MsgpackParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.msgpack = {\n      name: this.name,\n      path: this.path,\n      data: undefined\n    }\n  }\n\n  get type () { return 'msgpack' }\n  get __objName () { return 'msgpack' }\n  get isBinary () { return true }\n\n  _parse () {\n    if (Debug) Log.time('MsgpackParser._parse ' + this.name)\n\n    this.msgpack.data = decodeMsgpack(this.streamer.data)\n\n    if (Debug) Log.timeEnd('MsgpackParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('msgpack', MsgpackParser)\n\nexport default MsgpackParser\n","/**\n * @file Netcdf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport NetcdfReader from '../utils/netcdf-reader'\nimport Streamer from '../streamer/streamer';\n\nclass NetcdfParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.netcdf = {\n      name: this.name,\n      path: this.path,\n      data: undefined\n    }\n  }\n\n  get type () { return 'netcdf' }\n  get __objName () { return 'netcdf' }\n  get isBinary () { return true }\n\n  _parse () {\n    if (Debug) Log.time('NetcdfParser._parse ' + this.name)\n\n    this.netcdf.data = new NetcdfReader(this.streamer.data)\n\n    if (Debug) Log.timeEnd('NetcdfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('netcdf', NetcdfParser)\n\nexport default NetcdfParser\n","/**\n * @file Text Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nclass TextParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.text = {\n\n      name: this.name,\n      path: this.path,\n      data: ''\n\n    }\n  }\n\n  get type () { return 'text' }\n  get __objName () { return 'text' }\n\n  _parse () {\n    this.text.data = this.streamer.asText()\n  }\n}\n\nParserRegistry.add('txt', TextParser)\nParserRegistry.add('text', TextParser)\n\nexport default TextParser\n","/**\n * @file Parse Xml\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// https://github.com/segmentio/xml-parser\n// MIT license\n\nexport type XMLNodeAttributes = { [k: string]: any }\nexport interface XMLNode {\n  name?: string\n  content?: string\n  attributes: XMLNodeAttributes\n  children?: XMLNode[]\n}\n\nconst reStrip = /^['\"]|['\"]$/g\nconst reTag = /^<([\\w-:.]+)\\s*/\nconst reContent = /^([^<]*)/\nconst reAttr = /([\\w:-]+)\\s*=\\s*(\"[^\"]*\"|'[^']*'|\\w+)\\s*/\n\nfunction strip (val: string) {\n  return val.replace(reStrip, '')\n}\n\nexport function parseXml (xml: string) {\n  // trim and strip comments\n  xml = xml.trim().replace(/<!--[\\s\\S]*?-->/g, '')\n\n  return document()\n\n  function document () {\n    return {\n      declaration: declaration(),\n      root: tag()\n    }\n  }\n\n  function declaration () {\n    const m = match(/^<\\?xml\\s*/)\n    if (!m) return\n\n    // tag\n    const node: XMLNode = {\n      attributes: {}\n    }\n\n    // attributes\n    while (!(eos() || is('?>'))) {\n      const attr = attribute()\n      if (!attr) return node\n      node.attributes[attr.name] = attr.value\n    }\n    match(/\\?>\\s*/)\n    return node\n  }\n\n  function tag () {\n    const m = match(reTag)\n    if (!m) return\n\n    // name\n    const node: XMLNode = {\n      name: m[1],\n      attributes: {},\n      children: []\n    }\n\n    // attributes\n    while (!(eos() || is('>') || is('?>') || is('/>'))) {\n      const attr = attribute()\n      if (!attr) return node\n      node.attributes[attr.name] = attr.value\n    }\n\n    // self closing tag\n    if (match(/^\\s*\\/>\\s*/)) {\n      return node\n    }\n    match(/\\??>\\s*/)\n\n    // content\n    node.content = content()\n\n    // children\n    let child\n    while ((child = tag())) {\n      node.children!.push(child)\n    }\n\n    // closing\n    match(/^<\\/[\\w-:.]+>\\s*/)\n    return node\n  }\n\n  function content () {\n    const m = match(reContent)\n    if (m) return m[1]\n    return ''\n  }\n\n  function attribute () {\n    const m = match(reAttr)\n    if (!m) return\n    return { name: m[1], value: strip(m[2]) }\n  }\n\n  function match (re: RegExp) {\n    const m = xml.match(re)\n    if (!m) return\n    xml = xml.slice(m[0].length)\n    return m\n  }\n\n  function eos () {\n    return xml.length === 0\n  }\n\n  function is (prefix: string) {\n    return xml.indexOf(prefix) === 0\n  }\n}\n","/**\n * @file Xml Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\n// @ts-ignore: unused import XMLNode required for declaration only\nimport { parseXml, XMLNode } from '../utils/parse-xml'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface XmlParserParameters extends ParserParameters {\n  useDomParser: boolean\n}\n\nclass XmlParser extends Parser {\n  xml: {\n    name: string\n    path: string\n    data: any\n  }\n  constructor (streamer: Streamer, params?: Partial<XmlParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.useDomParser = defaults(p.useDomParser, false)\n\n    this.xml = {\n      name: this.name,\n      path: this.path,\n      data: {}\n    }\n  }\n\n  get type () { return 'xml' }\n  get __objName () { return 'xml' }\n  get isXml () { return true }\n\n  __xmlParser (xml: string) {\n    return parseXml(xml)\n  }\n\n  __domParser (xml: string) {\n    const domParser = new (window as any).DOMParser() as DOMParser\n    return domParser.parseFromString(xml, 'text/xml')\n  }\n\n  _parse () {\n    if (Debug) Log.time('XmlParser._parse ' + this.name)\n\n    if (this.useDomParser) {\n      if (this.streamer.data instanceof Document) { //TS conversion: stripped the window prefix from window.Document\n        this.xml.data = this.streamer.data\n      } else {\n        this.xml.data = this.__domParser(this.streamer.asText())\n      }\n    } else {\n      this.xml.data = this.__xmlParser(this.streamer.asText())\n    }\n\n    if (Debug) Log.timeEnd('XmlParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('xml', XmlParser)\n\nexport default XmlParser\n","/**\n * @file Validation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport { defaults } from '../utils'\nimport { ClashPicker } from '../utils/picker'\nimport { uniformArray3 } from '../math/array-utils'\nimport { guessElement } from '../structure/structure-utils'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Structure from '../structure/structure'\n\nfunction getNamedItem(a: NamedNodeMap, name: string) {\n  const item = a.getNamedItem(name)\n  return item !== null ? item.value : ''\n}\n\nfunction getSele (a: NamedNodeMap, atomname?: string, useAltcode = false) {\n  const icode = getNamedItem(a, 'icode').trim()\n  const chain = getNamedItem(a, 'chain').trim()\n  const altcode = getNamedItem(a, 'altcode')\n  let sele = getNamedItem(a, 'resnum')\n  if (icode) sele += '^' + icode\n  if (chain) sele += ':' + chain\n  if (atomname) sele += '.' + atomname\n  if (useAltcode && altcode.trim()) sele += '%' + altcode\n  sele += '/' + (parseInt(getNamedItem(a, 'model')) - 1)\n  return sele\n}\n\nfunction getResSele (a: NamedNodeMap) {\n  const chain = getNamedItem(a, 'chain').trim()\n  const rescode = getNamedItem(a, 'rescode')\n  const resnum = getNamedItem(a, 'resnum')\n  let sele = `[${rescode}]${resnum}`\n  if (chain) sele += `:${chain}`\n  return sele\n}\n\nfunction setBitDict (dict: { [k: string]: number }, key: string, bit: number) {\n  if (dict[ key ] === undefined) {\n    dict[ key ] = bit\n  } else {\n    dict[ key ] |= bit\n  }\n}\n\nfunction hasAttrValue (attr: Attr|null, value: string) {\n  return attr !== null && attr.value === value\n}\n\nfunction getAtomSele (ap: AtomProxy) {\n  const icode = ap.inscode\n  const chain = ap.chainname\n  const atomname = ap.atomname\n  const altcode = ap.altloc\n  let sele = ap.resno + ''\n  if (icode) sele += '^' + icode\n  if (chain) sele += ':' + chain\n  if (atomname) sele += '.' + atomname\n  if (altcode) sele += '%' + altcode\n  sele += '/' + ap.modelIndex\n  return sele\n}\n\nfunction getProblemCount (clashDict: { [k: string]: { [k: string]: string } }, g: Element, ga: NamedNodeMap) {\n  let geoProblemCount = 0\n\n  const clashes = g.getElementsByTagName('clash')\n  for (let j = 0, jl = clashes.length; j < jl; ++j) {\n    if (clashDict[ getNamedItem(clashes[ j ].attributes, 'cid') ]) {\n      geoProblemCount += 1\n      break\n    }\n  }\n\n  const angleOutliers = g.getElementsByTagName('angle-outlier')\n  if (angleOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  const bondOutliers = g.getElementsByTagName('bond-outlier')\n  if (bondOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  const planeOutliers = g.getElementsByTagName('plane-outlier')\n  if (planeOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('rota'), 'OUTLIER')) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('rama'), 'OUTLIER')) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('RNApucker'), 'outlier')) {\n    geoProblemCount += 1\n  }\n\n  return geoProblemCount\n}\n\nclass Validation {\n  rsrzDict: { [k: string]: number } = {}\n  rsccDict: { [k: string]: number } = {}\n  /**\n   * Random Coil Index (RCI) - evaluates the proximity of residue structural\n   * and dynamic properties to the properties of flexible random coil regions\n   * from NMR chemical shifts.\n   *\n   * Mark V. Berjanskii and David S. Wishart (2005)\n   * A Simple Method To Predict Protein Flexibility Using Secondary Chemical Shifts\n   * J. Am. Chem. Soc., 2005, 127 (43), pp 1497014971\n   * http://pubs.acs.org/doi/abs/10.1021/ja054842f\n   *\n   * Mark V. Berjanskii and David S. Wishart (2008)\n   * Application of the random coil index to studying protein flexibility.\n   * J Biomol NMR. 2008 Jan;40(1):31-48. Epub 2007 Nov 6.\n   * http://www.springerlink.com/content/2966482w10306126/\n   */\n  rciDict: { [k: string]: number } = {}\n  clashDict: { [k: string]: { [k: string]: string } } = {}\n  clashArray: { [k: string]: string }[] = []\n  geoDict: { [k: string]: number } = {}\n  geoAtomDict: { [k: string]: { [k: string]: number } } = {}\n  atomDict: { [k: string]: boolean|number } = {}\n  clashSele = 'NONE'\n\n  constructor (readonly name: string, readonly path: string) {}\n\n  get type () { return 'validation' }\n\n  fromXml (xml: XMLDocument) {\n    if (Debug) Log.time('Validation.fromXml')\n\n    const rsrzDict = this.rsrzDict\n    const rsccDict = this.rsccDict\n    const rciDict = this.rciDict\n    const clashDict = this.clashDict\n    const clashArray = this.clashArray\n    const geoDict = this.geoDict\n    const geoAtomDict = this.geoAtomDict\n    const atomDict = this.atomDict\n\n    const entries = xml.getElementsByTagName('Entry')\n    if (entries.length === 1) {\n      const chemicalShiftLists = entries[0].getElementsByTagName('chemical_shift_list')\n      if (chemicalShiftLists.length === 1) {\n        const randomCoilIndices = chemicalShiftLists[0].getElementsByTagName('random_coil_index')\n        for (let j = 0, jl = randomCoilIndices.length; j < jl; ++j) {\n          const rcia = randomCoilIndices[ j ].attributes\n          const sele = getResSele(rcia)\n          rciDict[ sele ] = parseFloat(getNamedItem(rcia, 'value'))\n        }\n      }\n    }\n\n    const groups = xml.getElementsByTagName('ModelledSubgroup')\n\n    const _clashDict: { [k: string]: { [k: string]: string } } = {}\n    const clashList: string[] = []\n\n    if (Debug) Log.time('Validation.fromXml#clashDict')\n\n    for (let i = 0, il = groups.length; i < il; ++i) {\n      const g = groups[ i ]\n      const ga = g.attributes\n\n      const sele = getSele(ga)\n      if (ga.getNamedItem('rsrz') !== null) {\n        rsrzDict[ sele ] = parseFloat(getNamedItem(ga, 'rsrz'))\n      }\n      if (ga.getNamedItem('rscc') !== null) {\n        rsccDict[ sele ] = parseFloat(getNamedItem(ga, 'rscc'))\n      }\n      const seleAttr = xml.createAttribute('sele')\n      seleAttr.value = sele\n      ga.setNamedItem(seleAttr)\n\n      const clashes = g.getElementsByTagName('clash')\n\n      for (let j = 0, jl = clashes.length; j < jl; ++j) {\n        const ca = clashes[ j ].attributes\n        const atom = getNamedItem(ca, 'atom')\n\n        if (guessElement(atom) !== 'H') {\n          const cid = getNamedItem(ca, 'cid')\n          const atomSele = getSele(ga, atom, true)\n          atomDict[ atomSele ] = true\n\n          if (_clashDict[ cid ] === undefined) {\n            _clashDict[ cid ] = {\n              sele1: atomSele,\n              res1: sele\n            }\n          } else {\n            const c = _clashDict[ cid ]\n            if (c.res1 !== sele) {\n              c.sele2 = atomSele\n              c.res2 = sele\n              clashList.push(c.res1, sele)\n              clashDict[ cid ] = c\n              clashArray.push(c)\n            }\n          }\n        }\n      }\n    }\n\n    if (Debug) Log.timeEnd('Validation.fromXml#clashDict')\n\n    for (let i = 0, il = groups.length; i < il; ++i) {\n      const g = groups[ i ]\n      const ga = g.attributes\n\n      const sele = getNamedItem(ga, 'sele')\n      const isPolymer = getNamedItem(ga, 'seq') !== '.'\n\n      if (isPolymer) {\n        const geoProblemCount = getProblemCount(clashDict, g, ga)\n        if (geoProblemCount > 0) {\n          geoDict[ sele ] = geoProblemCount\n        }\n      } else {\n        const clashes = g.getElementsByTagName('clash')\n        const mogBondOutliers = g.getElementsByTagName('mog-bond-outlier')\n        const mogAngleOutliers = g.getElementsByTagName('mog-angle-outlier')\n\n        if (mogBondOutliers.length > 0 || mogAngleOutliers.length > 0 || clashes.length > 0) {\n          const atomDict = {}\n          geoAtomDict[ sele ] = atomDict\n\n          for (let j = 0, jl = clashes.length; j < jl; ++j) {\n            const ca = clashes[ j ].attributes\n            if (clashDict[ getNamedItem(ca, 'cid') ]) {\n              setBitDict(atomDict, getNamedItem(ca, 'atom'), 1)\n            }\n          }\n\n          for (let j = 0, jl = mogBondOutliers.length; j < jl; ++j) {\n            const mbo = mogBondOutliers[ j ].attributes\n            getNamedItem(mbo, 'atoms').split(',').forEach(function (atomname) {\n              setBitDict(atomDict, atomname, 2)\n            })\n          }\n\n          for (let j = 0, jl = mogAngleOutliers.length; j < jl; ++j) {\n            const mao = mogAngleOutliers[ j ].attributes\n            getNamedItem(mao, 'atoms').split(',').forEach(function (atomname) {\n              setBitDict(atomDict, atomname, 4)\n            })\n          }\n        }\n      }\n    }\n\n    this.clashSele = clashList.length ? clashList.join(' OR ') : 'NONE'\n\n    if (Debug) Log.timeEnd('Validation.fromXml')\n  }\n\n  getClashData (params: { color: number|string|Color, structure: Structure }) {\n    if (Debug) Log.time('Validation.getClashData')\n\n    const p = params || {}\n\n    const s = p.structure\n    const atomSet = s.atomSet!  // TODO\n    const c = new Color(defaults(p.color, '#f0027f'))\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n    const vDir = new Vector3()\n    const vPos1 = new Vector3()\n    const vPos2 = new Vector3()\n\n    const clashArray = this.clashArray\n    const n = clashArray.length\n\n    const position1 = new Float32Array(n * 3)\n    const position2 = new Float32Array(n * 3)\n    const color = uniformArray3(n, c.r, c.g, c.b) as Float32Array\n    const radius = new Float32Array(n)\n    const picking = new Float32Array(n)\n\n    if (Debug) Log.time('Validation.getClashData#atomDict')\n\n    const atomDict = this.atomDict\n\n    s.eachAtom(function (ap) {\n      const sele = getAtomSele(ap)\n      if (atomDict[ sele ] === true) {\n        atomDict[ sele ] = ap.index\n      }\n    })\n\n    if (Debug) Log.timeEnd('Validation.getClashData#atomDict')\n\n    let i = 0\n\n    clashArray.forEach(function (c, idx) {\n      ap1.index = atomDict[ c.sele1 ] as number  // TODO\n      ap2.index = atomDict[ c.sele2 ] as number  // TODO\n\n      if (ap1.index === undefined || ap2.index === undefined ||\n          !atomSet.isSet(ap1.index, ap2.index)) return\n\n      vDir.subVectors(ap2 as any, ap1 as any).setLength(ap1.vdw)  // TODO\n      vPos1.copy(ap1 as any).add(vDir)  // TODO\n\n      vDir.subVectors(ap1 as any, ap2 as any).setLength(ap2.vdw)  // TODO\n      vPos2.copy(ap2 as any).add(vDir)  // TODO\n\n      const dHalf = ap1.distanceTo(ap2) / 2\n      const r1 = Math.sqrt(ap1.vdw * ap1.vdw - dHalf * dHalf)\n      const r2 = Math.sqrt(ap2.vdw * ap2.vdw - dHalf * dHalf)\n\n      vPos1.toArray(position1 as any, i * 3)  // TODO\n      vPos2.toArray(position2 as any, i * 3)\n      radius[ i ] = (r1 + r2) / 2\n      picking[ i ] = idx\n\n      ++i\n    })\n\n    if (Debug) Log.timeEnd('Validation.getClashData')\n\n    return {\n      position1: position1.subarray(0, i * 3),\n      position2: position2.subarray(0, i * 3),\n      color: color.subarray(0, i * 3),\n      color2: color.subarray(0, i * 3),\n      radius: radius.subarray(0, i),\n      picking: new ClashPicker(picking.subarray(0, i), this, s)\n    }\n  }\n}\n\nexport default Validation\n","\n// https://github.com/nodeca/pako\n// MIT License, Copyright (c) 2014 by Vitaly Puzrin\n\n\n// 'use strict';\n\n\n// var TYPED_OK =  (typeof Uint8Array !== 'undefined') &&\n//                 (typeof Uint16Array !== 'undefined') &&\n//                 (typeof Int32Array !== 'undefined');\n\n\nfunction assign(obj /*from1, from2, from3, ...*/) {\n  var sources = Array.prototype.slice.call(arguments, 1);\n  while (sources.length) {\n    var source = sources.shift();\n    if (!source) { continue; }\n\n    if (typeof source !== 'object') {\n      throw new TypeError(source + 'must be non-object');\n    }\n\n    for (var p in source) {\n      if (source.hasOwnProperty(p)) {\n        obj[p] = source[p];\n      }\n    }\n  }\n\n  return obj;\n}\n\n\n// reduce buffer size, avoiding mem copy\nfunction shrinkBuf(buf, size) {\n  if (buf.length === size) { return buf; }\n  if (buf.subarray) { return buf.subarray(0, size); }\n  buf.length = size;\n  return buf;\n}\n\n\nfunction arraySet(dest, src, src_offs, len, dest_offs) {\n  if (src.subarray && dest.subarray) {\n    dest.set(src.subarray(src_offs, src_offs + len), dest_offs);\n    return;\n  }\n  // Fallback to ordinary array\n  for (var i = 0; i < len; i++) {\n    dest[dest_offs + i] = src[src_offs + i];\n  }\n}\n\n// Join array of chunks to single array.\nfunction flattenChunks(chunks) {\n  var i, l, len, pos, chunk, result;\n\n  // calculate data length\n  len = 0;\n  for (i = 0, l = chunks.length; i < l; i++) {\n    len += chunks[i].length;\n  }\n\n  // join chunks\n  result = new Uint8Array(len);\n  pos = 0;\n  for (i = 0, l = chunks.length; i < l; i++) {\n    chunk = chunks[i];\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n// 'use strict';\n\n// Note: adler32 takes 12% for level 0 and 2% for level 6.\n// It doesn't worth to make additional optimizationa as in original.\n// Small size is preferable.\n\nfunction adler32(adler, buf, len, pos) {\n  var s1 = (adler & 0xffff) |0,\n      s2 = ((adler >>> 16) & 0xffff) |0,\n      n = 0;\n\n  while (len !== 0) {\n    // Set limit ~ twice less than 5552, to keep\n    // s2 in 31-bits, because we force signed ints.\n    // in other case %= will fail.\n    n = len > 2000 ? 2000 : len;\n    len -= n;\n\n    do {\n      s1 = (s1 + buf[pos++]) |0;\n      s2 = (s2 + s1) |0;\n    } while (--n);\n\n    s1 %= 65521;\n    s2 %= 65521;\n  }\n\n  return (s1 | (s2 << 16)) |0;\n}\n\n// 'use strict';\n\n// Note: we can't get significant speed boost here.\n// So write code to minimize size - no pregenerated tables\n// and array tools dependencies.\n\n\n// Use ordinary array, since untyped makes no boost here\nfunction makeTable() {\n  var c, table = [];\n\n  for (var n = 0; n < 256; n++) {\n    c = n;\n    for (var k = 0; k < 8; k++) {\n      c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n    }\n    table[n] = c;\n  }\n\n  return table;\n}\n\n// Create table on load. Just 255 signed longs. Not a problem.\nvar crcTable = makeTable();\n\n\nfunction crc32(crc, buf, len, pos) {\n  var t = crcTable,\n      end = pos + len;\n\n  crc ^= -1;\n\n  for (var i = pos; i < end; i++) {\n    crc = (crc >>> 8) ^ t[(crc ^ buf[i]) & 0xFF];\n  }\n\n  return (crc ^ (-1)); // >>> 0;\n}\n\n// 'use strict';\n\n// See state defs from inflate.js\nvar BAD$1 = 30;       /* got a data error -- remain here until reset */\nvar TYPE$1 = 12;      /* i: waiting for type bits, including last-flag bit */\n\n/*\n   Decode literal, length, and distance codes and write out the resulting\n   literal and match bytes until either not enough input or output is\n   available, an end-of-block is encountered, or a data error is encountered.\n   When large enough input and output buffers are supplied to inflate(), for\n   example, a 16K input buffer and a 64K output buffer, more than 95% of the\n   inflate execution time is spent in this routine.\n\n   Entry assumptions:\n\n        state.mode === LEN\n        strm.avail_in >= 6\n        strm.avail_out >= 258\n        start >= strm.avail_out\n        state.bits < 8\n\n   On return, state.mode is one of:\n\n        LEN -- ran out of enough output space or enough available input\n        TYPE -- reached end of block code, inflate() to interpret next block\n        BAD -- error in block data\n\n   Notes:\n\n    - The maximum input bits used by a length/distance pair is 15 bits for the\n      length code, 5 bits for the length extra, 15 bits for the distance code,\n      and 13 bits for the distance extra.  This totals 48 bits, or six bytes.\n      Therefore if strm.avail_in >= 6, then there is enough input to avoid\n      checking for available input while decoding.\n\n    - The maximum bytes that a single length/distance pair can output is 258\n      bytes, which is the maximum length that can be coded.  inflate_fast()\n      requires strm.avail_out >= 258 for each loop to avoid checking for\n      output space.\n */\n// module.exports =\nfunction inflate_fast(strm, start) {\n  var state;\n  var _in;                    /* local strm.input */\n  var last;                   /* have enough input while in < last */\n  var _out;                   /* local strm.output */\n  var beg;                    /* inflate()'s initial strm.output */\n  var end;                    /* while out < end, enough space available */\n//#ifdef INFLATE_STRICT\n  var dmax;                   /* maximum distance from zlib header */\n//#endif\n  var wsize;                  /* window size or zero if not using window */\n  var whave;                  /* valid bytes in the window */\n  var wnext;                  /* window write index */\n  // Use `s_window` instead `window`, avoid conflict with instrumentation tools\n  var s_window;               /* allocated sliding window, if wsize != 0 */\n  var hold;                   /* local strm.hold */\n  var bits;                   /* local strm.bits */\n  var lcode;                  /* local strm.lencode */\n  var dcode;                  /* local strm.distcode */\n  var lmask;                  /* mask for first level of length codes */\n  var dmask;                  /* mask for first level of distance codes */\n  var here;                   /* retrieved table entry */\n  var op;                     /* code bits, operation, extra bits, or */\n                              /*  window position, window bytes to copy */\n  var len;                    /* match length, unused bytes */\n  var dist;                   /* match distance */\n  var from;                   /* where to copy match from */\n  var from_source;\n\n\n  var input, output; // JS specific, because we have no pointers\n\n  /* copy state to local variables */\n  state = strm.state;\n  //here = state.here;\n  _in = strm.next_in;\n  input = strm.input;\n  last = _in + (strm.avail_in - 5);\n  _out = strm.next_out;\n  output = strm.output;\n  beg = _out - (start - strm.avail_out);\n  end = _out + (strm.avail_out - 257);\n//#ifdef INFLATE_STRICT\n  dmax = state.dmax;\n//#endif\n  wsize = state.wsize;\n  whave = state.whave;\n  wnext = state.wnext;\n  s_window = state.window;\n  hold = state.hold;\n  bits = state.bits;\n  lcode = state.lencode;\n  dcode = state.distcode;\n  lmask = (1 << state.lenbits) - 1;\n  dmask = (1 << state.distbits) - 1;\n\n\n  /* decode literals and length/distances until end-of-block or not enough\n     input data or output space */\n\n  top:\n  do {\n    if (bits < 15) {\n      hold += input[_in++] << bits;\n      bits += 8;\n      hold += input[_in++] << bits;\n      bits += 8;\n    }\n\n    here = lcode[hold & lmask];\n\n    dolen:\n    for (;;) { // Goto emulation\n      op = here >>> 24/*here.bits*/;\n      hold >>>= op;\n      bits -= op;\n      op = (here >>> 16) & 0xff/*here.op*/;\n      if (op === 0) {                          /* literal */\n        //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n        //        \"inflate:         literal '%c'\\n\" :\n        //        \"inflate:         literal 0x%02x\\n\", here.val));\n        output[_out++] = here & 0xffff/*here.val*/;\n      }\n      else if (op & 16) {                     /* length base */\n        len = here & 0xffff/*here.val*/;\n        op &= 15;                           /* number of extra bits */\n        if (op) {\n          if (bits < op) {\n            hold += input[_in++] << bits;\n            bits += 8;\n          }\n          len += hold & ((1 << op) - 1);\n          hold >>>= op;\n          bits -= op;\n        }\n        //Tracevv((stderr, \"inflate:         length %u\\n\", len));\n        if (bits < 15) {\n          hold += input[_in++] << bits;\n          bits += 8;\n          hold += input[_in++] << bits;\n          bits += 8;\n        }\n        here = dcode[hold & dmask];\n\n        dodist:\n        for (;;) { // goto emulation\n          op = here >>> 24/*here.bits*/;\n          hold >>>= op;\n          bits -= op;\n          op = (here >>> 16) & 0xff/*here.op*/;\n\n          if (op & 16) {                      /* distance base */\n            dist = here & 0xffff/*here.val*/;\n            op &= 15;                       /* number of extra bits */\n            if (bits < op) {\n              hold += input[_in++] << bits;\n              bits += 8;\n              if (bits < op) {\n                hold += input[_in++] << bits;\n                bits += 8;\n              }\n            }\n            dist += hold & ((1 << op) - 1);\n//#ifdef INFLATE_STRICT\n            if (dist > dmax) {\n              strm.msg = 'invalid distance too far back';\n              state.mode = BAD$1;\n              break top;\n            }\n//#endif\n            hold >>>= op;\n            bits -= op;\n            //Tracevv((stderr, \"inflate:         distance %u\\n\", dist));\n            op = _out - beg;                /* max distance in output */\n            if (dist > op) {                /* see if copy from window */\n              op = dist - op;               /* distance back in window */\n              if (op > whave) {\n                if (state.sane) {\n                  strm.msg = 'invalid distance too far back';\n                  state.mode = BAD$1;\n                  break top;\n                }\n\n// (!) This block is disabled in zlib defailts,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//                if (len <= op - whave) {\n//                  do {\n//                    output[_out++] = 0;\n//                  } while (--len);\n//                  continue top;\n//                }\n//                len -= op - whave;\n//                do {\n//                  output[_out++] = 0;\n//                } while (--op > whave);\n//                if (op === 0) {\n//                  from = _out - dist;\n//                  do {\n//                    output[_out++] = output[from++];\n//                  } while (--len);\n//                  continue top;\n//                }\n//#endif\n              }\n              from = 0; // window index\n              from_source = s_window;\n              if (wnext === 0) {           /* very common case */\n                from += wsize - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              else if (wnext < op) {      /* wrap around window */\n                from += wsize + wnext - op;\n                op -= wnext;\n                if (op < len) {         /* some from end of window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = 0;\n                  if (wnext < len) {  /* some from start of window */\n                    op = wnext;\n                    len -= op;\n                    do {\n                      output[_out++] = s_window[from++];\n                    } while (--op);\n                    from = _out - dist;      /* rest from output */\n                    from_source = output;\n                  }\n                }\n              }\n              else {                      /* contiguous in window */\n                from += wnext - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              while (len > 2) {\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                len -= 3;\n              }\n              if (len) {\n                output[_out++] = from_source[from++];\n                if (len > 1) {\n                  output[_out++] = from_source[from++];\n                }\n              }\n            }\n            else {\n              from = _out - dist;          /* copy direct from output */\n              do {                        /* minimum length is three */\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                len -= 3;\n              } while (len > 2);\n              if (len) {\n                output[_out++] = output[from++];\n                if (len > 1) {\n                  output[_out++] = output[from++];\n                }\n              }\n            }\n          }\n          else if ((op & 64) === 0) {          /* 2nd level distance code */\n            here = dcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n            continue dodist;\n          }\n          else {\n            strm.msg = 'invalid distance code';\n            state.mode = BAD$1;\n            break top;\n          }\n\n          break; // need to emulate goto via \"continue\"\n        }\n      }\n      else if ((op & 64) === 0) {              /* 2nd level length code */\n        here = lcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n        continue dolen;\n      }\n      else if (op & 32) {                     /* end-of-block */\n        //Tracevv((stderr, \"inflate:         end of block\\n\"));\n        state.mode = TYPE$1;\n        break top;\n      }\n      else {\n        strm.msg = 'invalid literal/length code';\n        state.mode = BAD$1;\n        break top;\n      }\n\n      break; // need to emulate goto via \"continue\"\n    }\n  } while (_in < last && _out < end);\n\n  /* return unused bytes (on entry, bits < 8, so in won't go too far back) */\n  len = bits >> 3;\n  _in -= len;\n  bits -= len << 3;\n  hold &= (1 << bits) - 1;\n\n  /* update state and return */\n  strm.next_in = _in;\n  strm.next_out = _out;\n  strm.avail_in = (_in < last ? 5 + (last - _in) : 5 - (_in - last));\n  strm.avail_out = (_out < end ? 257 + (end - _out) : 257 - (_out - end));\n  state.hold = hold;\n  state.bits = bits;\n  return;\n};\n\n// 'use strict';\n\n\n// var utils = require('../utils/common');\n\nvar MAXBITS = 15;\nvar ENOUGH_LENS$1 = 852;\nvar ENOUGH_DISTS$1 = 592;\n//var ENOUGH = (ENOUGH_LENS+ENOUGH_DISTS);\n\nvar CODES$1 = 0;\nvar LENS$1 = 1;\nvar DISTS$1 = 2;\n\nvar lbase = [ /* Length codes 257..285 base */\n  3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n  35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n];\n\nvar lext = [ /* Length codes 257..285 extra */\n  16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,\n  19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78\n];\n\nvar dbase = [ /* Distance codes 0..29 base */\n  1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n  257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n  8193, 12289, 16385, 24577, 0, 0\n];\n\nvar dext = [ /* Distance codes 0..29 extra */\n  16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22,\n  23, 23, 24, 24, 25, 25, 26, 26, 27, 27,\n  28, 28, 29, 29, 64, 64\n];\n\n// module.exports =\nfunction inflate_table(type, lens, lens_index, codes, table, table_index, work, opts)\n{\n  var bits = opts.bits;\n      //here = opts.here; /* table entry for duplication */\n\n  var len = 0;               /* a code's length in bits */\n  var sym = 0;               /* index of code symbols */\n  var min = 0, max = 0;          /* minimum and maximum code lengths */\n  var root = 0;              /* number of index bits for root table */\n  var curr = 0;              /* number of index bits for current table */\n  var drop = 0;              /* code bits to drop for sub-table */\n  var left = 0;                   /* number of prefix codes available */\n  var used = 0;              /* code entries in table used */\n  var huff = 0;              /* Huffman code */\n  var incr;              /* for incrementing code, index */\n  var fill;              /* index for replicating entries */\n  var low;               /* low bits for current root entry */\n  var mask;              /* mask for low root bits */\n  var next;             /* next available space in table */\n  var base = null;     /* base value table to use */\n  var base_index = 0;\n//  var shoextra;    /* extra bits table to use */\n  var end;                    /* use base and extra for symbol > end */\n  var count = new Uint16Array(MAXBITS + 1); //[MAXBITS+1];    /* number of codes of each length */\n  var offs = new Uint16Array(MAXBITS + 1); //[MAXBITS+1];     /* offsets in table for each length */\n  var extra = null;\n  var extra_index = 0;\n\n  var here_bits, here_op, here_val;\n\n  /*\n   Process a set of code lengths to create a canonical Huffman code.  The\n   code lengths are lens[0..codes-1].  Each length corresponds to the\n   symbols 0..codes-1.  The Huffman code is generated by first sorting the\n   symbols by length from short to long, and retaining the symbol order\n   for codes with equal lengths.  Then the code starts with all zero bits\n   for the first code of the shortest length, and the codes are integer\n   increments for the same length, and zeros are appended as the length\n   increases.  For the deflate format, these bits are stored backwards\n   from their more natural integer increment ordering, and so when the\n   decoding tables are built in the large loop below, the integer codes\n   are incremented backwards.\n\n   This routine assumes, but does not check, that all of the entries in\n   lens[] are in the range 0..MAXBITS.  The caller must assure this.\n   1..MAXBITS is interpreted as that code length.  zero means that that\n   symbol does not occur in this code.\n\n   The codes are sorted by computing a count of codes for each length,\n   creating from that a table of starting indices for each length in the\n   sorted table, and then entering the symbols in order in the sorted\n   table.  The sorted table is work[], with that space being provided by\n   the caller.\n\n   The length counts are used for other purposes as well, i.e. finding\n   the minimum and maximum length codes, determining if there are any\n   codes at all, checking for a valid set of lengths, and looking ahead\n   at length counts to determine sub-table sizes when building the\n   decoding tables.\n   */\n\n  /* accumulate lengths for codes (assumes lens[] all in 0..MAXBITS) */\n  for (len = 0; len <= MAXBITS; len++) {\n    count[len] = 0;\n  }\n  for (sym = 0; sym < codes; sym++) {\n    count[lens[lens_index + sym]]++;\n  }\n\n  /* bound code lengths, force root to be within code lengths */\n  root = bits;\n  for (max = MAXBITS; max >= 1; max--) {\n    if (count[max] !== 0) { break; }\n  }\n  if (root > max) {\n    root = max;\n  }\n  if (max === 0) {                     /* no symbols to code at all */\n    //table.op[opts.table_index] = 64;  //here.op = (var char)64;    /* invalid code marker */\n    //table.bits[opts.table_index] = 1;   //here.bits = (var char)1;\n    //table.val[opts.table_index++] = 0;   //here.val = (var short)0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n\n    //table.op[opts.table_index] = 64;\n    //table.bits[opts.table_index] = 1;\n    //table.val[opts.table_index++] = 0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n    opts.bits = 1;\n    return 0;     /* no symbols, but wait for decoding to report error */\n  }\n  for (min = 1; min < max; min++) {\n    if (count[min] !== 0) { break; }\n  }\n  if (root < min) {\n    root = min;\n  }\n\n  /* check for an over-subscribed or incomplete set of lengths */\n  left = 1;\n  for (len = 1; len <= MAXBITS; len++) {\n    left <<= 1;\n    left -= count[len];\n    if (left < 0) {\n      return -1;\n    }        /* over-subscribed */\n  }\n  if (left > 0 && (type === CODES$1 || max !== 1)) {\n    return -1;                      /* incomplete set */\n  }\n\n  /* generate offsets into symbol table for each length for sorting */\n  offs[1] = 0;\n  for (len = 1; len < MAXBITS; len++) {\n    offs[len + 1] = offs[len] + count[len];\n  }\n\n  /* sort symbols by length, by symbol order within each length */\n  for (sym = 0; sym < codes; sym++) {\n    if (lens[lens_index + sym] !== 0) {\n      work[offs[lens[lens_index + sym]]++] = sym;\n    }\n  }\n\n  /*\n   Create and fill in decoding tables.  In this loop, the table being\n   filled is at next and has curr index bits.  The code being used is huff\n   with length len.  That code is converted to an index by dropping drop\n   bits off of the bottom.  For codes where len is less than drop + curr,\n   those top drop + curr - len bits are incremented through all values to\n   fill the table with replicated entries.\n\n   root is the number of index bits for the root table.  When len exceeds\n   root, sub-tables are created pointed to by the root entry with an index\n   of the low root bits of huff.  This is saved in low to check for when a\n   new sub-table should be started.  drop is zero when the root table is\n   being filled, and drop is root when sub-tables are being filled.\n\n   When a new sub-table is needed, it is necessary to look ahead in the\n   code lengths to determine what size sub-table is needed.  The length\n   counts are used for this, and so count[] is decremented as codes are\n   entered in the tables.\n\n   used keeps track of how many table entries have been allocated from the\n   provided *table space.  It is checked for LENS and DIST tables against\n   the constants ENOUGH_LENS and ENOUGH_DISTS to guard against changes in\n   the initial root table size constants.  See the comments in inftrees.h\n   for more information.\n\n   sym increments through all symbols, and the loop terminates when\n   all codes of length max, i.e. all codes, have been processed.  This\n   routine permits incomplete codes, so another loop after this one fills\n   in the rest of the decoding tables with invalid code markers.\n   */\n\n  /* set up for code type */\n  // poor man optimization - use if-else instead of switch,\n  // to avoid deopts in old v8\n  if (type === CODES$1) {\n    base = extra = work;    /* dummy value--not used */\n    end = 19;\n\n  } else if (type === LENS$1) {\n    base = lbase;\n    base_index -= 257;\n    extra = lext;\n    extra_index -= 257;\n    end = 256;\n\n  } else {                    /* DISTS */\n    base = dbase;\n    extra = dext;\n    end = -1;\n  }\n\n  /* initialize opts for loop */\n  huff = 0;                   /* starting code */\n  sym = 0;                    /* starting code symbol */\n  len = min;                  /* starting code length */\n  next = table_index;              /* current table to fill in */\n  curr = root;                /* current table index bits */\n  drop = 0;                   /* current bits to drop from code for index */\n  low = -1;                   /* trigger new sub-table when len > root */\n  used = 1 << root;          /* use root table entries */\n  mask = used - 1;            /* mask for comparing low */\n\n  /* check available table space */\n  if ((type === LENS$1 && used > ENOUGH_LENS$1) ||\n    (type === DISTS$1 && used > ENOUGH_DISTS$1)) {\n    return 1;\n  }\n\n  var i = 0;\n  /* process all codes and make table entries */\n  for (;;) {\n    i++;\n    /* create table entry */\n    here_bits = len - drop;\n    if (work[sym] < end) {\n      here_op = 0;\n      here_val = work[sym];\n    }\n    else if (work[sym] > end) {\n      here_op = extra[extra_index + work[sym]];\n      here_val = base[base_index + work[sym]];\n    }\n    else {\n      here_op = 32 + 64;         /* end of block */\n      here_val = 0;\n    }\n\n    /* replicate for those indices with low len bits equal to huff */\n    incr = 1 << (len - drop);\n    fill = 1 << curr;\n    min = fill;                 /* save offset to next table */\n    do {\n      fill -= incr;\n      table[next + (huff >> drop) + fill] = (here_bits << 24) | (here_op << 16) | here_val |0;\n    } while (fill !== 0);\n\n    /* backwards increment the len-bit code huff */\n    incr = 1 << (len - 1);\n    while (huff & incr) {\n      incr >>= 1;\n    }\n    if (incr !== 0) {\n      huff &= incr - 1;\n      huff += incr;\n    } else {\n      huff = 0;\n    }\n\n    /* go to next symbol, update count, len */\n    sym++;\n    if (--count[len] === 0) {\n      if (len === max) { break; }\n      len = lens[lens_index + work[sym]];\n    }\n\n    /* create new sub-table if needed */\n    if (len > root && (huff & mask) !== low) {\n      /* if first time, transition to sub-tables */\n      if (drop === 0) {\n        drop = root;\n      }\n\n      /* increment past last table */\n      next += min;            /* here min is 1 << curr */\n\n      /* determine length of next table */\n      curr = len - drop;\n      left = 1 << curr;\n      while (curr + drop < max) {\n        left -= count[curr + drop];\n        if (left <= 0) { break; }\n        curr++;\n        left <<= 1;\n      }\n\n      /* check for enough space */\n      used += 1 << curr;\n      if ((type === LENS$1 && used > ENOUGH_LENS$1) ||\n        (type === DISTS$1 && used > ENOUGH_DISTS$1)) {\n        return 1;\n      }\n\n      /* point entry in root table to sub-table */\n      low = huff & mask;\n      /*table.op[low] = curr;\n      table.bits[low] = root;\n      table.val[low] = next - opts.table_index;*/\n      table[low] = (root << 24) | (curr << 16) | (next - table_index) |0;\n    }\n  }\n\n  /* fill in remaining table entry if code is incomplete (guaranteed to have\n   at most one remaining entry, since if the code is incomplete, the\n   maximum code length that was allowed to get this far is one bit) */\n  if (huff !== 0) {\n    //table.op[next + huff] = 64;            /* invalid code marker */\n    //table.bits[next + huff] = len - drop;\n    //table.val[next + huff] = 0;\n    table[next + huff] = ((len - drop) << 24) | (64 << 16) |0;\n  }\n\n  /* set return parameters */\n  //opts.table_index += used;\n  opts.bits = root;\n  return 0;\n};\n\n// 'use strict';\n\n\n// var utils         = require('../utils/common');\n// var adler32       = require('./adler32');\n// var crc32         = require('./crc32');\n// var inflate_fast  = require('./inffast');\n// var inflate_table = require('./inftrees');\n\nvar CODES = 0;\nvar LENS = 1;\nvar DISTS = 2;\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\n\n/* Allowed flush values; see deflate() and inflate() below for details */\n//var Z_NO_FLUSH      = 0;\n//var Z_PARTIAL_FLUSH = 1;\n//var Z_SYNC_FLUSH    = 2;\n//var Z_FULL_FLUSH    = 3;\nvar Z_FINISH        = 4;\nvar Z_BLOCK         = 5;\nvar Z_TREES         = 6;\n\n\n/* Return codes for the compression/decompression functions. Negative values\n * are errors, positive values are used for special but normal events.\n */\nvar Z_OK            = 0;\nvar Z_STREAM_END    = 1;\nvar Z_NEED_DICT     = 2;\n//var Z_ERRNO         = -1;\nvar Z_STREAM_ERROR  = -2;\nvar Z_DATA_ERROR    = -3;\nvar Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR     = -5;\n//var Z_VERSION_ERROR = -6;\n\n/* The deflate compression method */\nvar Z_DEFLATED  = 8;\n\n\n/* STATES ====================================================================*/\n/* ===========================================================================*/\n\n\nvar    HEAD = 1;       /* i: waiting for magic header */\nvar    FLAGS = 2;      /* i: waiting for method and flags (gzip) */\nvar    TIME = 3;       /* i: waiting for modification time (gzip) */\nvar    OS = 4;         /* i: waiting for extra flags and operating system (gzip) */\nvar    EXLEN = 5;      /* i: waiting for extra length (gzip) */\nvar    EXTRA = 6;      /* i: waiting for extra bytes (gzip) */\nvar    NAME = 7;       /* i: waiting for end of file name (gzip) */\nvar    COMMENT = 8;    /* i: waiting for end of comment (gzip) */\nvar    HCRC = 9;       /* i: waiting for header crc (gzip) */\nvar    DICTID = 10;    /* i: waiting for dictionary check value */\nvar    DICT = 11;      /* waiting for inflateSetDictionary() call */\nvar        TYPE = 12;      /* i: waiting for type bits, including last-flag bit */\nvar        TYPEDO = 13;    /* i: same, but skip check to exit inflate on new block */\nvar        STORED = 14;    /* i: waiting for stored size (length and complement) */\nvar        COPY_ = 15;     /* i/o: same as COPY below, but only first time in */\nvar        COPY = 16;      /* i/o: waiting for input or output to copy stored block */\nvar        TABLE = 17;     /* i: waiting for dynamic block table lengths */\nvar        LENLENS = 18;   /* i: waiting for code length code lengths */\nvar        CODELENS = 19;  /* i: waiting for length/lit and distance code lengths */\nvar            LEN_ = 20;      /* i: same as LEN below, but only first time in */\nvar            LEN = 21;       /* i: waiting for length/lit/eob code */\nvar            LENEXT = 22;    /* i: waiting for length extra bits */\nvar            DIST = 23;      /* i: waiting for distance code */\nvar            DISTEXT = 24;   /* i: waiting for distance extra bits */\nvar            MATCH = 25;     /* o: waiting for output space to copy string */\nvar            LIT = 26;       /* o: waiting for output space to write literal */\nvar    CHECK = 27;     /* i: waiting for 32-bit check value */\nvar    LENGTH = 28;    /* i: waiting for 32-bit length (gzip) */\nvar    DONE = 29;      /* finished check, done -- remain here until reset */\nvar    BAD = 30;       /* got a data error -- remain here until reset */\nvar    MEM = 31;       /* got an inflate() memory error -- remain here until reset */\nvar    SYNC = 32;      /* looking for synchronization bytes to restart inflate() */\n\n/* ===========================================================================*/\n\n\n\nvar ENOUGH_LENS = 852;\nvar ENOUGH_DISTS = 592;\nfunction zswap32(q) {\n  return  (((q >>> 24) & 0xff) +\n          ((q >>> 8) & 0xff00) +\n          ((q & 0xff00) << 8) +\n          ((q & 0xff) << 24));\n}\n\n\nfunction InflateState() {\n  this.mode = 0;             /* current inflate mode */\n  this.last = false;          /* true if processing last block */\n  this.wrap = 0;              /* bit 0 true for zlib, bit 1 true for gzip */\n  this.havedict = false;      /* true if dictionary provided */\n  this.flags = 0;             /* gzip header method and flags (0 if zlib) */\n  this.dmax = 0;              /* zlib header max distance (INFLATE_STRICT) */\n  this.check = 0;             /* protected copy of check value */\n  this.total = 0;             /* protected copy of output count */\n  // TODO: may be {}\n  this.head = null;           /* where to save gzip header information */\n\n  /* sliding window */\n  this.wbits = 0;             /* log base 2 of requested window size */\n  this.wsize = 0;             /* window size or zero if not using window */\n  this.whave = 0;             /* valid bytes in the window */\n  this.wnext = 0;             /* window write index */\n  this.window = null;         /* allocated sliding window, if needed */\n\n  /* bit accumulator */\n  this.hold = 0;              /* input bit accumulator */\n  this.bits = 0;              /* number of bits in \"in\" */\n\n  /* for string and stored block copying */\n  this.length = 0;            /* literal or length of data to copy */\n  this.offset = 0;            /* distance back to copy string from */\n\n  /* for table and code decoding */\n  this.extra = 0;             /* extra bits needed */\n\n  /* fixed and dynamic code tables */\n  this.lencode = null;          /* starting table for length/literal codes */\n  this.distcode = null;         /* starting table for distance codes */\n  this.lenbits = 0;           /* index bits for lencode */\n  this.distbits = 0;          /* index bits for distcode */\n\n  /* dynamic table building */\n  this.ncode = 0;             /* number of code length code lengths */\n  this.nlen = 0;              /* number of length code lengths */\n  this.ndist = 0;             /* number of distance code lengths */\n  this.have = 0;              /* number of code lengths in lens[] */\n  this.next = null;              /* next available space in codes[] */\n\n  this.lens = new Uint16Array(320); /* temporary storage for code lengths */\n  this.work = new Uint16Array(288); /* work area for code table building */\n\n  /*\n   because we don't have pointers in js, we use lencode and distcode directly\n   as buffers so we don't need codes\n  */\n  //this.codes = new Buf32(ENOUGH);       /* space for code tables */\n  this.lendyn = null;              /* dynamic table for length/literal codes (JS specific) */\n  this.distdyn = null;             /* dynamic table for distance codes (JS specific) */\n  this.sane = 0;                   /* if false, allow invalid distance too far */\n  this.back = 0;                   /* bits back of last unprocessed length/lit */\n  this.was = 0;                    /* initial length of match */\n}\n\nfunction inflateResetKeep(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  strm.total_in = strm.total_out = state.total = 0;\n  strm.msg = ''; /*Z_NULL*/\n  if (state.wrap) {       /* to support ill-conceived Java test suite */\n    strm.adler = state.wrap & 1;\n  }\n  state.mode = HEAD;\n  state.last = 0;\n  state.havedict = 0;\n  state.dmax = 32768;\n  state.head = null/*Z_NULL*/;\n  state.hold = 0;\n  state.bits = 0;\n  //state.lencode = state.distcode = state.next = state.codes;\n  state.lencode = state.lendyn = new Int32Array(ENOUGH_LENS);\n  state.distcode = state.distdyn = new Int32Array(ENOUGH_DISTS);\n\n  state.sane = 1;\n  state.back = -1;\n  //Tracev((stderr, \"inflate: reset\\n\"));\n  return Z_OK;\n}\n\nfunction inflateReset(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  state.wsize = 0;\n  state.whave = 0;\n  state.wnext = 0;\n  return inflateResetKeep(strm);\n\n}\n\nfunction inflateReset2(strm, windowBits) {\n  var wrap;\n  var state;\n\n  /* get the state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  /* extract wrap request from windowBits parameter */\n  if (windowBits < 0) {\n    wrap = 0;\n    windowBits = -windowBits;\n  }\n  else {\n    wrap = (windowBits >> 4) + 1;\n    if (windowBits < 48) {\n      windowBits &= 15;\n    }\n  }\n\n  /* set number of window bits, free window if different */\n  if (windowBits && (windowBits < 8 || windowBits > 15)) {\n    return Z_STREAM_ERROR;\n  }\n  if (state.window !== null && state.wbits !== windowBits) {\n    state.window = null;\n  }\n\n  /* update state and reset the rest of it */\n  state.wrap = wrap;\n  state.wbits = windowBits;\n  return inflateReset(strm);\n}\n\nfunction inflateInit2(strm, windowBits) {\n  var ret;\n  var state;\n\n  if (!strm) { return Z_STREAM_ERROR; }\n  //strm.msg = Z_NULL;                 /* in case we return an error */\n\n  state = new InflateState();\n\n  //if (state === Z_NULL) return Z_MEM_ERROR;\n  //Tracev((stderr, \"inflate: allocated\\n\"));\n  strm.state = state;\n  state.window = null/*Z_NULL*/;\n  ret = inflateReset2(strm, windowBits);\n  if (ret !== Z_OK) {\n    strm.state = null/*Z_NULL*/;\n  }\n  return ret;\n}\n\n/*\n Return state with length and distance decoding tables and index sizes set to\n fixed code decoding.  Normally this returns fixed tables from inffixed.h.\n If BUILDFIXED is defined, then instead this routine builds the tables the\n first time it's called, and returns those tables the first time and\n thereafter.  This reduces the size of the code by about 2K bytes, in\n exchange for a little execution time.  However, BUILDFIXED should not be\n used for threaded applications, since the rewriting of the tables and virgin\n may not be thread-safe.\n */\nvar virgin = true;\n\nvar lenfix;\nvar distfix;\n// We have no pointers in JS, so keep tables separate\n\nfunction fixedtables(state) {\n  /* build fixed huffman tables if first call (may not be thread safe) */\n  if (virgin) {\n    var sym;\n\n    lenfix = new Int32Array(512);\n    distfix = new Int32Array(32);\n\n    /* literal/length table */\n    sym = 0;\n    while (sym < 144) { state.lens[sym++] = 8; }\n    while (sym < 256) { state.lens[sym++] = 9; }\n    while (sym < 280) { state.lens[sym++] = 7; }\n    while (sym < 288) { state.lens[sym++] = 8; }\n\n    inflate_table(LENS,  state.lens, 0, 288, lenfix,   0, state.work, { bits: 9 });\n\n    /* distance table */\n    sym = 0;\n    while (sym < 32) { state.lens[sym++] = 5; }\n\n    inflate_table(DISTS, state.lens, 0, 32,   distfix, 0, state.work, { bits: 5 });\n\n    /* do this just once */\n    virgin = false;\n  }\n\n  state.lencode = lenfix;\n  state.lenbits = 9;\n  state.distcode = distfix;\n  state.distbits = 5;\n}\n\n\n/*\n Update the window with the last wsize (normally 32K) bytes written before\n returning.  If window does not exist yet, create it.  This is only called\n when a window is already in use, or when output has been written during this\n inflate call, but the end of the deflate stream has not been reached yet.\n It is also called to create a window for dictionary data when a dictionary\n is loaded.\n\n Providing output buffers larger than 32K to inflate() should provide a speed\n advantage, since only the last 32K of output is copied to the sliding window\n upon return from inflate(), and since all distances after the first 32K of\n output will fall in the output data, making match copies simpler and faster.\n The advantage may be dependent on the size of the processor's data caches.\n */\nfunction updatewindow(strm, src, end, copy) {\n  var dist;\n  var state = strm.state;\n\n  /* if it hasn't been done already, allocate space for the window */\n  if (state.window === null) {\n    state.wsize = 1 << state.wbits;\n    state.wnext = 0;\n    state.whave = 0;\n\n    state.window = new Uint8Array(state.wsize);\n  }\n\n  /* copy state->wsize or less output bytes into the circular window */\n  if (copy >= state.wsize) {\n    arraySet(state.window, src, end - state.wsize, state.wsize, 0);\n    state.wnext = 0;\n    state.whave = state.wsize;\n  }\n  else {\n    dist = state.wsize - state.wnext;\n    if (dist > copy) {\n      dist = copy;\n    }\n    //zmemcpy(state->window + state->wnext, end - copy, dist);\n    arraySet(state.window, src, end - copy, dist, state.wnext);\n    copy -= dist;\n    if (copy) {\n      //zmemcpy(state->window, end - copy, copy);\n      arraySet(state.window, src, end - copy, copy, 0);\n      state.wnext = copy;\n      state.whave = state.wsize;\n    }\n    else {\n      state.wnext += dist;\n      if (state.wnext === state.wsize) { state.wnext = 0; }\n      if (state.whave < state.wsize) { state.whave += dist; }\n    }\n  }\n  return 0;\n}\n\nfunction inflate(strm, flush) {\n  var state;\n  var input, output;          // input/output buffers\n  var next;                   /* next input INDEX */\n  var put;                    /* next output INDEX */\n  var have, left;             /* available input and output */\n  var hold;                   /* bit buffer */\n  var bits;                   /* bits in bit buffer */\n  var _in, _out;              /* save starting available input and output */\n  var copy;                   /* number of stored or match bytes to copy */\n  var from;                   /* where to copy match bytes from */\n  var from_source;\n  var here = 0;               /* current decoding table entry */\n  var here_bits, here_op, here_val; // paked \"here\" denormalized (JS specific)\n  //var last;                   /* parent table entry */\n  var last_bits, last_op, last_val; // paked \"last\" denormalized (JS specific)\n  var len;                    /* length to copy for repeats, bits to drop */\n  var ret;                    /* return code */\n  var hbuf = new Uint8Array(4);    /* buffer for gzip header crc calculation */\n  var opts;\n\n  var n; // temporary var for NEED_BITS\n\n  var order = /* permutation of code lengths */\n    [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];\n\n\n  if (!strm || !strm.state || !strm.output ||\n      (!strm.input && strm.avail_in !== 0)) {\n    return Z_STREAM_ERROR;\n  }\n\n  state = strm.state;\n  if (state.mode === TYPE) { state.mode = TYPEDO; }    /* skip check */\n\n\n  //--- LOAD() ---\n  put = strm.next_out;\n  output = strm.output;\n  left = strm.avail_out;\n  next = strm.next_in;\n  input = strm.input;\n  have = strm.avail_in;\n  hold = state.hold;\n  bits = state.bits;\n  //---\n\n  _in = have;\n  _out = left;\n  ret = Z_OK;\n\n  inf_leave: // goto emulation\n  for (;;) {\n    switch (state.mode) {\n    case HEAD:\n      if (state.wrap === 0) {\n        state.mode = TYPEDO;\n        break;\n      }\n      //=== NEEDBITS(16);\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if ((state.wrap & 2) && hold === 0x8b1f) {  /* gzip header */\n        state.check = 0/*crc32(0L, Z_NULL, 0)*/;\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = FLAGS;\n        break;\n      }\n      state.flags = 0;           /* expect zlib header */\n      if (state.head) {\n        state.head.done = false;\n      }\n      if (!(state.wrap & 1) ||   /* check if zlib header allowed */\n        (((hold & 0xff)/*BITS(8)*/ << 8) + (hold >> 8)) % 31) {\n        strm.msg = 'incorrect header check';\n        state.mode = BAD;\n        break;\n      }\n      if ((hold & 0x0f)/*BITS(4)*/ !== Z_DEFLATED) {\n        strm.msg = 'unknown compression method';\n        state.mode = BAD;\n        break;\n      }\n      //--- DROPBITS(4) ---//\n      hold >>>= 4;\n      bits -= 4;\n      //---//\n      len = (hold & 0x0f)/*BITS(4)*/ + 8;\n      if (state.wbits === 0) {\n        state.wbits = len;\n      }\n      else if (len > state.wbits) {\n        strm.msg = 'invalid window size';\n        state.mode = BAD;\n        break;\n      }\n      state.dmax = 1 << len;\n      //Tracev((stderr, \"inflate:   zlib header ok\\n\"));\n      strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n      state.mode = hold & 0x200 ? DICTID : TYPE;\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      break;\n    case FLAGS:\n      //=== NEEDBITS(16); */\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.flags = hold;\n      if ((state.flags & 0xff) !== Z_DEFLATED) {\n        strm.msg = 'unknown compression method';\n        state.mode = BAD;\n        break;\n      }\n      if (state.flags & 0xe000) {\n        strm.msg = 'unknown header flags set';\n        state.mode = BAD;\n        break;\n      }\n      if (state.head) {\n        state.head.text = ((hold >> 8) & 1);\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = TIME;\n      /* falls through */\n    case TIME:\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if (state.head) {\n        state.head.time = hold;\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC4(state.check, hold)\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        hbuf[2] = (hold >>> 16) & 0xff;\n        hbuf[3] = (hold >>> 24) & 0xff;\n        state.check = crc32(state.check, hbuf, 4, 0);\n        //===\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = OS;\n      /* falls through */\n    case OS:\n      //=== NEEDBITS(16); */\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if (state.head) {\n        state.head.xflags = (hold & 0xff);\n        state.head.os = (hold >> 8);\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = EXLEN;\n      /* falls through */\n    case EXLEN:\n      if (state.flags & 0x0400) {\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.length = hold;\n        if (state.head) {\n          state.head.extra_len = hold;\n        }\n        if (state.flags & 0x0200) {\n          //=== CRC2(state.check, hold);\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          state.check = crc32(state.check, hbuf, 2, 0);\n          //===//\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n      }\n      else if (state.head) {\n        state.head.extra = null/*Z_NULL*/;\n      }\n      state.mode = EXTRA;\n      /* falls through */\n    case EXTRA:\n      if (state.flags & 0x0400) {\n        copy = state.length;\n        if (copy > have) { copy = have; }\n        if (copy) {\n          if (state.head) {\n            len = state.head.extra_len - state.length;\n            if (!state.head.extra) {\n              // Use untyped array for more conveniend processing later\n              state.head.extra = new Array(state.head.extra_len);\n            }\n            arraySet(\n              state.head.extra,\n              input,\n              next,\n              // extra field is limited to 65536 bytes\n              // - no need for additional size check\n              copy,\n              /*len + copy > state.head.extra_max - len ? state.head.extra_max : copy,*/\n              len\n            );\n            //zmemcpy(state.head.extra + len, next,\n            //        len + copy > state.head.extra_max ?\n            //        state.head.extra_max - len : copy);\n          }\n          if (state.flags & 0x0200) {\n            state.check = crc32(state.check, input, copy, next);\n          }\n          have -= copy;\n          next += copy;\n          state.length -= copy;\n        }\n        if (state.length) { break inf_leave; }\n      }\n      state.length = 0;\n      state.mode = NAME;\n      /* falls through */\n    case NAME:\n      if (state.flags & 0x0800) {\n        if (have === 0) { break inf_leave; }\n        copy = 0;\n        do {\n          // TODO: 2 or 1 bytes?\n          len = input[next + copy++];\n          /* use constant limit because in js we should not preallocate memory */\n          if (state.head && len &&\n              (state.length < 65536 /*state.head.name_max*/)) {\n            state.head.name += String.fromCharCode(len);\n          }\n        } while (len && copy < have);\n\n        if (state.flags & 0x0200) {\n          state.check = crc32(state.check, input, copy, next);\n        }\n        have -= copy;\n        next += copy;\n        if (len) { break inf_leave; }\n      }\n      else if (state.head) {\n        state.head.name = null;\n      }\n      state.length = 0;\n      state.mode = COMMENT;\n      /* falls through */\n    case COMMENT:\n      if (state.flags & 0x1000) {\n        if (have === 0) { break inf_leave; }\n        copy = 0;\n        do {\n          len = input[next + copy++];\n          /* use constant limit because in js we should not preallocate memory */\n          if (state.head && len &&\n              (state.length < 65536 /*state.head.comm_max*/)) {\n            state.head.comment += String.fromCharCode(len);\n          }\n        } while (len && copy < have);\n        if (state.flags & 0x0200) {\n          state.check = crc32(state.check, input, copy, next);\n        }\n        have -= copy;\n        next += copy;\n        if (len) { break inf_leave; }\n      }\n      else if (state.head) {\n        state.head.comment = null;\n      }\n      state.mode = HCRC;\n      /* falls through */\n    case HCRC:\n      if (state.flags & 0x0200) {\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (hold !== (state.check & 0xffff)) {\n          strm.msg = 'header crc mismatch';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n      }\n      if (state.head) {\n        state.head.hcrc = ((state.flags >> 9) & 1);\n        state.head.done = true;\n      }\n      strm.adler = state.check = 0;\n      state.mode = TYPE;\n      break;\n    case DICTID:\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      strm.adler = state.check = zswap32(hold);\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = DICT;\n      /* falls through */\n    case DICT:\n      if (state.havedict === 0) {\n        //--- RESTORE() ---\n        strm.next_out = put;\n        strm.avail_out = left;\n        strm.next_in = next;\n        strm.avail_in = have;\n        state.hold = hold;\n        state.bits = bits;\n        //---\n        return Z_NEED_DICT;\n      }\n      strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n      state.mode = TYPE;\n      /* falls through */\n    case TYPE:\n      if (flush === Z_BLOCK || flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case TYPEDO:\n      if (state.last) {\n        //--- BYTEBITS() ---//\n        hold >>>= bits & 7;\n        bits -= bits & 7;\n        //---//\n        state.mode = CHECK;\n        break;\n      }\n      //=== NEEDBITS(3); */\n      while (bits < 3) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.last = (hold & 0x01)/*BITS(1)*/;\n      //--- DROPBITS(1) ---//\n      hold >>>= 1;\n      bits -= 1;\n      //---//\n\n      switch ((hold & 0x03)/*BITS(2)*/) {\n      case 0:                             /* stored block */\n        //Tracev((stderr, \"inflate:     stored block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = STORED;\n        break;\n      case 1:                             /* fixed block */\n        fixedtables(state);\n        //Tracev((stderr, \"inflate:     fixed codes block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = LEN_;             /* decode codes */\n        if (flush === Z_TREES) {\n          //--- DROPBITS(2) ---//\n          hold >>>= 2;\n          bits -= 2;\n          //---//\n          break inf_leave;\n        }\n        break;\n      case 2:                             /* dynamic block */\n        //Tracev((stderr, \"inflate:     dynamic codes block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = TABLE;\n        break;\n      case 3:\n        strm.msg = 'invalid block type';\n        state.mode = BAD;\n      }\n      //--- DROPBITS(2) ---//\n      hold >>>= 2;\n      bits -= 2;\n      //---//\n      break;\n    case STORED:\n      //--- BYTEBITS() ---// /* go to byte boundary */\n      hold >>>= bits & 7;\n      bits -= bits & 7;\n      //---//\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if ((hold & 0xffff) !== ((hold >>> 16) ^ 0xffff)) {\n        strm.msg = 'invalid stored block lengths';\n        state.mode = BAD;\n        break;\n      }\n      state.length = hold & 0xffff;\n      //Tracev((stderr, \"inflate:       stored length %u\\n\",\n      //        state.length));\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = COPY_;\n      if (flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case COPY_:\n      state.mode = COPY;\n      /* falls through */\n    case COPY:\n      copy = state.length;\n      if (copy) {\n        if (copy > have) { copy = have; }\n        if (copy > left) { copy = left; }\n        if (copy === 0) { break inf_leave; }\n        //--- zmemcpy(put, next, copy); ---\n        arraySet(output, input, next, copy, put);\n        //---//\n        have -= copy;\n        next += copy;\n        left -= copy;\n        put += copy;\n        state.length -= copy;\n        break;\n      }\n      //Tracev((stderr, \"inflate:       stored end\\n\"));\n      state.mode = TYPE;\n      break;\n    case TABLE:\n      //=== NEEDBITS(14); */\n      while (bits < 14) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.nlen = (hold & 0x1f)/*BITS(5)*/ + 257;\n      //--- DROPBITS(5) ---//\n      hold >>>= 5;\n      bits -= 5;\n      //---//\n      state.ndist = (hold & 0x1f)/*BITS(5)*/ + 1;\n      //--- DROPBITS(5) ---//\n      hold >>>= 5;\n      bits -= 5;\n      //---//\n      state.ncode = (hold & 0x0f)/*BITS(4)*/ + 4;\n      //--- DROPBITS(4) ---//\n      hold >>>= 4;\n      bits -= 4;\n      //---//\n//#ifndef PKZIP_BUG_WORKAROUND\n      if (state.nlen > 286 || state.ndist > 30) {\n        strm.msg = 'too many length or distance symbols';\n        state.mode = BAD;\n        break;\n      }\n//#endif\n      //Tracev((stderr, \"inflate:       table sizes ok\\n\"));\n      state.have = 0;\n      state.mode = LENLENS;\n      /* falls through */\n    case LENLENS:\n      while (state.have < state.ncode) {\n        //=== NEEDBITS(3);\n        while (bits < 3) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.lens[order[state.have++]] = (hold & 0x07);//BITS(3);\n        //--- DROPBITS(3) ---//\n        hold >>>= 3;\n        bits -= 3;\n        //---//\n      }\n      while (state.have < 19) {\n        state.lens[order[state.have++]] = 0;\n      }\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      //state.next = state.codes;\n      //state.lencode = state.next;\n      // Switch to use dynamic table\n      state.lencode = state.lendyn;\n      state.lenbits = 7;\n\n      opts = { bits: state.lenbits };\n      ret = inflate_table(CODES, state.lens, 0, 19, state.lencode, 0, state.work, opts);\n      state.lenbits = opts.bits;\n\n      if (ret) {\n        strm.msg = 'invalid code lengths set';\n        state.mode = BAD;\n        break;\n      }\n      //Tracev((stderr, \"inflate:       code lengths ok\\n\"));\n      state.have = 0;\n      state.mode = CODELENS;\n      /* falls through */\n    case CODELENS:\n      while (state.have < state.nlen + state.ndist) {\n        for (;;) {\n          here = state.lencode[hold & ((1 << state.lenbits) - 1)];/*BITS(state.lenbits)*/\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        if (here_val < 16) {\n          //--- DROPBITS(here.bits) ---//\n          hold >>>= here_bits;\n          bits -= here_bits;\n          //---//\n          state.lens[state.have++] = here_val;\n        }\n        else {\n          if (here_val === 16) {\n            //=== NEEDBITS(here.bits + 2);\n            n = here_bits + 2;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            if (state.have === 0) {\n              strm.msg = 'invalid bit length repeat';\n              state.mode = BAD;\n              break;\n            }\n            len = state.lens[state.have - 1];\n            copy = 3 + (hold & 0x03);//BITS(2);\n            //--- DROPBITS(2) ---//\n            hold >>>= 2;\n            bits -= 2;\n            //---//\n          }\n          else if (here_val === 17) {\n            //=== NEEDBITS(here.bits + 3);\n            n = here_bits + 3;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            len = 0;\n            copy = 3 + (hold & 0x07);//BITS(3);\n            //--- DROPBITS(3) ---//\n            hold >>>= 3;\n            bits -= 3;\n            //---//\n          }\n          else {\n            //=== NEEDBITS(here.bits + 7);\n            n = here_bits + 7;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            len = 0;\n            copy = 11 + (hold & 0x7f);//BITS(7);\n            //--- DROPBITS(7) ---//\n            hold >>>= 7;\n            bits -= 7;\n            //---//\n          }\n          if (state.have + copy > state.nlen + state.ndist) {\n            strm.msg = 'invalid bit length repeat';\n            state.mode = BAD;\n            break;\n          }\n          while (copy--) {\n            state.lens[state.have++] = len;\n          }\n        }\n      }\n\n      /* handle error breaks in while */\n      if (state.mode === BAD) { break; }\n\n      /* check for end-of-block code (better have one) */\n      if (state.lens[256] === 0) {\n        strm.msg = 'invalid code -- missing end-of-block';\n        state.mode = BAD;\n        break;\n      }\n\n      /* build code tables -- note: do not change the lenbits or distbits\n         values here (9 and 6) without reading the comments in inftrees.h\n         concerning the ENOUGH constants, which depend on those values */\n      state.lenbits = 9;\n\n      opts = { bits: state.lenbits };\n      ret = inflate_table(LENS, state.lens, 0, state.nlen, state.lencode, 0, state.work, opts);\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      // state.next_index = opts.table_index;\n      state.lenbits = opts.bits;\n      // state.lencode = state.next;\n\n      if (ret) {\n        strm.msg = 'invalid literal/lengths set';\n        state.mode = BAD;\n        break;\n      }\n\n      state.distbits = 6;\n      //state.distcode.copy(state.codes);\n      // Switch to use dynamic table\n      state.distcode = state.distdyn;\n      opts = { bits: state.distbits };\n      ret = inflate_table(DISTS, state.lens, state.nlen, state.ndist, state.distcode, 0, state.work, opts);\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      // state.next_index = opts.table_index;\n      state.distbits = opts.bits;\n      // state.distcode = state.next;\n\n      if (ret) {\n        strm.msg = 'invalid distances set';\n        state.mode = BAD;\n        break;\n      }\n      //Tracev((stderr, 'inflate:       codes ok\\n'));\n      state.mode = LEN_;\n      if (flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case LEN_:\n      state.mode = LEN;\n      /* falls through */\n    case LEN:\n      if (have >= 6 && left >= 258) {\n        //--- RESTORE() ---\n        strm.next_out = put;\n        strm.avail_out = left;\n        strm.next_in = next;\n        strm.avail_in = have;\n        state.hold = hold;\n        state.bits = bits;\n        //---\n        inflate_fast(strm, _out);\n        //--- LOAD() ---\n        put = strm.next_out;\n        output = strm.output;\n        left = strm.avail_out;\n        next = strm.next_in;\n        input = strm.input;\n        have = strm.avail_in;\n        hold = state.hold;\n        bits = state.bits;\n        //---\n\n        if (state.mode === TYPE) {\n          state.back = -1;\n        }\n        break;\n      }\n      state.back = 0;\n      for (;;) {\n        here = state.lencode[hold & ((1 << state.lenbits) - 1)];  /*BITS(state.lenbits)*/\n        here_bits = here >>> 24;\n        here_op = (here >>> 16) & 0xff;\n        here_val = here & 0xffff;\n\n        if (here_bits <= bits) { break; }\n        //--- PULLBYTE() ---//\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n        //---//\n      }\n      if (here_op && (here_op & 0xf0) === 0) {\n        last_bits = here_bits;\n        last_op = here_op;\n        last_val = here_val;\n        for (;;) {\n          here = state.lencode[last_val +\n                  ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((last_bits + here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        //--- DROPBITS(last.bits) ---//\n        hold >>>= last_bits;\n        bits -= last_bits;\n        //---//\n        state.back += last_bits;\n      }\n      //--- DROPBITS(here.bits) ---//\n      hold >>>= here_bits;\n      bits -= here_bits;\n      //---//\n      state.back += here_bits;\n      state.length = here_val;\n      if (here_op === 0) {\n        //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n        //        \"inflate:         literal '%c'\\n\" :\n        //        \"inflate:         literal 0x%02x\\n\", here.val));\n        state.mode = LIT;\n        break;\n      }\n      if (here_op & 32) {\n        //Tracevv((stderr, \"inflate:         end of block\\n\"));\n        state.back = -1;\n        state.mode = TYPE;\n        break;\n      }\n      if (here_op & 64) {\n        strm.msg = 'invalid literal/length code';\n        state.mode = BAD;\n        break;\n      }\n      state.extra = here_op & 15;\n      state.mode = LENEXT;\n      /* falls through */\n    case LENEXT:\n      if (state.extra) {\n        //=== NEEDBITS(state.extra);\n        n = state.extra;\n        while (bits < n) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.length += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n        //--- DROPBITS(state.extra) ---//\n        hold >>>= state.extra;\n        bits -= state.extra;\n        //---//\n        state.back += state.extra;\n      }\n      //Tracevv((stderr, \"inflate:         length %u\\n\", state.length));\n      state.was = state.length;\n      state.mode = DIST;\n      /* falls through */\n    case DIST:\n      for (;;) {\n        here = state.distcode[hold & ((1 << state.distbits) - 1)];/*BITS(state.distbits)*/\n        here_bits = here >>> 24;\n        here_op = (here >>> 16) & 0xff;\n        here_val = here & 0xffff;\n\n        if ((here_bits) <= bits) { break; }\n        //--- PULLBYTE() ---//\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n        //---//\n      }\n      if ((here_op & 0xf0) === 0) {\n        last_bits = here_bits;\n        last_op = here_op;\n        last_val = here_val;\n        for (;;) {\n          here = state.distcode[last_val +\n                  ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((last_bits + here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        //--- DROPBITS(last.bits) ---//\n        hold >>>= last_bits;\n        bits -= last_bits;\n        //---//\n        state.back += last_bits;\n      }\n      //--- DROPBITS(here.bits) ---//\n      hold >>>= here_bits;\n      bits -= here_bits;\n      //---//\n      state.back += here_bits;\n      if (here_op & 64) {\n        strm.msg = 'invalid distance code';\n        state.mode = BAD;\n        break;\n      }\n      state.offset = here_val;\n      state.extra = (here_op) & 15;\n      state.mode = DISTEXT;\n      /* falls through */\n    case DISTEXT:\n      if (state.extra) {\n        //=== NEEDBITS(state.extra);\n        n = state.extra;\n        while (bits < n) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.offset += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n        //--- DROPBITS(state.extra) ---//\n        hold >>>= state.extra;\n        bits -= state.extra;\n        //---//\n        state.back += state.extra;\n      }\n//#ifdef INFLATE_STRICT\n      if (state.offset > state.dmax) {\n        strm.msg = 'invalid distance too far back';\n        state.mode = BAD;\n        break;\n      }\n//#endif\n      //Tracevv((stderr, \"inflate:         distance %u\\n\", state.offset));\n      state.mode = MATCH;\n      /* falls through */\n    case MATCH:\n      if (left === 0) { break inf_leave; }\n      copy = _out - left;\n      if (state.offset > copy) {         /* copy from window */\n        copy = state.offset - copy;\n        if (copy > state.whave) {\n          if (state.sane) {\n            strm.msg = 'invalid distance too far back';\n            state.mode = BAD;\n            break;\n          }\n// (!) This block is disabled in zlib defailts,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//          Trace((stderr, \"inflate.c too far\\n\"));\n//          copy -= state.whave;\n//          if (copy > state.length) { copy = state.length; }\n//          if (copy > left) { copy = left; }\n//          left -= copy;\n//          state.length -= copy;\n//          do {\n//            output[put++] = 0;\n//          } while (--copy);\n//          if (state.length === 0) { state.mode = LEN; }\n//          break;\n//#endif\n        }\n        if (copy > state.wnext) {\n          copy -= state.wnext;\n          from = state.wsize - copy;\n        }\n        else {\n          from = state.wnext - copy;\n        }\n        if (copy > state.length) { copy = state.length; }\n        from_source = state.window;\n      }\n      else {                              /* copy from output */\n        from_source = output;\n        from = put - state.offset;\n        copy = state.length;\n      }\n      if (copy > left) { copy = left; }\n      left -= copy;\n      state.length -= copy;\n      do {\n        output[put++] = from_source[from++];\n      } while (--copy);\n      if (state.length === 0) { state.mode = LEN; }\n      break;\n    case LIT:\n      if (left === 0) { break inf_leave; }\n      output[put++] = state.length;\n      left--;\n      state.mode = LEN;\n      break;\n    case CHECK:\n      if (state.wrap) {\n        //=== NEEDBITS(32);\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          // Use '|' insdead of '+' to make sure that result is signed\n          hold |= input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        _out -= left;\n        strm.total_out += _out;\n        state.total += _out;\n        if (_out) {\n          strm.adler = state.check =\n              /*UPDATE(state.check, put - _out, _out);*/\n              (state.flags ? crc32(state.check, output, _out, put - _out) : adler32(state.check, output, _out, put - _out));\n\n        }\n        _out = left;\n        // NB: crc32 stored as signed 32-bit int, zswap32 returns signed too\n        if ((state.flags ? hold : zswap32(hold)) !== state.check) {\n          strm.msg = 'incorrect data check';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        //Tracev((stderr, \"inflate:   check matches trailer\\n\"));\n      }\n      state.mode = LENGTH;\n      /* falls through */\n    case LENGTH:\n      if (state.wrap && state.flags) {\n        //=== NEEDBITS(32);\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (hold !== (state.total & 0xffffffff)) {\n          strm.msg = 'incorrect length check';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        //Tracev((stderr, \"inflate:   length matches trailer\\n\"));\n      }\n      state.mode = DONE;\n      /* falls through */\n    case DONE:\n      ret = Z_STREAM_END;\n      break inf_leave;\n    case BAD:\n      ret = Z_DATA_ERROR;\n      break inf_leave;\n    case MEM:\n      return Z_MEM_ERROR;\n    case SYNC:\n      /* falls through */\n    default:\n      return Z_STREAM_ERROR;\n    }\n  }\n\n  // inf_leave <- here is real place for \"goto inf_leave\", emulated via \"break inf_leave\"\n\n  /*\n     Return from inflate(), updating the total counts and the check value.\n     If there was no progress during the inflate() call, return a buffer\n     error.  Call updatewindow() to create and/or update the window state.\n     Note: a memory error from inflate() is non-recoverable.\n   */\n\n  //--- RESTORE() ---\n  strm.next_out = put;\n  strm.avail_out = left;\n  strm.next_in = next;\n  strm.avail_in = have;\n  state.hold = hold;\n  state.bits = bits;\n  //---\n\n  if (state.wsize || (_out !== strm.avail_out && state.mode < BAD &&\n                      (state.mode < CHECK || flush !== Z_FINISH))) {\n    if (updatewindow(strm, strm.output, strm.next_out, _out - strm.avail_out)) {\n      state.mode = MEM;\n      return Z_MEM_ERROR;\n    }\n  }\n  _in -= strm.avail_in;\n  _out -= strm.avail_out;\n  strm.total_in += _in;\n  strm.total_out += _out;\n  state.total += _out;\n  if (state.wrap && _out) {\n    strm.adler = state.check = /*UPDATE(state.check, strm.next_out - _out, _out);*/\n      (state.flags ? crc32(state.check, output, _out, strm.next_out - _out) : adler32(state.check, output, _out, strm.next_out - _out));\n  }\n  strm.data_type = state.bits + (state.last ? 64 : 0) +\n                    (state.mode === TYPE ? 128 : 0) +\n                    (state.mode === LEN_ || state.mode === COPY_ ? 256 : 0);\n  if (((_in === 0 && _out === 0) || flush === Z_FINISH) && ret === Z_OK) {\n    ret = Z_BUF_ERROR;\n  }\n  return ret;\n}\n\nfunction inflateEnd(strm) {\n\n  if (!strm || !strm.state /*|| strm->zfree == (free_func)0*/) {\n    return Z_STREAM_ERROR;\n  }\n\n  var state = strm.state;\n  if (state.window) {\n    state.window = null;\n  }\n  strm.state = null;\n  return Z_OK;\n}\n\nfunction inflateGetHeader(strm, head) {\n  var state;\n\n  /* check state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  if ((state.wrap & 2) === 0) { return Z_STREAM_ERROR; }\n\n  /* save header structure */\n  state.head = head;\n  head.done = false;\n  return Z_OK;\n}\n\nfunction inflateSetDictionary(strm, dictionary) {\n  var dictLength = dictionary.length;\n\n  var state;\n  var dictid;\n  var ret;\n\n  /* check state */\n  if (!strm /* == Z_NULL */ || !strm.state /* == Z_NULL */) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  if (state.wrap !== 0 && state.mode !== DICT) {\n    return Z_STREAM_ERROR;\n  }\n\n  /* check for correct dictionary identifier */\n  if (state.mode === DICT) {\n    dictid = 1; /* adler32(0, null, 0)*/\n    /* dictid = adler32(dictid, dictionary, dictLength); */\n    dictid = adler32(dictid, dictionary, dictLength, 0);\n    if (dictid !== state.check) {\n      return Z_DATA_ERROR;\n    }\n  }\n  /* copy dictionary to window using updatewindow(), which will amend the\n   existing dictionary if appropriate */\n  ret = updatewindow(strm, dictionary, dictLength, dictLength);\n  if (ret) {\n    state.mode = MEM;\n    return Z_MEM_ERROR;\n  }\n  state.havedict = 1;\n  // Tracev((stderr, \"inflate:   dictionary set\\n\"));\n  return Z_OK;\n}\n\n// String encode/decode helpers\n// 'use strict';\n\n\n// var utils = require('./common');\n\n\n// Quick check if we can use fast array to bin string conversion\n//\n// - apply(Array) can fail on Android 2.2\n// - apply(Uint8Array) can fail on iOS 5.1 Safary\n//\nvar STR_APPLY_OK = true;\nvar STR_APPLY_UIA_OK = true;\n\ntry { String.fromCharCode.apply(null, [ 0 ]); } catch (__) { STR_APPLY_OK = false; }\ntry { String.fromCharCode.apply(null, new Uint8Array(1)); } catch (__) { STR_APPLY_UIA_OK = false; }\n\n\n// Table with utf8 lengths (calculated by first byte of sequence)\n// Note, that 5 & 6-byte values and some 4-byte values can not be represented in JS,\n// because max possible codepoint is 0x10ffff\nvar _utf8len = new Uint8Array(256);\nfor (var q = 0; q < 256; q++) {\n  _utf8len[q] = (q >= 252 ? 6 : q >= 248 ? 5 : q >= 240 ? 4 : q >= 224 ? 3 : q >= 192 ? 2 : 1);\n}\n_utf8len[254] = _utf8len[254] = 1; // Invalid sequence start\n\n\n// convert string to array (typed, when possible)\nfunction string2buf(str) {\n  var buf, c, c2, m_pos, i, str_len = str.length, buf_len = 0;\n\n  // count binary size\n  for (m_pos = 0; m_pos < str_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    buf_len += c < 0x80 ? 1 : c < 0x800 ? 2 : c < 0x10000 ? 3 : 4;\n  }\n\n  // allocate buffer\n  buf = new Uint8Array(buf_len);\n\n  // convert\n  for (i = 0, m_pos = 0; i < buf_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    if (c < 0x80) {\n      /* one byte */\n      buf[i++] = c;\n    } else if (c < 0x800) {\n      /* two bytes */\n      buf[i++] = 0xC0 | (c >>> 6);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else if (c < 0x10000) {\n      /* three bytes */\n      buf[i++] = 0xE0 | (c >>> 12);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else {\n      /* four bytes */\n      buf[i++] = 0xf0 | (c >>> 18);\n      buf[i++] = 0x80 | (c >>> 12 & 0x3f);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    }\n  }\n\n  return buf;\n}\n\n// Helper (used in 2 places)\nfunction _buf2binstring(buf, len) {\n  // use fallback for big arrays to avoid stack overflow\n  if (len < 65537) {\n    if ((buf.subarray && STR_APPLY_UIA_OK) || (!buf.subarray && STR_APPLY_OK)) {\n      return String.fromCharCode.apply(null, shrinkBuf(buf, len));\n    }\n  }\n\n  var result = '';\n  for (var i = 0; i < len; i++) {\n    result += String.fromCharCode(buf[i]);\n  }\n  return result;\n}\n\n\n// Convert binary string (typed, when possible)\nfunction binstring2buf(str) {\n  var buf = new Uint8Array(str.length);\n  for (var i = 0, len = buf.length; i < len; i++) {\n    buf[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n\n\n// convert array to string\nfunction buf2string(buf, max) {\n  var i, out, c, c_len;\n  var len = max || buf.length;\n\n  // Reserve max possible length (2 words per char)\n  // NB: by unknown reasons, Array is significantly faster for\n  //     String.fromCharCode.apply than Uint16Array.\n  var utf16buf = new Array(len * 2);\n\n  for (out = 0, i = 0; i < len;) {\n    c = buf[i++];\n    // quick process ascii\n    if (c < 0x80) { utf16buf[out++] = c; continue; }\n\n    c_len = _utf8len[c];\n    // skip 5 & 6 byte codes\n    if (c_len > 4) { utf16buf[out++] = 0xfffd; i += c_len - 1; continue; }\n\n    // apply mask on first byte\n    c &= c_len === 2 ? 0x1f : c_len === 3 ? 0x0f : 0x07;\n    // join the rest\n    while (c_len > 1 && i < len) {\n      c = (c << 6) | (buf[i++] & 0x3f);\n      c_len--;\n    }\n\n    // terminated by end of string?\n    if (c_len > 1) { utf16buf[out++] = 0xfffd; continue; }\n\n    if (c < 0x10000) {\n      utf16buf[out++] = c;\n    } else {\n      c -= 0x10000;\n      utf16buf[out++] = 0xd800 | ((c >> 10) & 0x3ff);\n      utf16buf[out++] = 0xdc00 | (c & 0x3ff);\n    }\n  }\n\n  return _buf2binstring(utf16buf, out);\n}\n\n\n// Calculate max possible position in utf8 buffer,\n// that will not break sequence. If that's not possible\n// - (very small limits) return max size as is.\n//\n// buf[] - utf8 bytes array\n// max   - length limit (mandatory);\nfunction utf8border(buf, max) {\n  var pos;\n\n  max = max || buf.length;\n  if (max > buf.length) { max = buf.length; }\n\n  // go back from last position, until start of sequence found\n  pos = max - 1;\n  while (pos >= 0 && (buf[pos] & 0xC0) === 0x80) { pos--; }\n\n  // Fuckup - very small and broken sequence,\n  // return max, because we should return something anyway.\n  if (pos < 0) { return max; }\n\n  // If we came to start of buffer - that means vuffer is too small,\n  // return max too.\n  if (pos === 0) { return max; }\n\n  return (pos + _utf8len[buf[pos]] > max) ? pos : max;\n}\n\n/* Allowed flush values; see deflate() and inflate() below for details */\nvar Z_NO_FLUSH        = 0;\nvar Z_SYNC_FLUSH      = 2;\nvar Z_FINISH$1          = 4;\n/* Return codes for the compression/decompression functions. Negative values\n  * are errors, positive values are used for special but normal events.\n  */\nvar Z_OK$1              =  0;\nvar Z_STREAM_END$1      =  1;\nvar Z_NEED_DICT$1       =  2;\n//export var Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR$1       = -5;\n\n// 'use strict';\n\nvar messages = {\n  2:      'need dictionary',     /* Z_NEED_DICT       2  */\n  1:      'stream end',          /* Z_STREAM_END      1  */\n  0:      '',                    /* Z_OK              0  */\n  '-1':   'file error',          /* Z_ERRNO         (-1) */\n  '-2':   'stream error',        /* Z_STREAM_ERROR  (-2) */\n  '-3':   'data error',          /* Z_DATA_ERROR    (-3) */\n  '-4':   'insufficient memory', /* Z_MEM_ERROR     (-4) */\n  '-5':   'buffer error',        /* Z_BUF_ERROR     (-5) */\n  '-6':   'incompatible version' /* Z_VERSION_ERROR (-6) */\n};\n\n// 'use strict';\n\n\nfunction ZStream() {\n  /* next input byte */\n  this.input = null; // JS specific, because we have no pointers\n  this.next_in = 0;\n  /* number of bytes available at input */\n  this.avail_in = 0;\n  /* total number of input bytes read so far */\n  this.total_in = 0;\n  /* next output byte should be put there */\n  this.output = null; // JS specific, because we have no pointers\n  this.next_out = 0;\n  /* remaining free space at output */\n  this.avail_out = 0;\n  /* total number of bytes output so far */\n  this.total_out = 0;\n  /* last error message, NULL if no error */\n  this.msg = ''/*Z_NULL*/;\n  /* not visible by applications */\n  this.state = null;\n  /* best guess about the data type: binary or text */\n  this.data_type = 2/*Z_UNKNOWN*/;\n  /* adler32 value of the uncompressed data */\n  this.adler = 0;\n}\n\n// 'use strict';\n\n\nfunction GZheader() {\n  /* true if compressed data believed to be text */\n  this.text       = 0;\n  /* modification time */\n  this.time       = 0;\n  /* extra flags (not used when writing a gzip file) */\n  this.xflags     = 0;\n  /* operating system */\n  this.os         = 0;\n  /* pointer to extra field or Z_NULL if none */\n  this.extra      = null;\n  /* extra field length (valid if extra != Z_NULL) */\n  this.extra_len  = 0; // Actually, we don't need it in JS,\n                       // but leave for few code modifications\n\n  //\n  // Setup limits is not necessary because in js we should not preallocate memory\n  // for inflate use constant limit in 65536 bytes\n  //\n\n  /* space at extra (only when reading header) */\n  // this.extra_max  = 0;\n  /* pointer to zero-terminated file name or Z_NULL */\n  this.name       = '';\n  /* space at name (only when reading header) */\n  // this.name_max   = 0;\n  /* pointer to zero-terminated comment or Z_NULL */\n  this.comment    = '';\n  /* space at comment (only when reading header) */\n  // this.comm_max   = 0;\n  /* true if there was or will be a header crc */\n  this.hcrc       = 0;\n  /* true when done reading gzip header (not used when writing a gzip file) */\n  this.done       = false;\n}\n\n// 'use strict';\n\n\n// var zlib_inflate = require('./zlib/inflate');\n// var utils        = require('./utils/common');\n// var strings      = require('./utils/strings');\n// var c            = require('./zlib/constants');\n// var msg          = require('./zlib/messages');\n// var ZStream      = require('./zlib/zstream');\n// var GZheader     = require('./zlib/gzheader');\n\nvar toString = Object.prototype.toString;\n\n/**\n * class Inflate\n *\n * Generic JS-style wrapper for zlib calls. If you don't need\n * streaming behaviour - use more simple functions: [[inflate]]\n * and [[inflateRaw]].\n **/\n\n/* internal\n * inflate.chunks -> Array\n *\n * Chunks of output data, if [[Inflate#onData]] not overriden.\n **/\n\n/**\n * Inflate.result -> Uint8Array|Array|String\n *\n * Uncompressed result, generated by default [[Inflate#onData]]\n * and [[Inflate#onEnd]] handlers. Filled after you push last chunk\n * (call [[Inflate#push]] with `Z_FINISH` / `true` param) or if you\n * push a chunk with explicit flush (call [[Inflate#push]] with\n * `Z_SYNC_FLUSH` param).\n **/\n\n/**\n * Inflate.err -> Number\n *\n * Error code after inflate finished. 0 (Z_OK) on success.\n * Should be checked if broken data possible.\n **/\n\n/**\n * Inflate.msg -> String\n *\n * Error message, if [[Inflate.err]] != 0\n **/\n\n\n/**\n * new Inflate(options)\n * - options (Object): zlib inflate options.\n *\n * Creates new inflator instance with specified params. Throws exception\n * on bad params. Supported options:\n *\n * - `windowBits`\n * - `dictionary`\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information on these.\n *\n * Additional options, for internal needs:\n *\n * - `chunkSize` - size of generated data chunks (16K by default)\n * - `raw` (Boolean) - do raw inflate\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n * By default, when no options set, autodetect deflate/gzip data format via\n * wrapper header.\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])\n *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);\n *\n * var inflate = new pako.Inflate({ level: 3});\n *\n * inflate.push(chunk1, false);\n * inflate.push(chunk2, true);  // true -> last chunk\n *\n * if (inflate.err) { throw new Error(inflate.err); }\n *\n * console.log(inflate.result);\n * ```\n **/\nfunction Inflate(options) {\n  if (!(this instanceof Inflate)) return new Inflate(options);\n\n  this.options = assign({\n    chunkSize: 16384,\n    windowBits: 0,\n    to: ''\n  }, options || {});\n\n  var opt = this.options;\n\n  // Force window size for `raw` data, if not set directly,\n  // because we have no header for autodetect.\n  if (opt.raw && (opt.windowBits >= 0) && (opt.windowBits < 16)) {\n    opt.windowBits = -opt.windowBits;\n    if (opt.windowBits === 0) { opt.windowBits = -15; }\n  }\n\n  // If `windowBits` not defined (and mode not raw) - set autodetect flag for gzip/deflate\n  if ((opt.windowBits >= 0) && (opt.windowBits < 16) &&\n      !(options && options.windowBits)) {\n    opt.windowBits += 32;\n  }\n\n  // Gzip header has no info about windows size, we can do autodetect only\n  // for deflate. So, if window size not set, force it to max when gzip possible\n  if ((opt.windowBits > 15) && (opt.windowBits < 48)) {\n    // bit 3 (16) -> gzipped data\n    // bit 4 (32) -> autodetect gzip/deflate\n    if ((opt.windowBits & 15) === 0) {\n      opt.windowBits |= 15;\n    }\n  }\n\n  this.err    = 0;      // error code, if happens (0 = Z_OK)\n  this.msg    = '';     // error message\n  this.ended  = false;  // used to avoid multiple onEnd() calls\n  this.chunks = [];     // chunks of compressed data\n\n  this.strm   = new ZStream();\n  this.strm.avail_out = 0;\n\n  var status  = inflateInit2(\n    this.strm,\n    opt.windowBits\n  );\n\n  if (status !== Z_OK$1) {\n    throw new Error(messages[status]);\n  }\n\n  this.header = new GZheader();\n\n  inflateGetHeader(this.strm, this.header);\n}\n\n/**\n * Inflate#push(data[, mode]) -> Boolean\n * - data (Uint8Array|Array|ArrayBuffer|String): input data\n * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.\n *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` meansh Z_FINISH.\n *\n * Sends input data to inflate pipe, generating [[Inflate#onData]] calls with\n * new output chunks. Returns `true` on success. The last data block must have\n * mode Z_FINISH (or `true`). That will flush internal pending buffers and call\n * [[Inflate#onEnd]]. For interim explicit flushes (without ending the stream) you\n * can use mode Z_SYNC_FLUSH, keeping the decompression context.\n *\n * On fail call [[Inflate#onEnd]] with error code and return false.\n *\n * We strongly recommend to use `Uint8Array` on input for best speed (output\n * format is detected automatically). Also, don't skip last param and always\n * use the same type in your code (boolean or number). That will improve JS speed.\n *\n * For regular `Array`-s make sure all elements are [0..255].\n *\n * ##### Example\n *\n * ```javascript\n * push(chunk, false); // push one of data chunks\n * ...\n * push(chunk, true);  // push last chunk\n * ```\n **/\nInflate.prototype.push = function (data, mode) {\n  var strm = this.strm;\n  var chunkSize = this.options.chunkSize;\n  var dictionary = this.options.dictionary;\n  var status, _mode;\n  var next_out_utf8, tail, utf8str;\n  var dict;\n\n  // Flag to properly process Z_BUF_ERROR on testing inflate call\n  // when we check that all output data was flushed.\n  var allowBufError = false;\n\n  if (this.ended) { return false; }\n  _mode = (mode === ~~mode) ? mode : ((mode === true) ? Z_FINISH$1 : Z_NO_FLUSH);\n\n  // Convert data if needed\n  if (typeof data === 'string') {\n    // Only binary strings can be decompressed on practice\n    strm.input = binstring2buf(data);\n  } else if (toString.call(data) === '[object ArrayBuffer]') {\n    strm.input = new Uint8Array(data);\n  } else {\n    strm.input = data;\n  }\n\n  strm.next_in = 0;\n  strm.avail_in = strm.input.length;\n\n  do {\n    if (strm.avail_out === 0) {\n      strm.output = new Uint8Array(chunkSize);\n      strm.next_out = 0;\n      strm.avail_out = chunkSize;\n    }\n\n    status = inflate(strm, Z_NO_FLUSH);    /* no bad return value */\n\n    if (status === Z_NEED_DICT$1 && dictionary) {\n      // Convert data if needed\n      if (typeof dictionary === 'string') {\n        dict = string2buf(dictionary);\n      } else if (toString.call(dictionary) === '[object ArrayBuffer]') {\n        dict = new Uint8Array(dictionary);\n      } else {\n        dict = dictionary;\n      }\n\n      status = inflateSetDictionary(this.strm, dict);\n\n    }\n\n    if (status === Z_BUF_ERROR$1 && allowBufError === true) {\n      status = Z_OK$1;\n      allowBufError = false;\n    }\n\n    if (status !== Z_STREAM_END$1 && status !== Z_OK$1) {\n      this.onEnd(status);\n      this.ended = true;\n      return false;\n    }\n\n    if (strm.next_out) {\n      if (strm.avail_out === 0 || status === Z_STREAM_END$1 || (strm.avail_in === 0 && (_mode === Z_FINISH$1 || _mode === Z_SYNC_FLUSH))) {\n\n        if (this.options.to === 'string') {\n\n          next_out_utf8 = utf8border(strm.output, strm.next_out);\n\n          tail = strm.next_out - next_out_utf8;\n          utf8str = buf2string(strm.output, next_out_utf8);\n\n          // move tail\n          strm.next_out = tail;\n          strm.avail_out = chunkSize - tail;\n          if (tail) { arraySet(strm.output, strm.output, next_out_utf8, tail, 0); }\n\n          this.onData(utf8str);\n\n        } else {\n          this.onData(shrinkBuf(strm.output, strm.next_out));\n        }\n      }\n    }\n\n    // When no more input data, we should check that internal inflate buffers\n    // are flushed. The only way to do it when avail_out = 0 - run one more\n    // inflate pass. But if output data not exists, inflate return Z_BUF_ERROR.\n    // Here we set flag to process this error properly.\n    //\n    // NOTE. Deflate does not return error in this case and does not needs such\n    // logic.\n    if (strm.avail_in === 0 && strm.avail_out === 0) {\n      allowBufError = true;\n    }\n\n  } while ((strm.avail_in > 0 || strm.avail_out === 0) && status !== Z_STREAM_END$1);\n\n  if (status === Z_STREAM_END$1) {\n    _mode = Z_FINISH$1;\n  }\n\n  // Finalize on the last chunk.\n  if (_mode === Z_FINISH$1) {\n    status = inflateEnd(this.strm);\n    this.onEnd(status);\n    this.ended = true;\n    return status === Z_OK$1;\n  }\n\n  // callback interim results if Z_SYNC_FLUSH.\n  if (_mode === Z_SYNC_FLUSH) {\n    this.onEnd(Z_OK$1);\n    strm.avail_out = 0;\n    return true;\n  }\n\n  return true;\n};\n\n\n/**\n * Inflate#onData(chunk) -> Void\n * - chunk (Uint8Array|Array|String): ouput data. Type of array depends\n *   on js engine support. When string output requested, each chunk\n *   will be string.\n *\n * By default, stores data blocks in `chunks[]` property and glue\n * those in `onEnd`. Override this handler, if you need another behaviour.\n **/\nInflate.prototype.onData = function (chunk) {\n  this.chunks.push(chunk);\n};\n\n\n/**\n * Inflate#onEnd(status) -> Void\n * - status (Number): inflate status. 0 (Z_OK) on success,\n *   other if not.\n *\n * Called either after you tell inflate that the input stream is\n * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)\n * or if an error happened. By default - join collected chunks,\n * free memory and fill `results` / `err` properties.\n **/\nInflate.prototype.onEnd = function (status) {\n  // On success - join\n  if (status === Z_OK$1) {\n    if (this.options.to === 'string') {\n      // Glue & convert here, until we teach pako to send\n      // utf8 alligned strings to onData\n      this.result = this.chunks.join('');\n    } else {\n      this.result = flattenChunks(this.chunks);\n    }\n  }\n  this.chunks = [];\n  this.err = status;\n  this.msg = this.strm.msg;\n};\n\n\n/**\n * inflate(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to decompress.\n * - options (Object): zlib inflate options.\n *\n * Decompress `data` with inflate/ungzip and `options`. Autodetect\n * format via wrapper header by default. That's why we don't provide\n * separate `ungzip` method.\n *\n * Supported options are:\n *\n * - windowBits\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information.\n *\n * Sugar (options):\n *\n * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify\n *   negative windowBits implicitly.\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , input = pako.deflate([1,2,3,4,5,6,7,8,9])\n *   , output;\n *\n * try {\n *   output = pako.inflate(input);\n * } catch (err)\n *   console.log(err);\n * }\n * ```\n **/\nfunction doInflate(input, options) {\n  var inflator = new Inflate(options);\n\n  inflator.push(input, true);\n\n  // That will never happens, if you don't cheat with options :)\n  if (inflator.err) { throw inflator.msg; }\n\n  return inflator.result;\n}\n\nexport { doInflate as ungzip };","/**\n * @file Validation Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport XmlParser, { XmlParserParameters } from './xml-parser'\nimport Validation from '../structure/validation'\nimport Streamer from '../streamer/streamer';\n\nclass ValidationParser extends XmlParser {\n  constructor (streamer: Streamer, params?: Partial<XmlParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.useDomParser = true\n    this.validation = new Validation(this.name, this.path)\n  }\n\n  get __objName () { return 'validation' }\n  get isXml () { return true }\n\n  _parse () {\n    super._parse()\n\n    if (Debug) Log.time('ValidationParser._parse ' + this.name)\n\n    this.validation.fromXml(this.xml.data)\n\n    if (Debug) Log.timeEnd('ValidationParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('validation', ValidationParser)\n\nexport default ValidationParser\n","/**\n * @file Gzip Decompressor\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ungzip } from '../../lib/pako_inflate.es6'\n\nimport { DecompressorRegistry } from '../globals'\n\nfunction gzipDecompress (data: ArrayBuffer|Uint8Array) {\n  let decompressedData\n\n  if (data instanceof ArrayBuffer) {\n    data = new Uint8Array(data)\n  }\n\n  try {\n    decompressedData = ungzip(data as Uint8Array)\n  } catch (e) {\n    decompressedData = data  // assume it is already uncompressed\n  }\n\n  return decompressedData\n}\n\nDecompressorRegistry.add('gz', gzipDecompress)\n","/**\n * @file Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n/**\n * Datasource base class\n * @interface\n */\nabstract class Datasource {\n  /**\n   * Get full url\n   * @abstract\n   * @param  {String} path - datasource string\n   * @return {String} - url\n   */\n  abstract getUrl (path: string): string\n\n  /**\n   * Get file extension\n   * @abstract\n   * @param  {String} path - datasource string\n   * @return {String} - extension\n   */\n  abstract getExt (path: string): string\n}\n\nexport default Datasource\n","/**\n * @file RCSB Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, DatasourceRegistry } from '../globals'\nimport { getProtocol } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst baseUrl = '//files.rcsb.org/download/'\nconst mmtfBaseUrl = '//mmtf.rcsb.org/v1.0/'\nconst mmtfFullUrl = mmtfBaseUrl + 'full/'\nconst mmtfReducedUrl = mmtfBaseUrl + 'reduced/'\nconst bcifBaseUrl = '//models.rcsb.org/'\n\nclass RcsbDatasource extends Datasource {\n  getUrl (src: string) {\n    // valid path are\n    // XXXX.pdb, XXXX.pdb.gz, XXXX.cif, XXXX.cif.gz, XXXX.mmtf, XXXX.bb.mmtf\n    // XXXX defaults to XXXX.cif\n    const info = getFileInfo(src)\n    const pdbid = info.name.indexOf('_') > -1 ? info.name : info.name.substring(0, 4) // Allow extended pdb codes and alphafold codes\n    let url\n    if ([ 'pdb', 'cif' ].includes(info.ext) &&\n        (info.compressed === false || info.compressed === 'gz')\n    ) {\n      url = baseUrl + info.path\n    } else if (info.ext === 'mmtf') {\n      Log.warn('MMTF files distribution is discontinued by RCSB PDB as of July 2, 2024.\\n Consider using bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice')\n      if (info.base.endsWith('.bb')) {\n        url = mmtfReducedUrl + pdbid\n      } else {\n        url = mmtfFullUrl + pdbid\n      }\n    } else if (info.ext === 'bcif' &&\n        (info.compressed === false || info.compressed === 'gz')\n    ) {\n      url = bcifBaseUrl + info.path\n    } else if (!info.ext) {\n      Log.warn('mmCif files available from RCSB PDB lack connectivity information.\\n Consider using PDBe as the data provider for using \"Updated mmCif files\" that contain residues connectivity records.')\n      url = bcifBaseUrl + pdbid + '.bcif.gz'\n    } else {\n      Log.warn('unsupported ext', info.ext)\n      url = bcifBaseUrl + pdbid + '.bcif.gz'\n    }\n    return getProtocol() + url\n  }\n\n  getExt (src: string) {\n    const ext = getFileInfo(src).ext\n    return ext ? ext : 'mmtf'\n  }\n}\n\nDatasourceRegistry.add('rcsb', new RcsbDatasource())\n\nexport default RcsbDatasource\n","/**\n * @file PDB Europe Datasource\n * @author Paul Pillot <paul.pillot@tandemai.com>\n * @private\n */\n\nimport { Log, DatasourceRegistry } from '../globals'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst baseUrl = '//www.ebi.ac.uk/pdbe/entry-files/download/'\n\n// Examples:\n//https://www.ebi.ac.uk/pdbe/entry-files/download/5z6y_updated.cif\n//https://www.ebi.ac.uk/pdbe/entry-files/download/pdb5z6y.ent\n//https://www.ebi.ac.uk/pdbe/entry-files/download/5z6y.bcif\n\nclass PDBeDatasource extends Datasource {\n  getUrl (src: string) {\n    // valid path are\n    // XXXX.pdb, XXXX.ent, XXXX.cif, XXXX.bcif\n    // XXXX defaults to XXXX.bcif\n    const info = getFileInfo(src)\n    let pdbid = info.name.indexOf('_') > -1 ? info.name : info.name.substring(0, 4) // Allow extended pdb codes\n    let url\n    switch (info.ext) {\n        case 'cif':\n            url = baseUrl + pdbid + '_updated.cif'  // \"Updated mmcif\" files contain connectivity\n            break\n        case 'pdb':\n        case 'ent':\n            if (!pdbid.startsWith('pdb')) {\n                pdbid = 'pdb' + pdbid\n            }\n            url = baseUrl + pdbid + '.ent'\n            break\n        case 'bcif':\n            url = baseUrl + info.path\n            break\n        case '':\n            url = baseUrl + pdbid + '.bcif'\n            break\n        default:\n            Log.warn('unsupported ext', info.ext)\n            url = baseUrl + pdbid + '.bcif'\n    }\n    return 'https://' + url\n  }\n\n  getExt (src: string) {\n    const ext = getFileInfo(src).ext\n    return ext ? ext : 'mmtf'\n  }\n}\n\nDatasourceRegistry.add('pdbe', new PDBeDatasource())\n\nexport default PDBeDatasource\n","/**\n * @file PubChem Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, DatasourceRegistry } from '../globals'\nimport { getProtocol } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst baseUrl = '//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/'\nconst suffixUrl = '/SDF?record_type=3d'\n\nclass PubchemDatasource extends Datasource {\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    const cid = info.name\n    let url\n    if (!info.ext || info.ext === 'sdf') {\n      url = baseUrl + cid + suffixUrl\n    } else {\n      Log.warn('unsupported ext', info.ext)\n      url = baseUrl + cid + suffixUrl\n    }\n    return getProtocol() + url\n  }\n\n  getExt (src: string) {\n    const ext = getFileInfo(src).ext\n    return ext ? ext : 'sdf'\n  }\n}\n\nDatasourceRegistry.add('pubchem', new PubchemDatasource())\n\nexport default PubchemDatasource\n","/**\n * @file Pass Through Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { DatasourceRegistry } from '../globals'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nclass PassThroughDatasource extends Datasource {\n  getUrl (path: string) {\n    return path\n  }\n\n  getExt (path: string) {\n    return getFileInfo(path).ext\n  }\n}\n\nDatasourceRegistry.add('ftp', new PassThroughDatasource())\nDatasourceRegistry.add('http', new PassThroughDatasource())\nDatasourceRegistry.add('https', new PassThroughDatasource())\n\nexport default PassThroughDatasource\n","/**\r\n * @file Alphafold Datasource\r\n * @author Fredric Johansson <fredric@fredricj.se>\r\n * @private\r\n */\r\n\r\nimport { Log, DatasourceRegistry } from '../globals'\r\nimport { getFileInfo } from '../loader/loader-utils'\r\nimport Datasource from './datasource'\r\n\r\nconst baseUrl = '//alphafold.ebi.ac.uk/files/AF-'\r\nconst suffixURL = '-F1-model_v4.pdb'\r\n\r\nclass AlphafoldDatasource extends Datasource {\r\n    getUrl (src: string) {\r\n        const info = getFileInfo(src)\r\n        const uniprotid = info.name\r\n        let url\r\n        if (!info.ext || info.ext === 'pdb') {\r\n            url = baseUrl + uniprotid + suffixURL\r\n        } else {\r\n            Log.warn('unsupported AF ext', info.ext)\r\n            url = baseUrl + uniprotid + suffixURL\r\n        }\r\n        return 'https://' + url\r\n    }\r\n\r\n    getExt (src: string) {\r\n        const ext = getFileInfo(src).ext\r\n        return ext ? ext : 'pdb'\r\n    }\r\n}\r\n\r\nDatasourceRegistry.add('alphafold', new AlphafoldDatasource())\r\n\r\nexport default AlphafoldDatasource\r\n","/**\n * @file Static Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getAbsolutePath } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst reProtocol = /^((http|https|ftp):)*\\/\\//\n\nclass StaticDatasource extends Datasource {\n  baseUrl: string\n\n  constructor (baseUrl: string = '') {\n    super()\n    this.baseUrl = baseUrl\n  }\n\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    let url = this.baseUrl + info.path\n    if (!reProtocol.test(this.baseUrl)) {\n      url = getAbsolutePath(url)\n    }\n    return url\n  }\n\n  getExt (src: string) {\n    return getFileInfo(src).ext\n  }\n}\n\nexport default StaticDatasource\n","/**\n * @file MDsrv Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { autoLoad, getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nclass MdsrvDatasource extends Datasource {\n  baseUrl: string\n\n  constructor (baseUrl: string = '') {\n    super()\n    this.baseUrl = baseUrl\n  }\n\n  getListing (path: string = '') {\n    let url = `${this.baseUrl}dir/${path}`\n    if (url[url.length - 1] !== '/') url += '/'\n    return autoLoad(url, {\n      ext: 'json'\n    }).then((jsonData: any) => ({\n      path: path,\n      data: jsonData.data\n    }))\n  }\n\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}file/${info.path}${info.query}`\n  }\n\n  getCountUrl (src: string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/numframes/${info.path}${info.query}`\n  }\n\n  getFrameUrl (src: string, frameIndex: number|string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/frame/${frameIndex}/${info.path}${info.query}`\n  }\n\n  getFrameParams (src: string, atomIndices: (number|string)[]) {\n    return `atomIndices=${atomIndices.join(';')}`\n  }\n\n  getPathUrl (src: string, atomIndex: number|string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/path/${atomIndex}/${info.path}${info.query}`\n  }\n\n  getExt (src: string) {\n    return getFileInfo(src).ext\n  }\n}\n\nexport default MdsrvDatasource\n","/**\n * @file UI Parameters\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { StageParameters } from '../stage/stage'\nimport { MouseActionPresets } from '../controls/mouse-actions'\n\nexport type BooleanParam = { type: 'boolean' }\nfunction BooleanParam () { return { type: 'boolean' } as BooleanParam }\n\nexport type ColorParam = { type: 'color' }\nfunction ColorParam () { return { type: 'color' } as ColorParam }\n\nexport type IntegerParam = { type: 'integer', max: number, min: number }\nfunction IntegerParam (max: number, min: number) {\n  return { type: 'integer', max, min } as IntegerParam\n}\n\nexport type NumberParam = { type: 'number', precision: number, max: number, min: number }\nfunction NumberParam (precision: number, max: number, min: number) {\n  return { type: 'number', precision, max, min } as NumberParam\n}\n\nexport type RangeParam = { type: 'range', step: number, max: number, min: number }\nfunction RangeParam (step: number, max: number, min: number) {\n  return { type: 'range', step, max, min } as RangeParam\n}\n\nexport type SelectParam = { type: 'select', options: { [k: string]: string } }\nfunction SelectParam (...options: string[]) {\n  return { type: 'select', options: options.reduce((o, k) => ({ ...o, [k]: k}), {}) } as SelectParam\n}\n\nexport type ParamType = BooleanParam|ColorParam|IntegerParam|NumberParam|RangeParam|SelectParam\n\nexport const UIStageParameters: { [k in keyof StageParameters]: ParamType } = {\n  backgroundColor: ColorParam(),\n  quality: SelectParam('auto', 'low', 'medium', 'high'),\n  sampleLevel: RangeParam(1, 5, -1),\n  impostor: BooleanParam(),\n  workerDefault: BooleanParam(),\n  rotateSpeed: NumberParam(1, 10, 0),\n  zoomSpeed: NumberParam(1, 10, 0),\n  panSpeed: NumberParam(1, 10, 0),\n  clipNear: RangeParam(1, 100, 0),\n  clipFar: RangeParam(1, 100, 0),\n  clipDist: IntegerParam(200, 0),\n  clipMode: SelectParam('scene', 'camera'),\n  clipScale: SelectParam('relative', 'absolute'),\n  fogNear: RangeParam(1, 100, 0),\n  fogFar: RangeParam(1, 100, 0),\n  cameraType: SelectParam('perspective', 'orthographic', 'stereo'),\n  cameraEyeSep: NumberParam(3, 1.0, 0.01),\n  cameraFov: RangeParam(1, 120, 15),\n  lightColor: ColorParam(),\n  lightIntensity: NumberParam(2, 10, 0),\n  ambientColor: ColorParam(),\n  ambientIntensity: NumberParam(2, 10, 0),\n  hoverTimeout: IntegerParam(10000, -1),\n  tooltip: BooleanParam(),\n  mousePreset: SelectParam(...Object.keys(MouseActionPresets))\n}\n","/**\n * @file Version\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport * as data from '../package.json'\n\n/**\n * Version name\n * @type {String}\n */\nconst Version = (data as any).version as string\n\nexport default Version\n"],"names":["getQuery","id","window","m","RegExp","exec","location","search","decodeURIComponent","defaults","value","defaultValue","undefined","createParams","params","defaultParams","o","Object","assign","k","updateParams","newParams","flatten","array","ret","i","length","Array","isArray","push","getProtocol","protocol","match","getBrowser","ua","navigator","userAgent","test","openUrl","url","open","href","download","data","downloadName","isSafari","isChromeIos","a","document","createElement","str","replace","msSaveOrOpenBlob","FileReader","Blob","reader","onloadend","result","readAsDataURL","objectUrlCreated","URL","createObjectURL","style","display","body","appendChild","target","click","removeChild","revokeObjectURL","throttle","func","wait","options","context","args","timeout","previous","later","leading","Date","now","apply","remaining","this","arguments","clearTimeout","trailing","setTimeout","lexicographicCompare","elm1","elm2","binarySearchIndexOf","element","compareFunction","low","high","mid","cmp","rangeInSortedArray","min","max","indexLeft","leftRange","binarySearchForLeftRange","indexRight","rightRange","binarySearchForRightRange","uniqueArray","sort","filter","index","sorted","uint8ToString","u8a","chunkSize","c","String","fromCharCode","subarray","join","getTypedArray","arrayType","arraySize","Int8Array","Int16Array","Int32Array","Uint8Array","Uint16Array","Uint32Array","Float32Array","Error","getUintArray","sizeOrArray","maxUint","ensureBuffer","buffer","ArrayBuffer","_ensureClassFromArray","constructor","fromArray","ensureVector3","v","Vector3","ensureMatrix4","Matrix4","ensureQuaternion","q","Quaternion","ensureFloat32Array","arg","toLowerCaseString","toString","toLowerCase","Registry","name","_dict","add","key","get","names","keys","degToRad","deg","chars","split","uuid","generateUUID","r","rnd","Math","random","clamp","lerp","start","stop","alpha","spline","p0","p1","p2","p3","t","tension","v0","v1","t2","smoothstep","x","normalize","colorSpace","ScaleDefaultParameters","scale","mode","domain","reverse","tmpColor","Color","manageColor","_target","_name","descriptor","originalMethod","fromTo","bind","set","convertSRGBToLinear","getHex","Colormaker","parameters","structure","atomProxy","getAtomProxy","getScale","p","slice","chroma","out","colorToArray","color","offset","atomColorToArray","atom","atomColor","bondColor","bond","atomIndex1","atomIndex2","bondColorToArray","volumeColorToArray","volumeColor","positionColorToArray","coords","positionColor","kwd","SelectAllKeyword","SelectNoneKeyword","AtomOnlyKeywords","BACKBONE","SIDECHAIN","BONDED","RING","AROMATICRING","METAL","POLARH","ChainKeywords","POLYMER","WATER","SmallResname","NucleophilicResname","HydrophobicResname","AromaticResname","AmideResname","AcidicResname","BasicResname","ChargedResname","PolarResname","NonpolarResname","CyclicResname","AliphaticResname","atomTestFn","s","atomname","altloc","atomindex","keyword","inscode","resname","sstruc","resno","chainname","model","isBackbone","isSidechain","isBonded","isRing","isAromatic","HETERO","isHetero","PROTEIN","isProtein","NUCLEIC","isNucleic","RNA","isRna","DNA","isDna","isPolymer","isWater","HELIX","isHelix","SHEET","isSheet","TURN","isTurn","ION","isIon","SACCHARIDE","isSaccharide","isMetal","isPolarHydrogen","includes","modelIndex","residueTestFn","atomOffset","atomEnd","chainTestFn","entity","modelTestFn","makeTest","selection","fn","error","rules","n","negate","f","subTests","hasOwnProperty","and","operator","na","ALL","NONE","filtered","fs","makeAtomTest","atomOnly","filteredSelection","makeResidueTest","residueOnly","makeChainTest","chainOnly","makeModelTest","modelOnly","Selection","string","signals","stringChanged","Signal","setString","type","silent","retSelection","newSelection","oldSelection","selectionStack","trim","charAt","substr","chunks","createNewContext","getPrevContext","pop","pushRule","rule","not","cu","toUpperCase","lastRule","indexOf","indexList","map","parseInt","b","console","resnameList","isNaN","sele","substring","chain","negate2","resi","resiSingle","resiRange","parseSele","e","message","residueTest","chainTest","modelTest","atomOnlyTest","residueOnlyTest","chainOnlyTest","modelOnlyTest","dispatch","isAllSelection","isNoneSelection","SelectionColormaker","super","colormakerList","selectionList","dataList","forEach","scheme","ColormakerRegistry","hasScheme","getScheme","ColormakerScales","OrRd","PuBu","BuPu","Oranges","BuGn","YlOrBr","YlGn","Reds","RdPu","Greens","YlGnBu","Purples","GnBu","Greys","YlOrRd","PuRd","Blues","PuBuGn","Viridis","Spectral","RdYlGn","RdBu","PiYG","PRGn","RdYlBu","BrBG","RdGy","PuOr","Set1","Set2","Set3","Dark2","Paired","Pastel1","Pastel2","Accent","rainbow","rwb","ColormakerModes","rgb","hsv","hsl","hsi","lab","hcl","getWorkerDeps","vars","deps","sym","__deps","prototype","makeWorkerString","onmessage","__name","postId","__postId","self","callback","aMessage","transferList","postMessage","makeWorkerBlob","Browser","SupportsPassiveEventHandler","opts","defineProperty","addEventListener","Mobile","orientation","SupportsReadPixelsFloat","setSupportsReadPixelsFloat","ExtensionFragDepth","setExtensionFragDepth","Log","log","Function","call","info","warn","time","timeEnd","MeasurementDefaultParams","labelColor","labelAttachment","labelSize","labelZOffset","labelYOffset","labelBorder","labelBorderColor","labelBorderWidth","lineOpacity","linewidth","opacity","labelUnit","arcVisible","planeVisible","setMeasurementDefaultParams","Debug","setDebug","ScriptExtensions","WorkerRegistry","activeWorkerCount","_funcDict","_depsDict","_blobDict","schemes","userSchemes","SchemeClass","getSchemes","types","getScales","getModes","addScheme","label","_createScheme","_addUserScheme","removeScheme","addSelectionScheme","DatasourceRegistry","RepresentationRegistry","ParserRegistry","__hasObjName","objName","parser","__objName","isTrajectory","isStructure","isVolume","isSurface","isBinary","isXml","isJson","getTrajectoryExtensions","getStructureExtensions","getVolumeExtensions","getSurfaceExtensions","ShaderRegistry","DecompressorRegistry","ComponentRegistry","BufferRegistry","PickerRegistry","ListingDatasource","TrajectoryDatasource","setListingDatasource","setTrajectoryDatasource","Streamer","src","newline","__pointer","__partialLine","compressed","binary","json","xml","read","_read","then","decompressFn","_chunk","end","chunk","peekLines","charCodeAt","count","chunkToLines","lines","chunkCount","floor","asText","partialLine","isLast","idx","lastIndexOf","str2","concat","nextChunk","nextChunkOfLines","d","eachChunk","round","eachChunkOfLines","chunkNo","dispose","FileStreamer","Promise","resolve","reject","file","onload","event","onerror","readAsArrayBuffer","readAsText","NetworkStreamer","xhr","XMLHttpRequest","status","response","statusText","responseType","send","Loader","ext","dir","path","streamerParams","File","streamer","ParserLoader","parserParams","voxelSize","firstModelOnly","asTrajectory","cAlphaOnly","delimiter","comment","columnNames","inferBonds","load","parse","Script","functionBody","elementAdded","elementRemoved","nameChanged","run","stage","ScriptLoader","getFileInfo","compressedExtList","queryIndex","query","base","nameSplit","protocolMatch","getDataInfo","datasource","getUrl","getExt","autoLoad","loader","Writer","getBlob","getData","mimeType","defaultName","defaultExt","PdbWriter","renumberSerial","remarks","ensureArray","_records","_writeRecords","_writeTitle","_writeRemarks","_writeAtoms","sprintf","trajectory","frame","ia","im","charge","chargeSign","hasModels","modelStore","eachModel","eachAtom","formatString","hetero","serial","formalCharge","abs","toPrecision","y","z","occupancy","bfactor","getSelection","getString","SdfWriter","idString","titleString","title","countsString","atomCount","bondCount","chargeLines","pairs","ap","nCharges","j","formatAtom","line","formatBond","bp","bondOrder","_writeHeader","_writeCTab","_writeFooter","eachBond","charArray","IOBuffer","_mark","_marks","littleEndian","dataIsGiven","byteLength","dvOffset","byteOffset","_lastWrittenByte","_data","DataView","available","isLittleEndian","setLittleEndian","isBigEndian","setBigEndian","skip","seek","mark","reset","pushMark","popMark","rewind","ensureAvailable","newLength","newArray","readBoolean","readUint8","readInt8","getInt8","getUint8","readByte","readBytes","bytes","readInt16","getInt16","readUint16","getUint16","readInt32","getInt32","readUint32","getUint32","readFloat32","getFloat32","readFloat64","getFloat64","readChar","readChars","writeBoolean","writeUint8","writeInt8","setInt8","_updateLastWrittenByte","setUint8","writeByte","writeBytes","writeInt16","setInt16","writeUint16","setUint16","writeInt32","setInt32","writeUint32","setUint32","writeFloat32","setFloat32","writeFloat64","setFloat64","writeChar","writeChars","toArray","StlWriter","surface","triangles","output","vector","vectorNorm1","vectorNorm2","vectorNorm3","indices","normal","addVectors","position","Counter","countChanged","signalsWrapper","clear","change","delta","increment","decrement","listen","counter","unlisten","has","remove","onZeroOnce","Stats","updated","maxDuration","Infinity","minDuration","avgDuration","lastDuration","prevFpsTime","lastFps","lastFrames","frames","begin","update","startTime","currentTime","performance","reInclude","shaderCache","getShader","defines","hash","definesText","getDefines","shaderText","ShaderChunk","WebGLRenderingContext","wrcp","_getShaderParameter","getShaderParameter","_getShaderInfoLog","getShaderInfoLog","_getProgramParameter","getProgramParameter","program","pname","LINK_STATUS","_getProgramInfoLog","getProgramInfoLog","JitterVectors","offsetList","TiledRenderer","renderer","camera","viewer","canvas","_viewer","_factor","factor","_antialias","antialias","_onProgress","onProgress","_onFinish","onFinish","_n","_width","width","_height","height","_ctx","getContext","_viewerSampleLevel","sampleLevel","setSampling","_renderTile","offsetX","offsetY","setViewOffset","render","w","h","drawImage","domElement","ceil","_finalize","view","renderAsync","TwoPI","PI","RAD2DEG","circularMean","stride","cosMean","sinMean","angle","cos","sin","atan2","calculateCenterArray","array1","array2","center","calculateDirectionArray","direction","uniformArray","optionalTarget","uniformArray3","serialArray","serialBlockArray","replicateArrayEntries","repArr","copyArray","dst","srcOffset","dstOffset","copyWithin","arrayMax","il","arrayMin","arraySum","sum","arrayMean","ImageDefaultParameters","transparent","makeImage","originalClearAlpha","getClearAlpha","backgroundColor","getClearColor","setLineWidthAndPixelSize","invert","scene","traverse","material","uniforms","size","__seen","trimCanvas","bg","g","canvasHeight","canvasWidth","pixels","getImageData","doBreak","off","topY","topX","bottomY","bottomX","trimedCanvas","_trimCanvas","finished","tiledRenderer","toBlob","blob","setClearAlpha","requestRender","vertex","matrix","modelViewProjectionMatrix","resolution","Vector2","projectionMatrixInverse","projectionMatrixTranspose","updateCameraUniforms","group","copy","projectionMatrix","transpose","u","loadShader","gl","shaderSource","shaderType","shader","createShader","compileShader","COMPILE_STATUS","deleteShader","getExtension","TextureTestTexCoords","testTextureSupport","vertShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","shaders","attribs","locations","createProgram","attachShader","attrib","bindAttribLocation","linkProgram","deleteProgram","useProgram","positionLocation","getAttribLocation","colorLoc","getUniformLocation","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","whiteTex","createTexture","whiteData","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","tex","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","uniform4fv","drawArrays","TRIANGLES","clearColor","COLOR_BUFFER_BIT","pixel","readPixels","floatPixel","getError","NO_ERROR","INVALID_ENUM","INVALID_VALUE","INVALID_OPERATION","INVALID_FRAMEBUFFER_OPERATION","OUT_OF_MEMORY","CONTEXT_LOST_WEBGL","getErrorDescription","pixelBufferFloat","pixelBufferUint","pixelOrder","tmpMatrix","onBeforeRender","geometry","updateList","objectId","modelViewMatrixInverse","modelViewMatrixInverseTranspose","modelViewProjectionMatrixInverse","modelViewMatrix","multiplyMatrices","matrixWorldInverse","matrixWorld","materialProperties","properties","pu","getUniforms","setValue","Viewer","idOrElement","boundingBox","Box3","boundingBoxSize","boundingBoxLength","memory","programs","geometries","textures","calls","vertices","faces","points","distVector","ticked","rendered","elm","getElementById","container","HTMLElement","innerWidth","innerHeight","box","getBoundingClientRect","overflow","wrapper","_initParams","_initStats","_initCamera","_initScene","_initRenderer","_initHelper","setBackground","setFog","animate","fogColor","fogNear","fogFar","cameraType","cameraFov","cameraEyeSep","cameraZ","clipNear","clipFar","clipDist","clipMode","clipScale","lightColor","lightIntensity","ambientColor","ambientIntensity","outputColorSpace","lookAt","perspectiveCamera","PerspectiveCamera","orthographicCamera","OrthographicCamera","stereoCamera","StereoCamera","aspect","eyeSep","updateProjectionMatrix","stats","Scene","rotationGroup","Group","translationGroup","modelGroup","pickingGroup","backgroundGroup","helperGroup","fog","Fog","directionalLight","DirectionalLight","ambientLight","AmbientLight","dpr","devicePixelRatio","WebGLRenderer","preserveDrawingBuffer","innerHTML","setPixelRatio","setSize","autoClear","sortObjects","useLegacyLights","capabilities","isWebGL2","extensions","supportsHalfFloat","dprWidth","dprHeight","JSON","stringify","OES_texture_float","OES_texture_half_float","WEBGL_color_buffer_float","pickingTarget","WebGLRenderTarget","minFilter","NearestFilter","magFilter","stencilBuffer","format","RGBAFormat","FloatType","UnsignedByteType","texture","generateMipmaps","setRenderTarget","sampleTarget","LinearFilter","HalfFloatType","holdTarget","compositeUniforms","tForeground","Uniform","compositeMaterial","ShaderMaterial","vertexShader","fragmentShader","premultipliedAlpha","blending","AdditiveBlending","depthTest","depthWrite","compositeCamera","compositeScene","Mesh","PlaneGeometry","positions","bbGeometry","BufferGeometry","setIndex","BufferAttribute","setAttribute","bbMaterial","uColor","boundingBoxMesh","LineSegments","updateHelper","attributes","needsUpdate","isEmpty","computeBoundingSphere","cameraDistance","instanceList","instance","addBuffer","wireframeGroup","background","pickable","setUserData","object","children","userData","mesh","getMesh","applyMatrix4","wireframeMesh","getWireframeMesh","quaternion","pickingMesh","getPickingMesh","_updateBoundingBox","updateBoundingBox","instanceMatrix","updateGeometry","computeBoundingBox","geoBoundingBox","clone","equals","expandByScalar","union","updateNode","node","makeEmpty","getSize","getPickingPixels","imgBuffer","readRenderTargetPixels","getImage","picking","imgBuffer2","ctx","imgData","putImageData","setLight","intensity","near","far","setClearColor","getStyle","level","setOutputEncoding","colorspace","setColorWorkflow","setCamera","fov","up","updateZoom","setClip","dist","left","right","top","bottom","handleResize","updateInfo","rInfo","rMemory","rRender","isStill","currentSampleLevel","renderPending","frameRequest","requestAnimationFrame","pick","pid","picker","pixelBuffer","oid","getObjectById","tan","zoom","absoluteToRelative","bRadius","relativeToAbsolute","__updateClipping","isFinite","getWorldPosition","cDist","nearFactor","farFactor","fogNearFactor","fogFarFactor","__updateCamera","updateMatrix","updateMatrixWorld","pixelRatio","getPixelRatio","ortho","nearClip","updateMaterialUniforms","traverseVisible","Points","sortParticles","sortData","sortArray","zArray","cmpFn","indexSrc","indexDst","tmpTab","__zArray","__sortArray","__cmpFn","ai","bi","arr","stack","tmp","sp","swap","tmp2","quicksortCmp","attr","itemSize","sortProjectedPosition","__setVisibility","helper","visible","__updateLights","setLength","__renderPickingGroup","__renderModelGroup","renderTarget","__renderSuperSample","baseSampleWeight","sampleWeight","clearViewOffset","__renderStereo","_renderTarget","setScissorTest","setScissor","setViewport","cameraL","__render","cameraR","lastRenderedPicking","rendering","cancelAnimationFrame","LeftMouseButton","MiddleMouseButton","RightMouseButton","getTouchDistance","dx","touches","pageX","dy","pageY","sqrt","MouseObserver","moved","scrolled","dragged","dropped","clicked","hovered","doubleClicked","prevPosition","down","canvasPosition","prevClickCP","moving","hovering","lastMoved","which","buttons","pressed","altKey","ctrlKey","metaKey","shiftKey","touchAction","hoverTimeout","handleScroll","doubleClickSpeed","_listen","_onMousewheel","_onMousemove","_onMousedown","_onMouseup","_onContextmenu","_onTouchstart","_onTouchend","_onTouchmove","opt","passive","setParameters","cp","doubleClickPending","lastClicked","overElement","preventDefault","_setKeys","deltaY","deltaMode","WheelEvent","DOM_DELTA_PIXEL","DOM_DELTA_LINE","wheelDelta","wheelDeltaY","detail","clientX","clientY","_setCanvasPosition","button","getMouseButtons","_distance","distanceTo","lastTouchDistance","touchDistance","removeEventListener","tmpRotateXMatrix","tmpRotateYMatrix","tmpRotateZMatrix","tmpRotateMatrix","tmpRotateCameraMatrix","tmpRotateVector","tmpRotateQuaternion","tmpRotateQuaternion2","tmpPanMatrix","tmpPanVector","tmpAtomVector","TrackballControls","rotateSpeed","zoomSpeed","panSpeed","mouse","mouseObserver","controls","viewerControls","component","transformComponent","transformAtom","_setPanVector","scaleFactor","getCanvasScaleFactor","multiplyScalar","_getRotateXY","_getCameraRotation","extractRotation","multiply","makeRotationY","_transformPanVector","transform","premultiply","pan","translate","panComponent","panAtom","positionToVector3","positionAdd","updateRepresentations","rotate","setFromAxisAngle","makeRotationFromQuaternion","applyMatrix","zRotate","dz","makeRotationZ","rotateComponent","makeRotationAxis","setFromRotationMatrix","tmpVec","PickingProxy","pickingData","getComponentsByObject","list","getObject","getPosition","closestBondAtom","atom1","v2","atom2","acp1","getPositionOnCanvas","acp2","closeAtom","ca","acp","radius","getMaxRepresentationRadius","arrow","_objectIfType","axes","cone","clash","contact","cylinder","distance","ellipsoid","icosahedron","octahedron","point","sphere","tetrahedron","torus","unitcell","unknown","volume","wideline","getLabel","msg","qualifiedName","sele1","sele2","shape","spacegroup","PickingControls","pickerArray","tmpQ","tmpP","tmpS","tmpCanvasVector","tmpScaleVector","tmpAlignMatrix","ViewerControls","changed","rotation","skipDispatch","project","getCameraDistance","getOrientation","setPosition","orient","decompose","setRotationFromQuaternion","spin","axis","rotateOnAxis","align","basis","setRotationFromMatrix","Animation","duration","pausedTime","elapsedDuration","pausedDuration","ignoreGlobalToggle","_paused","_resolveList","_init","done","paused","tick","_tick","pause","hold","_hold","resume","releaseHold","toggle","SpinAnimation","RockAnimation","angleSum","angleStep","angleEnd","MoveAnimation","moveFrom","moveTo","lerpVectors","ZoomAnimation","zoomFrom","zoomTo","RotateAnimation","_currentRotation","rotateFrom","rotateTo","slerp","ValueAnimation","valueFrom","valueTo","TimeoutAnimation","AnimationList","_list","every","animation","AnimationControls","animationList","finishedList","splice","rock","move","zoomMove","orientTo","spinComponent","rockComponent","moveComponent","Queue","argList","queue","pending","next","shift","kill","Representation","lazy","step","clipRadius","precision","clipCenter","flatShaded","side","front","back","double","wireframe","colorData","colorScheme","colorScale","colorReverse","colorValue","colorDomain","colorMode","roughness","metalness","diffuse","diffuseInterior","useInteriorColor","interiorColor","interiorDarkening","disablePicking","rebuild","tasks","make","bufferList","toBePrepared","init","setColor","quality","lazyProps","build","bufferParams","what","tp","sphereDetail","radialSegments","openEnded","disableImpostor","getColorParams","getBufferParams","val","prepare","cb","create","updateWhat","_make","manualAttach","disposed","attach","setVisibility","noRenderRequest","updateParameters","int","float","parseFloat","getParameters","_Worker","postCount","onmessageDict","onerrorDict","blobUrl","worker","Worker","post","__debug","terminate","WorkerPool","maxCount","pool","getNextWorker","nextWorker","minPending","calculateMeanVector3","projectPointOnVector","origin","sub","projectOnVector","minX","minY","minZ","maxX","maxY","maxZ","l","v3new","applyMatrix4toVector3array","applyMatrix3toVector3array","normalizeVector3array","len2","v3cross","ax","ay","az","bx","by","bz","v3dot","v3sub","v3add","v3fromArray","v3toArray","input","v3length2","v3length","v3divideScalar","v3multiplyScalar","v3normalize","length2","v3subScalar","v3addScalar","v3floor","v3ceil","v3negate","v3angle","cx","cy","cz","getFixedCountDashData","segmentCount","position1","sn3","position2","i3","j3","f1","f2","replicateArray3Entries","color2","primitiveId","getFixedLengthDashData","segmentLength","pos1","pos2","col","rad","getFixedLengthWrappedDashData","drawing","k3","kprev","vl","inv","Primitive","Picker","Buffer","getShapeKey","expandBoundingBox","valueToShape","_primitiveData","fields","addElement","objectToShape","valueFromShape","objectFromShape","arrayFromShape","dataFromShape","bufferFromShape","SpherePrimitive","positionFromShape","expandByPoint","BoxPrimitive","heightAxis","depthAxis","OctahedronPrimitive","TetrahedronPrimitive","IcosahedronPrimitive","CylinderPrimitive","dashedCylinder","ArrowPrimitive","ConePrimitive","EllipsoidPrimitive","majorAxis","minorAxis","TorusPrimitive","TextPrimitive","text","PointPrimitive","WidelinePrimitive","SpatialHash","exp","bb","createBoundingBox","boundX","boundY","boundZ","an","xArray","yArray","grid","bucketIndex","bucketCount","bucketOffset","bucketFill","bucketArray","bucketIdx","within","eachWithin","atomIndex","rSq","loX","loY","loZ","hiX","hiY","hiZ","ix","iy","iz","dSq","Store","_fields","_defaultFields","_initField","addField","resize","tmpArray","growIfFull","copyFrom","other","thisOffset","otherOffset","thisField","otherField","thisIndex","otherIndex","offsetTarget","offsetSource","targetIndex","sourceIndex","thisStore","tmpStore","quicksort","pivot","leftNew","rightNew","index1","index2","ContactStore","addContact","hammingWeight","BitArray","setAll","_words","flip","_assignRange","words","wordValue","wordStart","wordEnd","startWord","endWord","setRange","clearRange","setBits","clearBits","clearAll","flipAll","bs","_isRangeValue","isRangeSet","isRangeClear","isAllSet","isAllClear","isSet","isClear","isEqualTo","otherBitarray","words1","words2","difference","intersection","intersects","getIntersectionSize","makeIntersection","wordsA","answer","pos","toSeleString","createAdjacencyList","edges","edgeCount","nodeCount","nodeArray1","nodeArray2","countArray","offsetArray","bondCount2","indexArray","idx1","idx2","j1","j2","createFeatureState","atomSet","addAtom","state","addFeature","features","groups","centers","atomSets","UnknownBackboneType","ChemCompProtein","ChemCompRna","ChemCompDna","ChemCompSaccharide","ChemCompHetero","SecStrucHelix","SecStrucSheet","SecStrucTurn","AtomicNumbers","H","D","T","HE","LI","BE","B","C","N","O","F","NE","NA","MG","AL","SI","P","S","CL","AR","K","CA","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","GA","GE","AS","SE","BR","KR","RB","SR","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","IN","SN","SB","TE","I","XE","CS","BA","LA","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","HF","TA","W","RE","OS","IR","PT","AU","HG","TL","PB","BI","PO","AT","RN","FR","RA","AC","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR","RF","DB","SG","BH","HS","MT","DS","RG","CN","NH","FL","MC","LV","TS","OG","VdwRadii","CovalentRadii","Valences","OuterShellElectronCounts","ResidueHydrophobicity","ALA","ARG","ASN","ASP","ASH","CYS","GLN","GLU","GLH","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","DefaultResidueHydrophobicity","AA1","SEC","PYL","AA3","RnaBases","DnaBases","PurinBases","Bases","WaterNames","IonNames","SaccharideNames","ProteinBackboneAtoms","NucleicBackboneAtoms","ResidueTypeAtoms","trace","direction1","direction2","backboneStart","backboneEnd","PDBQTSpecialElements","HD","A","NS","OA","SA","G0","G1","G2","G3","CG0","CG1","CG2","CG3","assignGeometry","totalCoordination","Angles","Map","calcAngles","ap1","ap2","angles","d1","d2","subVectors","eachBondedAtom","number","angleTo","calcPlaneAngle","x1","v12","neighbours","ni","cross","ValenceModel","implicitH","totalH","idealGeometry","chg","implH","totH","geom","hydrogenCount","bondToElementCount","assignCharge","assignH","degree","valence","explicitValence","conjugated","_bp","getBondProxy","atomicNumber","flag","a2","getOtherAtom","b2","atomicNumber2","isConjugated","multiBond","implicitHCount","ba","oa","calculateHydrogensCharge","valenceModel","isPhosphate","PositvelyCharged","NegativelyCharged","isIonicInteraction","ti","tj","isPiStacking","isCationPi","isHistidineNitrogen","isHydrogenBond","isWeakHydrogenBond","IonicTypeMetals","isMetalComplex","halBondElements","X","OptimalHalogenAngle","OptimalAcceptorAngle","invalidAtomContact","masterIdx","isMasterContact","ContactDefaultParams","maxHydrophobicDist","maxHbondDist","maxHbondSulfurDist","maxHbondAccAngle","maxHbondDonAngle","maxHbondAccPlaneAngle","maxHbondDonPlaneAngle","maxPiStackingDist","maxPiStackingOffset","maxPiStackingAngle","maxCationPiDist","maxCationPiOffset","maxIonicDist","maxHalogenBondDist","maxHalogenBondAngle","maxMetalDist","refineSaltBridges","masterModelIndex","lineOfSightDistFactor","residueIndex","calculateFeatures","atomInGroupDict","eachResidue","addGroup","terminalNitrogenCount","isGuanidine","isAcetamidine","addPositiveCharges","isSulfonicAcid","isSulfate","terminalOxygenCount","isCarboxylate","addNegativeCharges","rings","getAromaticRings","ring","addAromaticRings","totalBonds","ig","addHydrogenAcceptors","addHydrogenDonors","ringData","residueType","getRings","hasElement","some","residueAtomOffset","atomTypeId","atomTypeIdList","atomMap","inAromaticRingWithElectronNegativeElement","addWeakHydrogenDonors","dative","ionic","isStandardAminoacid","isStandardBase","isHalogen","addMetalBinding","isTransitionMetal","addMetals","addHydrophobic","addHalogenAcceptors","addHalogenDonors","calculateContacts","contacts","spatialHash","contactStore","featureSet","createContacts","maxDistance","maxPiStackingDistSq","maxCationPiDistSq","atomStore","areAtomSetsWithinDist","atomSet1","atomSet2","maxDist","sn","sm","si","sj","v3","n1","n2","getNormal","atoms","crossVectors","getOffset","projectOnPlane","ct","addChargedContacts","maxHbondDistSq","donor","acceptor","isWeak","connectedTo","donorAngles","idealDonorAngle","donorAngle","outOfPlane","acceptorAngles","idealAcceptorAngle","acceptorAngle","bondType","isWaterHydrogenBond","isBackboneHydrogenBond","addHydrogenBonds","m1","m2","addMetalComplexation","addHydrophobicContacts","halogen","halogenAngles","addHalogenBonds","frozenContacts","adjacencyList","contactSet","createFrozenContacts","ac1","ac2","aw","c1","c2","lineOfSightDist","lineOfSightDistFactorSq","as1","as2","vdw","distanceToSquared","refineLineOfSight","residueContactDict","handleResidueContact","minDist","minIndex","refineHydrophobicContacts","ionicInteractionDict","isHydrogenBondType","iil1","iil2","piStackingDict","pil1","pil2","refinePiStacking","refineMetalCoordination","contactTypeName","ContactDataDefaultParams","hydrogenBond","hydrophobic","halogenBond","ionicInteraction","metalCoordination","cationPi","piStacking","weakHydrogenBond","waterHydrogenBond","backboneHydrogenBond","filterSele","getContactData","filterSet","getAtomSet","setHex","contactColor","ContactPicker","getIndex","_applyTransformations","_getPosition","ShapePicker","primitive","AtomPicker","AxesPicker","BondPicker","bondStore","center1","center2","ClashPicker","validation","clashArray","_getAtomProxyFromSele","getAtomIndices","DistancePicker","IgnorePicker","MeshPicker","__position","SurfacePicker","UnitcellPicker","getCenter","VolumePicker","vol","dp","SlicePicker","getEdgeTable","getTriTable","MarchingCubes","field","nx","ny","nz","normalCache","vertexIndex","icount","mx","my","mz","allowedContours","isolevel","noNormals","contour","wrap","isNegativeIso","normalFactor","yd","zd","ilist","positionArray","normalArray","atomindexArray","edgeTable","triTable","VIntX","valp1","valp2","_q","mu","nc","q3","VIntY","q6","VIntZ","compNorm","polygonize","fx","fy","fz","edgeFilter","q1","qy","qz","q1y","q1z","qyz","q1yz","cubeindex","field0","field1","field2","field3","field4","field5","field6","field7","bits","fx2","fy2","fz2","e1","e2","e3","triIndex","triangulate","xBeg","yBeg","zBeg","xEnd","yEnd","zEnd","yOffset","zOffset","xBeg2","yBeg2","zBeg2","xEnd2","yEnd2","zEnd2","__break","__xBeg","__yBeg","__zBeg","__xEnd","__yEnd","__zEnd","_isolevel","_noNormals","_box","_contour","_wrap","vIndexLength","Matrix","cols","rows","copyTo","At","nrows","ncols","Ai","Ati","pAt","ad","atd","multiplyABt","Ap","pA","pB","Cp","mrows","bd","cd","multiply3x3","Cd","Ad","Bd","m10","m11","m12","m13","m14","m15","m16","m17","m18","m20","m21","m22","m23","m24","m25","m26","m27","m28","meanRows","mean","subRows","row","i0","i1","hypot","EPSILON","FLT_MIN","svd","at","_m","amt","wmt","vmt","astep","_W","Vt","vstep","eps","minval","iter","maxIter","Aj","Vi","Vj","t0","t1","sd","beta","gamma","seed","val0","asum","Float64Array","JacobiSVDImpl","m4new","m4set","n11","n12","n13","n14","n21","n22","n23","n24","n31","n32","n33","n34","n41","n42","n43","n44","m4multiply","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","m4makeScale","m4makeTranslation","m4makeRotationY","theta","m3new","m3makeNormal","m4","r0","r1","r2","laplacianSmooth","verts","numiter","inflate","nv","nf","norms","tps","vertdeg","jl","flagvert","ao","bo","co","vi3","vdi","wtvi","wt2vi","wt2","outwt","computeVertexNormals","nv3","ab","ci","getRadiusDict","radiusList","radiusDict","getSurfaceGrid","maxRadius","extraMargin","margin","dim","maxSize","pow","tmpSize","tran","mroty","mscale","mtrans","Surface","fromGeometry","setFromArray","geo","getColor","colormaker","tc","getPicking","getFilteredIndex","filteredIndex","elementSize","include","getAtomindex","VolumeSurface","mc","getSurface","smooth","normalMatrix","volsurf","Volume","Matrix3","inverseMatrix","setData","setAtomindex","_position","_min","_max","_mean","_rms","setStats","rms","setMatrix","me","elements","ne","getBox","_getBox","__box","_makeSurface","getValueForSigma","getSurfaceWorker","workerPool","sigma","getSigmaForValue","getDataAtomindex","getDataPosition","getDataColor","getDataPicking","getDataSize","_sum","sumSq","di","arrayRms","header","getThreeSide","FrontSide","BackSide","DoubleSide","setObjectMatrix","matrixWorldNeedsUpdate","BufferDefaultParameters","opaqueBack","forceTransparent","BufferParameterTypes","updateShader","property","uniform","updateVisibility","parameterTypes","indexVersion","wireframeIndexVersion","isImpostor","isText","isPoint","isLine","dynamic","wireframeIndexCount","defaultParameters","UniformsUtils","merge","UniformsLib","common","emissive","lights","pickingUniforms","_positionDataSize","addAttributes","initIndex","makeWireframeGeometry","attributeSize","nindex","setUsage","DynamicDrawUsage","StaticDrawUsage","makeMaterial","vertexColors","derivatives","fragDepth","wm","pm","NoBlending","wireframeMaterial","pickingMaterial","makeWireframeIndex","wireframeIndex","wireframeGeometry","setDrawRange","checkEdge","drawRange","updateWireframeIndex","updateRange","getRenderOrder","renderOrder","_getMesh","materialName","frustumCulled","getVertexShader","getFragmentShader","NEAR_CLIP","RADIUS_CLIP","PICKING","NOLIGHT","FLAT_SHADED","OPAQUE_BACK","DIFFUSE_INTERIOR","USE_INTERIOR_COLOR","addUniforms","buf","updateRenderOrder","setRenderOrder","pt","pv","propertyData","uniformData","doShaderUpdate","doVisibilityUpdate","setProperties","setUniforms","setAttributes","attribute","wu","isVector3","toJSON","MeshBuffer","SurfaceBuffer","setVisibilityTrue","setVisibilityFalse","DoubleSidedBuffer","frontMeshes","backMeshes","frontBuffer","backBuffer","ContourBuffer","SurfaceRepresentation","isolevelType","negateIsolevel","isolevelScroll","boxSize","colorVolume","useWorker","boxCenter","__boxCenter","setBox","__isolevel","__smooth","__contour","__wrap","__boxSize","onSurfaceFinish","surfaceBuffer","dullInterior","surfaceData","MouseActions","zoomScroll","trackballControls","clipNearScroll","focusScroll","focus","getFocus","sign","almostIdentity","setFocus","zoomFocusScroll","eachRepresentation","reprElem","comp","repr","panDrag","rotateDrag","zRotateDrag","zoomDrag","zoomFocusDrag","panComponentDrag","panAtomDrag","rotateComponentDrag","movePick","pickingProxy","animationControls","tooltipPick","tt","tooltip","mp","innerText","measurePick","measureClear","MouseActionPresets","default","pymol","coot","astexviewer","triggerFromString","tokens","MouseControls","actionList","disabled","preset","triggerStr","wildcard","action","KeyActions","autoView","toggleAnimations","toggleRock","toggleSpin","toggleAntialiasing","KeyActionPresets","KeyControls","char","PickingBehavior","mouseControls","_onClick","_onHover","pickingControls","MouseBehavior","_onMove","_onScroll","_onDrag","_onDblclick","AnimationBehavior","_onTick","KeyBehavior","keyControls","outline","_focusDomElement","_onKeydown","_onKeyup","_onKeypress","pressedKey","KeyboardEvent","keyCode","Annotation","content","_viewerPosition","_updateViewerPosition","_canvasPosition","_cameraPosition","pointerEvents","whiteSpace","setContent","_update","matrixChanged","displayValue","padding","fontFamily","_clientRect","getVisibility","vp","cr","depth","zIndex","ComponentControls","RadiusFactoryTypes","covalent","explicit","RadiusFactory","atomRadius","negateVector","PrincipalAxes","n3","pointsT","vm","van","vbn","vcn","va","vb","vc","begA","endA","begB","endB","begC","endC","vecA","vecB","vecC","normVecA","normVecB","normVecC","getBasisMatrix","makeBasis","determinant","getRotationQuaternion","getProjectedScaleForAtoms","d1a","d1b","d2a","d2b","d3a","d3b","ax1","ax2","ax3","dp1","dot","dt1","dp2","dt2","dp3","dt3","FilteredVolume","minValue","maxValue","outside","setFilter","_getFilterHash","DMEAN","ARMS","filterHash","_filterHash","_dataBuffer","_positionBuffer","_atomindexBuffer","filteredData","filteredPosition","filteredAtomindex","BondHash","al","BondStore","addBond","ai1","ai2","addBondIfConnected","AtomStore","setAltloc","getAltloc","code","ResidueStore","setSstruc","getSstruc","setInscode","getInscode","ChainStore","setChainname","getChainname","setChainid","chainid","getChainid","ModelStore","Helixorient","polymer","residueCount","getCenterIterator","cache","idx3","residueIndexStart","rp","getResidueProxy","traceAtomIndex","radiusFactory","diff","rise","twist","resdir","r12","r23","r34","diff13","diff24","vt","_axis","_prevAxis","_resdir","_center","a1","getAtomIndexByType","a3","a4","acos","diff13Length","diff24Length","resRadius","resTwist","resRise","resBending","resAxis","bending","Helixbundle","helixorient","getAxis","localAngle","centerDist","ssBorder","colorParams","radiusParams","beg","residueOffset","tmpAxis","tmpCenter","_beg","_end","rp1","rp2","BinaryHeap","scoreFunction","bubbleUp","sinkDown","peek","len","parentN","parent","elemScore","child1Score","child2Score","child2N","child1N","child1","child2","Kdtree","metric","maxDepth","currentNode","nodes","rootIndex","buildTree","arrBegin","arrEnd","plength","nodeIndex","arrMedian","currentDim","pivotIndex","pivotValue","storeIndex","getNodeDepth","parentIndex","nearest","maxNodes","bestNodes","nearestSearch","bestChild","otherChild","dimension","pointIndex","ownPoint","ownDistance","saveNode","leftIndex","rightIndex","linearPoint","linearDistance","verify","AtomProxy","chainStore","residueStore","residueMap","bondHash","entityList","entityIndex","chainIndex","residue","residueTypeId","atomType","partialCharge","aromatic","_ap","hasBondTo","bap","hasBondToElement","backboneIndexList","moleculeType","isCg","backboneType","isTrace","atomRings","isNonmetal","isMetalloid","isDiatomicNonmetal","isPolyatomicNonmetal","isAlkaliMetal","isAlkalineEarthMetal","isNobleGas","isPostTransitionMetal","isLanthanide","isActinide","getDefaultValence","getValenceList","getOuterShellElectronCount","taa","aaa","distSquared","ta","aa","positionFromArray","positionToArray","positionFromVector3","positionSub","getResidueBonds","firstOnly","relativeIndex","bonds","getBonds","atomIndices1","atomIndices2","connectedAtomIndex","connectedAtomIndices","noResname","toObject","euclideanDistSq","euclideanDist","pointArray","useSquaredDist","atomIndices","kdtree","_Kdtree","nodeList","resultList","SymOpCode","$","E","G","J","L","M","Q","R","Z","_","EncodedSymOp","reInteger","selectionFromChains","chainList","Assembly","partList","addPart","matrixList","part","AssemblyPart","getAtomCount","reduce","getResidueCount","getInstanceCount","instanceCount","isIdentity","structureChainList","eachChain","getBoundingBox","partBox","_getCount","propertyName","instanceBox","structureBox","getView","getInstanceList","StructureBuilder","currentModelindex","currentChainid","currentResname","currentResno","currentInscode","currentHetero","previousResname","previousHetero","ri","mi","addResidueType","cc","_a","chemCompMap","dict","chemCompType","_b","modelindex","addModel","addChain","addResidue","chainOffset","chainCount","finalize","assignSecondaryStructure","secStruct","chainnames","chainnamesSorted","chainnamesIndex","helices","h1","h2","helix","helixRun","chainChange","sheets","s1","s2","strandCharCode","sheet","sheetRun","calculateSecondaryStructure","zhangSkolnickSS","distances","isHelical","eachPolymer","cgPolymer","proteinPolymer","prevSstruc","sstrucCount","ChainnameAlphabet","calculateChainnames","useExistingBonds","doAutoChainName","mIndex","rOffset","rCount","rStart","rEnd","chainData","eachResidueN","newChain","bbType1","bbType2","bbTypeUnk","backboneEndAtomIndex","backboneStartAtomIndex","fill","calculateBonds","calculateBondsWithin","calculateBondsBetween","BondOrderTable","getBondOrderFromTable","atomname1","atomname2","onlyAddRung","rungBondStore","rungAtomSet","atomBondMap","calculateAtomBondMap","bondedAtoms","Set","rai","bondOrders","nn","rai1","rai2","getBondIndex","rungEndAtomIndex","atomSetDict","rung","onlyAddBackbone","backboneBondStore","backboneAtomSet","needsBond","needsBackbone","backbone","buildUnitcellAssembly","uc","structureCenterFrac","cartToFrac","centerFrac","symopDict","encodedSymopList","matrixDict","symopList","symop","denominator","integer","getSymmetryOperations","centerFracSymop","positionFracSymop","getMatrixList","setFromMatrixPosition","fracToCart","unitcellAssembly","unitcellMatrixList","ncsMatrixList","biomolDict","NCS","ncsUnitcellMatrixList","nm","vec","supercellAssembly","supercellMatrixList","ncsSupercellMatrixList","UNITCELL","SUPERCELL","guessElement","atomName","assignResidueTypeBonds","bondDict","nextAtomOffset","concatStructures","structures","Structure","sb","atomIndexDict","modelCount","finalizeAtoms","finalizeBonds","AlkaliMetals","AlkalineEarthMetals","PolyatomicNonmetals","DiatomicNonmetals","NobleGases","PostTransitionMetals","Metalloids","Halogens","AtomType","no","AtomMap","getHash","ResidueType","bondReferenceAtomIndices","getMoleculeType","getBackboneType","backboneEndType","backboneStartType","getBackboneIndexList","atomnames","atomnamesStart","atomnamesEnd","traceIndex","getAtomIndexByName","dir1Index","direction1AtomIndex","dir2Index","direction2AtomIndex","bbStartIndex","bbEndIndex","rungEndIndex","atomnameList","hasProteinBackbone","hasRnaBackbone","hasDnaBackbone","hasCgProteinBackbone","hasCgRnaBackbone","hasCgDnaBackbone","hasAtomWithName","hasBackboneAtoms","hasBackbone","end1","maxd","nearestAtoms","calculateResidueBonds","calculateRings","getBondGraph","bondGraph","calculateBondGraph","getAromatic","aromaticAtoms","calculateAromatic","aromaticRings","nb","capacity","visited","pred","RingFinderMaxDepth","currentColor","RingFinderState","findRings","aromaticRingFlags","AromaticRingElements","AromaticRingPlanarityThreshold","isRingAromatic","assignBondReferenceAtomIndices","refRing","rings1","rings2","ri1","ai3","_idx2","getBondReferenceAtomIndex","bondIndex","addRing","current","leftOffset","rightOffset","found","rn","ringOffset","from","head","ResidueMap","BondProxy","_v12","_v13","_ap1","_ap2","_ap3","getOtherAtomIndex","getReferenceAtomIndex","typeAtomIndex1","typeAtomIndex2","calculateShiftDir","ap3","v13","ResidueProxy","getChainProxy","getAtomType","getResname1","getAtomnameList","rNext","bbAtomEnd","bbAtomStart","getNextConnectedResidue","nextIndex","rpNext","rpFirst","getPreviousConnectedResidue","residueProxy","prevIndex","rpPrev","rpLast","Polymer","residueIndexEnd","rpStart","rpEnd","isPrevConnected","isNextConnected","isNextNextConnected","isCyclic","__residueProxy","aIndex","eachAtomN","rStartIndex","ChainProxy","getModelProxy","residueEnd","_rp","rNextIndex","first","ModelProxy","chainEnd","_cp","refreshed","extraData","atomSetCache","boxes","bondSet","getBondSet","getBackboneBondSet","backboneBondSet","__backbone","getRungBondSet","rungBondSet","__rung","seleString","getAtomSetWithinSelection","getAtomSetWithinPoint","getAtomSetWithinVolume","fv","getMaxScaleOnAxis","getAtomSetWithinGroup","atomResidueIndex","getStructure","eachEntity","getEntityType","mn","cn","getAtomData","atomData","getBondData","multipleBond","isMulti","isOffset","bondScale","bondSpacing","bondData","storeBondOrder","radius2","absOffset","multiRadius","vShortening","vShift","getBackboneAtomData","getBackboneBondData","getRungAtomData","getRungBondData","getPrincipalAxes","atomCenter","hasCoords","_hasCoords","getSequence","seq","getChainnameCount","updatePosition","refresh","refreshPosition","tmpBox","Primitives","ShapeDefaultParameters","aspectRatio","labelParams","pointSize","sizeAttenuation","useTexture","Shape","meshCount","addMesh","meshBuffer","addSphere","addEllipsoid","addTorus","addCylinder","addCone","addArrow","addBox","addOctahedron","addTetrahedron","addIcosahedron","addText","addPoint","addWideline","addLabel","getBufferList","buffers","BufferRepresentation","GeometryBuffer","geoPosition","geoIndex","meshPosition","meshNormal","meshColor","meshIndex","updateNormals","geoNormal","positionCount","geoPositionCount","transformedGeoPosition","transformedGeoNormal","makeIndex","initNormals","makeTranslation","applyPositionTransform","getNormalMatrix","o3","SphereGeometryBufferDefaultParameters","SphereGeometryBuffer","IcosahedronGeometry","_radius","MappedBuffer","mappingType","indexSize","mapping","mappingSize","mappingIndicesSize","nullValueAttributes","getAttributeIndex","dataIndex","makeMapping","mappingItemSize","aMapping","mappingIndices","it","MappedQuadBuffer","SphereImpostorBuffer","SphereBuffer","x0","y0","y1","PointBufferDefaultParameters","alphaTest","edgeBleach","PointBufferParameterTypes","PointBuffer","makeTexture","DataTexture","makePointTexture","USE_SIZEATTENUATION","USE_MAP","USE_ALPHATEST","DotRepresentation","thresholdType","thresholdMin","thresholdMax","thresholdOut","dotType","radiusType","deviation","dotData","dotBuffer","quadIndices","quadUvs","ImageBufferDefaultParameters","ImageBufferParameterTypes","ImageBuffer","alwaysTransparent","hasWireframe","imageData","flipY","pickingTex","pickingMap","mapSize","startsWith","CUBIC_INTERPOLATION","endsWith","BSPLINE_FILTER","CATMULROM_FILTER","MITCHELL_FILTER","updateTexture","NormalBlending","VolumeSlice","positionType","getPositionFromCoordinate","coord","ms","setFromMatrixScale","vn","dimLen","z0","setVec","pickingArray","tMin","tMax","SliceRepresentation","linear","percent","coordinate","volumeSlice","sliceBuffer","logReprUnknown","ElementDefaultParameters","Element","statusChanged","setStatus","setName","RepresentationElementDefaultParameters","RepresentationElement","visibilityChanged","parametersChanged","setRepresentation","getType","_disposeRepresentation","hasRepresentation","removeRepresentation","toggleVisibility","setSelection","_v","ComponentDefaultParameters","Component","representationAdded","representationRemoved","reprList","annotationList","setRotation","Euler","setFromEuler","setScale","setTransform","getCenterUntransformed","makeScale","updateRepresentationMatrices","addAnnotation","annotation","eachAnnotation","removeAnnotation","removeAllAnnotations","_addRepresentation","hidden","impostor","workerDefault","ReprClass","makeRepresentation","addBufferRepresentation","removeAllRepresentations","getBoxUntransformed","getZoom","getZoomForBox","Collection","_remove","RepresentationCollection","TrajectoryElementDefaultParameters","defaultStep","defaultTimeout","defaultInterpolateType","defaultInterpolateStep","defaultMode","defaultDirection","initialFrame","TrajectoryElement","frameChanged","playerChanged","player","setFrame","Frames","coordinates","times","timeOffset","deltaTime","Superposition","atoms1","atoms2","VH","coords1","coords2","coords1t","coords2t","transformationMatrix","prepCoords","_superpose","mean1","mean2","to","invA","t4","t5","t8","t9","t11","t13","t14","t15","t17","t18","t20","t21","t23","t26","invert3x3","md","mat3x3determinant","transformMat_","tmp_1","tmp_2","mult","M1","M2","is4X4","tCoords","det","_pB","mcols","invertTrasform","mat","n4","TrajectoryPlayerDefaultParameters","interpolateType","interpolateStep","TrajectoryPlayer","traj","startedRunning","haltedRunning","_run","_previousTime","_currentTime","_currentStep","frameCount","_currentFrame","_direction","_animate","isRunning","dt","inProgress","_nextInterpolated","hasFrame","ip","ipp","ippp","setFrameInterpolated","loadFrame","_next","currentFrame","play","setPlayer","Trajectory","trajPath","frameCache","loadQueue","boxCache","pathCache","frameCacheSize","_frameCount","_disposed","centerPbc","removePbc","removePeriodicity","superpose","selectionIndices","_resetCache","_saveInitialCoords","setStructure","_loadFrameCount","backboneIndices","_getIndices","_makeAtomIndices","_saveStructureCoords","initialCoords","structureCoords","_makeSuperposeCoords","resetCache","_updateStructure","_interpolate","fc","cpp","cppp","j0","interpolateSpline","interpolateLerp","iList","_loadFrame","_doSuperpose","_process","_setFrameCount","box2","circMean","circularMean3","arrayMean3","getFrameTime","FramesTrajectory","StructureTrajectory","RemoteTrajectory","request","getFrameUrl","getFrameParams","setRequestHeader","arrayBuffer","getCountUrl","CallbackTrajectory","requestCallback","StructureView","seleList","parentSelection","ignoreView","blosum62x","prepareMatrix","cellNames","matDict","rowDict","SubstitutionMatrices","blosum62","Alignment","seq1","seq2","gapPenalty","gapExtensionPenalty","substMatrix","initMatrices","score","ali","gap","makeScoreFn","calc","gap0","scoreFn","Vi1","Si1","Hi","Si","ali1","ali2","_s1","_s2","_i","_j","aliIdx1","aliIdx2","_atoms1","_atoms2","StructureComponentDefaultParameters","defaultAssembly","StructureComponent","trajList","trajectoryAdded","trajectoryRemoved","defaultAssemblyChanged","initSelection","pickBuffer","pointer","item","createRingBuffer","pickDict","del","values","createSimpleDict","spacefillRepresentation","addRepresentation","distanceRepresentation","angleRepresentation","dihedralRepresentation","measureRepresentations","setDefaultAssembly","structureView","rebuildRepresentations","rebuildTrajectories","reprParams","trajComp","reprComp","measureUpdate","addTrajectory","trajSrc","makeTrajectory","removeTrajectory","getAtomRadius","pickCount","lastPick","atomList","atomListSorted","atomPair","atomTriple","atomQuad","measureBuild","measureData","dihedral","pickData","radiusData","removeAllMeasurements","pd","removeMeasurement","addMeasurement","SurfaceComponent","VolumeComponent","ComponentCollection","matchName","tmpZoomVector","StageDefaultParameters","mousePreset","Stage","fullscreenChanged","componentAdded","componentRemoved","compList","defaultFileParams","logList","pickingBehavior","mouseBehavior","animationBehavior","keyBehavior","spinAnimation","rockAnimation","setQuality","setImpostor","defaultFileRepresentation","BU1","assembly","sizeScore","backboneOnly","radiusScale","surfaceType","probeRadius","lineOnly","loadFile","promise","addComponentFromObject","defaultRepresentation","errorMsg","loadScript","script","addComponent","CompClass","removeComponent","removeAllComponents","toggleFullscreen","fullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled","msFullscreenEnabled","getFullscreenElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","resizeElement","lastFullscreenElement","dataset","normalWidth","normalHeight","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","screen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","setSpin","setRock","pclamp","bbSize","minSize","aspectFactor","catch","impostorTypes","eachComponent","getComponentsByName","getRepresentationsByName","sc","ShapeComponent","__decorate","decorators","desc","getOwnPropertyDescriptor","Reflect","decorate","__awaiter","thisArg","_arguments","generator","fulfilled","rejected","adopt","SuppressedError","AtomindexColormaker","scalePerModel","BfactorColormaker","bfactorScale","ChainidColormaker","chainidDictPerModel","chainidDict","ChainindexColormaker","ChainnameColormaker","chainnameDictPerModel","chainnameDict","DensityfitColormaker","rsrzDict","rsccDict","rsrzScale","rsccScale","rsrz","rscc","partialCharges","CZ","CG","OD1","CB","OD2","OE1","OE2","CD2","CE1","ND1","NE2","NZ","SD","PTR","O1P","O2P","O3P","OG1","SEP","TPO","CD1","CE2","CE3","NE1","OH","ElectrostaticColormaker","hCharges","charges","hPositions","hPos","backboneNHPosition","bbox","hStore","buildStoreLike","hHash","ElementColors","UUT","UUP","UUH","ElementColormaker","EntityindexColormaker","entityindexScale","EntitytypeColormaker","entityType","GeoqualityColormaker","geoAtomDict","geoDict","geoProblemCount","geoAtom","atomProblems","HydrophobicityColormaker","resHF","defaultResidueHydrophobicity","hfScale","ModelindexColormaker","modelindexScale","MoleculetypeColormaker","OccupancyColormaker","occupancyScale","PartialchargeColormaker","partialchargeScale","randomColor","RandomColormaker","RandomcoilindexColormaker","rciDict","rciScale","rci","ResidueindexColormaker","scalePerChain","ResidueColors","ASX","GLX","DA","DG","DI","DX","DC","DT","DU","DD","ResnameColormaker","StructureColors","SstrucColormaker","StructuredataColormaker","UniformColormaker","valueColor","ValueColormaker","valueScale","VolumeColormaker","nxy","i1y","i1z","iyz","i1yz","vy","vz","v1y","v1z","vyz","v1yz","xd","c00","c01","c10","c11","c0","StructureRepresentation","radiusSize","biomolOptions","defaultScale","setRadius","getQuality","getAssembly","needsBuild","sview","createData","updateData","getRadiusParams","param","getAtomParams","getBondParams","MeasurementRepresentation","labelVisible","labelFontFamily","monospace","serif","labelFontStyle","italic","labelFontWeight","bold","labelsdf","labelXOffset","labelBackground","labelBackgroundColor","labelBackgroundMargin","labelBackgroundOpacity","labelFixedSize","labelFontstyle","textData","textBuffer","getLabelBufferParams","fontStyle","fontWeight","sdf","xOffset","attachment","showBorder","borderColor","borderWidth","showBackground","backgroundMargin","backgroundOpacity","fixedSize","parseNestedAtoms","nSets","order","selected","_break","Number","isInteger","calcArcPoint","edt","edt1d","MIN_SAFE_INTEGER","MAX_SAFE_INTEGER","TextAtlasCache","TextAtlasDefaultParams","font","variant","weight","TextAtlas","mapped","scratchW","scratchH","currentX","currentY","cutoff","lineHeight","maxWidth","willReadFrequently","fillStyle","textAlign","textBaseline","lineJoin","gridOuter","gridInner","canvas2","context2","placeholder","CanvasTexture","draw","measureText","clearRect","fillText","TextBufferDefaultParameters","fontSize","TextBufferParameterTypes","getCharCount","charCount","TextBuffer","fontTexture","inputTexCoord","inputSize","aPosition","aColor","txt","iChar","nChar","iCharAll","textAtlas","getTextAtlas","inputMapping","xadvance","xShift","yShift","texWidth","texHeight","texCoords","FIXED_SIZE","WideLineBufferDefaultParameters","WideLineBufferParameterTypes","WideLineBuffer","AngleRepresentation","vectorVisible","sectorVisible","atomPosition","okay","outPosition","outIdx","validatePositions","atomTriplePositions","angleData","labelPosition","labelText","vectorPosition1","vectorPosition2","arcPositionTmp1","arcPositionTmp2","sectorPositionTmp","totalSegments","v21","v23","cross2","labelTmp","arcPoint","crossLength","toFixed","nSegments","sectorVertices","arcVertices1","arcVertices2","appendArcSection","arcSize","sectorSize","arcPosition1","arcPosition2","sectorPosition","sectorOffset","arcOffset","getAngleData","vectorBuffer","arcLength","arcBuffer","sectorLength","sectorBuffer","vectorData","arcData","sectorData","eye","CylinderGeometryBufferDefaultParameters","getGeo","makeRotationX","CylinderGeometry","CylinderGeometryBuffer","geoLength","__center","_color","_from","_to","meshData","MappedAlignedBoxBuffer","CylinderImpostorBufferDefaultParameters","CylinderImpostorBufferParameterTypes","CylinderImpostorBuffer","CAP","CylinderBuffer","AxesRepresentation","showAxes","showBox","getAxesData","pa","en","vertexPosition","vertexColor","vertexRadius","edgePosition1","edgePosition2","edgeColor","edgeRadius","addAxis","offset2","addCorner","d3","addScaledVector","edgeOffset","addEdge","edge","axesData","sphereBuffer","cylinderBuffer","sphereData","cylinderData","BallAndStickRepresentation","cylinderOnly","symmetric","lineBuffer","lineData","BackboneRepresentation","BaseRepresentation","Interpolator","vec1","vec2","vDir","vTan","vNorm","vBin","interpolateToArr","interpolateToVec","interpolatePosition","interpolateTangent","vectorSubdivide","interpolationFn","iterator","getTangent","interpolateNormalDir","u0","u1","u2","u3","norm","bin","interpolateNormal","getNormalDir","iterDir1","iterDir2","vSub1","vSub2","vSub3","vSub4","d1v1","d1v2","d1v3","d1v4","d2v1","d2v2","d2v3","d2v4","interpolateColor","item1","item2","colFn","interpolatePicking","pickFn","interpolateSize","sizeFn","Spline","directional","positionIterator","subdiv","smoothSheet","interpolator","getAtomIterator","cache2","apPrev","apNext","getSubdividedColor","nCol","getSubdividedPicking","getSubdividedPosition","getSubdividedOrientation","normals","getNormals","tangent","binormal","getSubdividedSize","nSize","nPos","nTan","nNorm","vTangent","vMeshNormal","TubeMeshBufferDefaultParameters","capped","TubeMeshBuffer","capVertices","capTriangles","xi","size2","meshPrimitiveId","normX","normY","normZ","biX","biY","biZ","posX","posY","posZ","cxArr","cyArr","cx1Arr","cy1Arr","cx2Arr","cy2Arr","cx1","cy1","cx2","cy2","radialSegments1","irs","irs1","strip","CartoonRepresentation","NaN","getSplineParams","getSpline","getAspectRatio","polymerList","subPos","subOri","subCol","subPick","subSize","ContactRepresentation","angstrom","dataParams","contactData","unit","getLabelData","DihedralRepresentation","extendLine","lineVisible","dihedralData","lineTmp1","lineTmp2","sectorTmp","planeTmp","totalLines","totalPlanes","p4","v34","inPlane1","inPlane2","improperStart","improperEnd","nLines","nPlanes","line1","line2","sector","plane","li","nSuccess","linePosition1","linePosition2","planePosition","lineOffset","planeOffset","lp1","lp2","pp","getDihedralData","lineLength","lineColor","planeLength","planeBuffer","planeData","createUpdatedObject","updateSource","hasKey","obj","createColorArray","arrayLength","targetArray","DihedralHistogramRepresentation","histogramsData","histogramBinBorderVisible","scaleBinToSectorArea","histogramBinBorderColor","adjacentBondArrowColor","distantBondArrowColor","frontHistogramColor","backHistogramColor","opaqueMiddleDiscColor","histogramOpacity","opaqueMiddleDiscVisible","opaqueMiddleDiscOpacity","histogramBinBorderWidth","histogramBinBorderOpacity","bondArrowVisible","bondArrowWidth","bondArrowOpacity","specificColorData","getHistogramBinBorderBufferParameters","getBondArrowsBufferParameters","getOpaqueMiddleDiscBufferParameters","getHistogramBufferParameters","atomPositions","scaleData","Float32Concat","arrays","lengths","accumulatedOffset","createWideLineBuffer","linesList","startPoints","endPoints","startColors","endColors","createMeshBuffer","triangleColors","histogram360Scaled","histogram360","dihedralDataArray","currentHistogramData","calculateDihedralHistogram","frontHistogramBinBordersBuffer","frontHistogramBinBorders","backHistogramBinBordersBuffer","backHistogramBinBorders","adjacentBondArrowsBuffer","adjacentBondArrows","distantBondArrowsBuffer","distantBondArrows","opaqueMiddleDiscBuffer","opaqueMiddleDisc","frontHistogramBuffer","frontHistogram","backHistogramBuffer","backHistogram","histogramData","positionOfDihedralAtoms","histogram","totalSectorTrianglesInOpaqueMiddleDisc","frontAndBack","v32","cross1","dihedralAtomVectors","absAngle","maxHist","histBinAngleStep","setHistogramBinCoordinates","ind","zeroDegreeVector","crossVector","startOffset","scalingFactor","setOneSideHistogram","discHistogram","binBorders","sectionIndex","opaqueCircleSectorAngleStep","DistanceRepresentation","useCylinder","getDistanceData","pair","distanceData","bondParams","distanceBuffer","VectorBufferDefaultParameters","VectorBuffer","HelixorientRepresentation","LicoriceRepresentation","MappedBoxBuffer","HyperballStickImpostorBufferDefaultParameters","shrink","HyperballStickImpostorBufferParameterTypes","HyperballStickImpostorBuffer","HyperballStickBuffer","calculateMinArray","HyperballRepresentation","stickData","LabelFactory","errorLogged","atomLabel","aa1","res","qualified","LabelRepresentation","labelType","labelFormat","labelGrouping","getTextData","labelFactory","positionN","sizeN","colorN","getLoneAtomSet","LineRepresentation","crosses","lone","all","crossSize","_crossData","crossData","attrSize","cPosition1","cPosition2","cColor","cColor2","cOffset","cimax","crossBuffer","bufferIdx","lineAttributes","crossAttributes","makeGrid","DataCtor","elemSize","EDTSurface","coordList","pLength","pWidth","pHeight","ptran","depty","widxz","cutRadius","setAtomID","vpBits","vpDistance","vpAtomID","btype","_probeRadius","_scaleFactor","_cutoff","_setAtomID","boundingatom","INOUT","ISDONE","ISBOUND","txz","tdept","sradius","tradius","widxzR","deptyName","indx","fillatom","ox","oy","oz","mj","mk","sk","ii","jj","kk","deptyAtNind","deptyAt","nind","pWH","ci2","fillvoxels","fillAtomWaals","fastdistancemap","boundPoint","cutRSq","totalsurfacevox","inarray","positin","outarray","positout","fastoneshell","cutoffSq","tx","ty","tz","square","nbj","tnvix","tnviy","tnviz","getVolume","tk","buildboundary","fillvoxelswaals","stype","marchingcubeinit","vd","makeAVHash","atomsX","atomsY","atomsZ","atomsR","nAtoms","hashFunc","minW","iDim","jDim","kDim","nCells","jkDim","preHash","cid","cellOffsets","cellLengths","maxCellLength","subArray","cellLength","neighbourListLength","withinRadii","rExtra","nearI","nearJ","nearK","loI","loJ","loK","hiI","hiJ","hiK","iOffset","jOffset","cellStart","cellEnd","rSum","AVSurface","probePositions","gridx","gridy","gridz","sinTable","cosTable","lastClip","atob","ngTorus","_probePositions","rExt","surfGrid","fillGridDim","initializeGrid","initializeAngleTables","obscured","singleAtomObscures","ra2","projectPoints","ar","ar2","ng","iax","iay","iaz","minx","miny","minz","maxx","maxy","maxz","xoffset","dxy2","xyoffset","spx","spy","spz","dd","projectTorus","dmp","normalToLine","rInt","cost","sint","px","py","pz","projectTorii","fixNegatives","fixAtomIDs","MolecularSurface","_getAtomData","MolecularSurfaceRepresentation","vws","sas","ses","av","__infoList","__forceNewMolsurf","prepareData","molsurf","sviewFilter","maxDim","asWithin","getSurfaceParams","__sele","__surfaceParams","after","contourBuffer","doubleSidedBuffer","PointRepresentation","pointData","RibbonBuffer","aNormal","aSize","aDir","aPrimitiveId","currSize","prevSize","RibbonRepresentation","RocketRepresentation","axisList","helixbundleList","helixbundle","axisData","RopeRepresentation","SpacefillRepresentation","TraceBuffer","linePosition","TraceRepresentation","TubeRepresentation","UnitcellRepresentation","defaultRadius","cbrt","getUnitcellData","unitcellData","ValidationRepresentation","clashData","getClashData","ConeBufferDefaultParameters","ConeBuffer","ConeGeometry","_position1","_position2","GeometryGroup","geometryList","empty","ArrowBufferDefaultParameters","ArrowBuffer","splitPosition","cylinderRadius","makeAttributes","coneBuffer","vFrom","vTo","vSplit","fullLength","coneLength","BoxBuffer","BoxGeometry","_heightAxis","_depthAxis","_size","EllipsoidBufferDefaultParameters","EllipsoidBuffer","_majorAxis","_minorAxis","IcosahedronBuffer","OctahedronBuffer","OctahedronGeometry","TetrahedronBuffer","TetrahedronGeometry","TorusBufferDefaultParameters","radiusRatio","tubularSegments","TorusBuffer","TorusGeometry","getArrayBounds","rowCount","createArray","createAndFillArray","_e","fillArrayValues","isTypedArray","BYTES_PER_ELEMENT","typedArrayWindow","equalEps","quadraticBezier","_isFinite","Vec3","zero","scaleAndAdd","squaredMagnitude","hasNaN","setNaN","fromObj","toObj","ofArray","mul","div","scaleAndSub","addScalar","subScalar","trunc","squaredDistance","magnitude","setMagnitude","inverse","slerpRelVec","_clamp","hermite","factorTimes2","factor1","factor2","factor3","factor4","bezier","inverseFactor","inverseFactorTimesTwo","_quadraticBezier","_spline","zScale","transformMat4","transformDirection","transformMat4Offset","outO","aO","oM","transformDirectionOffset","transformMat3","transformQuat","qx","qw","iw","tmp_dh_ab","tmp_dh_cb","tmp_dh_bc","tmp_dh_dc","tmp_dh_abc","tmp_dh_bcd","tmp_dh_cross","dihedralAngle","_angle","directionFromSpherical","inclination","azimuth","exactEquals","a0","b0","b1","rotTemp","makeRotation","Mat4","setIdentity","fromScaling","negUnit","fromRotation","isZero","tmpProjectPlane","projectPointOnPlane","tmpProject","orthogonalize","matchDirection","triangleNormalTmpAB","triangleNormalTmpAC","triangleNormal","unitX","unitY","unitZ","negUnitX","negUnitY","negUnitZ","PiDiv180","Mat3","Vec2","Vec4","assertUnreachable","Quat","Tensor","Column","BitFlags","StringBuilder","_start","neg","parseScientific","main","constColumn","schema","valueKind","__array","isDefined","ColumnHelpers.createArray","areValuesEqual","rowA","rowB","lambdaColumn","arrayColumn","valueType","isTyped","ColumnHelpers.isTypedArray","ColumnHelpers.getArrayBounds","ColumnHelpers.typedArrayWindow","windowColumn","column","vk","windowTyped","ave","windowFull","Undefined","columnView","checkIdentity","arrayView","viewFull","arrayLess","arraySwap","temp","medianPivotIndex","partition","parts","tail","insertionSort","quickSort","partitionArrayAsc","insertionSortArrayAsc","quickSortArrayAsc","sortArrayRange","identity","setZero","ofRows","_id","areEqual","getRotation","tryInvert","a00","a01","a02","a03","a10","a20","a30","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b3","getValue","fromBasis","getTranslation","getScaling","m31","m32","m33","scaleX","scaleY","scaleZ","mulOffset","oOut","oA","oB","mul3","fromTranslation","setTranslation","setAxes","b20","scaleUniformly","fromUniformScaling","fromMat3","compose","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","sx","sy","sz","_v3","_m4","invSX","invSY","invSZ","makeTable","isRotationAndTranslation","_isRotationAndTranslation","isTranslationAndUniformScaling","_isTranslationAndUniformScaling","fromQuat","yx","zx","zy","fromEuler","euler","ae","af","be","bf","ce","cf","de","df","ac","bc","perspective","z1","eyex","eyey","eyez","upx","upy","upz","centerx","centery","centerz","targetTo","fromPermutation","perm","scaleXSq","scaleYSq","scaleZSq","xAxis","yAxis","zAxis","rotX90","rotX180","rotY90","rotY180","rotY270","rotZ90","rotZ180","rotXY90","rotZY90","rotZYZ90","rotZ90X180","rotY90Z180","fromMat4","fromColumns","middle","mulScalar","symmtricFromUpper","symmtricFromLower","piThird","tmpB","symmetricEigenvalues","Identity","phi","tmpR0","tmpR1","tmpR2","tmpR0xR1","tmpR0xR2","tmpR1xR2","eigenvector","d0","dmax","imax","directionTransform","innerProduct","fromSphere","ofSphere","toVec3Array","fromVec3Array","squaredNorm","setAxisAngle","omega","cosom","sinom","scale0","scale1","bw","fTrace","fRoot","getAxisAngle","out_axis","rotateX","rotateY","rotateZ","calculateW","invDot","conjugate","c3","s3","fromUnitVec3Temp","fromUnitVec3","rotTmpVec3","rotTmpVec3UnitX","rotTmpVec3UnitY","rotationTo","sqlerpTemp1","sqlerpTemp2","sqlerp","axesTmpMat","Space","dimensions","axisOrderSlowToFast","ctor","layout","axisOrderFastToSlow","accessDimensions","defaultCtor","Layout","dataOffset","getCoords","accessors","rank","creator","uv","ds","acc","reorder","xs","space","Data1","Vector","ColumnMajorMatrix","RowMajorMatrix","toMat4","toMat3","toVec3","toVec4","areEqualExact","invertAxisOrder","convertToCanonicalAxisIndicesFastToSlow","convertToCanonicalAxisIndicesSlowToFast","Schema","ofLambda","spec","baseType","ustr","lstr","Str","Int","Float","Tensors","Aliased","List","separator","itemParse","is","ValueKind","Present","NotPresent","Unknown","ofConst","range","ofIntArray","ofFloatArray","ofStringArray","ofStringAliasArray","ofStringListArray","ofIntTokens","fastParseInt","ofFloatTokens","fastParseFloat","ofStringTokens","checkIndentity","createFirstIndexMap","createFirstIndexMapOfColumn","createIndexer","createIndexerOfColumn","mapToArray","mapToArrayImpl","ys","areArraysEqual","areColumnsEqual","indicesOf","columnIndicesOf","asArrayColumn","copyToArray","cArray","flags","hasAll","toCheck","chunkCapacity","builder","getChunks","__paddingSpaces","whitespace","writeSafe","whitespace1","write","writePadLeft","totalWidth","writePadRight","writeInteger","writeIntegerAndSpace","writeIntegerPadLeft","writeIntegerPadRight","writeFloat","precisionMultiplier","writeFloatPadLeft","writeFloatPadRight","perf","process","hrtime","UUID","Mask","ValueRef","_ascSort","idFactory","firstId","maxId","_nextId","_btoa","btoa","create22","createv4","EmptyMask","SingletonMask","BitMask","mask","_forEach","AllMask","SetMask","_flat","sortAsc","ofSet","ofMask","always","never","singleton","ofUniqueIndices","hasAny","complement","against","ref","getNextId","ValueBox","ValueCell","Table","Database","CifField","areValuesEqualProvider","aS","bS","CifFile","blocks","CifBlock","categoryNames","categories","saveFrames","getField","category","CifCategory","fieldNames","metadata","version","withValue","cell","updateIfChanged","table","columns","_rowCount","_columns","_schema","getRow","pickColumns","guard","ofColumns","ofPartialColumns","partialColumns","ofUndefinedColumns","ofArrays","_view","tables","columnToArray","pickRow","getRows","toArrays","formatToString","headerLength","ofTables","tableNames","_tableNames","getTablesAsRows","database","ofFields","ofTable","ofColumn","ofStrings","binaryEncoding","toStringArray","ColumnHelpers.createAndFillArray","toIntArray","toFloatArray","ofString","ofNumbers","ofTokens","ofUndefined","immediateActions","setImmediate","handler","clearImmediate","handle","thisGlobal","_window","_self","WorkerGlobalScope","_global","global","tasksByHandle","doc","registerImmediate","nextHandle","runIfPresent","task","nextTick","importScripts","postMessageIsAsynchronous","oldOnMessage","canUsePostMessage","messagePrefix","onGlobalMessage","source","attachEvent","installPostMessageImplementation","MessageChannel","channel","port1","port2","installMessageChannelImplementation","html","documentElement","onreadystatechange","installReadyStateChangeImplementation","createImmediateActions","resolveImmediate","Scheduler","immediatePromise","delay","env","NODE_ENV","DEBUG","timingEnabled","measure","UserTiming","ExecuteObservable","observer","updateRateMs","abortToken","abortRequested","treeAborted","reason","lastNotified","taskId","root","progress","defaultProgress","tryAbort","createAbortFunction","ProgressInfo","execute","ObservableRuntimeContext","taskName","startedTime","canAbort","isIndeterminate","token","cloneTree","async","markStart","markEnd","abort","Task","isAbort","isAborted","onChildrenFinished","onAbort","abortTree","notifyObserver","Aborted","snapshot","requestAbort","snapshotProgress","startMarkName","endMarkName","checkAborted","shouldUpdate","lastUpdatedTime","updateProgress","dontNotify","runChild","isSynchronous","isExecuting","SyncRuntimeContext","RuntimeContext","Progress","TokenBuilder","ReaderResult","Encoding","chunkedSubtask","initialChunk","globalProcessed","globalTime","lastSize","Tokenizer","lineNumber","tokenStart","tokenEnd","eatValue","isTripleQuoteAtPosition","isNamespace","nsLen","tokenLen","getNamespaceEnd","getNamespace","endIndex","getTokenString","moveNextInternal","prev","skipWhitespace","tokenType","isEscaped","skipCommentLine","eatTripleQuote","esc","eatEscaped","eatMultiline","isImportGet","eatImportGet","inSaveFrame","isData","isSave","isLoop","moveNext","FrameContext","categoryData","CifCategories","Data.CifCategory","Data.CifBlock","CifSaveFrame","addFields","cat","handleSingle","tokenizer","nsStart","nsEnd","readingNames","fieldName","hasError","errorLine","errorMessage","Data.CifField","readLoopChunk","fieldCount","tokenCount","updateLoopChunk","handleLoop","loopLine","isFlat","isFlatNamespace","rowCountEstimate","runtimeCtx","Result","parseInternal","dataBlocks","createTokenizer","blockHeader","blockCtx","saveCtx","saveFrame","Data.CifSaveFrame","saveHeader","success","Data.CifFile","parseCifText","Impl","runAsChild","ExecuteObservableChild","runInContext","ExecuteInContext","_t","constant","fail","resolveInContext","Synchronous","_format","prefix","newPrefix","subTree","eatLine","markLine","readLinesChunk","addUnchecked","readLine","readLineTrim","markLines","lineTokens","readLines","readLinesAsync","initialLineCount","linesAlreadyRead","linesToRead","readAllLines","readAllLinesAsync","readLinesChunkChecked","indicesLenMinus2","newBuffer","addToken","warnings","Success","isError","IntDataType","FloatDataType","getDataType","srcType","Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","isSignedIntegerDataType","IsNativeEndianLittle","decode","encoding","decodeStep","kind","int8","int16","uint16","int32","uint32","float32","float64","getFloatArray","fixedPoint","numSteps","intervalQuantization","getIntArray","srcSize","runLength","isUnsigned","upperLimit","byteCount","integerPackingUnsigned","lowerLimit","integerPackingSigned","integerPacking","offsets","offsetEncoding","dataEncoding","stringData","strings","stringArray","byteSize","flipByteOrder","ChunkedArray","IntClassifier","FloatClassifier","ArrayEncoder","ArrayEncoding","getMantissaMultiplier","maxDigits","mv","classifyIntArray","classify","allocateNext","nextSize","growBy","currentSize","currentIndex","currentChunk","allocatedSize","_compact","doNotResizeSingleton","lastChunk","add4","elementCount","add3","add2","addRepeat","addMany","compact","initialChunkOrCount","packSize","incSize","limit8","limit16","pack8","pack16","incSizeSigned","elem","packingSize","deltaSize","rleSize","deltaRleSize","prevValue","signed","getInfo","sizes","byteArray","mantissaDigits","integerDigits","log10","getArrayDigitCount","multiplier","getMultiplier","intArray","fp","ArrayEncoderImpl","providers","encode","encodings","getProvider","intervalQuantizaiton","fromEncoding","writers","byteSizes","uint8","packingSizeUnsigned","packingSizeSigned","_fixedPoint","_intervalQuantizaiton","packing","isSigned","size8","size16","bytesPerElement","determinePacking","packed","_integerPacking","accLength","encodedOddsets","encodedData","__chars","throwError","err","utf8Decoder","TextDecoder","utf8Read","chunkOffset","byte","_utf8Read","dataView","Category","isNumeric","Field","parseCifBinary","minVersion","unpacked","checkVersions","block","cats","FieldPath","toDatabase","aliases","createTable","createDatabase","getColumnCtor","createStringColumn","createColumn","createListColumn","arr1","arr2","arrayEqual","createTensorColumn","zeroOffset","fst","namingVariant","getName","zeroIndexed","Data.tensorFieldNameGetter","Data.getTensor","canonical","equal","pathA","pathB","asCanonical","CategoryTable","_isDefined","fieldKeys","fType","enumerable","configurable","flatFrame","canonicalPath","aliased","canonicalAliased","flattenFrame","mmCIF_Schema","atom_site","auth_asym_id","auth_atom_id","auth_comp_id","auth_seq_id","B_iso_or_equiv","Cartn_x","Cartn_y","Cartn_z","group_PDB","label_alt_id","label_asym_id","label_atom_id","label_comp_id","label_entity_id","label_seq_id","type_symbol","pdbx_PDB_ins_code","pdbx_PDB_model_num","pdbx_formal_charge","pdbx_label_index","pdbx_sifts_xref_db_name","pdbx_sifts_xref_db_acc","pdbx_sifts_xref_db_num","pdbx_sifts_xref_db_res","ihm_model_id","atom_site_anisotrop","U_esd","pdbx_auth_seq_id","pdbx_auth_asym_id","pdbx_auth_atom_id","pdbx_auth_comp_id","pdbx_label_seq_id","pdbx_label_alt_id","pdbx_label_asym_id","pdbx_label_atom_id","pdbx_label_comp_id","atom_sites","entry_id","fract_transf_matrix","fract_transf_vector","audit_author","pdbx_ordinal","identifier_ORCID","audit_conform","dict_location","dict_name","dict_version","angle_alpha","angle_beta","angle_gamma","length_a","length_b","length_c","Z_PDB","pdbx_unique_axis","chem_comp","formula","formula_weight","mon_nstd_flag","pdbx_synonyms","chem_comp_bond","atom_id_1","atom_id_2","comp_id","value_order","pdbx_stereo_config","pdbx_aromatic_flag","citation","book_publisher","country","journal_abbrev","journal_id_ASTM","journal_id_CSD","journal_id_ISSN","journal_volume","page_first","page_last","year","pdbx_database_id_DOI","pdbx_database_id_PubMed","citation_author","citation_id","ordinal","database_2","database_id","database_code","details","src_method","pdbx_description","pdbx_number_of_molecules","pdbx_mutation","pdbx_fragment","pdbx_ec","entity_poly","entity_id","nstd_linkage","nstd_monomer","pdbx_strand_id","pdbx_seq_one_letter_code","pdbx_seq_one_letter_code_can","pdbx_target_identifier","entity_poly_seq","mon_id","num","entry","exptl","method","software","classification","date","description","struct","pdbx_descriptor","struct_asym","pdbx_modified","pdbx_blank_PDB_chainid_flag","struct_conf","beg_label_asym_id","beg_label_comp_id","beg_label_seq_id","beg_auth_asym_id","beg_auth_comp_id","beg_auth_seq_id","conf_type_id","end_label_asym_id","end_label_comp_id","end_label_seq_id","end_auth_asym_id","end_auth_comp_id","end_auth_seq_id","pdbx_beg_PDB_ins_code","pdbx_end_PDB_ins_code","pdbx_PDB_helix_class","pdbx_PDB_helix_length","pdbx_PDB_helix_id","struct_conn","conn_type_id","ptnr1_label_asym_id","ptnr1_label_atom_id","ptnr1_label_comp_id","ptnr1_label_seq_id","ptnr1_auth_asym_id","ptnr1_auth_comp_id","ptnr1_auth_seq_id","ptnr1_symmetry","ptnr2_label_asym_id","ptnr2_label_atom_id","ptnr2_label_comp_id","ptnr2_label_seq_id","ptnr2_auth_asym_id","ptnr2_auth_comp_id","ptnr2_auth_seq_id","ptnr2_symmetry","pdbx_ptnr1_PDB_ins_code","pdbx_ptnr1_label_alt_id","pdbx_ptnr1_standard_comp_id","pdbx_ptnr2_PDB_ins_code","pdbx_ptnr2_label_alt_id","pdbx_ptnr3_PDB_ins_code","pdbx_ptnr3_label_alt_id","pdbx_ptnr3_label_asym_id","pdbx_ptnr3_label_atom_id","pdbx_ptnr3_label_comp_id","pdbx_ptnr3_label_seq_id","pdbx_PDB_id","pdbx_dist_value","pdbx_value_order","struct_conn_type","criteria","reference","struct_keywords","pdbx_keywords","struct_ncs_oper","struct_sheet_range","sheet_id","struct_site","pdbx_num_residues","pdbx_evidence_code","pdbx_auth_ins_code","struct_site_gen","site_id","symmetry","pdbx_num_res","cell_setting","Int_Tables_number","space_group_name_Hall","pdbx_database_status","status_code","status_code_sf","status_code_mr","recvd_initial_deposition_date","SG_entry","deposit_site","process_site","status_code_cs","methods_development_category","pdb_format_compatible","pdbx_nonpoly_scheme","asym_id","pdb_strand_id","ndb_seq_num","pdb_seq_num","auth_seq_num","pdb_mon_id","auth_mon_id","pdb_ins_code","pdbx_database_related","db_name","db_id","content_type","pdbx_entity_nonpoly","pdbx_chem_comp_synonyms","provenance","pdbx_chem_comp_identifier","identifier","program_version","pdbx_unobs_or_zero_occ_residues","polymer_flag","occupancy_flag","PDB_model_num","PDB_ins_code","pdbx_struct_mod_residue","parent_comp_id","pdbx_struct_oper_list","symmetry_operation","pdbx_struct_assembly","method_details","oligomeric_details","oligomeric_count","pdbx_struct_assembly_gen","asym_id_list","assembly_id","oper_expression","pdbx_reference_entity_list","prd_id","ref_entity_id","component_id","pdbx_reference_entity_link","link_id","ref_entity_id_1","ref_entity_id_2","entity_seq_num_1","entity_seq_num_2","comp_id_1","comp_id_2","component_1","component_2","link_class","pdbx_reference_entity_poly_link","pdbx_molecule","instance_id","pdbx_molecule_features","class","entity_src_nat","pdbx_organism_scientific","pdbx_plasmid_name","pdbx_src_id","pdbx_beg_seq_num","pdbx_end_seq_num","entity_src_gen","pdbx_gene_src_gene","pdbx_gene_src_scientific_name","plasmid_name","pdbx_entity_src_syn","organism_scientific","pdbx_entity_branch_descriptor","pdbx_entity_instance_feature","feature_type","seq_num","pdbx_entity_branch_list","pdbx_entity_branch_link","entity_branch_list_num_1","entity_branch_list_num_2","leaving_atom_id_1","atom_stereo_config_1","leaving_atom_id_2","atom_stereo_config_2","pdbx_entity_branch","pdbx_branch_scheme","pdb_asym_id","pdbx_chem_comp_related","related_comp_id","relationship_type","ihm_starting_model_details","starting_model_id","entity_description","entity_poly_segment_id","starting_model_source","starting_model_auth_asym_id","starting_model_sequence_offset","dataset_list_id","ihm_starting_comparative_models","starting_model_seq_id_begin","starting_model_seq_id_end","template_auth_asym_id","template_seq_id_begin","template_seq_id_end","template_sequence_identity","template_sequence_identity_denominator","template_dataset_list_id","alignment_file_id","ihm_starting_model_seq_dif","seq_id","db_asym_id","db_seq_id","db_comp_id","ihm_model_representation","ihm_model_representation_details","representation_id","entity_asym_id","model_object_primitive","model_mode","model_granularity","model_object_count","ihm_struct_assembly_details","parent_assembly_id","ihm_struct_assembly","ihm_modeling_protocol","num_steps","protocol_name","ihm_modeling_protocol_details","protocol_id","step_id","struct_assembly_id","dataset_group_id","struct_assembly_description","step_name","step_method","num_models_begin","num_models_end","multi_scale_flag","multi_state_flag","ordered_flag","script_file_id","software_id","ihm_multi_state_modeling","state_id","state_group_id","population_fraction","population_fraction_sd","state_type","state_name","experiment_type","ihm_modeling_post_process","analysis_id","feature","ihm_ensemble_info","ensemble_id","ensemble_name","post_process_id","model_group_id","ensemble_clustering_method","ensemble_clustering_feature","num_ensemble_models","num_ensemble_models_deposited","ensemble_precision_value","ensemble_file_id","ihm_model_list","model_id","model_name","ihm_model_group","ihm_model_group_link","group_id","ihm_model_representative","selection_criteria","ihm_dataset_list","data_type","database_hosted","ihm_dataset_group","application","ihm_dataset_group_link","ihm_related_datasets","dataset_list_id_derived","dataset_list_id_primary","ihm_dataset_related_db_reference","accession_code","ihm_external_reference_info","reference_id","reference_provider","reference_type","refers_to","associated_url","ihm_external_files","file_path","file_size_bytes","ihm_dataset_external_reference","file_id","ihm_localization_density_files","ihm_predicted_contact_restraint","entity_id_1","entity_id_2","asym_id_1","asym_id_2","seq_id_1","seq_id_2","rep_atom_1","rep_atom_2","distance_lower_limit","distance_upper_limit","probability","restraint_type","ihm_cross_link_list","entity_description_1","entity_description_2","linker_type","ihm_cross_link_restraint","conditional_crosslink_flag","distance_threshold","psi","sigma_1","sigma_2","ihm_cross_link_result_parameters","restraint_id","ihm_2dem_class_average_restraint","number_raw_micrographs","pixel_size_width","pixel_size_height","image_resolution","image_segment_flag","number_of_projections","ihm_2dem_class_average_fitting","cross_correlation_coefficient","rot_matrix","tr_vector","ihm_3dem_restraint","fitting_method","number_of_gaussians","ihm_sas_restraint","profile_segment_flag","fitting_atom_type","fitting_state","radius_of_gyration","chi_value","ihm_starting_model_coord","ordinal_id","atom_id","ihm_sphere_obj_site","seq_id_begin","seq_id_end","object_radius","rmsf","ihm_gaussian_obj_site","mean_Cartn_x","mean_Cartn_y","mean_Cartn_z","covariance_matrix","ihm_gaussian_obj_ensemble","ihm_feature_list","feature_id","entity_type","ihm_poly_residue_feature","comp_id_begin","comp_id_end","ihm_derived_distance_restraint","feature_id_1","feature_id_2","group_conditionality","random_exclusion_fraction","ma_model_list","model_group_name","model_type","data_id","ma_target_entity","ma_target_entity_instance","ma_target_ref_db_details","target_entity_id","db_code","db_accession","seq_db_isoform","seq_db_align_begin","seq_db_align_end","ncbi_taxonomy_id","ma_data","content_type_other_details","ma_software_group","ma_qa_metric","software_group_id","ma_qa_metric_global","metric_id","metric_value","ma_qa_metric_local","CCD_Schema","mon_nstd_parent_comp_id","one_letter_code","three_letter_code","pdbx_type","pdbx_ambiguous_flag","pdbx_replaced_by","pdbx_replaces","pdbx_model_coordinates_details","pdbx_model_coordinates_db_code","pdbx_ideal_coordinates_details","pdbx_ideal_coordinates_missing_flag","pdbx_model_coordinates_missing_flag","pdbx_initial_date","pdbx_modified_date","pdbx_release_status","pdbx_processing_site","chem_comp_atom","alt_atom_id","model_Cartn_x","model_Cartn_y","model_Cartn_z","pdbx_align","pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal","pdbx_leaving_atom_flag","pdbx_chem_comp_descriptor","BIRD_Schema","pdbx_reference_molecule","type_evidence_code","class_evidence_code","represent_as","chem_comp_id","compound_details","representative_PDB_id_code","release_status","replaces","replaced_by","pdbx_reference_entity_nonpoly","pdbx_reference_entity_poly","pdbx_reference_entity_poly_seq","parent_mon_id","observed","pdbx_reference_entity_sequence","NRP_flag","one_letter_codes","pdbx_reference_entity_src_nat","taxid","pdbx_prd_audit","processing_site","action_type","dic_Schema","datablock","dictionary","datablock_id","dictionary_history","revision","sub_category","category_group_list","parent_id","item_type_list","primitive_code","construct","item_units_list","item_units_conversion","from_code","to_code","DensityServer_Data_Schema","volume_data_3d_info","axis_order","sample_rate","sample_count","spacegroup_number","spacegroup_cell_size","spacegroup_cell_angles","mean_source","mean_sampled","sigma_source","sigma_sampled","min_source","min_sampled","max_source","max_sampled","volume_data_3d","CifCore_Schema","formula_units_z","chemical","melting_point","name_common","name_systematic","chemical_formula","moiety","space_group","crystal_system","it_number","space_group_symop","operation_xyz","geom_bond","atom_site_label_1","atom_site_label_2","publ_flag","site_symmetry_1","site_symmetry_2","audit","block_doi","cod","csd","depnum_ccdc_archive","depnum_ccdc_fiz","icsd","mdf","nbs","adp_type","calc_flag","disorder_assembly","disorder_group","fract_x","fract_y","fract_z","refinement_flags","site_symmetry_multiplicity","u_iso_or_equiv","atom_site_aniso","u_11","u_12","u_13","u_22","u_23","u_33","atom_type","symbol","atom_type_scat","dispersion_imag","dispersion_real","CifCore_Aliases","Segmentation_Data_Schema","segmentation_data_table","set_id","segment_id","segmentation_data_3d","CIF","parseText","parseBinary","toDatabaseCollection","dbc","mmCIF","CCD","BIRD","dic","cifCore","densityServer","segmentation","Parser","_beforeParse","_parse","_afterParse","StructureParser","structureBuilder","Entity","chainIndexList","entityTypeFromString","entityFromType","isNonPolymer","isMacrolide","DefaultBoxParams","Unitcell","alphaRad","betaRad","gammaRad","cosAlpha","cosBeta","cosGamma","sinBeta","sinGamma","cStar","cosAlphaStar","cornerOffset","divideScalar","centerArray3","HelixTypes","dAminoAcids","entityKeyList","reWhitespace","getModresId","PdbParser","hex","isLegacy","headerLine","headerId","legacyId","isPqr","isPdbqt","serialRadix","resnoRadix","currentCoord","doFrames","currentBiomol","currentPart","currentMatrix","recordName","startChain","startResi","startIcode","endChain","endResi","endIcode","serialDict","unitcellDict","entityDataList","currentEntityData","currentEntityKey","hetnameDict","modresDict","chainDict","chainIdx","currentChainname","seqresDict","currentSeqresChainname","modelIdx","pendingStart","ls","modresId","fromIdx","toIdx","helixType","seqresChainname","keyEnd","biomt","biomtElms","ncsName","ncs","ncsRow","ncsElms","origx","orgix","origxRow","origxElms","scaleRow","scaleElms","aLength","bLength","cLength","sGroup","_parseChunkOfLines","ei","residueDict","ChemCompMap","atomsToListindex","reAtomSymbol","cif2dssp","HELX_RH_AL_P","STRN","HELX_RH_3T_P","HELX_RH_PI_P","HELX_LH_PP_P","TURN_TY1_P","BEND","OTHER","valueOrder2bondOrder","AROM","DELO","DIRECTED","DOUB","POLY","QUAD","SING","TRIP","getBondOrder","valueOrder","CifParser","parsed","cif","cca","ccb","atomnameDict","atomnameField","elementField","resnameField","resnoField","xFieldName","yFieldName","zFieldName","xField","yField","zField","asindex","atomname1Field","atomname2Field","bondOrderField","parseChemComp","typeSymbolField","fractXField","fractYField","fractZField","occField","typeSymbolMap","typeSymbol","ml","identityMatrix","covalentI","parseCore","asymIdDict","chainIndexDict","atomSite","numAtoms","modelNumField","firstModel","ccTypeField","atom1Field","atom2Field","getFieldAsFloat32","endAtom","cifField","altlocField","inscodeField","chainnameField","chainidField","heteroField","entityIdField","modelNum","_c","_d","_f","_g","_h","entityId","nbFrames","begIcode","begIcodeField","endIcodeField","helixClassField","begAsymIdField","endAsymIdField","begSeqIdField","endSeqIdField","conftypeField","dsspcode","conftype","ssr","processSecondaryStructure","valData","operDict","biomolOp","idField","mat_1_1Field","mat_1_2Field","mat_1_3Field","mat_2_1Field","mat_2_2Field","mat_2_3Field","mat_3_1Field","mat_3_2Field","mat_3_3Field","vec1Field","vec2Field","vec3Field","elms","gen","getMatrixDict","expr","es","assemblyIdField","operExpressionField","asymIds","oe","oe1","oe2","piece","md1","md2","k1","k2","ch","ncsOp","ncsPart","codeField","database_PDB_matrix","origxMat","scaleMat","processSymmetry","atomIndicesCache","connTypeIdField","ptnr1SymmetryField","ptnr1InsCodeField","ptnr1AltLocField","ptnr1SeqIdField","ptnr1AsymIdField","ptnr1AtomIdField","ptnr2SymmetryField","ptnr2InsCodeField","ptnr2AltLocField","ptnr2SeqIdField","ptnr2AsymIdField","ptnr2AtomIdField","connTypeId","inscode1","altloc1","selection1","inscode2","altloc2","selection2","processConnections","descriptionField","typeField","processEntities","_k","_l","pdbx_audit_revision_history","releaseDate","_o","depositionDate","database_PDB_rev","_p","_s","_r","reflns","refine","_u","rFree","_w","experimentalMethods","firstLines","lpos","ypos","zpos","modelLineCount","lineNo","AllFields","typedArray","getDataView","getInt8View","getInt32View","decodeInt16","i2","decodeInt32","i4","decodeInteger","divisor","invDiv","decodeRun","decodeDelta","decodePacking","int16or8","decodeIntegerPacking","decodeIntegerDeltaPacking","decodeIntegerDelta","decodeMsgpack","performDecoding","dvOut","dvIn","decodeFloat32","decodeDeltaRun","decodeMmtf","inputDict","ignoreFields","outputDict","dv","ignore","SstrucMap","groupData","numBonds","numGroups","numChains","numModels","chainsPerModel","structureId","groupsPerChain","groupList","groupTypeList","atomNameList","frameAtomOffset","xCoordList","yCoordList","zCoordList","bAtomIndex1","bAtomIndex2","bBondOrder","aGroupIndex","aFormalCharge","gChainIndex","gAtomOffset","gAtomCount","cModelIndex","cGroupOffset","cGroupCount","mChainOffset","mChainCount","modelChainCount","groupOffset","chainGroupCount","bondOffset","groupAtomCount","groupFormalChargeList","formalChargeList","groupBondAtomList","bondAtomList","groupBondOrderList","bondOrderList","atomIdList","bFactorList","altLocList","occupancyList","groupIdList","secStructList","insCodeList","chainNameList","chainIdList","groupTypeDict","groupType","elementList","hetFlag","numGroupBonds","groupName","resAtomOffset","secStructLength","bioAssemblyList","_assembly","chainToPart","transformList","_transform","ncsOperatorList","ncsAssembly","_operator","unitCell","spaceGroup","bondTypes","am","du","un","moleculeLineNo","modelAtomIdxStart","currentRecordType","reItem","SdfParser","headerLines","sdfData","mItem","atomStart","bondStart","bondEnd","currentItem","currentData","isV3000","isAtomBlock","isBondBlock","atomindexToStoreindex","chgTok","find","chargeCount","coffset","atomIdx","cToken","_postProcess","parseIntSubstr","PrmtopParser","pointersDict","pointers","atomNames","radii","residueLabels","residuePointers","curIdx","bondIdx","lt","NATOM","NBONH","MBONA","NRES","curResIdx","curResname","curResno","reTitle","lastSegid","segid","reField","molecules","moleculetypeDict","currentMoleculetype","fieldMatch","cIdx","molName","molCount","molType","lastResno","resIdx","chainidIdx","chainnameIdx","TrajectoryParser","notNetcdf","statement","TypeError","readName","nameLength","nextPos","intView","ef","isCharmm","extraBlock","fourDims","NSET","ISTART","NSAVC","NAMNF","DELTA","titleLength","titlePos","TITLE","natom","natom4","BYTE","CHAR","SHORT","INT","DOUBLE","num2str","num2bytes","str2num","readNumber","bufferReader","numbers","readType","trimNull","ZERO","NC_DIMENSION","NC_VARIABLE","NC_ATTRIBUTE","recordDimension","dimList","recordId","dimensionSize","dimensionsList","globalAttributes","attributesList","variables","varList","recordStep","variableSize","dimensionality","dimensionsIds","varSize","record","variablesList","gAttList","gAtt","NetcdfReader","hasDataVariable","variableName","findIndex","getDataVariable","variable","currentOffset","nonRecord","NctrajParser","netcdfReader","versionSize","virSize","presSize","coordSize","velocitySize","forceSize","natoms","floatSize","natoms3","frameCoords","MagicInts","sizeOfInt","numOfBits","_tmpBytes","sizeOfInts","numOfInts","numOfBytes","bytecnt","decodeBits","cbuf","buf2","lastBB0","lastBB1","cnt","_tmpIntBytes","decodeInts","nums","minMaxInt","sizeint","bitsizeint","sizesmall","thiscoord","prevcoord","lfp","lsize","bitsize","smallidx","tmpIdx","smaller","smallnum","adz","invPrecision","buf8","isSmaller","tmpSwap","VolumeParser","getMatrix","reScientificNotation","bohrToAngstromFactor","CubeParser","originX","originY","originZ","NVX","NVY","NVZ","basisX","basisY","basisZ","oribitalFlag","lj","Dsn6Parser","summand","byteView","brixStr","xStart","yStart","zStart","xExtent","yExtent","zExtent","xRate","yRate","zRate","xlen","ylen","zlen","xBlocks","yBlocks","zBlocks","nxyz","mapcrs","DxParser","headerInfo","parseHeaderLines","dataLineStart","headerByteCount","deltaLineCount","xmin","ymin","zmin","hx","hy","hz","uint8ToLines","MrcParser","floatView","MAP","MACHST","NX","NY","MODE","NXSTART","NYSTART","NZSTART","MX","MY","MZ","MAPC","MAPR","MAPS","DMIN","DMAX","ISPG","NSYMBT","LSKFLG","parseNumberLine","XplorParser","infoStart","dataStart","gridInfo","AMIN","AMAX","BMIN","BMAX","NC","CMIN","CMAX","cellInfo","lineSection","RAVE","RSIGMA","hsvToRgb","ColorDict","red","orange","gold","yellow","lime","green","sea","cyan","sky","blue","purple","magenta","hotpink","pink","peach","lilac","pinktint","peachtint","yellowtint","greentint","bluetint","lilactint","white","gray","brown","deadwhite","deadblack","invisible","reWhitespaceComma","reCurlyWhitespace","reTrimCurly","reTrimQuotes","reCollapseEqual","parseListDef","defaultColor","master","lm","listName","listColor","listMasters","listWidth","parseListElm","lineBreak","triangleBreak","lsindex","literal","isLineBreak","isTriangleBreak","parseStr","parseFlag","parseGroup","groupFlags","groupMasters","kinemage","onewidth","pdbfile","texts","captions","caption","groupDict","subgroupDict","masterDict","pointmasterDict","dotLists","vectorLists","ballLists","ribbonLists","currentGroupMasters","currentSubgroupMasters","dotDefaultColor","dotLabel","dotPosition","dotColor","vecDefaultColor","vecDefaultWidth","vecLabel1","vecLabel2","vecPosition1","vecPosition2","vecColor1","vecColor2","ballRadius","ballDefaultColor","ballLabel","ballPosition","ballColor","ribbonListDefaultColor","ribbonPointLabelArray","ribbonPointPositionArray","ribbonPointBreakArray","ribbonPointColorArray","isDotList","prevDotLabel","isVectorList","prevVecLabel","prevVecPosition","prevVecColor","isBallList","prevBallLabel","isRibbonList","prevRibbonPointLabel","isCaption","masterArray","labelArray","colorArray","indent","label1Array","label2Array","position1Array","position2Array","color1Array","color2Array","radiusArray","breakArray","splitLine","singlePointLine","dominant","convertedLists","listObject","convertedRibbonObject","editedLabels","editedPositions","editedColors","editedBreaks","breakPointer","positionPointer","removePointBreaksTriangleArrays","ribbonObject","convertedLabels","convertedBreaks","convertedPositions","convertedColors","vector3Positions","convertKinTriangleArrays","SurfaceParser","getLoader","OBJLoader","regexp","vertex_pattern","normal_pattern","uv_pattern","face_vertex","face_vertex_uv","face_vertex_uv_normal","face_vertex_normal","object_pattern","smoothing_pattern","material_library_pattern","material_use_pattern","setPath","_createParserState","objects","startObject","fromDeclaration","parseVertexIndex","parseNormalIndex","addVertex","addVertexLine","addNormal","addFace","nd","vLen","ib","ic","nLen","addLineGeometry","vi","lineFirstChar","lineSecondChar","trimLeft","lineParts","lineVertices","lineUVs","llen","buffergeometry","reDelimiter","msgpack","netcdf","TextParser","reStrip","reTag","reContent","reAttr","parseXml","declaration","tag","eos","child","re","XmlParser","useDomParser","__xmlParser","__domParser","DOMParser","parseFromString","Document","getNamedItem","getSele","useAltcode","icode","altcode","getResSele","setBitDict","bit","hasAttrValue","getProblemCount","clashDict","ga","clashes","getElementsByTagName","Validation","atomDict","clashSele","fromXml","entries","chemicalShiftLists","randomCoilIndices","rcia","_clashDict","clashList","seleAttr","createAttribute","setNamedItem","atomSele","res1","res2","mogBondOutliers","mogAngleOutliers","vPos1","vPos2","getAtomSele","dHalf","shrinkBuf","arraySet","dest","src_offs","dest_offs","adler32","adler","crcTable","crc32","crc","BAD$1","TYPE$1","inflate_fast","strm","_in","last","_out","wsize","whave","wnext","s_window","lcode","dcode","lmask","dmask","here","op","from_source","next_in","avail_in","next_out","avail_out","lencode","distcode","lenbits","distbits","dolen","sane","MAXBITS","ENOUGH_LENS$1","ENOUGH_DISTS$1","CODES$1","LENS$1","DISTS$1","lbase","lext","dbase","dext","inflate_table","lens","lens_index","codes","table_index","work","incr","here_bits","here_op","here_val","curr","drop","used","huff","base_index","offs","extra","extra_index","LENS","DISTS","Z_OK","Z_STREAM_ERROR","HEAD","TYPE","BAD","ENOUGH_LENS","ENOUGH_DISTS","zswap32","InflateState","havedict","check","total","wbits","ncode","nlen","ndist","have","lendyn","distdyn","was","inflateReset","total_in","total_out","inflateResetKeep","inflateInit2","windowBits","inflateReset2","lenfix","distfix","virgin","fixedtables","updatewindow","flush","put","last_bits","last_op","last_val","hbuf","inf_leave","xflags","os","extra_len","hcrc","inflateSetDictionary","dictLength","STR_APPLY_OK","STR_APPLY_UIA_OK","__","_utf8len","string2buf","m_pos","str_len","buf_len","buf2string","c_len","utf16buf","_buf2binstring","utf8border","Z_OK$1","messages","ZStream","GZheader","Inflate","sources","raw","ended","_mode","next_out_utf8","utf8str","allowBufError","binstring2buf","onEnd","onData","inflateEnd","flattenChunks","decompressedData","inflator","ungzip","Datasource","mmtfBaseUrl","mmtfFullUrl","mmtfReducedUrl","bcifBaseUrl","pdbid","baseUrl","suffixUrl","PassThroughDatasource","suffixURL","uniprotid","reProtocol","StaticDatasource","relativePath","loc","pn","pathname","basePath","getAbsolutePath","MdsrvDatasource","getListing","jsonData","frameIndex","getPathUrl","IntegerParam","NumberParam","RangeParam","SelectParam","UIStageParameters","Version"],"mappings":"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AAI,EAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,EAAK,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,GAouB5lCC,GAAqD,CAChE,EAAG,IAAM,EAAG,IAAM,EAAG,KAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,GAAI,IAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI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,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MA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AI,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAC1D,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAC1D,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAC1D,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACtD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAC1D,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACxD,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACtD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAA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EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GACzE,EAAE,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GACxE,EAAE,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GACzE,EAAE,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GACxE,EAAE,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GACpE,EAAE,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC7E,EAAE,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GACrE,EAAE,GAAI,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GACxE,CAAC,GAAI,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GACrE,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GACzE,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GACxE,EAAE,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI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"}